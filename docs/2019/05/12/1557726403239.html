<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SpringCloud 服务治理除了Eureka还有更多选择：Consul 使用详解 « NotBeCN</title>
  <meta name="description" content="                  学会尊重他人的劳动成果-转载来源 https://blog.csdn.net/ityouknow/article/details/81125446   我们知道 Eureka 2.0 闭源了，但其实对国内的用户影响甚小，一方面国内大都使用的是 Eureka 1.X 系列，另一方...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/1557726403239.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">SpringCloud 服务治理除了Eureka还有更多选择：Consul 使用详解</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-tomorrow-night-eighties"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>学会尊重他人的劳动成果-转载来源 <a href="https://blog.csdn.net/ityouknow/article/details/81125446" rel="nofollow">https://blog.csdn.net/ityouknow/article/details/81125446</a></p> 
  <p><span>我们知道 Eureka 2.0 闭源了，但其实对国内的用户影响甚小，一方面国内大都使用的是 Eureka 1.X 系列，另一方面</span></p>
  <p>Spring Cloud 支持很多服务发现的软件，Eureka 只是其中之一，下面是 Spring Cloud 支持的服务发现软件以及特性对比：<br></p>
  <div class="table-box">
   <table width="685">
    <thead>
     <tr>
      <th>Feature</th>
      <th>euerka</th>
      <th>Consul</th>
      <th>zookeeper</th>
      <th>etcd</th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td>服务健康检查</td>
      <td>可配支持</td>
      <td>服务状态，内存，硬盘等</td>
      <td>(弱)长连接，keepalive</td>
      <td>连接心跳</td>
     </tr>
     <tr>
      <td>多数据中心</td>
      <td>—</td>
      <td>支持</td>
      <td>—</td>
      <td>—</td>
     </tr>
     <tr>
      <td>kv 存储服务</td>
      <td>—</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
     </tr>
     <tr>
      <td>一致性</td>
      <td>—</td>
      <td>raft</td>
      <td>paxos</td>
      <td>raft</td>
     </tr>
     <tr>
      <td>cap</td>
      <td>ap</td>
      <td>ca</td>
      <td>cp</td>
      <td>cp</td>
     </tr>
     <tr>
      <td>使用接口(多语言能力)</td>
      <td>http（sidecar）</td>
      <td>支持 http 和 dns</td>
      <td>客户端</td>
      <td>http/grpc</td>
     </tr>
     <tr>
      <td>watch 支持</td>
      <td>支持 long polling/大部分增量</td>
      <td>全量/支持long polling</td>
      <td>支持</td>
      <td>支持 long polling</td>
     </tr>
     <tr>
      <td>自身监控</td>
      <td>metrics</td>
      <td>metrics</td>
      <td>—</td>
      <td>metrics</td>
     </tr>
     <tr>
      <td>安全</td>
      <td>—</td>
      <td>acl /https</td>
      <td>acl</td>
      <td>https 支持（弱）</td>
     </tr>
     <tr>
      <td>spring cloud 集成</td>
      <td>已支持</td>
      <td>已支持</td>
      <td>已支持</td>
      <td>已支持</td>
     </tr>
    </tbody>
   </table>
  </div>
  <p>在以上服务发现的软件中，Euerka 和 Consul 使用最为广泛。如果大家对注册中心的概念和 Euerka 不太了解的话， 可以参考我前期的文章：springcloud(二)：注册中心Eureka&nbsp;，本篇文章主要给大家介绍 Spring Cloud Consul 的使用。</p>
  <h2><a></a><span>Consul 介绍</span></h2>
  <p>Consul 是 HashiCorp 公司推出的开源工具，用于实现分布式系统的服务发现与配置。与其他分布式服务注册与发现的方案，Consul 的方案更“一站式”，内置了服务注册与发现框 架、分布一致性协议实现、健康检查、Key/Value 存储、多数据中心方案，不再需要依赖其他工具（比如 ZooKeeper 等）。使用起来也较 为简单。Consul 使用 Go 语言编写，因此具有天然可移植性(支持Linux、windows和Mac OS X)；安装包仅包含一个可执行文件，方便部署，与 Docker 等轻量级容器可无缝配合。</p>
  <p><strong>Consul 的优势：</strong></p>
  <ul class="list-paddingleft-2">
   <li><p><span>使用 Raft 算法来保证一致性, 比复杂的 Paxos 算法更直接. 相比较而言, zookeeper 采用的是 Paxos, 而 etcd 使用的则是 Raft。</span></p></li>
   <li><p><span>支持多数据中心，内外网的服务采用不同的端口进行监听。 多数据中心集群可以避免单数据中心的单点故障,而其部署则需要考虑网络延迟, 分片等情况等。 zookeeper 和 etcd 均不提供多数据中心功能的支持。</span></p></li>
   <li><p><span>支持健康检查。 etcd 不提供此功能。</span></p></li>
   <li><p><span>支持 http 和 dns 协议接口。 zookeeper 的集成较为复杂, etcd 只支持 http 协议。</span></p></li>
   <li><p><span>官方提供 web 管理界面, etcd 无此功能。</span></p></li>
   <li><p><span>综合比较, Consul 作为服务注册和配置管理的新星, 比较值得关注和研究。</span></p></li>
  </ul>
  <p><strong>特性：</strong></p>
  <ul class="list-paddingleft-2">
   <li><p><span>服务发现</span></p></li>
   <li><p><span>健康检查</span></p></li>
   <li><p><span>Key/Value 存储</span></p></li>
   <li><p><span>多数据中心</span></p></li>
  </ul>
  <p><strong>Consul 角色</strong></p>
  <ul class="list-paddingleft-2">
   <li><p><span>client: 客户端, 无状态, 将 HTTP 和 DNS 接口请求转发给局域网内的服务端集群。</span></p></li>
   <li><p><span>server: 服务端, 保存配置信息, 高可用集群, 在局域网内与本地客户端通讯, 通过广域网与其他数据中心通讯。 每个数据中心的 server 数量推荐为 3 个或是 5 个。</span></p></li>
  </ul>
  <p>Consul 客户端、服务端还支持夸中心的使用，更加提高了它的高可用性。</p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8JtxoPBaV1RibUaUnZP7meREiaVX7iaKPfbicEkGhE3NdoVzyiciaDVG4SxBTfbxg/640?wx_fmt=png" alt="640?wx_fmt=png">
  <p><strong>Consul 工作原理：</strong></p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8JtxoEjUB8ibTNqtaqzgnicK2KqQTDEWyKVNRVbvROglNic5hYOra60sJx60BQ/640?wx_fmt=png" alt="640?wx_fmt=png">
  <ul class="list-paddingleft-2">
   <li><p><span>1、当 Producer 启动的时候，会向 Consul 发送一个 post 请求，告诉 Consul 自己的 IP 和 Port</span></p></li>
   <li><p><span>2、Consul 接收到 Producer 的注册后，每隔10s（默认）会向 Producer 发送一个健康检查的请求，检验Producer是否健康</span></p></li>
   <li><p><span>3、当 Consumer 发送 GET 方式请求 /api/address 到 Producer 时，会先从 Consul 中拿到一个存储服务 IP 和 Port 的临时表，从表中拿到 Producer 的 IP 和 Port 后再发送 GET 方式请求 /api/address</span></p></li>
   <li><p><span>4、该临时表每隔10s会更新，只包含有通过了健康检查的 Producer</span></p></li>
  </ul>
  <p>Spring Cloud Consul 项目是针对 Consul 的服务治理实现。Consul 是一个分布式高可用的系统，它包含多个组件，但是作为一个整体，在微服务架构中为我们的基础设施提供服务发现和服务配置的工具。</p>
  <h2><a></a><span>Consul VS Eureka</span></h2>
  <p>Eureka 是一个服务发现工具。该体系结构主要是客户端/服务器，每个数据中心有一组 Eureka 服务器，通常每个可用区域一个。通常 Eureka 的客户使用嵌入式 SDK 来注册和发现服务。对于非本地集成的客户，使用功能区边框等透过 Eureka 透明地发现服务。</p>
  <p>Eureka 提供了一个弱一致的服务视图，使用尽力而为复制。当客户端向服务器注册时，该服务器将尝试复制到其他服务器，但不提供保证。服务注册的生存时间（TTL）较短，要求客户端对服务器心存感激。不健康的服务或节点将停止心跳，导致它们超时并从注册表中删除。发现请求可以路由到任何服务，由于尽力而为的复制，这些服务可能会导致陈旧或丢失数据。这个简化的模型允许简单的群集管理和高可扩展性。</p>
  <p>领事提供了一套超级功能，包括更丰富的健康检查，关键/价值存储以及多数据中心意识。Consul 需要每个数据中心都有一套服务器，以及每个客户端的代理，类似于使用像 Ribbon 这样的边车。Consul 代理允许大多数应用程序成为 Consul 不知情者，通过配置文件执行服务注册并通过 DNS 或负载平衡器 sidecars 发现。</p>
  <p>Consul 提供强大的一致性保证，因为服务器使用Raft协议复制状态 。Consul 支持丰富的健康检查，包括 TCP，HTTP，Nagios / Sensu 兼容脚本或基于 Eureka 的 TTL。客户端节点参与基于八卦的健康检查，该检查分发健康检查工作，而不像集中式心跳检测那样成为可扩展性挑战。发现请求被路由到选举出来的领事领导，这使他们默认情况下强烈一致。允许陈旧读取的客户端使任何服务器都可以处理他们的请求，从而实现像Eureka这样的线性可伸缩性。</p>
  <p>Consul 强烈的一致性意味着它可以作为领导选举和集群协调的锁定服务。Eureka 不提供类似的保证，并且通常需要为需要执行协调或具有更强一致性需求的服务运行 ZooKeeper。</p>
  <p>Consul 提供了支持面向服务的体系结构所需的一系列功能。这包括服务发现，还包括丰富的运行状况检查，锁定，密钥/值，多数据中心联合，事件系统和 ACL。Consul 和 consul-template 和 envconsul 等工具生态系统都试图尽量减少集成所需的应用程序更改，以避免需要通过SDK进行本地集成。Eureka是一个更大的 Netflix OSS 套件的一部分，该套件预计应用程序相对均匀且紧密集成。因此，Eureka只解决了一小部分问题，希望ZooKeeper等其他工具可以一起使用。<br>在 CAP 中，Consul 使用 CP 体系结构，有利于实现可用性的一致性。</p>
  <p>Consul 强一致性(C)带来的是：</p>
  <p>服务注册相比 Eureka 会稍慢一些。因为 Consul 的 raft 协议要求必须过半数的节点都写入成功才认为注册成功&nbsp;<br>Leader 挂掉时，重新选举期间整个 Consul 不可用。保证了强一致性但牺牲了可用性。</p>
  <p>Eureka 保证高可用(A)和最终一致性：</p>
  <p>服务注册相对要快，因为不需要等注册信息 replicate 到其他节点，也不保证注册信息是否 replicate 成功<br>当数据出现不一致时，虽然A, B上的注册信息不完全相同，但每个Eureka节点依然能够正常对外提供服务，这会出现查询服务信息时如果请求A查不到，但请求B就能查到。如此保证了可用性但牺牲了一致性。</p>
  <p>其他方面，eureka 就是个 servlet 程序，跑在 servlet 容器中; Consul 则是 go 编写而成。</p>
  <h2><a></a><span>Consul 安装</span></h2>
  <p>Consul 不同于 Eureka 需要单独安装，访问Consul 官网下载 Consul 的最新版本，我这里是 consul_1.2.1。</p>
  <p>根据不同的系统类型选择不同的安装包，从下图也可以看出 Consul 支持所有主流系统。</p>
  <p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8JtxoA409VCkmL4LKMeM7GXEkic215djrdbGktSAgGCQUBbicnuSkKuTwGEgw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
  <p>我这里以 Windows 为例，下载下来是一个 consul_1.2.1_windows_amd64.zip 的压缩包，解压是是一个 consul.exe 的执行文件。</p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8Jtxop92hJLMrf1Un3fADF5hdmUvEWVhbRKz2RbicIibpu50ic9icbklnRNia7NA/640?wx_fmt=png" alt="640?wx_fmt=png">
  <p>cd 到对应的目录下，使用 cmd 启动 Consul</p>
  <pre><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span>&nbsp;D:\Common&nbsp;Files\consul<br><span class="hljs-comment"><span class="hljs-comment">#cmd启动：</span></span><br><span class="hljs-comment">consul&nbsp;agent&nbsp;-dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="hljs-comment"><span class="hljs-comment">#&nbsp;-dev表示开发模式运行，另外还有-server表示服务模式运行</span></span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>为了方便期间，可以在同级目录下创建一个 run.bat 脚本来启动，脚本内容如下：</p>
  <pre><code class="hljs nginx"><span class="hljs-attribute">consul</span>&nbsp;agent&nbsp;-dev<br>pause<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>启动结果如下：</p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8Jtxof745ib07ctiaGUIoiaOKGsMgkib2fWb1wFY8fszvAicXBhkm4OMTKOPouCw/640?wx_fmt=png" alt="640?wx_fmt=png">
  <p>启动成功之后访问：<code>http://localhost:8500</code>，可以看到 Consul 的管理界面</p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8Jtxo5EoHdcv0e7PCFj025S6oMXEKN2sRiadagaCWDrsKHGpoGbxrsw2WCDw/640?wx_fmt=png" alt="640?wx_fmt=png">
  <p>这样就意味着我们的 Consul 服务启动成功了。</p>
  <h2><a></a><span>Consul 服务端</span></h2>
  <p>接下来我们开发 Consul 的服务端，我们创建一个 spring-cloud-consul-producer 项目</p>
  <h3><a></a><span>添加依赖包</span></h3>
  <p>依赖包如下：</p>
  <pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-actuator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.cloud<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-web<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <ul class="list-paddingleft-2">
   <li><p><code>spring-boot-starter-actuator</code>&nbsp;健康检查依赖于此包。</p></li>
   <li><p><code>spring-cloud-starter-consul-discovery</code>&nbsp;Spring Cloud Consul 的支持。</p></li>
  </ul>
  <p>Spring Boot 版本使用的是 2.0.3.RELEASE，Spring Cloud 最新版本是 Finchley.RELEASE 依赖于 Spring Boot 2.x.</p>
  <pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parent</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-parent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.0.3.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">relativePath</span></span></span><span class="hljs-tag">/&gt;</span></span>&nbsp;<span class="hljs-comment"><span class="hljs-comment">&lt;!--&nbsp;lookup&nbsp;parent&nbsp;from&nbsp;repository&nbsp;--&gt;</span></span><br><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parent</span></span></span><span class="hljs-tag">&gt;</span></span><br><br><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencyManagement</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.cloud<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-cloud-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${spring-cloud.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>pom<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>import<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span><br><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencyManagement</span></span></span><span class="hljs-tag">&gt;</span></span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>完整的 pom.xml 文件大家可以参考示例源码。</p>
  <h3><a></a><span>配置文件</span></h3>
  <p>配置文件内容如下</p>
  <pre><code class="hljs apache python"><span class="hljs-attribute">spring</span>.application.name=spring-cloud-consul-producer<br><span class="hljs-attribute">server</span>.port=<span class="hljs-number">8501</span><br><span class="hljs-attribute">spring</span>.cloud.consul.host=localhost<br><span class="hljs-attribute">spring</span>.cloud.consul.port=<span class="hljs-number">8500</span><br><span class="hljs-comment"><span class="hljs-comment">#注册到consul的服务名称</span></span><br><span class="hljs-attribute"><span class="hljs-comment">spring</span></span><span class="hljs-comment">.cloud.consul.discovery.serviceName=service-producer</span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>Consul 的地址和端口号默认是 localhost:8500 ，如果不是这个地址可以自行配置。<br><code>spring.cloud.consul.discovery.serviceName</code>&nbsp;是指注册到 Consul 的服务名称，后期客户端会根据这个名称来进行服务调用。</p>
  <h3><a></a><span>启动类</span></h3>
  <pre><code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span><br><span class="hljs-meta"><span class="hljs-meta">@EnableDiscoveryClient</span></span><br><span class="hljs-keyword"><span class="hljs-meta">public</span></span>&nbsp;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&nbsp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsulProducerApplication</span></span></span><span class="hljs-class">&nbsp;</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span></span></span><span class="hljs-function">&nbsp;</span></span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SpringApplication.run(ConsulProducerApplication.class,&nbsp;args);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>添加了&nbsp;<code>@EnableDiscoveryClient</code>&nbsp;注解表示支持服务发现。</p>
  <h3><a></a><span>提供服务</span></h3>
  <p>我们在创建一个 Controller，推文提供 hello 的服务。</p>
  <pre><code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span><br><span class="hljs-keyword"><span class="hljs-meta">public</span></span>&nbsp;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&nbsp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloController</span></span></span><span class="hljs-class">&nbsp;</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/hello"</span></span></span><span class="hljs-meta">)</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&nbsp;String&nbsp;hello()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>&nbsp;<span class="hljs-string"><span class="hljs-string">"helle&nbsp;consul"</span></span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>为了模拟注册均衡负载复制一份上面的项目重命名为 spring-cloud-consul-producer-2 ,修改对应的端口为 8502，修改 hello 方法的返回值为："helle consul two"，修改完成后依次启动两个项目。</p>
  <p>这时候我们再次在浏览器访问地址：http://localhost:8500，显示如下：</p>
  <p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8JtxovdInrjjKv5aA02zwMCrW6mydic6ZAVlytBIUo2FVd20PzTibpsXq1WBQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
  <p>我们发现页面多了 service-producer 服务，点击进去后页面显示有两个服务提供者：<br></p>
  <img title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/PgqYrEEtEnpIMibSBSxibibqGj2qvW8JtxoXvsOouUBgsuA08K9cnBInA4FMrcTUcW87oeCemldCiacTU3DicuDGjsg/640?wx_fmt=png" alt="640?wx_fmt=png">
  <p>这样服务提供者就准备好了。</p>
  <h2><a></a><span>Consul 消费端</span></h2>
  <p>我们创建一个 spring-cloud-consul-consumer 项目，pom 文件和上面示例保持一致。</p>
  <h3><a></a><span>配置文件</span></h3>
  <p>配置文件内容如下</p>
  <pre><code class="hljs bash">spring.application.name=spring-cloud-consul-consumer<br>server.port=8503<br>spring.cloud.consul.host=127.0.0.1<br>spring.cloud.consul.port=8500<br><span class="hljs-comment"><span class="hljs-comment">#设置不需要注册到&nbsp;consul&nbsp;中</span></span><br><span class="hljs-comment">spring.cloud.consul.discovery.register=</span><span class="hljs-literal"><span class="hljs-comment">false</span></span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>客户端可以设置注册到 Consul 中，也可以不注册到 Consul 注册中心中，根据我们的业务来选择，只需要在使用服务时通过 Consul 对外提供的接口获取服务信息即可。</p>
  <h3><a></a><span>启动类</span></h3>
  <pre><code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span><br><span class="hljs-keyword"><span class="hljs-meta">public</span></span>&nbsp;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&nbsp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsulConsumerApplication</span></span></span><span class="hljs-class">&nbsp;</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&nbsp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span></span></span><span class="hljs-function">&nbsp;</span></span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SpringApplication.run(ConsulConsumerApplication.class,&nbsp;args);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code>
   <div class="hljs-button {2}"></div></pre>
  <h3><a></a><span>进行测试</span></h3>
  <p>我们先来创建一个 ServiceController ,试试如果去获取 Consul 中的服务。</p>
  <pre><code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span><br><span class="hljs-keyword"><span class="hljs-meta">public</span></span>&nbsp;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&nbsp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceController</span></span></span><span class="hljs-class">&nbsp;</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>&nbsp;LoadBalancerClient&nbsp;loadBalancer;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>&nbsp;DiscoveryClient&nbsp;discoveryClient;<br><br>&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-comment">/**</span><br><span class="hljs-comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获取所有服务</span><br><span class="hljs-comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/services"</span></span></span><span class="hljs-meta">)</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&nbsp;Object&nbsp;services()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>&nbsp;discoveryClient.getInstances(<span class="hljs-string"><span class="hljs-string">"service-producer"</span></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-comment">/**</span><br><span class="hljs-comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;从所有服务中选择一个服务（轮询）</span><br><span class="hljs-comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/discover"</span></span></span><span class="hljs-meta">)</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&nbsp;Object&nbsp;discover()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>&nbsp;loadBalancer.choose(<span class="hljs-string"><span class="hljs-string">"service-producer"</span></span>).getUri().toString();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>Controller 中有俩个方法，一个是获取所有服务名为<code>service-producer</code>的服务信息并返回到页面，一个是随机从服务名为<code>service-producer</code>的服务中获取一个并返回到页面。</p>
  <p>添加完 ServiceController 之后我们启动项目，访问地址：<code>http://localhost:8503/services</code>，返回：</p>
  <pre><code class="hljs json java">[{<span class="hljs-attr"><span class="hljs-string">"serviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"service-producer"</span></span>,<span class="hljs-attr"><span class="hljs-string">"host"</span></span>:<span class="hljs-string"><span class="hljs-string">"windows10.microdone.cn"</span></span>,<span class="hljs-attr"><span class="hljs-string">"port"</span></span>:<span class="hljs-number"><span class="hljs-number">8501</span></span>,<span class="hljs-attr"><span class="hljs-string">"secure"</span></span>:<span class="hljs-literal"><span class="hljs-keyword">false</span></span>,<span class="hljs-attr"><span class="hljs-string">"metadata"</span></span>:{<span class="hljs-attr"><span class="hljs-string">"secure"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>},<span class="hljs-attr"><span class="hljs-string">"uri"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://windows10.microdone.cn:8501"</span></span>,<span class="hljs-attr"><span class="hljs-string">"scheme"</span></span>:<span class="hljs-literal"><span class="hljs-keyword">null</span></span>},{<span class="hljs-attr"><span class="hljs-string">"serviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"service-producer"</span></span>,<span class="hljs-attr"><span class="hljs-string">"host"</span></span>:<span class="hljs-string"><span class="hljs-string">"windows10.microdone.cn"</span></span>,<span class="hljs-attr"><span class="hljs-string">"port"</span></span>:<span class="hljs-number"><span class="hljs-number">8502</span></span>,<span class="hljs-attr"><span class="hljs-string">"secure"</span></span>:<span class="hljs-literal"><span class="hljs-keyword">false</span></span>,<span class="hljs-attr"><span class="hljs-string">"metadata"</span></span>:{<span class="hljs-attr"><span class="hljs-string">"secure"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>},<span class="hljs-attr"><span class="hljs-string">"uri"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://windows10.microdone.cn:8502"</span></span>,<span class="hljs-attr"><span class="hljs-string">"scheme"</span></span>:<span class="hljs-literal"><span class="hljs-keyword">null</span></span>}]<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>发现我们刚才创建的端口为 8501 和 8502 的两个服务端都存在。</p>
  <p>多次访问地址：<code>http://localhost:8503/discover</code>，页面会交替返回下面信息：</p>
  <pre><code class="hljs cpp">http:<span class="hljs-comment"><span class="hljs-comment">//windows10.microdone.cn:8501</span></span><br><span class="hljs-comment">http:</span><span class="hljs-comment"><span class="hljs-comment">//windows10.microdone.cn:8502</span></span><br><span class="hljs-comment">...</span><br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>说明 8501 和 8501 的两个服务会交替出现，从而实现了获取服务端地址的均衡负载。</p>
  <p>大多数情况下我们希望使用均衡负载的形式去获取服务端提供的服务，因此使用第二种方法来模拟调用服务端提供的 hello 方法。</p>
  <p>创建 CallHelloController ：</p>
  <pre><code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span><br><span class="hljs-keyword"><span class="hljs-meta">public</span></span>&nbsp;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&nbsp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallHelloController</span></span></span><span class="hljs-class">&nbsp;</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>&nbsp;LoadBalancerClient&nbsp;loadBalancer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/call"</span></span></span><span class="hljs-meta">)</span></span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>&nbsp;String&nbsp;call()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServiceInstance&nbsp;serviceInstance&nbsp;=&nbsp;loadBalancer.choose(<span class="hljs-string"><span class="hljs-string">"service-producer"</span></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println(<span class="hljs-string"><span class="hljs-string">"服务地址："</span></span>&nbsp;+&nbsp;serviceInstance.getUri());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println(<span class="hljs-string"><span class="hljs-string">"服务名称："</span></span>&nbsp;+&nbsp;serviceInstance.getServiceId());<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;callServiceResult&nbsp;=&nbsp;new&nbsp;RestTemplate().getForObject(serviceInstance.getUri().toString()&nbsp;+&nbsp;<span class="hljs-string"><span class="hljs-string">"/hello"</span></span>,&nbsp;String.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println(callServiceResult);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>&nbsp;callServiceResult;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>使用 RestTemplate 进行远程调用。添加完之后重启 spring-cloud-consul-consumer 项目。在浏览器中访问地址：<code>http://localhost:8503/call</code>，依次返回结果如下：</p>
  <pre><code class="hljs nginx"><span class="hljs-attribute">helle</span>&nbsp;consul<br>helle&nbsp;consul&nbsp;two<br>...<br></code>
   <div class="hljs-button {2}"></div></pre>
  <p>说明我们已经成功的调用了 Consul 服务端提供的服务，并且实现了服务端的均衡负载功能。通过今天的实践我们发现 Consul 提供的服务发现易用、强大。</p>
  <p><span><strong>示例代码:https://github.com/ityouknow/spring-cloud-examples</strong></span></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
