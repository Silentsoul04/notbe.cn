<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>惊了！7 行代码优雅地实现 Excel 文件生成&下载功能 « NotBeCN</title>
  <meta name="description" content="                       欢迎关注个人微信公众号: 小哈学Java, 文末分享阿里 P8 资深架构师吐血总结的 《Java 核心知识整理&amp;面试.pdf》资源链接！！    个人网站: https://www.exception.site/essay/how-to-create-exce...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/weiwosuoai_90138222.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">惊了！7 行代码优雅地实现 Excel 文件生成&下载功能</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-light"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <blockquote> 
   <p>欢迎关注个人微信公众号: <strong>小哈学Java</strong>, 文末<strong>分享阿里 P8 资深架构师吐血总结的 《Java 核心知识整理&amp;面试.pdf》资源链接</strong>！！</p> 
   <p>个人网站: <a href="https://www.exception.site/essay/how-to-create-excel-by-seven-line-code" rel="nofollow">https://www.exception.site/essay/how-to-create-excel-by-seven-line-code</a></p> 
  </blockquote> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757466953826" alt="7 行代码教您优雅地实现 Excel 导出功能" title="7 行代码教您优雅地实现 Excel 导出功能"></p> 
  <h2><a id="_6"></a>目录</h2> 
  <ul> 
   <li> <p>一、前言</p> </li> 
   <li> <p>二、Apache poi、jxl 的缺陷</p> </li> 
   <li> <p>三、阿里出品的 EasyExcel，安利一波</p> </li> 
   <li> <p>四、EasyExcel 解决了什么</p> </li> 
   <li> <p>五、快速上手</p> </li> 
   <li> <p>六、特殊场景支持</p> </li> 
   <li> <p>七、Web 下载示例代码</p> </li> 
   <li> <p>八、需要注意的点</p> </li> 
   <li> <p>九、总结</p> </li> 
  </ul> 
  <h2><a id="_26"></a>一、前言</h2> 
  <p>关于导出 Excel 文件，可以说是大多数服务中都需要集成的功能。那么，要如何优雅快速地（<strong>偷懒地</strong>）去实现这个功能呢？</p> 
  <p>你可能第一想法是：这还不简单？用 Apache 开源框架 poi, 或者 jxl 都可以实现啊。面向百度编程，把代码模板 copy 下来，根据自己的业务再改改，能有多难？</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155748947867220" alt="你仿佛在逗我笑" title="你仿佛在逗我笑"></p> 
  <p>嗯… 的确不难，但是你的代码可能是下面这个熊样子的：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155740642109259" alt="用传统excel框架生成文件的代码模板" title="用传统excel框架生成文件的代码模板"></p> 
  <p>上面这段代码看上去是不是又臭又长呢？今天，小哈将教您如何使用 7 行代码搞定 Excel 文件生成功能！</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155685877793063" alt="我要开始装逼了" title="我要开始装逼了"></p> 
  <h2><a id="Apache_poijxl__42"></a>二、Apache poi、jxl 的缺陷</h2> 
  <p>在说如何实现之前，我们先来讨论一下传统 Excel 框架的不足！除了上面说的，Apache poi、jxl 都存在生成 excel 文件不够简单优雅快速外，它们都还存在一个严重的问题，那就是<strong>非常耗内存</strong>，<strong>严重时会导致内存溢出</strong>。</p> 
  <p>POI 虽然目前来说，是 excel 解析框架中被使用最广泛的，但这个框架并不完美。</p> 
  <p>为什么这么说呢？</p> 
  <p>开发者们大部分使用 POI，都是使用其 userModel 模式。而 userModel 的好处是上手容易使用简单，随便拷贝个代码跑一下，剩下就是写业务转换了，虽然转换也要写上百行代码，但是还是可控的。</p> 
  <p>然而 userModel 模式最大的问题是在于，对内存消耗非常大，一个几兆的文件解析甚至要用掉上百兆的内存。现实情况是，很多应用现在都在采用这种模式，之所以还正常在跑是因为并发不大，并发上来后，一定会OOM或者频繁的 full gc。</p> 
  <h2><a id="_EasyExcel_54"></a>三、阿里出品的 EasyExcel，安利一波</h2> 
  <p>什么是 EasyExcel? 见名知意，就是让你操作 Excel 异常的酸爽。先来看下 EasyExcel GitHub 官方截图：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155740838000171" alt="easyExcel GitHub 截图" title="easyExcel GitHub 截图"></p> 
  <p>截止目前为止已有 <strong>5519</strong> Star, 官方对其的简介是：</p> 
  <p><strong>快速、简单避免OOM的java处理Excel工具！</strong></p> 
  <p>以下是官方介绍：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155740987546790" alt="esayExcel GitHub 简介" title="esayExcel GitHub 简介"></p> 
  <h2><a id="EasyExcel__68"></a>四、EasyExcel 解决了什么</h2> 
  <p>主要来说，有以下几点：</p> 
  <ul> 
   <li>传统 Excel 框架，如 Apache poi、jxl 都存在内存溢出的问题；</li> 
   <li>传统 excel 开源框架使用复杂、繁琐;</li> 
   <li>EasyExcel 底层还是使用的 poi, 但是做了很多优化，比如修复了并发情况下的一些 bug, 具体修复细节，可阅读官方文档 <a href="https://github.com/alibaba/easyexcel" rel="nofollow">https://github.com/alibaba/easyexcel</a>；</li> 
  </ul> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757385558915" alt="好像很厉害的样子" title="好像很厉害的样子"></p> 
  <h2><a id="_78"></a>五、快速上手</h2> 
  <h3><a id="51__80"></a>5.1 添加依赖</h3> 
  <pre><code class="prism language-xml"><span class="token comment">&lt;!--alibaba easyexcel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>easyexcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.2-beta5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
  <h3><a id="52__Excel__91"></a>5.2 七行代码搞定 Excel 生成</h3> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155749628391370" alt="使用EasyExcel生成Excel模板代码" title="使用EasyExcel生成Excel模板代码"></p> 
  <pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExcel1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
  <span class="token comment">// 文件输出位置</span>
  OutputStream out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"/Users/a123123/Work/tmp_files/test.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ExcelWriter writer <span class="token operator">=</span> EasyExcelFactory<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 写仅有一个 Sheet 的 Excel 文件, 此场景较为通用</span>
  Sheet sheet1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WriteModel<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 第一个 sheet 名称</span>
  sheet1<span class="token punctuation">.</span><span class="token function">setSheetName</span><span class="token punctuation">(</span><span class="token string">"第一个sheet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 写数据到 Writer 上下文中</span>
  <span class="token comment">// 入参1: 创建要写入的模型数据</span>
  <span class="token comment">// 入参2: 要写入的目标 sheet</span>
  writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">createModelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sheet1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将上下文中的最终 outputStream 写入到指定文件中</span>
  writer<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 关闭流</span>
  out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>上面这段示例代码中，有两个点很重要，小哈已经重点标注标：</p> 
  <ul> 
   <li><strong>①</strong>：WriteModel 这个对象就是要写入 Excel 的数据模型对象，**等等，你这好像不行吧？表头 head，以及每个单元格内的数据顺序都没指定，能达到想要的效果么？别急，后面会讨论这块！</li> 
   <li><strong>②</strong>：创建<strong>需要写入的数据集</strong>，当然了，正常业务中，这块都是从数据库中查询出来的。</li> 
  </ul> 
  <blockquote> 
   <p>PS: 如果说写入的数据量很大，需要做分片查询再写入的处理，否则可能会 OOM（Out of Memory）.</p> 
  </blockquote> 
  <p>回过头来，我们来看看 <code>WriteModel</code> 这个对象内部到底有什么幺蛾子！</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155753884240036" alt="WriteModel对象" title="WriteModel对象"></p> 
  <pre><code class="prism language-java"><span class="token comment">/** * @author 微信公众号: 小哈学Java * @Site： www.exception.site * @date 2019/5/9 * @time 下午2:07 * @discription 写入Excel模型对象 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Builder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteModel</span> <span class="token keyword">extends</span> <span class="token class-name">BaseRowModel</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"姓名"</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"密码"</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"年龄"</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>ExayExcel 提供注解的方式, 来方便的定义 Excel 需要的数据模型：</p> 
  <ul> 
   <li><strong>①</strong>：首先，定义的写入模型必须要继承自 <code>BaseRowModel.java</code>;</li> 
   <li><strong>②</strong>：通过 <code>@ExcelProperty</code> 注解来指定每个字段的<strong>列名称</strong>，以及<strong>下标位置</strong>；</li> 
  </ul> 
  <p>同时，上面定义的 <code>createModelList()</code> 方法也很简单，通过循环，创建一个写入模型的 List 集合：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155754135797815" alt="createModleList()" title="createModleList()"></p> 
  <p>废话不多说，这个快速接入的案例也介绍的差不多了，跑一跑单元测试看下实际效果：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155753985086665" alt="测试结果" title="测试结果"></p> 
  <p>怎么样，效果还是挺棒棒的！</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757394606631" alt="厉害了" title="厉害了"></p> 
  <h2><a id="_175"></a>六、特殊场景支持</h2> 
  <p>在实际的业务中，我们还会有一些特需的需求，比如说下面这些。</p> 
  <h3><a id="61__Excel__179"></a>6.1 动态生成 Excel 内容</h3> 
  <p>上面的例子是基于注解的，也就是说表头 head, 以及内容都是写死的，换句话说，我定义好了一个数据模型，那么，生成的 Excel 文件也就是只能遵循这种模型来了，但是，实际业务中可能会存在动态变化的需求，要怎么做呢？</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155756440040794" alt="动态生成Excel" title="动态生成Excel"></p> 
  <pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExcel2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
  <span class="token comment">// 文件输出位置</span>
  OutputStream out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"/Users/a123123/Work/tmp_files/test2.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ExcelWriter writer <span class="token operator">=</span> EasyExcelFactory<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 动态添加表头，适用一些表头动态变化的场景</span>
  Sheet sheet1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  sheet1<span class="token punctuation">.</span><span class="token function">setSheetName</span><span class="token punctuation">(</span><span class="token string">"第一个sheet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建一个表格，用于 Sheet 中使用</span>
  Table table1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Table</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 无注解的模式，动态添加表头</span>
  table1<span class="token punctuation">.</span><span class="token function">setHead</span><span class="token punctuation">(</span>DataUtil<span class="token punctuation">.</span><span class="token function">createTestListStringHead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 写数据</span>
  writer<span class="token punctuation">.</span><span class="token function">write1</span><span class="token punctuation">(</span><span class="token function">createDynamicModelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sheet1<span class="token punctuation">,</span> table1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将上下文中的最终 outputStream 写入到指定文件中</span>
  writer<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 关闭流</span>
  out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul> 
   <li><strong>①</strong>：无注解模式，动态添加表头，也可自由组合复杂表头，代码如下：</li> 
  </ul> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155756479285874" alt="动态生成Excel表头数据" title="动态生成Excel表头数据"></p> 
  <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">createTestListStringHead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 模型上没有注解，表头数据动态传入</span>
    List<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> headCoulumn1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> headCoulumn2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> headCoulumn3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> headCoulumn4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> headCoulumn5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    headCoulumn1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headCoulumn2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    headCoulumn3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第二列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第二列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第二列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headCoulumn4<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第三列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn4<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第三列2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn4<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第三列2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headCoulumn5<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn5<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第3列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>headCoulumn5<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"第4列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    head<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headCoulumn1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headCoulumn2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headCoulumn3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headCoulumn4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headCoulumn5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> head<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul> 
   <li><strong>②</strong>：创建动态数据，注意这里的数据类型是 <code>Object</code>:</li> 
  </ul> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155756505371894" alt="创建动态数据" title="创建动态数据"></p> 
  <p>跑一下单元测试，看下效果：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155756516788514" alt="动态创建效果测试" title="动态创建效果测试"></p> 
  <h3><a id="62__252"></a>6.2 自定义表头以及内容样式</h3> 
  <p>我想自定义表头，内容样式，咋办？</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155756875890089" alt="自定义表格样式" title="自定义表格样式"></p> 
  <p>我们复用了上面的示例代码，并额外添加了设置自定义表格样式的代码, <code>createTableStytle()</code> 具体内容如下：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757030105630" alt="创建表格样式代码" title="创建表格样式代码"></p> 
  <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> TableStyle <span class="token function">createTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TableStyle tableStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置表头样式</span>
    Font headFont <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 字体是否加粗</span>
    headFont<span class="token punctuation">.</span><span class="token function">setBold</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 字体大小</span>
    headFont<span class="token punctuation">.</span><span class="token function">setFontHeightInPoints</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 字体</span>
    headFont<span class="token punctuation">.</span><span class="token function">setFontName</span><span class="token punctuation">(</span><span class="token string">"楷体"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableStyle<span class="token punctuation">.</span><span class="token function">setTableHeadFont</span><span class="token punctuation">(</span>headFont<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 背景色</span>
    tableStyle<span class="token punctuation">.</span><span class="token function">setTableHeadBackGroundColor</span><span class="token punctuation">(</span>IndexedColors<span class="token punctuation">.</span>BLUE<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 设置表格主体样式</span>
    Font contentFont <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentFont<span class="token punctuation">.</span><span class="token function">setBold</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentFont<span class="token punctuation">.</span><span class="token function">setFontHeightInPoints</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentFont<span class="token punctuation">.</span><span class="token function">setFontName</span><span class="token punctuation">(</span><span class="token string">"黑体"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableStyle<span class="token punctuation">.</span><span class="token function">setTableContentFont</span><span class="token punctuation">(</span>contentFont<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableStyle<span class="token punctuation">.</span><span class="token function">setTableContentBackGroundColor</span><span class="token punctuation">(</span>IndexedColors<span class="token punctuation">.</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> tableStyle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>我们可以通过 <code>TableStyle</code> 这个类来设置表头、表格主题的样式。</p> 
  <h3><a id="63__291"></a>6.3 合并单元格</h3> 
  <p>我们可以通过 <code>merge()</code> 方法来合并单元格：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757098319345" alt="合并单元格" title="合并单元格"></p> 
  <p>注意下标是从 0 开始的，也就是说合并了第六行到第七行，其中的第一列到第五列，跑下代码，看下效果：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757106065619" alt="合并单元格效果图" title="合并单元格效果图"></p> 
  <h3><a id="64__301"></a>6.4 自定义处理</h3> 
  <p>对于更复杂的处理，EasyExcel 预留了 <code>WriterHandler</code> 接口来，允许你自定义处理代码：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757165898160" alt="WriterHandler" title="WriterHandler"></p> 
  <p>接口中定义了三个方法:</p> 
  <ul> 
   <li><code>sheet()</code>: 在创建每个 sheet 后自定义业务逻辑处理；</li> 
   <li><code>row()</code>: 在创建每个 row 后自定义业务逻辑处理；</li> 
   <li><code>cell()</code>: 在创建每个 cell 后自定义业务逻辑处理；</li> 
  </ul> 
  <p>我们实现了该接口后，编写自定义逻辑处理代码，然后调用 <code>getWriterWithTempAndHandler()</code> 静态方法获取 <code>ExcelWriter</code> 对象时，传入 <code>WriterHandler</code> 的实现类即可。</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155757217287066" alt="传入WriterHandler" title="传入WriterHandler"></p> 
  <p>比如下面的示例代码：</p> 
  <pre><code class="prism language-java">ExcelWriter writer <span class="token operator">=</span> EasyExcelFactory<span class="token punctuation">.</span><span class="token function">getWriterWithTempAndHandler</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> out<span class="token punctuation">,</span> ExcelTypeEnum<span class="token punctuation">.</span>XLSX<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyWriterHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
  <h2><a id="Web__323"></a>七、Web 下载示例代码</h2> 
  <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Down</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/a.htm"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cooperation</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ServletOutputStream out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ExcelWriter writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelWriter</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> ExcelTypeEnum<span class="token punctuation">.</span>XLSX<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String fileName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"UserInfo "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Sheet sheet1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sheet1<span class="token punctuation">.</span><span class="token function">setSheetName</span><span class="token punctuation">(</span><span class="token string">"第一个sheet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write0</span><span class="token punctuation">(</span><span class="token function">getListString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sheet1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"multipart/form-data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span><span class="token operator">+</span>fileName<span class="token operator">+</span><span class="token string">".xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
  <h2><a id="_345"></a>八、需要注意的点</h2> 
  <h3><a id="81__347"></a>8.1 写入大数据时，需分片</h3> 
  <p>比如说，我们需要从数据库中查询出数据量较大时，我们需要在业务层做分片处理，也就是，我们需要分多次查询，再写入，防止内存溢出 OOM.</p> 
  <h3><a id="82_Excel__351"></a>8.2 Excel 最大行数问题</h3> 
  <p>Excel 03, 07 版本均有行数、列数的限制：</p> 
  <table> 
   <thead> 
    <tr> 
     <th>版本</th> 
     <th>最大行</th> 
     <th>最大列</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td>Excel 2003</td> 
     <td>65536</td> 
     <td>256</td> 
    </tr> 
    <tr> 
     <td>Excel 2007</td> 
     <td>1048576</td> 
     <td>16384</td> 
    </tr> 
   </tbody> 
  </table>
  <blockquote> 
   <p>csv 由于是文本文件，实际上没有最大行数的限制，但是用 Excel 客户端打开还是多了不显示。</p> 
  </blockquote> 
  <p>也就是说，如果你想写入更多的行数是不行的，强行这么做，程序会报类似如下异常</p> 
  <pre><code>Invalid row number (1048576) outside allowable range (0..1048575)
</code></pre> 
  <p><strong>如何解决呢？</strong></p> 
  <ol> 
   <li>分多个 Excel 文件写入;</li> 
   <li>同一个 Excel 文件，分多个 Sheet 写入；</li> 
  </ol> 
  <h2><a id="_373"></a>九、总结</h2> 
  <p>小哈今天主要给小伙伴介绍了 EasyExcel, 为什么要使用它，以及演示了相关示例代码。当然了，EasyExcel 除了写 Excel 文件外，它还有快速读取 Excel 的功能，由于本文主要介绍的是：如何优雅地实现 Excel 文件生成，所以就没有介绍了，有兴趣的小伙伴们，也可以去 <a href="https://github.com/alibaba/easyexcel" rel="nofollow">GitHub 官网</a>去去查看相关文档。</p> 
  <p>最后，祝您看完本文后有所收获，下期见！</p> 
  <h2><a id="GitHub__379"></a>十、GitHub 源码地址</h2> 
  <p><a href="https://github.com/weiwosuoai/spring-boot-tutorial/tree/master/spring-boot-excel" rel="nofollow">https://github.com/weiwosuoai/spring-boot-tutorial/tree/master/spring-boot-excel</a></p> 
  <h2><a id="Ref_383"></a>十一、Ref</h2> 
  <p><a href="https://github.com/alibaba/easyexcel" rel="nofollow">https://github.com/alibaba/easyexcel</a></p> 
  <h2><a id="___387"></a>免费分享 | 面试&amp;学习福利资源</h2> 
  <p>最近在网上发现一个不错的 PDF 资源《Java 核心知识&amp;面试.pdf》分享给大家，不光是面试，学习，你都值得拥有！！！</p> 
  <p>获取方式: 关注公众号: <strong>小哈学Java</strong>, 后台回复<strong>资源</strong>，既可<strong>免费无套路获取资源链接</strong>，下面是目录以及部分截图：</p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651432676587" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651441280253" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651443805696" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651470347464" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651449186666" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155651451040055" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
  <p>重要的事情说两遍，关注公众号: <strong>小哈学Java</strong>, 后台回复<strong>资源</strong>，既可<strong>免费无套路获取资源链接</strong> ！！！</p> 
  <h2><a id="_Java_407"></a>欢迎关注微信公众号: 小哈学Java</h2> 
  <p><img src="https://exception-image-bucket.oss-cn-hangzhou.aliyuncs.com/155634562788477" alt="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦" title="关注微信公众号【小哈学Java】,回复【资源】，即可免费无套路领取资源链接哦"></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
