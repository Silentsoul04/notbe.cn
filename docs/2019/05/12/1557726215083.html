<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>04 机器学习算法之主成分分析PCA « NotBeCN</title>
  <meta name="description" content="                   机器学习算法之主成分分析PCA   目录:       1.PCA简介    2.PCA的实现    3.sklearn中的PCA进行降维    4.MNIST手写数字集    5.使用sklearn中的PCA进行去噪处理    6.人脸特征脸的提取      一、PCA简介...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/1557726215083.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">04 机器学习算法之主成分分析PCA</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h3><a id="PCA_1"></a>机器学习算法之主成分分析PCA</h3> 
  <p><strong>目录:</strong></p> 
  <ul> 
   <li>1.PCA简介</li> 
   <li>2.PCA的实现</li> 
   <li>3.sklearn中的PCA进行降维</li> 
   <li>4.MNIST手写数字集</li> 
   <li>5.使用sklearn中的PCA进行去噪处理</li> 
   <li>6.人脸特征脸的提取</li> 
  </ul> 
  <h3><a id="PCA_12"></a>一、PCA简介</h3> 
  <p>PCA(Principal Component Analysis)：也是一个梯度分析的应用，不仅是机器学习的算法，也是统计学的经典算法。</p> 
  <ul> 
   <li>一个非监督的机器学习算法</li> 
   <li>主要用于数据的降维</li> 
   <li>通过降维:可以发现更便于人类理解的特征</li> 
   <li>其他应用:可视化；去噪</li> 
  </ul> 
  <p><strong>1.小例子</strong></p> 
  <p>例如：下面的一个两个特征的训练集，现在我们想选择一个特征，扔掉另外一个特征</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/ibdlchypcy.png?imageView2/2/w/1620" width="500"> 
  <p>那么，我们给出分别扔掉特征一和特征而的两种方案，很明显右边这种的效果会更好一些，因为扔掉 特征2之后，点之间的分布情况更接近与原图，但这还不是更好的。</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/dxmwkghz3b.png?imageView2/2/w/1620" width="650"> 
  <p>我们希望的是，有一根直线，是斜着的，我们希望将所有的点都映射到这条直线上，那么这个时候我们就成功的将二维降到了一维，与此同时，这些点更加趋近与原来的点的分布情况。</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/d6ysy71i5j.png?imageView2/2/w/1620" width="500"> 
  <p><strong>2.方差</strong></p> 
  <ul> 
   <li>那么如何找到这个样本间间距最大的轴？</li> 
   <li>如何定义样本间间距？</li> 
  </ul> 
  <p>事实上有一个指标可以定义样本间的距离，就是方差（方差:描述样本整体之间的疏密的一个指标，方差越大，代表样本之间越稀疏，方差越小，代表样本之间越紧密）</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/w480kp16gt.png?imageView2/2/w/1620" width="280"> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/ar8pvezeyc.png?imageView2/2/w/1620" width="500"> 
  <p><strong>3.推导</strong></p> 
  <p><code>a.demean</code></p> 
  <p>将样例的均值归为0（归0：所有样本减去他们的均值），使得均值为0，这样可以简化方差的公式</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/uf6sezxecy.png?imageView2/2/w/1620" width="380"> 
  <p><code>b.映射</code></p> 
  <p>X(i)映射到w的距离实际上就是X(i)与w的点乘（蓝色的线），根据定义推导，其值实际上就是Xproject</p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/4810nsy5xd.png?imageView2/2/w/1620" width="600"> 
  <p><code>c.目标函数</code></p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/e70heamcm0.png?imageView2/2/w/1620" width="600"> 
  <p><strong>4.与线性回归的区别</strong></p> 
  <p><code>a.线性回归</code></p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/0aqct1edsp.png?imageView2/2/w/1620" width="600"> 
  <p><code>b.主成分分析</code></p> 
  <img src="https://ask.qcloudimg.com/http-save/yehe-3090887/ar8pvezeyc.png?imageView2/2/w/1620" width="600"> 
  <p><code>总之:</code></p> 
  <ul> 
   <li>主成分分析法的两个轴都是特征，线性回归y轴是目标结果值</li> 
   <li>主成分分析法的点事垂直于方差轴直线的，线性回归的点是垂直于x轴的</li> 
  </ul> 
  <h3><a id="PCA_80"></a>二、PCA的实现</h3> 
  <p><strong>1.高维数据向低维数据转换</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">demean</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">-</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">PCA</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>n_components<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""初始化PCA"""</span>
        <span class="token keyword">assert</span> n_components<span class="token operator">&gt;=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"n_components must be vaild"</span>
        self<span class="token punctuation">.</span>n_components <span class="token operator">=</span> n_components
        self<span class="token punctuation">.</span>components_ <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>X<span class="token punctuation">,</span>eta<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>n_iters<span class="token operator">=</span><span class="token number">1e4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获得数据集X的前n个元素"""</span>
        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>n_components<span class="token operator">&lt;=</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\
            <span class="token string">"n_components must be greater then the feature number of X"</span>
        <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">df</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> X<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">direction</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""计算单位向量"""</span>
            <span class="token keyword">return</span> w <span class="token operator">/</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>w<span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">first_componet</span><span class="token punctuation">(</span> X<span class="token punctuation">,</span>inital_w<span class="token punctuation">,</span>eta<span class="token punctuation">,</span>n_iters <span class="token operator">=</span> <span class="token number">1e4</span><span class="token punctuation">,</span>epsilon<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            w <span class="token operator">=</span> direction<span class="token punctuation">(</span>inital_w<span class="token punctuation">)</span>
            cur_iter <span class="token operator">=</span> <span class="token number">0</span>

            <span class="token keyword">while</span> cur_iter <span class="token operator">&lt;</span> n_iters<span class="token punctuation">:</span>
                gradient <span class="token operator">=</span> df<span class="token punctuation">(</span>w<span class="token punctuation">,</span>X<span class="token punctuation">)</span>
                last_w <span class="token operator">=</span> w
                w <span class="token operator">=</span> w <span class="token operator">+</span> eta <span class="token operator">*</span> gradient
                <span class="token comment"># 注意1：每次求单位向量</span>
                w <span class="token operator">=</span> direction<span class="token punctuation">(</span>w<span class="token punctuation">)</span> 
                <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span>w<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token operator">-</span>f<span class="token punctuation">(</span>last_w<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> epsilon<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>

                cur_iter <span class="token operator">=</span> cur_iter<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">return</span> w
        
        X_pca <span class="token operator">=</span> demean<span class="token punctuation">(</span>X<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>components_ <span class="token operator">=</span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>n_components<span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>n_components<span class="token punctuation">)</span><span class="token punctuation">:</span>
            initial_w <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span>X_pca<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            w <span class="token operator">=</span> first_componet<span class="token punctuation">(</span>X_pca<span class="token punctuation">,</span>initial_w<span class="token punctuation">,</span>eta<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>components_<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> w
            
            X_pca <span class="token operator">=</span> X_pca <span class="token operator">-</span> X_pca<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span>w
        <span class="token keyword">return</span> self
    
    
    <span class="token keyword">def</span> <span class="token function">transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将给定的X映射到各个主成分分量中"""</span>
        <span class="token keyword">assert</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>components_<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        
        <span class="token keyword">return</span> X<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>components_<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">inverse_transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将给定的X反映射会原来的特征空间"""</span>
        <span class="token keyword">assert</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>components_<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        
        <span class="token keyword">return</span> X<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>components_<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"PCA(n_components=%d)"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>n_components
</code></pre> 
  <p><strong>2.准备数据</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 100个数据，二维的特征</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.75</span> <span class="token operator">*</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre> 
  <p><strong>3.转为一维数据</strong></p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>PCA(n_components=1)
</code></pre> 
  <pre><code class="prism language-python">pca<span class="token punctuation">.</span>components_
</code></pre> 
  <pre><code>array([[0.75498921, 0.65573721]])
</code></pre> 
  <pre><code class="prism language-python">x_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">x_reduction<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(100, 1)
</code></pre> 
  <p><strong>4.维度恢复</strong></p> 
  <pre><code class="prism language-python">x_restore <span class="token operator">=</span> pca<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>x_reduction<span class="token punctuation">)</span>
x_restore<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(100, 2)
</code></pre> 
  <p><strong>5.展示图</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"b"</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_restore<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x_restore<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"r"</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>&lt;matplotlib.collections.PathCollection at 0x11c002b4c50&gt;
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145252165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h3><a id="sklearnPCA_251"></a>三、sklearn中的PCA进行降维</h3> 
  <p><strong>1.前期准备</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 加载数据集</span>
digits <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> digits<span class="token punctuation">.</span>data
y <span class="token operator">=</span> digits<span class="token punctuation">.</span>target
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 分割数据集</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
x_train<span class="token punctuation">,</span>x_test<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>x_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>y_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x_test<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>x_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y_test<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>(1347, 64) &lt;class 'numpy.ndarray'&gt;
(1347,) &lt;class 'numpy.ndarray'&gt;
(450, 64) &lt;class 'numpy.ndarray'&gt;
(450,) &lt;class 'numpy.ndarray'&gt;
</code></pre> 
  <p><strong>2.使用64个维度的数据集，训练KNN算法</strong></p> 
  <pre><code class="prism language-python"><span class="token operator">%</span><span class="token operator">%</span>time
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier

knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 19.9 ms
</code></pre> 
  <pre><code class="prism language-python">knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>0.9866666666666667
</code></pre> 
  <p><strong>3.使用PCA进行降维，训练KNN算法</strong></p> 
  <p><code>a.降到二维</code></p> 
  <pre><code class="prism language-python"><span class="token operator">%</span><span class="token operator">%</span>time 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>decomposition <span class="token keyword">import</span> PCA

pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_train_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 78.8 ms
</code></pre> 
  <pre><code class="prism language-python"><span class="token operator">%</span><span class="token operator">%</span>time
knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train_reduction<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 2 ms
</code></pre> 
  <pre><code class="prism language-python">knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test_reduction<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>0.6066666666666667
</code></pre> 
  <p><code>b.降维的指标</code></p> 
  <pre><code class="prism language-python">pca<span class="token punctuation">.</span>explained_variance_ratio_
</code></pre> 
  <pre><code>array([0.14566817, 0.13735469])
</code></pre> 
  <p>具体降到几维，提供了一个指标</p> 
  <p><strong>explained_variance_ratio_-解释方差的比例</strong></p> 
  <ul> 
   <li>0.14566817 代表第一个主成分可以解释14%的原数据</li> 
   <li>0.13735469 代表第二个主成分可以解释13%的原数据</li> 
  </ul> 
  <p>两个主成分加起来可以解释百分之27的原数据，而其他的信息丢失了</p> 
  <p>可以使用explained_variance_ratio_这个参数来查看每个主成分所解释的原数据，来判断要取多少个主成分</p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">(</span>x_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>PCA(copy=True, iterated_power='auto', n_components=64, random_state=None,
  svd_solver='auto', tol=0.0, whiten=False)
</code></pre> 
  <pre><code class="prism language-python">pca<span class="token punctuation">.</span>explained_variance_ratio_
</code></pre> 
  <pre><code>array([1.45668166e-01, 1.37354688e-01, 1.17777287e-01, 8.49968861e-02,
       5.86018996e-02, 5.11542945e-02, 4.26605279e-02, 3.60119663e-02,
       3.41105814e-02, 3.05407804e-02, 2.42337671e-02, 2.28700570e-02,
       1.80304649e-02, 1.79346003e-02, 1.45798298e-02, 1.42044841e-02,
       1.29961033e-02, 1.26617002e-02, 1.01728635e-02, 9.09314698e-03,
       8.85220461e-03, 7.73828332e-03, 7.60516219e-03, 7.11864860e-03,
       6.85977267e-03, 5.76411920e-03, 5.71688020e-03, 5.08255707e-03,
       4.89020776e-03, 4.34888085e-03, 3.72917505e-03, 3.57755036e-03,
       3.26989470e-03, 3.14917937e-03, 3.09269839e-03, 2.87619649e-03,
       2.50362666e-03, 2.25417403e-03, 2.20030857e-03, 1.98028746e-03,
       1.88195578e-03, 1.52769283e-03, 1.42823692e-03, 1.38003340e-03,
       1.17572392e-03, 1.07377463e-03, 9.55152460e-04, 9.00017642e-04,
       5.79162563e-04, 3.82793717e-04, 2.38328586e-04, 8.40132221e-05,
       5.60545588e-05, 5.48538930e-05, 1.08077650e-05, 4.01354717e-06,
       1.23186515e-06, 1.05783059e-06, 6.06659094e-07, 5.86686040e-07,
       1.71368535e-33, 7.44075955e-34, 7.44075955e-34, 7.15189459e-34])
</code></pre> 
  <pre><code class="prism language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>pca<span class="token punctuation">.</span>explained_variance_ratio_<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>[&lt;matplotlib.lines.Line2D at 0x11c01ad7cc0&gt;]
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145309674.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_train_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train_reduction<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test_reduction<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>0.9822222222222222
</code></pre> 
  <p><code>c.sklearn中的PCA算法支持传入一个小于1的数来表示我们希望能解释多少比例的主成分</code></p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span><span class="token number">0.95</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>PCA(copy=True, iterated_power='auto', n_components=0.95, random_state=None,
  svd_solver='auto', tol=0.0, whiten=False)
</code></pre> 
  <pre><code class="prism language-python">pca<span class="token punctuation">.</span>n_components_
</code></pre> 
  <pre><code>28
</code></pre> 
  <pre><code class="prism language-python">x_train_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token operator">%</span><span class="token operator">%</span>time
knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train_reduction<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 1.99 ms
</code></pre> 
  <pre><code class="prism language-python">knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test_reduction<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>0.98
</code></pre> 
  <p><code>d.便于可视化</code></p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_reduction<span class="token punctuation">[</span>y<span class="token operator">==</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x_reduction<span class="token punctuation">[</span>y<span class="token operator">==</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145319997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h3><a id="MNIST_534"></a>四、MNIST手写数字集</h3> 
  <p><strong>1.数据集的前期准备</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_mldata
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 手写数字集MNIST</span>
mnist <span class="token operator">=</span> fetch_mldata<span class="token punctuation">(</span><span class="token string">"MNIST original"</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>D:\software\Anaconda\workplace\lib\site-packages\sklearn\utils\deprecation.py:77: DeprecationWarning: Function fetch_mldata is deprecated; fetch_mldata was deprecated in version 0.20 and will be removed in version 0.22
  warnings.warn(msg, category=DeprecationWarning)
D:\software\Anaconda\workplace\lib\site-packages\sklearn\utils\deprecation.py:77: DeprecationWarning: Function mldata_filename is deprecated; mldata_filename was deprecated in version 0.20 and will be removed in version 0.22
  warnings.warn(msg, category=DeprecationWarning)
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 查看数据集MNIST</span>
mnist
</code></pre> 
  <pre><code>{'DESCR': 'mldata.org dataset: mnist-original',
 'COL_NAMES': ['label', 'data'],
 'target': array([0., 0., 0., ..., 9., 9., 9.]),
 'data': array([[0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        ...,
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0],
        [0, 0, 0, ..., 0, 0, 0]], dtype=uint8)}
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 数据集及标签 数据</span>
x<span class="token punctuation">,</span>y <span class="token operator">=</span> mnist<span class="token punctuation">.</span>data<span class="token punctuation">,</span>mnist<span class="token punctuation">.</span>target
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">%</span>matplotlib inline

idx <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Text(0.5, 1.0, '5')
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145329446.png" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 训练集和测试集</span>
x_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">60000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">60000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
x_test <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">60000</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
y_test <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">60000</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>x_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>y_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x_test<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>x_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y_test<span class="token punctuation">.</span>shape<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>(60000, 784) &lt;class 'numpy.ndarray'&gt;
(60000,) &lt;class 'numpy.ndarray'&gt;
(10000, 784) &lt;class 'numpy.ndarray'&gt;
(10000,) &lt;class 'numpy.ndarray'&gt;
</code></pre> 
  <p><strong>2.直接使用KNN</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">%</span>time knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 19.1 s





KNeighborsClassifier(algorithm='auto', leaf_size=30, metric='minkowski',
           metric_params=None, n_jobs=None, n_neighbors=5, p=2,
           weights='uniform')
</code></pre> 
  <pre><code class="prism language-python"><span class="token operator">%</span>time knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 12min 47s





0.9688
</code></pre> 
  <p><strong>3.使用PCA对MNIST数据集进行降维</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>decomposition <span class="token keyword">import</span> PCA

pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_train_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test_reduction <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">x_train<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(60000, 784)
</code></pre> 
  <pre><code class="prism language-python">x_train_reduction<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(60000, 87)
</code></pre> 
  <pre><code class="prism language-python">knn_clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">%</span>time knn_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train_reduction<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 441 ms





KNeighborsClassifier(algorithm='auto', leaf_size=30, metric='minkowski',
           metric_params=None, n_jobs=None, n_neighbors=5, p=2,
           weights='uniform')
</code></pre> 
  <pre><code class="prism language-python"><span class="token operator">%</span>time knn_clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test_reduction<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 1min 9s





0.9728
</code></pre> 
  <p><code>总结:</code>使用PCA进行降维后的数据集进行训练，不光时间变短了，准确度也变高了，这是因为在PC的过程中，不仅仅是进行了降维，还在降维的过程中将数据包含的噪音给消除了，这使得我们更加准确的拿到我们数据集对应的特征，从而使得准确率大大提高了。</p> 
  <h3><a id="sklearnPCA_736"></a>五、使用sklearn中的PCA进行去噪处理</h3> 
  <p><strong>1.数据集准备</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 数据集的导入</span>
digits <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> digits<span class="token punctuation">.</span>data
y <span class="token operator">=</span> digits<span class="token punctuation">.</span>target
</code></pre> 
  <p><strong>2.加入噪音</strong></p> 
  <pre><code class="prism language-python">noisy_digits <span class="token operator">=</span> x <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>size<span class="token operator">=</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">example_digits <span class="token operator">=</span> noisy_digits<span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x_num<span class="token operator">=</span>noisy_digits<span class="token punctuation">[</span>y<span class="token operator">==</span>num<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
    example_digits <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">[</span>example_digits<span class="token punctuation">,</span>x_num<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">example_digits<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(100, 64)
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 画出带噪音的图像</span>
<span class="token comment"># 画出带噪音的图像</span>
<span class="token keyword">def</span> <span class="token function">plot_digits</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig<span class="token punctuation">,</span>axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            subplot_kw<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'xticks'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'yticks'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    gridspec_kw<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>wspace<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axes<span class="token punctuation">.</span>flat<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  cmap<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">,</span>interpolation<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">,</span>clim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
plot_digits<span class="token punctuation">(</span>example_digits<span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145343793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p><strong>3.PCA去噪处理</strong></p> 
  <pre><code class="prism language-python">pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>noisy_digits<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>PCA(copy=True, iterated_power='auto', n_components=0.5, random_state=None,
  svd_solver='auto', tol=0.0, whiten=False)
</code></pre> 
  <pre><code class="prism language-python">pca<span class="token punctuation">.</span>n_components_
</code></pre> 
  <pre><code>12
</code></pre> 
  <pre><code class="prism language-python">components <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>noisy_digits<span class="token punctuation">)</span>
filtered_digits <span class="token operator">=</span> pca<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>components<span class="token punctuation">)</span>
plot_digits<span class="token punctuation">(</span>filtered_digits<span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019051214535216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p><code>总结:</code>PCA降低了维度，丢失了信息，同时也去除了一部分噪音</p> 
  <h3><a id="_841"></a>六、人脸特征脸</h3> 
  <p><strong>1.加载人脸数据库</strong></p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_lfw_people
</code></pre> 
  <pre><code class="prism language-python">faces <span class="token operator">=</span> fetch_lfw_people<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <p><strong>2.人脸数据集的探索</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># 人脸数据及特征</span>
faces<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(13233, 2914)
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 每一个样本都以一个二维平面可视化的角度展现出来</span>
faces<span class="token punctuation">.</span>images<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(13233, 62, 47)
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 随机获取36张人脸</span>
random_indexs <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>permutation<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> faces<span class="token punctuation">.</span>data<span class="token punctuation">[</span>random_indexs<span class="token punctuation">]</span>

example_faces <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
example_faces<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(36, 2914)
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">plot_faces</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig<span class="token punctuation">,</span>axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            subplot_kw<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'xticks'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'yticks'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    gridspec_kw<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>wspace<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axes<span class="token punctuation">.</span>flat<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'bone'</span><span class="token punctuation">)</span>
        
plot_faces<span class="token punctuation">(</span>example_faces<span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145401253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 每张人脸对应的人名</span>
faces<span class="token punctuation">.</span>target_names
</code></pre> 
  <pre><code>array(['AJ Cook', 'AJ Lamas', 'Aaron Eckhart', ..., 'Zumrati Juma',
       'Zurab Tsereteli', 'Zydrunas Ilgauskas'], dtype='&lt;U35')
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 说明一共包含5749个不同的人的脸</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">.</span>target_names<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>5749
</code></pre> 
  <p><strong>3.人脸特征脸的获取</strong></p> 
  <pre><code class="prism language-python"><span class="token operator">%</span><span class="token operator">%</span>time
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>decomposition <span class="token keyword">import</span> PCA

x<span class="token punctuation">,</span>y <span class="token operator">=</span> faces<span class="token punctuation">.</span>data<span class="token punctuation">,</span>faces<span class="token punctuation">.</span>target
<span class="token comment"># 使用随机的方式来求解出PCA</span>
<span class="token comment"># 没有指定n_componets,也就是说想求出所有的主成分</span>
pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>svd_solver<span class="token operator">=</span><span class="token string">"randomized"</span><span class="token punctuation">)</span>
pca<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Wall time: 23 s
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 一共2914个维度，所以求出了2194个主成分</span>
pca<span class="token punctuation">.</span>components_<span class="token punctuation">.</span>shape
</code></pre> 
  <pre><code>(2914, 2914)
</code></pre> 
  <pre><code class="prism language-python">plot_faces<span class="token punctuation">(</span>pca<span class="token punctuation">.</span>components_<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512145409668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01pbmRfcHJvZ3JhbW1vbmtleQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>通过求特征脸</p> 
  <ul> 
   <li>一方面我们可以方便直观的看出在人脸识别的过程中我们是怎么样看到每一张脸对应的特征的。</li> 
   <li>另一方面，也可以看出来，其实每一张脸都是这些人脸的一个线性组合，而特征脸依据重要程度顺序排列</li> 
  </ul> 
  <p>而由于fetch_lfw_people这个库的人脸的分布是不均匀的，有的人可能只有一张图片，有的人可能有几十张，通过下面的方法我们可以取出至少有60张人脸的数据</p> 
  <pre><code class="prism language-python">faces2 <span class="token operator">=</span> fetch_lfw_people<span class="token punctuation">(</span>min_faces_per_person<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">x<span class="token punctuation">,</span>y <span class="token operator">=</span> faces2<span class="token punctuation">.</span>data<span class="token punctuation">,</span>faces2<span class="token punctuation">.</span>target
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
  <pre><code>(1348, 2914)
(1348,)
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
