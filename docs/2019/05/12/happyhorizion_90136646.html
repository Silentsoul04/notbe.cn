<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>模型评估：评估矩阵和打分 « NotBeCN</title>
  <meta name="description" content="                        文章目录       目标优先    二分类问题的评价指标         第一类错误和第二类错误     非均匀数据集     混淆矩阵、正确率、精确率、召回率和f-score     不知道标签均匀性的情况     精度-召回曲线和ROC曲线          ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/happyhorizion_90136646.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">模型评估：评估矩阵和打分</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-github-gist"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p></p>
  <div class="toc">
   <h3>文章目录</h3>
   <ul>
    <li><a href="#_3" rel="nofollow">目标优先</a></li>
    <li><a href="#_8" rel="nofollow">二分类问题的评价指标</a></li>
    <ul>
     <li><a href="#_9" rel="nofollow">第一类错误和第二类错误</a></li>
     <li><a href="#_16" rel="nofollow">非均匀数据集</a></li>
     <li><a href="#fscore_66" rel="nofollow">混淆矩阵、正确率、精确率、召回率和f-score</a></li>
     <li><a href="#_130" rel="nofollow">不知道标签均匀性的情况</a></li>
     <li><a href="#ROC_156" rel="nofollow">精度-召回曲线和ROC曲线</a></li>
     <ul>
      <li><a href="#_precisionrecall_curve_157" rel="nofollow">精度-召回曲线（ precision-recall curve）</a></li>
      <li><a href="#ROCAUC_182" rel="nofollow">ROC和AUC</a></li>
     </ul>
    </ul>
   </ul>
  </div>
  <p></p> 
  <p>截至目前为止， 我们都一直都是用accuracy正确率来评价分类模型的表现，用<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msup>
          <mi>
           R
          </mi>
          <mn>
           2
          </mn>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         R^2
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8141079999999999em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141079999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>. 但是，这只是评价给定数据集合上监督学习模型性能的众多指标中的两个，在实际应用时，选择合适的评价矩阵来挑选合适的模型和参数非常重要。</p> 
  <h1><a id="_3"></a>目标优先</h1> 
  <p>首先需要谨记的是：应用机器学习的最终目标是什么。实际场景中，我们通常不仅仅关注于预测的正确率，很多时候这些预测值还是后续更重要决策过程的一部分。</p> 
  <p>在挑选机器学习评价矩阵之前，应该想一想应用上更高层次的目标，这个目标常被称为“商业矩阵”。 选择特定机器学习算法的结果被称为商业影响（business impact）。 这个更高级别的目标可能是避免交通事故，或者减少医疗事故，或者使得很多网民受益，等等。在选择模型或者调试参数的时候，应该选择那些在商业矩阵上最有正向影响力的。这往往比较难，因为评估特定模型的商业影响力需要将其放到实际生产环境中应用才能知道，或者说，需要对商业目标有更加深入的理解。</p> 
  <h1><a id="_8"></a>二分类问题的评价指标</h1> 
  <h2><a id="_9"></a>第一类错误和第二类错误</h2> 
  <p>二分类问题很常见，在二分类问题中，通常有两类：positive VS negative.</p> 
  <p>以病人诊断为例，对于任何一个诊断环节，阳性代表有病，阴性代表没病，在这个二分类问题中，我们首先关心的是，如何把所有阳性的病例筛出来，这是一个positive test问题，反之，如果我们关注的是阴性结果，就称为negative test。</p> 
  <p>有一种可能的错误就是误把健康人诊断为阳性，一个错误的阳性结果，就被称为假阳性FP，反之，错误的阴性结果称为假阴性FN。假阳性通常有被称为第一类错误（type I error）, 假阴性称为第二类错误（type II error）。</p> 
  <h2><a id="_16"></a>非均匀数据集</h2> 
  <p>错误类型的概念适用于那种一类数据非常常见，但是另一类数据非常罕见的情况。以疾病诊断为例，大多数检查的结果都是健康的，少数可能是患病的。或者网页广告推荐（或头条推送），通过记录用户的浏览情况给用户推荐内容，期待的结果是用户的点击行为，每个数据点展示的广告，标签/目标是用户是否发生了点击这个行为。 大多数广告都被“视而不见”了，只有少数广告会被点击，也就是说，点击这个标签的数据是非常少的，大多数，甚至可能是99%的标签都是不点击。在这种情况下，如果模型的预测全部都是“不点击”， 也可以得到99%的正确率，但这显然是由于数据本身的偏侧化造成的，这时候用正确率（accuracy）评价模型的性能也是不科学的。</p> 
  <p>我们来人为地模拟一个偏侧化的数据集，假设我们仅仅关心手写数字识别问题中对数字9的识别率（对应表现1），其他数字是否识别不关心（对应标签0）</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_digits 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
digits <span class="token operator">=</span> load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> digits<span class="token punctuation">.</span>target <span class="token operator">==</span> <span class="token number">9</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
digits<span class="token punctuation">.</span>data<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>dummy <span class="token keyword">import</span> DummyClassifier
dummy_majority <span class="token operator">=</span> DummyClassifier<span class="token punctuation">(</span>strategy<span class="token operator">=</span><span class="token string">'most_frequent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span> 
pred_most_frequent <span class="token operator">=</span> dummy_majority<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Unique predicted labels: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>pred_most_frequent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test score: {:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dummy_majority<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>Unique predicted labels: [False]
Test score: 0.90
</code></pre> 
  <p>正如预料的那样，由于数据集本身的不均衡性，即便是DummyClassifier也可以得到90%的正确率。如果用一个真实的机器学习模型，以决策树为例：</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
tree <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
pred_tree <span class="token operator">=</span> tree<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test score: {:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <blockquote> 
   <p>Test score: 0.92</p> 
  </blockquote> 
  <p>这里决策树给出的正确率并不比DummyClassifer高多少。换成LogisitcRegression模型，可以看到如果将DummyClassifier的strategy设置为默认，表现明显下降，同时LogisticRegression给出了非常好的结果。</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
dummy <span class="token operator">=</span> DummyClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment">#pred_dumy = dummy.predict(X_test)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dummy score: {:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dummy<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
logreg <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>C<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
pred_logreg <span class="token operator">=</span> logreg<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'logreg score: {:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>logreg<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
  <blockquote> 
   <p>dummy score: 0.83<br> logreg score: 0.98</p> 
  </blockquote> 
  <p>事实上，在非常不均衡的数据集上正确率却是不是一个很好的指标。</p> 
  <h2><a id="fscore_66"></a>混淆矩阵、正确率、精确率、召回率和f-score</h2> 
  <p>二分类问题中，混淆矩阵是一个非常好的模型评估工具。</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix
confusion <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pred_logreg<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Confusion matrix:\n{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>confusion<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <blockquote> 
   <p>Confusion matrix:<br> [[401 2]<br> [ 8 39]]</p> 
  </blockquote> 
  <p>混淆矩阵是一个两行两列的方阵， 行对应的是真实的分类，列对应的是预测的分类。也就是：</p> 
  <blockquote> 
   <p>[TN FP<br> FN TP]</p> 
  </blockquote> 
  <p>这里：<br> 401就是实际上不是9，预测也不是9的样本个数<br> 2就是实际上不是9，预测是9的样本个数<br> 8就是实际上是9，但是预测不是9的样本个数<br> 39是实际上是9，预测也是9的样本个数。</p> 
  <p>从混淆矩阵出发，再来看看正确率accuracy：<br> Accuracy被定义为预测正确的个数，其中包括了实际上是9预测是9的（TP）以及实际上不是9，预测也不是9的（TN）在所有样本中的占比，写为公式是：</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           A
          </mi>
          <mi>
           c
          </mi>
          <mi>
           c
          </mi>
          <mi>
           u
          </mi>
          <mi>
           r
          </mi>
          <mi>
           a
          </mi>
          <mi>
           c
          </mi>
          <mi>
           y
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             T
            </mi>
            <mi>
             N
            </mi>
           </mrow>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             T
            </mi>
            <mi>
             N
            </mi>
            <mo>
             +
            </mo>
            <mi>
             F
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             F
            </mi>
            <mi>
             N
            </mi>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
           Accuracy = \frac{TP+TN}{TP+TN+FP+FN}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8777699999999999em; vertical-align: -0.19444em;"></span><span class="mord mathit">A</span><span class="mord mathit">c</span><span class="mord mathit">c</span><span class="mord mathit">u</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 2.1296600000000003em; vertical-align: -0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693300000000001em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>Precision，精确度，是指所有positive的样本中有多少被正确地识别，precision也被称为阳性预测值（positive predictive value，PPV）</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mi>
           r
          </mi>
          <mi>
           e
          </mi>
          <mi>
           c
          </mi>
          <mi>
           i
          </mi>
          <mi>
           s
          </mi>
          <mi>
           i
          </mi>
          <mi>
           o
          </mi>
          <mi>
           n
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
           </mrow>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             F
            </mi>
            <mi>
             P
            </mi>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
           Precision = \frac{TP}{TP+FP}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 2.1296600000000003em; vertical-align: -0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693300000000001em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>Recall，召回率，是衡量对所有positive样本的辨别程度，或者说，是在所有判断为positive的样本中，有多少为真。recall也被称为灵敏度、点击率或者真阳性率。</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           R
          </mi>
          <mi>
           e
          </mi>
          <mi>
           c
          </mi>
          <mi>
           a
          </mi>
          <mi>
           l
          </mi>
          <mi>
           l
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
           </mrow>
           <mrow>
            <mi>
             T
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             F
            </mi>
            <mi>
             N
            </mi>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
           Recall = \frac{TP}{TP+FN}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 2.1296600000000003em; vertical-align: -0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693300000000001em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>在优化recall和precision之间必须要做个折中，如果将所有的样本都判别为真，就会引入很多的假阳性，从而Presition就必然很低，但是如果模型非常保守，只将最有可能为真的样本判断为真，Precision会非常高，但是Recall就很低了。</p> 
  <p>除此之外，还有f-score，是precision和recall的调和平均数：</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           F
          </mi>
          <mo>
           =
          </mo>
          <mn>
           2
          </mn>
          <mfrac>
           <mrow>
            <mi>
             p
            </mi>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mi>
             c
            </mi>
            <mi>
             i
            </mi>
            <mi>
             s
            </mi>
            <mi>
             i
            </mi>
            <mi>
             o
            </mi>
            <mi>
             n
            </mi>
            <mo>
             ∗
            </mo>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mi>
             c
            </mi>
            <mi>
             a
            </mi>
            <mi>
             l
            </mi>
            <mi>
             l
            </mi>
           </mrow>
           <mrow>
            <mi>
             p
            </mi>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mi>
             c
            </mi>
            <mi>
             i
            </mi>
            <mi>
             s
            </mi>
            <mi>
             i
            </mi>
            <mi>
             o
            </mi>
            <mi>
             n
            </mi>
            <mo>
             +
            </mo>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mi>
             c
            </mi>
            <mi>
             a
            </mi>
            <mi>
             l
            </mi>
            <mi>
             l
            </mi>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
           F = 2\frac{precision*recall}{precision+recall}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 2.25188em; vertical-align: -0.8804400000000001em;"></span><span class="mord">2</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714399999999998em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">p</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">p</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804400000000001em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>scikit learn的metrics.classification_report可以直接计算precision, recall和 f1-score，例如：</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pred_most_frequent<span class="token punctuation">,</span>
                           target_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"not nine"</span><span class="token punctuation">,</span> <span class="token string">"nine"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> pred_logreg<span class="token punctuation">,</span>
                           target_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"not nine"</span><span class="token punctuation">,</span> <span class="token string">"nine"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <blockquote> 
   <p>precision recall f1-score support<br> not nine 0.90 1.00 0.94 403<br> nine 0.00 0.00 0.00 47<br> avg / total 0.80 0.90 0.85 450</p> 
  </blockquote> 
  <blockquote> 
   <p>precision recall f1-score support<br> not nine 0.98 1.00 0.99 403<br> nine 0.95 0.83 0.89 47<br> avg / total 0.98 0.98 0.98 450</p> 
  </blockquote> 
  <h2><a id="_130"></a>不知道标签均匀性的情况</h2> 
  <p>有时候我们可能并不知道标签是否均匀，同时，模型内部对于目标函数和输出之间的处理也直接影响了但是在指定优化目标的同时，就已经损失了数据集合中的一些信息，这么说有些抽象，举个例子。</p> 
  <p>非均匀的二分类任务，400个点属于negative类，50个属于positive类，用rbf-kernel的SVM分类器分类后，得到classification_report. 这里较多的那一类标签为0， 较少的一类标签为1. 而且在这个问题中，我们关注的是模型判断为1的样本，实际上确实是1的这种情况，换句话说，就是模型的召回率。</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> mglearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_blobs
X<span class="token punctuation">,</span> y <span class="token operator">=</span> make_blobs<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                  centers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> 
                  cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
svc <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
mglearn<span class="token punctuation">.</span>plots<span class="token punctuation">.</span>plot_decistion_threshold<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <p>得到<img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512150801352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5aG9yaXppb24=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 在实际场景中这种情况比较常见，也就是我们模型需要特别关注的是二分类中比较少那一类，例如生产流水线质量检测，或者疾病检测，都是需要模型可以对少量的样本进行检测和识别。可以看出， 标签1的那一类召回率仅为0.67， 标签为0的略高，但是考虑到0这一类样本非常多，这个结果实际上差强人意。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512150703583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5aG9yaXppb24=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 由于我们希望1类的召回率尽可能高，也就是我们愿意冒一些假阳性的风险，换取更多的真阳性，使召回率高些。我们已知模型内部predict()函数将结果大于0的认为是0这一类，小于0是1，那么可以对svc.decision_function( ) 设置阈值调整模型预测的结果，例如：</p> 
  <pre><code class="prism language-python">y_pred_lower_threshold <span class="token operator">=</span> svc<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">0.8</span>
</code></pre> 
  <p>也可以设置模型的predict_proba方法的阈值，通常0.5代表模型有50%的把握认为样本属于positive类，通过调整这个阈值，也可以适当地调节模型对结果的预测性能。</p> 
  <h2><a id="ROC_156"></a>精度-召回曲线和ROC曲线</h2> 
  <h3><a id="_precisionrecall_curve_157"></a>精度-召回曲线（ precision-recall curve）</h3> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> precision_recall_curve precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> precision_recall_curve<span class="token punctuation">(</span>
        y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Use more data points for a smoother curve</span>
    X<span class="token punctuation">,</span> y <span class="token operator">=</span> make_blobs<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> centers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> cluster_std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
    X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    svc <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span><span class="token number">.05</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
    precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> precision_recall_curve<span class="token punctuation">(</span>
y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># find threshold closest to zero</span>
close_zero <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>thresholds<span class="token punctuation">)</span><span class="token punctuation">)</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>precision<span class="token punctuation">[</span>close_zero<span class="token punctuation">]</span><span class="token punctuation">,</span> recall<span class="token punctuation">[</span>close_zero<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
             label<span class="token operator">=</span><span class="token string">"threshold zero"</span><span class="token punctuation">,</span> fillstyle<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">,</span> mew<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"precision recall curve"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Precision"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Recall"</span><span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512152330200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5aG9yaXppb24=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h3><a id="ROCAUC_182"></a>ROC和AUC</h3> 
  <p>ROC曲线（receiver operating characteristics curve, ROC）考虑了给定分类器在所有可能的阈值下的表现， 但是和精度-召回曲线不同，ROC曲线给出的是假阳性率（false positive rate, FPR）VS真阳性率(true positive rate, TPR)，其中真阳性率的另一个名字就是召回率，假阳性率FPR就是在所有阴性的样本中模型判断为假阳性的比例， 公式为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           F
          </mi>
          <mi>
           P
          </mi>
          <mi>
           R
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             F
            </mi>
            <mi>
             P
            </mi>
           </mrow>
           <mrow>
            <mi>
             F
            </mi>
            <mi>
             P
            </mi>
            <mo>
             +
            </mo>
            <mi>
             T
            </mi>
            <mi>
             N
            </mi>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
          FPR=\frac{FP}{FP+TN}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 2.1296600000000003em; vertical-align: -0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.10903em;">N</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693300000000001em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>ROC曲线可以用sklearn.metrics的roc_curve( )函数计算，例如：</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve
fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>decisition_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'ROC_curve'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'FPR'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'TPR (recall)'</span><span class="token punctuation">)</span>
<span class="token comment"># find threshold closest to zero</span>
close_zero <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>thresholds<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">[</span>close_zero<span class="token punctuation">]</span><span class="token punctuation">,</span> tpr<span class="token punctuation">[</span>close_zero<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'threshold zero'</span><span class="token punctuation">,</span> fillstyle<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">,</span> mew<span class="token operator">=</span><span class="token number">2</span>
        <span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
  <p>对于ROC曲线，理想状态是越接近左侧顶部越好，也就是在召回率较高的同时保持一个比较低的FPR水平。</p> 
  <p>AUC, Area Under the Curve, 是ROC曲线下的面积， 下面的例子说明了AUC对于非均匀数据集分类问题的作用。</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_digits 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
digits <span class="token operator">=</span> load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> digits<span class="token punctuation">.</span>target <span class="token operator">==</span> <span class="token number">9</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
digits<span class="token punctuation">.</span>data<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
digits<span class="token punctuation">.</span>data<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_auc_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">for</span> gamma <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    svc <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span>gamma<span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
    accuracy <span class="token operator">=</span> svc<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
    auc <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> svc<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'gamma = {:.2f} accuracy = {:.2f} AUC = {:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            gamma<span class="token punctuation">,</span> accuracy<span class="token punctuation">,</span> auc<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"gamma={:.3f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>gamma<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"FPR"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"TPR"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.02</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code>gamma = 1.00 accuracy = 0.90  AUC = 0.50
gamma = 0.15 accuracy = 0.90  AUC = 0.79
gamma = 0.01 accuracy = 0.90  AUC = 1.00
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512063955286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5aG9yaXppb24=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>在这个例子中，gamma的取值变化时，accuracy没有变，始终都是90%，但是AUC指标大不相同。显然，对于非均匀数据，AUC是个更好的指标。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
