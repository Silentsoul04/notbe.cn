<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>阿里巴巴java开发规范学习 « NotBeCN</title>
  <meta name="description" content="          目录   一、编程规约   1.1&nbsp;命名风格   1.2&nbsp;常量定义   1.3&nbsp;代码格式   ​1.4&nbsp;OOP规约   1.5 集合处理   二、异常   三、MYSQL数据库   3.1 建表规约   3.2 索引规约   3.3 SQL语句     ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/m0_38001814_90137114.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">阿里巴巴java开发规范学习</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <p id="main-toc"><strong>目录</strong></p> 
  <p id="%E4%B8%80%E3%80%81%E7%BC%96%E7%A8%8B%E8%A7%84%E7%BA%A6-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E7%BC%96%E7%A8%8B%E8%A7%84%E7%BA%A6" rel="nofollow">一、编程规约</a></p> 
  <p id="1.1%C2%A0%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC-toc" style="margin-left:80px;"><a href="#1.1%C2%A0%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC" rel="nofollow">1.1&nbsp;命名风格</a></p> 
  <p id="1.2%C2%A0%E5%B8%B8%E9%87%8F%E5%AE%9A%E4%B9%89-toc" style="margin-left:80px;"><a href="#1.2%C2%A0%E5%B8%B8%E9%87%8F%E5%AE%9A%E4%B9%89" rel="nofollow">1.2&nbsp;常量定义</a></p> 
  <p id="1.3%C2%A0%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F-toc" style="margin-left:80px;"><a href="#1.3%C2%A0%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F" rel="nofollow">1.3&nbsp;代码格式</a></p> 
  <p id="%E2%80%8B1.4%C2%A0OOP%E8%A7%84%E7%BA%A6-toc" style="margin-left:80px;"><a href="#%E2%80%8B1.4%C2%A0OOP%E8%A7%84%E7%BA%A6" rel="nofollow">​1.4&nbsp;OOP规约</a></p> 
  <p id="1.5%20%E9%9B%86%E5%90%88%E5%A4%84%E7%90%86-toc" style="margin-left:80px;"><a href="#1.5%20%E9%9B%86%E5%90%88%E5%A4%84%E7%90%86" rel="nofollow">1.5 集合处理</a></p> 
  <p id="%E4%BA%8C%E3%80%81%E5%BC%82%E5%B8%B8-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E5%BC%82%E5%B8%B8" rel="nofollow">二、异常</a></p> 
  <p id="%E4%B8%89%E3%80%81MYSQL%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81MYSQL%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">三、MYSQL数据库</a></p> 
  <p id="3.1%20%E5%BB%BA%E8%A1%A8%E8%A7%84%E7%BA%A6-toc" style="margin-left:80px;"><a href="#3.1%20%E5%BB%BA%E8%A1%A8%E8%A7%84%E7%BA%A6" rel="nofollow">3.1 建表规约</a></p> 
  <p id="3.2%20%E7%B4%A2%E5%BC%95%E8%A7%84%E7%BA%A6-toc" style="margin-left:80px;"><a href="#3.2%20%E7%B4%A2%E5%BC%95%E8%A7%84%E7%BA%A6" rel="nofollow">3.2 索引规约</a></p> 
  <p id="3.3%20SQL%E8%AF%AD%E5%8F%A5-toc" style="margin-left:80px;"><a href="#3.3%20SQL%E8%AF%AD%E5%8F%A5" rel="nofollow">3.3 SQL语句</a></p> 
  <hr id="hr-toc">
  <p>最近回顾了下一个多月前写的新项目，发现很多地方总感觉不太规范，从代码到数据库等，因此从网上下载了这份阿里巴巴java开发规范，学习记录下。</p> 
  <p>完整版手册下载地址：<a href="https://102.alibaba.com/downloadFile.do?file=1528269849853/Java_manual.pdf" rel="nofollow">https://102.alibaba.com/downloadFile.do?file=1528269849853/Java_manual.pdf</a></p> 
  <p>本文会记录一些从中摘取的内容。</p> 
  <h2 id="%E4%B8%80%E3%80%81%E7%BC%96%E7%A8%8B%E8%A7%84%E7%BA%A6">一、编程规约</h2> 
  <h3 id="1.1%C2%A0%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC">1.1&nbsp;命名风格</h3> 
  <p>1、【强制】常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。&nbsp;<br> 正例:MAX_STOCK_COUNT<br> 反例:MAX_COUNT</p> 
  <p>2、【强制】抽象类命名使用 Abstract 或 Base 开头;异常类命名使用 Exception 结尾;测试类 命名以它要测试的类的名称开始，以 Test 结尾。</p> 
  <p>3、【强制】类型与中括号紧挨相连来表示数组。&nbsp;<br> 正例:定义整形数组 int[] arrayDemo;<br> 反例:在 main 参数中，使用 String args[]来定义。</p> 
  <p>4、【强制】POJO 类中布尔类型的变量，都不要加 is 前缀，否则部分框架解析会引起序列化错误。 反例:定义为基本数据类型Boolean isDeleted的属性，它的方法也是isDeleted()，RPC<br> 框架在反向解析的时候，“误以为”对应的属性名称是 deleted，导致属性获取不到，进而抛<br> 出异常。</p> 
  <p>5、【强制】包名统一使用小写，点分隔符之间有且仅有一个自然语义的英语单词。包名统一使用 单数形式，但是类名如果有复数含义，类名可以使用复数形式。<br> 正例:应用工具类包名为 com.alibaba.ai.util、类名为 MessageUtils(此规则参考 spring 的框架结构)</p> 
  <p>6、【推荐】接口类中的方法和属性不要加任何修饰符号(public 也不要加)，保持代码的简洁 性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，肯定是 与接口方法相关，并且是整个应用的基础常量。<br> 正例:接口方法签名void commit();<br> 接口基础常量String COMPANY = "alibaba";<br> 反例:接口方法定义public abstract void f();<br> 说明:JDK8 中接口允许有默认实现，那么这个 default 方法，是对所有实现类都有价值的默 认实现。</p> 
  <p>7、【参考】枚举类名建议带上 Enum 后缀，枚举成员名称需要全大写，单词间用下划线隔开。<br> 说明:枚举其实就是特殊的类，域成员均为常量，且构造方法被默认强制是私有。 正例:枚举名字为ProcessStatusEnum的成员名称:SUCCESS / UNKNOWN_REASON。</p> 
  <p>8、【参考】各层命名规约:<br> A) Service/DAO层方法命名规约<br> 1) 获取单个对象的方法用get做前缀。<br> 2) 获取多个对象的方法用list做前缀，复数形式结尾如:listObjects。 3) 获取统计值的方法用count做前缀。<br> 4) 插入的方法用save/insert做前缀。<br> 5) 删除的方法用remove/delete做前缀。<br> 6) 修改的方法用update做前缀。<br> B) 领域模型命名规约<br> 1) 数据对象:xxxDO，xxx即为数据表名。<br> 2) 数据传输对象:xxxDTO，xxx为业务领域相关的名称。 3) 展示对象:xxxVO，xxx一般为网页名称。<br> 4) POJO是DO/DTO/BO/VO的统称，禁止命名成xxxPOJO。</p> 
  <h3 id="1.2%C2%A0%E5%B8%B8%E9%87%8F%E5%AE%9A%E4%B9%89">1.2&nbsp;常量定义</h3> 
  <p>1、【强制】在 long 或者 Long 赋值时，数值后使用大写的 L，不能是小写的 l，小写容易跟数字 1 混淆，造成误解。<br> 说明:Long a = 2l; 写的是数字的21，还是Long型的2?</p> 
  <h3 id="1.3%C2%A0%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F">1.3&nbsp;代码格式</h3> 
  <p>1、【强制】单行字符数限制不超过 120 个，超出需要换行，换行时遵循如下原则: 1) 第二行相对第一行缩进 4 个空格，从第三行开始，不再继续缩进，参考示例。<br> 2) 运算符与下文一起换行。<br> 3) 方法调用的点符号与下文一起换行。<br> 4) 方法调用中的多个参数需要换行时，在逗号后进行。&nbsp;<br> 5) 在括号前不要换行，见反例。<br> 正例:<br><img alt="" class="has" height="159" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512102242991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDAxODE0,size_16,color_FFFFFF,t_70" width="600"></p> 
  <p>反例:</p> 
  <p><img alt="" class="has" height="222" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512102304401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDAxODE0,size_16,color_FFFFFF,t_70" width="600"></p> 
  <p>2、【推荐】不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。 说明:任何情形，没有必要插入多个空行进行隔开。</p> 
  <p>3、【强制】采用 4 个空格缩进，禁止使用 tab 字符。<br> 说明:如果使用 tab 缩进，必须设置 1 个 tab 为 4 个空格。IDEA 设置 tab 为 4 个空格时， 请勿勾选Use tab character;而在 eclipse 中，必须勾选insert spaces for tabs</p> 
  <p>正例：</p> 
  <h3 id="%E2%80%8B1.4%C2%A0OOP%E8%A7%84%E7%BA%A6"><img alt="" class="has" height="437" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512102523866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDAxODE0,size_16,color_FFFFFF,t_70" width="600"><br> 1.4&nbsp;OOP规约</h3> 
  <p>1、【强制】外部正在调用或者二方库依赖的接口，不允许修改方法签名，避免对接口调用方产生 影响。接口过时必须加@Deprecated 注解，并清晰地说明采用的新接口或者新服务是什么。</p> 
  <p>2、【强制】POJO 类必须写 toString 方法。使用 IDE 中的工具:source&gt; generate toString 时，如果继承了另一个 POJO 类，注意在前面加一下 super.toString。&nbsp;<br> 说明:在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排查问题。</p> 
  <p>3、【推荐】 类内方法定义的顺序依次是:公有方法或保护方法 &gt; 私有方法 &gt; getter/setter 方法。<br> 说明:公有方法是类的调用者和维护者最关心的方法，首屏展示最好;保护方法虽然只是子类 关心，也可能是“模板设计模式”下的核心方法;而私有方法外部一般不需要特别关心，是一个 黑盒实现;因为承载的信息价值较低，所有 Service 和 DAO 的 getter/setter 方法放在类体 最后。</p> 
  <p>4、【推荐】循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。 说明:下例中，反编译出的字节码文件显示每次循环都会 new 出一个 StringBuilder 对象， 然后进行 append 操作，最后通过 toString 方法返回 String 对象，造成内存资源浪费。 反例:<br> String str = "start";<br> for (int i = 0; i &lt; 100; i++) {<br> str = str + "hello"; }</p> 
  <p>5、【推荐】final 可以声明类、成员变量、方法、以及本地变量，下列情况使用 final 关键字: 1) 不允许被继承的类，如:String 类。<br> 2) 不允许修改引用的域对象。<br> 3) 不允许被重写的方法，如:POJO 类的 setter 方法。<br> 4) 不允许运行过程中重新赋值的局部变量。<br> 5) 避免上下文重复使用一个变量，使用 final 描述可以强制重新定义一个变量，方便更好 地进行重构。</p> 
  <h3 id="1.5%20%E9%9B%86%E5%90%88%E5%A4%84%E7%90%86">1.5 集合处理</h3> 
  <p>1、【强制】ArrayList的subList结果不可强转成ArrayList，否则会抛出ClassCastException 异常，即java.util.RandomAccessSubList cannot be cast to java.util.ArrayList。 说明:subList 返回的是 ArrayList 的内部类 SubList，并不是 ArrayList 而是 ArrayList 的一个视图，对于 SubList 子列表的所有操作最终会反映到原列表上。</p> 
  <p>2、【强制】使用集合转数组的方法，必须使用集合的toArray(T[] array)，传入的是类型完全<br> 一样的数组，大小就是 list.size()。<br> 说明:使用 toArray 带参方法，入参分配的数组空间不够大时，toArray 方法内部将重新分配<br> 内存空间，并返回新数组地址;如果数组元素个数大于实际所需，下标为[ list.size() ]<br> 的数组元素将被置为 null，其它数组元素保持原值，因此最好将方法入参数组大小定义与集<br> 合元素个数一致。<br> 正例:<br> List&lt;String&gt; list = new ArrayList&lt;String&gt;(2); list.add("guan");<br> list.add("bao");<br> String[] array = new String[list.size()]; array = list.toArray(array);</p> 
  <p><br> 3、【强制】使用工具类 Arrays.asList()把数组转换成集合时，不能使用其修改集合相关的方 法，它的 add/remove/clear 方法会抛出 UnsupportedOperationException 异常。 说明:asList 的返回对象是一个 Arrays 内部类，并没有实现集合的修改方法。Arrays.asList 体现的是适配器模式，只是转换接口，后台的数据仍是数组。<br> &nbsp; &nbsp; &nbsp; &nbsp;String[] str = new String[] { "you", "wu" };<br> List list = Arrays.asList(str); 第一种情况:list.add("yangguanbao"); 运行时异常。 第二种情况:str[0] = "gujin"; 那么list.get(0)也会随之修改。</p> 
  <p>4、【强制】 在 JDK7 版本及以上，Comparator 实现类要满足如下三个条件，不然 Arrays.sort， Collections.sort 会报 IllegalArgumentException 异常。<br> 说明:三个条件如下<br> 1) x，y的比较结果和y，x的比较结果相反。<br> 2) x&gt;y，y&gt;z，则x&gt;z。<br> 3) x=y，则x，z比较结果和y，z比较结果相同。<br> &nbsp;反例:下例中没有处理相等的情况，实际使用中可能会出现异常:<br> new Comparator&lt;Student&gt;() {<br> @Override<br> public int compare(Student o1, Student o2) {<br> return o1.getId() &gt; o2.getId() ? 1 : -1; }<br> };</p> 
  <p>5、【参考】利用 Set 元素唯一的特性，可以快速对一个集合进行去重操作，避免使用 List 的 contains 方法进行遍历、对比、去重操作。</p> 
  <p>&nbsp;</p> 
  <h2 id="%E4%BA%8C%E3%80%81%E5%BC%82%E5%B8%B8">二、异常</h2> 
  <p>1、【推荐】防止 NPE，是程序员的基本修养，注意 NPE 产生的场景: 1)返回类型为基本数据类型，return 包装数据类型的对象时，自动拆箱有可能产生 NPE。<br> 反例:public int f() { return Integer 对象}， 如果为 null，自动解箱抛 NPE。<br> 2) 数据库的查询结果可能为null。<br> 3) 集合里的元素即使isNotEmpty，取出的数据元素也可能为null。<br> 4) 远程调用返回对象时，一律要求进行空指针判断，防止NPE。<br> 5) 对于Session中获取的数据，建议NPE检查，避免空指针。<br> 6) 级联调用obj.getA().getB().getC();一连串调用，易产生NPE。<br> 正例:使用 JDK8 的 Optional 类来防止 NPE 问题。</p> 
  <p>&nbsp;</p> 
  <h2 id="%E4%B8%89%E3%80%81MYSQL%E6%95%B0%E6%8D%AE%E5%BA%93">三、MYSQL数据库</h2> 
  <p>这也是我来寻找这篇规范的最初目的...</p> 
  <h3 id="3.1%20%E5%BB%BA%E8%A1%A8%E8%A7%84%E7%BA%A6">3.1 建表规约</h3> 
  <p>1. 【强制】表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint (1 表示是，0 表示否)。<br> 说明:任何字段如果为非负数，必须是 unsigned。<br> 注意:POJO 类中的任何布尔类型的变量，都不要加 is 前缀，所以，需要在&lt;resultMap&gt;设置 从 is_xxx 到 Xxx 的映射关系。数据库表示是与否的值，使用 tinyint 类型，坚持 is_xxx 的 命名方式是为了明确其取值含义与取值范围。<br> 正例:表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。</p> 
  <p><br> 2. 【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只 出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。 说明:MySQL 在 Windows 下不区分大小写，但在 Linux 下默认是区分大小写。因此，数据库名、 表名、字段名，都不允许出现任何大写字母，避免节外生枝。 正例:aliyun_admin，rdc_config，level3_name 反例:AliyunAdmin，rdcConfig，level_3_name</p> 
  <p><br> 3. 【强制】表名不使用复数名词。 说明:表名应该仅仅表示表里面的实体内容，不应该表示实体数量，对应于 DO 类名也是单数 形式，符合表达习惯。</p> 
  <p><br> 4. 【强制】禁用保留字，如 desc、range、match、delayed 等，请参考 MySQL 官方保留字。</p> 
  <p><br> 5. 【强制】主键索引名为 pk_字段名;唯一索引名为 uk_字段名;普通索引名则为 idx_字段名。<br> 说明:pk_ 即 primary key;uk_ 即 unique key;idx_ 即 index 的简称。</p> 
  <p><br> 6. 【强制】小数类型为 decimal，禁止使用 float 和 double。<br> 说明:float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不 正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。</p> 
  <p><br> 7. 【强制】如果存储的字符串长度几乎相等，使用 char 定长字符串类型。</p> 
  <p><br> 8. 【强制】varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长 度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。</p> 
  <p><br> 9. 【强制】表必备三字段:id, gmt_create, gmt_modified。 说明:其中id必为主键，类型为bigint unsigned、单表时自增、步长为1。gmt_create, gmt_modified 的类型均为 datetime 类型，前者现在时表示主动创建，后者过去分词表示被 动更新。</p> 
  <p><br> 10. 【推荐】表的命名最好是加上“业务名称_表的作用”。<br> 正例:alipay_task / force_project / trade_config</p> 
  <p><br> 11. 【推荐】库名与应用名称尽量一致。</p> 
  <p><br> 12. 【推荐】如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。</p> 
  <p><br> 13. 【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循: 1)不是频繁修改的字段。<br> 2)不是 varchar 超长字段，更不能是 text 字段。<br> 正例:商品类目名称使用频率高，字段长度短，名称基本一成不变，可在相关联的表中冗余存 储类目名称，避免关联查询。</p> 
  <p><br> 14. 【推荐】单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。 说明:如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</p> 
  <p><br> 15. 【参考】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检 索速度。<br> 正例:如下表，其中无符号值可以避免误存负数，且扩大了表示范围。</p> 
  <table>
   <tbody>
    <tr>
     <td>&nbsp;</td> 
     <td> <p>对象</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>年龄区间</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>类型</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>字节</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>表示范围</p> </td> 
     <td>&nbsp;</td> 
    </tr>
    <tr>
     <td>&nbsp;</td> 
     <td> <p>人</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>150 岁之内</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>tinyint unsigned</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>1</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>无符号值:0 到 255</p> </td> 
     <td>&nbsp;</td> 
    </tr>
    <tr>
     <td>&nbsp;</td> 
     <td> <p>龟</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>数百岁</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>smallint unsigned</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>2</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>无符号值:0 到 65535</p> </td> 
     <td>&nbsp;</td> 
    </tr>
    <tr>
     <td>&nbsp;</td> 
     <td> <p>恐龙化石</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>数千万年</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>int unsigned</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>4</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>无符号值:0 到约 42.9 亿</p> </td> 
     <td>&nbsp;</td> 
    </tr>
    <tr>
     <td>&nbsp;</td> 
     <td> <p>太阳</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>约 50 亿年</p> </td> 
     <td>&nbsp;</td> 
     <td>&nbsp;</td> 
     <td> <p>bigint unsigned</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>8</p> </td> 
     <td>&nbsp;</td> 
     <td> <p>无符号值:0 到约 10 的 19 次方</p> </td> 
     <td>&nbsp;</td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <h3 id="3.2%20%E7%B4%A2%E5%BC%95%E8%A7%84%E7%BA%A6">3.2 索引规约</h3> 
  <p>1. 【强制】业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。 说明:不要以为唯一索引影响了 insert 速度，这个速度损耗可以忽略，但提高查找速度是明 显的;另外，即使在应用层做了非常完善的校验控制，只要没有唯一索引，根据墨菲定律，必 然有脏数据产生。</p> 
  <p><br> 2. 【强制】超过三个表禁止 join。需要 join 的字段，数据类型必须绝对一致;多表关联查询时， 保证被关联的字段需要有索引。<br> 说明:即使双表 join 也要注意表索引、SQL 性能。</p> 
  <p><br> 3. 【强制】在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据 实际文本区分度决定索引长度即可。<br> 说明:索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分<br> 度会高达 90%以上，可以使用 count(distinct left(列名, 索引长度))/count(*)的区分度 来确定。</p> 
  <p><br> 4. 【强制】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。 说明:索引文件具有 B-Tree 的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索 引。</p> 
  <p><br> 5. 【推荐】如果有 order by 的场景，请注意利用索引的有序性。order by 最后的字段是组合 索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。 正例:where a=? and b=? order by c; 索引:a_b_c 反例:索引中有范围查找，那么索引有序性无法利用，如:WHERE a&gt;10 ORDER BY b; 索引 a_b 无法排序。</p> 
  <p><br> 6. 【推荐】利用覆盖索引来进行查询操作，避免回表。<br> 说明:如果一本书需要知道第 11 章是什么标题，会翻开第 11 章对应的那一页吗?目录浏览 一下就好，这个目录就是起到覆盖索引的作用。 正例:能够建立索引的种类分为主键索引、唯一索引、普通索引三种，而覆盖索引只是一种查 询的一种效果，用explain的结果，extra列会出现:using index。</p> 
  <p><br> 7. 【推荐】利用延迟关联或者子查询优化超多分页场景。<br> 说明:MySQL 并不是跳过 offset 行，而是取 offset+N 行，然后返回放弃前 offset 行，返回 N 行，那当 offset 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过 特定阈值的页数进行 SQL 改写。<br> 正例:先快速定位需要获取的 id 段，然后再关联:<br> SELECT a.* FROM 表 1 a, (select id from 表 1 where 条件 LIMIT 100000,20 ) b where a.id=b.id</p> 
  <p><br> 8. 【推荐】SQL 性能优化的目标:至少要达到 range 级别，要求是 ref 级别，如果可以是 consts 最好。<br> 说明:<br> 1)consts 单表中最多只有一个匹配行(主键或者唯一索引)，在优化阶段即可读取到数据。 2)ref 指的是使用普通的索引(normal index)。<br> 3)range 对索引进行范围检索。<br> 反例:explain 表的结果，type=index，索引物理文件全扫描，速度非常慢，这个 index 级 别比较 range 还低，与全表扫描是小巫见大巫。</p> 
  <p><br> 9. 【推荐】建组合索引的时候，区分度最高的在最左边。<br> 正例:如果 where a=? and b=? ，如果 a 列的几乎接近于唯一值，那么只需要单建 idx_a 索引即可。 说明:存在非等号和等号混合时，在建索引时，请把等号条件的列前置。如:where c&gt;? and d=? 那么即使 c 的区分度更高，也必须把 d 放在索引的最前列，即索引 idx_d_c。</p> 
  <p><br> 10. 【推荐】防止因字段类型不同造成的隐式转换，导致索引失效。</p> 
  <p><br> 11. 【参考】创建索引时避免有如下极端误解: 1)宁滥勿缺。认为一个查询就需要建一个索引。 2)宁缺勿滥。认为索引会消耗空间、严重拖慢更新和新增速度。 3)抵制惟一索引。认为业务的惟一性一律需要在应用层通过“先查后插”方式解决。</p> 
  <p>&nbsp;</p> 
  <h3 id="3.3%20SQL%E8%AF%AD%E5%8F%A5">3.3 SQL语句</h3> 
  <p>1. 【强制】不要使用 count(列名)或 count(常量)来替代 count(*)，count(*)是 SQL92 定义的 标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。 说明:count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</p> 
  <p><br> 2. 【强制】count(distinct col) 计算该列除 NULL 之外的不重复行数，注意 count(distinct col1, col2) 如果其中一列全为NULL，那么即使另一列有不同的值，也返回为0。</p> 
  <p><br> 3. 【强制】当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为 NULL，因此使用 sum()时需注意 NPE 问题。 正例:可以使用如下方式来避免sum的NPE问题:SELECT IF(ISNULL(SUM(g)),0,SUM(g)) FROM table;</p> 
  <p><br> 4. 【强制】使用 ISNULL()来判断是否为 NULL 值。 说明:NULL 与任何值的直接比较都为 NULL。<br> 1) NULL&lt;&gt;NULL的返回结果是NULL，而不是false。 2) NULL=NULL的返回结果是NULL，而不是true。 3) NULL&lt;&gt;1的返回结果是NULL，而不是true。</p> 
  <p><br> 5. 【强制】 在代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句。</p> 
  <p><br> 6. 【强制】不得使用外键与级联，一切外键概念必须在应用层解决。 说明:以学生和成绩的关系为例，学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为 级联更新。外键与级联更新适用于单机低并发，不适合分布式、高并发集群;级联更新是强阻 塞，存在数据库更新风暴的风险;外键影响数据库的插入速度。</p> 
  <p><br> 7. 【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</p> 
  <p><br> 8. 【强制】数据订正(特别是删除、修改记录操作)时，要先 select，避免出现误删除，确认无误才能执行更新语句。</p> 
  <p><br> 9. 【推荐】in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控 制在 1000 个之内。</p> 
  <p><br> 10. 【参考】如果有国际化需要，所有的字符存储与表示，均以 utf-8 编码，注意字符统计函数<br> 的区别。<br> 说明:<br> SELECT LENGTH("轻松工作"); 返回为12<br> SELECT CHARACTER_LENGTH("轻松工作"); 返回为4 如果需要存储表情，那么选择 utf8mb4 来进行存储，注意它与 utf-8 编码的区别。</p> 
  <p><br> 11. 【参考】TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但 TRUNCATE 无事务且不触发 trigger，有可能造成事故，故不建议在开发代码中使用此语句。 说明:TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。</p> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
