<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>java连接MongoDB « NotBeCN</title>
  <meta name="description" content="         &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java连接MongoDB   5.1查询文档   5.1.1查询全部记录   （1）创建maven...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/qq_28524127_90137421.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">java连接MongoDB</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <h1 style="margin-left:21.25pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; java连接MongoDB</h1> 
  <h2 style="margin-left:49.6pt;">5.1查询文档</h2> 
  <h3 style="margin-left:70.9pt;">5.1.1查询全部记录</h3> 
  <p style="margin-left:0cm;">（1）创建maven工程mongoDBDemo ，引入依赖。</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;">&nbsp; <span style="color:#008080;">&lt;</span><span style="color:#3f7f7f;">dependencies</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <span style="color:#008080;">&lt;</span><span style="color:#3f7f7f;">dependency</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#008080;">&lt;</span><span style="color:#3f7f7f;">groupId</span><span style="color:#008080;">&gt;</span><span style="color:#000000;">org.mongodb</span><span style="color:#008080;">&lt;/</span><span style="color:#3f7f7f;">groupId</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#008080;">&lt;</span><span style="color:#3f7f7f;">artifactId</span><span style="color:#008080;">&gt;</span><u><span style="color:#000000;">mongodb</span></u><span style="color:#000000;">-driver</span><span style="color:#008080;">&lt;/</span><span style="color:#3f7f7f;">artifactId</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#008080;">&lt;</span><span style="color:#3f7f7f;">version</span><span style="color:#008080;">&gt;</span><span style="color:#000000;">3.4.1</span><span style="color:#008080;">&lt;/</span><span style="color:#3f7f7f;">version</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <span style="color:#008080;">&lt;/</span><span style="color:#3f7f7f;">dependency</span><span style="color:#008080;">&gt;</span></p> <p style="margin-left:0cm;">&nbsp; <span style="color:#008080;">&lt;/</span><span style="color:#3f7f7f;">dependencies</span><span style="color:#008080;">&gt;</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">（2）编写代码，遍历student集合所有数据：</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">MongoClient </span><u><span style="color:#6a3e3e;">client</span></u><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient();</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">创建连接对象</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoDatabase </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">client</span><span style="color:#000000;">.getDatabase(</span><span style="color:#2a00ff;">"itcastdb"</span><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取数据库&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoCollection&lt;Document&gt; </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;">.getCollection(</span><span style="color:#2a00ff;">"student"</span><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取集合</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> <p style="margin-left:0cm;"><span style="color:#000000;">FindIterable</span><span style="color:#000000;">&lt;Document&gt; </span><span style="color:#6a3e3e;">list</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.find();</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取文档集合</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">for</span></strong><span style="color:#000000;">( Document </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">: </span><span style="color:#6a3e3e;">list</span><span style="color:#000000;">){</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">遍历集合中的文档输出数据</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"name:"</span><span style="color:#000000;">+ </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">.getString(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">) );</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"sex:"</span><span style="color:#000000;">+ </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">.getString(</span><span style="color:#2a00ff;">"sex"</span><span style="color:#000000;">) );</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"age:"</span><span style="color:#000000;">+ </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">.getDouble(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">) );</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">默认为浮点型</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"address:"</span><span style="color:#000000;">+ </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">.getString(</span><span style="color:#2a00ff;">"address"</span><span style="color:#000000;">) );</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"--------------------------"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;"><span style="color:#00b050;">MongoDB</span><span style="color:#00b050;">的数字类型默认使用</span><span style="color:#00b050;">64</span><span style="color:#00b050;">位浮点型数值。</span><span style="color:#00b050;">{“x”</span><span style="color:#00b050;">：</span><span style="color:#00b050;">3.14}</span><span style="color:#00b050;">或</span><span style="color:#00b050;">{“x”</span><span style="color:#00b050;">：</span><span style="color:#00b050;">3}</span><span style="color:#00b050;">。对于整型值，可以使用</span><span style="color:#00b050;">NumberInt</span><span style="color:#00b050;">（</span><span style="color:#00b050;">4</span><span style="color:#00b050;">字节符号整数），</span><span style="color:#00b050;">{“x”:NumberInt(“3”)}&nbsp; </span><span style="color:#00b050;">或</span><span style="color:#00b050;">NumberLong</span><span style="color:#00b050;">（</span><span style="color:#00b050;">8</span><span style="color:#00b050;">字节符号整数）</span><span style="color:#00b050;">{“x”:NumberLong(“3”)}</span></p> 
  <h3 style="margin-left:70.9pt;">5.1.2匹配查询</h3> 
  <p style="margin-left:0cm;">MongoDB使用BasicDBObject类型封装查询条件，构造方法的参数为key 和value .</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">示例：查询student集合中name为猪八戒的文档</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">构建查询条件</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><strong><span style="color:#FF0000;">bson</span></strong><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">猪八戒"</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">FindIterable&lt;Document&gt; </span><span style="color:#6a3e3e;">list</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.find(</span><strong><span style="color:#FF0000;">bson</span></strong><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取文档集合</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//....</span><span style="color:#3f7f5f;">遍历集合</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <h3 style="margin-left:70.9pt;">5.1.3模糊查询</h3> 
  <p style="margin-left:0cm;">构建模糊查询条件是通过正则表达式的方式来实现的</p> 
  <p style="margin-left:0cm;">（1）完全匹配Pattern pattern = Pattern.compile("^name$");</p> 
  <p style="margin-left:0cm;">（2）右匹配Pattern pattern = Pattern.compile("^.*name$");</p> 
  <p style="margin-left:0cm;">（3）左匹配Pattern pattern = Pattern.compile("^name.*$");</p> 
  <p style="margin-left:0cm;">（4）模糊匹配Pattern pattern = Pattern.compile("^.*name.*$");</p> 
  <p style="margin-left:0cm;">示例：模糊查询student集合中address 中含有洞的文档记录</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">模糊查询：like %洞%</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">Pattern </span><span style="color:#FF0000;">queryPattern</span><span style="color:#000000;"> = Pattern.<em>compile</em>(</span><span style="color:#2a00ff;">"^.*</span><span style="color:#2a00ff;">洞.*$"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"address"</span><span style="color:#000000;">, </span><span style="color:#FF0000;">queryPattern</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">FindIterable&lt;Document&gt; </span><span style="color:#6a3e3e;">list</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.find(</span><span style="color:#6a3e3e;">bson</span><span style="color:#6a3e3e;">)</span><span style="color:#000000;">;</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取文档集合</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//....</span><span style="color:#3f7f5f;">遍历集合</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <h3 style="margin-left:70.9pt;">5.1.4大于小于</h3> 
  <p style="margin-left:0cm;">在MongoDB提示符下条件json字符串为{ age: { $lt :20 } } ，对应的java代码也是BasicDBObject 的嵌套。</p> 
  <p style="margin-left:0cm;">示例：查询student集合中age小于20的文档记录</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">查询年龄小于20的&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$lt"</span><span style="color:#000000;">,20));</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">FindIterable&lt;Document&gt; </span><span style="color:#6a3e3e;">list</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.find(</span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取文档集</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//....</span><span style="color:#3f7f5f;">遍历集合</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <h3 style="margin-left:70.9pt;">5.1.5条件连接--并且</h3> 
  <p style="margin-left:0cm;">示例：查询年龄大于等于20并且小于30的文档记录</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">查询年龄大于等于20的&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#000000;">bson1</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$gte"</span><span style="color:#000000;">,20));</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">查询年龄小于30的</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$lt"</span><span style="color:#000000;">,30));</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">构建查询条件</span><span style="color:#3f7f5f;">and</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong> &nbsp;<span style="color:#000000;">BasicDBObject(</span><span style="color:#2a00ff;">"$and"</span><span style="color:#000000;">,</span> <span style="color:#000000;">Arrays.<em>asList</em>(</span><span style="color:#6a3e3e;">bson1</span><span style="color:#000000;">,</span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;">)&nbsp; );</span></p> <p style="margin-left:0cm;">&nbsp;</p> </td> 
    </tr>
   </tbody>
  </table>
  <h3 style="margin-left:70.9pt;">5.1.6条件连接--或者</h3> 
  <p style="margin-left:0cm;">示例：查询年龄小于等于20或者性别为女的文档记录</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson1</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$lte"</span><span style="color:#000000;">,20));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"sex"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">女"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">构建查询条件</span><span style="color:#3f7f5f;">or</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$or"</span><span style="color:#000000;">, Arrays.<em>asList</em>( </span><span style="color:#6a3e3e;">bson1</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;"> )&nbsp; );</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">&nbsp;</p> 
  <h2 style="margin-left:49.6pt;">5.2增加文档</h2> 
  <p style="margin-left:0cm;">我们使用insertOne方法来插入文档。</p> 
  <p style="margin-left:0cm;">示例：添加文档记录--名称：铁扇公主&nbsp; 性别:女 年龄：28&nbsp;&nbsp; 地址：芭蕉洞</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取连接</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoClient </span><u><span style="color:#6a3e3e;">client</span></u><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient();</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到数据库</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoDatabase </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">client</span><span style="color:#000000;">.getDatabase(</span><span style="color:#2a00ff;">"itcastdb"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到集合封装对象</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoCollection&lt;Document&gt; </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;">.getCollection(</span><span style="color:#2a00ff;">"student"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">Map&lt;String, Object&gt; </span><span style="color:#6a3e3e;">map</span><span style="color:#000000;">=</span><strong><u><span style="color:#7f0055;">new</span></u></strong><u><span style="color:#000000;"> HashMap()</span></u><span style="color:#000000;">;</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">map</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">铁扇公主"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">map</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"sex"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">女"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">map</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, 35.0);</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">map</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"address"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">芭蕉洞"</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">Document </span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> Document(</span><span style="color:#6a3e3e;">map</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.insertOne(</span><span style="color:#6a3e3e;">doc</span><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">插入一条记录</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//collection.insertMany(documents);//</span><span style="color:#3f7f5f;">一次性插入多条文档</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <h2 style="margin-left:49.6pt;">5.3删除文档</h2> 
  <p style="margin-left:0cm;">示例：将名称为铁扇公主的文档删除</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取连接</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoClient </span><u><span style="color:#6a3e3e;">client</span></u><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient();</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到数据库</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoDatabase </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">client</span><span style="color:#000000;">.getDatabase(</span><span style="color:#2a00ff;">"itcastdb"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到集合封装对象</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoCollection&lt;Document&gt; </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;">.getCollection(</span><span style="color:#2a00ff;">"student"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">铁扇公主"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.deleteOne(</span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">删除记录（符合条件的第一条记录）</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//collection.deleteMany(<u>bson</u>);//</span><span style="color:#3f7f5f;">删除符合条件的全部记录</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <h2 style="margin-left:49.6pt;">5.4修改文档</h2> 
  <p style="margin-left:0cm;">示例：将红孩儿的地址修改为“南海”</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">获取连接</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoClient </span><u><span style="color:#6a3e3e;">client</span></u><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient();</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到数据库</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoDatabase </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">client</span><span style="color:#000000;">.getDatabase(</span><span style="color:#2a00ff;">"itcastdb"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">得到集合封装对象</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">MongoCollection&lt;Document&gt; </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;">.getCollection(</span><span style="color:#2a00ff;">"student"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;">&nbsp;</p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">修改的条件</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">= </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">红孩儿"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">修改后的值</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">BasicDBObject </span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;"> = </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"$set"</span><span style="color:#000000;">,</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> BasicDBObject(</span><span style="color:#2a00ff;">"address"</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">南海"</span><span style="color:#000000;">));</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">参数1：修改条件&nbsp; 参数2：修改后的值</span></p> <p style="margin-left:0cm;"><span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.updateOne(</span><span style="color:#6a3e3e;">bson</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">bson2</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//collection.updateMany(filter, update);//</span><span style="color:#3f7f5f;">修改符合条件的所有记录</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">updateMany方法用于修改符合条件的所有记录</p> 
  <p style="margin-left:0cm;">updateOne方法用于修改符合条件的第一条记录</p> 
  <h1 style="margin-left:21.25pt;">6.MongoDB连接池</h1> 
  <h2 style="margin-left:49.6pt;">6.1代码实现</h2> 
  <p style="margin-left:0cm;">MongoClient 被设计为线程安全的类，也就是我们在使用该类时不需要考虑并发的情况，这样我们可以考虑把MongoClient 做成一个静态变量，为所有线程公用，不必每次都销毁。这样可以极大提高执行效率。实际上，这是MongoDB提供的内置的连接池来实现的。&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 首先我们先创建一个“管理类”，相当于我们原来的BaseDao</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.MongoClient;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.MongoClientOptions;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.MongoClientOptions.Builder;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.WriteConcern;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.client.MongoDatabase;</span></p> <p style="margin-left:0cm;">&nbsp;</p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">class</span></strong><span style="color:#000000;"> MongoManager {</span></p> <p style="margin-left:0cm;">&nbsp;</p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">private</span></strong> <strong><span style="color:#7f0055;">static</span></strong><span style="color:#000000;"> MongoClient </span><em><span style="color:#0000c0;">mongoClient</span></em><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">null</span></strong><span style="color:#000000;">;</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;</p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">对mongoClient初始化</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">private</span></strong> <strong><span style="color:#7f0055;">static</span></strong> <strong><span style="color:#7f0055;">void</span></strong><span style="color:#000000;"> init(){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em><span style="color:#0000c0;">mongoClient</span></em><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient(); </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; }</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;</p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">static</span></strong><span style="color:#000000;"> MongoDatabase getDatabase(){</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">if</span></strong><span style="color:#000000;">(</span><em><span style="color:#0000c0;">mongoClient</span></em><span style="color:#000000;">==</span><strong><span style="color:#7f0055;">null</span></strong><span style="color:#000000;">){</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em>init</em>();</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">return</span></strong> <em><span style="color:#0000c0;">mongoClient</span></em><span style="color:#000000;">.getDatabase(</span><span style="color:#2a00ff;">"itcastdb"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; }</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 然后我们创建一个StudentDao</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> org.bson.Document;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.client.MongoCollection;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> com.mongodb.client.MongoDatabase;</span></p> <p style="margin-left:0cm;"><span style="color:#3f5fbf;">/**</span></p> <p style="margin-left:0cm;"><span style="color:#3f5fbf;">&nbsp;* </span><span style="color:#3f5fbf;">学员数据访问层</span></p> <p style="margin-left:0cm;"><span style="color:#3f5fbf;">&nbsp;* </span><strong><span style="color:#7f9fbf;">@author</span></strong><span style="color:#3f5fbf;"> Administrator</span></p> <p style="margin-left:0cm;"><span style="color:#3f5fbf;">&nbsp;*</span></p> <p style="margin-left:0cm;"><span style="color:#3f5fbf;">&nbsp;*/</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">class</span></strong><span style="color:#000000;"> StudentDao {</span></p> <p style="margin-left:0cm;">&nbsp;</p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">void</span></strong><span style="color:#000000;"> save(String </span><span style="color:#6a3e3e;">name</span><span style="color:#000000;">,String </span><span style="color:#6a3e3e;">sex</span><span style="color:#000000;">,</span><strong><span style="color:#7f0055;">double</span></strong> <span style="color:#6a3e3e;">age</span><span style="color:#000000;">,String </span><span style="color:#6a3e3e;">address</span><span style="color:#000000;">){</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MongoDatabase </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;"> = MongoManager.<em>getDatabase</em>();</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MongoCollection&lt;Document&gt; </span><span style="color:#6a3e3e;">collection</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">database</span><span style="color:#000000;">.getCollection(</span><span style="color:#2a00ff;">"student2"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Document </span><span style="color:#6a3e3e;">docment</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> Document();</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">docment</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"name"</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">name</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">docment</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"sex"</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">sex</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">docment</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"age"</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">age</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">docment</span><span style="color:#000000;">.put(</span><span style="color:#2a00ff;">"address"</span><span style="color:#000000;">, </span><span style="color:#6a3e3e;">address</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">collection</span><span style="color:#000000;">.insertOne(</span><span style="color:#6a3e3e;">docment</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">我们现在做个测试，循环插入2万条数据，看看执行时间是多长时间</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">import</span></strong><span style="color:#000000;"> java.util.Date;</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">class</span></strong><span style="color:#000000;"> TestPool {</span></p> <p style="margin-left:0cm;">&nbsp;</p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">public</span></strong> <strong><span style="color:#7f0055;">static</span></strong> <strong><span style="color:#7f0055;">void</span></strong><span style="color:#000000;"> main(String[] </span><span style="color:#6a3e3e;">args</span><span style="color:#000000;">) {</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">long</span></strong> <span style="color:#6a3e3e;">startTime</span><span style="color:#000000;"> = </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> Date().getTime();</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">开始时间</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StudentDao </span><span style="color:#6a3e3e;">studentDao</span><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> StudentDao();</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">for</span></strong><span style="color:#000000;">(</span><strong><span style="color:#7f0055;">int</span></strong> <span style="color:#6a3e3e;">i</span><span style="color:#000000;">=0;</span><span style="color:#6a3e3e;">i</span><span style="color:#000000;">&lt;20000;</span><span style="color:#6a3e3e;">i</span><span style="color:#000000;">++){</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">studentDao</span><span style="color:#000000;">.save(</span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">测试"</span><span style="color:#000000;">+</span><span style="color:#6a3e3e;">i</span><span style="color:#000000;">, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">男"</span><span style="color:#000000;">, 25.0, </span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">测试地址"</span><span style="color:#000000;">+</span><span style="color:#6a3e3e;">i</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="color:#7f0055;">long</span></strong> <span style="color:#6a3e3e;">endTime</span><span style="color:#000000;"> = </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> Date().getTime();</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">完成时间</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.</span><strong><em><span style="color:#0000c0;">out</span></em></strong><span style="color:#000000;">.println(</span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">完成时间："</span><span style="color:#000000;">+(</span><span style="color:#6a3e3e;">endTime</span><span style="color:#000000;">-</span><span style="color:#6a3e3e;">startTime</span><span style="color:#000000;">)+</span><span style="color:#2a00ff;">"</span><span style="color:#2a00ff;">毫秒"</span><span style="color:#000000;">);</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp; }</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">经过测试：所用毫秒数为3589</p> 
  <h2 style="margin-left:49.6pt;">6.2参数设置</h2> 
  <p style="margin-left:0cm;">我们在刚才的代码基础上进行连接池参数的设置</p> 
  <p style="margin-left:0cm;">修改MongoManager的init方法</p> 
  <table border="1" cellspacing="0">
   <tbody>
    <tr>
     <td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:0cm;"><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">对mongoClient初始化</span></p> <p style="margin-left:0cm;"><strong><span style="color:#7f0055;">private</span></strong> <strong><span style="color:#7f0055;">static</span></strong> <strong><span style="color:#7f0055;">void</span></strong><span style="color:#000000;"> init(){</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">连接池选项</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Builder </span><span style="color:#6a3e3e;">builder</span><span style="color:#000000;"> = </span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClientOptions.Builder();</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">选项构建者&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">builder</span><span style="color:#000000;">.connectTimeout(5000);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">设置连接超时时间</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">builder</span><span style="color:#000000;">.socketTimeout(5000);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">读取数据的超时时间</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">builder</span><span style="color:#000000;">.connectionsPerHost(30);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">每个地址最大请求数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#6a3e3e;">builder</span><span style="color:#000000;">.writeConcern(WriteConcern.<s><u>NORMAL</u></s>);</span><span style="color:#3f7f5f;">//</span><span style="color:#3f7f5f;">写入策略，仅抛出网络异常</span></p> <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MongoClientOptions </span><span style="color:#6a3e3e;">options</span><span style="color:#000000;"> = </span><span style="color:#6a3e3e;">builder</span><span style="color:#000000;">.build();</span></p> <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em><span style="color:#0000c0;">mongoClient</span></em><span style="color:#000000;">=</span><strong><span style="color:#7f0055;">new</span></strong><span style="color:#000000;"> MongoClient(</span><span style="color:#2a00ff;">"127.0.0.1"</span><span style="color:#000000;">,</span><span style="color:#6a3e3e;">options</span><span style="color:#000000;">);&nbsp;&nbsp;&nbsp; </span></p> <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">再次进行测试：所用的毫秒1544</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">下面是写入策略。</p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.NONE:</span><span style="color:#4a442a;">没有异常抛出</span></p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.NORMAL:</span><span style="color:#4a442a;">仅抛出网络错误异常，没有服务器错误异常</span></p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.SAFE:</span><span style="color:#4a442a;">抛出网络错误异常、服务器错误异常；并等待服务器完成写操作。</span></p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.MAJORITY: </span><span style="color:#4a442a;">抛出网络错误异常、服务器错误异常；并等待一个主服务器完成写操作。</span></p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.FSYNC_SAFE: </span><span style="color:#4a442a;">抛出网络错误异常、服务器错误异常；写操作等待服务器将数据刷新到磁盘。</span></p> 
  <p style="margin-left:0cm;"><span style="color:#4a442a;">WriteConcern.JOURNAL_SAFE:</span><span style="color:#4a442a;">抛出网络错误异常、服务器错误异常；写操作等待服务器提交到磁盘的日志文件。</span></p> 
  <p><span style="color:#4a442a;">WriteConcern.REPLICAS_SAFE:</span><span style="color:#4a442a;">抛出网络错误异常、服务器错误异常；等待至少</span><span style="color:#4a442a;">2</span><span style="color:#4a442a;">台服务器完成写操作</span></p> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
