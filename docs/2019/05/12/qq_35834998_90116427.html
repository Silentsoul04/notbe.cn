<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>graphicsç”Ÿæˆåˆ†äº«æŒ‚çº§äºŒç»´ç æµ·æŠ¥ä¹‹å‡çº§ä¼˜åŒ–(å®Œç¾æ–¹æ¡ˆ)JAVA Â« NotBeCN</title>
  <meta name="description" content="          é’ˆå¯¹ä¼˜åŒ–çš„æ–‡ç« :&nbsp;           https://blog.csdn.net/qq_35834998/article/details/89262013         ä¸Šç¯‡æ–‡ç« ç¼ºç‚¹:&nbsp;&nbsp;           æ–‡æ®µå†…å®¹æ— æ³•æ ¹æ® â€œ\nâ€ è‡ªåŠ¨æ¢è¡Œ,åªèƒ½å®ç°æ¯è¡Œ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/12/qq_35834998_90116427.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">å…³äº</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">ç¤¾åŒº</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">å°„ä¸ªé¸­å­</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">graphicsç”Ÿæˆåˆ†äº«æŒ‚çº§äºŒç»´ç æµ·æŠ¥ä¹‹å‡çº§ä¼˜åŒ–(å®Œç¾æ–¹æ¡ˆ)JAVA</h1>
    <p class="post-meta">May 12, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <h3>é’ˆå¯¹ä¼˜åŒ–çš„æ–‡ç« :&nbsp;</h3> 
  <blockquote> 
   <ul>
    <li><a href="https://blog.csdn.net/qq_35834998/article/details/89262013" rel="nofollow">https://blog.csdn.net/qq_35834998/article/details/89262013</a></li> 
   </ul>
  </blockquote> 
  <h3>ä¸Šç¯‡æ–‡ç« ç¼ºç‚¹:&nbsp;&nbsp;</h3> 
  <blockquote> 
   <ol>
    <li>æ–‡æ®µå†…å®¹æ— æ³•æ ¹æ® â€œ\nâ€ è‡ªåŠ¨æ¢è¡Œ,åªèƒ½å®ç°æ¯è¡Œå æ»¡åè‡ªåŠ¨æ¢è¡Œ.</li> 
    <li>æµ·æŠ¥bannerå›¾ç‰‡æ— æ³•å®ç°è‡ªåŠ¨ç¼©æ”¾,åªèƒ½æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢çš„bannerå›¾,å±€é™æ€§å¤ªå¤§.</li> 
    <li>æµ·æŠ¥ä¸­çš„å†…å®¹(å›¾ç‰‡ä½ç½®,æ–‡æ®µä½ç½®)éƒ½æ˜¯ä»¥ èƒŒæ™¯å›¾ çš„ç›¸å¯¹ä½ç½®å¼€å§‹è®¡ç®—å†™å…¥,é€ æˆä¸åŒæ‰‹æœºå¯èƒ½å‡ºç°å†…å®¹ä½ç½®ä¸ä¸€è‡´æˆ–è€…å†…å®¹æ··ä¹±çš„ç°è±¡.</li> 
   </ol>
  </blockquote> 
  <h3>ä¼˜åŒ–: è§£å†³ä»¥ä¸Šé—®é¢˜å¹¶å®ç°</h3> 
  <blockquote> 
   <ol>
    <li>èƒŒæ™¯+banner+æ–‡æ®µè¯´æ˜+äºŒç»´ç  = æµ·æŠ¥</li> 
    <li>èƒŒæ™¯+è¯—è¯+è¯—è¯èƒŒæ™¯+æ–‡æ®µè¯´æ˜+äºŒç»´ç  = æµ·æŠ¥</li> 
   </ol>
  </blockquote> 
  <h3>å¦‚ä½•æŒ‚çº§:&nbsp;</h3> 
  <ul>
   <li>ä¸ç®¡æ˜¯å°ç¨‹åºè¿˜æ˜¯å…¬ä¼—å·(æˆ–å…¶å®ƒ),é€šè¿‡æµ·æŠ¥æ‰«ç çš„æŒ‚çº§,å…³é”®å°±åœ¨äºŒç»´ç </li> 
   <li>æ€è·¯å‚è€ƒ</li> 
  </ul>
  <blockquote> 
   <ol>
    <li>çº¦å®šå¥½æŒ‚çº§çš„æ–¹å¼åŠäºŒç»´ç ä¸­çš„å‚æ•°å½¢å¼ (ä¸€èˆ¬æ˜¯&nbsp; å‰ç«¯é¡µé¢è·¯å¾„+å½“å‰ç”¨æˆ·æ ‡è¯†)</li> 
    <li>å°†çº¦å®šå¥½çš„é“¾æ¥å’Œå‚æ•°å½¢å¼å½“ä½œäºŒç»´ç å†…å®¹</li> 
    <li>ç”ŸæˆäºŒç»´ç </li> 
    <li>å…¶ä»–ç”¨æˆ·æ‰«ç (è¿›å…¥å‰ç«¯é¡µé¢è·¯å¾„--&gt;å‰ç«¯å¼€å‘äººå‘˜é€šè¿‡ä»£ç è·å–äºŒç»´ç ä¸­çš„ä¸Šçº§ç”¨æˆ·æ ‡è¯†--&gt;å½“å‰ç”¨æˆ·ç™»å½•--&gt;é€šè¿‡åå°å†™å¥½çš„æŒ‚çº§æ¥å£ä¼ ç»™åå°)</li> 
    <li>åç«¯å®ç°æŒ‚çº§é€»è¾‘æ“ä½œ</li> 
   </ol>
  </blockquote> 
  <h3>æœ€åç”Ÿæˆçš„æµ·æŠ¥å¦‚ä½•å¤„ç†:</h3> 
  <blockquote> 
   <ol>
    <li>é€šè¿‡graphicså°†æµ·æŠ¥ç»˜ç”»å®Œæˆå</li> 
    <li>å°†æµ·æŠ¥å†™å…¥æœåŠ¡å™¨æŸä¸ªæ–‡ä»¶å¤¹ä¸­</li> 
    <li>å°†æµ·æŠ¥ä¸Šä¼ è‡³ä¸ƒç‰›äº‘(æˆ–å…¶å®ƒ)</li> 
    <li>å°†æµ·æŠ¥è®¿é—®é“¾æ¥å­˜å…¥æ•°æ®åº“(æˆ–å…¶å®ƒ)</li> 
    <li>å°†æœåŠ¡å™¨ä¸­çš„æµ·æŠ¥åˆ é™¤<br> ä¸å»ºè®®ç›´æ¥æŠŠæœåŠ¡å™¨å½“ä½œå›¾ç‰‡æœåŠ¡å™¨,ä½œä¸ºä¸Šä¼ ä¸ƒç‰›äº‘çš„ä¸­è½¬ç«™å°±å¥½</li> 
   </ol>
  </blockquote> 
  <h3>graphicsåœ¨æœåŠ¡å™¨ä¸Šå¯èƒ½å­˜åœ¨çš„é—®é¢˜:</h3> 
  <blockquote> 
   <ul>
    <li>å‚è€ƒæˆ‘è¿™ç¯‡æ–‡ç« : <a href="https://blog.csdn.net/qq_35834998/article/details/86632807" rel="nofollow">https://blog.csdn.net/qq_35834998/article/details/86632807</a>&nbsp;</li> 
   </ul>
  </blockquote> 
  <h3>è¿­ä»£:</h3> 
  <ul>
   <li>ä¸Šç¯‡æ–‡ç« å¯ä»¥æ”¾å¼ƒäº†,å°±å½“å‚è€ƒå§.æœ‰éœ€æ±‚çš„åŒå­¦å°±çœ‹è¿™ç¯‡æ–‡ç« å°±è¶³å¤Ÿäº†!</li> 
  </ul>
  <h3>æ•ˆæœå›¾:</h3> 
  <p><img alt="" class="has" height="496" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512095435409.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1ODM0OTk4,size_16,color_FFFFFF,t_70" width="280">&nbsp;<img alt="" class="has" height="497" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512095530955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1ODM0OTk4,size_16,color_FFFFFF,t_70" width="280">&nbsp;<img alt="" class="has" height="495" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512105858384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1ODM0OTk4,size_16,color_FFFFFF,t_70" width="278"></p> 
  <h3>å¹²è´§å¼€å§‹:</h3> 
  <ul>
   <li>éƒ¨åˆ†å¼€å‘ç¯å¢ƒ</li> 
  </ul>
  <blockquote> 
   <ol>
    <li>springboot+ymlé…ç½®+Gradle&nbsp; (GradleåŠŸèƒ½ç›¸å½“äºmaven,æ¯”mavenæ›´åŠ ç®€ä»‹,æ–¹ä¾¿)</li> 
    <li>githubä¸Šçš„ WxJava&nbsp; åœ°å€:&nbsp;<a href="https://github.com/Wechat-Group/WxJava/" rel="nofollow">https://github.com/Wechat-Group/WxJava/</a>&nbsp; &nbsp;è¿™ä¸ªsdkæˆ‘å°±ä¸ä»‹ç»äº†,ç†Ÿæ‚‰å¾®ä¿¡å¼€å‘çš„åº”è¯¥éƒ½ç†Ÿæ‚‰<br> æ­¤ç¯‡ä¸è®²åœ¨é¡¹ç›®ä¸­å¦‚ä½•é›†æˆ WxJava</li> 
    <li>ä¸ƒç‰›äº‘(å›¾ç‰‡æœåŠ¡å™¨) âš ï¸å¦‚æœæ˜¯å°ç¨‹åºä¸­,é‚£ä¹ˆä¸ƒç‰›äº‘çš„å›¾ç‰‡è®¿é—®åŸŸåä¸€å®šè¦é…ç½®æˆhttps</li> 
   </ol>
  </blockquote> 
  <ul>
   <li>é›†æˆä¸ƒç‰›äº‘(åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ä¸ƒç‰›äº‘ä¸Šä¼ å›¾ç‰‡)<br> âš ï¸ä¸ƒç‰›äº‘è´¦å·ç”³è¯·ç­‰æ“ä½œä¸è¯¦ç»†è®²è§£,éƒ½éå¸¸ç®€å•</li> 
  </ul>
  <ol>
   <li>ç™»å½•ä¸ƒç‰›äº‘&nbsp;<a href="https://www.qiniu.com/" rel="nofollow">https://www.qiniu.com/</a>&nbsp; æ³¨å†Œè‡ªå·±çš„è´¦å·,ä¸éœ€è¦ä¼ä¸š,ä¸ªäººå°±èƒ½ç”¨</li> 
   <li>å¥½åƒéœ€è¦ä¸ªäººè®¤è¯</li> 
   <li>è¿›å…¥ æ§åˆ¶å° --&gt; å·¦è¾¹èœå•æ &nbsp; å¯¹è±¡å­˜å‚¨ --&gt; æ–°å»ºå­˜å‚¨ç©ºé—´(ä¸€ç³»åˆ—é…ç½®)&nbsp; --&gt; ç»‘å®šåŸŸå</li> 
   <li>ä¸ªäººä¸­å¿ƒ&nbsp;--&gt; å¯†åŒ™ç®¡ç†&nbsp;--&gt; æ‹¿åˆ° AccessKey/SecretKey<br> âš ï¸è¿™äº›åœ°æ–¹ä¸è¯¦ç»†è®²è§£,ä¸åŒçš„å†é—®æˆ–è€…ç™¾åº¦<br><strong><span style="color:#e579b6;">ä»£ç éƒ¨åˆ†</span></strong></li> 
   <li>gralde 
    <blockquote> 
     <pre class="has">
<code class="language-html">compile 'com.qiniu:qiniu-java-sdk:7.2.+'
</code></pre> 
    </blockquote> </li> 
   <li>ymlé…ç½® 
    <blockquote> 
     <pre class="has">
<code class="language-html">qiniu:
  accessKey: vB4dBXKZB************************itjb-w8
  secretKey: ser2PeRdL************************4GDvEfS
  bucket: xypsp
  domain: https://******.com/</code></pre> 
    </blockquote> âš ï¸è‡ªå·±æ²¡æœ‰æ­£å¼åŸŸåçš„,ç”¨ä¸ƒç‰›äº‘æä¾›çš„ä¸´æ—¶åŸŸåä¹Ÿå¯ä»¥,æ—¶æ•ˆä¸€ä¸ªæœˆ</li> 
   <li>é…ç½®æ–‡ä»¶ 
    <blockquote> 
     <pre class="has">
<code class="language-html">import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
/**
 *å±æ€§æ–‡ä»¶
 * @author rp
 * @date 2017/5/11
 */
@ConfigurationProperties(prefix = "qiniu")
@Data
public class QiniuProperties {
    private String accessKey;
    private String secretKey;
    private String bucket;
    private String domain;
}</code></pre> 
    </blockquote> 
    <blockquote> 
     <pre class="has">
<code class="language-html">import com.daoyintech.leshan.activity.utils.qiniu.QiniuUploadTool;
import com.qiniu.common.Zone;
import com.qiniu.storage.BucketManager;
import com.qiniu.storage.Configuration;
import com.qiniu.storage.UploadManager;
import com.qiniu.util.Auth;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;

/**
 *ä¸ƒç‰›é…ç½®
 * @author rp
 * @date 2017/5/11
 */
@EnableConfigurationProperties(QiniuProperties.class)
@org.springframework.context.annotation.Configuration
public class QiniuConfiguration {

    @Autowired
    private QiniuProperties properties;

    @Bean
    @ConditionalOnMissingBean
    public UploadManager uploadManager(Configuration configuration){
        UploadManager uploadManager = new UploadManager(configuration);
        return uploadManager;
    }

    @Bean
    public Configuration configuration(){
        return new Configuration(Zone.zone2());
    }

    @Bean
    @ConditionalOnMissingBean
    public Auth auth(){
        Auth auth = Auth.create(properties.getAccessKey(), properties.getSecretKey());
        return auth;
    }

    @Bean
    @ConditionalOnMissingBean
    public BucketManager bucketManager(Auth auth, Configuration configuration){
        BucketManager bucketManager = new BucketManager(auth,configuration);
        return bucketManager;
    }

    @Bean
    @ConditionalOnMissingBean
    public QiniuUploadTool qiniuUpload(Auth auth, UploadManager uploadManager, BucketManager bucketManager){
        QiniuUploadTool upload = new QiniuUploadTool();
        upload.setAuth(auth);
        upload.setBucket(properties.getBucket());
        upload.setUploadManager(uploadManager);
        upload.setBucketManager(bucketManager);
        return upload;
    }</code></pre> 
    </blockquote> 
    <blockquote> 
     <pre class="has">
<code class="language-html">import org.springframework.beans.BeansException;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.stereotype.Component;

/**
 *åå°„é…ç½®
 * @author rp
 * @date 2017/4/25
 */
@Component
public class ApplicationContextProvider implements ApplicationContextAware {

    private static ApplicationContext CONTEXT;

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        ApplicationContextProvider.CONTEXT = applicationContext;
    }

    public static Object getBean(Class clazz) {
        return ApplicationContextProvider.CONTEXT.getBean(clazz);
    }

    public static Object getBean(String qualifier, Class clazz) {
        return ApplicationContextProvider.CONTEXT.getBean(qualifier , clazz);
    }
}&nbsp;
</code></pre> 
    </blockquote> </li> 
   <li>ä¸ƒç‰›äº‘å·¥å…·ç±» 
    <blockquote> 
     <pre class="has">
<code class="language-html">import lombok.Data;
/**
 * ç»“æœè¿”å›å±æ€§
 * @author rp
 */
@Data
public class ImageResult {
    private boolean isSuccess;
    private String url;
    private String key;
    private String hash;
}</code></pre> 
    </blockquote> 
    <blockquote> 
     <pre class="has">
<code class="language-html">import com.google.gson.Gson;
import com.qiniu.common.QiniuException;
import com.qiniu.http.Response;
import com.qiniu.storage.BucketManager;
import com.qiniu.storage.UploadManager;
import com.qiniu.storage.model.DefaultPutRet;
import com.qiniu.util.Auth;
import lombok.Data;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
/**
 * ä¸Šä¼ tool
 * @author rp
 * @date 2017/5/9
 */
@Data
@Slf4j
public class QiniuUploadTool {
    private Long expireTime = System.currentTimeMillis() / 1000;
    private String bucket;
    private UploadManager uploadManager;
    private BucketManager bucketManager;
    private String upToken;
    private Auth auth;

    @Autowired
    private QiniuProperties qiniuProperties;

    public DefaultPutRet upload(byte[] bytes, String key) {
        int date = 1000;
        if (System.currentTimeMillis() / date &gt;= expireTime) {
            generateUpToken();
        }
        Response response = null;
        DefaultPutRet putRet = null;
        try {
            response = uploadManager.put(bytes, key, upToken);
            putRet = new Gson().fromJson(response.bodyString(), DefaultPutRet.class);
            log.info("ä¸Šä¼ æ–‡ä»¶æˆåŠŸ", putRet);
        } catch (QiniuException e) {
            log.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:{}", e.getMessage());
        }
        return putRet;
    }

    public DefaultPutRet delete(String key) throws QiniuException {
        Response response = bucketManager.delete(bucket, key);
        DefaultPutRet putRet = new Gson().fromJson(response.bodyString(), DefaultPutRet.class);
        return putRet;
    }

    private void generateUpToken() {
        this.expireTime = System.currentTimeMillis() / 1000 + 3600;
        this.upToken = auth.uploadToken(bucket);
    }
}</code></pre> 
    </blockquote> 
    <blockquote> 
     <pre class="has">
<code class="language-html">import com.qiniu.common.QiniuException;
import com.qiniu.storage.model.DefaultPutRet;
import org.springframework.stereotype.Component;
import org.springframework.web.multipart.MultipartFile;
import java.io.IOException;
import java.util.UUID;
/**
 * ä¸Šä¼ toolå°è£…
 * @author rp
 */
@Component
public class ImageScalaTool {

    private final QiniuUploadTool qiNiuUploadTool;
    private final QiniuProperties qiNiuProperties;

    public ImageScalaTool(QiniuUploadTool qiNiuUploadTool, QiniuProperties qiNiuProperties) {
        this.qiNiuUploadTool = qiNiuUploadTool;
        this.qiNiuProperties = qiNiuProperties;
    }

    public ImageResult upload(MultipartFile file, String key) {
        ImageResult imageResult;
        try {
            String uuid = UUID.randomUUID().toString().replaceAll("-", "");
            DefaultPutRet ret = qiNiuUploadTool.upload(file.getBytes(), key + "/" + uuid);
            imageResult = initializeQiNiuResult(true, ret);
        } catch (IOException e) {
            e.printStackTrace();
            imageResult = initializeQiNiuResult(false, new DefaultPutRet());
        }
        return imageResult;
    }

    public void delete(String key) {
        try {
            qiNiuUploadTool.delete(key);
        } catch (QiniuException e) {
            e.printStackTrace();
        }
    }

    private ImageResult initializeQiNiuResult(boolean isSuccess, DefaultPutRet ret) {
        ImageResult imageResult = new ImageResult();
        imageResult.setHash(ret.hash);
        imageResult.setKey(ret.key);
        imageResult.setSuccess(isSuccess);
        imageResult.setUrl(qiNiuProperties.getDomain() + "/" + ret.key);
        return imageResult;
    }
}</code></pre> 
    </blockquote> </li> 
   <li>qiniuUploadTool å’Œ ImageScalaTool éƒ½å¯ç›´æ¥ä¸Šä¼ å›¾ç‰‡,é€‰å…¶ä¸€å³å¯</li> 
   <li>âš ï¸<span style="color:#e579b6;">é‡ç‚¹,ä¸»é¢˜æ¥äº†-ç”Ÿæˆæµ·æŠ¥ä»£ç </span><br> âš ï¸å°†ä»£ç æŠ½æˆäº†ä¸€ä¸ªæµ‹è¯•æ–¹æ³•,åŒå­¦å¯æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿ç”¨åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­<br> graldeé…ç½® 
    <blockquote> 
     <pre class="has">
<code class="language-html">compile('commons-io:commons-io:2.5')
implementation "com.github.binarywang:weixin-java-miniapp:3.3.0"</code></pre> 
    </blockquote> ymlé…ç½® 
    <blockquote> 
     <pre class="has">
<code class="language-html">share:
#  æµ·æŠ¥çš„æ„å»ºèƒŒæ™¯å›¾
  bg: https://qiniu.xypsp.com/share_bg.jpg
#  è¯—è¯èƒŒæ™¯å›¾
  peom_bg: https://qiniu.xypsp.com/61555056674_.pic_hd.jpg
#  å°ç¨‹åºçš„æ‹ç…§åˆ—è¡¨é¡µé¢è·¯å¾„
  photo_path: /pages/activity/pages/activity-photo-indetail/main
# å°ç¨‹åºçš„è¯—è¯åˆ—è¡¨é¡µé¢è·¯å¾„
  poem_path: /pages/activity/pages/activity-poem-indetail/main
# æµ·æŠ¥æœ¬åœ°ä¸´æ—¶å­˜å‚¨è·¯å¾„
  local: /Users/rp/develop/image/</code></pre> 
    </blockquote> æµ‹è¯•ç±»-ä¸»ç±» 
    <blockquote> 
     <pre class="has">
<code class="language-html">import cn.binarywang.wx.miniapp.api.WxMaService;
import com.daoyintech.leshan.activity.configuration.qiniu.QiniuProperties;
import com.daoyintech.leshan.activity.utils.qiniu.QiniuUploadTool;
import com.qiniu.storage.model.DefaultPutRet;
import lombok.extern.slf4j.Slf4j;
import me.chanjar.weixin.common.error.WxErrorException;
import org.apache.commons.io.FileUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.math.BigDecimal;
import java.net.URL;
import java.util.UUID;

@Slf4j
@RunWith(SpringRunner.class)
@SpringBootTest
public class ActivityApplicationTests {

    @Value("${share.bg}")
    String shareBg;
    @Value("${share.peom_bg}")
    String peomBg;
    @Value("${share.photo_path}")
    String photoPath;
    @Value("${share.poem_path}")
    String poemPath;
    @Value("${share.local}")
    String local;

    @Autowired
    private WxMaService wxMaService;
    @Autowired
    private QiniuUploadTool qiniuUploadTool;
    @Autowired
    private QiniuProperties qiniuProperties;

@Test
public void contextLoads(){
&nbsp;  //æµ‹è¯•æ•°æ®
    String rule = "æˆ‘æ­£åœ¨å‚åŠ ç¾ä¸½å˜‰å·æœ€ç¾æ—…æ‹æ´»åŠ¨\n" +
                    "å¿«æ‰«æå³ä¾§äºŒç»´ç æ¯å¤©å¸®æˆ‘æŠ•ä¸€ç¥¨å§\n" +
                    "å‘¼æœ‹å¼•ä¼´æ¥ç‚¹èµï¼Œæ—¥å‘¨æœˆèµ›ä¸é—´æ–­ï¼Œå¥–é‡‘å¥–å“ç–¯ç‹‚èµšï¼";
    String content = "æ˜Ÿæ˜Ÿä¸è§å¤ªé˜³å…‰ï¼Œ\n" +
                    "æ°¸çœ é•¿é€è«æ‚²ä¼¤ï¼Œ\n" +
                    "è™šç©ºæå°½è«èƒ½è®¡ï¼Œ\n" +
                    "æ¯åœ¨å¿ƒæ—æ€»æƒ…é•¿ï¼Œ\n" +
                    "äººéšæ°´å»æ³ªæ±ªæ±ªï¼Œ\n" +
                    "å¿ƒåŠ›ç‚¹ç‚¹é…’è‹èŒ«ï¼Œ\n" +
                    "è¿˜è®°åæœˆç›¸å€šä¼´ï¼Œ\n" +
                    "è°äººçŠ¹åœ¨æˆ‘ä»–æ—ã€‚";
    Long articleId = 1L;
    String banner = "https://static.leshan.daoyintech.com/article/url/1557625148918/a747f41b0d0149b9ab0c0ad46988b210";
    String banner2 = "https://static.leshan.daoyintech.com/article/url/1557625346085/cb3ae7fb90be49169086bf320c8bf0f0";
    int type = 0;
    //ç”Ÿæˆæµ·æŠ¥
    String imageUrl = null;
    try {
&nbsp;       //ä¸»è¦æ–¹æ³•
        imageUrl = createShareImageUrl(rule,content,articleId,type,banner);
    } catch (Exception e) {
        log.error("ç”ŸæˆäºŒç»´ç å¤±è´¥:{}",e.getMessage());
    }
}

private String createShareImageUrl(String rule,String content,Long articleId,int type,String banner) throws Exception {
    //åˆ›å»ºå›¾ç‰‡
    BufferedImage img = new BufferedImage(750, 1334, BufferedImage.TYPE_INT_RGB);
    //å¼€å¯ç”»å›¾
    Graphics g = img.getGraphics();
    //èƒŒæ™¯--è¯»å–äº’è”ç½‘å›¾ç‰‡
    BufferedImage back  = ImageIO.read(new URL(shareBg));
    // ç»˜åˆ¶ç¼©å°åçš„å›¾
    g.drawImage(back.getScaledInstance(750, 1334, Image.SCALE_DEFAULT), 0, 0, null);
    if (type == 0){
        //è¯»å–äº’è”ç½‘å›¾ç‰‡--æ‹ç…§å¤§èµ›--åŠ¨æ€è®¡ç®—å†™å…¥æµ·æŠ¥çš„bannerå¤§å°åŠä½ç½®
        BufferedImage articleUrl = ImageIO.read(new URL(banner));
        int urlWidth = articleUrl.getWidth();
        int urlHeight = articleUrl.getHeight();
        int width = 690;
        int height = 615;
        //ä»æ•´ä½“èƒŒæ™¯å›¾çš„å·¦è¾¹29ä½ç½®å¼€å§‹
        int x = 29;
        //ä»æ•´ä½“èƒŒæ™¯å›¾é¡¶éƒ¨55ä½ç½®å¼€å§‹
        int y = 55;
        if (urlWidth &gt;= urlHeight){
            BigDecimal divide = new BigDecimal(width).divide(new BigDecimal(urlWidth), 2, BigDecimal.ROUND_HALF_UP);
            height = new BigDecimal(urlHeight).multiply(divide).intValue();
        }else{
            BigDecimal divide = new BigDecimal(height).divide(new BigDecimal(urlHeight), 2, BigDecimal.ROUND_HALF_UP);
            width = new BigDecimal(urlWidth).multiply(divide).intValue();
            x = (750 - width - x - x) / 2 + 29;
        }
        g.drawImage(articleUrl.getScaledInstance(width,height,Image.SCALE_DEFAULT),x,y,null);
    }else{
        //å°†è¯—è¯å†™å…¥æµ·æŠ¥
        createPeomContent(content, g, back);
    }
    //å°†è§„åˆ™æè¿°å†™å…¥æµ·æŠ¥
    createDescriptionContent(rule, g, back);
    //åˆ›å»ºäºŒç»´ç å¹¶å†™å…¥æµ·æŠ¥
    createQrCode(articleId, g);
    //ä¿å­˜åˆ°æœ¬åœ°
    String iconKey = articleId +"_"+ System.currentTimeMillis()+".png";
    File file = new File(local + iconKey);
    ImageIO.write(img, "png",file);
    //ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘
    DefaultPutRet upload = qiniuUploadTool.upload(FileUtils.readFileToByteArray(file), "articleId/share/qrCode/" + articleId + "/" + UUID.randomUUID().toString());
    //åˆ é™¤æœ¬åœ°æ–‡ä»¶
    file.delete();
    return qiniuProperties.getDomain()+upload.key;
}

private void createQrCode(Long articleId, Graphics g) throws IOException {
    //è·å–å°ç¨‹åºäºŒç»´ç 
    String url = getProductQrCode(articleId,photoPath);
    //è¯»å–äº’è”ç½‘å›¾ç‰‡
    BufferedImage qrCode  = ImageIO.read(new URL(url));
    // ç»˜åˆ¶ç¼©å°åçš„å›¾
    g.drawImage(qrCode.getScaledInstance(174, 174, Image.SCALE_DEFAULT), 535, 1057, null);
    //äºŒç»´ç å­—ä½“
    g.setFont(new Font("å¾®è½¯é›…é»‘", Font.PLAIN, 25));
    g.setColor(new Color(171,171,171));
    //ç»˜åˆ¶æ–‡å­—
    g.drawString("æ‰«ææˆ–é•¿æŒ‰å°ç¨‹åºç ", 514, 1260);
    //å…³é—­
    g.dispose();
}

    private void createDescriptionContent(String rule, Graphics g, BufferedImage back) {
        //æ–‡æ¡ˆæ ‡é¢˜
//        g.setFont(new Font("å¾®è½¯é›…é»‘", Font.BOLD, 34));
//        g.setColor(new Color(29,29,29));
        //ç»˜åˆ¶æ–‡å­—
//        g.drawString("è¯´æ˜", 31, 750);
        //æ–‡æ¡ˆå†…å®¹
        g.setFont(new Font("å¾®è½¯é›…é»‘", Font.PLAIN, 30));
        g.setColor(new Color(102,102,102));
        int fontLen = getWatermarkLength(rule, g);
        //æ–‡å­—é•¿åº¦ç›¸å¯¹äºå›¾ç‰‡å®½åº¦åº”è¯¥æœ‰å¤šå°‘è¡Œ
        int line = fontLen / (back.getWidth() - 90);
        //é«˜åº¦
        int y = back.getHeight() - (line + 1) * 30 - 450;
        //æ–‡å­—å åŠ ,è‡ªåŠ¨æ¢è¡Œå åŠ 
        int tempX = 32;
        int tempY = y;
        //å•å­—ç¬¦é•¿åº¦
        int tempCharLen = 0;
        //å•è¡Œå­—ç¬¦æ€»é•¿åº¦ä¸´æ—¶è®¡ç®—
        int tempLineLen = 0;
        StringBuffer sb =new StringBuffer();
        for(int i=0; i &lt; rule.length(); i++) {
            char tempChar = rule.charAt(i);
            tempCharLen = getCharLen(tempChar, g);
            tempLineLen += tempCharLen;
            if(tempLineLen &gt;= (back.getWidth()-90)) {
                //é•¿åº¦å·²ç»æ»¡ä¸€è¡Œ,è¿›è¡Œæ–‡å­—å åŠ 
                g.drawString(sb.toString(), tempX, tempY + 50);
                //æ¸…ç©ºå†…å®¹,é‡æ–°è¿½åŠ 
                sb.delete(0, sb.length());
                tempY += 50;
                tempLineLen =0;
            }
            //è¿½åŠ å­—ç¬¦
            sb.append(tempChar);
        }
        //æœ€åå åŠ ä½™ä¸‹çš„æ–‡å­—
        g.drawString(sb.toString(), tempX, tempY + 50);
    }

&nbsp; private void createPeomContent(String content, Graphics g, BufferedImage back){
    //è¯—è¯å¤§èµ›
    g.setFont(new Font("å¾®è½¯é›…é»‘", Font.PLAIN, 30));
    g.setColor(new Color(64,64,64));
    //åªå†™å…¥8è¡Œæ–‡å­—--å†…å®¹å¤ªå¤šä»¥ Â·Â·Â·Â·Â·Â· ç»“å°¾
    int fontLineLen = 10;
    int fontLine = 0;
    //æ–‡å­—å¼€å§‹çš„é«˜åº¦
    int y = 0;
    //æ–‡å­—å åŠ ,è‡ªåŠ¨æ¢è¡Œå åŠ 
    int tempX = 50;
    int tempY = y;
    //å•å­—ç¬¦é•¿åº¦
    int tempCharLen = 0;
    //å•è¡Œå­—ç¬¦æ€»é•¿åº¦ä¸´æ—¶è®¡ç®—
    int tempLineLen = 0;
    StringBuffer sb =new StringBuffer();
    for(int i=0; i &lt; content.length(); i++) {
        char tempChar = content.charAt(i);
        tempCharLen = getCharLen(tempChar, g);
        tempLineLen += tempCharLen;
        // å½“æ¯è¡Œå æ»¡è‡ªå®šä¹‰é•¿åº¦åæˆ–è€…å‡ºç° \n æ¢è¡Œ
        if(tempLineLen &gt;= (back.getWidth()-110) || tempChar == '\n') {
            fontLine = fontLine + 1;
            if (fontLine &gt; fontLineLen){
                break;
            }
            //é•¿åº¦å·²ç»æ»¡ä¸€è¡Œ,è¿›è¡Œæ–‡å­—å åŠ 
            g.drawString(sb.toString(), tempX, tempY + 50);
            //æ¸…ç©ºå†…å®¹,é‡æ–°è¿½åŠ 
            sb.delete(0, sb.length());
            tempY += 50;
            tempLineLen =0;
        }
        //è¿½åŠ å­—ç¬¦
        sb.append(tempChar);
    }
    //æœ€åå åŠ ä½™ä¸‹çš„æ–‡å­—
    if (fontLine &gt; fontLineLen){
        g.drawString("......", tempX, tempY + 50);
    }else {
        g.drawString(sb.toString(), tempX, tempY + 50);
    }
 }

&nbsp; public String getProductQrCode(Long articleId, String photoPath) throws IOException {
    File qrCode = null;
    try {
        //æµ·æŠ¥ä¸­çš„å°ç¨‹åºäºŒç»´ç å¿…é¡»pngçš„é€æ˜å½¢å¼
        qrCode = wxMaService.getQrcodeService().createWxaCode(photoPath+"?id=" + articleId,430,true, null,true);
    } catch (WxErrorException e) {
        log.error("åˆ›å»ºç”¨æˆ·äºŒç»´ç é”™è¯¯:{}",e.getMessage());
    }
    DefaultPutRet upload = qiniuUploadTool.upload(FileUtils.readFileToByteArray(qrCode), "articleId/qrCode/" + articleId + "/" + UUID.randomUUID().toString());
    return qiniuProperties.getDomain()+upload.key;
 }

/**
 * è·å–æ°´å°æ–‡å­—æ€»é•¿åº¦
 *@paramwaterMarkContentæ°´å°çš„æ–‡å­—
 *@paramg
 *@returnæ°´å°æ–‡å­—æ€»é•¿åº¦
 */
public int getWatermarkLength(String waterMarkContent, Graphics g) {
    return g.getFontMetrics(g.getFont()).charsWidth(waterMarkContent.toCharArray(),0, waterMarkContent.length());
}
public int getCharLen(char c, Graphics g) {
    return g.getFontMetrics(g.getFont()).charWidth(c);
}

}</code></pre> 
    </blockquote> </li> 
   <li><strong>ğŸ”š</strong></li> 
  </ol>
  <p>ç»“è¯­: è¿™ç¯‡åšå®¢æ˜¯åœ¨æ™šä¸Šåä¸€ç‚¹å¼€å§‹å†™çš„,å†™äº†ä¸‰åˆ†ä¸€åå°±æ²¡å†™äº†,ç„¶åç¬¬äºŒå¤©å‘¨æœ«æ—©ä¸Šèµ·æ¥èŠ±äº†åŠå¤©å†™å®Œçš„! å¸Œæœ›å¯¹åŒå­¦ä»¬æœ‰å¸®åŠ©,å¦å¤–csdnçš„æ’ç‰ˆç¡®å®è¿˜æ˜¯éœ€è¦ä¼˜åŒ–çš„,æˆ‘å·²ç»å°½é‡æ’çš„å¾ˆå¥½äº†,ä¸è¦ä»‹æ„,å†™è¿™è¾¹åšå®¢çš„æ—¶å€™æ‰å‘ å—å¼•ç”¨ æ¯” æ’å…¥ä»£ç æ®µ å¥½ç”¨ä¹Ÿå¥½çœ‹,è¿‡ä¼šå¾—å»æŠŠæˆ‘å…¶ä»–çš„åšå®¢æ’ç‰ˆéƒ½ä¼˜åŒ–äº†æ‰è¡Œ!ç²¾åŠ›æœ‰é™,æš‚æ—¶å°±ä¸æƒ³åœ¨åšå®¢å›­ç­‰å¹³å°ä¸Šå†™äº†!</p> 
  <p>å»ºè®®: åŒå­¦ä»¬åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯è¦å°†ä»£ç ç†è§£é€,ä¸è¦åªä¸ºè¾¾åˆ°ç›®çš„è€Œå¼•ç”¨/å¥—ç”¨,æˆ‘çš„ä»£ç æ¯ä¸€è¡Œæ³¨é‡Šå·²ç»éå¸¸è¯¦ç»†äº†,ä¸æ‡‚çš„åœ°æ–¹è¿˜æ˜¯ä»”ç»†çœ‹ä¸€ä¸‹å§,æœ‰åˆ©äºæ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šåˆ¶åŒ–å¼€å‘!</p> 
  <p>æœ€åä¸€ç‚¹å°å¿ƒæ€: è§‰å¾—å¯¹è‡ªå·±æœ‰ç”¨çš„åŒå­¦ä»¬ç»™æˆ‘ç‚¹ä¸ªèµğŸ‘å§,è¦æ˜¯å…³æ³¨ä¸€ä¸‹å°±æ›´å¥½äº†,åšä¸»å†™çš„ä¸å¥½çš„åœ°æ–¹,è¯·å¤šè§è°…!</p> 
  <p><img alt="" class="has" height="289" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512165725769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1ODM0OTk4,size_16,color_FFFFFF,t_70" width="289"></p> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="æŸšå­ç¤¾åŒº">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>æœ€æ–°èµ„è®¯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">é‚®ç®±</a>
    
    <a href="https://uzshare.com" target="_blank">æŸšå­ç¤¾åŒº</a>
    
    <a href="https://uzzz.org" target="_blank">æ‰¾ç»„ç»‡</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">æœ€æ–°</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[åŸåˆ›è½¯ä»¶] [è½¯ä»¶å‘å¸ƒ] å®šæ—¶å¤‡ä»½æ–‡ä»¶å‘é€é‚®ç®±ï¼Œä¸å†æ€•æ•°æ®ä¸¢å¤±äº†</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Getæ™ºèƒ½å†™ä½œæ»¡æœˆè®° â€”â€”äº§å“ç¯‡</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">ã€Šæ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql å¤šè¡¨è”æŸ¥ä¹‹è¿æ¥æŸ¥è¯¢</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golangåŸºç¡€(äºŒ)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">ä»Šæ—¥ä»½çš„PTAåˆ·é¢˜</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Androidä¹‹æŠ˜çº¿å›¾</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Androidä¹‹å®ç°é€‰ä¸­æ—¶æ”¹å˜æ ·å¼</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">ç›®å½•</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
