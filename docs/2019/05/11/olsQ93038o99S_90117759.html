<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>iOS开发笔记— Extension、iOS9Crash、Pod库和CFDictionary相关 « NotBeCN</title>
  <meta name="description" content="                   作者丨落影loyinglin   https://www.jianshu.com/p/97b8912c4124      前言      分享iOS开发中遇到的问题，和相关的一些思考，本次内容包括：Extension、iOS9Crash、Pod库和CFDictionary相关...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/11/olsQ93038o99S_90117759.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">iOS开发笔记— Extension、iOS9Crash、Pod库和CFDictionary相关</h1>
    <p class="post-meta">May 11, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p><a href="https://mp.weixin.qq.com/s?__biz=MzU3MzYzODA5Mw==&amp;mid=2247483894&amp;idx=1&amp;sn=040ab4646ed4965a6051d657055a17b7&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/8RTSPr4mlymQIOAOprl2wFb5VhM3ddqGW0yryF6m2bia0AmyoPu0wVrGbpCqUWB0hk4wRaWfvBz0tJHPdX2qsyQ/640?wx_fmt=gif" alt="640?wx_fmt=gif"></span></a></p>
   <p style="line-height:36.2667px;letter-spacing:1px;"><span style="font-size:14px;color:rgb(136,136,136);"><br></span></p>
   <p style="line-height:36.2667px;letter-spacing:1px;"><span style="font-size:14px;color:rgb(136,136,136);">作者丨落影loyinglin<br></span></p>
   <p style="line-height:36.2667px;letter-spacing:1px;"><span style="font-size:14px;color:rgb(136,136,136);">https://www.jianshu.com/p/97b8912c4124</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">前言</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">分享iOS开发中遇到的问题，和相关的一些思考，本次内容包括：Extension、iOS9Crash、Pod库和CFDictionary相关。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">正文</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><strong><span style="font-size:16px;color:rgb(74,74,74);">一、OC的Extensions特性</span></strong></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">先看下图，这是一段Category中的代码：（SSPageControllManager+Report.h文件中）</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/foPACGrddJ38aAVQDRAgoaTCRtUDDrW6LQFRkfM6E9PRrrr1AAblicAwS77NcoN3PE9p99B2cMrHYGOfyL3yXzw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">SSPageControllManager+Report.h</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">关于蓝色框内的代码，有几个疑问：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">1、是否可以放在SSPageControllManager+Report.h文件中运行并且访问声明的属性？</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">2、如果放在SSPageControllManager+Report.m文件呢？</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">3、这部分代码和SSPageControllManager.h的中的extension有什么区别？</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">在回复上面的疑问之前，我们先回顾下创建Extension的过程：通过Xcode的command+N新建文件，选择Objective-C File，再选择Extension；</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><img style="border-width:0px;" title="1552894551683387.png" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/foPACGrddJ38aAVQDRAgoaTCRtUDDrW6lxePfbnvb8rD9Ysqz8JtSPvRemyzZqbgfV20s5B0F15Ka2j89rQblQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">如上，新建的是一个SSPageControllManager+Property.h文件，并且没有生成.m文件。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@interface</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSPageControllManager</span>&nbsp;()</span><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@end</span><br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="667" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">对于疑问1----是否可以在SSPageControllManager+Report.h中写Extension（蓝色框的代码）并且运行时去访问声明的属性？答案是可以的，因为SSPageControllManager+Report.h是一个头文件，在头文件写Extension就是标准生成的Extension（上面的代码块）；</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">对于疑问2----如果想在SSPageControllManager+Report.m中使用Extension，则需要手动实现getter和setter，否则实现时会因为访问不到_xx的属性而crash；</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">对于疑问3----Extension写在哪里的位置并不重要，核心是在于SSPageControllManager.m中要能引导到这个文件，以便于编译时SSPageControllManager.m能够自动添加对应的_xx属性。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">因此，如果我们使用xx+Property.h的Extension来管理属性时，则一定要xx.m的文件中include这个头文件，否则属性无法正常初始化。比如说xx.m不引入xx+Property.h，然后在xx+report.m中去引用xx+Property.h中的属性，则会出现异常。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <blockquote>
    <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">Extension和Category一个核心的区别，就在于能否在xx.m中去引用对应的头文件。</span></p>
   </blockquote>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">那么问题来了，如果我在Category的@interface代码块中声明属性，然后在.m引用对应的头文件，是否能够访问testCategoryStr这个属性？</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@interface</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSPageControllManager</span>&nbsp;(<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">Report</span>)</span><br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@property</span>&nbsp;(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">nonatomic</span>,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">strong</span>)&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">NSString</span>&nbsp;*testCategoryStr;<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@end</span><br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="667" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">很遗憾，并不能。只有Extension的声明方式，并且在.m文件中引用，编译器才会自动添加_xx的属性。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">不过，getter和setter还是会正常创建，所以可以通过下面的方式来“动态添加”属性。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">SSPageControllManager.h如下：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@interface</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSPageControllManager</span>&nbsp;(<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSUtil</span>)</span><br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@property</span>&nbsp;(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">nonatomic</span>,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">strong</span>)&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">NSDate</span>&nbsp;*ssStoreDate;<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@end</span><br></p>
   <table cellpadding="0" cellspacing="0">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="611" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">SSPageControllManager.m如下：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@implementation</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSPageControllManager</span>&nbsp;(<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">SSUtil</span>)</span><br><br>-&nbsp;(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">NSDate</span>&nbsp;*)ssStoreDate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;objc_getAssociatedObject(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>,&nbsp;_cmd);<br>}<br><br>-&nbsp;(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">void</span>)setSsStoreDate:(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">NSDate</span>&nbsp;*)storeDate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;objc_setAssociatedObject(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@selector</span>(ssStoreDate),&nbsp;storeDate,&nbsp;OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>}<br><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">@end</span><br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="956" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">Extension</span></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);">https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">二、 iOS 9: Caught "CALayerInvalidGeometry", "sublayer with non-finite position [inf inf]"</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">该问题发生在对view进行截图时，截图的代码如下：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);">-&nbsp;(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIImage</span>&nbsp;*)captureView:(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIView</span>&nbsp;*)view&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGRect</span>&nbsp;rect&nbsp;=&nbsp;view.bounds;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsBeginImageContextWithOptions</span>(rect.size,&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">YES</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>f);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGContextRef</span>&nbsp;context&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsGetCurrentContext</span>();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGAffineTransform</span>&nbsp;transform&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGAffineTransformMake</span>(<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">-1.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1.0</span>,&nbsp;rect.size.width,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGContextConcatCTM</span>(context,transform);<br>&nbsp;&nbsp;&nbsp;&nbsp;[view.layer&nbsp;renderInContext:context];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIImage</span>&nbsp;*image&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsGetImageFromCurrentImageContext</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsEndImageContext</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;image;<br>}<br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="903" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">仅在iOS9的时候，会发生CALayerInvalidGeometry的crash。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/foPACGrddJ38aAVQDRAgoaTCRtUDDrW6WfLyLicMahwiaW50UQULXdfYlqCDLwuyNYHHyibcCplckicvIJd0MGw94w/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">在复现的过程发现将width设置为0，并不会触发该问题，需要view的rect为 CGRectNull 时才会触发。<br></span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>.timeLabel.frame&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGRectNull</span>;<br></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">这行代码可以复现，且iOS12不会crash，仅在iOS9会crash；</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">问题修复：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">问题的触发是因为在render时，存在某些view的rect为 CGRectNull；那么可以尝试通过遍历视图树，检查是否存在异常view。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">CGRectNull判断方法：CGRectIsNull(view.frame)。注意不是CGRectIsNull(view.bounds)，通过frame的值来看，可以判断出来：frame = (inf inf; 0 0);</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">从这里可以看出，为什么前面仅仅设置width=0没有触发crash。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <blockquote>
    <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">CGRectNull与CGRectZero不同，上面的frame可以看出。</span></p>
   </blockquote>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">最终修复方案是增加判断方法checkNullRect：（如果业务需要一定返回图片，那么可以返回空，也可以将其frame设置为CGRectZero但是不合理，可能影响其他业务逻辑）</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);">-&nbsp;(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">BOOL</span>)checkNullRect:(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIView</span>&nbsp;*)view&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">BOOL</span>&nbsp;ret&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGRectIsNull</span>(view.frame);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">for</span>&nbsp;(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIView</span>&nbsp;*subView&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">in</span>&nbsp;view.subviews)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;ret&nbsp;||&nbsp;[<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>&nbsp;checkNullRect:subView];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(ret)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSLOG_ERROR(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">@"zero&nbsp;frame,&nbsp;view:%@"</span>,&nbsp;view);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;ret;<br>}<br><br>-&nbsp;(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIImage</span>&nbsp;*)captureView:(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIView</span>&nbsp;*)view&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;([<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">self</span>&nbsp;checkNullRect:view])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">nil</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGRect</span>&nbsp;rect&nbsp;=&nbsp;view.bounds;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsBeginImageContextWithOptions</span>(rect.size,&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">YES</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>f);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGContextRef</span>&nbsp;context&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsGetCurrentContext</span>();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGAffineTransform</span>&nbsp;transform&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGAffineTransformMake</span>(<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">-1.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1.0</span>,&nbsp;rect.size.width,&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0.0</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CGContextConcatCTM</span>(context,transform);<br>&nbsp;&nbsp;&nbsp;&nbsp;[view.layer&nbsp;renderInContext:context];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIImage</span>&nbsp;*image&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsGetImageFromCurrentImageContext</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">UIGraphicsEndImageContext</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;image;<br>}<br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="903" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">三、Pod库相关</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">配置Podfile，执行pod install之后，工程一切正常。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">但是当我把LYTest.project的Build Active Architecture Only属性设置为No之后，就出现了异常：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">Target 'Pods-LYTest' of project 'Pods' was rejected as an implicit dependency for 'libPods-LYTest.a' because its architectures 'x86_64' didn't contain all required architectures 'i386x86_64'</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><img style="border-width:0px;" title="1552894729625549.png" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/foPACGrddJ38aAVQDRAgoaTCRtUDDrW6nMkCIDex4fljL7x3ibCibAcmuvvopeXa62gPpURRGZxyicqEfqLGNdib0A/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">Build Active Architecture Only属性</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">尝试重新pod install，问题仍存在。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">通过检查pod库的设置，发现是因为pod库的Build Active Architecture Only属性在debug默认为Yes； &nbsp;而LYTest.project的设置为No，所以libPods-LYTest.a中缺少了i386的architecture。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">手动将pod库的Build Active Architecture Only属性设置为No，问题可以解决。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">但是在每次pod install之后，仍需要手动修改Pod库的工程设置，总感觉应该可以通过脚本完成这个过程。</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">最后在StackOverflow中得到启发：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);">post_install&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|installer_representation|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;installer_representation.project.targets.each&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|target|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target.build_configurations.each&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|config|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.build_settings[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'ONLY_ACTIVE_ARCH'</span>]&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'NO'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="667" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">但是上面的代码插入podfile之后，会出现下面的问题：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><img style="border-width:0px;text-align:center;" title="1552894832413428.png" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/foPACGrddJ38aAVQDRAgoaTCRtUDDrW6G4rrS2ePqZdR3yia8PcwOWjwUMiczatUpQAxmjbypEctGvt99QAYl0JQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">分析代码逻辑和上面的error提示，可以发现这里的installer_representation.project修改的应该是project的设置，将其改为installer_representation.pods_project，问题得到解决。<br></span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);">post_install&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|installer_representation|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;installer_representation.pods_project.targets.each&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|target|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target.build_configurations.each&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">do</span>&nbsp;<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">|config|</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config.build_settings[<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'ONLY_ACTIVE_ARCH'</span>]&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'NO'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">end</span><br></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">四、CFDictionary的创建</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">最近对一段CFDictionary的创建代码产生好奇：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">CFDictionaryCreateMutable(CFAllocatorGetDefault(), 0, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">kCFTypeDictionaryKeyCallBacks和kCFTypeDictionaryValueCallBacks是什么？</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">于是展开来看，kCFTypeDictionaryKeyCallBacks是5个callback加1个version组成。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">typedef</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">struct</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryRetainCallBack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">retain</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryReleaseCallBack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;release;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryCopyDescriptionCallBack</span>&nbsp;copyDescription;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryEqualCallBack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equal;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryHashCallBack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash;<br>}&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFDictionaryKeyCallBacks</span>;<br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="667" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">其中的retain，对应的类是CFDictionaryRetainCallBack；</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">typedef const void * (*CFDictionaryRetainCallBack)(CFAllocatorRef allocator, const void *value);</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">到这里，我们能明白这5个方法分别是对key做retain、release、copy，判断等于，hash时会用到的方法，并且我们可以知道如果需要对key被retain时做额外处理，可以按照如下实现：</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);letter-spacing:1px;background:rgb(40,43,46);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">void</span>&nbsp;*keyRetainCallBack(<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">CFAllocatorRef</span>&nbsp;allocator,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">const</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">void</span>&nbsp;*&nbsp;value)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">id</span>&nbsp;obj&nbsp;=&nbsp;(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">id</span>)value;<br>&nbsp;&nbsp;&nbsp;&nbsp;[obj&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">retain</span>];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;do&nbsp;something</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;obj;<br>}<br></p>
   <table cellpadding="0" cellspacing="0" width="654">
    <tbody style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
     <tr style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;">
      <td width="667" style="border-width:0px;line-height:1.1em;vertical-align:baseline;font-size:1em;background-image:none;"><br></td>
     </tr>
    </tbody>
   </table>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">CF是内存是手动管理，而CFDictionary作为容器类，需要知道当key、value被添加到容器时，应该如何处理key、value的引用，所以需要两个参数kCFTypeDictionaryKeyCallBacks和kCFTypeDictionaryValueCallBacks。默认的实现就是在添加时进行CFRetain，在移除时进行CFRelease。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(0,82,255);"><img class="__bg_gif" style="color:rgb(0,128,255);font-family:'宋体';font-size:8px;text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif">总结</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">关于Extension已经学习过很久，但是这次的尝试让我重新回顾脑海中对Extension的了解；相比之下，Category是大家注意的重点，甚至连源码层面如何实现的Category都有相关文章。</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">保持刨坑问底的习惯，遇到问题时尽量去探究更深一层的原因，这样自己的知识层便会慢慢扩展。或许一开始了解的都是很简单的问题，但是随着简单的问题一一解决，对于更难的问题就可以综合已经学会的基础知识作为支撑尝试解决，久而久之就能触类旁通。</span></p>
   <p style="font-size:15px;text-align:center;"><strong><span style="color:rgb(255,255,255);font-size:18px;"><br></span></strong></p>
   <p style="font-size:15px;text-align:center;"><strong><span style="color:rgb(255,255,255);font-size:18px;">【无门槛免费领】</span></strong></p>
   <p style="font-size:15px;text-align:center;"><span style="color:rgb(255,255,255);">535G超强程序员编程</span></p>
   <p style="font-size:15px;text-align:center;"><span style="color:rgb(255,255,255);">0基础从入门到精通自学视频教程！</span></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzI4MDYwMDc3MQ==&amp;mid=2247486621&amp;idx=3&amp;sn=d7ae9b960151087e686cbee49872fb1f&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2klvELib7ra3wLTlKc4lbASNiacP90NxA1EPsKklCpgqjOvHH5YcMmjia2Q/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3NzM0NzkxMQ==&amp;mid=2655361536&amp;idx=3&amp;sn=05e529ae03efc186376987dd9e848084&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="width:160px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kTSntwcWft9kQxRf9YgShKk2ZM26U227HcCiccpEmlWLXw9gRooJPQyA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzI0NjYxMDQ4OQ==&amp;mid=2247487388&amp;idx=4&amp;sn=3f4610ea77cc47a59d7ec65d902e12b7&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:161px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2k2yc9snlIBWbDV98T7dibI5z66J5EiaGiaOnZfx3pZkhibiaib4zooXyqbFBA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzUyODg4Nzk2MQ==&amp;mid=2247492362&amp;idx=5&amp;sn=983b2932f6795efd9da183e4e59d2e11&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:left;width:104px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/ibiaYwFpa0guckpSaQGIiaTs6TYsXFJ3BA0KDxbKeVqdYjqeh8uIoZdFDnfUcGzX30dRYiallzaeQmomOehiawd9Kcg/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzUzMDk2MjA0MA==&amp;mid=2247484143&amp;idx=3&amp;sn=a70084e27c5740d7e19503ba1b5eaeb5&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kznSq5yZ1TGUbtNOVjkSNpoHQBHibyMpBsKW8rWkqZqPicDZgdQ5LM91g/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzI1OTQwOTg2Mg==&amp;mid=2247488539&amp;idx=4&amp;sn=a16194d52089e9ae85a49a3e21aa4bd7&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2ke5Ctg1Z2khwz0PwTTiapibKuqyWR1qxLva4tqH7LEFZjnvBRrlus7ibDQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzIwMDU3MDkzNg==&amp;mid=2651307540&amp;idx=3&amp;sn=051698c9c4f56fdd1301e524749d5b99&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kenadDicc2ibZzTzqPiaKURsxmdWx5LstLK4vDBMWoib2e2SXME3m8nOf3w/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzU2MzcxNzgwMg==&amp;mid=2247484644&amp;idx=3&amp;sn=29ca989edcfb57ad6edf669747a8107d&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:106px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kqqChObQ7m5diadVEkUsDn355XkaysjiaeKwue5xtZicriaSPcDapnHYJ4w/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzI3MTEzMDI2MA==&amp;mid=2654091713&amp;idx=3&amp;sn=8555022d5d22f179b0e4d2991b7feb47&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:106px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2k0wBdiaFyrdXCYKddxdz66HhXLSFHSe4Nv4Sib21JicDY748T1TJnQWlGw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY5OTExNg==&amp;mid=2247483870&amp;idx=3&amp;sn=f605dd14202b9f9ae25bd319a4b15d36&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2ka7TiaroWmHw38E50VA8QzmdCWHxQdlYcsrmVmrJMNghDUK0lRXnZvSg/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzU0ODk2MTY5Mw==&amp;mid=2247483981&amp;idx=3&amp;sn=0098c9107f1138a31e1594b02be5f32a&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kwqNRqLiaLdW3CSO9DsztOShW6J8aKdAoNK6nWaQicQyaH5HzsGHRVuJQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzIwMDU3MDkzNg==&amp;mid=2651307540&amp;idx=3&amp;sn=051698c9c4f56fdd1301e524749d5b99&amp;scene=21#wechat_redirect" rel="nofollow" style="text-align:left;"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="width:105px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kenadDicc2ibZzTzqPiaKURsxmdWx5LstLK4vDBMWoib2e2SXME3m8nOf3w/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MzU4MjcyODg2Mw==&amp;mid=2247484262&amp;idx=3&amp;sn=c92ce68dea669f03784895dd63c6a818&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="width:78px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kmewtZfM0fp6XJKAlDicx9Cxyc2wibbJPkeHiaBPUukcx0sshiaMMxWQL7Q/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzU0ODk2MTY5Mw==&amp;mid=2247483981&amp;idx=3&amp;sn=0098c9107f1138a31e1594b02be5f32a&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:78px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kxN2Ets5CMosXpXaPicqxeSVGgicO67ibPWRWx4khkpQHXSjMhLIsjUddA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MzI3OTg3OTQzMw==&amp;mid=2247484017&amp;idx=3&amp;sn=19bc888c1bfa5c85ea3c77b3b892451c&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:78px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kqU2IzcBcIGuVribvo70kic2ZUWcK9Dd0WZGpJD3JK5sCh9iaNgnyRiaIJg/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=Mzg5MzAyNDI4Mw==&amp;mid=2247483874&amp;idx=3&amp;sn=786bac8e913943c54663d29564e0d0b4&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img class="rich_pages" style="text-align:center;width:78px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/xw5fFkGFD7kduWDTuqFJyxvy4mtx7M2kc9QgcrUEficy9LOLdUbZ28oB2EWpFfw0CiaHWZQF35ib3vTO2p30kDaibA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/ol72Wnba7fLkfGhCjKwHfZOmHMkVTIomtmHARHGo86u52ZIGicxfPPFBQ85dBUWf3trqDHPUuN7E2e26DpvfJdQ/640?wx_fmt=png" alt="640?wx_fmt=png">万水千山总是情，点个 “
   <strong><span style="color:rgb(0,112,192);">在看</span></strong>” 行不行
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
