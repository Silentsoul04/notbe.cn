<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WebGL three.js学习笔记 加载外部模型 以及 Tween.js动画 « NotBeCN</title>
  <meta name="description" content="                   WebGL three.js学习笔记 加载外部模型以及Tween.js动画   本文的程序实现了加载外部stl格式的模型，以及学习了如何把加载的模型变为一个粒子系统，并使用Tween.js对该粒子系统进行动画设置   模型动画demo演示(网页加载速度可能会比较慢)   de...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/11/nsytsqdtn_90116628.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">WebGL three.js学习笔记 加载外部模型 以及 Tween.js动画</h1>
    <p class="post-meta">May 11, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-tomorrow-night-eighties"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h2><a id="WebGL_threejs_Tweenjs_0"></a>WebGL three.js学习笔记 加载外部模型以及Tween.js动画</h2> 
  <p><strong>本文的程序实现了加载外部stl格式的模型，以及学习了如何把加载的模型变为一个粒子系统，并使用Tween.js对该粒子系统进行动画设置</strong></p> 
  <h2><a id="demohttpsnsytsqdtngithubiodemonaval_craftnaval_craft_2"></a><a href="https://nsytsqdtn.github.io/demo/naval_craft/naval_craft" rel="nofollow">模型动画demo演示</a>(网页加载速度可能会比较慢)</h2> 
  <p><strong>demo地址：<a href="https://nsytsqdtn.github.io/demo/naval_craft/naval_craft" rel="nofollow">https://nsytsqdtn.github.io/demo/naval_craft/naval_craft</a></strong></p> 
  <p><strong>demo截图如下：</strong><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190511223449989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25zeXRzcWR0bg==,size_16,color_FFFFFF,t_70" alt="naval_craft"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190511223534778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25zeXRzcWR0bg==,size_16,color_FFFFFF,t_70" alt="naval_craft"></p> 
  <p>原模型截图：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190511224034936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25zeXRzcWR0bg==,size_16,color_FFFFFF,t_70" alt="原模型"><br> 在我们写three.js的网页的时候，大多时候并不需要我们去手动建立模型，一些复杂的模型都是通过建模软件去完成，所以在这里去学习如何去将外部的模型加载到我们的网页中来。</p> 
  <p>three.js支持导入的模型有很多，包括我们常见的OBJ、FBX、STL、PLY、JSON等等格式，在这个程序中，我选择了使用STL模型来进行学习。</p> 
  <p>.stl 文件是在计算机图形应用系统中，用于表示三角形网格的一种文件格式，常用于3d打印技术使用，因为STL格式的文件在网上可以免费不用注册的下载，比较方便。这里推荐一个还不错的网站，<a href="http://www.3dhoo.com/model" rel="nofollow">http://www.3dhoo.com/model</a> ，里面有很多免费直接下载STL格式的模型。</p> 
  <h2><a id="_18"></a>加载外部模型</h2> 
  <p>在three.js中，我们要加载外部模型，就需要引入相应的js文件。比如我需要引入STL格式的文件，我就引入“three.js\examples\js\loaders\STLLoader.js”，其他格式的js文件在loaders文件夹也都能找到，如果是three.js没有支持导入的模型格式，就需要自己写一个加载器，网上也有许多的教程。</p> 
  <p>引入相应js文件以后，我们首先要做的事创建一个加载器。</p> 
  <pre><code class="prism language-javascript"><span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>STLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建stl的加载器，用加载器来加载stl模型</span>
</code></pre> 
  <p>我们要使用该加载器加载模型，就需要调用loader .load(filename,onSuccess(bufferGeometry),onProgress(xhr),onError(error))这个方法<br> <strong>其中：</strong><br> <strong>filename是模型的路径<br> onSuccess(bufferGeometry)是加载成功后回调处理(参数为生成的模型的几何体)，</strong></p> 
  <blockquote> 
   <p><strong>注意：这里的几何体不是我们常用的geometry，而是bufferGeometry，它和geometry还是有一些的区别，但是也都可以作为THREE.Mesh（）的第一个参数穿进去。具体可以进行百度。</strong></p> 
  </blockquote> 
  <p><strong>onProgress(xhr)是加载过程中回调处理(xhr对象属性可计算出已完成加载百分比)<br> onError(error)是失败回调处理方法</strong><br> 一般我们只需要使用前两个参数就可以完成工作。</p> 
  <pre><code class="prism language-javascript"><span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>STLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建stl的加载器，用加载器来加载stl模型</span>
<span class="token keyword">let</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../../../asset/ship.stl"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//加载模型的方法，</span>
<span class="token comment">//第一个参数是模型的路径，第二个参数时候我们定义的回调函数，一旦模型加载成功，回调函数就会被调用</span>
<span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">,</span>material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>一般只需要这样写回调函数，模型就可以成功加载。<br> 但我在这里想根据该模型去创建一个粒子系统，像本文开头的那样，所以我们需要改一下代码。</p> 
  <pre><code class="prism language-javascript">        <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>STLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建stl的加载器，用加载器来加载stl模型</span>
        group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../../../asset/ship.stl"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//加载模型的方法，第一个参数是模型的路径，第二个参数时候我们定义的回调函数，一旦模型加载成功，回调函数就会被调用</span>
            <span class="token keyword">let</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromBufferGeometry</span><span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//stl模型加载到js里就会变成bufferGeometry类型，我们先用一个方法把它变成Geometry类型</span>
            loadGeometry <span class="token operator">=</span> geometry<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建该geometry的克隆体，后面会用到</span>
            <span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointsMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//点云的材质</span>
                color<span class="token punctuation">:</span> <span class="token number">0xffffff</span><span class="token punctuation">,</span>
                transparent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                size<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token comment">//可自由修改看看效果</span>
                blending<span class="token punctuation">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>AdditiveBlending<span class="token punctuation">,</span>
                map<span class="token punctuation">:</span> <span class="token function">generateSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//自定义画布图案来充当每一个粒子的材质</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//创建点云，以及设置它的位置及旋转角度，调整到最好看的地方</span>
            group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Points</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
            group<span class="token punctuation">.</span>sortParticles <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            group<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            group<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-=</span><span class="token number">70</span><span class="token punctuation">;</span>
            group<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
  <p><strong>其中：<br> 我们使用THREE.Geometry().fromBufferGeometry(bufferGeometry)函数把bufferGeometry类型改为geometry类型，因为该类型我们更加熟悉，后面使用起来也比较方便。</strong></p> 
  <p>generateSprite()函数是在之前的文章也介绍过的，创建一个颜色渐变的画布，来充当粒子系统纹理，这里就不再赘述了。具体代码如下：</p> 
  <pre><code class="prism language-javascript"><span class="token comment">//自定义渐变颜色的画布，前面的文章有介绍，这个方法在写three.js程序很常用</span>
    <span class="token keyword">function</span> <span class="token function">generateSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> gradient <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createRadialGradient</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'rgba(255,255,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,255,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,0,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,0,0,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Texture</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> texture<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
  <h2><a id="Tweenjs_100"></a>Tween.js动画</h2> 
  <p>tweenjs 是使用 JavaScript 中的一个简单的补间动画库，支持数字、对象的属性和 CSS 样式属性的赋值。<br> tweenjs 以平滑的方式修改元素的属性值，需要传递给 tween 要修改的值、动画结束时的最终值和动画花费时间，之后 tween 引擎就可以计算从开始动画点到结束动画点之间值，从而产生平滑的动画效果。</p> 
  <p>我们首先需要引入tween.js文件，该文件的路径是“three.js\examples\js\libs\tween.min.js”，也可以直接百度搜索tween.js去下载。<br> 具体的用法是：</p> 
  <pre><code class="prism language-javascript"><span class="token keyword">let</span> posSrc <span class="token operator">=</span> <span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//创建一个posSrc的对象，该对象里面有pos的属性，并初始化该属性为0</span>
<span class="token keyword">let</span> tween <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建tween的补间动画，使posSrc中的pos属性的值在5000ms内从0到1变化</span>
tween<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span>
</code></pre> 
  <p>我们创建了TWEEN.Tween对象，这个对象会确保x属性值在5000毫秒内从0变化到1。通过Tweenjs,你还可以指定属性值是如何变化的，是线性的、指数性的，还是其他任何可能的方式。属性值在指定时间内的变化被称为easing(缓动)，在Tween.js中你可以使用easing()方法来配置缓动效果。我们还可以创建更多的TWEEN.Tween对象，并使用chain(TWEEN.Tween)函数链接多个补间动画。</p> 
  <p>我们还需要一个update的函数，在每次更新补间的时候，都可以去更新每个粒子的位置，来实现的动画效果。</p> 
  <pre><code class="prism language-javascript">            <span class="token keyword">let</span> posSrc <span class="token operator">=</span> <span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//创建一个posSrc的对象，该对象里面有pos的属性</span>
            <span class="token comment">//并初始化该属性为0</span>
            <span class="token keyword">let</span> tween <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建tween的补间动画</span>
            <span class="token comment">//使posSrc中的pos属性的值在5000ms内从0到1变化</span>
            tween<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span>
            <span class="token keyword">let</span> tweenStand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//让动画在pos的值</span>
            <span class="token comment">//变为1后停止一段时间，方便我们观察，所以再创建一个tween，让pos从1到1（即不变）</span>
            tween<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span>
            <span class="token keyword">let</span> tweenBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建tweenBack的</span>
            <span class="token comment">//补间动画，和初始相反，使posSrc中的pos属性的值在5000ms内从1到0变化</span>
            tweenBack<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span>
            <span class="token comment">//每一个补间动画之间使用chain()连接起来</span>
            tween<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tweenStand<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tweenStand<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tweenBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tweenBack<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tween<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//在补间的过程中，让所有的粒子开始移动</span>
            <span class="token keyword">let</span> <span class="token function-variable function">onUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> pos <span class="token operator">=</span> posSrc<span class="token punctuation">.</span>pos<span class="token punctuation">;</span><span class="token comment">//定义一个pos，赋值为posSrc对象的pos属性</span>
                <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                loadGeometry<span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//遍历每个顶点</span>
                <span class="token comment">//这里需要遍历刚刚克隆的geometry</span>
                <span class="token comment">//（暂时不是很明白这点，反正如果遍历group.geometry.vertices</span>
                <span class="token comment">//动画系统会让整个物体一起移动，没有伸展开来的效果）。</span>
                    <span class="token keyword">var</span> newZ <span class="token operator">=</span> e<span class="token punctuation">.</span>z <span class="token operator">*</span> pos<span class="token punctuation">;</span><span class="token comment">//得到新的Z值，根据当前的pos值去改变</span>
                    group<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">[</span>count<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>x<span class="token punctuation">,</span> e<span class="token punctuation">.</span>y<span class="token punctuation">,</span> newZ<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置每个顶点的位置</span>
                    <span class="token comment">//group.geometry.vertices是数组类型，所以用count作为索引</span>
                    group<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>verticesNeedUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//重要，不然会没有动画效果</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                group<span class="token punctuation">.</span>sortParticles <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//tween在每次更新后会执行tween.onUpdate()函数</span>
            <span class="token comment">//里面的参数就是我们自定义要让它如果去运动的函数，即上面写的onUpdate</span>
            tween<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tweenStand<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tweenBack<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>

            tween<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启tween</span>
</code></pre> 
  <p>在这段代码中，我们创建了三个个补间: tween、tweenStand、tweenBack。第一个补间定义了position属性如何从1过渡到0,第三个刚好相反，第二个是让动画暂时停下。通过chain(方法可以将这三个补间衔接起来，这样当动画启动之后，程序就会在这三个补间循环。代码最后定义的是onUpdate()方法，这个方法遍历粒子系统中的所有顶点，并使用补间(this.pos)提供的位置更新顶点的位置。</p> 
  <p><strong>补间动画需要在模型加载完成后就启动，所以我们在下面的函数末尾调用tween.start()方法:</strong></p> 
  <p>如果之前没有把bufferGeometry转化为Geometry类型，要去更改每个顶点的位置会变得比较麻烦。</p> 
  <p><strong>最后还需要告知three.js什么时候刷新所有的补间动画，所以在render()函数里加上TWEEN.update();</strong></p> 
  <pre><code class="prism language-javascript"> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">TWEEN</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通知TWEEN在什么时候去刷新补间动画，重要，否则会没有动画</span>
        <span class="token comment">//性能监控器的更新</span>
        stats<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        renderer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
        renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
  <p>到了这里，程序的大体就已经完成，剩下的就是创建场景，摄像机，渲染器等等东西以及调整模型的位置。这里不再赘述。</p> 
  <h2><a id="_177"></a>完整的代码如下:</h2> 
  <pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Naval Craft Sprite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/three.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/stats.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/Setting.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/OrbitControls.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/tween.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../import/STLLoader.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token style language-css"> <span class="token selector">div#WebGL-output</span> <span class="token punctuation">{</span> <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 850px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> #333333<span class="token punctuation">;</span> <span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>threeStart()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WebGL-output<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"> <span class="token keyword">let</span> camera<span class="token punctuation">,</span> renderer<span class="token punctuation">,</span> scene<span class="token punctuation">,</span>controller<span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">initThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//渲染器初始化</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> antialias<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token comment">//抗锯齿开启</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置渲染的大小</span> renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置渲染的颜色</span> renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token number">0x333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span> renderer<span class="token punctuation">.</span>shadowMapEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//开启阴影的渲染</span> renderer<span class="token punctuation">.</span>shadowMapType <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap<span class="token punctuation">;</span><span class="token comment">//设置阴影类型为柔和</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"WebGL-output"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将渲染添加到div中</span> <span class="token comment">//初始化摄像机，这里使用透视投影摄像机</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相机的位置，自由调整</span> camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//设置摄像机的上方向为哪个方向，这里定义摄像的上方为Y轴正方向</span> camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//摄像机对准的地方</span> camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化场景</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//相机的移动</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//相机围绕旋转的目标，设置为原点</span> controller<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">let</span> loadGeometry<span class="token punctuation">;</span> <span class="token keyword">let</span> group<span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">initObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>STLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建stl的加载器，用加载器来加载stl模型</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../../asset/naval_craft.stl"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//加载模型的方法，第一个参数是模型的路径，第二个参数时候我们定义的回调函数，一旦模型加载成功，回调函数就会被调用</span> <span class="token keyword">let</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromBufferGeometry</span><span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//stl模型加载到js里就会变成bufferGeometry类型，我们先用一个方法把它变成Geometry类型</span> loadGeometry <span class="token operator">=</span> geometry<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建该geometry的克隆体，后面会用到</span> <span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointsMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//点云的材质</span> color<span class="token punctuation">:</span> <span class="token number">0xffffff</span><span class="token punctuation">,</span> transparent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token comment">//可自由修改看看效果</span> blending<span class="token punctuation">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>AdditiveBlending<span class="token punctuation">,</span> map<span class="token punctuation">:</span> <span class="token function">generateSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//自定义画布图案来充当每一个粒子的材质</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建点云，以及设置它的位置及旋转角度，调整到最好看的地方</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Points</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>sortParticles <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-=</span><span class="token number">70</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">let</span> posSrc <span class="token operator">=</span> <span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//创建一个posSrc的对象，该对象里面有pos的属性，并初始化该属性为0</span> <span class="token keyword">let</span> tween <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建tween的补间动画，使posSrc中的pos属性的值在5000ms内从0到1变化</span> tween<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span> <span class="token keyword">let</span> tweenStand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//让动画在pos的值变为1后停止一段时间，方便我们观察，所以再创建一个tween，让pos从1到1（即不变）</span> tween<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span> <span class="token keyword">let</span> tweenBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>posSrc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建tweenBack的补间动画，和初始相反，使posSrc中的pos属性的值在5000ms内从1到0变化</span> tweenBack<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Sinusoidal<span class="token punctuation">.</span>InOut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置缓动效果</span> <span class="token comment">//每一个补间动画之间使用chain()连接起来</span> tween<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tweenStand<span class="token punctuation">)</span><span class="token punctuation">;</span> tweenStand<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tweenBack<span class="token punctuation">)</span><span class="token punctuation">;</span> tweenBack<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>tween<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在补间的过程中，让所有的粒子开始移动</span> <span class="token keyword">let</span> <span class="token function-variable function">onUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">let</span> pos <span class="token operator">=</span> posSrc<span class="token punctuation">.</span>pos<span class="token punctuation">;</span><span class="token comment">//定义一个pos，赋值为posSrc对象的pos属性</span> <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> loadGeometry<span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//遍历每个顶点，这里需要遍历刚刚克隆的geometry</span> <span class="token keyword">var</span> newZ <span class="token operator">=</span> e<span class="token punctuation">.</span>z <span class="token operator">*</span> pos<span class="token punctuation">;</span><span class="token comment">//得到新的Z值，根据当前的pos值去改变</span> group<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>vertices<span class="token punctuation">[</span>count<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>x<span class="token punctuation">,</span> e<span class="token punctuation">.</span>y<span class="token punctuation">,</span> newZ<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置每个顶点的位置，group.geometry.vertices是数组类型，所以用count作为索引</span> group<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>verticesNeedUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//重要，不然会没有动画效果</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>sortParticles <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//tween在每次更新后会执行tween.onUpdate()函数，里面的参数就是我们自定义要让它如果去运动的函数，即上面写的onUpdate</span> tween<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span> tweenStand<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span> tweenBack<span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span>onUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span> tween<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启tween</span> scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//自定义渐变颜色的画布，前面的文章有介绍，这个方法在写three.js程序很常用</span> <span class="token keyword">function</span> <span class="token function">generateSprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> gradient <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createRadialGradient</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'rgba(255,255,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,255,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,0,255,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'rgba(0,0,0,1)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span> context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Texture</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span> texture<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">return</span> texture<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//渲染函数</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token constant">TWEEN</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通知TWEEN在什么时候去刷新补间动画，重要，否则会没有动画</span> <span class="token comment">//性能监控器的更新</span> stats<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> renderer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span> renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//功能函数</span> <span class="token keyword">function</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">loadFullScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">loadAutoScreen</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">loadStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//运行主函数</span> <span class="token keyword">function</span> <span class="token function">threeStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">initThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">initObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
