<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>【Python】New York City Taxi Trip Duration纽约出租车大数据探索（技术实现过程） « NotBeCN</title>
  <meta name="description" content="                  # New York City Taxi Trip Duration纽约出租车大数据探索   # 该项目来源于Kaggle，旨在建模来预测纽约出租车在行程中的总行驶时间。# 在建模预测的过程中，我们可以顺便探索纽约市民打车出行习惯及其他有效信息。# kaggle项目链接 htt...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/11/weixin_44216391_90115972.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">【Python】New York City Taxi Trip Duration纽约出租车大数据探索（技术实现过程）</h1>
    <p class="post-meta">May 11, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-light"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p><strong># New York City Taxi Trip Duration纽约出租车大数据探索</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># 该项目来源于Kaggle，旨在建模来预测纽约出租车在行程中的总行驶时间。</span>
<span class="token comment"># 在建模预测的过程中，我们可以顺便探索纽约市民打车出行习惯及其他有效信息。</span>
<span class="token comment"># kaggle项目链接 https://www.kaggle.com/c/nyc-taxi-trip-duration/overview</span>

<span class="token comment"># 本文内容结构说明：</span>

<span class="token comment"># 一、先参考简书帖子《纽约出租车大数据探索》完成一部分探索，帖子没有源代码，所以我会根据帖子思路，自行写出代码。</span>
<span class="token comment"># 帖子网址 https://www.jianshu.com/p/1da53849a314 </span>

<span class="token comment"># 二、按照帖子文末提出的可以进一步拓展的探索方向，自行深入探索。</span>

<span class="token comment"># 三、kaggle比赛目标之预测行程持续时间，另外再开帖子叙述。</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 一、先参照简书帖子</span>

<span class="token comment"># 帖子的结构为五部分：</span>
<span class="token comment"># 1、提出问题—2、理解数据——3、数据清理——4、数据分析—5、得出结论</span>

</code></pre> 
  <pre><code class="prism language-python">
<span class="token comment"># 1、提出问题（根据已有数据分析）</span>

<span class="token comment"># （1）何时为打车需求高发期？</span>
<span class="token comment"># （2）居民夜生活活跃情况？</span>
<span class="token comment"># （3）城市一天的什么时候最为拥堵？</span>
<span class="token comment"># （4）什么时间容易接到长途单？</span>
</code></pre> 
  <pre><code class="prism language-python">
<span class="token comment"># 2、理解数据（表单说明）</span>

<span class="token comment"># id - 每次行程的唯一ID</span>
<span class="token comment"># vendor_id - 行程提供者的ID</span>
<span class="token comment"># pickup_datetime - 上车的日期和时间</span>
<span class="token comment"># dropoff_datetime - 停表的日期和时间</span>
<span class="token comment"># passenger_count - 车辆中的乘客数量（驾驶员输入值）</span>
<span class="token comment"># pickup_longitude - 上车的经度</span>
<span class="token comment"># pickup_latitude - 上车的纬度</span>
<span class="token comment"># dropoff_longitude - 下车经度</span>
<span class="token comment"># dropoff_latitude - 下车的纬度</span>
<span class="token comment"># store_and_fwd_flag - 行程记录是否为存储转发（或是直接发送）-- Y =存储和转发 N =没有存储</span>
<span class="token comment"># trip_duration - 行程持续时间（秒）</span>
</code></pre> 
  <pre><code class="prism language-python">
<span class="token comment"># 3、数据清理</span>

<span class="token comment"># Basic packages</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># Viz</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns

<span class="token comment"># settings</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 导入数据</span>
train<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>r<span class="token string">"D:\2018_BigData\Python\Kaggle_learning\New York City Taxi Trip Duration\train.csv"</span><span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.964630</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>id2377394</td> 
     <td>1</td> 
     <td>2016-06-12 00:43:35</td> 
     <td>2016-06-12 00:54:38</td> 
     <td>1</td> 
     <td>-73.980415</td> 
     <td>40.738564</td> 
     <td>-73.999481</td> 
     <td>40.731152</td> 
     <td>N</td> 
     <td>663</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>id3858529</td> 
     <td>2</td> 
     <td>2016-01-19 11:35:24</td> 
     <td>2016-01-19 12:10:48</td> 
     <td>1</td> 
     <td>-73.979027</td> 
     <td>40.763939</td> 
     <td>-74.005333</td> 
     <td>40.710087</td> 
     <td>N</td> 
     <td>2124</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>id3504673</td> 
     <td>2</td> 
     <td>2016-04-06 19:32:31</td> 
     <td>2016-04-06 19:39:40</td> 
     <td>1</td> 
     <td>-74.010040</td> 
     <td>40.719971</td> 
     <td>-74.012268</td> 
     <td>40.706718</td> 
     <td>N</td> 
     <td>429</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>id2181028</td> 
     <td>2</td> 
     <td>2016-03-26 13:30:55</td> 
     <td>2016-03-26 13:38:10</td> 
     <td>1</td> 
     <td>-73.973053</td> 
     <td>40.793209</td> 
     <td>-73.972923</td> 
     <td>40.782520</td> 
     <td>N</td> 
     <td>435</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">train<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 从下表看到，数据比较完整。看Kaggle官网也说了，因为是playground项目，所以已经把数据cleaned了。</span>
</code></pre> 
  <pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1458644 entries, 0 to 1458643
Data columns (total 11 columns):
id                    1458644 non-null object
vendor_id             1458644 non-null int64
pickup_datetime       1458644 non-null object
dropoff_datetime      1458644 non-null object
passenger_count       1458644 non-null int64
pickup_longitude      1458644 non-null float64
pickup_latitude       1458644 non-null float64
dropoff_longitude     1458644 non-null float64
dropoff_latitude      1458644 non-null float64
store_and_fwd_flag    1458644 non-null object
trip_duration         1458644 non-null int64
dtypes: float64(4), int64(3), object(4)
memory usage: 122.4+ MB
</code></pre> 
  <pre><code class="prism language-python">train<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 看下表，全部是科学计数法，影响观察。</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>vendor_id</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>trip_duration</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>count</th> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
    </tr> 
    <tr> 
     <th>mean</th> 
     <td>1.534950e+00</td> 
     <td>1.664530e+00</td> 
     <td>-7.397349e+01</td> 
     <td>4.075092e+01</td> 
     <td>-7.397342e+01</td> 
     <td>4.075180e+01</td> 
     <td>9.594923e+02</td> 
    </tr> 
    <tr> 
     <th>std</th> 
     <td>4.987772e-01</td> 
     <td>1.314242e+00</td> 
     <td>7.090186e-02</td> 
     <td>3.288119e-02</td> 
     <td>7.064327e-02</td> 
     <td>3.589056e-02</td> 
     <td>5.237432e+03</td> 
    </tr> 
    <tr> 
     <th>min</th> 
     <td>1.000000e+00</td> 
     <td>0.000000e+00</td> 
     <td>-1.219333e+02</td> 
     <td>3.435970e+01</td> 
     <td>-1.219333e+02</td> 
     <td>3.218114e+01</td> 
     <td>1.000000e+00</td> 
    </tr> 
    <tr> 
     <th>25%</th> 
     <td>1.000000e+00</td> 
     <td>1.000000e+00</td> 
     <td>-7.399187e+01</td> 
     <td>4.073735e+01</td> 
     <td>-7.399133e+01</td> 
     <td>4.073588e+01</td> 
     <td>3.970000e+02</td> 
    </tr> 
    <tr> 
     <th>50%</th> 
     <td>2.000000e+00</td> 
     <td>1.000000e+00</td> 
     <td>-7.398174e+01</td> 
     <td>4.075410e+01</td> 
     <td>-7.397975e+01</td> 
     <td>4.075452e+01</td> 
     <td>6.620000e+02</td> 
    </tr> 
    <tr> 
     <th>75%</th> 
     <td>2.000000e+00</td> 
     <td>2.000000e+00</td> 
     <td>-7.396733e+01</td> 
     <td>4.076836e+01</td> 
     <td>-7.396301e+01</td> 
     <td>4.076981e+01</td> 
     <td>1.075000e+03</td> 
    </tr> 
    <tr> 
     <th>max</th> 
     <td>2.000000e+00</td> 
     <td>9.000000e+00</td> 
     <td>-6.133553e+01</td> 
     <td>5.188108e+01</td> 
     <td>-6.133553e+01</td> 
     <td>4.392103e+01</td> 
     <td>3.526282e+06</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 尝试不以科学计数法显示。</span>

<span class="token comment"># np.set_printoptions(suppress=True)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.max_columns'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
train<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"passenger_count"</span><span class="token punctuation">,</span><span class="token string">"trip_duration"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 暂不成功。因为整体数据比较完整，接下来直接可视化分析。</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>passenger_count</th> 
     <th>trip_duration</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>count</th> 
     <td>1.458644e+06</td> 
     <td>1.458644e+06</td> 
    </tr> 
    <tr> 
     <th>mean</th> 
     <td>1.664530e+00</td> 
     <td>9.594923e+02</td> 
    </tr> 
    <tr> 
     <th>std</th> 
     <td>1.314242e+00</td> 
     <td>5.237432e+03</td> 
    </tr> 
    <tr> 
     <th>min</th> 
     <td>0.000000e+00</td> 
     <td>1.000000e+00</td> 
    </tr> 
    <tr> 
     <th>25%</th> 
     <td>1.000000e+00</td> 
     <td>3.970000e+02</td> 
    </tr> 
    <tr> 
     <th>50%</th> 
     <td>1.000000e+00</td> 
     <td>6.620000e+02</td> 
    </tr> 
    <tr> 
     <th>75%</th> 
     <td>2.000000e+00</td> 
     <td>1.075000e+03</td> 
    </tr> 
    <tr> 
     <th>max</th> 
     <td>9.000000e+00</td> 
     <td>3.526282e+06</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">
<span class="token comment"># 4、 数据分析与可视化</span>

<span class="token comment"># （1）何时为打车需求高发期？</span>
<span class="token comment"># （2）居民夜生活活跃情况？</span>
<span class="token comment"># （3）城市一天的什么时候最为拥堵？</span>
<span class="token comment"># （4）什么时间容易接到长途单？</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 分析一：何时为打车需求高发期？</span>

<span class="token keyword">import</span> datetime
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># dt = train["pickup_datetime"]</span>
<span class="token comment"># dt = datetime.strptime(dt, '%Y-%m-%d %H:%M:%S')</span>
<span class="token comment"># train["pickup_month"] = dt.month</span>

train<span class="token punctuation">.</span>pickup_datetime <span class="token operator">=</span> train<span class="token punctuation">.</span>pickup_datetime<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
train<span class="token punctuation">[</span><span class="token string">"pickup_yearmonth"</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">"pickup_datetime"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token operator">*</span>x<span class="token punctuation">.</span>year <span class="token operator">+</span> x<span class="token punctuation">.</span>month<span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 另外，年份月份提取也可以用astpye函数，例如[M]转换成月份：参考 df["month"]=df.DealTime.values.astype("datetime64[M]")</span>
<span class="token comment"># 还可以提取星期几的周信息。</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.96463</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">"pickup_yearmonth"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 只有六个月的时间数据。</span>
</code></pre> 
  <pre><code>201603    256189
201604    251645
201605    248487
201602    238300
201606    234316
201601    229707
Name: pickup_yearmonth, dtype: int64
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 新增月份</span>
<span class="token comment"># train.drop(["pickup_yearmonth"],axis=1,inplace=True)</span>
train<span class="token punctuation">[</span><span class="token string">"pickup_month"</span><span class="token punctuation">]</span> <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token string">"pickup_datetime"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>month<span class="token punctuation">)</span>

<span class="token comment"># train.dropoff_datetime = train.dropoff_datetime.apply(lambda x:datetime.strptime(x, '%Y-%m-%d %H:%M:%S'))</span>
<span class="token comment"># train["dropoff_month"] = train["dropoff_datetime"].map(lambda x: x.month)</span>

train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 其实dropoff_month和pickup_month基本一致，如果考虑到效率和内存，可以不用提取dropoff_month。</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
     <th>pickup_month</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.96463</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
     <td>3</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 新增周标识</span>

<span class="token comment"># train["week"]=train.pickup_datetime.weekday()</span>
<span class="token comment"># AttributeError: 'Series' object has no attribute 'datetime'</span>

train<span class="token punctuation">[</span><span class="token string">"pickup_week"</span><span class="token punctuation">]</span><span class="token operator">=</span>train<span class="token punctuation">.</span>pickup_datetime<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.964630</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
     <td>3</td> 
     <td>0</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>id2377394</td> 
     <td>1</td> 
     <td>2016-06-12 00:43:35</td> 
     <td>2016-06-12 00:54:38</td> 
     <td>1</td> 
     <td>-73.980415</td> 
     <td>40.738564</td> 
     <td>-73.999481</td> 
     <td>40.731152</td> 
     <td>N</td> 
     <td>663</td> 
     <td>201606</td> 
     <td>6</td> 
     <td>6</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">"pickup_day"</span><span class="token punctuation">]</span><span class="token operator">=</span>train<span class="token punctuation">.</span>pickup_datetime<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>day<span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.964630</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
     <td>3</td> 
     <td>0</td> 
     <td>14</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>id2377394</td> 
     <td>1</td> 
     <td>2016-06-12 00:43:35</td> 
     <td>2016-06-12 00:54:38</td> 
     <td>1</td> 
     <td>-73.980415</td> 
     <td>40.738564</td> 
     <td>-73.999481</td> 
     <td>40.731152</td> 
     <td>N</td> 
     <td>663</td> 
     <td>201606</td> 
     <td>6</td> 
     <td>6</td> 
     <td>12</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 新增日标识</span>
train<span class="token punctuation">[</span><span class="token string">"pickup_date"</span><span class="token punctuation">]</span><span class="token operator">=</span>train<span class="token punctuation">.</span>pickup_datetime<span class="token punctuation">.</span>values<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"datetime64[D]"</span><span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
     <th>pickup_date</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.964630</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
     <td>3</td> 
     <td>0</td> 
     <td>14</td> 
     <td>2016-03-14</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>id2377394</td> 
     <td>1</td> 
     <td>2016-06-12 00:43:35</td> 
     <td>2016-06-12 00:54:38</td> 
     <td>1</td> 
     <td>-73.980415</td> 
     <td>40.738564</td> 
     <td>-73.999481</td> 
     <td>40.731152</td> 
     <td>N</td> 
     <td>663</td> 
     <td>201606</td> 
     <td>6</td> 
     <td>6</td> 
     <td>12</td> 
     <td>2016-06-12</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">month_trip<span class="token operator">=</span>train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pickup_month'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"trip_duration"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"sum"</span><span class="token punctuation">,</span><span class="token string">"mean"</span><span class="token punctuation">,</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
month_trip<span class="token operator">=</span>month_trip<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
month_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_month</th> 
     <th>sum</th> 
     <th>mean</th> 
     <th>count</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>211875608</td> 
     <td>922.373319</td> 
     <td>229707</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>2</td> 
     <td>219433897</td> 
     <td>920.830453</td> 
     <td>238300</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 为了直观一些，改列名</span>
month_trip<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'sum'</span><span class="token punctuation">:</span><span class="token string">'month_sum_trip_dur'</span><span class="token punctuation">,</span><span class="token string">'mean'</span><span class="token punctuation">:</span><span class="token string">'month_avg_trip_dur'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">:</span><span class="token string">"month_trip_times"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
month_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_month</th> 
     <th>month_sum_trip_dur</th> 
     <th>month_avg_trip_dur</th> 
     <th>month_trip_times</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>211875608</td> 
     <td>922.373319</td> 
     <td>229707</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>2</td> 
     <td>219433897</td> 
     <td>920.830453</td> 
     <td>238300</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">date_trip<span class="token operator">=</span>train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pickup_date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"trip_duration"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"sum"</span><span class="token punctuation">,</span><span class="token string">"mean"</span><span class="token punctuation">,</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
date_trip<span class="token operator">=</span>date_trip<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
date_trip<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'sum'</span><span class="token punctuation">:</span><span class="token string">'date_sum_trip_duration'</span><span class="token punctuation">,</span><span class="token string">'mean'</span><span class="token punctuation">:</span><span class="token string">'date_avg_trip_dur'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">:</span><span class="token string">"date_trip_times"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
date_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_date</th> 
     <th>date_sum_trip_duration</th> 
     <th>date_avg_trip_dur</th> 
     <th>date_trip_times</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>2016-01-01</td> 
     <td>6593910</td> 
     <td>920.679978</td> 
     <td>7162</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>2016-01-02</td> 
     <td>5470632</td> 
     <td>840.084767</td> 
     <td>6512</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>2016-01-03</td> 
     <td>5874410</td> 
     <td>924.667086</td> 
     <td>6353</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>2016-01-04</td> 
     <td>5723773</td> 
     <td>851.118662</td> 
     <td>6725</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>2016-01-05</td> 
     <td>10484304</td> 
     <td>1455.344808</td> 
     <td>7204</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">day_trip<span class="token operator">=</span>train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pickup_day'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"trip_duration"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"sum"</span><span class="token punctuation">,</span><span class="token string">"mean"</span><span class="token punctuation">,</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
day_trip<span class="token operator">=</span>day_trip<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
day_trip<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'sum'</span><span class="token punctuation">:</span><span class="token string">'day_sum_trip_duration'</span><span class="token punctuation">,</span><span class="token string">'mean'</span><span class="token punctuation">:</span><span class="token string">'day_avg_trip_dur'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">:</span><span class="token string">"day_trip_times"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
day_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_day</th> 
     <th>day_sum_trip_duration</th> 
     <th>day_avg_trip_dur</th> 
     <th>day_trip_times</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>44656812</td> 
     <td>958.053978</td> 
     <td>46612</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>2</td> 
     <td>44354937</td> 
     <td>928.860299</td> 
     <td>47752</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>3</td> 
     <td>46806173</td> 
     <td>976.247221</td> 
     <td>47945</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>4</td> 
     <td>47050568</td> 
     <td>947.549451</td> 
     <td>49655</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>5</td> 
     <td>51193213</td> 
     <td>1020.272899</td> 
     <td>50176</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># plot</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">321</span><span class="token punctuation">)</span>
ax1<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>month_trip<span class="token punctuation">.</span>pickup_month<span class="token punctuation">,</span> month_trip<span class="token punctuation">.</span>month_trip_times<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'trip times'</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Monthly Trip Times"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'# of trip times'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Month'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">322</span><span class="token punctuation">)</span>
ax2<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>month_trip<span class="token punctuation">.</span>pickup_month<span class="token punctuation">,</span> month_trip<span class="token punctuation">.</span>month_avg_trip_dur<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Monthly Trip Duration"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Avg of trip druration'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Month'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">312</span><span class="token punctuation">)</span>
ax2<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>date_trip<span class="token punctuation">.</span>pickup_date<span class="token punctuation">,</span> date_trip<span class="token punctuation">.</span>date_trip_times<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Date Trip Time"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Date trip time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Date'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">313</span><span class="token punctuation">)</span>
ax2<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>day_trip<span class="token punctuation">.</span>pickup_day<span class="token punctuation">,</span> day_trip<span class="token punctuation">.</span>day_trip_times<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Day Trip Time"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Day trip time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Day'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 从趋势来说，2016年1~6月整体打车时长一直呈增长状态，可能用户逐渐习惯了更远距离也打车。</span>

<span class="token comment"># 其中，3月-5月订单数量属于六个月中最高的三个月，但是整体下降趋势。</span>

<span class="token comment"># 1月下旬和5月底有异常点，这两天打车人数特别少，可能是当天发生了什么重大事故，或者是重大节日不出行。</span>

<span class="token comment"># 从日折线图来看，忽略23号和31号两个异常点，整体订单数量随日期变化呈现规律波动，看似周期为7天（一个星期），据此推测订单数量可能与星期几有关。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151750177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 1、分析异常值</span>

<span class="token comment"># 从图"Date Trip Time"可以定义异常值临界点为6000，将低于6000的异常值筛选出来。</span>

date_trip<span class="token punctuation">[</span>date_trip<span class="token punctuation">.</span>date_trip_times<span class="token operator">&lt;</span><span class="token number">6000</span><span class="token punctuation">]</span>

<span class="token comment"># 找出异常的日期是1月23日，1月24日，5月30日。</span>
<span class="token comment"># 分析其原因。根据当日美国新闻：</span>

<span class="token comment"># (1)美遭暴风雪袭击 纽约时报广场飞雪飘零_网易新闻</span>
<span class="token comment"># 2016-1-24 · 当地时间2016年1月23日，美国纽约，美国遭遇暴雪天气，暴雪中的时报广场。</span>

<span class="token comment"># (2)阵亡将士纪念日 (5月的最后一个星期一)</span>
<span class="token comment"># 中新网5月30日电 据美媒报道，美国迎来“国殇日”长周末，标志着夏季的正式开始。</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_date</th> 
     <th>date_sum_trip_duration</th> 
     <th>date_avg_trip_dur</th> 
     <th>date_trip_times</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>22</th> 
     <td>2016-01-23</td> 
     <td>1691754</td> 
     <td>1026.549757</td> 
     <td>1648</td> 
    </tr> 
    <tr> 
     <th>23</th> 
     <td>2016-01-24</td> 
     <td>3052107</td> 
     <td>902.189477</td> 
     <td>3383</td> 
    </tr> 
    <tr> 
     <th>150</th> 
     <td>2016-05-30</td> 
     <td>4568228</td> 
     <td>820.148654</td> 
     <td>5570</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">
<span class="token comment"># 2、分析订单数量可能和星期几有关</span>

</code></pre> 
  <pre><code class="prism language-python">x <span class="token operator">=</span> train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pickup_day'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"passenger_count"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> x<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
day_trip<span class="token punctuation">[</span><span class="token string">"avg_passenger_count"</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">]</span>
day_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_day</th> 
     <th>day_sum_trip_duration</th> 
     <th>day_avg_trip_dur</th> 
     <th>day_trip_times</th> 
     <th>avg_passenger_count</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>44656812</td> 
     <td>958.053978</td> 
     <td>46612</td> 
     <td>1.682871</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>2</td> 
     <td>44354937</td> 
     <td>928.860299</td> 
     <td>47752</td> 
     <td>1.666611</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>3</td> 
     <td>46806173</td> 
     <td>976.247221</td> 
     <td>47945</td> 
     <td>1.655355</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>4</td> 
     <td>47050568</td> 
     <td>947.549451</td> 
     <td>49655</td> 
     <td>1.643279</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>5</td> 
     <td>51193213</td> 
     <td>1020.272899</td> 
     <td>50176</td> 
     <td>1.670301</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
ax2<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>day_trip<span class="token punctuation">.</span>pickup_day<span class="token punctuation">,</span> day_trip<span class="token punctuation">.</span>avg_passenger_count<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"grey"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Day Trip Passenger"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Day trip passenger'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Day'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
ax2<span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>day_trip<span class="token punctuation">.</span>pickup_day<span class="token punctuation">,</span> day_trip<span class="token punctuation">.</span>day_trip_times<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"grey"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Day Trip Time"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Day trip time'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Pickup_Day'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 两张图展示了在2016年1月1日至2016年6月30日这半年内，六个月1~31日的每日订单总量、每日平均乘车人数随日期的波动。</span>

<span class="token comment"># 两个图（每日订单数量/乘车次数与日平均乘车人数）的趋势惊人地一致。这说明在周期的某一阶段，不仅订单数量增多，而且人们偏向于结伴出行。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151811502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python">train<span class="token punctuation">[</span><span class="token string">"pickup_hour"</span><span class="token punctuation">]</span><span class="token operator">=</span>train<span class="token punctuation">.</span>pickup_datetime<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>hour<span class="token punctuation">)</span>
train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>id</th> 
     <th>vendor_id</th> 
     <th>pickup_datetime</th> 
     <th>dropoff_datetime</th> 
     <th>passenger_count</th> 
     <th>pickup_longitude</th> 
     <th>pickup_latitude</th> 
     <th>dropoff_longitude</th> 
     <th>dropoff_latitude</th> 
     <th>store_and_fwd_flag</th> 
     <th>trip_duration</th> 
     <th>pickup_yearmonth</th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
     <th>pickup_date</th> 
     <th>pickup_hour</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>id2875421</td> 
     <td>2</td> 
     <td>2016-03-14 17:24:55</td> 
     <td>2016-03-14 17:32:30</td> 
     <td>1</td> 
     <td>-73.982155</td> 
     <td>40.767937</td> 
     <td>-73.964630</td> 
     <td>40.765602</td> 
     <td>N</td> 
     <td>455</td> 
     <td>201603</td> 
     <td>3</td> 
     <td>0</td> 
     <td>14</td> 
     <td>2016-03-14</td> 
     <td>17</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>id2377394</td> 
     <td>1</td> 
     <td>2016-06-12 00:43:35</td> 
     <td>2016-06-12 00:54:38</td> 
     <td>1</td> 
     <td>-73.980415</td> 
     <td>40.738564</td> 
     <td>-73.999481</td> 
     <td>40.731152</td> 
     <td>N</td> 
     <td>663</td> 
     <td>201606</td> 
     <td>6</td> 
     <td>6</td> 
     <td>12</td> 
     <td>2016-06-12</td> 
     <td>0</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>id3858529</td> 
     <td>2</td> 
     <td>2016-01-19 11:35:24</td> 
     <td>2016-01-19 12:10:48</td> 
     <td>1</td> 
     <td>-73.979027</td> 
     <td>40.763939</td> 
     <td>-74.005333</td> 
     <td>40.710087</td> 
     <td>N</td> 
     <td>2124</td> 
     <td>201601</td> 
     <td>1</td> 
     <td>1</td> 
     <td>19</td> 
     <td>2016-01-19</td> 
     <td>11</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>id3504673</td> 
     <td>2</td> 
     <td>2016-04-06 19:32:31</td> 
     <td>2016-04-06 19:39:40</td> 
     <td>1</td> 
     <td>-74.010040</td> 
     <td>40.719971</td> 
     <td>-74.012268</td> 
     <td>40.706718</td> 
     <td>N</td> 
     <td>429</td> 
     <td>201604</td> 
     <td>4</td> 
     <td>2</td> 
     <td>6</td> 
     <td>2016-04-06</td> 
     <td>19</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>id2181028</td> 
     <td>2</td> 
     <td>2016-03-26 13:30:55</td> 
     <td>2016-03-26 13:38:10</td> 
     <td>1</td> 
     <td>-73.973053</td> 
     <td>40.793209</td> 
     <td>-73.972923</td> 
     <td>40.782520</td> 
     <td>N</td> 
     <td>435</td> 
     <td>201603</td> 
     <td>3</td> 
     <td>5</td> 
     <td>26</td> 
     <td>2016-03-26</td> 
     <td>13</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># pc=train["passenger_count"]</span>
<span class="token comment"># phour=train["pickup_hour"]</span>
<span class="token comment"># pday=train["pickup_day"]</span>
<span class="token comment"># pweek=train["pickup_week"]</span>
<span class="token comment"># pmonth=train["pickup_month"]</span>
<span class="token comment"># pdate=train["pickup_date"]</span>
<span class="token comment"># tripdur=train["trip_duration"]</span>

<span class="token comment"># sns.swarmplot(x="pweek", y="tripdur", hue="pmonth", data=train)</span>

<span class="token comment"># 如上先赋值再代入函数，则swarmplot函数运行报错。下面尝试直接代入函数。</span>

<span class="token comment"># sns.swarmplot(x=train["pickup_week"], y=train["trip_duration"], hue=train["pickup_month"], data=train)</span>
<span class="token comment"># sns.swarmplot(x="pickup_week", y="trip_duration", hue="pickup_month", data=train)</span>
<span class="token comment"># 这两句语句都运行过久，30分钟未有反应，暂时放弃该语句，再寻找其他较优语句。</span>
</code></pre> 
  <pre><code class="prism language-python">week_trip <span class="token operator">=</span> train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"pickup_month"</span><span class="token punctuation">,</span><span class="token string">'pickup_week'</span><span class="token punctuation">,</span><span class="token string">'pickup_day'</span><span class="token punctuation">,</span><span class="token string">'pickup_hour'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"trip_duration"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">,</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
week_trip <span class="token operator">=</span> week_trip<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
week_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
     <th>pickup_hour</th> 
     <th>mean</th> 
     <th>count</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>0</td> 
     <td>656.771186</td> 
     <td>118</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>1</td> 
     <td>703.086957</td> 
     <td>92</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python">week_trip<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'mean'</span><span class="token punctuation">:</span><span class="token string">'week_avg_trip_dur'</span><span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">:</span><span class="token string">"week_trip_times"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>week_trip<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
week_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 4359行数据，数据量不大，这次可以用sns.swarmplot()函数了。</span>
</code></pre> 
  <pre><code>(4359, 6)
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
     <th>pickup_hour</th> 
     <th>week_avg_trip_dur</th> 
     <th>week_trip_times</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>0</td> 
     <td>656.771186</td> 
     <td>118</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>1</td> 
     <td>703.086957</td> 
     <td>92</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 在week_trip表中增加乘车人数</span>

x1 <span class="token operator">=</span> train<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"pickup_month"</span><span class="token punctuation">,</span><span class="token string">'pickup_week'</span><span class="token punctuation">,</span><span class="token string">'pickup_day'</span><span class="token punctuation">,</span><span class="token string">'pickup_hour'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"passenger_count"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x1 <span class="token operator">=</span> x1<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span> 
week_trip<span class="token punctuation">[</span><span class="token string">"avg_passenger_count"</span><span class="token punctuation">]</span> <span class="token operator">=</span> x1<span class="token punctuation">[</span><span class="token string">"mean"</span><span class="token punctuation">]</span>
week_trip<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <div> 
  </div> 
  <table border="1" class="dataframe"> 
   <thead> 
    <tr> 
     <th></th> 
     <th>pickup_month</th> 
     <th>pickup_week</th> 
     <th>pickup_day</th> 
     <th>pickup_hour</th> 
     <th>week_avg_trip_dur</th> 
     <th>week_trip_times</th> 
     <th>avg_passenger_count</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <th>0</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>0</td> 
     <td>656.771186</td> 
     <td>118</td> 
     <td>1.593220</td> 
    </tr> 
    <tr> 
     <th>1</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>1</td> 
     <td>703.086957</td> 
     <td>92</td> 
     <td>1.673913</td> 
    </tr> 
    <tr> 
     <th>2</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>2</td> 
     <td>692.085106</td> 
     <td>47</td> 
     <td>1.574468</td> 
    </tr> 
    <tr> 
     <th>3</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>3</td> 
     <td>738.500000</td> 
     <td>32</td> 
     <td>1.250000</td> 
    </tr> 
    <tr> 
     <th>4</th> 
     <td>1</td> 
     <td>0</td> 
     <td>4</td> 
     <td>4</td> 
     <td>644.000000</td> 
     <td>50</td> 
     <td>1.700000</td> 
    </tr> 
   </tbody> 
  </table> 
  <pre><code class="prism language-python"><span class="token comment"># 周一至周日打车次数/订单数量</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>swarmplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_week"</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">"week_trip_times"</span><span class="token punctuation">,</span> hue<span class="token operator">=</span><span class="token string">"pickup_month"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 明显周日周一打车次数最低，周五至周六打车次数最高。可能周四至周六市民出行意愿更高。</span>
<span class="token comment"># 另外发现,周日打车次数/订单数量在100-300区间内明显比周一至周六多，这里可能蕴含一些信息，待挖掘。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/201905121518394.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 周一至周日乘车人数</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_week"</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">"avg_passenger_count"</span><span class="token punctuation">,</span> hue<span class="token operator">=</span><span class="token string">"pickup_month"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 下图可见，周六周日拼车人数较多。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151856522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 当日内0点至24点乘车次数/订单数量</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>swarmplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_hour"</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">"week_trip_times"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 从图中可以看出：</span>

<span class="token comment"># （1）全天候分析：</span>
<span class="token comment"># 凌晨一点开始至凌晨五点，订单数量急剧下降，符合人群休息规律。从早6点开始，订单量由谷底回升，早7点至早9点有一个早高峰。</span>
<span class="token comment"># 在早8点到下午5点之间有轻微波动不明显。而早10点和下午4点均有一个轻微的走低点。</span>

<span class="token comment"># 原因推测：</span>
<span class="token comment"># 1、市民上班的出行需求被公共交通、私家车等分担，不会偏好于出租车出行；</span>
<span class="token comment"># 2、假设通勤时间1小时，则基本可确定八点至十点是上班时间小集中的时间段。（此结论与原贴不一致，甚至有轻微相反。）</span>
<span class="token comment"># 3、早八点和下午四点这两个时间点，人群在公司开会尚未外出（早）或已在出差公司开会还未散会（下午四点）。</span>

<span class="token comment"># （2）晚高峰表现显著：</span>
<span class="token comment"># 从晚6点开始订单量有大规模增长，约晚7点进入打车最高峰，且在23点之前的平均打车量均维持较高水平，高于白天时段。</span>

<span class="token comment"># 原因推测：</span>
<span class="token comment"># 1、相比于白天，市民在晚上外出活动时更偏向于出租车出行。有可能逐渐下班。</span>
<span class="token comment"># 2、也猜测晚间时间家庭出行或约伴出行，下面通过乘车人数认证后发现该假设并不成立。</span>

<span class="token comment"># （3）下午时段，四点左右出现订单量回落。</span>
<span class="token comment"># 原因推测：</span>
<span class="token comment"># 1、司机交班；2、道路拥堵；3、出差人群在出差公司开会还未散会下班。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151908676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 当日内0点至24点乘车人数</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>stripplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_hour"</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">"avg_passenger_count"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 前面猜测晚间时间家庭出行或约伴出行，这里乘车人数在晚间并无明显变化，故前面猜测不成立。</span>
<span class="token comment"># 反而发现凌晨2点至5点订单乘车人数较为分散，既有较多人（约伴），也有较少人（单人）的情况。</span>
<span class="token comment"># 早5点-8点之间，每个订单乘车人数全日最低（boxplot比较清晰，stripplot没那么清晰），恰好又是上班时间，预计是单人上班打车情况较多。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151919964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 当日内0点至24点打车行程时间分布</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>week_trip<span class="token punctuation">[</span><span class="token string">"week_avg_trip_dur"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>week_trip<span class="token punctuation">[</span><span class="token string">"week_avg_trip_dur"</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">8000</span><span class="token punctuation">]</span>
daytripdur<span class="token operator">=</span>sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_hour"</span><span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 一开始发现三个异常值干扰观察，尝试增加boxplot函数中参数y的重新赋值来忽略异常值（week_avg_trip_dur&gt;8000）。——下图为已修正三个异常值。</span>

<span class="token comment"># 白天早9点至下午5点，行车时间较长，据此可以推测白天这个时间段道路较为拥塞。</span>

<span class="token comment"># 凌晨2点至5点，基本可以排除拥塞影响，行程时间长短可近似等同于距离长短。且分布在箱盒之外的长行车时间较多，据此推测：</span>
<span class="token comment"># 凌晨2点至5点这个时间段接到长距离行程单的机会比其他时间段多很多。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151931623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python">
<span class="token comment"># 分析二：居民夜生活活跃情况？</span>

<span class="token comment"># 订单数量在晚8点至凌晨1点均维持较高水平，从凌晨1点开始，订单量断崖式下跌，这一下跌持续到约早5点，早5点是一天内订单量最低的时刻。</span>
<span class="token comment"># 说明纽约市民夜生活活跃情况：</span>
<span class="token comment"># （1）第一种可能：下午/晚上下班后约伴交友灯红酒绿夜夜笙歌，至凌晨1点方歇。</span>
<span class="token comment"># （2）当然，也有第二种可能是：晚晚加班。白天会议下午法定下班时间后，才是晚间工作的开始，然后陆陆续续持续到凌晨十二点。</span>
<span class="token comment"># 从国情看，纽约的第一种可能性高一些；而第二种则在中国一线城市发生的概率比率高一些。</span>

</code></pre> 
  <pre><code class="prism language-python">
<span class="token comment"># 分析三： 城市的一天什么时候最为拥堵？</span>

<span class="token comment"># 第一个思路（如下图）：</span>
<span class="token comment"># 从前面分析第一部分的“当日内0点至24点打车行程时间分布”初步推测：</span>
<span class="token comment"># 白天早9点至下午5点，行车时间较长，据此可以推测白天这个时间段道路较为拥塞。</span>

<span class="token comment"># 第二个思路（待挖掘）：</span>
<span class="token comment"># 先通过上下车地点经纬度计算行程距离，再用行程距离/行程时间得出行车均速。行程均速可体现道路畅通拥堵程度。</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># y=week_trip["week_avg_trip_dur"][week_trip["week_avg_trip_dur"]&lt;=8000]</span>
daytripdur<span class="token operator">=</span>sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_hour"</span><span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019051215194411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python"><span class="token comment"># 计算行程距离</span>

<span class="token keyword">from</span> math <span class="token keyword">import</span> sin<span class="token punctuation">,</span>radians<span class="token punctuation">,</span>cos<span class="token punctuation">,</span>asin<span class="token punctuation">,</span>sqrt

<span class="token keyword">def</span> <span class="token function">haversine</span><span class="token punctuation">(</span>lon1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lon2<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    lon1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lon2<span class="token punctuation">,</span> lat2 <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>radians<span class="token punctuation">,</span> <span class="token punctuation">[</span>lon1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lon2<span class="token punctuation">,</span> lat2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#radians 角度转弧度</span>

    dlon <span class="token operator">=</span> lon2 <span class="token operator">-</span> lon1
    dlat <span class="token operator">=</span> lat2 <span class="token operator">-</span> lat1
    a <span class="token operator">=</span> sin<span class="token punctuation">(</span>dlat<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> cos<span class="token punctuation">(</span>lat1<span class="token punctuation">)</span> <span class="token operator">*</span> cos<span class="token punctuation">(</span>lat2<span class="token punctuation">)</span> <span class="token operator">*</span> sin<span class="token punctuation">(</span>dlon<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
    c <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> asin<span class="token punctuation">(</span>sqrt<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 反正弦</span>
    r <span class="token operator">=</span> <span class="token number">6371</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> r


<span class="token comment"># EARTH_REDIUS = 6378.137</span>

<span class="token comment"># def rad(d):</span>
<span class="token comment"># return d * pi / 180.0</span>

<span class="token comment"># def getDistance(lat1, lng1, lat2, lng2):</span>
<span class="token comment"># radLat1 = rad(lat1)</span>
<span class="token comment"># radLat2 = rad(lat2)</span>
<span class="token comment"># a = radLat1 - radLat2</span>
<span class="token comment"># b = rad(lng1) - rad(lng2)</span>
<span class="token comment"># s = 2 * math.asin(math.sqrt(math.pow(math.sin(a/2), 2) + math.cos(radLat1) * math.cos(radLat2) * math.pow(math.sin(b/2), 2)))</span>
<span class="token comment"># s = s * EARTH_REDIUS</span>
<span class="token comment"># return s</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># train["distance"] = train['pickup_longitude', 'pickup_latitude','dropoff_longitude', 'dropoff_latitude'].apply(lambda x: haversine(x))</span>
<span class="token comment"># 整列计算行程距离的方法，暂时搁置。（未完待续）</span>
</code></pre> 
  <pre><code class="prism language-python">
<span class="token comment"># 分析四：什么时间容易接到长途单?</span>

<span class="token comment"># 接单时间和订单行程时间/路程距离是否有关系呢？接下来进入分析。</span>
<span class="token comment"># 前面已经绘出一日内0点至24点的平均行程时间，我们这里重新引用：</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>week_trip<span class="token punctuation">[</span><span class="token string">"week_avg_trip_dur"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>week_trip<span class="token punctuation">[</span><span class="token string">"week_avg_trip_dur"</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">8000</span><span class="token punctuation">]</span>
daytripdur<span class="token operator">=</span>sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">"pickup_hour"</span><span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">,</span> data<span class="token operator">=</span>week_trip<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 凌晨2点至5点，基本可以排除拥塞影响，行程时间长短可近似等同于距离长短。且分布在箱盒之外的长行车时间较多，据此推测：</span>
<span class="token comment"># 凌晨2点至5点这个时间段接到长距离行程单的机会比其他时间段多很多。</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190512151957634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDIxNjM5MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code class="prism language-python">
<span class="token comment"># 总结</span>

<span class="token comment"># 分析到此告一段落。当然，虽然数据量不多，但是还可以挖掘更细致的城市出行行为等信息。</span>

<span class="token comment"># 例如，</span>
<span class="token comment"># 可以分析哪些时段的哪些区域更容易发生订单，人群一般从哪些地方去往哪些地方——这对出租调度来说是个有效数据。</span>
<span class="token comment"># 从暴雪带来的异常值可以推测，天气与订单量是有密切关系的，根据日期对应天气数据，可以进一步分析天气与订单量的影响。</span>
<span class="token comment"># 结合位置数据，还可以分析哪些区域受天气的影响较大，等等。</span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
