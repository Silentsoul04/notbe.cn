<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>scrapy 爬取妹子图源码 « NotBeCN</title>
  <meta name="description" content="                  spiders写法：中meizi.py   -- coding: utf-8 --   import scrapy import os,random import requests from pypinyin import lazy_pinyin from Meizi.item...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/11/gllvcpp_90116183.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">scrapy 爬取妹子图源码</h1>
    <p class="post-meta">May 11, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>spiders写法：<a href="http://xn--meizi-4n1h.py" rel="nofollow">中meizi.py</a></p> 
  <h1><a id="_coding_utf8__1"></a>-<em>- coding: utf-8 -</em>-</h1> 
  <p>import scrapy<br> import os,random<br> import requests<br> from pypinyin import lazy_pinyin<br> from Meizi.items import MeiziItem<br> UA=[<br> {‘User-Agent’:‘Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50’},</p> 
  <pre><code>{'User-Agent':'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50'},
{'User-Agent':'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0'},
{'User-Agent':'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)'},
{'User-Agent':'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)'},
{'User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)'},

{'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1'},
{'User-Agent':'Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1'},
{'User-Agent':'Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11'},

{'User-Agent':'Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11'},

{'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11'},
{'User-Agent':'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Maxthon 2.0)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; TencentTraveler 4.0)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; The World)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SE 2.X MetaSr 1.0; SE 2.X MetaSr 1.0; .NET CLR 2.0.50727; SE 2.X MetaSr 1.0)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Avant Browser)'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)'},
{'User-Agent':'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'},
{'User-Agent':'Mozilla/5.0 (iPod; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'},
{'User-Agent':'Mozilla/5.0 (iPad; U; CPU OS 4_3_3 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'},
{'User-Agent': 'Mozilla/5.0 (Linux; U; Android 2.3.7; en-us; Nexus One Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1'},
{'User-Agent': 'MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1'},
{'User-Agent': 'Opera/9.80 (Android 2.3.4; Linux; Opera Mobi/build-1107180945; U; en-GB) Presto/2.8.149 Version/11.10'},
{'User-Agent': 'Mozilla/5.0 (Linux; U; Android 3.0; en-us; Xoom Build/HRI39) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13'},
{'User-Agent': 'Mozilla/5.0 (BlackBerry; U; BlackBerry 9800; en) AppleWebKit/534.1+ (KHTML, like Gecko) Version/6.0.0.337 Mobile Safari/534.1'},
{'User-Agent': 'Mozilla/5.0 (hp-tablet; Linux; hpwOS/3.0.0; U; en-US) AppleWebKit/534.6 (KHTML, like Gecko) wOSBrowser/233.70 Safari/534.6 TouchPad/1.0'},
{'User-Agent': 'Mozilla/5.0 (SymbianOS/9.4; Series60/5.0 NokiaN97-1/20.0.019; Profile/MIDP-2.1 Configuration/CLDC-1.1) AppleWebKit/525 (KHTML, like Gecko) BrowserNG/7.1.18124'},
{'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; IEMobile/9.0; HTC; Titan)'},
{'User-Agent': 'UCWEB7.0.2.37/28/999'},
{'User-Agent': 'NOKIA5700/ UCWEB7.0.2.37/28/999'},
{'User-Agent': 'Openwave/ UCWEB7.0.2.37/28/999'},
{'User-Agent': 'Mozilla/4.0 (compatible; MSIE 6.0; ) Opera/UCWEB7.0.2.37/28/999'}]
</code></pre> 
  <p>class MeiziSpider(scrapy.Spider):<br> name = ‘meizi’<br> allowed_domains = [‘<a href="http://mzitu.com" rel="nofollow">mzitu.com</a>’]<br> # start_urls = [‘<a href="http://mzitu.com/" rel="nofollow">http://mzitu.com/</a>’]</p> 
  <pre><code>def start_requests(self):
	url="https://www.mzitu.com/xinggan/page/"
	for i in range(3,4):
		yield scrapy.Request(url+str(i))

def parse(self, response):

    name=response.xpath("//ul[@id='pins']/li/span/a/text()").extract()
   	url=response.xpath("//ul[@id='pins']/li/a/@href").extract()
   	header={
   	'referer': response.url,
	'user-agent': random.choice(UA)["User-Agent"]
	       	}
   	for i in url:
   		yield scrapy.Request(i,callback=self.parse_item,headers=header)
def parse_item(self,response):
	name=response.xpath("//h2[@class='main-title']/text()").extract()
	header={
   	'referer': response.url,
	'user-agent': random.choice(UA)["User-Agent"]
	       	}
	# os.mkdir('/gg/Images/%s'%name[0])
	endpage=response.xpath("//div[@class='pagenavi']/a[5]/span/text()").extract()
	# print(response.url)
	for i in range(1,int(endpage[0])+1):
		yield scrapy.Request(response.url+'/'+str(i),headers=header,callback=self.parse_img)
def parse_img(self,response):
    item=MeiziItem()
    imgurl=response.xpath("//div[@class='main-image']/p/a/img/@src").extract()
    # print(imgurl)
    name=response.xpath("//div[@class='main-image']/p/a/img/@alt").extract()
    imgname=response.xpath("//h2[@class='main-title']/text()").extract()[0][15:]
    dirs='/home/gg/Images/%s'%name[0][15:]
    # print(imgurl[0])
    # url=response.url
    item['imgurl']=imgurl[0]
    item['imgname']=imgname
    item['name']=name[0][15:]
    yield item    #也可以定制自己个性化命名使用requests模块下载图片
   #  header={
   #  'Referer': '{}'.format(imgurl[0]),
   #  'User-Agent': random.choice(UA)['User-Agent'],
   # 'Accept-Encoding': 'gzip, deflate',
   #  'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.6',
   #  'Accept': 'image/webp,image/apng,image/*,*/*;q=0.8',
   #  'upgrade-insecure-requests': '1',
   #  'Connection': 'keep-alive'}
    
    # if not os.path.exists(dirs):
    #     print(111111111111)
    #     os.mkdir(dirs)
    # with open(dirs+'/'+imgname+'.jpg', "wb+") as jpg:
    #     jpg.write(requests.get(imgurl[0], headers=header).content)
</code></pre> 
  <p><a href="http://items.py" rel="nofollow">items.py</a>:<br> import scrapy</p> 
  <p>class MeiziItem(scrapy.Item):<br> # define the fields for your item here like:<br> name = scrapy.Field()<br> imgurl=scrapy.Field()<br> imgname=scrapy.Field()<br> <a href="http://pipelines.py" rel="nofollow">pipelines.py</a>:<br> import scrapy,random<br> from scrapy.exceptions import DropItem<br> from scrapy.pipelines.images import ImagesPipeline<br> from Meizi.spiders.meizi import UA<br> class MeiziPipeline(object):<br> def process_item(self, item, spider):<br> return item<br> class ImagePipeline(ImagesPipeline):<br> def get_media_requests(self, item, info):<br> # print(info)<br> header={<br> ‘Referer’: ‘{}’.format(item[‘imgurl’]),<br> ‘User-Agent’: random.choice(UA)[‘User-Agent’],<br> ‘Accept-Encoding’: ‘gzip, deflate’,<br> ‘Accept-Language’: ‘zh-CN,zh;q=0.8,en;q=0.6’,<br> ‘Accept’: ‘image/webp,image/apng,image/<em>,</em>/<em>;q=0.8’,<br> ‘upgrade-insecure-requests’: ‘1’,<br> ‘Connection’: ‘keep-alive’}<br> yield scrapy.Request(item[‘imgurl’],headers=header)<br> def item_completed(self, results, item, info):<br> image_paths = [x[‘path’] for ok, x in results if ok]<br> if not image_paths:<br> raise DropItem(“Item contains no images”)<br> item[‘imgurl’] = image_paths<br> return item<br> def file_path(self, request, response=None, info=None):<br> imgname = request.meta[‘imgname’].strip(’ ‘)<br> # print(item)<br> # image_guid = request.url.split(’/’)[-1]<br> imgname = re.sub(r’[？\</em>|“&lt;&gt;:/]’, ‘’, imgname)<br> name=request.meta[‘name’].strip(’ ‘)<br> name=re.sub(r’[？\*|“&lt;&gt;:/]’, ‘’, name)<br> filename = u’full/{}/{}’.format(name,imgname)<br> return filename<br> settings.py配置:<br> BOT_NAME = ‘Meizi’</p> 
  <p>SPIDER_MODULES = [‘Meizi.spiders’]<br> NEWSPIDER_MODULE = ‘Meizi.spiders’<br> ROBOTSTXT_OBEY = False<br> DOWNLOAD_DELAY = 3<br> ITEM_PIPELINES = {<br> ‘Meizi.pipelines.MeiziPipeline’: 300,<br> ‘Meizi.pipelines.ImagePipeline’: 300, #开启图片管道<br> }<br> IMAGES_STORE =’/home/gg/Meizi/Meizi/Images’ #设置存储路径</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
