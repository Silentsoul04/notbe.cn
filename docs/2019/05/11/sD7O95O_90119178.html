<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>浅谈容量规划 « NotBeCN</title>
  <meta name="description" content="             俗话说，”人无远虑，必有近忧”，容量规划就是”远虑”。所谓容量规划，是一个产品满足用户目标需求而决定生产能力的过程。当产品发展到一个较为稳定成熟的阶段，产品的整体处理能力的把控自然是不可或缺，尽管我们在线下做性能测试能够获得一些数据，其参考价值终究有限。但是我们常常被问到以下一些问题而无...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2019/05/11/sD7O95O_90119178.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">浅谈容量规划</h1>
    <p class="post-meta">May 11, 2019</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">俗话说，”人无远虑，必有近忧”，容量规划就是”远虑”。所谓容量规划，是一个产品满足用户目标需求而决定生产能力的过程。当产品发展到一个较为稳定成熟的阶段，产品的整体处理能力的把控自然是不可或缺，尽管我们在线下做性能测试能够获得一些数据，其参考价值终究有限。但是我们常常被问到以下一些问题而无以应对。</p>
   <blockquote style="background:rgb(255,255,255) none;border-width:2px;border-top-style:solid;border-right-style:solid;border-bottom-style:solid;border-color:rgb(239,239,239);color:rgb(51,51,51);font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">
    <p>1.单台节点到底最大处理能力是多少？ 　　&nbsp;<br>2.目前线上有多少容量正在被使用？&nbsp;<br>3.在一次大促前当前的机器数是否能够支撑？&nbsp;<br>4.什么时候需要增加机器？加多少？</p>
   </blockquote>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　这时候，容量规划就显得格外必要了。通过对容量规划学习，谈谈自己对容量规划的认识和理解。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　什么样的集群适合做容量规划？只有线性可水平扩展的集群，我们才能通过获取一个节点的处理能力，计算出集群的处理能力，否则将会费很大物力和人力。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　怎么做容量规划？一句话概括：线上压测到单节点的某一指标达到临界值，从而计算出集群的最大处理能力，再根据线上历史监控获得当前集群实际运行负荷，通过计算即可求出理论机器。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　容量规划能指导我们做什么？如果计算出集群当前的负荷快达到极限处理能力时，我们可以垂直扩展(加CPU/内存/磁盘)和水平扩展(加机器)两种方式来增加集群容量。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　<strong>容量规划6步走</strong></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step1：明确目标</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　容量规划和计算，我们可以用运筹学中的优化命题来定义，优化命题的目标是集群实际负荷 &lt;=集群理想负荷，求解这样一个不等式优化命题，同时系统需要满足一定的不等式约束条件。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　(1) 目标：</p>
   <p><img style="border-width:0px;font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8hd45CVfvKogs66REn0WXjEJUhZpa4SI77S4ia9mG5qJbhnYOopg509w/640?wx_fmt=png" alt="640?wx_fmt=png"><br></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><br></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">备注：</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8ILM2tQWRzGibVECj7qXKAwicJHM7nhAofFRuzo0l0lWFostbSzzlhuiag/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8OQtKic1MPbf5CLQW1AacQUmwj3vzp5tibe91PjwWuvxFAMKodF91BgRw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(2) 约束条件：&nbsp;<br><img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8ffeNACAwJNH7YpOvCiaibibrSwkjYjdianGMiaFz1icbiaN3ZViatX0tcDDViaw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　当然满足目标的同时，集群的状态是受到约束的，资源是不可能无限供应，终会有一项资源会达到临界值。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step2：了解集群特点</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　不同的集群在选取容量指标和约束条件时是完全不同的，容量指标在后面会介绍，主要用于衡量集群的处理能力，而约束条件是压测停止的信号。举例说明，对于CPU密集型的集群，我们常常会选择TPS(每秒处理请求书)作为集群的容量指标来衡量集群的处理能力，而约束条件中则会重点关注CPU的使用率是否率先成为瓶颈；对于存储型的集群，选择流量(MB/S)作为容量指标，存储型的集群TPS依赖于业务数据大小，所有流量更适合作为表征集群的处理能力，而约束条件最先成为瓶颈的是网络流量或者IO。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　而判断集群式何种类型则可以通过线下的性能测试结果来判断，线下的性能测试可以作为线上压测的参考依据。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step3：选取容量指标</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　容量指标主要用作衡量服务器的处理能力。容量指标的选取原则：1)线上数据可采集2)能够客观反映服务器处理能力。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　作为容量指标，需要通过线上监控获取统计数据，其历史数据用于计算集群的实际负荷，而通过压测获得集群的最大处理能力。如上所说，CPU密集型集群常选TPS作为容量指标，而存储型集群常选流量作为容量指标。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step4：明确约束条件</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　约束条件的存在主要是作为线上压测停止的信号，常常会包括业务指标和资源指标。其中只要有一项指标达到临界值，则停止压测将当前容量指标的值作为集群的最大处理能力，例如某项服务质量要求响应时间不超过100ms，那当响应时间达到临界值时，尽管其它指标并没有达到极限但是也把此时作为集群最大处理能力。因此服务指标的选取原则：1)业务需求 2)资源使用瓶颈。一则保证产品的服务质量，二来保证系统的安全。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step5：线上压测</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　线上压测的主要目的主要用于获取集群的最大处理能力，而对于线上压测的手段主要介绍三种，针对不同的集群系统架构特点和业务类型选取不同的压测手段。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　<strong>模拟请求</strong></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　<img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8wLP6LbBpnprr3Cq0gyLib1mlaNftsCmdtVBag4cIGO9WDInglpmW9dA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　模拟请求，即是模拟客户端的调用方式向压测服务器发起请求，简单易操作。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　测试数据：可以通过分析线上日志分析，根线上业务配比建立压测模型，对于HTTP请求业务还有一种简单的方式，通过提取线上日志数据URL直接用于压测请求数据。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　实施步骤</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(1) 将线上一台节点offline，测试客户端直连被测服务器&nbsp;</span><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(2) 客户端梯度增加并发(50),不断增加并发直至超过设定的服务指标</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　优缺点</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　测试效果不受服务实际流量的限制，压测时间灵活，适用于GET请求不会产生脏数据。业务指标可以通过测试客户端直接获取。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　风险评估</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　风险低，首先机器offline不会影响到线上的正常请求；其次缓慢增加并发，不会造成服务崩溃的情况。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　<strong>线上引流</strong></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　&nbsp;<img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8m6qEps0hgccGV1yaWeABRnjlPRTCajCbBibuBombkkMvVuIw2t2plyA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　 　　线上引流，即将线上其它节点的请求复制到被测服务器上，推荐使用Tcpcopy工具。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　测试数据：线上请求直接复制引流，无需准备数据</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　实施步骤</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(1) 将线上一台节点Off-line，按照Tcpcopy部署的方法部署client和server，为了便于指标的统计，通常将Tcpcopy部署在nginx所在服务器，被压测服务器前需要增加一层nginx服务器。&nbsp;</span><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(2) 将集群的其它节点流量复制到off-line节点上，可以通过tcpcopy –r参数逐步增加复制系数，不断增加-r参数直至超过设定的服务指标&nbsp;</span><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(3) 如果100%全部线上流量都不能压测到off-line节点的瓶颈，再逐步放大引流系数</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　优缺点</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　请求真实，能够放大流量，测试效果不受服务实际流量的限制，压测时间灵活，但环境部署稍微麻烦，对于PUT请求需要做一些业务处理，避免产生脏数据。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　风险评估</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　风险低，首先机器offline不会影响到线上的正常请求，缓慢增加流量复制，不会造成服务崩溃的情况。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　<strong>修改负载权重</strong></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　<img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8v9wdia5zoymqW7LlLdibsDdWJJahZmUw0t9ZRHOuQq57oAS8bGvPLdyQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><br></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　对于一个集群，前面往往会有负载均衡服务器，以Nginx为例，通过修改Upstream模块的负载均衡weight可以不断增加集群某一节点的请求数，增加其访问压力。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　测试数据：无需准备</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　实施步骤</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(1) 缓慢增加nginx的负载均衡系数，使被测节点压力不断增加&nbsp;</span><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　(2) 直至超过设定的服务指标停止增加压力</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　优缺点</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　完全真实的场景，压测数据准确，但是依赖自身的流量，压测时间不灵活，需在高峰期，对用户体验有一定影响，随着一台机器的负载增加响应时间会受到一定影响，会直接反馈给在线用户。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　风险评估</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　风险低，虽然在高峰期进行，但是只需要修改nginx配置再reload，对服务基本无影响，且每次都逐步增加weight，不会造成服务器崩溃的情况。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　Step6：线上监控</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　线上监控不仅用于集群历史数据的收集，计算集群的实际负荷的监控，还用于压测过程中监控约束条件中的各种指标是否超限并停止压测。根据集群的特点和之前性能测试经验关注容量指标和约束条件的业务和资源指标。而这里的历史数据，是需要长期的采集和整理。</p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　小结</p>
   <p><br style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><span style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　综上所述，容量规划主要围绕着这么一个等式展开工作，纸上谈来终觉浅，实践出真知。希望能够在接下来的实践中成长和收获。</span></p>
   <p style="font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;">　　 　　<img style="border-width:0px;" title="" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/gak2lhVxV6ITuKLHfwy6JfNZMkq7VQz8hFUhQYeKLEFKwAYqeazgXyraVmMVT3wSibUianUhT64U3tGUN4Pbwdzg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="min-height:1em;letter-spacing:.544px;font-family:'PingFang SC', 'Source Sans Pro', 'Hiragino Sans GB', 'Helvetica Neue', Helvetica, 'Microsoft Yahei', arial, sans-serif;font-size:14px;text-align:left;"><em>原文地址：https://www.cnblogs.com/qwop/p/6637351.html</em></p>
   <pre style="letter-spacing:.54px;"></pre>
   <p style="min-height:17px;"><span style="font-size:14px;">.NET社区新闻，深度好文，欢迎访问公众号文章汇总&nbsp;http://www.csharpkit.com&nbsp;<br></span><img style="letter-spacing:.54px;font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/gak2lhVxV6Ll3Rjypick8DKRBSUpPIgFyCxeb5deosVPTBP2DJO7FENibZQVoweibm12hN3icfjxz4TVrPoZCpUVWA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
