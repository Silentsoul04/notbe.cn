<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>自述创业史 | XMove动作感应系统(二) « NotBeCN</title>
  <meta name="description" content="                  XMove是沙漠君和几个死党从2010年开始开发的一套人体动作捕捉系统，软硬件全部自行开发，投入了大量的精力，历经三年，发展四个版本。文章分上下篇，本文为下篇，前三代的故事在《光荣与梦想| XMove动作感应系统(一)》，建议阅读。     2012年的最后一天，我安静地走出科...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2016/11/29/weixin_34268843_90118561.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">自述创业史 | XMove动作感应系统(二)</h1>
    <p class="post-meta">Nov 29, 2016</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body cnblogs-markdown"> 
    <p>XMove是沙漠君和几个死党从2010年开始开发的一套<strong>人体动作捕捉</strong>系统，软硬件全部自行开发，投入了大量的精力，历经三年，发展四个版本。文章分上下篇，本文为下篇，前三代的故事在《<a href="http://www.cnblogs.com/buptzym/p/6369857.html" rel="nofollow">光荣与梦想| XMove动作感应系统(一)</a>》，建议阅读。</p> 
    <p>2012年的最后一天，我安静地走出科研楼的大门，那一天，我停止了对XMove所有的开发和维护。这个我曾为其痴迷，痛苦和成长的项目，正式成为了过去式。</p> 
    <p>然而2011年暑假，本科毕业刚喝完散伙酒的我才不这么想，制定了一大堆目标，兴冲冲的上路了：</p> 
    <h2>第四代的小目标：赚它一套学区房</h2> 
    <p>如果我们想捕捉人体完整的动作，至少需要23个节点。但前三代因为条件所限，只有手脚四个节点。第四代传感器覆盖了从头到脚的每个关键位置，最终效果是这样的：</p> 
    <p><img alt="全身动作捕捉" src="http://pic002.cnblogs.com/images/2012/287060/2012061510574479.jpg"></p> 
    <p>穿上这套服装，然后在广场打一套太极拳，传感器就会通过无线传递给手机，手机利用无线网络传回电脑，系统会记录和分析每一个动作细节，然后给出动作相似度和建议，一旦用户摔倒，马上就会检测到。</p> 
    <p>彼时正值移动互联网创业，这样的“人体物联网”思路别具一格：中科院投入千万在类似的项目上，国外类似产品笨重低效却卖75万一套，智能硬件和健康一定会在未来成为风口。虽然有基于摄像头的类似设备Kinect，但它在阳光下完全不能工作，可XMove毫无压力。</p> 
    <p>如果能满足健身爱好者和舞蹈家的要求，我相信这套系统至少能赚个北京一套房（2011年二环内三万一平）。</p> 
    <h2>超轻薄的动作传感器</h2> 
    <p>因为要贴在人身上，所以传感器必须非常轻薄，我们选用了超小的CPU，加速度计和陀螺仪，用手工焊接出了50套微型节点（这样才够两个人嘛），成品只有4mm厚度，比手机常用的TF卡稍微大一些：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071415294768.jpg"></p> 
    <p>调试微型节点遇到了很大的困难：传感器数据总是读取失败！刚开始以为是硬件问题，重做了七八次电路，多花了几万块钱，电路板堆得有一米高，项目延期了接近半年！险些要放弃的我，最后在国外某篇文献里查到了答案。当时我疯了，冲出去大喊大叫！</p> 
    <p>如果你吐槽软件开发难，是因为不知道做硬件有多苦，焊接米粒一样的芯片，省吃俭用，而一不小心就能烧掉一个月的饭钱。遇到问题得靠大量的经验去解决，硬件工程师是用钱和汗水堆出来的，此话并不为过。</p> 
    <p>为了解决多个节点的无线通信和充电，我们设计了“节点航母”，它能最多同时与32个节点通信，把节点插在航母上就能充电，还能通过蓝牙把数据传给手机：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071416394957.jpg"></p> 
    <p>我还给XMove专门设计了一个手柄(下图最右)，包含八个按键，两个摇杆，想想真丧心病狂。这是所有4代硬件的全家福：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071415125424.jpg"></p> 
    <p>然而，我们还是遇到了几乎无法解决的问题：无线通信。电池容量太小，当时的蓝牙2.0功耗太高，更高级的无线方案根本用不起。</p> 
    <p>我们自行设计了支持自动跳频，时隙划分，支持自动组网和路由，功耗低于2mA的通信协议：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071419172832.jpg"></p> 
    <p>管理端能够方便的监控每个节点的状态：</p> 
    <p><img alt="image_1b7k1j3l3or1o6c1vb41713136o2o.png-725.2kB" src="http://static.zybuluo.com/buptzym/w74k0biqazdr7j0fiecbs3ja/image_1b7k1j3l3or1o6c1vb41713136o2o.png"></p> 
    <p>然而，成也萧何败萧何。当23个节点同时以32帧的速率传输数据时，信道质量变得出奇的差。无线芯片底层采用GFSK调制，而底层CRC校验错误一个字节，就会抛弃整个包。节点间干扰非常严重，发射功率太低，只要转身发生阻挡，丢包率90%以上！</p> 
    <p>我曾想通过数据平滑来对丢失数据做补偿，然而这么高的丢包率让一切方案变得束手无策。我们没有设计天线的经验，北邮在这个领域强手如林，我们寻遍各大实验室，大神给的方案都败在了功耗和成本上：那些方案几分钟内就会消耗完那可怜电池的所有电量。</p> 
    <h2>Android版本的XMove</h2> 
    <p>由于手机要作为信号中继，也是重要的传感器之一，XMove就肯定要涉及手机端。</p> 
    <p>2011年暑假，我就开发了这个安卓版本的XMove组件。下面是手机无线多点触摸板，支持双指缩放和三指拖拽，能与电脑通过WIFI和3G信号连接，这是使用截图：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071114230818.jpg"></p> 
    <p>安卓手机端的界面截图：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071114065286.jpg"></p> 
    <p>还有通过手机旋转和倾斜实现的飞行游戏手柄(著名的飞行战斗游戏HAWX)：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071114205759.jpg"></p> 
    <p>我还专门针对安卓版本开发了一版PC管理器：</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071114022065.jpg"></p> 
    <p>我通过XMove学会了安卓开发，那时安卓程序员还是凤毛菱角，赚钱超多，好后悔没有对安卓投入更多的精力。不过现在看来，安卓开发已经没落了，数据算法工程师反而独占鳌头。哈哈哈。</p> 
    <h2>强大的监控端</h2> 
    <p>为了能够监控不同节点，重建人体动作，我花了大量时间，开发了爬虫Hawk的祖奶奶，功能强大的监控软件XMove Studio:</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071321235626.jpg"></p> 
    <p>你能对任意节点进行路由组网，远程配置，通过拖拽支持复杂的应用。它是Hawk的最初原型！</p> 
    <p>管理端能用3D形式展示数据流是如何从传感器传入到不同应用，并能监控各节点的信号强度，电量等关键信息:</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012071321290474.jpg"></p> 
    <p>也许你发现了，这套系统有过度设计的嫌疑。很多功能不重要，却浪费了过多时间，而最核心的算法部分，却没有分配足够的精力。</p> 
    <h2>实现3D人体重建</h2> 
    <p>可能你对上一篇文章中展示节点姿态的茶壶有印象。为了重建人体，就需要操控人体3D骨骼。我从头学了一遍OpenGL，一点点地研究四元数绑定，和矩阵变换，刚开始实现的效果是这样：</p> 
    <p><img alt="image_1b7k4q7hv196m19q6td71mk81rc79.png-122.1kB" src="http://static.zybuluo.com/buptzym/og0xrgqlchndnil92bbg8kr2/image_1b7k4q7hv196m19q6td71mk81rc79.png"></p> 
    <p>想想看一个在X光片里的骷髅跟着你来回乱动了，妹子们都表示太吓人了！我不得不放弃了这个OpenGL方案。</p> 
    <p>最后才用到了Unity3D，这个超强的3D引擎，配合我写的C#远程RPC(程序之间互相通信的协议)，很好地解决了这一问题，效果还不错，搬运工森林旅游即视感：</p> 
    <p><img alt="image_1b7k53of333811nnebf1hg71hnpm.png-841.4kB" src="http://static.zybuluo.com/buptzym/72m5se28oy3gjvp4bgcc1thm/image_1b7k53of333811nnebf1hg71hnpm.png"></p> 
    <p>不过因为丢包的问题，突然胳膊肘就拐到身后，大腿就撇到了头上：搬运工哥哥各种丧病的动作，把参观者笑个半死，哈哈哈哈哈。苦中作乐，苦中作乐！</p> 
    <p>加速度计，磁力计和陀螺仪的原始数据是不能直接给3D引擎用的，需要做传感器融合和姿态解算。当时AHRS(全姿态解算)找不到像样的资料，我不得不花了好多精力研究，这是当时演算的一部分手稿：</p> 
    <p><img alt="image_1b7k5e55n1u34dir118f1hjkdhl13.png-235.3kB" src="http://static.zybuluo.com/buptzym/4rfx70miekrpt20o45f8f7bk/image_1b7k5e55n1u34dir118f1hjkdhl13.png"></p> 
    <p>之前用SVM解决动作判别，但无法处理流式数据。因此我尝试用HMM(隐马尔科夫链)去监测奔跑跳跃，摔倒或挥手，还能分析它与标准动作的相似度，但效果总是不好。当时对步态识别能搞个八九不离十，更复杂的就搞不定了。现在想起来，低阶HMM无法根本解决它，而三年后才出现解决这类问题的算法LSTM（哭）...</p> 
    <h2>从激情到放弃</h2> 
    <p>XMove第四代，消耗的精力是前三代总和的接近两倍。虽获得了学校老师的帮助，不过经费基本自掏腰包。开发出两套原型机，在无干扰的环境下，能实现基本的动作捕捉，而一旦无线环境恶劣，通信问题就让整个系统乱套了。</p> 
    <p>当朋友们出门旅游玩耍，我却低头检查硬件问题；当同学们在各大名企实习，我在调动作识别算法。在实验室繁重的项目压力下，我还要在XMove上投入足够多的精力和资金。直到最后，它都没有商业化应用，雷声大雨点小，因为它太不稳定了。</p> 
    <p>曾经充满美好幻想的我，却看不到未来，终于在2012年的最后一天，我决定及时止损，出现了开头出现的那一幕。</p> 
    <p>究其失败原因：</p> 
    <ul>
     <li> <p>严重的过度设计，一股脑地把所有的自己想到的需求塞进去，根本没有调研目标用户怎么想。</p> </li> 
     <li> <p>大量的精力投入到根本不是核心的监控端开发，却没有在动作捕捉算法上下足够功夫。</p> </li> 
     <li> <p>缺乏硬件经验：事先调研不足，对无线信道效率估计过高，适合我们的无线方案，直到2015年才出现。</p> </li> 
    </ul>
    <p>这还仅仅是研发层面的困难，更不用说交付给用户后，电池老化，软件稳定性的问题：我们的硬件根本不可靠，渗进汗水可能就短路烧坏了。</p> 
    <p>因为XMove，我甚至开始怀疑面向对象编程。如果我现在写Python版本的XMove驱动和管理端，代码还是不会超过1000行，函数式风格，结构肯定会远好高于之前的设计。</p> 
    <p>我依然记得2012年的正月初一到初七，我拒绝了大部分的走亲访友，一个人在家憋着写代码；记得和队友一起，钻在实验室的焊接台下，检查着每一个焊点，之后只敢去食堂吃最便宜的菜；也记得因为无线通信不论如何都无法解决，气愤地在操场上大喊大叫。</p> 
    <p>不过，我不后悔。</p> 
    <p>我也记得它给我带来的兴奋和成绩。XMove在我大学和研究生阶段，写下了浓墨重彩的一笔。它驱使我解决一个个实际的问题，对架构有了嗅觉，能够随时警惕过度设计，知道了简洁远优于复杂的道理。也知道如何做合理的商业决策，避免因为自己的幻想，一条道走到黑。</p> 
    <p>XMove寿终正寝，但它依然以文章的形式出现在我的博客中。在Git Hub里也开源了它的部分代码。我给它装了一个精心设计的塑料盒，放在书房里。</p> 
    <p><img alt="此处输入图片的描述" src="http://pic002.cnblogs.com/images/2012/287060/2012032521183330.jpg"></p> 
    <p>这就是我和XMove的故事。</p> 
    <h2>后记</h2> 
    <ol>
     <li>据不完全统计，XMove在两年内占据了我50%以上的工作时间。</li> 
     <li>XMove能同时兼容2012年上市的Kinect，并提供统一的API</li> 
     <li>笔者在之后金盆洗手，不接触任何硬件开发项目</li> 
     <li>2013年开始，智能硬件成为风口，大量类似产品出现，但之后浪潮退净，幸存者所剩无几</li> 
    </ol>
   </div> 
   <div> 
    <div> 
     <p style="border-top:#e0e0e0 1px dashed;border-right:#e0e0e0 1px dashed;border-bottom:#e0e0e0 1px dashed;border-left:#e0e0e0 1px dashed;background:#e5f1f4 url(&quot;https://images.cnblogs.com/cnblogs_com/lloydsheng/239039/o_copyright.gif&quot;) no-repeat 1% 50%;font-family:'微软雅黑';font-size:11px;"><br> 作者：<a href="http://www.cnblogs.com/buptzym/" rel="nofollow">热情的沙漠</a> <br> 出处：<a href="http://www.cnblogs.com/buptzym/" rel="nofollow">http://www.cnblogs.com/buptzym/</a> <br> 本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。 <br></p> 
    </div> 
   </div> 
   <div class="clear"></div> 
   <div> 
    <div>
     分类: 
     <a href="http://www.cnblogs.com/buptzym/category/809619.html" rel="nofollow">开源项目</a> 
    </div> 
    <div>
     标签: 
     <a href="http://www.cnblogs.com/buptzym/tag/XMove/" rel="nofollow">XMove</a> 
    </div> 
    <div>
     <br>
    </div> 
    <div>
     本文转自FerventDesert博客园博客，原文链接：http://www.cnblogs.com/buptzym/p/6369859.html，如需转载请自行联系原作者
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
