<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Beam编程系列之Apache Beam WordCount Examples（MinimalWordCount example、WordCount example、Debugging WordCou... « NotBeCN</title>
  <meta name="description" content="                 https://beam.apache.org/get-started/wordcount-example/           &nbsp;    &nbsp;    &nbsp;    &nbsp;    　　来自官网的：    The WordCount examples ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2016/11/27/weixin_33922672_90125115.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Beam编程系列之Apache Beam WordCount Examples（MinimalWordCount example、WordCount example、Debugging WordCou...</h1>
    <p class="post-meta">Nov 27, 2016</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>https:<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">beam.apache.org/get-started/wordcount-example/</span></pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2017.cnblogs.com/blog/855959/201709/855959-20170929115212309-1960761368.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<strong><span style="color:rgb(0,0,255);">来自官网的：</span></strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">The WordCount examples demonstrate how to set up a processing pipeline that can read text, tokenize the text lines into individual words, and perform a frequency count on each of those words. The Beam SDKs contain a series of these four successively more detailed WordCount examples that build on each other. The input text for all the examples is a set of Shakespeare’s texts.</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">Each WordCount example introduces different concepts in the Beam programming model. Begin by understanding Minimal WordCount, the simplest of the examples. Once you feel comfortable with the basic principles in building a pipeline, continue on to learn more concepts in the other examples.</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"> <strong>Minimal WordCount</strong>&nbsp;demonstrates the basic principles involved in building a pipeline.</li> 
    <li style="list-style:disc;"> <strong>WordCount</strong>&nbsp;introduces some of the more common best practices in creating re-usable and maintainable pipelines.</li> 
    <li style="list-style:disc;"> <strong>Debugging WordCount</strong>&nbsp;introduces logging and debugging practices.</li> 
    <li style="list-style:disc;"> <strong>Windowed WordCount</strong>&nbsp;demonstrates how you can use Beam’s programming model to handle both bounded and unbounded datasets.</li> 
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　我这里仅以<strong>Minimal WordCount为例。</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　首先说明一下，为了简单起见，我直接在代码中显式配置指定PipelineRunner，示例代码片段如下所示：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>PipelineOptions options =<span style="font-size:12px;line-height:1.5;"> PipelineOptionsFactory.create();
options.setRunner(DirectRunner.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　如果要部署到服务器上，可以通过命令行的方式指定PipelineRunner，比如要在Spark集群上运行，类似如下所示命令行：</p> 
   <div class="syntaxhighlighter" style="font-size:14px;font-family:Verdana, Arial, Helvetica, sans-serif;"> 
    <div class="cnblogs_code" style="background:none;border:0px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;line-height:1.1em;vertical-align:baseline;">
     <pre>spark-submit --<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> org.shirdrn.beam.examples.MinimalWordCountBasedSparkRunner <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2017</span>-<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">01</span>-<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">18</span> --master spark:<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">myserver:7077 target/my-beam-apps-0.0.1-SNAPSHOT-shaded.jar --runner=SparkRunner</span></pre>
    </div> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>　　下面，我们从几个典型的例子来看（基于Apache Beam软件包的examples有所改动），Apache Beam如何构建Pipeline并运行在指定的PipelineRunner上：</p> 
    <ul>
     <li style="list-style:disc;"><span style="font-size:18px;"><strong><span style="color:rgb(0,0,255);">WordCount（Count/Source/Sink）</span></strong></span></li>
    </ul>
    <p>　　我们根据Apache Beam的MinimalWordCount示例代码开始，看如何构建一个Pipeline，并最终执行它。 MinimalWordCount的实现，代码如下所示：</p> 
    <div class="cnblogs_code" style="background:none;border:0px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;line-height:1.1em;vertical-align:baseline;"> 
     <div class="cnblogs_code_toolbar" style="background-image:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
      <span class="cnblogs_code_copy" style="font-family:'Courier New';font-size:12px;line-height:1.5;"><a title="复制代码" style="background-image:none;border:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-size:12px;line-height:1.5;">package org.shirdrn.beam.examples;

import org.apache.beam.runners.direct.DirectRunner;
import org.apache.beam.sdk.Pipeline;
import org.apache.beam.sdk.io.TextIO;
import org.apache.beam.sdk.options.PipelineOptions;
import org.apache.beam.sdk.options.PipelineOptionsFactory;
import org.apache.beam.sdk.transforms.Count;
import org.apache.beam.sdk.transforms.DoFn;
import org.apache.beam.sdk.transforms.MapElements;
import org.apache.beam.sdk.transforms.ParDo;
import org.apache.beam.sdk.transforms.SimpleFunction;
import org.apache.beam.sdk.values.KV;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> MinimalWordCount {

    @SuppressWarnings(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">serial</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) {

        PipelineOptions options </span>=<span style="font-size:12px;line-height:1.5;"> PipelineOptionsFactory.create();
        options.setRunner(DirectRunner.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 显式指定PipelineRunner：DirectRunner（Local模式）</span>
<span style="font-size:12px;line-height:1.5;">
        Pipeline pipeline </span>=<span style="font-size:12px;line-height:1.5;"> Pipeline.create(options);

        pipeline.apply(TextIO.Read.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">from</span>(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/tmp/dataset/apache_beam.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>)) <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 读取本地文件，构建第一个PTransform</span>
                .apply(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">ExtractWords</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, ParDo.of(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> DoFn&lt;String, String&gt;() { <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 对文件中每一行进行处理（实际上Split）</span>
<span style="font-size:12px;line-height:1.5;">
                    @ProcessElement
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> processElement(ProcessContext c) {
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (String word : c.element().split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">[\\s:\\,\\.\\-]+</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)) {
                            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (!<span style="font-size:12px;line-height:1.5;">word.isEmpty()) {
                                c.output(word);
                            }
                        }
                    }

                }))
                .apply(Count.</span>&lt;String&gt; perElement()) <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 统计每一个Word的Count</span>
                .apply(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">ConcatResultKVs</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, MapElements.via( <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 拼接最后的格式化输出（Key为Word，Value为Count）</span>
                        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SimpleFunction&lt;KV&lt;String, Long&gt;, String&gt;<span style="font-size:12px;line-height:1.5;">() {

                    @Override
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> String apply(KV&lt;String, Long&gt;<span style="font-size:12px;line-height:1.5;"> input) {
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> input.getKey() + <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">: </span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> +<span style="font-size:12px;line-height:1.5;"> input.getValue();
                    }

                }))
                .apply(TextIO.Write.to(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">wordcount</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>)); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 输出结果</span>
<span style="font-size:12px;line-height:1.5;">
        pipeline.run().waitUntilFinish();
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar" style="background-image:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
      <span class="cnblogs_code_copy" style="font-family:'Courier New';font-size:12px;line-height:1.5;"><a title="复制代码" style="background-image:none;border:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>　　Pipeline的具体含义，可以看上面代码的注释信息。下面，我们考虑以HDFS数据源作为Source，如何构建第一个PTransform，代码片段如下所示：</p> 
    <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;"> 
     <div class="cnblogs_code" style="background:none;border:0px;font-size:12px;line-height:1.1em;vertical-align:baseline;">
      <pre>PCollection&lt;KV&lt;LongWritable, Text&gt;&gt; resultCollection =<span style="font-size:12px;line-height:1.5;"> pipeline.apply(HDFSFileSource.readFrom(
        </span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">hdfs://myserver:8020/data/ds/beam.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">,
        TextInputFormat.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, LongWritable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>))</pre>
     </div> 
     <p>&nbsp;</p> 
    </div> 
    <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;">
     &nbsp;
    </div> 
    <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;"> 
     <p>　　可以看到，返回的是具有键值分别为LongWritable、Text类型的KV对象集合，后续处理和上面处理逻辑类似。如果使用Maven构建Project，需要加上如下依赖（这里beam.version的值可以为最新Release版本0.4.0）：</p> 
     <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
      <div class="cnblogs_code" style="background:none;border:0px;font-size:12px;line-height:1.1em;vertical-align:baseline;">
       <pre>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.beam&lt;/groupId&gt;
    &lt;artifactId&gt;beam-sdks-java-io-hdfs&lt;/artifactId&gt;
    &lt;version&gt;${beam.version}&lt;/version&gt;
&lt;/dependency&gt;</pre>
      </div> 
      <p>&nbsp;</p> 
     </div> 
     <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
      &nbsp;
     </div> 
     <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
      &nbsp;
     </div> 
     <div class="syntaxhighlighter" style="font-size:12px;background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
      <ul>
       <li style="list-style:disc;"><span style="font-size:18px;"><strong><span style="color:rgb(0,0,255);">去重（Distinct）</span></strong></span></li>
      </ul>
      <p>去重也是对数据集比较常见的操作，使用Apache Beam来实现，示例代码如下所示：</p> 
     </div> 
    </div> 
   </div> 
   <div class="syntaxhighlighter" style="font-size:14px;font-family:Verdana, Arial, Helvetica, sans-serif;"> 
    <div class="cnblogs_code" style="background:none;border:0px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;line-height:1.1em;vertical-align:baseline;"> 
     <div class="cnblogs_code_toolbar" style="background-image:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
      <span class="cnblogs_code_copy" style="font-family:'Courier New';font-size:12px;line-height:1.5;"><a title="复制代码" style="background-image:none;border:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-size:12px;line-height:1.5;">package org.shirdrn.beam.examples;

import org.apache.beam.runners.direct.DirectRunner;
import org.apache.beam.sdk.Pipeline;
import org.apache.beam.sdk.io.TextIO;
import org.apache.beam.sdk.options.PipelineOptions;
import org.apache.beam.sdk.options.PipelineOptionsFactory;
import org.apache.beam.sdk.transforms.Distinct;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> DistinctExample {

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) throws Exception {

         PipelineOptions options </span>=<span style="font-size:12px;line-height:1.5;"> PipelineOptionsFactory.create();
         options.setRunner(DirectRunner.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 显式指定PipelineRunner：DirectRunner（Local模式）</span>
<span style="font-size:12px;line-height:1.5;">
         Pipeline pipeline </span>=<span style="font-size:12px;line-height:1.5;"> Pipeline.create(options);
         pipeline.apply(TextIO.Read.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">from</span>(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/tmp/dataset/MY_ID_FILE.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
             .apply(Distinct.</span>&lt;String&gt; create()) <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 创建一个处理String类型的PTransform：Distinct</span>
             .apply(TextIO.Write.to(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">deduped.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>)); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 输出结果</span>
<span style="font-size:12px;line-height:1.5;">         pipeline.run().waitUntilFinish();
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar" style="background-image:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
      <span class="cnblogs_code_copy" style="font-family:'Courier New';font-size:12px;line-height:1.5;"><a title="复制代码" style="background-image:none;border:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p>&nbsp;</p> 
   </div> 
   <div class="syntaxhighlighter" style="font-size:14px;font-family:Verdana, Arial, Helvetica, sans-serif;">
    &nbsp;
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;">分组（GroupByKey）</li>
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">对数据进行分组操作也非常普遍，我们拿一个最基础的PTransform实现GroupByKey来实现一个例子，代码如下所示：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="font-size:12px;line-height:1.5;">package org.shirdrn.beam.examples;

import org.apache.beam.runners.direct.DirectRunner;
import org.apache.beam.runners.direct.repackaged.com.google.common.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">base</span><span style="font-size:12px;line-height:1.5;">.Joiner;
import org.apache.beam.sdk.Pipeline;
import org.apache.beam.sdk.io.TextIO;
import org.apache.beam.sdk.options.PipelineOptions;
import org.apache.beam.sdk.options.PipelineOptionsFactory;
import org.apache.beam.sdk.transforms.DoFn;
import org.apache.beam.sdk.transforms.GroupByKey;
import org.apache.beam.sdk.transforms.MapElements;
import org.apache.beam.sdk.transforms.ParDo;
import org.apache.beam.sdk.transforms.SimpleFunction;
import org.apache.beam.sdk.values.KV;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> GroupByKeyExample {

    @SuppressWarnings(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">serial</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) {

        PipelineOptions options </span>=<span style="font-size:12px;line-height:1.5;"> PipelineOptionsFactory.create();
        options.setRunner(DirectRunner.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 显式指定PipelineRunner：DirectRunner（Local模式）</span>
<span style="font-size:12px;line-height:1.5;">
        Pipeline pipeline </span>=<span style="font-size:12px;line-height:1.5;"> Pipeline.create(options);

        pipeline.apply(TextIO.Read.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">from</span>(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/tmp/dataset/MY_INFO_FILE.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
            .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">ExtractFields</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, ParDo.of(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> DoFn&lt;String, KV&lt;String, String&gt;&gt;<span style="font-size:12px;line-height:1.5;">() {

                @ProcessElement
                </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> processElement(ProcessContext c) {
                    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> file format example: 35451605324179    3G    CMCC</span>
                    String[] values = c.element().split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">);
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(values.length == <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span><span style="font-size:12px;line-height:1.5;">) {
                        c.output(KV.of(values[</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span>], values[<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">]));
                    }
                }
            }))
            .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">GroupByKey</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, GroupByKey.&lt;String, String&gt;create()) <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 创建一个GroupByKey实例的PTransform</span>
            .apply(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">ConcatResults</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">, MapElements.via(
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SimpleFunction&lt;KV&lt;String, Iterable&lt;String&gt;&gt;, String&gt;<span style="font-size:12px;line-height:1.5;">() {

                        @Override
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> String apply(KV&lt;String, Iterable&lt;String&gt;&gt;<span style="font-size:12px;line-height:1.5;"> input) {
                            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> StringBuffer()
                                    .append(input.getKey()).append(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
                                    .append(Joiner.on(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">,</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">).join(input.getValue()))
                                    .toString();
                        }


            }))
            .apply(TextIO.Write.to(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">grouppedResults</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">));

        pipeline.run().waitUntilFinish();

    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　使用DirectRunner运行，输出文件名称类似于grouppedResults-00000-of-00002、grouppedResults-00001-of-00002等等。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><strong><span style="color:rgb(0,0,255);">连接（Join）</span></strong></li>
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　最后，我们通过实现一个Join的例子，其中，用户的基本信息包含ID和名称，对应文件格式如下所示：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35451605324179</span><span style="font-size:12px;line-height:1.5;">    Jack
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35236905298306</span><span style="font-size:12px;line-height:1.5;">    Jim
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35236905519469</span><span style="font-size:12px;line-height:1.5;">    John
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35237005022314</span>    Linda</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　另一个文件是用户使用手机的部分信息，文件格式如下所示：</p> 
   <div class="syntaxhighlighter" style="font-size:14px;font-family:Verdana, Arial, Helvetica, sans-serif;"> 
    <div class="cnblogs_code" style="background:none;border:0px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;line-height:1.1em;vertical-align:baseline;">
     <pre><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35451605324179</span><span style="font-size:12px;line-height:1.5;">    3G    中国移动
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35236905298306</span><span style="font-size:12px;line-height:1.5;">    2G    中国电信
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">35236905519469</span>    4G    中国移动</pre>
    </div> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
   </div> 
   <div class="syntaxhighlighter"> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　我们希望通过Join操作后，能够知道用户使用的什么网络（用户名+网络），使用Apache Beam实现，具体实现代码如下所示：</p> 
    <div class="syntaxhighlighter" style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
     <div class="cnblogs_code" style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
      <div class="cnblogs_code_toolbar" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;background-image:none;border:0px;line-height:1.1em;vertical-align:baseline;">
       <span class="cnblogs_code_copy" style="font-family:'Courier New';font-size:12px;line-height:1.5;"><a title="复制代码" style="background-image:none;border:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
      </div> 
      <pre><span style="font-size:12px;line-height:1.5;">package org.shirdrn.beam.examples;

import org.apache.beam.runners.direct.DirectRunner;
import org.apache.beam.sdk.Pipeline;
import org.apache.beam.sdk.io.TextIO;
import org.apache.beam.sdk.options.PipelineOptions;
import org.apache.beam.sdk.options.PipelineOptionsFactory;
import org.apache.beam.sdk.transforms.DoFn;
import org.apache.beam.sdk.transforms.MapElements;
import org.apache.beam.sdk.transforms.ParDo;
import org.apache.beam.sdk.transforms.SimpleFunction;
import org.apache.beam.sdk.transforms.join.CoGbkResult;
import org.apache.beam.sdk.transforms.join.CoGroupByKey;
import org.apache.beam.sdk.transforms.join.KeyedPCollectionTuple;
import org.apache.beam.sdk.values.KV;
import org.apache.beam.sdk.values.PCollection;
import org.apache.beam.sdk.values.TupleTag;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> JoinExample {

    @SuppressWarnings(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">serial</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) {

        PipelineOptions options </span>=<span style="font-size:12px;line-height:1.5;"> PipelineOptionsFactory.create();
        options.setRunner(DirectRunner.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);  <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 显式指定PipelineRunner：DirectRunner（Local模式）</span>
<span style="font-size:12px;line-height:1.5;">
        Pipeline pipeline </span>=<span style="font-size:12px;line-height:1.5;"> Pipeline.create(options);

        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> create ID info collection</span>
        final PCollection&lt;KV&lt;String, String&gt;&gt; idInfoCollection =<span style="font-size:12px;line-height:1.5;"> pipeline
                .apply(TextIO.Read.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">from</span>(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/tmp/dataset/MY_ID_INFO_FILE.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
                .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">CreateUserIdInfoPairs</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">, MapElements.via(
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SimpleFunction&lt;String, KV&lt;String, String&gt;&gt;<span style="font-size:12px;line-height:1.5;">() {

                    @Override
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> KV&lt;String, String&gt;<span style="font-size:12px;line-height:1.5;"> apply(String input) {
                        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> line format example: 35451605324179    Jack</span>
                        String[] values = input.split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">);
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> KV.of(values[<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>], values[<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span><span style="font-size:12px;line-height:1.5;">]);
                    }

                }));

        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> create operation collection</span>
        final PCollection&lt;KV&lt;String, String&gt;&gt; opCollection =<span style="font-size:12px;line-height:1.5;"> pipeline
                .apply(TextIO.Read.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">from</span>(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/tmp/dataset/MY_ID_OP_INFO_FILE.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
                .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">CreateIdOperationPairs</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">, MapElements.via(
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SimpleFunction&lt;String, KV&lt;String, String&gt;&gt;<span style="font-size:12px;line-height:1.5;">() {

                    @Override
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> KV&lt;String, String&gt;<span style="font-size:12px;line-height:1.5;"> apply(String input) {
                        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> line format example: 35237005342309    3G    CMCC</span>
                        String[] values = input.split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">);
                        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> KV.of(values[<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>], values[<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span><span style="font-size:12px;line-height:1.5;">]);
                    }

                }));

        final TupleTag</span>&lt;String&gt; idInfoTag = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> TupleTag&lt;String&gt;<span style="font-size:12px;line-height:1.5;">();
        final TupleTag</span>&lt;String&gt; opInfoTag = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> TupleTag&lt;String&gt;<span style="font-size:12px;line-height:1.5;">();

        final PCollection</span>&lt;KV&lt;String, CoGbkResult&gt;&gt; cogrouppedCollection =<span style="font-size:12px;line-height:1.5;"> KeyedPCollectionTuple
                .of(idInfoTag, idInfoCollection)
                .and(opInfoTag, opCollection)
                .apply(CoGroupByKey.</span>&lt;String&gt;<span style="font-size:12px;line-height:1.5;">create());

        final PCollection</span>&lt;KV&lt;String, String&gt;&gt; finalResultCollection =<span style="font-size:12px;line-height:1.5;"> cogrouppedCollection
                .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">CreateJoinedIdInfoPairs</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, ParDo.of(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> DoFn&lt;KV&lt;String, CoGbkResult&gt;, KV&lt;String, String&gt;&gt;<span style="font-size:12px;line-height:1.5;">() {

                @ProcessElement
                </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> processElement(ProcessContext c) {
                    KV</span>&lt;String, CoGbkResult&gt; e =<span style="font-size:12px;line-height:1.5;"> c.element();
                    String id </span>=<span style="font-size:12px;line-height:1.5;"> e.getKey();
                    String name </span>=<span style="font-size:12px;line-height:1.5;"> e.getValue().getOnly(idInfoTag);
                    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (String opInfo : c.element().getValue().getAll(opInfoTag)) {
                      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Generate a string that combines information from both collection values</span>
                      c.output(KV.of(id, <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> + name + <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> +<span style="font-size:12px;line-height:1.5;"> opInfo));
                    }
                }
        }));

        PCollection</span>&lt;String&gt; formattedResults =<span style="font-size:12px;line-height:1.5;"> finalResultCollection
                .apply(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">FormatFinalResults</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, ParDo.of(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> DoFn&lt;KV&lt;String, String&gt;, String&gt;<span style="font-size:12px;line-height:1.5;">() {
                  @ProcessElement
                  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> processElement(ProcessContext c) {
                    c.output(c.element().getKey() </span>+ <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> +<span style="font-size:12px;line-height:1.5;"> c.element().getValue());
                  }
                }));

         formattedResults.apply(TextIO.Write.to(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">joinedResults</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">));
         pipeline.run().waitUntilFinish();

    }</span></pre> 
      <pre><span style="font-size:12px;line-height:1.5;"><br></span></pre> 
      <pre><span style="font-size:12px;line-height:1.5;"><br></span></pre> 
      <pre><span style="font-size:12px;line-height:1.5;"><br></span></pre> 
      <pre><span style="line-height:1.5;"></span></pre> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
