<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>linux内核编程笔记【原创】 « NotBeCN</title>
  <meta name="description" content="             以下为本人学习笔记，如有转载请注明出处，谢谢    &nbsp;    1. service用法 oneshot    DEFINE_MUTEX(buzzer_mutex);    &nbsp;    mutex_lock(&amp;buzzer_mutex);    mutex_unl...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2016/03/15/weixin_34067102_90122650.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">linux内核编程笔记【原创】</h1>
    <p class="post-meta">Mar 15, 2016</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>以下为本人学习笔记，如有转载请注明出处，谢谢</p> 
   <p>&nbsp;</p> 
   <h4>1. service用法 oneshot</h4> 
   <p>DEFINE_MUTEX(buzzer_mutex);</p> 
   <p>&nbsp;</p> 
   <p>mutex_lock(&amp;buzzer_mutex);</p> 
   <p>mutex_unlock(&amp;buzzer_mutex);</p> 
   <p>&nbsp;</p> 
   <p>static void WriteNumber(const char *fileName, int number)</p> 
   <p>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FILE *fp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;fp = fopen(fileName, "w"); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;if (fp == NULL) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p> 
   <p>&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LCD_DEBUG("open %s error, errno %d\n", fileName, errno);</p> 
   <p>&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;return;&nbsp;</p> 
   <p>&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;}&nbsp; &nbsp;&nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; fprintf(fp, "%d", number);</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; fclose(fp);</p> 
   <p>&nbsp;}</p> 
   <p>&nbsp;</p> 
   <p>service aa /usr/bin/aa<br> class core<br> user root<br> group root<br> critical<br> onrestart restart aa<br> onrestart restart tt</p> 
   <p>#service bbd /usr/bin/bb<br>service bb /usr/bin/app_bbl_read<br> user root<br> group root<br> oneshot</p> 
   <p>&nbsp;</p> 
   <h4><span style="font-size:16px;color:#ff0000;"><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/gnuhpc/archive/2012/12/09/2810113.html" rel="nofollow"><span style="color:#ff0000;">2.【Shell脚本】怎样表示一个for循环</span></a></span></h4> 
   <div class="postBody"> 
    <div> 
     <p>作者：<a href="http://www.cnblogs.com/gnuhpc/" rel="nofollow">gnuhpc</a>&nbsp;<br>出处：<a href="http://www.cnblogs.com/gnuhpc/" rel="nofollow">http://www.cnblogs.com/gnuhpc/</a></p> 
     <p>在此说一下我常用的两个结构：&nbsp;<br><span style="font-family:'Microsoft YaHei';font-size:15px;">1.&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">for i in $(seq 1 100); do&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $i&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">done&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">2.&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">for (( i = 1 ; $i &lt;= 100; i++ )) ；do&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $i;&nbsp;</span><br><span style="font-family:'Microsoft YaHei';font-size:15px;">done</span></p> 
     <p>作者：<a href="http://www.cnblogs.com/gnuhpc/" rel="nofollow">gnuhpc</a>&nbsp;<br>出处：<a href="http://www.cnblogs.com/gnuhpc/" rel="nofollow">http://www.cnblogs.com/gnuhpc/</a></p> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;font-family:'Microsoft YaHei';font-size:15px;">3.对于关闭抢占的内核接口</span></h4> 
   <p>看内核接口是同步还是异步，比方说msleep就是异步接口，会休眠让出cpu</p> 
   <p>mdelay是忙等待，不会让出cpu</p> 
   <p>如果是同步接口的话，对于单核cpu，就不会出现多进程同时调用同一个接口出错的情况</p> 
   <p>如果是异步接口的话，就得具体问题具体分析，如果是仅仅避免多个进程调度同一个接口的情况的话，加信号量或者普通的锁就可以，不一定要加互斥锁，</p> 
   <p>如果是又有中间层调度接口，又有用户态上层调度接口，那么就另当别论了</p> 
   <p>&nbsp;</p> 
   <p>spin_lock这种锁是用来多核cpu共同调用同个接口的问题，</p> 
   <p>mutex_lock这种是会休眠，同个cpu的互斥锁，如果是进程上下文就可以用，如果是中断上下文就不能用这种锁，因为这种锁会休眠，中断中是不允许休眠的</p> 
   <p>&nbsp;</p> 
   <p>local_irq_save(flags);</p> 
   <p>local_irq_restore(flags);</p> 
   <p>&nbsp;</p> 
   <p>spin_lock_irqsave(&amp;iproc_bbl-&gt;lock, flags);</p> 
   <p>spin_unlock_irqrestore(&amp;iproc_bbl-&gt;lock, flags);</p> 
   <p>&nbsp;</p> 
   <h4><span style="font-family:'Microsoft YaHei';font-size:15px;"><span style="color:#ff0000;">4.网上大家经常碰到的不能连接问题:</span></span></h4> 
   <p>请在运行-cmd输入netstat -n 查看5222端口是否在建立状态 ESTABLISHED,这个方法来源自网络,部落没有遇到过.另外,还有一个,就是清空本地本地DNS缓存,具体步骤如下:</p> 
   <p>在windows下运行运行菜单,开始-&gt;运行,输入"CMD"进行命令行窗口,然后输入 ipconfig/flushdns 按回车键</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;font-family:'Microsoft YaHei';">5.休眠唤醒调试</span></h4> 
   <p>kernel/power/main.c中可以通过打印链表的信息，在休眠唤醒的时候将每个唤醒的源消耗的时间打印出来</p> 
   <p>&nbsp;dpm_run_callback（） ----》drivers/base/power</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;">6.中断中不可以加入打印</span></h4> 
   <p>中断处理函数应该避免调用不可重入函数, 因为新的中断可能发生并打断正在执行任务中，如果当前任务调用了一些不可重入的函数,将会产生错误。<br> 一些常用库函数如printf，malloc，free等都是不可重入函数,因为在函数中引用了全局变量, 这个道理因该很容易明白了吧?<br> 例如, printf会引用全局变量stdout，malloc，free会引用全局的内存分配表。</p> 
   <p>&nbsp;</p> 
   <p>arch/arm/kernel/debug.S:157: Error: too many positional arguments</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;">7.sys文件节点要注意返回值</span></h4> 
   <p>static inline ssize_t show_counter_sysfs(struct device *dev,<br> struct device_attribute *attr, char *buf)<br>{ <br> struct asiu_pwm_chip *asiu_pwm = dev_get_drvdata(dev);<br> int i, n;<br> long value;</p> 
   <p> n=0;<br> if(asiu_pwm) { <br> for (i=0; i&lt;6; i++) {<br> value = __onepulse_pwm_counter_extend(i);<br> n += sprintf(buf + n, "pwm_id(%d)----0x%x \n", i, value); <br> }<br> return n;<br> }<br> else<br> return -1;<br>}</p> 
   <p>static struct device_attribute sysfs_misc_list[] = {<br> __ATTR(onepluse_counter,S_IRUGO , show_counter_sysfs, NULL), <br>};</p> 
   <p>&nbsp;</p> 
   <p>/* tp info show include tp sw version, fw version, cfg csum, hw version */<br>static ssize_t tp_show(struct kobject *kobj, struct kobj_attribute *attr,<br> char *buf)<br>{<br> struct synaptics_rmi4_data *rmi4_data = exp_data.rmi4_data;<br> int len = 0;<br> int retval;<br> unsigned char config_id[4];</p> 
   <p> if (NULL == rmi4_data || !f34_ctrl_base_addr)<br> return -1;<br> /* Get device config ID */<br> retval = synaptics_rmi4_reg_read(rmi4_data,<br> f34_ctrl_base_addr,<br> config_id, sizeof(config_id));<br> if (retval &lt; 0) {<br> dev_err(rmi4_data-&gt;pdev,<br> "%s: Failed to read device config ID\n", __func__);<br> return -1;<br> }<br> len =<br> scnprintf(buf + len, PAGE_SIZE, "SW:%s\n",<br> SYNAPTICS_DSX_DRV_VERSION);</p> 
   <p> /* combine FW and CFG CSUM */<br> #define SPLIT_TAG "_CFGID"</p> 
   <p> len +=<br> scnprintf(buf + len, PAGE_SIZE, "FW:%u%s%02x%02x%02x%02x\n", rmi4_data-&gt;firmware_id,<br> SPLIT_TAG,<br> config_id[0],<br> config_id[1],<br> config_id[2],<br> config_id[3]);<br> /*<br> len +=<br> scnprintf(buf + len, PAGE_SIZE,<br> "CFG ID:0x%02x 0x%02x 0x%02x 0x%02x\n", config_id[0],<br> config_id[1], config_id[2], config_id[3]);<br> */<br> /* add for chipset name */<br> len += scnprintf(buf + len, PAGE_SIZE, "CHIP NAME:%s\n", "synaptics");</p> 
   <p><strong><span style="color:#ff0000;"> return len;</span></strong><br>}</p> 
   <p>sys 文件节点写函数的时候，<span style="color:#ff0000;">sh: write error: Bad address</span>，这种错误一般是return没有返回正确的值，</p> 
   <p>什么值是正确的呢？那就是count，长度这些才可以，那么系统是怎么识别的呢？要取决于文件系统和echo的实现</p> 
   <p>static ssize_t test_sysfs_get_report_store(struct device *dev,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;struct device_attribute *attr, const char *buf, size_t count)<br>{<br>&nbsp;&nbsp; &nbsp;int retval;<br>&nbsp;&nbsp; &nbsp;unsigned char command;<br>&nbsp;&nbsp; &nbsp;unsigned long setting;<br>&nbsp;&nbsp; &nbsp;struct synaptics_rmi4_data *rmi4_data = f54-&gt;rmi4_data;<br><br>&nbsp;&nbsp; &nbsp;retval = sstrtoul(buf, 10, &amp;setting);<br>&nbsp;&nbsp; &nbsp;if (retval)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return retval;<br><br>&nbsp;&nbsp;&nbsp; printk("zbh 111 \r\n");<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;if (setting != 1) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printk("zbh %s(): ---&gt; %d\r\n", __func__, __LINE__);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -EINVAL;<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;mutex_lock(&amp;f54-&gt;status_mutex);<br><br>&nbsp;&nbsp; &nbsp;retval = test_check_for_idle_status();<br>&nbsp;&nbsp; &nbsp;if (retval &lt; 0) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printk("zbh %s(): ---&gt; %d\r\n", __func__, __LINE__);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto exit;<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;if (!test_report_type_valid(f54-&gt;report_type)) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dev_err(rmi4_data-&gt;pdev,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;"%s: Invalid report type\n",<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;__func__);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;retval = -EINVAL;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printk("zbh %s(): ---&gt; %d\r\n", __func__, __LINE__);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto exit;<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;test_set_interrupt(true);<br><br>&nbsp;&nbsp; &nbsp;command = (unsigned char)COMMAND_GET_REPORT;<br><br>&nbsp;&nbsp; &nbsp;retval = synaptics_rmi4_reg_write(rmi4_data,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;f54-&gt;command_base_addr,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&amp;command,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sizeof(command));<br>&nbsp;&nbsp; &nbsp;if (retval &lt; 0) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dev_err(rmi4_data-&gt;pdev,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;"%s: Failed to write get report command\n",<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;__func__);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto exit;<br>&nbsp;&nbsp; &nbsp;}<br><br>/* tddi f54 test reporting + */<br>#ifdef F54_POLLING_GET_REPORT<br><br>&nbsp;&nbsp; &nbsp;retval = test_sysfs_get_report_polling();<br>&nbsp;&nbsp; &nbsp;if (retval &lt; 0) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dev_err(rmi4_data-&gt;pdev,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;"%s: Failed to get report image\n",<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;__func__);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printk("zbh 222 \r\n");<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto exit;<br>&nbsp;&nbsp; &nbsp;}<br><br>#else<br>/* tddi f54 test reporting - */<br><br>&nbsp;&nbsp; &nbsp;f54-&gt;status = STATUS_BUSY;<br>&nbsp;&nbsp; &nbsp;f54-&gt;report_size = 0;<br>&nbsp;&nbsp; &nbsp;f54-&gt;data_pos = 0;<br><br>&nbsp;&nbsp; &nbsp;hrtimer_start(&amp;f54-&gt;watchdog,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ktime_set(GET_REPORT_TIMEOUT_S, 0),<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;HRTIMER_MODE_REL);<br><br>&nbsp;&nbsp; <span style="color:#ff0000;">&nbsp;retval = count;</span><br><br>#endif<br>&nbsp;&nbsp;<span style="color:#ff0000;">&nbsp; retval = count; // ===》如果去掉这一行的话，那么echo&nbsp; 1 &gt; get_report 的话就会出现错误 <span style="color:#ff0000;">sh: write error: Bad address</span></span><br><br>exit:<br>&nbsp;&nbsp; &nbsp;mutex_unlock(&amp;f54-&gt;status_mutex);<br><br>&nbsp;&nbsp;&nbsp; printk("zbh %s(): retval=%d---&gt; %d\r\n", __func__, retval, __LINE__);<br><br>&nbsp;&nbsp; &nbsp;return retval;<br>}</p> 
   <p>&nbsp;</p> 
   <p>因为bbl会影响打印机，1s=1000000us</p> 
   <p>Bbl的时钟是32.768kHz，</p> 
   <p>所以1000000/32768=30us左右</p> 
   <p>也就是这个时钟的精度是30us，而bbl寄存器读status状态是延时10us，太短了，至少要在一个clock完成后再读，所以改成延时35us，</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;font-family:'Microsoft YaHei';">8.shell脚本循环</span></h4> 
   <p>#!/bin/sh</p> 
   <p>while true<br>do<br>let "i++"<br>echo "is $i"<br>done</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;">9.查看这些宏CONFIG_SMP在linux内核中是否有定义</span></h4> 
   <p>#ifndef CONFIG_SMP</p> 
   <p>要去linux3.6.5目录下.config文件</p> 
   <p>&nbsp;</p> 
   <h4> <span style="color:#ff0000;">10.书写代码框架注意</span>：</h4> 
   <p><span style="color:#ff0000;">goto 和return</span></p> 
   <p>&nbsp;</p> 
   <p>static int asiu_pwmc_config(struct pwm_chip *chip, struct pwm_device *pwm,</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int duty_ns, int period_ns)</p> 
   <p>{</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct asiu_pwm_chip *asiu_pwm = to_asiu_pwm_chip(chip);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct asiu_pwm_cfg *pwm_cfg;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned long period_counts, dutyhi_counts;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned long prescale = 0;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned long long ticks;</p> 
   <p>&nbsp;</p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pwm_cfg-&gt;enabled) {</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Change the PWM output with the new config */</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asiu_pwmc_disable(chip, pwm);</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //asiu_pwmc_enable(chip, pwm);</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>#ifdef PWMC_DEBUG</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dev_info(chip-&gt;dev, "%s : [pwm-%d] duty_ns = %d, period_ns = %d\n",</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __FUNCTION__, pwm-&gt;hwpwm, duty_ns, period_ns);</p> 
   <p>#endif</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (duty_ns == 0 &amp;&amp; period_ns ==0) {</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* PWM stay low, duty cycle = 0% */</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prescale = 0;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; period_counts = 0;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dutyhi_counts = 0;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if (duty_ns &gt;= period_ns) {</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* PWM stay high, duty cycle = 100% */</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prescale = 0;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; period_counts = ASIU_PWM_PERIOD_MASK;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dutyhi_counts = ASIU_PWM_DUTYHI_MASK;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ticks = (unsigned long long)period_ns * asiu_pwm-&gt;tick_hz;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do_div(ticks, NSEC_PER_SEC);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; period_counts = ticks;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prescale = period_counts &gt;&gt; ASIU_PWM_PEROID_WIDTH;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(prescale &amp; ~ASIU_PWM_PRESCALE_MASK) {</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dev_warn(chip-&gt;dev, "%s(%d) : period_counts = %d, prescale = 0x%x\n",</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __FUNCTION__, __LINE__, period_counts, prescale);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -EINVAL;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ticks = (unsigned long long)duty_ns * asiu_pwm-&gt;tick_hz;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do_div(ticks, NSEC_PER_SEC);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dutyhi_counts = ticks;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pwm_cfg = pwm_get_chip_data(pwm);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pwm_cfg) {</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dev_warn(chip-&gt;dev, "fail to get pwm config data\n");</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -ENOMEM;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pwm_cfg-&gt;prescale = prescale;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pwm_cfg-&gt;period_cnt = period_counts;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pwm_cfg-&gt;dutyhi_cnt = dutyhi_counts;</p> 
   <p>&nbsp;&nbsp;&nbsp;</p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (pwm_cfg-&gt;enabled) {</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Change the PWM output with the new config */</span></p> 
   <p><span style="color:#ff0000;">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //asiu_pwmc_disable(chip, pwm);</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asiu_pwmc_enable(chip, pwm);</span></p> 
   <p><span style="color:#ff0000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> 
   <p>&nbsp;</p> 
   <p>#ifdef PWMC_DEBUG</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dev_info(chip-&gt;dev, "%s : pwm_cfg-&gt;prescale = %d, period_cnt = %d, dutyhi_cnt = %d\n",</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __FUNCTION__, pwm_cfg-&gt;prescale, pwm_cfg-&gt;period_cnt, pwm_cfg-&gt;dutyhi_cnt);</p> 
   <p>#endif</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;</p> 
   <p>}</p> 
   <p>&nbsp;</p> 
   <p>对于如上框架：</p> 
   <p>进入config函数时先pwm_disable, 然后中间计算，最后enable</p> 
   <p>但是中间有很多return，我们做接口的目的有个<span style="color:#ff0000;">宗旨</span>：</p> 
   <p>函数是为了改变原来的状态的，如果此函数运行失败返回，那么就要<span style="color:#ff0000;">还原原来的场景，不要改变原来的场景</span>。</p> 
   <p>如上例子如果用中间用return，一开始执行了disable，那么中间如果执行失败return了，后面就不会执行enable，那么pwm状态就会变了，那么对于这种情况我们要使用goto到后面，然后再进行enable，就算失败了，也要还原之前的场景去enable，所以需要把上一次的值保存起来。</p> 
   <p>&nbsp;</p> 
   <h4><strong><span style="color:#ff0000;">11.vim快捷键</span></strong></h4> 
   <p>vi &nbsp;-d &nbsp; a.c &nbsp; b.c，可以对比</p> 
   <p>对比过程中，如果拷贝的话，可以用快捷键dp</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;font-size:16px;">12.对触摸屏中断的理解</span></h4> 
   <p>触摸屏与cpu是由一个gpio中断口线相连，所有的中断都是由tp那端抛给cpu的，</p> 
   <p>Tp通过设定各种参数，刷新频率，扫描频率，电容值（即基准点），tp通过计算触摸屏上的点来决定是否发送中断给cpu，如果计算到没点，就不发送中断给cpu，如果计算到有点，那么就会发送中断给cpu，（注意：tp只要上电启动了那么就会一直进行运算），每次触摸屏上只要有按下，不管几个手指都会产生一个中断，抬起又产生一个中断，最小单位产生两个中断，如果是电平中断，一直按着手指，会不停的产生中断，产生中断的时间和次数由tp的运算速度决定，很难去量化，按下的手指越多，tp运算时间越长，至于有时候发现log有10个finger，和10个status状态，那是驱动代码在一个中断产生时遍历了report动作10次，这些finger和status是通过tp寄存器读取到再由驱动上报内核空间，最终通过input子系统发送给用户空间</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;===========================================================================================</p> 
   <h4><span style="font-size:18px;color:#ff0000;"><a href="https://segmentfault.com/q/1010000002395334" rel="nofollow"><span style="color:#ff0000;">13.怎么样让编译器对某些函数不再抱怨warning: unused parameter ‘xxx’？</span></a></span></h4> 
   <p>转自：<a href="https://segmentfault.com/q/1010000002395334" rel="nofollow">https://segmentfault.com/q/1010000002395334</a></p> 
   <p>#define UNUSED_PARAMETER(x) (void)x&nbsp;</p> 
   <p>int main(int argc, char **argv)</p> 
   <p>{</p> 
   <p>&nbsp;</p> 
   <p>// 这两行是为了避免编译报警告</p> 
   <p>　　UNUSED_PARAMETER(argc);<br> 　　UNUSED_PARAMETER(argv);</p> 
   <p>}</p> 
   <p>&nbsp;</p> 
   <p>如果可能，请务必用正常方法消除 warning，真的多余就去掉吧</p> 
   <p>方法一：</p> 
   <pre class="hljs cs"><code><span class="hljs-function"><span class="hljs-keyword">void <span class="hljs-title">foo<span class="hljs-params">(<span class="hljs-keyword">int a) { (<span class="hljs-keyword">void)a; <span class="hljs-comment">// ... } </span></span></span></span></span></span></span></code></pre> 
   <p>方法二：</p> 
   <pre class="hljs cs"><code><span class="hljs-preprocessor">#ifdef __GNUC__ <span class="hljs-preprocessor"># <span class="hljs-keyword">define UNUSED(x) UNUSED_ ## x __attribute__((__unused__)) <span class="hljs-preprocessor">#<span class="hljs-keyword">else <span class="hljs-preprocessor"># <span class="hljs-keyword">define UNUSED(x) UNUSED_ ## x <span class="hljs-preprocessor">#<span class="hljs-keyword">endif <span class="hljs-function"><span class="hljs-keyword">void <span class="hljs-title">foo<span class="hljs-params">(<span class="hljs-keyword">int UNUSED(a)) { <span class="hljs-comment">// ... } </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre> 
   <p>参考：<a href="http://stackoverflow.com/a/12891181" rel="nofollow">http://stackoverflow.com/a/12891181</a></p> 
   <p>&nbsp;===========================================================================================</p> 
   <p>&nbsp;</p> 
   <p><span style="color:#ff0000;">字符串比较时，strncmp &nbsp; strcmp 需要注意的地方，要注意比较长度&nbsp;</span></p> 
   <p> if ((strlen(ts_keyword) != strlen(fw_ugd-&gt;ts_keyid)) ||<br> strcasecmp(ts_keyword, fw_ugd-&gt;ts_keyid)) {<br> printf("%s: check ts_keyword[%s],fw_ugd-&gt;ts_keyid[%s]\n",<br> __FUNCTION__, ts_keyword, fw_ugd-&gt;ts_keyid);<br> retval = TP_FW_ERR_TS_KEYID_COMPARE;<br> goto error;<br> }</p> 
   <p>&nbsp;</p> 
   <pre class="content"><span style="color:#ff0000;">中断 IRQF_ONESHOT 与 IRQF_SHARED 不能同时使用</span>
当多个设备共享中断时，由于IRQF_ONESHOT会关闭中断线程的中断，而线程一般执行时间会比较长，所以是不允许的
当hardirq函数为NULL时，必须声明IRQF_ONESHOT, 表示threadirq线程中关闭该中断,在某些情况下，这个标志会非常有用
例如：设备是低电平产生中断，而硬中断函数为NULL，如果不使用IRQF_ONESHOT,就会一直产生中断执行NULL函数，中断线程
得不到执行，声明IRQF_ONESHOT后，会执行完线程才使能该中断 &nbsp;<br><br><br></pre> 
   <h4><span style="font-size:16px;color:#ff0000;">14.devm_request_irq---- 这种架构会自己释放资源，不需要自己释放，交由devr内核链表管理</span></h4> 
   <p><span style="color:#ff0000;"><a href="http://lxr.free-electrons.com/ident?i=devm_request_irq" rel="nofollow"><span style="color:#ff0000;">http://lxr.free-electrons.com/ident?i=devm_request_irq</span></a></span></p> 
   <h4><span style="color:#ff0000;">15.这个网址可以查询内核源码</span></h4> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;"><strong>16.rm命令</strong></span></h4> 
   <p>删除除了 tt.c的所有文件，只保留tt.c不被删除<br>rm -rf !(tt.c)</p> 
   <p>&nbsp;</p> 
   <h4>17.查看当前项目有哪些远程仓库</h4> 
   <pre><code>$ git remote 
</code></pre> 
   <p><code>bixiaopeng@bixiaopengtekiMacBook-Pro wirelessqa$ git remote origin </code><a name="t2"></a><br><br></p> 
   <p>查看远程仓库</p> 
   <pre><code>$ git remote -v 
</code></pre> 
   <pre><code>bixiaopeng@bixiaopengtekiMacBook-Pro wirelessqa$ git remote -v
origin     git@gitlab.***.com:xiaopeng.bxp/wirelessqa.git (fetch)
origin     git@gitlab.***.com:xiaopeng.bxp/wirelessqa.git (push)</code><br><br><br><strong><span style="color:#ff0000;">0x1000 16*16*16=4096bit = 4KB</span></strong><br><br><br></pre> 
   <h4><span style="color:#ff0000;"><strong>18.堆栈的限制</strong></span></h4> 
   <p>　　堆栈空间的最大值是由setrlimit系统调用确定的，也可以通过bash内建的ulimit命令来设定和查看.</p> 
   <p>　　例如:</p> 
   <p>　　查看当前可使用的最大堆栈(以KB为单位)</p> 
   <p>　　ulimit -s</p> 
   <p>　　8192&nbsp;<strong>//栈的大小默认是8M</strong></p> 
   <p>　　设定为最大的使用堆栈为15KB</p> 
   <p>　　ulimit -s 15</p> 
   <p>　　此时执行ls将会得到一个段错误.</p> 
   <p>　　ls -l /etc/</p> 
   <p>　　total 1040</p> 
   <p>　　Segmentation fault</p> 
   <p>　　通过用strace跟踪ls命令,将发现有如下的系统调用</p> 
   <p>　　getrlimit(RLIMIT_STACK, {rlim_cur=15*1024, rlim_max=15*1024}) = 0</p> 
   <p>　　说明当前可用的堆栈空间,已经不足以运行strace命令了.</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <h4><a href="http://blog.csdn.net/wealoong/article/details/7992071" rel="nofollow">19.Linux驱动调试中的Debugfs的使用简介</a></h4> 
   <p><a href="http://blog.csdn.net/wealoong/article/details/7992071" rel="nofollow">http://blog.csdn.net/wealoong/article/details/7992071</a></p> 
   <p>&nbsp;</p> 
   <p><a href="http://blog.csdn.net/superkris/article/details/8626517" rel="nofollow">Linux DebugFS 子目录也是用debugfs_create_dir来实现</a></p> 
   <p><a href="http://blog.csdn.net/superkris/article/details/8626517" rel="nofollow">http://blog.csdn.net/superkris/article/details/8626517</a></p> 
   <p>mount来调试文件节点， sysfs节点调试方法</p> 
   <p>make menuconfig ----</p> 
   <p>Global build settings ------</p> 
   <p>Compile the kernel with Debug FileSystem enabled</p> 
   <p>&nbsp;</p> 
   <p>Make kernel_menuconfig&nbsp; --------------</p> 
   <p>Kernel hacking --------</p> 
   <p>Debug Filesystem</p> 
   <p>mount -t debugfs none /sys/kernel/debug</p> 
   <p>&nbsp;</p> 
   <h4>20.grep 命令</h4> 
   <pre>grep -run "\&lt; abc \&gt;"<br><br><br></pre> 
   <h4><span style="color:#000000;">21.检测内存泄露的方法</span></h4> 
   <p><span style="color:#ff0000;"><strong>Make &nbsp;kernel_menuconfig</strong></span></p> 
   <p><span style="color:#ff0000;"><strong>Kernel hacking </strong></span>=======&gt;</p> 
   <p>[*] Kernel memory leak detector&nbsp;&nbsp;</p> 
   <p>(40000) Maximum kmemleak early log entries</p> 
   <p>&nbsp;</p> 
   <p>[*] Compile the kernel with debug info&nbsp;&nbsp;</p> 
   <p>&nbsp;</p> 
   <p><span style="color:#ff0000;"><strong>make menuconfig</strong></span></p> 
   <p>[*] Compile the kernel with Debug FileSystem enabled</p> 
   <p>[*] Compile the kernel with debug information</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>开机后</p> 
   <p><span style="color:#ff0000;">mount -t debugfs none /sys/kernel/debug</span></p> 
   <p>cd&nbsp; /sys/kernel/debug</p> 
   <p>cat kmemleak</p> 
   <p>&nbsp;</p> 
   <p><span style="color:#ff0000;"><strong>make &nbsp;kernel_menuconfig</strong></span></p> 
   <p>这个选项是说明</p> 
   <p><span style="color:#ff0000;"><strong>General setup</strong></span> ================&gt;</p> 
   <p>Choose SLAB allocator (SLUB (Unqueued Allocator))</p> 
   <p>(X) SLUB (Unqueued Allocator)</p> 
   <p>[*] Enable SLUB debugging support</p> 
   <p>&nbsp;</p> 
   <h4>22.这里使用slub分配内存比slab更高效</h4> 
   <p>&nbsp;</p> 
   <p>我们在调试内核时，如果出现系统响应非常慢的情况</p> 
   <p>先看有没有死锁，用lockdep来检测</p> 
   <p>检测出来后再用ftrace来跟踪函数</p> 
   <p>如果出现kernel内存泄露，可以 用kmemleak来查看，查看前要确认内核使用哪个分配器，一般是slab或者slub</p> 
   <p>&nbsp;cat /proc/meminfo &nbsp; &nbsp; 查看内存泄露</p> 
   <p>&nbsp;</p> 
   <h4><a id="homepage1_HomePageDays_DaysList_ctl00_DayList_TitleUrl_2" class="postTitle2" href="http://www.cnblogs.com/sky-heaven/p/5710844.html" rel="nofollow">23.Linux设备驱动之semaphore机制</a></h4> 
   <p>static noinline void __down(struct semaphore *sem);<br>static noinline int __down_interruptible(struct semaphore *sem);<br>static noinline int __down_killable(struct semaphore *sem);<br>static noinline int __down_timeout(struct semaphore *sem, long jiffies);<br>static noinline void __up(struct semaphore *sem);</p> 
   <p>#define DEFINE_SEMAPHORE(name) \<br> struct semaphore name = __SEMAPHORE_INITIALIZER(name, 1)</p> 
   <p>static inline void sema_init(struct semaphore *sem, int val)<br>{<br> static struct lock_class_key __key;<br> *sem = (struct semaphore) __SEMAPHORE_INITIALIZER(*sem, val);<br> lockdep_init_map(&amp;sem-&gt;lock.dep_map, "semaphore-&gt;lock", &amp;__key, 0);<br>}</p> 
   <p>&nbsp;</p> 
   <p>一个核，执行了两个死循环进程，那么这两个进程是通过内核的调度算法去选择要执行哪个进程的，最终会执行arm的指令，这两个进程在单和上是永远不可能同时执行的，MMU里面会有进程id寄存器</p> 
   <p>&nbsp;</p> 
   <h4><span>24.获得内核函数地址的四种方法&nbsp;</span></h4> 
   <p>&nbsp;本文以获取内核函数 sys_open()的地址为例。<br>&nbsp; &nbsp;1）<strong>从System.map文件中直接得到地址</strong>：<br>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;$&nbsp;grep sys_open /usr/src/linux/System.map<br>&nbsp; &nbsp;<br>&nbsp; &nbsp;2)<strong>使用 nm 命令</strong>：<br>&nbsp; &nbsp;&nbsp; &nbsp;$&nbsp;nm vmlinuz | grep sys_open<br>&nbsp; &nbsp;<br>&nbsp; &nbsp;3)<strong>从 /proc/kallsyms 文件获得地址</strong>：<br>&nbsp; &nbsp;&nbsp; &nbsp;$&nbsp;cat /proc/kallsyms | grep sys_open<br>&nbsp; &nbsp;<br>&nbsp; &nbsp;4)<strong>使用 kallsyms_lookup_name() 函数</strong>：<br>&nbsp; &nbsp;&nbsp; &nbsp;是在kernel/kallsyms.c文件中定义的，要使用它必须启用CONFIG_KALLSYMS编译内核。<br>&nbsp; &nbsp;&nbsp; &nbsp;kallsyms_lookup_name()接受一个字符串格式内核函数名，返回那个内核函数的地址。<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;kallsyms_lookup_name("sys_open");</p> 
   <p>&nbsp;</p> 
   <p>方法一、</p> 
   <p>通过打印函数地址，可以查看函数在哪里调用</p> 
   <p>例如：</p> 
   <p>Core.c &nbsp;&nbsp;drivers\pwm</p> 
   <p>int pwm_config(struct pwm_device *pwm, int duty_ns, int period_ns)</p> 
   <p>{</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pwm || period_ns == 0 || duty_ns &gt; period_ns)</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -EINVAL;</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp; printk("%s&nbsp; drivers\pwm Core.c----(%d)\r\n", __func__, __LINE__);</p> 
   <p>&nbsp;&nbsp;&nbsp; printk("pwm-&gt;chip-&gt;ops-&gt;config=%p----(%d)\r\n", pwm-&gt;chip-&gt;ops-&gt;config, __LINE__);</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return pwm-&gt;chip-&gt;ops-&gt;config(pwm-&gt;chip, pwm, duty_ns, period_ns);</p> 
   <p>}</p> 
   <p>&nbsp;</p> 
   <p>终端显示如下：</p> 
   <p>[&nbsp;&nbsp; 42.550000] pwm-&gt;chip-&gt;ops-&gt;config=c001b0c0----(378)</p> 
   <p>&nbsp;</p> 
   <p>然后可以在</p> 
   <p>如下目录</p> 
   <p>Z:\linux-3.6.5</p> 
   <p>&nbsp;</p> 
   <p>中的System.map中找到</p> 
   <p>c001b0c0 &nbsp;t &nbsp;asiu_pwmc_config</p> 
   <p>就调用的是这个函数asiu_pwmc_config</p> 
   <p>&nbsp;</p> 
   <p>方法二、</p> 
   <p>dump_stack()函数</p> 
   <p>&nbsp;</p> 
   <h4>25.打印语句的使用，带颜色的打印</h4> 
   <p>#define RESETCOLOR "\033[0m"<br>#define GREEN "\033[0;32m"<br>#define RED "\033[0;31m"<br>#define LIGHT_RED "\033[1;31m" <br>#define YELLOW "\033[1;33m"<br>#define BLUE "\033[0;34m"<br>#define LIGHT_BLUE "\033[1;34m" <br>#define CYAN "\033[0;36m" <br>#define PURPLE "\033[0;35m"<br>#define LIGHT_PURPLE "\033[1;35m"<br>#define BROWN "\033[0;33m"<br>#define WHITE "\033[1;37m"<br>#define LIGHT_GRAY "\033[0;37m" <br>#define DARY_GRAY "\033[1;30m" </p> 
   <p>printf(YELLOW"** &nbsp; 10. set asiu_pwm while &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; **"RESETCOLOR"\r\n");</p> 
   <p> printf(YELLOW"**"LIGHT_RED" 4. onepluse pwm disable "YELLOW"**"RESETCOLOR"\r\n");</p> 
   <p>&nbsp;</p> 
   <p>RC文件延时方法<strong>：</strong></p> 
   <p><strong>wait&nbsp; /dev/zhangb&nbsp;&nbsp; </strong><strong>随便一个不存在的节点都可以，固定为延时5s&nbsp;</strong></p> 
   <p>&nbsp;</p> 
   <p><span>如何增加打印信息---灵活使用宏定义：</span></p> 
   <p> #include &lt;stdio.h&gt;<br> #include &lt;stdlib.h&gt; <br><br> #define qWiFiDebug(format, ...) printf("[WiFi] "format" File:%s, Line:%d, Function:%s \r\n", ##__VA_ARGS__, __FILE__, __LINE__ , __FUNCTION__);<br><br><br> int main(void)<br>-{<br>| qWiFiDebug("aaaaaa -----");<br>|<br>| return 0;<br>|}</p> 
   <p>打印输出：</p> 
   <p>&nbsp;&nbsp;./a.out&nbsp;</p> 
   <p><em>[WiFi] aaaaaa ----- File:a.c, Line:9, Function:main </em></p> 
   <p>&nbsp;</p> 
   <div class="cnblogs_code"> 
    <pre><span style="color:#0000ff;">#define</span> RESETCOLOR    "\033[0m"
<span style="color:#0000ff;">#define</span> GREEN         "\033[0;32m"
<span style="color:#0000ff;">#define</span> RED           "\033[0;31m"
<span style="color:#0000ff;">#define</span> LIGHT_RED     "\033[1;31m"
<span style="color:#0000ff;">#define</span> YELLOW        "\033[1;33m"
<span style="color:#0000ff;">#define</span> BLUE          "\033[0;34m"
<span style="color:#0000ff;">#define</span> LIGHT_BLUE    "\033[1;34m"
<span style="color:#0000ff;">#define</span> CYAN          "\033[0;36m"
<span style="color:#0000ff;">#define</span> PURPLE        "\033[0;35m"
<span style="color:#0000ff;">#define</span> LIGHT_PURPLE  "\033[1;35m"
<span style="color:#0000ff;">#define</span> BROWN         "\033[0;33m"
<span style="color:#0000ff;">#define</span> WHITE         "\033[1;37m"
<span style="color:#0000ff;">#define</span> LIGHT_GRAY    "\033[0;37m"
<span style="color:#0000ff;">#define</span> DARY_GRAY     "\033[1;30m"

<span style="color:#0000ff;">#define</span> ZBH_TRACE_DEBUG            (1 &lt;&lt; 0)
<span style="color:#0000ff;">#define</span> ZBH_TRACE_INIT                (1 &lt;&lt; 1)
<span style="color:#0000ff;">#define</span> ZBH_TRACE_INT              (1 &lt;&lt; 2)
<span style="color:#0000ff;">#define</span> ZBH_TRACE_X_Y_COORDINATE   (1 &lt;&lt; 3)
<span style="color:#0000ff;">#define</span> ZBH_TRACE_FINGER_UP        (1 &lt;&lt; 4)<span style="color:#000000;">


#ifdef __BASE_FILE_NAME__
</span><span style="color:#0000ff;">#define</span> printk_get_basename(x)   __BASE_FILE_NAME__
<span style="color:#0000ff;">#else</span>
<span style="color:#0000ff;">static</span> <span style="color:#0000ff;">char</span> *printk_get_basename(<span style="color:#0000ff;">char</span> *<span style="color:#000000;">path)
{
    </span><span style="color:#0000ff;">char</span> *p1 = path, *p2 =<span style="color:#000000;"> p1;
    </span><span style="color:#0000ff;">while</span> (*p1 != <span style="color:#800000;">'</span><span style="color:#800000;">\0</span><span style="color:#800000;">'</span><span style="color:#000000;">) {
        </span><span style="color:#0000ff;">if</span> (*p1 == <span style="color:#800000;">'</span><span style="color:#800000;">/</span><span style="color:#800000;">'</span><span style="color:#000000;">)
            p2 </span>= p1 + <span style="color:#800080;">1</span><span style="color:#000000;">;
        p1</span>++<span style="color:#000000;">;
    }
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> (p2);
}
</span><span style="color:#0000ff;">#endif</span>

<span style="color:#008000;">//</span><span style="color:#008000;">printk(KERN_INFO "[%s]"format"File:%s, Line:%d, Function:%s \r\n", \
        </span><span style="color:#008000;">//</span><span style="color:#008000;">      ##__VA_ARGS__, printk_get_basename(__FILE__), __LINE__, __FUNCTION__); \
</span><span style="color:#008000;">//</span><span style="color:#008000;">printk(KERN_INFO "[%s%4d@%18s] "format, GT1X_PREFIX, __LINE__, printk_get_basename(__FILE__), ##arg); \
</span><span style="color:#008000;">//</span><span style="color:#008000;">printk(KERN_INFO "[%s]"format"[File:%s, Line:%d, Function:%s] \r\n", ZBH_PREFIX, ##arg, printk_get_basename(__FILE__), __LINE__, __FUNCTION__); \</span>

<span style="color:#0000ff;">#define</span> ZBH_PREFIX   "ZBH: "
<span style="color:#0000ff;">#define</span> zbh_trace(flag, format, arg...) \
<span style="color:#0000ff;">do</span><span style="color:#000000;"> { \
    </span><span style="color:#0000ff;">if</span> (zbh_trace_param &amp;<span style="color:#000000;"> flag) \
        printk(KERN_INFO </span><span style="color:#800000;">"</span><span style="color:#800000;">[%s%4d@ %s] %s(): </span><span style="color:#800000;">"</span><span style="color:#000000;">format, ZBH_PREFIX, __LINE__, \
            printk_get_basename(__FILE__), __FUNCTION__, ##arg); \            
} </span><span style="color:#0000ff;">while</span> (<span style="color:#800080;">0</span><span style="color:#000000;">)

</span><span style="color:#0000ff;">#define</span> zbh_printk(format, arg...) \<span style="color:#000000;">
        printk(KERN_INFO </span><span style="color:#800000;">"</span><span style="color:#800000;">%s</span><span style="color:#800000;">"</span>format, ZBH_PREFIX, ##arg)</pre> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <h4><span>26.linux用户栈和内核栈的设置</span></h4> 
   <p><a href="http://stackoverflow.com/questions/2562602/how-does-fork-return-for-child-process" rel="nofollow">http://stackoverflow.com/questions/2562602/how-does-fork-return-for-child-process</a></p> 
   <p><a href="http://blog.csdn.net/u011279649/article/details/18795547" rel="nofollow">http://blog.csdn.net/u011279649/article/details/18795547</a></p> 
   <p>copy_thread(unsigned long clone_flags, unsigned long sp, unsigned long unused, struct task_struct * p, struct pt_regs * regs)</p> 
   <p>How to set the new process entry</p> 
   <p>int</p> 
   <p>copy_thread(unsigned long clone_flags, unsigned long stack_start,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; unsigned long stk_sz, struct task_struct *p, struct pt_regs *regs)<br>{<br>&nbsp;&nbsp; &nbsp;struct thread_info *thread = task_thread_info(p);<br>&nbsp;&nbsp; &nbsp;struct pt_regs *childregs = task_pt_regs(p);<br><br>&nbsp;&nbsp; &nbsp;*childregs = *regs;<br>&nbsp;&nbsp; &nbsp;childregs-&gt;ARM_r0 = 0;<br>&nbsp;&nbsp; &nbsp;childregs-&gt;ARM_sp = stack_start;<br><br>&nbsp;&nbsp; &nbsp;memset(&amp;thread-&gt;cpu_context, 0, sizeof(struct cpu_context_save));<br><span>&nbsp;&nbsp; &nbsp;thread-&gt;cpu_context.sp = (unsigned long)childregs;</span><br><span>&nbsp;&nbsp; &nbsp;thread-&gt;cpu_context.pc = (unsigned long)ret_from_fork;</span></p> 
   <p>&nbsp;</p> 
   <h4>27.makefile编写注意：</h4> 
   <p><span style="color:#ff0000;">EXTRA_CFLAGS += -DDO_TEST_REPORTING</span></p> 
   <p><span style="color:#ff0000;"><strong>ifeq ($(CONFIG_ENABLE_PCI),y)</strong></span></p> 
   <p><span style="color:#ff0000;"><strong>EXTRA_CPPFLAGS += -DCONFIG_ENABLE_PCI</strong></span></p> 
   <p><span style="color:#ff0000;"><strong>endif</strong></span></p> 
   <p>&nbsp;</p> 
   <h4>28.好的网址</h4> 
   <p><a href="http://web.mit.edu/gnu/www/index.html" rel="nofollow">http://web.mit.edu/gnu/www/index.html</a>&nbsp;-------》麻省理工大学的校网，gnu &nbsp;， automake , autoconf</p> 
   <p><a href="http://www.yoctoproject.org" rel="nofollow">www.yoctoproject.org</a>&nbsp;--------》飞思卡尔搞的非常强大的linux开发环境</p> 
   <p>&nbsp;</p> 
   <h4>29.文件系统操作，查看内核一些信息</h4> 
   <p><span>&nbsp;cat /proc/meminfo&nbsp;</span></p> 
   <p>/data/app # cat /proc/meminfo <br>MemTotal: 60488 kB<br>MemFree: 19200 kB<br>Buffers: 0 kB<br>Cached: 27028 kB<br>SwapCached: 0 kB<br>Active: 11276 kB<br>Inactive: 22708 kB<br>Active(anon): 11256 kB<br>Inactive(anon): 13432 kB<br>Active(file): 20 kB<br>Inactive(file): 9276 kB<br>Unevictable: 0 kB<br>Mlocked: 0 kB<br>SwapTotal: 0 kB<br>SwapFree: 0 kB<br>Dirty: 0 kB<br>Writeback: 0 kB<br>AnonPages: 6976 kB<br>Mapped: 2832 kB<br>Shmem: 17732 kB<br>Slab: 3448 kB<br>SReclaimable: 668 kB<br>SUnreclaim: 2780 kB<br>KernelStack: 496 kB<br>PageTables: 312 kB<br>NFS_Unstable: 0 kB<br>Bounce: 0 kB<br>WritebackTmp: 0 kB<br>CommitLimit: 30244 kB<br>Committed_AS: 46220 kB<br>VmallocTotal: 319488 kB<br>VmallocUsed: 21720 kB<br>VmallocChunk: 294908 kB</p> 
   <p>/data/app # <span>cat /proc/mtd</span> <br>dev: size erasesize name<br>mtd0: 000c0000 00020000 "boot"<br>mtd1: 00080000 00020000 "nvram_fac"<br>mtd2: 000c0000 00020000 "boot_res"<br>mtd3: 00400000 00020000 "kernel"<br>mtd4: 00600000 00020000 "ramdisk"<br>mtd5: 00600000 00020000 "base"<br>mtd6: 06e00000 00020000 "data"</p> 
   <p>&nbsp;</p> 
   <h4><span>30.find 命令和grep命令</span></h4> 
   <p>&nbsp;find . "*sdio*" -maxdepth 2</p> 
   <p>find . README -maxdepth 1 | xargs grep -nri "a"</p> 
   <p>find target/linux/brcm5830/files/arch/arm/mach-iproc/pm_iproc/ -name "*.c" -print | xargs grep "USB"</p> 
   <p>find ./package/kmod-prolin/bbl/ -maxdepth 1 -print | xargs grep -rni "PCI"&nbsp;</p> 
   <p>find ./ -name "synaptics_dsx_core.h"&nbsp; | xargs grep -rwi "reset_device"</p> 
   <p>&nbsp;find ./package/kmod-brcm5830x/input/keypad_matrix/src/keypad_matrix.c -print0 |xargs grep -run -B8 -A2 "buzzer_level"</p> 
   <p>&nbsp;find ./ -name "*.c" |xargs grep --colour -run printf</p> 
   <p> dev_dbg(rmi4_data-&gt;pdev,<br> "%s: rmi4_data-&gt;report_type = %d\n"<br> "rmi4_data-&gt;finger_limit = %d\n"<br> "fhandler-&gt;num_of_data_points = %d\n",<br> __func__, rmi4_data-&gt;report_type,<br> rmi4_data-&gt;finger_limit, fhandler-&gt;num_of_data_points);</p> 
   <p>&nbsp;</p> 
   <div class="cnblogs_code"> 
    <pre><span style="color:#000000;">这是个小技巧，grep的A(after，后)选项和B(before，前)选项可以同时输出其匹配行的前后几行。

比如包含有如下文本的message.txt：

Aug </span><span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] Zone PFN ranges: Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] DMA <span style="color:#800080;">0</span> -&gt; <span style="color:#800080;">4096</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] Normal <span style="color:#800080;">4096</span> -&gt; <span style="color:#800080;">130730</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] HighMem <span style="color:#800080;">130730</span> -&gt; <span style="color:#800080;">130730</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] early_node_map[<span style="color:#800080;">1</span>] active PFN ranges Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] <span style="color:#800080;">0</span>: <span style="color:#800080;">0</span> -&gt; <span style="color:#800080;">130730</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] DMI <span style="color:#800080;">2.3</span><span style="color:#000000;"> present.

用带</span>-B1和-A2选项的grep匹配搜索<span style="color:#800000;">"</span><span style="color:#800000;">DMA</span><span style="color:#800000;">"</span><span style="color:#000000;">。

grep </span>-B1 -A2 <span style="color:#800000;">"</span><span style="color:#800000;">DMA</span><span style="color:#800000;">"</span><span style="color:#000000;"> message.txt

输出：

Aug </span><span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] Zone PFN ranges: Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] DMA <span style="color:#800080;">0</span> -&gt; <span style="color:#800080;">4096</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] Normal <span style="color:#800080;">4096</span> -&gt; <span style="color:#800080;">130730</span> Aug <span style="color:#800080;">5</span> <span style="color:#800080;">02</span>:<span style="color:#800080;">43</span>:<span style="color:#800080;">12</span> zion kernel: [ <span style="color:#800080;">0.000000</span>] HighMem <span style="color:#800080;">130730</span> -&gt; <span style="color:#800080;">130730</span><span style="color:#000000;">

grep匹配一个结果，输出多行的功能，在搜索日志文件时很有用。</span></pre> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <div class="cnblogs_code"> 
    <pre><span style="color:#000000;">Linux下find一次查找多个指定文件或者排除某类文件，在 GREP 中匹配多个关键字的方法
（</span><span style="color:#800080;">1</span><span style="color:#000000;">）Linux下find一次查找多个指定文件:
查找a.html和b.html
find . </span>-name <span style="color:#800000;">"</span><span style="color:#800000;">a.html</span><span style="color:#800000;">"</span>  -name <span style="color:#800000;">"</span><span style="color:#800000;">b.html</span><span style="color:#800000;">"</span><span style="color:#000000;">  

find . </span>-regex <span style="color:#800000;">'</span><span style="color:#800000;">.*\.txt\|.*\.doc\|.*\.mp3</span><span style="color:#800000;">'</span><span style="color:#000000;">
find . </span>-regex <span style="color:#800000;">'</span><span style="color:#800000;">.*\.txt\|.*\.doc\|.*\.mp3</span><span style="color:#800000;">'</span><span style="color:#000000;">  
.</span>/<span style="color:#000000;">a.txt  
.</span>/<span style="color:#000000;">a.doc  
.</span>/<span style="color:#000000;">a.mp3  

(</span><span style="color:#800080;">2</span><span style="color:#000000;">)排除某些文件类型：
排除目录下所有以html结尾的文件：
find . </span>-type f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.html</span><span style="color:#800000;">"</span><span style="color:#000000;">    

find . </span>-type f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.html</span><span style="color:#800000;">"</span><span style="color:#000000;">       
.</span>/ge.bak.<span style="color:#800080;">02.09</span><span style="color:#000000;">  
.</span>/<span style="color:#000000;">ge.html.changed.by.jack  
.</span>/<span style="color:#000000;">a.txt  
.</span>/<span style="color:#000000;">a.doc  
.</span>/<span style="color:#000000;">a.mp3  

（</span><span style="color:#800080;">3</span><span style="color:#000000;">）排除多种文件类型的示例：
find . </span>-type f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.html</span><span style="color:#800000;">"</span> -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.php</span><span style="color:#800000;">"</span> -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.svn-base</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.js</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.gif</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.png</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.cpp</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.h</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.o</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.jpg</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.so</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.bak</span><span style="color:#800000;">"</span>  -type  f ! -name <span style="color:#800000;">"</span><span style="color:#800000;">*.log</span><span style="color:#800000;">"</span><span style="color:#000000;">   

（</span><span style="color:#800080;">3</span><span style="color:#000000;">）在 GREP 中匹配多个关键字的方法：
grep查找多个数字的文件：
</span>-r 递归，-E：正则  -<span style="color:#000000;">l：只显示文件名
root@</span><span style="color:#800080;">116.255</span>.<span style="color:#800080;">139.240</span>:~/a# grep -r -E <span style="color:#800000;">'</span><span style="color:#800000;">0341028|100081|10086|10001</span><span style="color:#800000;">'</span> *<span style="color:#000000;">  
a.txt:</span><span style="color:#800080;">100081</span><span style="color:#000000;">  
b.txt:</span><span style="color:#800080;">10086</span><span style="color:#000000;">  
c</span>/cc.txt:<span style="color:#800080;">0341028</span><span style="color:#000000;">  
c</span>/cc.txt:<span style="color:#800080;">100081</span><span style="color:#000000;">  
c</span>/cc.txt:<span style="color:#800080;">10086</span><span style="color:#000000;">  
c</span>/cc.txt:<span style="color:#800080;">10001</span><span style="color:#000000;">  
c.txt:</span><span style="color:#800080;">10001</span><span style="color:#000000;">  
d.txt:</span><span style="color:#800080;">0341028</span><span style="color:#000000;">  

grep </span>-r  -E -l <span style="color:#800000;">'</span><span style="color:#800000;">0341028|100081|10086|10001</span><span style="color:#800000;">'</span> *<span style="color:#000000;">     
a.txt  
b.txt  
c</span>/<span style="color:#000000;">cc.txt  
c.txt  
d.txt  

多种类型文件示例：
view plainprint</span>?<span style="color:#000000;">
find . </span>-name <span style="color:#800000;">"</span><span style="color:#800000;">*.html</span><span style="color:#800000;">"</span> -o -name <span style="color:#800000;">"</span><span style="color:#800000;">*.js</span><span style="color:#800000;">"</span>|xargs grep -r <span style="color:#800000;">"</span><span style="color:#800000;">BusiTree</span><span style="color:#800000;">"</span>   </pre> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <h4><span>31.printk 调试方法</span></h4> 
   <p><span>内核中打印回调函数的名称</span></p> 
   <p>&nbsp;</p> 
   <div class="cnblogs_code"> 
    <pre>#include &lt;linux/module.h&gt;<br>#include &lt;linux/kernel.h&gt;<br>#include &lt;linux/init.h&gt;<br>#include &lt;asm/current.h&gt;<br>#include &lt;linux/utsname.h&gt;<br>#include &lt;asm/cacheflush.h&gt;<br>#include &lt;asm/processor.h&gt;<br>#include &lt;asm/thread_notify.h&gt;<br>#include &lt;asm/stacktrace.h&gt;<br>#include &lt;asm/mach/time.h&gt;<br><br>// add by zbh<br>int get_func_name(void *ip)<br>{&nbsp;&nbsp; &nbsp;<br><br>&nbsp;&nbsp;&nbsp; printk("[&lt;%p&gt;] %pS\n", (void *) ip, (void *) ip);<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; printk("%sCPU: %d PID: %d Comm: %.20s %s %s %.*s\n", <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KERN_DEFAULT, raw_smp_processor_id(), <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; current-&gt;pid, current-&gt;comm, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print_tainted(), init_utsname()-&gt;release,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (int)strcspn(init_utsname()-&gt;version, " "),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; init_utsname()-&gt;version);<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp; return 0;<br>}<br><br>void *ip = NULL;<br>   　　ip = keydata-&gt;buzzer-&gt;<span style="color:#000000;">enable;
        printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">[&lt;%p&gt;] %pS\n</span><span style="color:#800000;">"</span>, (<span style="color:#0000ff;">void</span> *) ip, (<span style="color:#0000ff;">void</span> *<span style="color:#000000;">) ip);
        
        printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">%sCPU: %d PID: %d Comm: %.20s %s %s %.*s\n</span><span style="color:#800000;">"</span><span style="color:#000000;">, 
            KERN_DEFAULT, raw_smp_processor_id(), current</span>-&gt;pid, current-&gt;<span style="color:#000000;">comm, 
            print_tainted(), init_utsname()</span>-&gt;<span style="color:#000000;">release,
            (</span><span style="color:#0000ff;">int</span>)strcspn(init_utsname()-&gt;version, <span style="color:#800000;">"</span> <span style="color:#800000;">"</span><span style="color:#000000;">),
            init_utsname()</span>-&gt;<span style="color:#000000;">version);

        keydata</span>-&gt;buzzer-&gt;enable(keydata,freq,duty);<br><br><br>再在panic.c中 找到print_tainted<br>EXPORT_SYMBOL(print_tainted);<br>这样可以给其他驱动调用此函数<br><br></pre> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p><span><span>print_hex_dump ===&gt;内核一个不错的打印方式</span><br></span></p> 
   <p>此网址是我记录的一个printk 打印函数地址的方法</p> 
   <p><a href="http://www.cnblogs.com/sky-heaven/p/7161373.html" rel="nofollow">&nbsp;http://www.cnblogs.com/sky-heaven/p/7161373.html</a></p> 
   <p>&nbsp;&nbsp;&nbsp; unsigned char input[0x28];<br>&nbsp;&nbsp; &nbsp;unsigned char output[0x28];</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print_hex_dump(KERN_CRIT, "bbl_ram@ ", DUMP_PREFIX_OFFSET,<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16, 1, output, sizeof(output), true);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printk("\n");&nbsp;</p> 
   <p>&nbsp;</p> 
   <p><strong><span style="color:#ff0000;">&nbsp;<code><span class="pun"><span class="pln">__builtin_return_address</span></span></code></span></strong></p> 
   <p><a href="http://www.cnblogs.com/sky-heaven/p/7161404.html" rel="nofollow">http://www.cnblogs.com/sky-heaven/p/7161404.html</a></p> 
   <div class="cnblogs_code"> 
    <pre>printk(<span style="color:#800000;">"</span><span style="color:#800000;">\033[1;31m %p---%pS \033[0m\r\n</span><span style="color:#800000;">"</span>, __builtin_return_address(<span style="color:#800080;">0</span>), __builtin_return_address(<span style="color:#800080;">0</span>));</pre> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <div style="color:#d4d4d4;font-family:Consolas, 'Courier New', monospace;font-weight:normal;font-size:14px;line-height:19px;"> 
    <div class="cnblogs_code"> 
     <pre><span style="color:#0000ff;">#define</span> BF3005_PREFIX   "bf3005: "
<span style="color:#0000ff;">#define</span> bf3005_trace(flag, format, arg...) \
<span style="color:#0000ff;">do</span><span style="color:#000000;"> { \
    </span><span style="color:#0000ff;">if</span> (bf3005_trace_param &amp;<span style="color:#000000;"> flag) \
        printk(KERN_ERR </span><span style="color:#800000;">"</span><span style="color:#800000;">[%s%4d@%18s] </span><span style="color:#800000;">"</span><span style="color:#000000;">format, BF3005_PREFIX, __LINE__, printk_get_basename(__FILE__), ##arg);  \
} </span><span style="color:#0000ff;">while</span> (<span style="color:#800080;">0</span><span style="color:#000000;">)

</span><span style="color:#0000ff;">#define</span> bf3005_printk(format, arg...) \<span style="color:#000000;">
    printk(KERN_ERR </span><span style="color:#800000;">"</span><span style="color:#800000;">%s</span><span style="color:#800000;">"</span><span style="color:#000000;">format, BF3005_PREFIX, ##arg)

bf3005_trace(BF3005_TRACE_DESCR, </span><span style="color:#800000;">"</span><span style="color:#800000;">enter %s(initialized = %d)\n</span><span style="color:#800000;">"</span><span style="color:#000000;">,
             __func__, bf3005</span>-&gt;initialized);</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p><strong><span style="color:#ff0000;">方法1：</span></strong></p> 
   <p>//#define MY_DEBUG<br>#ifdef MY_DEBUG<br>#define MY_DBG(x...) do{printk(x);}while(0)<br>#else<br>#define MY_DBG(x...)<br>#endif</p> 
   <p>&nbsp;</p> 
   <p><span style="color:#ff0000;"><strong>方法2：</strong></span></p> 
   <p><span style="color:#000000;">驱动可以如下写：</span></p> 
   <p>#define MY_LEVEL1 (1 &lt;&lt; 0)<br>#define MY_LEVEL2 (1 &lt;&lt; 1)</p> 
   <p>unsigned int my_trace_param=0;<br>module_param_named(trace, my_trace_param, uint, S_IRUGO|S_IWUSR);</p> 
   <p><br>#define MY_DBG(flag, msg...) \<br> do { \<br> if (my_trace_param &amp; flag) \<br> printk(KERN_ERR "zbh-debug: " msg); \<br> } while (0)</p> 
   <p>&nbsp;</p> 
   <p> MY_DBG(MY_LEVEL1, "Goodbye module exit1.\r\n");<br> MY_DBG(MY_LEVEL2, "Goodbye module exit2.\r\n");<br> MY_DBG(MY_LEVEL2, "Goodbye module exit3.\r\n");</p> 
   <p>&nbsp;</p> 
   <p>测试：</p> 
   <p>insmod my_printk_driver.ko&nbsp;</p> 
   <p>echo 2 &gt; /sys/module/my_printk_driver/parameters/trace&nbsp;</p> 
   <p>这样就可以选择到底打印哪一条语句，用来动态调试开关，默认关打印</p> 
   <p><img src="https://yqfile.alicdn.com/img_827272b1f21b039d02ee078822449f14.png" alt=""></p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>code:</p> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" src="https://yqfile.alicdn.com/img_1c53668bcee393edac0d7b3b3daff1ae.gif" alt="">
    <img class="code_img_opened" src="https://yqfile.alicdn.com/img_405b18b4b6584ae338e0f6ecaf736533.gif" alt="">
    <div class="cnblogs_code_hide"> 
     <pre>#include &lt;linux/init.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/module.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/fs.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/kernel.h&gt;<span style="color:#000000;">
#include</span>&lt;linux/slab.h&gt;        <span style="color:#008000;">//</span><span style="color:#008000;">kmalloc</span>
#include&lt;asm/io.h&gt;            <span style="color:#008000;">//</span><span style="color:#008000;">ioremap</span>
#include&lt;linux/device.h&gt;    <span style="color:#008000;">//</span><span style="color:#008000;">class_create/device_create</span>
#include &lt;asm/uaccess.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/pwm.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/cdev.h&gt;<span style="color:#000000;">
#include </span>&lt;pax/gpio_cfg.h&gt;<span style="color:#000000;">
#include </span>&lt;pax/bcm5830x_gpio_def.h&gt;<span style="color:#000000;">
#include </span>&lt;mach/iproc_regs.h&gt;<span style="color:#000000;">
#include </span>&lt;mach/memory.h&gt;<span style="color:#000000;">
#include </span>&lt;mach/iomux.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/delay.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/gpio.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/timer.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/hrtimer.h&gt;<span style="color:#000000;">
#include </span>&lt;linux/ktime.h&gt;

<span style="color:#0000ff;">#define</span> PWM_IOC_MAGIC         'n'
<span style="color:#0000ff;">#define</span> PWM_CONFIG            _IOW(PWM_IOC_MAGIC, 1, int)
<span style="color:#0000ff;">#define</span> PWM_DISABLE            _IOW(PWM_IOC_MAGIC, 2, int)
<span style="color:#0000ff;">#define</span> ONE_PWM_CONFIG      _IOW(PWM_IOC_MAGIC, 3, int)
<span style="color:#0000ff;">#define</span> ONE_PWM_DISABLE     _IOW(PWM_IOC_MAGIC, 4, int)
<span style="color:#0000ff;">#define</span> ONE_PWM_WHILE_10000 _IOW(PWM_IOC_MAGIC, 5, int)
<span style="color:#0000ff;">#define</span> SET_PWM_GPIO        _IOW(PWM_IOC_MAGIC, 6, int)
<span style="color:#0000ff;">#define</span> SET_PWM_POLATIRY    _IOW(PWM_IOC_MAGIC, 7, int)
<span style="color:#0000ff;">#define</span> READ_ONEPLUSE_COUNTER  _IOW(PWM_IOC_MAGIC, 8, int)
<span style="color:#0000ff;">#define</span> SET_PWM_FUNC           _IOW(PWM_IOC_MAGIC, 9, int)
<span style="color:#0000ff;">#define</span> SET_PWM_WHILE           _IOW(PWM_IOC_MAGIC, 10, int)
<span style="color:#0000ff;">#define</span> ONE_PWM_DOORBELL           _IOW(PWM_IOC_MAGIC, 11, int)


<span style="color:#0000ff;">#define</span> MY_LEVEL1                    (1 &lt;&lt; 0)
<span style="color:#0000ff;">#define</span> MY_LEVEL2                    (1 &lt;&lt; 1)<span style="color:#000000;">

unsigned </span><span style="color:#0000ff;">int</span> my_trace_param = <span style="color:#800080;">0</span><span style="color:#000000;">;
module_param_named(trace, my_trace_param, </span><span style="color:#0000ff;">uint</span>, S_IRUGO|<span style="color:#000000;">S_IWUSR);


</span><span style="color:#0000ff;">#define</span> MY_DBG(flag, msg...) \
    <span style="color:#0000ff;">do</span><span style="color:#000000;"> { \
        </span><span style="color:#0000ff;">if</span> (my_trace_param &amp;<span style="color:#000000;"> flag) \
            printk(KERN_ERR </span><span style="color:#800000;">"</span><span style="color:#800000;">zbh-bbl: </span><span style="color:#800000;">"</span><span style="color:#000000;"> msg); \
    } </span><span style="color:#0000ff;">while</span> (<span style="color:#800080;">0</span><span style="color:#000000;">)


</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> ttime = <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> pmode = <span style="color:#800080;">0</span>; <span style="color:#008000;">//</span><span style="color:#008000;"> pmode=0 ----&gt; asiu_pwmc , pmode=1 ----&gt; onepluse</span>
<span style="color:#000000;">
module_param(ttime, </span><span style="color:#0000ff;">int</span>, <span style="color:#800080;">0</span><span style="color:#000000;">);
module_param(pmode, </span><span style="color:#0000ff;">int</span>, <span style="color:#800080;">0</span><span style="color:#000000;">);


</span><span style="color:#008000;">//</span><span style="color:#008000;">module_param(period, int, 0);</span>

<span style="color:#0000ff;">#define</span> HELLO_MAJOR 230
<span style="color:#0000ff;">int</span> hello_major =<span style="color:#000000;"> HELLO_MAJOR;

module_param(hello_major, </span><span style="color:#0000ff;">int</span>, <span style="color:#800080;">0</span><span style="color:#000000;">);

</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">struct</span> cdev *hello_cdev =<span style="color:#000000;"> NULL;
</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">struct</span> <span style="color:#0000ff;">class</span> *dev_class =<span style="color:#000000;"> NULL;
</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">struct</span> device *dev_device =<span style="color:#000000;"> NULL;


</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> hello_open(<span style="color:#0000ff;">struct</span> inode *inode, <span style="color:#0000ff;">struct</span> file *<span style="color:#000000;">filp);
</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> hello_release(<span style="color:#0000ff;">struct</span> inode *inode, <span style="color:#0000ff;">struct</span> file *<span style="color:#000000;">filp);

</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> hello_open(<span style="color:#0000ff;">struct</span> inode *inode, <span style="color:#0000ff;">struct</span> file *<span style="color:#000000;">filp)
{
    printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">hello_open is OK\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">0</span><span style="color:#000000;">;
}

</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> hello_release(<span style="color:#0000ff;">struct</span> inode *inode, <span style="color:#0000ff;">struct</span> file *<span style="color:#000000;">filp)
{
    printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">hello_release is OK\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);

    printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">pwm disable and free\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">0</span><span style="color:#000000;">;
}

</span><span style="color:#0000ff;">struct</span> file_operations hello_ops =<span style="color:#000000;"> {
    .owner    </span>=<span style="color:#000000;"> THIS_MODULE,
    .open    </span>=<span style="color:#000000;"> hello_open,
    .release     </span>=<span style="color:#000000;"> hello_release,
    </span><span style="color:#008000;">//</span><span style="color:#008000;">.unlocked_ioctl = hello_ioctl,</span>
<span style="color:#000000;">};

</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> __init hello_init(<span style="color:#0000ff;">void</span><span style="color:#000000;">)
{
    dev_t devno;
    </span><span style="color:#0000ff;">int</span><span style="color:#000000;"> ret;

    devno </span>= MKDEV(hello_major, <span style="color:#800080;">0</span><span style="color:#000000;">);
    ret </span>= register_chrdev_region(devno, <span style="color:#800080;">1</span>, <span style="color:#800000;">"</span><span style="color:#800000;">zbh_hello</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    </span><span style="color:#0000ff;">if</span> (!<span style="color:#000000;">ret) {
        printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">register dev OK.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    }
    </span><span style="color:#0000ff;">else</span><span style="color:#000000;"> {
        printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">register dev failed.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    }

    hello_cdev </span>=<span style="color:#000000;"> cdev_alloc();
    cdev_init(hello_cdev, </span>&amp;<span style="color:#000000;">hello_ops);
    cdev_add(hello_cdev, devno, </span><span style="color:#800080;">1</span><span style="color:#000000;">);
    hello_cdev</span>-&gt;owner =<span style="color:#000000;"> THIS_MODULE;
    hello_cdev</span>-&gt;ops = &amp;<span style="color:#000000;">hello_ops;

    dev_class </span>= class_create(THIS_MODULE, <span style="color:#800000;">"</span><span style="color:#800000;">dev_class</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> (IS_ERR(dev_class)) {
        printk(KERN_ERR </span><span style="color:#800000;">"</span><span style="color:#800000;">class_create() failed for dev_class\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
        ret </span>= -<span style="color:#000000;">EINVAL;
        </span><span style="color:#0000ff;">goto</span><span style="color:#000000;"> out_err_1;
    }

    dev_device </span>= device_create(dev_class, NULL, devno, NULL, <span style="color:#800000;">"</span><span style="color:#800000;">zbh_hello</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> (IS_ERR(dev_device)) {
        printk(KERN_ERR </span><span style="color:#800000;">"</span><span style="color:#800000;">device_create failed.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
        ret </span>= -<span style="color:#000000;">ENODEV;
        </span><span style="color:#0000ff;">goto</span><span style="color:#000000;"> out_err_2;
    }
    
    printk(</span><span style="color:#800000;">"</span><span style="color:#800000;">Hello module init OK.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);

    </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">0</span><span style="color:#000000;">;

out_err_2:
    class_destroy(dev_class);

out_err_1:
    unregister_chrdev_region(MKDEV(hello_major, </span><span style="color:#800080;">0</span>), <span style="color:#800080;">1</span><span style="color:#000000;">);
    cdev_del(hello_cdev);
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
}

</span><span style="color:#0000ff;">static</span> <span style="color:#0000ff;">void</span> __exit hello_exit(<span style="color:#0000ff;">void</span><span style="color:#000000;">)
{
    cdev_del(hello_cdev);

    device_destroy(dev_class, MKDEV(hello_major, </span><span style="color:#800080;">0</span><span style="color:#000000;">));
    class_destroy(dev_class);

    unregister_chrdev_region(MKDEV(hello_major, </span><span style="color:#800080;">0</span>), <span style="color:#800080;">1</span><span style="color:#000000;">);

    MY_DBG(MY_LEVEL1, </span><span style="color:#800000;">"</span><span style="color:#800000;">Goodbye module exit1.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    MY_DBG(MY_LEVEL2, </span><span style="color:#800000;">"</span><span style="color:#800000;">Goodbye module exit2.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
    MY_DBG(MY_LEVEL2, </span><span style="color:#800000;">"</span><span style="color:#800000;">Goodbye module exit3.\r\n</span><span style="color:#800000;">"</span><span style="color:#000000;">);
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE(</span><span style="color:#800000;">"</span><span style="color:#800000;">Dual BSD/GPL</span><span style="color:#800000;">"</span><span style="color:#000000;">);
MODULE_AUTHOR(</span><span style="color:#800000;">"</span><span style="color:#800000;">zhangbinghua</span><span style="color:#800000;">"</span><span style="color:#000000;">);
MODULE_DESCRIPTION(</span><span style="color:#800000;">"</span><span style="color:#800000;">zhangbh debug driver</span><span style="color:#800000;">"</span>);</pre> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <p>&nbsp;</p> 
   <h4><span>&nbsp;32.container_of的用法</span></h4> 
   <p>typedef struct<br>{<br> u32* row_gpios;<br> u8 row_size;<br> u32* col_gpios;<br> u8 col_size;<br> tKEYCODE* keytable;<br> u16 keytable_size;<br> u8 debounce_ms;<br> int bl_gpio;<br> int buzzer_gpio; /* if gpio dimming */<br> int buzzer_pwm_id; /* if pwm controllor */<br> int ped_enable;<br> struct delayed_work work;<br> char * amp_pwr;<br> HOT_KEY_TAB *hot_key_table;<br> int hot_key_table_size;<br><span style="color:#ff0000;">struct delayed_work hot_key_work;</span><br>}tKEYPAD_MATRIX_DATA;<br>#endif</p> 
   <p>INIT_DELAYED_WORK(&amp;matrix_global_dat.key_data-&gt;hot_key_work, hot_key_scan);</p> 
   <p>static void hot_key_scan(struct work_struct *work)<br>{<br> int index;<br> int has_evnet=0;<br> tKEYPAD_REPORT_DATA report_key;<br><br> tKEYPAD_MATRIX_DATA *keypad = container_of(work,tKEYPAD_MATRIX_DATA, <span style="color:#ff0000;">hot_key_work</span>.work);<br><br> if(get_hot_key_scan_code(keypad))</p> 
   <p>}</p> 
   <p>&nbsp;</p> 
   <p>INIT_WORK(&amp;wnet_power_on_wq, gprs_mu709_power_on);</p> 
   <p> schedule_work(&amp;wnet_power_on_wq); <br><span style="color:#ff0000;">flush_work</span>(&amp;wnet_power_on_wq); // &nbsp;flush_work可以阻塞，是同步机制，如果去掉此函数就是异步机制</p> 
   <p>static void gprs_mu709_power_on(struct work_struct *work __attribute__((unused)))<br>{<br> gprs_mu709_opt(WNET_POWER_ON_WQ);<br>}</p> 
   <p>&nbsp;</p> 
   <p>vim使用</p> 
   <p>Vim</p> 
   <p>zR&nbsp; 全部展开</p> 
   <p>zM全部合并</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>vim&nbsp; 快捷键</p> 
   <p>shift&nbsp;&nbsp; +&nbsp; i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (‘I’)&nbsp;&nbsp;&nbsp; 进行编辑</p> 
   <p>shift&nbsp;&nbsp; +&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp; (‘$’)&nbsp;&nbsp;&nbsp; 跳到行尾</p> 
   <p>shift&nbsp;&nbsp; +&nbsp; v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (‘V’)&nbsp;&nbsp; 选中行&nbsp;</p> 
   <p>shift&nbsp;&nbsp; +&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (‘)’)&nbsp;&nbsp;&nbsp; 跳到行首</p> 
   <p>&nbsp;</p> 
   <p>先ctrl&nbsp; +&nbsp; v&nbsp; 模块编辑</p> 
   <p>再s，或者shift + $, shift + i进行编辑即可，编辑完后就esc就可以更改局部内容</p> 
   <p>s&nbsp;&nbsp;&nbsp; 删除</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p><strong>Ctrl+wl</strong><strong>或wh</strong><strong>是切换窗口来编辑</strong></p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>vs a.c 打开一个文件</p> 
   <p>&nbsp;</p> 
   <p>BundleSearch 查找所有插件，找到后，yy复制想要的那一行插件到vimrc中即可vi ~/.vimrc</p> 
   <p>然后再执行BundleInstall</p> 
   <p>BundleList 当前插件</p> 
   <p>&nbsp;</p> 
   <p>vim安装后，要把.vimrc放在里面保存即可，然后还有几个隐藏的文件夹也要放在里面</p> 
   <p>&nbsp;</p> 
   <p>查看函数被哪些调用的话，快捷键：ctrl+\ ，然后再按s即可</p> 
   <p>或者cs find main也可以</p> 
   <p>&nbsp;</p> 
   <p>先要安装了ctags，在程序的根目录下运行ctags -R，生成tags文件，然后在编辑程序时按Ctrl+]就会跳转到当前光标所在东西的定义处。若有多个tag，执行:ts，进行选择。按Ctrl+o即可跳回。不过，当修改过代码后，需要重新生成tags。</p> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;">33.git操作，检查代码log技巧</span></h4> 
   <p>Linux kernel&nbsp; 的官方 GIT地址是：</p> 
   <p><a href="http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git" rel="nofollow">http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git</a></p> 
   <p>可以从这个地址拿到 kernel 的 代码仓库。</p> 
   <p>git clone git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>在家目录下（也就是自己的目录下）</p> 
   <p>将git执行文件放在家目录的bin下面，没有就自己创一个bin目录</p> 
   <p>将文件git-completion.bash修改文件名为 .git-completion.bash</p> 
   <p>在家目录下的.bashrc 的最后一行增加source&nbsp; ~/.git-completion.bash</p> 
   <p>&nbsp;</p> 
   <p>source .bashrc</p> 
   <p>source .profile</p> 
   <p>这样git就有了补全功能</p> 
   <p>git-completion.bash文件里面有说明。</p> 
   <p>&nbsp;</p> 
   <p>git remote -v</p> 
   <p>如果是跟踪着某个开发者的git代码库,</p> 
   <p>&nbsp;</p> 
   <p>git blame &lt;文件名&gt;</p> 
   <p>然后,　找出感兴趣行上的commit ID&nbsp; ,用</p> 
   <p>git show&nbsp; &lt;commit ID&gt;</p> 
   <p>&nbsp;git log --pretty=oneline &nbsp;b.c&nbsp;</p> 
   <p>查看这次改动是由哪次提交引入的.一般可能会附加提交说明,</p> 
   <p>解释这次提交的初衷,作用等.</p> 
   <p>&nbsp;</p> 
   <p>还可以记下作者的名字　</p> 
   <p>&nbsp;</p> 
   <p>然后放狗(google)搜: lkml +作者名字+关于这个修改或主题的一两个重要关键词,</p> 
   <p>这样可能可以直接搜到当时提交时作者发在内核列表的邮件,可能有更详细的讨论.</p> 
   <p>&nbsp;</p> 
   <p>这么做去找找引入这些重要变化的源由.</p> 
   <p>&nbsp;</p> 
   <h4>34.内核关抢占</h4> 
   <div class="cnblogs_code"> 
    <pre> Symbol: PREEMPT_NONE [=y]                                                                                                                            |  
  | Type  : boolean                                                                                                                                      |  
  | Prompt: No Forced Preemption (Server)                                                                                                                |  
  |   Defined at kernel/Kconfig.preempt:<span style="color:#800080;">6</span>                                                                                                                |  
  |   Depends on: &lt;choice&gt;                                                                                                                               |  
  |   Location:                                                                                                                                          |  
  |     -&gt; Kernel Features                                                                                                                               |  
  |       -&gt; Preemption Model (&lt;choice&gt; [=y])   </pre> 
   </div> 
   <p>&nbsp;</p> 
   <h4>35. 处理DDR跑飞问题：</h4> 
   <p>某些处理器可以处理，如果是系统休眠唤醒后出现系统乱飞的情况，可以在休眠前对DDR进行CRC校验，唤醒后再进行一次校验，两次一样即可，但是必须保证DDR无任何操作。</p> 
   <p>&nbsp;</p> 
   <h4>36.开机自启动，需要用脚本启动脚本，rc文件中</h4> 
   <p>&nbsp;#camera drivers<br>&nbsp;&nbsp; if property:ro.fac.camera_number!= chmod 755 /startup/camera_drv_load.sh<br>&nbsp;&nbsp; if property:ro.fac.camera_number!= exec /startup/bin/sh /startup/camera_drv_load.sh</p> 
   <p>&nbsp;</p> 
   <h4>37.一个拆包的方法，i2c</h4> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" src="https://yqfile.alicdn.com/img_1c53668bcee393edac0d7b3b3daff1ae.gif" alt="">
    <img class="code_img_opened" src="https://yqfile.alicdn.com/img_405b18b4b6584ae338e0f6ecaf736533.gif" alt="">
    <div class="cnblogs_code_hide"> 
     <pre><span style="color:#008000;">/*</span><span style="color:#008000;"> define in iproc_smbus.c </span><span style="color:#008000;">*/</span>
<span style="color:#0000ff;">#define</span> I2C_RX_LENGTH_MAX_SUPPORT 62

<span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> __synaptics_rmi4_i2c_write(<span style="color:#0000ff;">struct</span> synaptics_rmi4_data *<span style="color:#000000;">rmi4_data,
                    unsigned </span><span style="color:#0000ff;">short</span> addr, unsigned <span style="color:#0000ff;">char</span> *<span style="color:#000000;">data,
                    unsigned </span><span style="color:#0000ff;">short</span><span style="color:#000000;"> length)
{
    </span><span style="color:#0000ff;">int</span> ret = <span style="color:#800080;">0</span><span style="color:#000000;">;
    </span><span style="color:#0000ff;">int</span> count = <span style="color:#800080;">0</span><span style="color:#000000;">;

    </span><span style="color:#0000ff;">for</span> (count = <span style="color:#800080;">0</span>; count &lt; length / I2C_RX_LENGTH_MAX_SUPPORT; count++<span style="color:#000000;">) {
        ret </span>=<span style="color:#000000;"> synaptics_rmi4_i2c_write(rmi4_data, addr, 
                                       data </span>+ count *<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT, 
                                       I2C_RX_LENGTH_MAX_SUPPORT);
        </span><span style="color:#0000ff;">if</span> (ret &lt; <span style="color:#800080;">0</span><span style="color:#000000;">) {
             dev_err(rmi4_data</span>-&gt;<span style="color:#000000;">pdev,
                </span><span style="color:#800000;">"</span><span style="color:#800000;">%s: I2C write over retry limit\n</span><span style="color:#800000;">"</span><span style="color:#000000;">, __func__);               
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
        }
    }
    
    ret </span>=<span style="color:#000000;"> synaptics_rmi4_i2c_write(rmi4_data, addr, 
                                   data </span>+ count *<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT, 
                                   length </span>%<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT);
    </span><span style="color:#0000ff;">if</span> (ret &lt; <span style="color:#800080;">0</span><span style="color:#000000;">) {
         dev_err(rmi4_data</span>-&gt;<span style="color:#000000;">pdev,
            </span><span style="color:#800000;">"</span><span style="color:#800000;">%s: I2C write over retry limit\n</span><span style="color:#800000;">"</span><span style="color:#000000;">, __func__);      
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
    }
    
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
}</span></pre> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <p>&nbsp;</p> 
   <h4><span style="color:#ff0000;">38.网络配置相关命令</span></h4> 
   <p>udhcpc -i usb0</p> 
   <p>route</p> 
   <p>ping www.baidu.com -I usb0</p> 
   <p>有时ping不通，可以试下只保留lo和usb0，其余的全down掉</p> 
   <p>&nbsp;</p> 
   <p>一种拆包算法</p> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" src="https://yqfile.alicdn.com/img_1c53668bcee393edac0d7b3b3daff1ae.gif" alt="">
    <img class="code_img_opened" src="https://yqfile.alicdn.com/img_405b18b4b6584ae338e0f6ecaf736533.gif" alt="">
    <div class="cnblogs_code_hide"> 
     <pre><span style="color:#0000ff;">#define</span> I2C_RX_LENGTH_MAX_SUPPORT 62

<span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> __synaptics_rmi4_i2c_write(<span style="color:#0000ff;">struct</span> synaptics_rmi4_data *<span style="color:#000000;">rmi4_data,
                    unsigned </span><span style="color:#0000ff;">short</span> addr, unsigned <span style="color:#0000ff;">char</span> *<span style="color:#000000;">data,
                    unsigned </span><span style="color:#0000ff;">short</span><span style="color:#000000;"> length)
{
    </span><span style="color:#0000ff;">int</span> ret = <span style="color:#800080;">0</span><span style="color:#000000;">;
    </span><span style="color:#0000ff;">int</span> count = <span style="color:#800080;">0</span><span style="color:#000000;">;

    </span><span style="color:#0000ff;">for</span> (count = <span style="color:#800080;">0</span>; count &lt; length / I2C_RX_LENGTH_MAX_SUPPORT; count++<span style="color:#000000;">) {
        ret </span>=<span style="color:#000000;"> synaptics_rmi4_i2c_write(rmi4_data, addr,
                                       data </span>+ count *<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT,
                                       I2C_RX_LENGTH_MAX_SUPPORT);
        </span><span style="color:#0000ff;">if</span> (ret &lt; <span style="color:#800080;">0</span><span style="color:#000000;">) {
             dev_err(rmi4_data</span>-&gt;<span style="color:#000000;">pdev,
                </span><span style="color:#800000;">"</span><span style="color:#800000;">%s: I2C write over retry limit\n</span><span style="color:#800000;">"</span><span style="color:#000000;">, __func__);               
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
        }
    }
    
    ret </span>=<span style="color:#000000;"> synaptics_rmi4_i2c_write(rmi4_data, addr,
                                   data </span>+ count *<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT,
                                   length </span>%<span style="color:#000000;"> I2C_RX_LENGTH_MAX_SUPPORT);
    </span><span style="color:#0000ff;">if</span> (ret &lt; <span style="color:#800080;">0</span><span style="color:#000000;">) {
         dev_err(rmi4_data</span>-&gt;<span style="color:#000000;">pdev,
            </span><span style="color:#800000;">"</span><span style="color:#800000;">%s: I2C write over retry limit\n</span><span style="color:#800000;">"</span><span style="color:#000000;">, __func__);      
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
    }
    
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> ret;
}</span></pre> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <h4>39.windows下保存网页的方法：</h4> 
   <p>ctrl + p&nbsp; 就是打印，然后选择adobe PDF，确定 即可</p> 
   <p>&nbsp;</p> 
   <h4>40.gcc编译器内置选项</h4> 
   <p><span style="color:#ff0000;">&nbsp;arm-none-linux-gnueabi-gcc -E -dM -&lt; /dev/null</span></p> 
   <p>&nbsp;</p> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" src="https://yqfile.alicdn.com/img_1c53668bcee393edac0d7b3b3daff1ae.gif" alt="">
    <img class="code_img_opened" src="https://yqfile.alicdn.com/img_405b18b4b6584ae338e0f6ecaf736533.gif" alt="">
    <div class="cnblogs_code_hide"> 
     <pre><span style="color:#0000ff;">#define</span> __DBL_MIN_EXP__ (-1021)
<span style="color:#0000ff;">#define</span> __HQ_FBIT__ 15
<span style="color:#0000ff;">#define</span> __UINT_LEAST16_MAX__ 65535
<span style="color:#0000ff;">#define</span> __SFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __FLT_MIN__ 1.1754943508222875e-38F
<span style="color:#0000ff;">#define</span> __UFRACT_MAX__ 0XFFFFP-16UR
<span style="color:#0000ff;">#define</span> __UINT_LEAST8_TYPE__ unsigned char
<span style="color:#0000ff;">#define</span> __DQ_FBIT__ 63
<span style="color:#0000ff;">#define</span> __INTMAX_C(c) c ## LL
<span style="color:#0000ff;">#define</span> __CS_SOURCERYGXX_REV__ 57
<span style="color:#0000ff;">#define</span> __ULFRACT_FBIT__ 32
<span style="color:#0000ff;">#define</span> __SACCUM_EPSILON__ 0x1P-7HK
<span style="color:#0000ff;">#define</span> __CHAR_BIT__ 8
<span style="color:#0000ff;">#define</span> __USQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __UINT8_MAX__ 255
<span style="color:#0000ff;">#define</span> __ACCUM_FBIT__ 15
<span style="color:#0000ff;">#define</span> __WINT_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __USFRACT_FBIT__ 8
<span style="color:#0000ff;">#define</span> __ORDER_LITTLE_ENDIAN__ 1234
<span style="color:#0000ff;">#define</span> __SIZE_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __WCHAR_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __LACCUM_IBIT__ 32
<span style="color:#0000ff;">#define</span> __DBL_DENORM_MIN__ ((double)4.9406564584124654e-324L)
<span style="color:#0000ff;">#define</span> __FLT_EVAL_METHOD__ 0
<span style="color:#0000ff;">#define</span> __unix__ 1
<span style="color:#0000ff;">#define</span> __LLACCUM_MAX__ 0X7FFFFFFFFFFFFFFFP-31LLK
<span style="color:#0000ff;">#define</span> __FRACT_FBIT__ 15
<span style="color:#0000ff;">#define</span> __UINT_FAST64_MAX__ 18446744073709551615ULL
<span style="color:#0000ff;">#define</span> __SIG_ATOMIC_TYPE__ int
<span style="color:#0000ff;">#define</span> __UACCUM_FBIT__ 16
<span style="color:#0000ff;">#define</span> __DBL_MIN_10_EXP__ (-307)
<span style="color:#0000ff;">#define</span> __FINITE_MATH_ONLY__ 0
<span style="color:#0000ff;">#define</span> __ARMEL__ 1
<span style="color:#0000ff;">#define</span> __LFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __GNUC_PATCHLEVEL__ 3
<span style="color:#0000ff;">#define</span> __LFRACT_MAX__ 0X7FFFFFFFP-31LR
<span style="color:#0000ff;">#define</span> __UINT_FAST8_MAX__ 255
<span style="color:#0000ff;">#define</span> __DEC64_MAX_EXP__ 385
<span style="color:#0000ff;">#define</span> __INT8_C(c) c
<span style="color:#0000ff;">#define</span> __UINT_LEAST64_MAX__ 18446744073709551615ULL
<span style="color:#0000ff;">#define</span> __SA_FBIT__ 15
<span style="color:#0000ff;">#define</span> __SHRT_MAX__ 32767
<span style="color:#0000ff;">#define</span> __LDBL_MAX__ 1.7976931348623157e+308L
<span style="color:#0000ff;">#define</span> __FRACT_MAX__ 0X7FFFP-15R
<span style="color:#0000ff;">#define</span> __ARM_ARCH_5TE__ 1
<span style="color:#0000ff;">#define</span> __UFRACT_FBIT__ 16
<span style="color:#0000ff;">#define</span> __UFRACT_MIN__ 0.0UR
<span style="color:#0000ff;">#define</span> __UINT_LEAST8_MAX__ 255
<span style="color:#0000ff;">#define</span> __GXX_TYPEINFO_EQUALITY_INLINE 0
<span style="color:#0000ff;">#define</span> __UINTMAX_TYPE__ long long unsigned int
<span style="color:#0000ff;">#define</span> __LLFRACT_EPSILON__ 0x1P-63LLR
<span style="color:#0000ff;">#define</span> __linux 1
<span style="color:#0000ff;">#define</span> __DEC32_EPSILON__ 1E-6DF
<span style="color:#0000ff;">#define</span> __CHAR_UNSIGNED__ 1
<span style="color:#0000ff;">#define</span> __UINT32_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __ULFRACT_MAX__ 0XFFFFFFFFP-32ULR
<span style="color:#0000ff;">#define</span> __TA_IBIT__ 64
<span style="color:#0000ff;">#define</span> __LDBL_MAX_EXP__ 1024
<span style="color:#0000ff;">#define</span> __WINT_MIN__ 0U
<span style="color:#0000ff;">#define</span> __linux__ 1
<span style="color:#0000ff;">#define</span> __ULLFRACT_MIN__ 0.0ULLR
<span style="color:#0000ff;">#define</span> __SCHAR_MAX__ 127
<span style="color:#0000ff;">#define</span> __WCHAR_MIN__ 0U
<span style="color:#0000ff;">#define</span> __INT64_C(c) c ## LL
<span style="color:#0000ff;">#define</span> __DBL_DIG__ 15
<span style="color:#0000ff;">#define</span> __LLACCUM_MIN__ (-0X1P31LLK-0X1P31LLK)
<span style="color:#0000ff;">#define</span> __SIZEOF_INT__ 4
<span style="color:#0000ff;">#define</span> __SIZEOF_POINTER__ 4
<span style="color:#0000ff;">#define</span> __USACCUM_IBIT__ 8
<span style="color:#0000ff;">#define</span> __USER_LABEL_PREFIX__ 
<span style="color:#0000ff;">#define</span> __STDC_HOSTED__ 1
<span style="color:#0000ff;">#define</span> __LDBL_HAS_INFINITY__ 1
<span style="color:#0000ff;">#define</span> __LFRACT_MIN__ (-0.5LR-0.5LR)
<span style="color:#0000ff;">#define</span> __HA_IBIT__ 8
<span style="color:#0000ff;">#define</span> __TQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __FLT_EPSILON__ 1.1920928955078125e-7F
<span style="color:#0000ff;">#define</span> __APCS_32__ 1
<span style="color:#0000ff;">#define</span> __USFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __LDBL_MIN__ 2.2250738585072014e-308L
<span style="color:#0000ff;">#define</span> __FRACT_MIN__ (-0.5R-0.5R)
<span style="color:#0000ff;">#define</span> __DEC32_MAX__ 9.999999E96DF
<span style="color:#0000ff;">#define</span> __DA_IBIT__ 32
<span style="color:#0000ff;">#define</span> __INT32_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __UQQ_FBIT__ 8
<span style="color:#0000ff;">#define</span> __SIZEOF_LONG__ 4
<span style="color:#0000ff;">#define</span> __UACCUM_MAX__ 0XFFFFFFFFP-16UK
<span style="color:#0000ff;">#define</span> __UINT16_C(c) c
<span style="color:#0000ff;">#define</span> __DECIMAL_DIG__ 17
<span style="color:#0000ff;">#define</span> __LFRACT_EPSILON__ 0x1P-31LR
<span style="color:#0000ff;">#define</span> __ULFRACT_MIN__ 0.0ULR
<span style="color:#0000ff;">#define</span> __gnu_linux__ 1
<span style="color:#0000ff;">#define</span> __LDBL_HAS_QUIET_NAN__ 1
<span style="color:#0000ff;">#define</span> __ULACCUM_IBIT__ 32
<span style="color:#0000ff;">#define</span> __UACCUM_EPSILON__ 0x1P-16UK
<span style="color:#0000ff;">#define</span> __GNUC__ 4
<span style="color:#0000ff;">#define</span> __ULLACCUM_MAX__ 0XFFFFFFFFFFFFFFFFP-32ULLK
<span style="color:#0000ff;">#define</span> __HQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __FLT_HAS_DENORM__ 1
<span style="color:#0000ff;">#define</span> __SIZEOF_LONG_DOUBLE__ 8
<span style="color:#0000ff;">#define</span> __BIGGEST_ALIGNMENT__ 8
<span style="color:#0000ff;">#define</span> __DQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __DBL_MAX__ ((double)1.7976931348623157e+308L)
<span style="color:#0000ff;">#define</span> __ULFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __INT_FAST32_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __DBL_HAS_INFINITY__ 1
<span style="color:#0000ff;">#define</span> __ACCUM_IBIT__ 16
<span style="color:#0000ff;">#define</span> __DEC32_MIN_EXP__ (-94)
<span style="color:#0000ff;">#define</span> __THUMB_INTERWORK__ 1
<span style="color:#0000ff;">#define</span> __LACCUM_MAX__ 0X7FFFFFFFFFFFFFFFP-31LK
<span style="color:#0000ff;">#define</span> __INT_FAST16_TYPE__ int
<span style="color:#0000ff;">#define</span> __LDBL_HAS_DENORM__ 1
<span style="color:#0000ff;">#define</span> __DEC128_MAX__ 9.999999999999999999999999999999999E6144DL
<span style="color:#0000ff;">#define</span> __INT_LEAST32_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __ARM_PCS 1
<span style="color:#0000ff;">#define</span> __DEC32_MIN__ 1E-95DF
<span style="color:#0000ff;">#define</span> __ACCUM_MAX__ 0X7FFFFFFFP-15K
<span style="color:#0000ff;">#define</span> __DBL_MAX_EXP__ 1024
<span style="color:#0000ff;">#define</span> __USACCUM_EPSILON__ 0x1P-8UHK
<span style="color:#0000ff;">#define</span> __DEC128_EPSILON__ 1E-33DL
<span style="color:#0000ff;">#define</span> __SFRACT_MAX__ 0X7FP-7HR
<span style="color:#0000ff;">#define</span> __FRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __PTRDIFF_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __UACCUM_MIN__ 0.0UK
<span style="color:#0000ff;">#define</span> __UACCUM_IBIT__ 16
<span style="color:#0000ff;">#define</span> __LONG_LONG_MAX__ 9223372036854775807LL
<span style="color:#0000ff;">#define</span> __SIZEOF_SIZE_T__ 4
<span style="color:#0000ff;">#define</span> __ULACCUM_MAX__ 0XFFFFFFFFFFFFFFFFP-32ULK
<span style="color:#0000ff;">#define</span> __SIZEOF_WINT_T__ 4
<span style="color:#0000ff;">#define</span> __SA_IBIT__ 16
<span style="color:#0000ff;">#define</span> __ULLACCUM_MIN__ 0.0ULLK
<span style="color:#0000ff;">#define</span> __GXX_ABI_VERSION 1002
<span style="color:#0000ff;">#define</span> __UTA_FBIT__ 64
<span style="color:#0000ff;">#define</span> __SOFTFP__ 1
<span style="color:#0000ff;">#define</span> __FLT_MIN_EXP__ (-125)
<span style="color:#0000ff;">#define</span> __USFRACT_MAX__ 0XFFP-8UHR
<span style="color:#0000ff;">#define</span> __UFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __INT_FAST64_TYPE__ long long int
<span style="color:#0000ff;">#define</span> __DBL_MIN__ ((double)2.2250738585072014e-308L)
<span style="color:#0000ff;">#define</span> __LACCUM_MIN__ (-0X1P31LK-0X1P31LK)
<span style="color:#0000ff;">#define</span> __ULLACCUM_FBIT__ 32
<span style="color:#0000ff;">#define</span> __ULLFRACT_EPSILON__ 0x1P-64ULLR
<span style="color:#0000ff;">#define</span> __DEC128_MIN__ 1E-6143DL
<span style="color:#0000ff;">#define</span> __REGISTER_PREFIX__ 
<span style="color:#0000ff;">#define</span> __UINT16_MAX__ 65535
<span style="color:#0000ff;">#define</span> __DBL_HAS_DENORM__ 1
<span style="color:#0000ff;">#define</span> __ACCUM_MIN__ (-0X1P15K-0X1P15K)
<span style="color:#0000ff;">#define</span> __SQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __UINT8_TYPE__ unsigned char
<span style="color:#0000ff;">#define</span> __UHA_FBIT__ 8
<span style="color:#0000ff;">#define</span> __NO_INLINE__ 1
<span style="color:#0000ff;">#define</span> __SFRACT_MIN__ (-0.5HR-0.5HR)
<span style="color:#0000ff;">#define</span> __UTQ_FBIT__ 128
<span style="color:#0000ff;">#define</span> __FLT_MANT_DIG__ 24
<span style="color:#0000ff;">#define</span> __VERSION__ "4.6.3"
<span style="color:#0000ff;">#define</span> __UINT64_C(c) c ## ULL
<span style="color:#0000ff;">#define</span> __ULLFRACT_FBIT__ 64
<span style="color:#0000ff;">#define</span> __FRACT_EPSILON__ 0x1P-15R
<span style="color:#0000ff;">#define</span> __ULACCUM_MIN__ 0.0ULK
<span style="color:#0000ff;">#define</span> __UDA_FBIT__ 32
<span style="color:#0000ff;">#define</span> __LLACCUM_EPSILON__ 0x1P-31LLK
<span style="color:#0000ff;">#define</span> __FLOAT_WORD_ORDER__ __ORDER_LITTLE_ENDIAN__
<span style="color:#0000ff;">#define</span> __USFRACT_MIN__ 0.0UHR
<span style="color:#0000ff;">#define</span> __UQQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __INT32_C(c) c
<span style="color:#0000ff;">#define</span> __DEC64_EPSILON__ 1E-15DD
<span style="color:#0000ff;">#define</span> __ORDER_PDP_ENDIAN__ 3412
<span style="color:#0000ff;">#define</span> __DEC128_MIN_EXP__ (-6142)
<span style="color:#0000ff;">#define</span> __UHQ_FBIT__ 16
<span style="color:#0000ff;">#define</span> __LLACCUM_FBIT__ 31
<span style="color:#0000ff;">#define</span> __INT_FAST32_TYPE__ int
<span style="color:#0000ff;">#define</span> __UINT_LEAST16_TYPE__ short unsigned int
<span style="color:#0000ff;">#define</span> unix 1
<span style="color:#0000ff;">#define</span> __INT16_MAX__ 32767
<span style="color:#0000ff;">#define</span> __SIZE_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __UINT64_MAX__ 18446744073709551615ULL
<span style="color:#0000ff;">#define</span> __UDQ_FBIT__ 64
<span style="color:#0000ff;">#define</span> __INT8_TYPE__ signed char
<span style="color:#0000ff;">#define</span> __ELF__ 1
<span style="color:#0000ff;">#define</span> __ULFRACT_EPSILON__ 0x1P-32ULR
<span style="color:#0000ff;">#define</span> __LLFRACT_FBIT__ 63
<span style="color:#0000ff;">#define</span> __FLT_RADIX__ 2
<span style="color:#0000ff;">#define</span> __INT_LEAST16_TYPE__ short int
<span style="color:#0000ff;">#define</span> __LDBL_EPSILON__ 2.2204460492503131e-16L
<span style="color:#0000ff;">#define</span> __UINTMAX_C(c) c ## ULL
<span style="color:#0000ff;">#define</span> __SACCUM_MAX__ 0X7FFFP-7HK
<span style="color:#0000ff;">#define</span> __SIG_ATOMIC_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __VFP_FP__ 1
<span style="color:#0000ff;">#define</span> __SIZEOF_PTRDIFF_T__ 4
<span style="color:#0000ff;">#define</span> __CS_SOURCERYGXX_MIN__ 3
<span style="color:#0000ff;">#define</span> __LACCUM_EPSILON__ 0x1P-31LK
<span style="color:#0000ff;">#define</span> __DEC32_SUBNORMAL_MIN__ 0.000001E-95DF
<span style="color:#0000ff;">#define</span> __INT_FAST16_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __UINT_FAST32_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __UINT_LEAST64_TYPE__ long long unsigned int
<span style="color:#0000ff;">#define</span> __USACCUM_MAX__ 0XFFFFP-8UHK
<span style="color:#0000ff;">#define</span> __SFRACT_EPSILON__ 0x1P-7HR
<span style="color:#0000ff;">#define</span> __FLT_HAS_QUIET_NAN__ 1
<span style="color:#0000ff;">#define</span> __FLT_MAX_10_EXP__ 38
<span style="color:#0000ff;">#define</span> __LONG_MAX__ 2147483647L
<span style="color:#0000ff;">#define</span> __DEC128_SUBNORMAL_MIN__ 0.000000000000000000000000000000001E-6143DL
<span style="color:#0000ff;">#define</span> __FLT_HAS_INFINITY__ 1
<span style="color:#0000ff;">#define</span> __unix 1
<span style="color:#0000ff;">#define</span> __USA_FBIT__ 16
<span style="color:#0000ff;">#define</span> __UINT_FAST16_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __DEC64_MAX__ 9.999999999999999E384DD
<span style="color:#0000ff;">#define</span> __CHAR16_TYPE__ short unsigned int
<span style="color:#0000ff;">#define</span> __PRAGMA_REDEFINE_EXTNAME 1
<span style="color:#0000ff;">#define</span> __CS_SOURCERYGXX_MAJ__ 2012
<span style="color:#0000ff;">#define</span> __INT_LEAST16_MAX__ 32767
<span style="color:#0000ff;">#define</span> __DEC64_MANT_DIG__ 16
<span style="color:#0000ff;">#define</span> __INT64_MAX__ 9223372036854775807LL
<span style="color:#0000ff;">#define</span> __UINT_LEAST32_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __SACCUM_FBIT__ 7
<span style="color:#0000ff;">#define</span> __INT_LEAST64_TYPE__ long long int
<span style="color:#0000ff;">#define</span> __INT16_TYPE__ short int
<span style="color:#0000ff;">#define</span> __INT_LEAST8_TYPE__ signed char
<span style="color:#0000ff;">#define</span> __SQ_FBIT__ 31
<span style="color:#0000ff;">#define</span> __DEC32_MAX_EXP__ 97
<span style="color:#0000ff;">#define</span> __INT_FAST8_MAX__ 127
<span style="color:#0000ff;">#define</span> __INTPTR_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __QQ_FBIT__ 7
<span style="color:#0000ff;">#define</span> linux 1
<span style="color:#0000ff;">#define</span> __UTA_IBIT__ 64
<span style="color:#0000ff;">#define</span> __LDBL_MANT_DIG__ 53
<span style="color:#0000ff;">#define</span> __SFRACT_FBIT__ 7
<span style="color:#0000ff;">#define</span> __SACCUM_MIN__ (-0X1P7HK-0X1P7HK)
<span style="color:#0000ff;">#define</span> __DBL_HAS_QUIET_NAN__ 1
<span style="color:#0000ff;">#define</span> __SIG_ATOMIC_MIN__ (-__SIG_ATOMIC_MAX__ - 1)
<span style="color:#0000ff;">#define</span> __INTPTR_TYPE__ int
<span style="color:#0000ff;">#define</span> __UINT16_TYPE__ short unsigned int
<span style="color:#0000ff;">#define</span> __WCHAR_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __SIZEOF_FLOAT__ 4
<span style="color:#0000ff;">#define</span> __USQ_FBIT__ 32
<span style="color:#0000ff;">#define</span> __UINTPTR_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __DEC64_MIN_EXP__ (-382)
<span style="color:#0000ff;">#define</span> __ULLACCUM_IBIT__ 32
<span style="color:#0000ff;">#define</span> __INT_FAST64_MAX__ 9223372036854775807LL
<span style="color:#0000ff;">#define</span> __FLT_DIG__ 6
<span style="color:#0000ff;">#define</span> __UINT_FAST64_TYPE__ long long unsigned int
<span style="color:#0000ff;">#define</span> __INT_MAX__ 2147483647
<span style="color:#0000ff;">#define</span> __LACCUM_FBIT__ 31
<span style="color:#0000ff;">#define</span> __USACCUM_MIN__ 0.0UHK
<span style="color:#0000ff;">#define</span> __UHA_IBIT__ 8
<span style="color:#0000ff;">#define</span> __INT64_TYPE__ long long int
<span style="color:#0000ff;">#define</span> __FLT_MAX_EXP__ 128
<span style="color:#0000ff;">#define</span> __UTQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __DBL_MANT_DIG__ 53
<span style="color:#0000ff;">#define</span> __INT_LEAST64_MAX__ 9223372036854775807LL
<span style="color:#0000ff;">#define</span> __DEC64_MIN__ 1E-383DD
<span style="color:#0000ff;">#define</span> __WINT_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __UINT_LEAST32_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __SIZEOF_SHORT__ 2
<span style="color:#0000ff;">#define</span> __ULLFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __LDBL_MIN_EXP__ (-1021)
<span style="color:#0000ff;">#define</span> __arm__ 1
<span style="color:#0000ff;">#define</span> __UDA_IBIT__ 32
<span style="color:#0000ff;">#define</span> __INT_LEAST8_MAX__ 127
<span style="color:#0000ff;">#define</span> __LFRACT_FBIT__ 31
<span style="color:#0000ff;">#define</span> __LDBL_MAX_10_EXP__ 308
<span style="color:#0000ff;">#define</span> __DBL_EPSILON__ ((double)2.2204460492503131e-16L)
<span style="color:#0000ff;">#define</span> __UINT8_C(c) c
<span style="color:#0000ff;">#define</span> __INT_LEAST32_TYPE__ int
<span style="color:#0000ff;">#define</span> __SIZEOF_WCHAR_T__ 4
<span style="color:#0000ff;">#define</span> __UINT64_TYPE__ long long unsigned int
<span style="color:#0000ff;">#define</span> __LLFRACT_MAX__ 0X7FFFFFFFFFFFFFFFP-63LLR
<span style="color:#0000ff;">#define</span> __TQ_FBIT__ 127
<span style="color:#0000ff;">#define</span> __INT_FAST8_TYPE__ signed char
<span style="color:#0000ff;">#define</span> __ULLACCUM_EPSILON__ 0x1P-32ULLK
<span style="color:#0000ff;">#define</span> __UHQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __LLACCUM_IBIT__ 32
<span style="color:#0000ff;">#define</span> __DBL_DECIMAL_DIG__ 17
<span style="color:#0000ff;">#define</span> __DEC_EVAL_METHOD__ 2
<span style="color:#0000ff;">#define</span> __TA_FBIT__ 63
<span style="color:#0000ff;">#define</span> __UDQ_IBIT__ 0
<span style="color:#0000ff;">#define</span> __ORDER_BIG_ENDIAN__ 4321
<span style="color:#0000ff;">#define</span> __ACCUM_EPSILON__ 0x1P-15K
<span style="color:#0000ff;">#define</span> __UINT32_C(c) c ## U
<span style="color:#0000ff;">#define</span> __INTMAX_MAX__ 9223372036854775807LL
<span style="color:#0000ff;">#define</span> __BYTE_ORDER__ __ORDER_LITTLE_ENDIAN__
<span style="color:#0000ff;">#define</span> __FLT_DENORM_MIN__ 1.4012984643248171e-45F
<span style="color:#0000ff;">#define</span> __LLFRACT_IBIT__ 0
<span style="color:#0000ff;">#define</span> __INT8_MAX__ 127
<span style="color:#0000ff;">#define</span> __UINT_FAST32_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __CHAR32_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __FLT_MAX__ 3.4028234663852886e+38F
<span style="color:#0000ff;">#define</span> __USACCUM_FBIT__ 8
<span style="color:#0000ff;">#define</span> __INT32_TYPE__ int
<span style="color:#0000ff;">#define</span> __SIZEOF_DOUBLE__ 8
<span style="color:#0000ff;">#define</span> __FLT_MIN_10_EXP__ (-37)
<span style="color:#0000ff;">#define</span> __UFRACT_EPSILON__ 0x1P-16UR
<span style="color:#0000ff;">#define</span> __INTMAX_TYPE__ long long int
<span style="color:#0000ff;">#define</span> __DEC128_MAX_EXP__ 6145
<span style="color:#0000ff;">#define</span> __GNUC_MINOR__ 6
<span style="color:#0000ff;">#define</span> __UINTMAX_MAX__ 18446744073709551615ULL
<span style="color:#0000ff;">#define</span> __DEC32_MANT_DIG__ 7
<span style="color:#0000ff;">#define</span> __HA_FBIT__ 7
<span style="color:#0000ff;">#define</span> __DBL_MAX_10_EXP__ 308
<span style="color:#0000ff;">#define</span> __LDBL_DENORM_MIN__ 4.9406564584124654e-324L
<span style="color:#0000ff;">#define</span> __INT16_C(c) c
<span style="color:#0000ff;">#define</span> __STDC__ 1
<span style="color:#0000ff;">#define</span> __PTRDIFF_TYPE__ int
<span style="color:#0000ff;">#define</span> __LLFRACT_MIN__ (-0.5LLR-0.5LLR)
<span style="color:#0000ff;">#define</span> __DA_FBIT__ 31
<span style="color:#0000ff;">#define</span> __UINT32_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __UINTPTR_TYPE__ unsigned int
<span style="color:#0000ff;">#define</span> __USA_IBIT__ 16
<span style="color:#0000ff;">#define</span> __DEC64_SUBNORMAL_MIN__ 0.000000000000001E-383DD
<span style="color:#0000ff;">#define</span> __ARM_EABI__ 1
<span style="color:#0000ff;">#define</span> __DEC128_MANT_DIG__ 34
<span style="color:#0000ff;">#define</span> __LDBL_MIN_10_EXP__ (-307)
<span style="color:#0000ff;">#define</span> __SIZEOF_LONG_LONG__ 8
<span style="color:#0000ff;">#define</span> __ULACCUM_EPSILON__ 0x1P-32ULK
<span style="color:#0000ff;">#define</span> __SACCUM_IBIT__ 8
<span style="color:#0000ff;">#define</span> __LDBL_DIG__ 15
<span style="color:#0000ff;">#define</span> __FLT_DECIMAL_DIG__ 9
<span style="color:#0000ff;">#define</span> __UINT_FAST16_MAX__ 4294967295U
<span style="color:#0000ff;">#define</span> __GNUC_GNU_INLINE__ 1
<span style="color:#0000ff;">#define</span> __ULLFRACT_MAX__ 0XFFFFFFFFFFFFFFFFP-64ULLR
<span style="color:#0000ff;">#define</span> __UINT_FAST8_TYPE__ unsigned char
<span style="color:#0000ff;">#define</span> __USFRACT_EPSILON__ 0x1P-8UHR
<span style="color:#0000ff;">#define</span> __ULACCUM_FBIT__ 32
<span style="color:#0000ff;">#define</span> __ARM_FEATURE_DSP 1
<span style="color:#0000ff;">#define</span> __QQ_IBIT__ 0</pre> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>linux-3.6.5/scripts</p> 
   <p>vi gcc-x86_32-has-stack-protector.sh</p> 
   <div class="cnblogs_code"> 
    <pre>#!/bin/<span style="color:#000000;">sh

echo </span><span style="color:#800000;">"</span><span style="color:#800000;">int foo(void) { char X[200]; return 3; }</span><span style="color:#800000;">"</span> | $* -S -x c -c -O0 -fstack-protector - -o - <span style="color:#800080;">2</span>&gt; /dev/<span style="color:#0000ff;">null</span> | grep -q <span style="color:#800000;">"</span><span style="color:#800000;">%gs</span><span style="color:#800000;">"</span>
<span style="color:#0000ff;">if</span> [ <span style="color:#800000;">"</span><span style="color:#800000;">$?</span><span style="color:#800000;">"</span> -eq <span style="color:#800000;">"</span><span style="color:#800000;">0</span><span style="color:#800000;">"</span><span style="color:#000000;"> ] ; then
        echo y
</span><span style="color:#0000ff;">else</span><span style="color:#000000;">
        echo n
fi</span></pre> 
   </div> 
   <p>%gs为栈保护</p> 
   <h4>41.如果反汇编后有%gs，就说明内核有栈保护</h4> 
   <p>arm_build.sh</p> 
   <div class="cnblogs_code"> 
    <pre>arm-none-linux-gnueabi-gcc -S -fstack-protector -o stack test_stack_protector.c</pre> 
   </div> 
   <p>test_stack_protector.c</p> 
   <div class="cnblogs_code"> 
    <pre><span style="color:#0000ff;">int</span> foo(<span style="color:#0000ff;">void</span>) { <span style="color:#0000ff;">char</span> X[<span style="color:#800080;">200</span>]; <span style="color:#0000ff;">return</span> <span style="color:#800080;">3</span>; }</pre> 
   </div> 
   <p>./arm_build.sh</p> 
   <p>vi stack</p> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" src="https://yqfile.alicdn.com/img_1c53668bcee393edac0d7b3b3daff1ae.gif" alt="">
    <img class="code_img_opened" src="https://yqfile.alicdn.com/img_405b18b4b6584ae338e0f6ecaf736533.gif" alt="">
    <div class="cnblogs_code_hide"> 
     <pre><span style="color:#000000;">        .arch armv5te
        .fpu softvfp
        .eabi_attribute </span><span style="color:#800080;">20</span>, <span style="color:#800080;">1</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">21</span>, <span style="color:#800080;">1</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">23</span>, <span style="color:#800080;">3</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">24</span>, <span style="color:#800080;">1</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">25</span>, <span style="color:#800080;">1</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">26</span>, <span style="color:#800080;">2</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">30</span>, <span style="color:#800080;">6</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">34</span>, <span style="color:#800080;">0</span><span style="color:#000000;">
        .eabi_attribute </span><span style="color:#800080;">18</span>, <span style="color:#800080;">4</span><span style="color:#000000;">
        .file   </span><span style="color:#800000;">"</span><span style="color:#800000;">test_stack_protector.c</span><span style="color:#800000;">"</span><span style="color:#000000;">
        .text
        .align  </span><span style="color:#800080;">2</span><span style="color:#000000;">
        .</span><span style="color:#0000ff;">global</span><span style="color:#000000;"> foo
        .type   foo, </span>%<span style="color:#000000;">function
foo:
        .fnstart
        @ args </span>= <span style="color:#800080;">0</span>, pretend = <span style="color:#800080;">0</span>, frame = <span style="color:#800080;">208</span><span style="color:#000000;">
        @ frame_needed </span>= <span style="color:#800080;">1</span>, uses_anonymous_args = <span style="color:#800080;">0</span><span style="color:#000000;">
        stmfd   sp</span>!<span style="color:#000000;">, {fp, lr}
        .save {fp, lr}
        .setfp fp, sp, #</span><span style="color:#800080;">4</span><span style="color:#000000;">
        add     fp, sp, #</span><span style="color:#800080;">4</span><span style="color:#000000;">
        .pad #</span><span style="color:#800080;">208</span><span style="color:#000000;">
        sub     sp, sp, #</span><span style="color:#800080;">208</span><span style="color:#000000;">
        ldr     r3, .L3
        ldr     r3, [r3, #</span><span style="color:#800080;">0</span><span style="color:#000000;">]
        str     r3, [fp, #</span>-<span style="color:#800080;">8</span><span style="color:#000000;">]
        mov     r3, #</span><span style="color:#800080;">3</span><span style="color:#000000;">
        mov     r0, r3
        ldr     r3, .L3
        ldr     r2, [fp, #</span>-<span style="color:#800080;">8</span><span style="color:#000000;">]
        ldr     r3, [r3, #</span><span style="color:#800080;">0</span><span style="color:#000000;">]
        cmp     r2, r3
        beq     .L2
        bl      __stack_chk_fail
.L2:
        sub     sp, fp, #</span><span style="color:#800080;">4</span><span style="color:#000000;">
        ldmfd   sp</span>!<span style="color:#000000;">, {fp, pc}
.L4:
        .align  </span><span style="color:#800080;">2</span><span style="color:#000000;">
.L3:
        .word   __stack_chk_guard
        .fnend
        .size   foo, .</span>-<span style="color:#000000;">foo
        .ident  </span><span style="color:#800000;">"</span><span style="color:#800000;">GCC: (Sourcery CodeBench Lite 2012.03-57) 4.6.3</span><span style="color:#800000;">"</span><span style="color:#000000;">
        .section        .note.GNU</span>-stack,<span style="color:#800000;">""</span>,%progbits</pre> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <p>&nbsp;</p> 
   <h4>42.为了保证代码不乱序，内存屏障的建立</h4> 
   <p>&nbsp;#define readb(c)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;({ u8&nbsp; __v = readb_relaxed(c); __iormb(); __v; })<br>#define readw(c)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;({ u16 __v = readw_relaxed(c); __iormb(); __v; })<br>#define readl(c)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;({ u32 __v = readl_relaxed(c); __iormb(); __v; })</p> 
   <p>eg:</p> 
   <p>aaa();</p> 
   <p>wmb();</p> 
   <p>bbb();</p> 
   <p>&nbsp;no_console_suspend</p> 
   <p>initcall_debug&nbsp;</p> 
   <p>说明initcall_debug是一个内核参数，可以跟踪initcall，用来定位内核初始化的问题。在cmdline中增加initcall_debug后，内核启动过程中会增加如下形式的日志，在调用每一个init函数前有一句打印，结束后再有一句打印并且输出了该Init函数运行的时间，通过这个信息可以用来定位启动过程中哪个init函数运行失败以及哪些init函数运行时间较长</p> 
   <p>&nbsp;休眠唤醒调试还可以打开【Power management options】===》</p> 
   <p>[*] Power Management Debug Support | | <br> | | [*] Extra PM attributes in sysfs for low-level debugging/testing | | <br> | | [*] Test suspend/resume and wakealarm during bootup </p> 
   <p>&nbsp;</p> 
   <h4>43.网络 netstate</h4> 
   <p>netstate –nao</p> 
   <p>&nbsp;</p> 
   <p>svn co svn:xxx --depth=empty</p> 
   <p>&nbsp;ls</p> 
   <p>&nbsp;svn ls</p> 
   <p>&nbsp;cd aa/</p> 
   <p>&nbsp;ls</p> 
   <p>&nbsp;svn ls</p> 
   <p>&nbsp;svn up release_branches --depth=empty</p> 
   <p>&nbsp;cd release_branches/</p> 
   <p>&nbsp;ls</p> 
   <p>&nbsp;svn ls</p> 
   <p>&nbsp;svn up xxx</p> 
   <p>&nbsp;</p> 
   <h4>44.内核异步通知</h4> 
   <p><br> retval = request_irq(pdev-&gt;irq, MioSoC_isr, IRQF_SHARED&nbsp;&nbsp;, "MioSoC", pmio);<br><br> 中断处理程序：<br> static irqreturn_t MioSoC_isr(int irq, void *data)<br> {<br> &nbsp; &nbsp; <br> &nbsp; &nbsp; struct MioSoC_device *dev = data;<br> &nbsp; &nbsp; spin_lock(&amp;dev-&gt;regs_lock);<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;dwIntStatus = inw(pmio-&gt;caddr +0x4c); // 读取卡上的控制缓存器中断状态<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (dwIntStatus &amp; 0x4)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;// 检查是否为本卡的中断<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; outw((dwIntStatus &amp; (~0x43)),pmio-&gt;caddr+0x4c);<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; if (pmio-&gt;async_queue )<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;kill_fasync(&amp;dev-&gt;async_queue, SIGIO, POLL_IN); //发出异步通知信号<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; outw(dwIntStatus,pmio-&gt;caddr + 0x4c);<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br> &nbsp; &nbsp; spin_unlock(&amp;dev-&gt;regs_lock);<br> &nbsp; &nbsp;&nbsp;&nbsp;wake_up_interruptible(&amp;dev-&gt;wait);<br> &nbsp; &nbsp; return IRQ_HANDLED;<br> }</p> 
   <p>&nbsp;</p> 
   <h4>45.线程处理，线程安全</h4> 
   <p> futex </p> 
   <p>&nbsp;</p> 
   <h4>46.unicore32</h4> 
   <p>unicore32的代码写的很好，可以参考</p> 
   <h4>47.defio 双缓冲机制</h4> 
   <h4>48.strace命令</h4> 
   <p>strace -o t.log ./a.out</p> 
   <h4>49.Linux上搭建web服务器，实现web控制嵌入式设备</h4> 
   <p>随着Internet技术的兴起，在嵌入式设备的管理与交互中，基于Web方式的应用成为目 前的主流，这种程序结构也就是大家非常熟悉的B/S结构，即在嵌入式设备上运行一个支持脚本或CGI功能的Web服务器，能够生成动态页面，在用户端只需 要通过Web浏览器就可以对嵌入式设备进行管理和监控，非常方便实用。 </p> 
   <p>路由器上现在不用boa服务器了，一般用uhttpd和goahead，这样可以对CGI进行控制</p> 
   <p>&nbsp;</p> 
   <h4>50. 内核中的set_freezable与wait_event_freezable_timeout，进程等待</h4> 
   <p>到目前为止，我们的控制线程就已经分析完了，不过我们发现，这个控制线程是在usb_stor_acquire_resources中定义的，在usb_stor_acquire_resources之后，我们还创建了usb_stor_scan_thread线程，这是一个扫描线程。</p> 
   <p>static int usb_stor_scan_thread(void * __us)</p> 
   <p>{</p> 
   <p>&nbsp; &nbsp; struct us_data *us = (struct us_data *)__us;</p> 
   <p>&nbsp; &nbsp; printk(KERN_DEBUG</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "usb-storage: device found at %d\n", us-&gt;pusb_dev-&gt;devnum);</p> 
   <p>&nbsp; &nbsp; set_freezable();&nbsp; //设备在一定时间内没有响应，会挂起</p> 
   <p>&nbsp; &nbsp; if (delay_use &gt; 0) {&nbsp; // delay_use秒后如果U盘没拔出则继续执行，否则执行disconnect</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printk(KERN_DEBUG "usb-storage: waiting for device "</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "to settle before scanning\n");</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wait_event_freezable_timeout(us-&gt;delay_wait,test_bit(US_FLIDX_DONT_SCAN, &amp;us-&gt;dflags), delay_use * HZ);</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp; if (!test_bit(US_FLIDX_DONT_SCAN, &amp;us-&gt;dflags)) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (us-&gt;protocol == US_PR_BULK &amp;&amp;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !(us-&gt;fflags &amp; US_FL_SINGLE_LUN)) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mutex_lock(&amp;us-&gt;dev_mutex);</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; us-&gt;max_lun = usb_stor_Bulk_max_lun(us);&nbsp; //询问设备支持多少个LUN</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mutex_unlock(&amp;us-&gt;dev_mutex);</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi_scan_host(us_to_host(us));</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printk(KERN_DEBUG "usb-storage: device scan complete\n");</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp; complete_and_exit(&amp;us-&gt;scanning_done, 0);&nbsp; //本进程结束，唤醒disconnect中的进程</p> 
   <p>}</p> 
   <p>对于上面这个扫描线程，里面的usb_stor_Bulk_max_lun函数完成了主机控制器与设备之间的第一次通信。USB驱动程序首先发送一个命令，然后设备根据命令返回一些信息，这里显示的是一个表示LUN个数的数字，usb_stor_Bulk_max_lun完成的是一次控制传输。</p> 
   <p>&nbsp;</p> 
   <h4>51.Linux resume</h4> 
   <p>linux的resume是根据device的加载顺序来执行的</p> 
   <h4>52.setup_time中断</h4> 
   <p>这种虽然是软中断处理，但一样是中断上下文，不可以在处理函数中休眠，或者发生进程调度的事情，这样会死机，workqueue.c中只有一种机制才可以这样做，tasklet</p> 
   <h4>53.休眠唤醒</h4> 
   <p>休眠唤醒除了在配置文件中cmdline增加no_console_suspend，还可以开机如下操作，即可打印出休眠唤醒的全部log</p> 
   <p>echo N &gt; /sys/module/printk/parameters/console_suspend</p> 
   <h4>54.pwm使用</h4> 
   <p>// disable pwm&nbsp;的正确流程是：</p> 
   <p>pwm_config(prn_stb_pwm,&nbsp;0, period_ns); ===》这样才是安全的</p> 
   <p>pwm_disable(prn_stb_pwm);</p> 
   <p>而不是：</p> 
   <p>pwm_disable(prn_stb_pwm);</p> 
   <p>&nbsp;</p> 
   <h4>55. 算一张表里有多少个1</h4> 
   <p>hweight8</p> 
   <p>&nbsp;</p> 
   <h4>56.通过Sys节点名字反查pid</h4> 
   <p>fs/sysfs/file.c</p> 
   <p>sysfs_open_file() ======&gt;</p> 
   <p>&nbsp; &nbsp; char&nbsp;*name1,&nbsp;*name2;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;name1&nbsp;=&nbsp;"buzzer_user_trigger";<br>&nbsp;&nbsp;&nbsp;&nbsp;name2&nbsp;=&nbsp;"buzzer_keypad_enable";<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((0&nbsp;==&nbsp;strncmp(attr_sd-&gt;s_name,&nbsp;name1,&nbsp;strlen(name1)))&nbsp;||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(0&nbsp;==&nbsp;strncmp(attr_sd-&gt;s_name,&nbsp;name2,&nbsp;strlen(name2)))&nbsp;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk("zbh&nbsp;%s():---&gt;%s&nbsp;(%d)&nbsp;\r\n",&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__func__,&nbsp;attr_sd-&gt;s_name,&nbsp;__LINE__);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printk("zbh&nbsp;%s():---&gt;pid=%d&nbsp;(%d)&nbsp;\r\n",&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__func__,&nbsp;current-&gt;pid,&nbsp;__LINE__);<br>&nbsp;&nbsp;&nbsp;&nbsp;}</p> 
   <p>&nbsp;</p> 
   <h4>57.文件系统知识点</h4> 
   <p>cat /proc/filesystems</p> 
   <p>&nbsp;</p> 
   <h4>58.spi透传？</h4> 
   <p>spi能否透传？如果master与slave不对称，一边带宽高，一边带宽少，从机接收的时候接收不过来，如果要用dma方式，并且协定好底层数据传输大小，每次发送时候要发送数据长度</p> 
   <p>&nbsp;可以参考stm32官网的 spi IAP固件升级的例程代码</p> 
   <p>&nbsp;</p> 
   <p>欢迎交流，如有转载请注明出处</p> 
   <p>新浪博客：http://blog.sina.com.cn/u/2049150530<br>博客园：http://www.cnblogs.com/sky-heaven/<br>知乎：http://www.zhihu.com/people/zhang-bing-hua</p> 
   <p>&nbsp;</p> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
