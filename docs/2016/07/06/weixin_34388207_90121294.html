<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>UBI 文件系统移植 sys 设备信息【转】 « NotBeCN</title>
  <meta name="description" content="                 转自：    http://blog.chinaunix.net/uid-25304914-id-3058647.html            cat&nbsp;    /sys/class/misc/    ubi_ctrl/dev           -----------...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2016/07/06/weixin_34388207_90121294.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">UBI 文件系统移植 sys 设备信息【转】</h1>
    <p class="post-meta">Jul 6, 2016</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div>
    转自：
    <a href="http://blog.chinaunix.net/uid-25304914-id-3058647.html" rel="nofollow">http://blog.chinaunix.net/uid-25304914-id-3058647.html</a> 
   </div> 
   <div>
    cat&nbsp;
    <span style="color:#f00000;"><strong>/sys/</strong></span>class/misc/
    <strong>ubi_ctrl</strong>/dev
   </div> 
   <div>
    --------------------------------------------
   </div> 
   <div>
    UBI: attaching mtd11 to ubi0
    <br>UBI: physical eraseblock size:&nbsp;&nbsp; 262144 bytes (256 KiB)
    <br>UBI: logical eraseblock size:&nbsp;&nbsp;&nbsp; 262144 bytes
    <br>UBI: smallest flash I/O unit:&nbsp;&nbsp;&nbsp; 4096
    <br>UBI: commit max data size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 258048 bytes
    <br>UBI: commit max no of records:&nbsp;&nbsp; 3739
    <br>UBI: default node Size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 bytes
    <br>UBI: el record Size Per Pnum:&nbsp;&nbsp;&nbsp; 69 bytes
    <br>UBI: el pebs in one group:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 58&nbsp;
    <br>UBI: el group size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4066 bytes
    <br>UBI: el number of groups:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 142 bytes
    <br>UBI: el number of buds:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3
    <br>UBI warning: find_last_sb: bad block at 8191
    <br>UBI warning: find_last_sb: bad block at 8190
    <br>UBI error: verify_node: bad magic in node
    <br>UBI error: verify_node: bad magic in node
    <br>UBI error: ubi_get_sb: both super blocks are bad
    <br>UBI error: ubil_scan_init: could not get sb
   </div> 
   <div>
    &nbsp;
   </div> 
   <div>
    ---------------------------------------------------
   </div> 
   <div>
    #cat&nbsp;
    <span style="color:#f000f0;"><strong>/sys/class/ubi/ubi0/dev<br>252:0<br></strong></span> 
   </div> 
   <div>
    ===================================================
   </div> 
   <div>
    &nbsp;
   </div> 
   <div>
    <a href="http://blog.sina.com.cn/s/blog_5de7d9f80100dpa4.html" rel="nofollow">http://blog.sina.com.cn/s/blog_5de7d9f80100dpa4.html</a>
   </div> 
   <div> 
    <div class="articalTitle">
     ubi&nbsp;and&nbsp;ubifs应用手记(2009-04-07 15:43:41) 
     <div class="turnBoxzz">
      <a class="SG_aBtn SG_aBtn_ico SG_turn" href="http://blog.chinaunix.net/.:;" rel="nofollow">转载▼</a>
     </div> 
    </div> 
    <div class="articalTag"> 
     <table>
      <tbody>
       <tr>
        <td class="blog_tag">标签：&nbsp;<a href="http://uni.sina.com.cn/c.php?t=blog&amp;k=%D4%D3%CC%B8&amp;ts=bpost&amp;stype=tag" rel="nofollow">杂谈</a> </td> 
        <td class="blog_class">分类：&nbsp;<a href="http://blog.sina.com.cn/s/articlelist_1575475704_2_1.html" rel="nofollow">linux</a> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="articalContent"> 
     <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ubi and ubifs应用手记</p> 
     <p>1.配置ubi and ubifs<br>in .config<br>&nbsp;&nbsp;CONFIG_MTD_UBI=y<br>&nbsp;&nbsp;&nbsp; CONFIG_UBIFS_FS=y<br>&nbsp;&nbsp;&nbsp; CONFIG_CRYPTO_ALGAPI=y&nbsp; CONFIG_CRYPTO_DEFLATE=y CONFIG_CRYPTO_LZO=y CONFIG_CRC16=y&nbsp; CONFIG_LZO_COMPRESS=y CONFIG_LZO_DECOMPRESS=y<br>注意：如果配置成模块(=m)，则可以手动加载&nbsp;&nbsp;&nbsp;</p> 
     <p><br>2.manual attach/detach ubi to mtd<br>&nbsp; ./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m mtdnumber<br>&nbsp; ./ubidetaach /dev/<strong>ubi_ctrl</strong>&nbsp;-m mtdnumber<br>&nbsp;</p> 
     <p><br>3.manual create ubi volume<br>&nbsp; ./ubimkvol /dev/ubi_device_number -s size -N name<br>&nbsp; like:<br>&nbsp; ./ubimkvol /dev/ubi0 -s 300MiB -N ubifs1</p> 
     <p>4.mount ubifs volume<br>&nbsp; mount -t ubifs ubi0:ubifs1 /tmp/ubifs1<br>&nbsp;</p> 
     <p><br>5.ubi node and&nbsp;<strong>ubi_ctrl</strong>&nbsp;node<br>#cat /sys/class/misc/<strong>ubi_ctrl</strong>/dev<br>10:63<br>加入/dev下没有<strong>ubi_ctrl</strong>,则我们可以sudo&nbsp;<strong>mknod</strong>&nbsp;<strong>ubi_ctrl</strong>&nbsp;c 10 63创建一个端点</p> 
     <p>#./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m 6<br>#cat /sys/class/ubi/ubi0/dev<br>252:0<br>当我们attach ubi0 to mtd6后，如果/dev下没有ubi0,则创建一个，sudo&nbsp;<strong>mknod</strong>&nbsp;ubi0 c 252 0</p> 
     <p><br>6.我们可以手动create volume,然后手动mount ubifs,也可以在PC上创建ubi.img（创建好volume,volume写有数据)烧录进mtd device<br>How to generate ubi image and write to mtd device<br>&nbsp; ./mkfs.ubifs -r a205_rootdisk -m 4096 -e 516096 -c 40 -o ubifs.img&nbsp;&nbsp;<br>&nbsp; ./ubinize -o ubi.img -m 4096 -p 512KiB&nbsp; ubinize.cfg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp; ./ubiformat -q /dev/mtd5 -f ubi.img&nbsp;&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp; -m minimum I/O unit size<br>&nbsp; -e&nbsp; maximum logical erase block count<br>&nbsp; -c maximum logical erase block count<br>&nbsp; -x compression type - "lzo", "favor_lzo", "zlib" or "none" (default: "lzo")<br>&nbsp; -p size of the physical eraseblock of the flash this UBI image is created for in bytes,<br>&nbsp;<br>注意：在PC上ubuntu使用mkfs.ubifs and ubinize,则我们要用普通的gcc来编译它们，同时在ubuntu上装上lzo库：sudo apt-get install liblzo2-dev<br>附录：<br>1).ubinize.cfg<br>[ubifs]<br>mode=ubi<br>image=ubifs.img<br>vol_id=0<br>vol_size=500MiB<br>vol_type=dynamic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if vol_type=static, then ubi volume is read only<br>vol_name=ubifs0<br>vol_flags=autoresize</p> 
     <p>这样这样当./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m n后，就可以mount -t ubifs ubi0:ubifs0 /tmp</p> 
     <p><br>2)如果是想mount crafms image,只要<br>./ubinize -o ubi.img -m 4096 -p 512KiB&nbsp; ubinize.cfg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>./ubiformat -q /dev/mtd5 -f ubi.img<br>ubinize.cfg<br>[ubifs]<br>mode=ubi<br>image=cramfs.img<br>vol_id=0<br>vol_size=500MiB<br>vol_type=dynamic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>vol_name=cramfs<br>vol_flags=autoresize</p> 
     <p>这样当./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m n后就可以从cat /proc/mtd中看到一个ubi volume仿真的mtd device,我们只要mount这个mtd设备对应的mtdblock就可以了（如mount -t cramfs /dev/mtdblock10 /tmp),注意，既然是烧录了cramfs到ubi volume，则我们只能以cramfs方式mount这个volume,不能再以ubifs方式（mount -t ubifs ubi0:cramfs /tmp）mount这个volume.但如果我们用./ubiupdate /dev/ubi0_0 -t wipe out擦干净这个volume后，我们是可以用ubifs方式mount这个volume,但mount起来这个volume，进入mount的目录，是什么内容也没有的。</p> 
     <p>3)三个volume的ubinize.cfg（注意[]中名字不能一样，vol_id不能一样，vol_name不能一样，另vol_flags=auto_resize只能使用在一个volume上）<br>[ubifs1]<br>mode=ubi<br>image=ubifs.img<br>vol_id=0<br>vol_size=20MiB<br>vol_type=dynamic<br>vol_name=ubifs0<br>vol_alignment=1</p> 
     <p><br>[cramfs1]<br>mode=ubi<br>image=smallroot.cramfs<br>vol_id=1<br>vol_size=20MiB<br>vol_type=dynamic<br>vol_name=cramfs<br>vol_alignment=1</p> 
     <p>[cramfs2]<br>mode=ubi<br>image=qtroot.cramfs<br>vol_id=2<br>vol_size=50MiB<br>vol_type=dynamic<br>vol_name=cramfs2<br>vol_alignment=1<br>vol_flags=autoresize</p> 
     <p>这样当使用./ubiformat写入ubi.img后，则./ubiattach后，我们可以知道多了三个假的mtd device.<br>第一个可以用mount -t ubifs ubi0:ubifs0 /tmp/ubifs1<br>第二个可以用mount -t cramfs /dev/mtdblockn /tmp/cramfs1<br>第二个可以用mount -t cramfs /dev/mtdblockm /tmp/cramfs2<br>&nbsp;</p> 
     <p>7. How to disable compression?<br>UBIFS compression may be disabled for whole file system during the image creation time using the "-x none" mkfs.ubifs option. However, if UBIFS compression is enabled, it may be disabled for individual files by cleaning the inode compression flag:</p> 
     <p>$ chattr -c /mnt/ubifs/file<br>in shell, or</p> 
     <p><br>ioctl(fd, FS_IOC_GETFLAGS, &amp;flags);<br><br>flags &amp;= ~FS_COMPR_FL;<br><br>ioctl(fd, FS_IOC_SETFLAGS, &amp;flags);<br>in C programs. Similarly, if compression is disabled by default, you may enable if for individual inodes by setting the compression flag. Note, the code which uses the compression flag works fine on other Linux file-systems, because the flag is just ignored in this case.</p> 
     <p>It might be a good idea to disable compression for say, mp3 or jpeg files which would anyway not compress and UBIFS would just waste CPU time trying to compress them. The compression may also be disabled if one wants faster file I/O, because UBIFS would not need to compress or decompress the data on reads and write. However, I/O speed may actually become slower if compression is disabled. Indeed, in case of a very fast CPU and very slow flash compressed writes are faster, but this is usually not true for embedded systems.</p> 
     <p><br>8.mount cramfs on ubi volume<br>&nbsp; ubi volume is fake mtd device.<br># cat /proc/mtd<br>dev:&nbsp;&nbsp;&nbsp; size&nbsp;&nbsp; erasesize&nbsp; name<br>mtd0: 180000 00080000 "Bootloader"<br>mtd1: 400000 00080000 "Kernel 0"<br>mtd2: 400000 00080000 "Kernel 1"<br>mtd3: 80000 00080000 "Boot up screen"<br>mtd4: a00000 00080000 "Rescue file system"<br>mtd5: 1400000 00080000 "Root file system"<br>mtd6: 3e800000 00080000 "Data area1"<br>mtd7: 3e800000 00080000 "Data area2"<br>mtd8: 6a400000 00080000 "Data area3"<br>mtd9: 16380000 00080000 "reserve"<br>&nbsp;<br>&nbsp;<br>#./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m 6<br>#./ubimkvol /dev/ubi0 -s 300MiB -N ubifs1<br># cat /proc/mtd<br>dev:&nbsp;&nbsp;&nbsp; size&nbsp;&nbsp; erasesize&nbsp; name<br>mtd0: 180000 00080000 "Bootloader"<br>mtd1: 400000 00080000 "Kernel 0"<br>mtd2: 400000 00080000 "Kernel 1"<br>mtd3: 80000 00080000 "Boot up screen"<br>mtd4: a00000 00080000 "Rescue file system"<br>mtd5: 1400000 00080000 "Root file system"<br>mtd6: 3e800000 00080000 "Data area1"<br>mtd7: 3e800000 00080000 "Data area2"<br>mtd8: 6a400000 00080000 "Data area3"<br>mtd9: 16380000 00080000 "reserve"<br>mtd10: 12c3c000 0007e000 "ubifs1"</p> 
     <p># cp cramfs.img /dev/mtdblock10<br># mount -t cramfs /dev/mtdblock6 /tmp</p> 
     <p>&nbsp;</p> 
     <p>After create fake mtd device(ubi volume), mount jffs2<br>#mount -t jffs2 /dev/mtdblock10 /mnt</p> 
     <p>9.ubiupdatevol /dev/ubi0_0 -t&nbsp;&nbsp; //wipe out volume<br>&nbsp; ubiupdatevol /dev/ubi0_0 fs.img&nbsp; //write image to volume<br>&nbsp;<br>&nbsp; ./ubiupdatevol /dev/ubi0_0 ubifs.img&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //之后we can mount ubifs: mount -t ubifs ubi0:ubifs0 /tmp来挂载这个ubifs<br>&nbsp; ./ubiupdatevol /dev/ubi0_1 smallroot.cramfs&nbsp; //之后我们就可以mount -t cramfs /dev/mtdblockn /tmp来挂载这个cramfs<br>&nbsp;</p> 
     <p>10.挂载vfat<br>1)制作vfat.img（在PC上制作）<br>$ dd if=/dev/zero of=vfat.img bs=1M count=20<br>#losetup /dev/loop0 vfat.img<br>#mkfs.vfat /dev/loop0<br>注意：这有一个warnning,但不用理会：Loop device does not match a floppy size, using default hd params<br>#mount -t vfat /dev/loop0 vfat_mount_point<br>往vfat_mount_point目录写东西，或copy东西到这目录<br>#umount vfat_mount_point<br>#losetup -d /dev/loop0</p> 
     <p>2)用ubinize打包成ubi.img，然后用ubiformat写入mtd devie。方法二是用ubiupdatevol先wipe out volume，然后用ubiupdatevol将vfat.img<br>写入volume.</p> 
     <p>但注意：因为emulate mtd device是不支持写操作的，所以我mount -t /dev/mtdblockn，这个mtdblockn是一个ubi volume emuluate的mtd device，<br>所以mount的vfat只可以读，写是无法保存的。（测试中写是能完成，ls也能看到，但sync后重启unit,重新mount可以看到写的数据是没有保存如vfat的）<br>&nbsp;<br>&nbsp;<br>11.ubifs(read/write/attach/mount)speed,<br>Wrtie speed -------------------speed=1.66M/s<br># time dd if=/dev/zero of=/tmp/ubifs1/zero100M&nbsp; bs=1M count=100;time sync<br>100+0 records in<br>100+0 records out<br>real&nbsp;&nbsp;&nbsp; 0m 59.13s<br>user&nbsp;&nbsp;&nbsp; 0m 0.00s<br>sys&nbsp;&nbsp;&nbsp;&nbsp; 0m 4.62s<br>real&nbsp;&nbsp;&nbsp; 0m 1.11s<br>user&nbsp;&nbsp;&nbsp; 0m 0.00s<br>sys&nbsp;&nbsp;&nbsp;&nbsp; 0m 0.74s</p> 
     <p>Read speed-----------------------speed=2.27M/s<br># time cp ubifs1/zero100M /dev/null;time sync<br>s3c-nand: 1 bit(s) error detected, corrected successfully<br>s3c-nand: 1 bit(s) error detected, corrected successfully<br>s3c-nand: 1 bit(s) error detected, corrected successfully<br>real&nbsp;&nbsp;&nbsp; 0m 44.06s<br>user&nbsp;&nbsp;&nbsp; 0m 0.14s<br>sys&nbsp;&nbsp;&nbsp;&nbsp; 0m 42.67s<br>real&nbsp;&nbsp;&nbsp; 0m 0.06s<br>user&nbsp;&nbsp;&nbsp; 0m 0.00s<br>sys&nbsp;&nbsp;&nbsp;&nbsp; 0m 0.01s</p> 
     <p><br>12.配置ubifs as rootfs<br>in .config:<br>&nbsp; CONFIG_CMDLINE="console=ttySAC0 ubi.mtd=5 root=ubi0:rootfs rootfstype=ubifs"<br>&nbsp;<br>then if we had wrote root fs ubi image to mtd5, then we can boot up with ubi root fs.</p> 
     <p><br>13.遇到的rw filesystem change to read only filesystem<br># ./ubiattach /dev/<strong>ubi_ctrl</strong>&nbsp;-m 6<br>UBI: attaching mtd6 to ubi0<br>UBI: physical eraseblock size:&nbsp;&nbsp; 524288 bytes (512 KiB)<br>UBI: logical eraseblock size:&nbsp;&nbsp;&nbsp; 516096 bytes<br>UBI: smallest flash I/O unit:&nbsp;&nbsp;&nbsp; 4096<br>UBI: VID header offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 (aligned 4096)<br>UBI: data offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8192<br>PEB 0 is bad<br>PEB 32 is bad<br>UBI: attached mtd6 to ubi0<br>UBI: MTD device name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Data area1"<br>UBI: MTD device size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1000 MiB<br>UBI: number of good PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1998<br>UBI: number of bad PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<br>UBI: max. allowed volumes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128<br>UBI: wear-leveling threshold:&nbsp;&nbsp;&nbsp; 4096<br>UBI: number of internal volumes: 1<br>UBI: number of user volumes:&nbsp;&nbsp;&nbsp;&nbsp; 3<br>UBI: available PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>UBI: total number of reserved PEBs: 1998<br>UBI: number of PEBs reserved for bad PEB handling: 19<br>UBI: max/mean erase counter: 7/0<br>UBI: background thread "ubi_bgt0d" started, PID 940</p> 
     <p>./ubiupdatevol /dev/ubi0_0 -t<br>UBI error: ubi_io_write: error -5 while writing 4096 bytes to PEB 21:4096, written 0 bytes<br>UBI warning: ubi_eba_write_leb: failed to write VID header to LEB 2147479551:0, PEB 21<br>UBI: try another PEB<br>UBI error: ubi_io_write: error -5 while writing 4096 bytes to PEB 12:4096, written 0 bytes<br>UBI warning: ubi_eba_write_leb: failed to write VID header to LEB 2147479551:0, PEB 12<br>UBI: try another PEB<br>UBI error: ubi_io_write: error -5 while writing 4096 bytes to PEB 1999:4096, written 0 bytes<br>UBI warning: ubi_eba_write_leb: failed to write VID header to LEB 2147479551:0, PEB 1999<br>UBI: try another PEB<br>UBI error: ubi_io_write: error -5 while writing 24576 bytes to PEB 1998:8192, written 0 bytes<br>UBI warning: ubi_eba_write_leb: failed to write 24576 bytes at offset 0 of LEB 2147479551:0, PEB 1998<br>UBI warning: ubi_ro_mode: switch to read-only mode<br>UBI error: ubi_io_write: read-only mode<br>UBI error: erase_worker: failed to erase PEB 7, error -30<br>UBI error: do_work: work failed with error code -30<br>UBI error: ubi_thread: ubi_bgt0d: work failed with error code -30<br>ubiupdatevol: error!: cannot truncate volume "/dev/ubi0_0"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; error 30 (Read-only file system)<br>UBI warning: vol_cdev_release: update of volume 0 not finished, volume is damaged</p> 
     <p>遇到此问题后，再flash_eraseall /dev/mt6或/dev/mtd7后，再写image to /dev/mtd7 or /dev/mtd6都出错<br>./ubiformat -q /dev/mtd6 -f ubi.img.20M_none<br>libmtd: error!: cannot write 32768 bytes to mtd6 (eraseblock 1, offset 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; error 5 (Input/output error)<br>ubiformat: error!: cannot write eraseblock 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; error 5 (Input/output error)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>遇到此问题后，我在uboot下执行<br>NAND erase: device 0 offset 0x600000, size 0x400000<br>ret:0 erase.addr:600000<br>Erasing at 0x600000 --&nbsp; 12% complete.ret:0 erase.addr:680000<br>Erasing at 0x680000 --&nbsp; 25% complete.ret:0 erase.addr:700000<br>Erasing at 0x700000 --&nbsp; 37% complete.ret:0 erase.addr:780000<br>Erasing at 0x780000 --&nbsp; 50% complete.ret:0 erase.addr:800000<br>Erasing at 0x800000 --&nbsp; 62% complete.ret:0 erase.addr:880000<br>Erasing at 0x880000 --&nbsp; 75% complete.ret:0 erase.addr:900000<br>Erasing at 0x900000 --&nbsp; 87% complete.ret:0 erase.addr:980000<br>Erasing at 0x980000 -- 100% complete.<br>OK<br>SMDK2450 # nand write c0000000 600000 300000</p> 
     <p>NAND write: device 0 offset 0x600000, size 0x300000<br>&nbsp;0 bytes written: ERROR<br>&nbsp;<br>&nbsp;<br>&nbsp;最后，我重新用笔尖fine tine nand flash的引脚(特别是/WE),终于救回了这片flash<br>&nbsp;<br>&nbsp;<br>&nbsp;结论：好像是此flash已经损坏，或者是引脚接触不好----因为erase是ok的，而且nand read读也是ok的,导致无法写入PEB，会使得<br>&nbsp;UBIFS变为只读。<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>14.mkfs.ubifs -c issus&nbsp; (注意 fat directory is empty)<br><a href="mailto:dannylo@fs1:~/cram2fs_tools%24" rel="nofollow">dannylo@fs1:~/cram2fs_tools$</a>&nbsp;./mkfs.ubifs -r fat&nbsp; -m 4096 -e 516096 -c 10 -o test.img<br>Error: too low max. count of LEBs, minimum is 17<br><a href="mailto:dannylo@fs1:~/cram2fs_tools%24" rel="nofollow">dannylo@fs1:~/cram2fs_tools$</a>&nbsp;./mkfs.ubifs -r fat&nbsp; -m 4096 -e 516096 -c 19 -o test.img<br>Error: too many log LEBs, maximum is 2<br><a href="mailto:dannylo@fs1:~/cram2fs_tools%24" rel="nofollow">dannylo@fs1:~/cram2fs_tools$</a>&nbsp;./mkfs.ubifs -r fat&nbsp; -m 4096 -e 516096 -c 21 -o test.img<br>Error: too many log LEBs, maximum is 4<br><a href="mailto:dannylo@fs1:~/cram2fs_tools%24" rel="nofollow">dannylo@fs1:~/cram2fs_tools$</a>&nbsp;./mkfs.ubifs -r fat&nbsp; -m 4096 -e 516096 -c 22 -o test.img</p> 
     <p>结论：即最小的ubifs.img为11M.注意对要烧录进volume的cramfs or cram2fs format的image的size好像没有要求。</p> 
     <p>&nbsp;</p> 
     <p>15.ubi face bad block<br>我们在uboot中用nand markbad 试过mark bad block(一块在mtd device的首块，一块在中间，一块在最后），测试表面ubi在attach时的scan能认出<br>bad block nand skip bad block.同时用ubiformat烧写ubi.img时也会自动跳过bad block.</p> 
     <p>&nbsp;</p> 
     <p>&nbsp;</p> 
    </div> 
   </div> 
   <div>
    &nbsp;
   </div> 
   <div>
    &nbsp;
   </div> 
   <div> 
    <br>&nbsp;
   </div> 
   <div>
    &nbsp;
   </div> 
   <div>
    <a href="http://blog.chinaunix.net/space.php?uid=21166696&amp;do=blog&amp;id=176732" rel="nofollow">http://blog.chinaunix.net/space.php?uid=21166696&amp;do=blog&amp;id=176732</a>
   </div> 
   <div>
    &nbsp;
   </div> 
   <div>
    内核配置 添加支持
   </div> 
   <div>
    &nbsp;
   </div> 
   <div> 
    <p>自从<span style="font-family:'Times New Roman';">linux2.6.27</span>以后的<span style="color:#f000f0;">内核</span>版本都支持<span style="color:#f000f0;font-family:'Times New Roman';">UBI</span><span style="color:#f000f0;">文件系统</span>了，新版本的<span style="color:#f000f0;"><span style="font-family:'Times New Roman';">uboot</span>已经支持</span><span style="font-family:'Times New Roman';">UBIFS</span>了。</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>关于<span style="font-family:'Times New Roman';">uboot</span>的移植(移植指的是 本身已经支持UBIFS的uboot的，针对具体板卡的移植)可以参考<span style="font-family:'Times New Roman';">&nbsp;</span>《<span style="color:#f000f0;"><strong>嵌入式</strong></span><span style="color:#f000f0;font-family:'Times New Roman';"><strong>Linux</strong></span><span style="color:#f000f0;"><strong>之我行</strong></span>》<span style="font-family:'Times New Roman';">&nbsp;</span>中<span style="font-family:'Times New Roman';">uboot</span>的移植，那里写得比较详细。我也是参考了其中的文章</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';"><strong>1、&nbsp;&nbsp;</strong><strong>uboot</strong></span><strong>的</strong><strong><span style="font-family:'Times New Roman';">UBI</span></strong><strong>的移植</strong></p> 
    <p>关于<span style="font-family:'Times New Roman';">uboot</span>的<span style="font-family:'Times New Roman';">UBI</span>的移植几乎没有说明介绍，</p> 
    <p>移植首先要保证你的<span style="font-family:'Times New Roman';">flash</span>驱动能够跑起来，我是在<span style="font-family:'Times New Roman';">nand flash&nbsp;</span>上跑的<span style="font-family:'Times New Roman';">UBI</span>。</p> 
    <p>刚开始的时候我也没有什么头绪，只能够从<span style="font-family:'Times New Roman';">uboot</span>的<span style="font-family:'Times New Roman';">readme</span>开始查找一些蛛丝马迹。</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">- MTD Support (mtdparts command, UBI support)</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONFIG_MTD_DEVICE</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adds the MTD device infrastructure from the Linux kernel.</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Needed for mtdparts command support.</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONFIG_MTD_PARTITIONS</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adds the MTD partitioning infrastructure from the Linux</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel. Needed for UBI support.</span></p> 
    <p>&nbsp;</p> 
    <p>因此呢，要<span style="font-family:'Times New Roman';">UBI</span>支持首先得要<span style="font-family:'Times New Roman';">MTD</span>支持，因此在配置文件中要添加以上两项的定义。</p> 
    <p>要移植<span style="font-family:'Times New Roman';">UBI</span>还要添加<span style="font-family:'Times New Roman';">:</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_CMD_UBIFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_CMD_UBI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p>&nbsp;</p> 
    <p>总的关于<span style="font-family:'Times New Roman';">UBI</span>的部分是以下几个宏</p> 
    <p><span style="font-family:'Times New Roman';">/****MTD Support (mtdparts command, UBI support)****/</span></p> 
    <p><span style="font-family:'Times New Roman';">#if 1</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_MTD_DEVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_MTD_PARTITIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_CMD_MTDPARTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_CMD_UBIFS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_CMD_UBI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_LZO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_RBTREE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span></p> 
    <p><span style="font-family:'Times New Roman';">#endif</span></p> 
    <p>&nbsp;</p> 
    <p>同时呢要给<span style="font-family:'Times New Roman';">NAND</span>建立个默认的分区。方便以后操作。我的分区如下：</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">#define MTDIDS_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nand0=nandflash0"</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">#define MTDPARTS_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"mtdparts=nandflash0:320k@0(uboot)," \</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"64k(params)," \</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"2m(kernel)," \</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"-(root)"</span></p> 
    <p>&nbsp;</p> 
    <p>需要注意的是增加<span style="font-family:'Times New Roman';">UBI</span>的支持之后<span style="font-family:'Times New Roman';">uboot</span>会增大到<span style="font-family:'Times New Roman';">260</span>多<span style="font-family:'Times New Roman';">KB</span>，在<span style="font-family:'Times New Roman';">NAND</span>中启动，需要修改</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p align="left"><span style="font-family:'Times New Roman';">//copy U-Boot to RAM</span></p> 
    <p><span style="font-family:'Times New Roman';">ldr r0, =TEXT_BASE&nbsp;&nbsp;</span>//传递给C代码的第一个参数：u-boot在RAM中的起始地址</p> 
    <p><span style="font-family:'Times New Roman';">mov r1, #0x0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;//传递给C代码的第二个参数：Nand Flash的起始地址</p> 
    <p align="left"><span style="font-family:'Times New Roman';">mov r2, #0x50000&nbsp;&nbsp;&nbsp;&nbsp;</span>//传递给C代码的第三个参数：u-boot的长度大小(320KB)</p> 
    <p><span style="font-family:'Times New Roman';">bl nand_read_ll&nbsp;&nbsp;&nbsp;&nbsp;//</span>此处调用<span style="font-family:'Times New Roman';">C</span>代码中读<span style="font-family:'Times New Roman';">Nand</span>的函数，现在还没有要自己编写实现</p> 
    <p>&nbsp;</p> 
    <p>如果<span style="font-family:'Times New Roman';">uboot</span>传给<span style="font-family:'Times New Roman';">nand_read_ll&nbsp;</span>的<span style="font-family:'Times New Roman';">uboot</span>的参数小于<span style="font-family:'Times New Roman';">uboot</span>的长度的话，<span style="font-family:'Times New Roman';">uboot</span>跑不起来，移植的时候被这个问题搞得很郁闷。</p> 
    <p>另外还有一个地方就是编译的时要求<span style="font-family:'Times New Roman';">CONFIG_SYS_MALLOC_LEN</span>大于等于<span style="font-family:'Times New Roman';">512KB,</span>下面两个没有要求我也给改了。</p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_SYS_MALLOC_LEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONFIG_ENV_SIZE+&nbsp;&nbsp;512*1024)</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_SYS_GBL_DATA_SIZE&nbsp;&nbsp;&nbsp;512&nbsp;/* size in bytes reserved for initial data */</span></p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_STACKSIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(512*1024)&nbsp;&nbsp;&nbsp;/* regular stack */</span></p> 
    <p>如果没改的话会报错。</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>这个时候就可以<span style="font-family:'Times New Roman';">make&nbsp;</span>了，如果顺利的话会编译出<span style="font-family:'Times New Roman';">uboot-bin</span>在根目录下。</p> 
    <p>再通过友善提供的<span style="font-family:'Times New Roman';">vivi&nbsp;&nbsp;a</span>命令下载到<span style="font-family:'Times New Roman';">nand&nbsp;</span>中，启动如下：</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">U-Boot 2010.06-rc1 (Jul 15 2010 - 16:48:33)</span></p> 
    <p><span style="font-family:'Times New Roman';">DRAM:&nbsp;&nbsp;64 MiB</span></p> 
    <p><span style="font-family:'Times New Roman';">Flash: 2 MiB</span></p> 
    <p><span style="font-family:'Times New Roman';">NAND:&nbsp;&nbsp;64 MiB</span></p> 
    <p><span style="font-family:'Times New Roman';">*** Warning - bad CRC or NAND, using default environment</span></p> 
    <p><span style="font-family:'Times New Roman';">In:&nbsp;&nbsp;&nbsp;&nbsp;serial</span></p> 
    <p><span style="font-family:'Times New Roman';">Out:&nbsp;&nbsp;&nbsp;serial</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Err:&nbsp;&nbsp;&nbsp;serial</span></p> 
    <p><span style="font-family:'Times New Roman';">Net:&nbsp;&nbsp;&nbsp;dm9000</span></p> 
    <p><span style="font-family:'Times New Roman';">Hit any key to stop autoboot:&nbsp;&nbsp;0</span></p> 
    <p>相关的<span style="font-family:'Times New Roman';">ubi</span>命令如下：</p> 
    <p>&nbsp;</p> 
    <p>...</p> 
    <p>到这里<span style="font-family:'Times New Roman';">uboot</span>的<span style="font-family:'Times New Roman';">UBI</span>移植完成了。</p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'Times New Roman';">2.&nbsp;</span></strong><strong>第二步是内核对</strong><strong><span style="font-family:'Times New Roman';">UBI</span></strong><strong>的支持</strong>。</p> 
    <p><span style="font-family:'Times New Roman';">linux-2.6.30.4</span>的内核已经包含<span style="font-family:'Times New Roman';">UBI</span>了</p> 
    <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;1)Device Drivers&nbsp;&nbsp;---&gt;Memory Technology Device (MTD) support&nbsp;&nbsp;---&gt;UBI - Unsorted block images&nbsp;&nbsp;---&gt;Enable UBI</span></p> 
    <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;2)File systems&nbsp;&nbsp;---&gt;Miscellaneous filesystems&nbsp;&nbsp;---&gt;UBIFS file system support</span></p> 
    <p align="left">这样我们的内核就支持UBIFS文件系统了</p> 
    <p>&nbsp;</p> 
    <p align="left">&nbsp;</p> 
    <p align="left"><strong>3. UBIFS</strong><strong>工具的编译</strong></p> 
    <p align="left">&nbsp;</p> 
    <p align="left">我是将ubifs直接作为根文件系统挂载的，需要mkfs.ubifs这个工具我是从git直接下载的最新版的mtd-utils，同时编译mtd-utils还需要两个库。</p> 
    <p align="left">lzo-2.03，zlib-1.2.3&nbsp;下载完之后就直接按照默认的方式make。</p> 
    <p align="left">注意：我们是在x86平台上将rootfs文件系统打包成UBIFS格式的因此呢不能够修改编译工具。</p> 
    <p align="left">最后在mkfs.ubifs目录下生产mkfs.ubifs。</p> 
    <p align="left">mkfs.ubifs的使用相关参数，照着它的<span style="font-family:'Times New Roman';">Examples</span>使用就可以了，具体参数的设置可以查看<span style="font-family:'Times New Roman';">u-boot ubi</span>分区时候所打印出来的参数。</p> 
    <p><span style="font-family:'Times New Roman';">Usage: mkfs.ubifs [OPTIONS] target</span></p> 
    <p><span style="font-family:'Times New Roman';">Make a UBIFS file system image from an existing directory tree</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Examples:</span></p> 
    <p><span style="font-family:'Times New Roman';">Build file system from directory /opt/img, writting the result in the ubifs.img file</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.ubifs -m 512 -e 128KiB -c 100 -r /opt/img ubifs.img</span></p> 
    <p><span style="font-family:'Times New Roman';">The same, but writting directly to an UBI volume</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.ubifs -r /opt/img /dev/ubi0_0</span></p> 
    <p><span style="font-family:'Times New Roman';">Creating an empty UBIFS filesystem on an UBI volume</span></p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.ubifs /dev/ubi0_0</span></p> 
    <p>将<span style="font-family:'Times New Roman';">rootfs</span>打包成镜像：</p> 
    <p><span style="font-family:'Times New Roman';">./mtd-utils/mkfs.ubifs/mkfs.ubifs -m 512 -e 15872 -c 3944-r rootfs -o ubifs.img</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Uboot</span>传给内核的启动参数</p> 
    <p><span style="font-family:'Times New Roman';">#define CONFIG_BOOTARGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">"ubi.mtd=3 root=ubi0:rootfs rootfstype=ubifs console=ttySAC0 init=/linuxrc rw"</span></p> 
    <p>注意：因为还没找到原因挂载之后文件系统是只读的，所以就加了个<span style="font-family:'Times New Roman';">rw</span>，有人解决之后请联系我，不胜感激。</p> 
    <p>内核的默认启动参数和<span style="font-family:'Times New Roman';">uboot</span>传过来的是一样的。</p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'Times New Roman';">4</span></strong><strong>、</strong><strong><span style="font-family:'Times New Roman';">UBI</span></strong><strong>的使用</strong></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">1</span>内核的烧写</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">tftp 0x32000000 zImage&nbsp;</span>将内核通过<span style="font-family:'Times New Roman';">tftp</span>下载到内存中</p> 
    <p><span style="font-family:'Times New Roman';">nand erase 0x60000 0x200000</span></p> 
    <p><span style="font-family:'Times New Roman';">nand write 0x32000000 0x60000 0x200000</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">2&nbsp;</span>文件系统的烧写</p> 
    <p>&nbsp;</p> 
    <p>使用默认的分区对<span style="font-family:'Times New Roman';">nand</span>进行分区：<span style="font-family:'Times New Roman';">mtdpart default</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">...&nbsp;</span></p> 
    <p><span style="font-family:'Times New Roman';">1</span>）擦除<span style="font-family:'Times New Roman';">root</span>分区<span style="font-family:'Times New Roman';">&nbsp;nand erase root</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">2</span>）对<span style="font-family:'Times New Roman';">root</span>分区进行<span style="font-family:'Times New Roman';">ubi</span>格式化<span style="font-family:'Times New Roman';">&nbsp;ubi part root</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Creating 1 MTD partitions on "nand0":</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">0x26000033fc64f4-0x400000000000000 : ""</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: attaching mtd1 to ubi0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: physical eraseblock size:&nbsp;&nbsp;&nbsp;16384 bytes (16 KiB)</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: logical eraseblock size:&nbsp;&nbsp;&nbsp;&nbsp;15872 bytes</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: smallest flash I/O unit:&nbsp;&nbsp;&nbsp;&nbsp;512</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: sub-page size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;256</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: VID header offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;256 (aligned 256)</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: data offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: empty MTD device detected</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: create volume table (copy #1)</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: create volume table (copy #2)</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: attached mtd1 to ubi0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: MTD device name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"mtd=3"</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: MTD device size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;261993005056 MiB</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: number of good PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3944</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: number of bad PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: max. allowed volumes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;92</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: wear-leveling threshold:&nbsp;&nbsp;&nbsp;&nbsp;4096</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: number of internal volumes: 1</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: number of user volumes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: available PEBs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3901</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: total number of reserved PEBs: 43</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: number of PEBs reserved for bad PEB handling: 39</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">UBI: max/mean erase counter: 1/0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">3</span>）创建<span style="font-family:'Times New Roman';">rootfs&nbsp;&nbsp;&nbsp;&nbsp;YH2440 # ubi create rootfs</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">YH2440 # ubi create rootfs</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Creating dynamic volume rootfs of size 61916672</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">4</span>）将文件系统下载到内存<span style="font-family:'Times New Roman';">&nbsp;tftp 0x32000000 ubifs.img</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">YH2440 # tftp ubifs.img</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">dm9000 i/o: 0x20000300, id: 0x90000a46</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">DM9000: running in 16 bit mode</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">MAC: 08:00:3e:26:0a:5b</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">could not establish link</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Using dm9000 device</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">TFTP from server 192.168.1.80; our IP address is 192.168.1.252</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Filename 'ubifs.img'.</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Load address: 0x32000000</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Loading: #################################################################</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#################################################################</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#################################################################</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;####################################</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">done</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Bytes transferred = 3380736 (339600 hex)</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">5</span>）将文件系统烧写到<span style="font-family:'Times New Roman';">rootfs&nbsp;</span>中<span style="font-family:'Times New Roman';">YH2440 # ubi write 0x32000000 rootfs 0x339600</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">YH2440 # ubi write 0x32000000 rootfs 0x339600</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Volume "rootfs" found at volume id 0</span></p> 
    <p>&nbsp;</p> 
    <p>之后启动就可以看到<span style="font-family:'Times New Roman';">UBIFS</span>可以运行了。</p> 
    <p><span style="font-family:'Times New Roman';">YH2440 # boot</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">NAND read: device 0 offset 0x60000, size 0x200000</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">&nbsp;2097152 bytes read: OK</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">## Starting application at 0x32000000 ...</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Uncompressing Linux............................................................................................................................... done, booting the kernel.</span></p> 
    <p><span style="font-family:'Times New Roman';">Linux version 2.6.30.4 (root@luoxiaotan.org) (gcc version 4.3.2 (Sourcery G++ Lite 2008q3-72) ) #11 Wed Jul 14 16:24:33 CST 2010</span></p> 
    <p><span style="font-family:'Times New Roman';">CPU: ARM920T [41129200] revision 0 (ARMv4T), cr=00007177</span></p> 
    <p><span style="font-family:'Times New Roman';">CPU: VIVT data cache, VIVT instruction cache</span></p> 
    <p><span style="font-family:'Times New Roman';">Machine: S3C2440</span></p> 
    <p><span style="font-family:'Times New Roman';">Warning: bad configuration page, trying to continue</span></p> 
    <p><span style="font-family:'Times New Roman';">Memory policy: ECC disabled, Data cache writeback</span></p> 
    <p><span style="font-family:'Times New Roman';">CPU S3C2440A (id 0x32440001)</span></p> 
    <p><span style="font-family:'Times New Roman';">S3C24XX Clocks, (c) 2004 Simtec Electronics</span></p> 
    <p><span style="font-family:'Times New Roman';">S3C244X: core 405.000 MHz, memory 101.250 MHz, peripheral 50.625 MHz</span></p> 
    <p><span style="font-family:'Times New Roman';">CLOCK: Slow mode (1.500 MHz), fast, MPLL on, UPLL on</span></p> 
    <p><span style="font-family:'Times New Roman';">Built 1 zonelists in Zone order, mobility grouping off.&nbsp;&nbsp;Total pages: 4064</span></p> 
    <p><span style="font-family:'Times New Roman';">Kernel command line: ubi.mtd=3 root=ubi0:rootfs rootfstype=ubifs console=ttySAC0 init=/linuxrc rw</span></p> 
    <p><span style="font-family:'Times New Roman';">NR_IRQS:85</span></p> 
    <p><span style="font-family:'Times New Roman';">irq: clearing subpending status 00000003</span></p> 
    <p><span style="font-family:'Times New Roman';">irq: clearing subpending status 00000002</span></p> 
    <p><span style="font-family:'Times New Roman';">PID hash table entries: 64 (order: 6, 256 bytes)</span></p> 
    <p><span style="font-family:'Times New Roman';">Console: colour dummy device 80x30</span></p> 
    <p><span style="font-family:'Times New Roman';">console [ttySAC0] enabled</span></p> 
    <p><span style="font-family:'Times New Roman';">Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)</span></p> 
    <p><span style="font-family:'Times New Roman';">Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)</span></p> 
    <p><span style="font-family:'Times New Roman';">Memory: 16MB = 16MB total</span></p> 
    <p><span style="font-family:'Times New Roman';">Memory: 12076KB available (3UBIFS: mounted UBI device 0, volume 0, name "rootfs"</span></p> 
    <p><span style="font-family:'Times New Roman';">UBIFS: file system size:&nbsp;&nbsp;&nbsp;61456384 bytes (60016 KiB, 58 MiB, 3872 LEBs)</span></p> 
    <p><span style="font-family:'Times New Roman';">UBIFS: journal size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8110592 bytes (7920 KiB, 7 MiB, 511 LEBs)</span></p> 
    <p><span style="font-family:'Times New Roman';">UBIFS: media format:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w4/r0 (latest is w4/r0)</span></p> 
    <p><span style="font-family:'Times New Roman';">UBIFS: default compressor: lzo</span></p> 
    <p><span style="font-family:'Times New Roman';">UBIFS: reserved for root:&nbsp;&nbsp;0 bytes (0 KiB)</span></p> 
    <p><span style="font-family:'Times New Roman';">VFS: Mounted root (ubifs filesystem) on device 253:1.</span></p> 
    <p><span style="font-family:'Times New Roman';">Freeing init memory: 120K</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">Please press Enter to activate this console.</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'Times New Roman';">BusyBox v1.13.3 (2010-07-13 08:51:35 CST) built-in shell (ash)</span></p> 
    <p><span style="font-family:'Times New Roman';">Enter 'help' for a list of built-in commands</span></p> 
    <p>&nbsp;</p> 
    <p>&nbsp;</p> 
    <p>===============================================================================</p> 
    <p>&nbsp;</p> 
    <p><a href="http://blog.csdn.net/ShowMan/archive/2010/03/17/5390868.aspx" rel="nofollow">http://blog.csdn.net/ShowMan/archive/2010/03/17/5390868.aspx</a></p> 
    <p>&nbsp;</p> 
    <div>
     2、ubifs
    </div> 
    <div>
     2.1、什么是ubifs？
    </div> 
    <div>
     由IBM、nokia工程师Thomas Gleixner，Artem Bityutskiy等人于2006年发起，致力于开发性能卓越、扩展性高的FLASH专用文件系统，以解决当前嵌入式环境下以FLASH作为MTD设备使用时的技术瓶颈。
     <br>关键字：
     <br>UBI：一种类似于LVM的
     <span style="color:#f000f0;">逻辑卷管理层</span>。主要实现损益均衡，逻辑擦除块、卷管理，坏块管理等。
     <br>UBIFS：基于UBI的
     <span style="color:#f000f0;">FLASH日志文件系统</span>。
     <br>有关ubifs的详细介绍，请参考：
     <br>http://www.linux-mtd.infradead.org/doc/ubi.html
     <br>http://www.linux-mtd.infradead.org/doc/ubifs.html
     <br>
     <br>2.2、如何得到ubifs？
     <br>2.6.22以后，ubifs活跃于git管理工程中：
     <br>git://git.infradead.org/ubi-2.6.git
     <br>2.6.27以后，ubifs
     <span style="color:#f000f0;"><strong>被整合进内核树</strong></span>中，用户只需下载最新内核即可获取ubifs支持。
     <br>
     <br>2.3、如何使用ubifs？
    </div> 
    <div>
     软件环境：
     <br>linux-2.6.28
     <br>arm-linux-gcc 3.4.5
     <br>硬件环境：
     <br>s3c2410
     <br>k9f1208
     <br>
     <br>2.4、准备
     <br>1、内核
     <br>配置的时候选上
     <br>1)Device Drivers&nbsp; ---&gt;Memory Technology Device (MTD) support&nbsp; ---&gt;UBI - Unsorted block images&nbsp; ---&gt;Enable UBI
     <br>2)File systems&nbsp; ---&gt;Miscellaneous filesystems&nbsp; ---&gt;UBIFS file system support
     <br>
     <br>2、mtd-utils工具(flash_eraseall、ubiattach、ubimkvol)准备
     <br>1)下载(mtd-utils、
     <span style="color:#f000f0;">zlib、lzo)</span>源码
     <br>wget http://debian.mirror.inra.fr/debian/pool/main/m/mtd-utils/mtd-utils_20080508.orig.tar.gz
     <br>wget http://www.zlib.net/zlib-1.2.3.tar.gz
     <br>wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.03.tar.gz
     <br>
     <br>2)编译安装zlib
     <br>tar xzvf zlib-1.2.3.tar.gz
     <br>cd zlib-1.2.3
     <br>CC=arm-linux-gcc ./configure --shared --prefix=/usr/local/arm/3.4.5/arm-linux
     <br>make
     <br>make install
     <br>cd ..
     <br>
     <br>3)编译安装lzo
     <br>tar xzvf lzo-2.03.tar.gz
     <br>cd lzo-2.03
     <br>CC=arm-linux-gcc ./configure --host=arm-linux --prefix=/usr/local/arm/3.4.5/arm-linux
     <br>make
     <br>make install
     <br>cd ..
     <br>
     <br>4)编译mtd-utils
     <br>tar xzvf mtd-utils_20080508.orig.tar.gz
     <br>cd mtd-utils-20080508
     <br>
     <br>修改Makefile文件：
     <br>#CROSS=arm-linux-
     <br>修改为&nbsp; CROSS=arm-linux-
     <br>BUILDDIR := $(CROSS:-=)
     <br>修改为&nbsp; BUILDDIR := .
     <br>
     <br>修改ubi-utils/Makefile文件：
     <br>添加&nbsp;&nbsp;&nbsp; CROSS=arm-linux-
     <br>
     <br>修改&nbsp;&nbsp;&nbsp; ubi-utils/new-utils/Makefile文件：
     <br>添加&nbsp;&nbsp;&nbsp; CROSS=arm-linux-
     <br>
     <br>make WITHOUT_XATTR=1
     <br>
     <br>ubi-utils子目录下生成我们需要的ubiattach、ubimkvol等文件(请确保是交叉编译所得)
     <br>
     <br>3、mtd-utils工具(mkfs.ubifs、ubinize)准备
     <br>git-clone git://git.infradead.org/mtd-utils.git
     <br>cd mtd-utils/
     <br>make
     <br>
     <br>mkfs.ubifs子目录下生成我们需要的mkfs.ubifs工具
     <br>ubi-utils/new-utils子目录下生成我们需要的ubinize工具
     <br>
     <br>
     <br>2.5、使用
     <br>1、使用ramfs或nfs启动系统，执行以下命令挂载ubifs：
     <br>1)flash_eraseall /dev/mtd4
     <br>2)ubiattach /dev/ubi_ctrl -m 4
     <br>3)ubimkvol /dev/ubi0 -N rootfs -s 50MiB
     <br>4)mount -t ubifs ubi0_0 /mnt或mount -t ubifs ubi0:rootfs /mnt
     <br>
     <br>2、如果你想使用ubifs为rootfs，把文件系统内容解压到ubifs挂载目录下，并修改内核启动参数为：
     <br>console=ttySAC0 ubi.mtd=4 root=ubi0:rootfs rootfstype=ubifs
     <br>
     <br>3、如果你想直接在bootloader下烧写ubifs映像，使用以下命令制作ubi烧写映像：
     <br>mkfs.ubifs -r rootfs -m 512 -e 15872 -c 3303 -o ubifs.img
     <br>ubinize -o ubi.img -m 512 -p 16KiB -s 256 ubinize.cfg
     <br>
     <br>其中：
     <br>1)以上命令的参数可从ubifs挂载信息中提取：
     <br>UBI: attaching mtd4 to ubi0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: physical eraseblock size:&nbsp;&nbsp; 16384 bytes (16 KiB)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: logical eraseblock size:&nbsp;&nbsp;&nbsp; 15872 bytes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: smallest flash I/O unit:&nbsp;&nbsp;&nbsp; 512&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: sub-page size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 256&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: VID header offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 256 (aligned 256)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: data offset:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 512&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>UBI: attached mtd4 to ubi0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <br>
     <br>2)配置文件ubinize.cfg的内容为：
     <br>[ubifs]
     <br>mode=ubi
     <br>image=ubifs.img
     <br>vol_id=0
     <br>vol_size=50MiB
     <br>vol_type=dynamic
     <br>vol_name=rootfs
     <br>vol_flags=autoresize
    </div> 
    <p>&nbsp;</p> 
   </div> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
