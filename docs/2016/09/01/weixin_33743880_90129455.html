<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>弥补学生时代的遗憾~C#注册表情缘 « NotBeCN</title>
  <meta name="description" content="             记得当时刚接触C#的时候，喜欢编写各种小软件，而注册表系列和网络系列被当时的我认为大牛的必备技能。直到我研究注册表前一天我都感觉他是那么的高深。    今天正好有空，于是就研究了下注册表系列的操作，也随手封装了一个注册表帮助类。简单记一下，当饭后娱乐    完整Demo研究：https:...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2016/09/01/weixin_33743880_90129455.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">弥补学生时代的遗憾~C#注册表情缘</h1>
    <p class="post-meta">Sep 1, 2016</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">记得当时刚接触C#的时候，喜欢编写各种小软件，而注册表系列和网络系列被当时的我认为大牛的必备技能。直到我研究注册表前一天我都感觉他是那么的高深。</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">今天正好有空，于是就研究了下注册表系列的操作，也随手封装了一个注册表帮助类。简单记一下，当饭后娱乐</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">完整Demo研究：<a href="https://github.com/dunitian/LoTCodeBase/tree/master/NetCode/0.%E7%9F%A5%E8%AF%86%E6%8B%93%E5%B1%95/02.%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%B3%BB" rel="nofollow" style="color:rgb(0,0,0);">https://github.com/dunitian/LoTCodeBase/tree/master/NetCode/0.知识拓展/02.注册表系</a></p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">这个是一些常用的方法和属性（不全，只是列出了比较常用的一些）【OpenSubKey(string name,bool b)当b为true则表示开了可写权限】</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"><img src="https://images2015.cnblogs.com/blog/658978/201607/658978-20160701191749734-1863967899.jpg" alt="" style="border:none;"></p> 
   <blockquote style="background:rgb(255,255,255) none;border-top:none;border-right:none;border-bottom:none;border-left:5px solid rgb(221,221,221);color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"> 
    <p style="color:rgb(119,119,119);">//RegistryKey<br> //属性：<br> // ValueCount 检索项中值的计数<br> // SubKeyCount 获取子项个数</p> 
    <p style="color:rgb(119,119,119);">//方法：<br> // OpenSubKey(string name,bool b) 获取子项 RegistryKey，b为true时代表可写<br> // GetSubKeyNames() 获取所有子项名称的字符串数组<br> // GetValueNames() 检索包含与此项关联的所有值名称的字符串数组<br> // GetValue(string name) 获取指定名称,不存在名称/值对，则返回 null<br> // CreateSubKey(string subkey) 创建或者打开子项的名称或路径<br> // SetValue(string name,object value) 创建或者打开子项的名称或路径<br> // DeleteSubKeyTree(string subkey) 递归删除指定目录，不存在则抛异常<br> // DeleteSubKey(string subkey,bool b) 删除子项，b为false则当子项不存在时不抛异常<br> // DeleteValue(string name,bool b) 删除指定的键值，b为false则当子项不存在时不抛异常</p> 
   </blockquote> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">先举个简单的案例：</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"><img src="https://images2015.cnblogs.com/blog/658978/201607/658978-20160701191809796-41233013.jpg" alt="" style="border:none;"></p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"><img src="https://images2015.cnblogs.com/blog/658978/201607/658978-20160701191758702-1998000212.jpg" alt="" style="border:none;"></p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">代码如下：</p> 
   <div class="cnblogs_Highlighter" style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">
    <pre><code class="language-csharp">//获取一个表示HKLM键的RegistryKey
            RegistryKey rk = Registry.LocalMachine;

            //打开HKLM的子项Software
            RegistryKey subKey = rk.OpenSubKey(@"software");

            //遍历所有子项名称的字符串数组
            foreach (var item in subKey.GetSubKeyNames())
            {
                //以只读方式检索子项
                RegistryKey sonKey = subKey.OpenSubKey(item);

                rtxt.AppendText(string.Format("\n---&gt;{0}&lt;---\nSubKeyCount：{1} ValueCount：{2} FullName：{3}\n==================================\n", item, sonKey.SubKeyCount, sonKey.ValueCount, sonKey.Name));

                //检索包含与此项关联的所有值名称的字符串数组
                foreach (var name in sonKey.GetValueNames())
                {
                    rtxt.AppendText(string.Format("Name：{0} Value：{1} Type：{2}\n", name, sonKey.GetValue(name), sonKey.GetValueKind(name)));
                }
            }
</code></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">&nbsp;做个综合的案例：</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"><img src="https://images2015.cnblogs.com/blog/658978/201607/658978-20160701193140624-1470084434.jpg" alt="" style="border:none;"></p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">代码如下：</p> 
   <div class="cnblogs_Highlighter" style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">
    <pre><code class="language-csharp">public partial class MainForm : Form
    {
        public RegistryKey Reg { get; set; }
        public MainForm()
        {
            InitializeComponent();
            //初始化
            var rootReg = Registry.LocalMachine;
            Reg = rootReg.OpenSubKey("software", true);//开权限
        }

        #region 公用方法
        /// &lt;summary&gt;
        /// 检验是否为空
        /// &lt;/summary&gt;
        /// &lt;param name="dntReg"&gt;&lt;/param&gt;
        private bool KeyIsNull(RegistryKey dntReg)
        {
            if (dntReg == null)
            {
                rtxt.AppendText("注册表中没有dnt注册项\n");
                return true;
            }
            return false;
        }

        /// &lt;summary&gt;
        /// 遍历Key的Value
        /// &lt;/summary&gt;
        /// &lt;param name="reg"&gt;&lt;/param&gt;
        private void ForeachRegKeys(RegistryKey reg)
        {
            rtxt.AppendText(string.Format("\n SubKeyCount：{0} ValueCount：{1} FullName：{2}\n", reg.SubKeyCount, reg.ValueCount, reg.Name));
            foreach (var name in reg.GetValueNames())
            {
                rtxt.AppendText(string.Format("Name：{0} Value：{1} Type：{2}\n", name, reg.GetValue(name), reg.GetValueKind(name)));
            }
        }
        #endregion

        //查
        private void btn1_Click(object sender, EventArgs e)
        {
            var dntReg = Reg.OpenSubKey("dnt");
            if (KeyIsNull(dntReg)) return;
            ForeachRegKeys(dntReg);
            foreach (var item in dntReg.GetSubKeyNames())
            {
                //以只读方式检索子项
                RegistryKey sonKey = dntReg.OpenSubKey(item);
                ForeachRegKeys(sonKey);
            }
        }

        //增
        private void btn2_Click(object sender, EventArgs e)
        {
            var dntReg = Reg.CreateSubKey("dnt");
            dntReg.SetValue("web", "http://www.dkill.net");
            var sonReg = dntReg.CreateSubKey("path");
            sonReg.SetValue("value", "D:\\Program Files\\dnt");
            rtxt.AppendText("添加成功\n");
        }

        //改
        private void btn3_Click(object sender, EventArgs e)
        {
            var dntReg = Reg.OpenSubKey("dnt", true);
            if (KeyIsNull(dntReg)) return;
            dntReg.SetValue("web", "http://dnt.dkill.net");
            rtxt.AppendText("修改成功\n");
        }

        //删
        private void btn4_Click(object sender, EventArgs e)
        {
            try
            {
                #region 删除某个值
                //var dntReg = Reg.OpenSubKey("dnt", true);
                //if (KeyIsNull(dntReg)) return;
                //dntReg.DeleteValue("web", false);
                #endregion
                Reg.DeleteSubKeyTree("dnt", false);
                rtxt.AppendText("删除成功\n");
            }
            catch (ArgumentException ex)
            {
                rtxt.AppendText(ex.ToString());
            }
        }

        private void clearlog_Click(object sender, EventArgs e)
        {
            rtxt.Clear();
        }
    }
</code></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">Helper类综合实战：（有其他演示，有的电脑会出现权限问题）</p> 
   <p style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/658978/201607/658978-20160701193356468-574359906.jpg" alt="" style="border:none;"></p> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-csharp">using Microsoft.Win32;
using System.Collections.Generic;

public static partial class RegistryHelper
{
    #region 节点
    /// &lt;summary&gt;
    /// HKEY_LOCAL_MACHINE 节点
    /// &lt;/summary&gt;
    public static RegistryKey RootReg = Registry.LocalMachine;

    /// &lt;summary&gt;
    /// HKEY_LOCAL_MACHINE 下 Software 节点
    /// &lt;/summary&gt;
    public static RegistryKey SoftReg = Registry.LocalMachine.OpenSubKey("software", true);

    /// &lt;summary&gt;
    /// 包含有关当前用户首选项的信息。该字段读取 Windows 注册表基项 HKEY_CURRENT_USER
    /// &lt;/summary&gt;
    public static RegistryKey CurrentUser = Registry.CurrentUser;

    /// &lt;summary&gt;
    /// HKEY_CURRENT_USER 下 Software 节点
    /// &lt;/summary&gt;
    public static RegistryKey UserSoftReg = Registry.CurrentUser.OpenSubKey("software", true);
    #endregion

    #region 查询
    /// &lt;summary&gt;
    /// 根据名称查找Key，有则返回RegistryKey对象，没有则返回null
    /// &lt;/summary&gt;
    /// &lt;param name="name"&gt;要打开的子项的名称或路径&lt;/param&gt;
    /// &lt;param name="b"&gt;如果不需要写入权限请选择false&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey FindKey(this RegistryKey reg, string name, bool b = true)
    {
        return reg.OpenSubKey(name, b);
    }

    /// &lt;summary&gt;
    /// 获取（name，value）字典，没有则返回null
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;当前RegistryKey&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static IDictionary&lt;string, object&gt; GetKeyValueDic(this RegistryKey reg)
    {
        var dic = new Dictionary&lt;string, object&gt;();
        if (reg.ValueCount == 0) { return null; }
        ForeachRegKeys(reg, ref dic);
        return dic;
    }

    /// &lt;summary&gt;
    /// 获取子项（name，value）字典，没有则返回null
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;当前RegistryKey&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static IDictionary&lt;string, object&gt; GetSubKeyValueDic(this RegistryKey reg)
    {
        var dic = new Dictionary&lt;string, object&gt;();
        if (reg.SubKeyCount == 0) { return null; }
        foreach (var item in reg.GetSubKeyNames())
        {
            //以只读方式检索子项
            var sonKey = reg.OpenSubKey(item);
            ForeachRegKeys(sonKey, ref dic);
        }
        return dic;
    }

    /// &lt;summary&gt;
    /// 遍历RegistryKey
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;&lt;/param&gt;
    /// &lt;param name="dic"&gt;&lt;/param&gt;
    private static void ForeachRegKeys(RegistryKey reg, ref Dictionary&lt;string, object&gt; dic)
    {
        foreach (var name in reg.GetValueNames())
        {
            dic.Add(name, reg.GetValue(name));
        }
    }
    #endregion

    #region 添加
    /// &lt;summary&gt;
    /// 添加一个子项
    /// &lt;/summary&gt;
    /// &lt;param name="name"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey AddSubItem(this RegistryKey reg, string name)
    {
        return reg.CreateSubKey(name);
    }

    /// &lt;summary&gt;
    /// 添加key-value，异常则RegistryKey对象返回null
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;&lt;/param&gt;
    /// &lt;param name="key"&gt;&lt;/param&gt;
    /// &lt;param name="value"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey AddKeyValue(this RegistryKey reg, string key, object value)
    {
        reg.SetValue(key, value);
        return reg;
    }
    #endregion

    #region 修改
    /// &lt;summary&gt;
    /// 修改key-value，异常则RegistryKey对象返回null
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;&lt;/param&gt;
    /// &lt;param name="key"&gt;&lt;/param&gt;
    /// &lt;param name="value"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey UpdateKeyValue(this RegistryKey reg, string key, object value)
    {
        return reg.AddKeyValue(key, value);
    }
    #endregion

    #region 删除
    /// &lt;summary&gt;
    /// 根据Key删除项
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;&lt;/param&gt;
    /// &lt;param name="key"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey DeleteKeyValue(this RegistryKey reg, string key)
    {
        reg.DeleteValue(key, false);
        return reg;
    }

    /// &lt;summary&gt;
    /// 删除子项所有内容
    /// &lt;/summary&gt;
    /// &lt;param name="reg"&gt;&lt;/param&gt;
    /// &lt;param name="key"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static RegistryKey ClearSubAll(this RegistryKey reg, string key)
    {
        reg.DeleteSubKeyTree(key, false);
        return reg;
    }
    #endregion
}</code></pre> 
    <pre><code class="language-csharp"><br></code></pre> 
    <pre><code class="language-csharp">，如需转载请自行联系原作者</code></pre> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
