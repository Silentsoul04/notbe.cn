<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>如何让你的程序运行的更快(1)之续---揭秘StringBuffer的capacity « NotBeCN</title>
  <meta name="description" content="             前几天写了一篇文章“&nbsp;如何让你的程序运行的更快(1)---String&nbsp;VS&nbsp;StringBuffer&nbsp;”，文章在情景三中提到了如何通过“设置StringBuffer的容量来提升性能”，其中有个问题我没有想明白，就是为什么StringBuffer的...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2018/01/15/weixin_33935777_90135806.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">如何让你的程序运行的更快(1)之续---揭秘StringBuffer的capacity</h1>
    <p class="post-meta">Jan 15, 2018</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>前几天写了一篇文章“&nbsp;</font><a href="http://www.blogjava.net/majianan/archive/2006/09/14/69706.html" rel="nofollow" style="color:rgb(67,113,166);"><font><font><font color="#0000ff">如何让你的程序运行的更快(1)---String&nbsp;<font color="#ff0000">VS</font>&nbsp;StringBuffer</font>&nbsp;</font></font></a><font>”，文章在情景三中提到了如何通过“设置StringBuffer的容量来提升性能”，其中有个问题我没有想明白，就是<font color="#ff0000">为什么</font><font color="#ff0000">StringBuffer的容量自动增加的时候是“2*旧值+2”呢</font><font color="#ff0000">？</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>虽然问题依然没有解决，不过也发现了不少有趣的问题，在此和大家分享 。希望能让你有所收获，欢迎大家一起讨论。&nbsp;<br></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>注：需要用到的函数说明：<br> capacity()：Returns the current capacity of the String buffer.&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The capacity is the amount of storage available for newly inserted characters;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beyond which an allocation will occur.<br> length()：&nbsp;&nbsp;&nbsp;Returns the length (character count) of this string buffer.</font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font>&nbsp;</p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">一.StringBuffer的默认capacity<br></font>例1：</font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,0);">StringBuffer&nbsp;sb&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer();<br></span><span style="color:rgb(0,0,0);">System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">with&nbsp;no&nbsp;characters,&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb.capacity());<br></span><span style="color:rgb(0,0,0);">System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">and&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;sb.length());</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font color="#0000ff">输出：</font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,0);">with&nbsp;no&nbsp;characters,&nbsp;the&nbsp;initial&nbsp;capacity&nbsp;of&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">16</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><br><font>and&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;StringBuffer&nbsp;is&nbsp;&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><font>0</font></span> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">结论：&nbsp;</font>StringBuffer的默认容量(capacity)为16</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">原因：<br></font>StringBuffer的默认构造函数为</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <span style="color:rgb(0,0,255);"><font>public&nbsp;</font></span>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;StringBuffer()&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">this</span>&nbsp;<span style="color:rgb(0,0,0);">(</span>&nbsp;<span style="color:rgb(0,0,0);">16</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;);<br> }&nbsp;</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>此时默认构造函数又调用了StringBuffer的代参数的构造函数，设置字符串数组value长度为16，如下：</font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,255);">private</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">char</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;value[];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,128,0);">//</span><span style="color:rgb(0,128,0);">The&nbsp;value&nbsp;is&nbsp;used&nbsp;for&nbsp;character&nbsp;storage.</span></font>&nbsp;</font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,255);">private</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">boolean</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;shared;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">A&nbsp;flag&nbsp;indicating&nbsp;whether&nbsp;the&nbsp;buffer&nbsp;is&nbsp;shared</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);"><br></span>
    <font><font><span style="color:rgb(0,0,255);">public</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;StringBuffer(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;length)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">char</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">[length];<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shared&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">false</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">;<br> }<br> &nbsp;<br></span><span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">调用capacity()返回字符串数组value的长度,即StringBuffer的容量(capacity)</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,255);">public</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">synchronized</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;capacity()&nbsp;{<br></span><span style="color:rgb(0,0,255);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><font>&nbsp;value.length;<br> }</font></span> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">二.用字符串初始化StringBuffer的内容</font><br> 在声明一个StringBuffer变量的时候，用字符串进行初始化，容量会有变化么？</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>例2：</font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">声明并初始化</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,0);">StringBuffer&nbsp;sb1&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;StringBuffer(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">hello&nbsp;world</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;);<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">with&nbsp;characters,&nbsp;the&nbsp;capacity&nbsp;of&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;sb1.capacity());<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">but&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb1.length());&nbsp;<br><img src="http://www.blogjava.net/Images/OutliningIndicators/None.gif" align="top" alt="None.gif"><br></span><span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">利用append()来设置StringBuffer的内容</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,0);">StringBuffer&nbsp;sb11&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer();<br> sb11.append(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">hello&nbsp;world</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">);<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">with&nbsp;append(),&nbsp;the&nbsp;capacity&nbsp;of&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb11.capacity());<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">but&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;StringBuffer&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;sb11.length());</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>两者输出结果会一样么？<br> 你一定认为，这不是显然的么。用长度为11的字符串“hello world”进行初始化，其长度11小于StringBuffer的默认容量16。所以两者结果都为capacity=16，length=11。<br> 那么实际结果如何呢？</font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font color="#0000ff">输出：</font><font color="#0000ff"></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;">
    <font><font><span style="color:rgb(0,0,0);">with characters, the capacity of StringBuffer is 27<br> but the length of the StringBuffer is 11<br> with append(), the capacity of StringBuffer is 16<br> but the length of the StringBuffer is 11</span><span style="color:rgb(0,0,0);"></span></font></font>
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">疑问：</font>&nbsp;<br> 怎么第一种方法的StringBuffer的capacity是27(16+11)呢？&nbsp;<br><br><font color="#0000ff">原因：&nbsp;</font><br> StringBuffer的带参数的构造函数</font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,128,128);">1</span>&nbsp;<span style="color:rgb(0,0,255);">public</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer(String&nbsp;str)&nbsp;{<br></span><span style="color:rgb(0,128,128);">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,0);"></span><span style="color:rgb(0,0,255);">this</span><span style="color:rgb(0,0,0);">(str.length()&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">16</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">append(str);<br></span><span style="color:rgb(0,128,128);">4</span>&nbsp;<span style="color:rgb(0,0,0);">}</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">结论：</font>&nbsp;</font></font><strong><br></strong><font>StringBuffer的capacity等于用来初始化的字符串长度(11)加上StringBuffer的默认容量(16)，而不是我们想当然的在默认容量16中拿出11个来存放字符串“hello world”。<br> 如果我们不设置StringBuffer的capacity，分别对两者继续追加字符串，任其自动增长，其容量增长如下：<br> 第一种情况：27，56，114，230，462，926...，<br> 第二种情况：16，34，70&nbsp; ，142，286，574...，<br> (为什么容量增加会是这种规律，后面会做解释)。<br> 我想情况2节省空间的概率大一些，因为StringBuffer的capacity的增长比情况1慢，每次增加的空间小一些。<br> 所以以后写代码的时候可以考虑使用第二种方法(使用StringBuffer的append())，特别是初始化字符串很长的情况。当然这会多写一行代码^+^：&nbsp;<br><font color="#0000ff">三.StringBuffer的capacity变化</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>例3：<br></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,0);">StringBuffer&nbsp;sb3&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer();<br></span><span style="color:rgb(0,0,255);">for</span>&nbsp;<span style="color:rgb(0,0,0);">(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">&lt;</span>&nbsp;<span style="color:rgb(0,0,0);">12</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">++</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb3.append(i);<br> }<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">before&nbsp;changed,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb3.capacity());<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">and&nbsp;the&nbsp;length&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb3.length());&nbsp;<br><br></span><span style="color:rgb(0,0,255);">for</span>&nbsp;<span style="color:rgb(0,0,0);">(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">&lt;</span>&nbsp;<span style="color:rgb(0,0,0);">10</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">++</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb3.append(i);<br> }<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">first&nbsp;time&nbsp;increased,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb3.capacity());<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">and&nbsp;the&nbsp;length&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb3.length());&nbsp;<br><br></span><span style="color:rgb(0,0,255);">for</span>&nbsp;<span style="color:rgb(0,0,0);">(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">&lt;</span>&nbsp;<span style="color:rgb(0,0,0);">11</span>&nbsp;<span style="color:rgb(0,0,0);">;&nbsp;i</span>&nbsp;<span style="color:rgb(0,0,0);">++</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb3.append(i);<br> }<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">second&nbsp;time&nbsp;increased,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb3.capacity());<br> System.out.println(</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">and&nbsp;the&nbsp;length&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">"</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><font>&nbsp;sb3.length());&nbsp;<br></font></span> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font color="#0000ff">输出：</font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,0);">before&nbsp;changed,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">16</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><br><font>and&nbsp;the&nbsp;length&nbsp;is&nbsp;&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><font>14&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><br><font>first&nbsp;time&nbsp;increased,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><font>34&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><br><font>and&nbsp;the&nbsp;length&nbsp;is&nbsp;&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><font>24&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><br><font>second&nbsp;time&nbsp;increased,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><font>70&nbsp;</font></span>
    <span style="color:rgb(0,0,0);"><br><font>and&nbsp;the&nbsp;length&nbsp;is&nbsp;&nbsp;</font></span>
    <font><font><span style="color:rgb(0,0,0);">36&nbsp;</span><span style="color:rgb(0,0,0);">&nbsp;</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>奇怪，benfore changed怎么长度不是12而是14呢？哈哈，开始我也困惑了一下，仔细想想就会明白的，你可以输出sb3看看System.out.println("the content of sb3 is " + sb3.toString());</font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">结论：&nbsp;<br></font>capacity增长的规律为&nbsp;<u><font color="#ff0000">(旧值+1)*2</font></u><u></u></font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">原因：<br></font>StringBuffer的容量增加函数expandCapacity()：<br></font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,255);">private</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">void</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;expandCapacity(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;minimumCapacity)&nbsp;{<br></span><span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(value.length&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">1</span>&nbsp;<span style="color:rgb(0,0,0);">)&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">*</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">2</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">;<br></span><span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&lt;</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;Integer.MAX_VALUE;<br> }&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">else</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(minimumCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&gt;</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;newCapacity)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;minimumCapacity;<br> }<br> &nbsp;<br></span><span style="color:rgb(0,0,255);">char</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;newValue[]&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">char</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">[newCapacity];<br> System.arraycopy(value,&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;<span style="color:rgb(0,0,0);">,&nbsp;newValue,&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">,&nbsp;count);<br> value&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;newValue;<br> shared&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">false</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">;<br> }&nbsp;</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">疑问：</font>&nbsp;<br> 为什么要(旧值+1)*2呢？<br></font></font><font color="#0000ff">我自己的想法：<br></font><font><font><font color="#000000">也许是考虑到value.length的值可能为0(初始化时设置StringBuffer的capactity为0).<br> 或者考虑到溢出的情况？<br> 但是可能是JVM的某些限制，我的机器数组最大可以设置为30931306，再大就报错：<br><font color="#ff0000">Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</font></font><br> 30931306这个数字好奇怪<br> 还有哪方面的考虑么？谁知道，能告诉我么？<br><font color="#0000ff">四.StringBuffer的capacity只能大不能小</font><br> 例5：</font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,128,128);">&nbsp;1</span>&nbsp;<span style="color:rgb(0,0,0);">StringBuffer&nbsp;sb4&nbsp;</span><span style="color:rgb(0,0,0);">=</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,255);">new</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer();<br></span><span style="color:rgb(0,128,128);">&nbsp;2</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.println(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">before&nbsp;ensureCapacity(),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity());<br></span><span style="color:rgb(0,128,128);">&nbsp;3</span>&nbsp;<span style="color:rgb(0,0,0);">sb4.ensureCapacity(</span><span style="color:rgb(0,0,0);">10</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">&nbsp;4</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.println(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">after&nbsp;ensureCapacity(10),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity());<br></span><span style="color:rgb(0,128,128);">&nbsp;5</span>&nbsp;&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span style="color:rgb(0,128,128);">&nbsp;6</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.print(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">now,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity()&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">,&nbsp;</span><span style="color:rgb(0,0,0);">"</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">&nbsp;7</span>&nbsp;<span style="color:rgb(0,0,0);">sb4.ensureCapacity(</span><span style="color:rgb(0,0,0);">20</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">&nbsp;8</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.println(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">after&nbsp;ensureCapacity(20),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity());<br></span><span style="color:rgb(0,128,128);">&nbsp;9</span>&nbsp;&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span style="color:rgb(0,128,128);">10</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.print(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">now,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity()&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">,&nbsp;</span><span style="color:rgb(0,0,0);">"</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">11</span>&nbsp;<span style="color:rgb(0,0,0);">sb4.ensureCapacity(</span><span style="color:rgb(0,0,0);">80</span></font>&nbsp;</font>
    <font><font><span style="color:rgb(0,0,0);">);<br></span><span style="color:rgb(0,128,128);">12</span>&nbsp;<span style="color:rgb(0,0,0);">System.out.println(</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">after&nbsp;ensureCapacity(80),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span><span style="color:rgb(0,0,0);">"</span><span style="color:rgb(0,0,0);">&nbsp;</span><span style="color:rgb(0,0,0);">+</span><span style="color:rgb(0,0,0);">&nbsp;sb4.capacity());</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">输出：</font></font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,0);">before&nbsp;ensureCapacity(),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">16</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><br><font>after&nbsp;ensureCapacity(&nbsp;</font></span>
    <font><font><span style="color:rgb(0,0,0);">10</span>&nbsp;<span style="color:rgb(0,0,0);">),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">16</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><br><font>now,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;&nbsp;</font></span>
    <font><font><span style="color:rgb(0,0,0);">16</span>&nbsp;<span style="color:rgb(0,0,0);">,&nbsp;after&nbsp;ensureCapacity(</span>&nbsp;<span style="color:rgb(0,0,0);">20</span>&nbsp;<span style="color:rgb(0,0,0);">),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">34</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><br><font>now,&nbsp;the&nbsp;capacity&nbsp;is&nbsp;&nbsp;</font></span>
    <font><font><span style="color:rgb(0,0,0);">34</span>&nbsp;<span style="color:rgb(0,0,0);">,&nbsp;after&nbsp;ensureCapacity(</span>&nbsp;<span style="color:rgb(0,0,0);">80</span>&nbsp;<span style="color:rgb(0,0,0);">),&nbsp;the&nbsp;capacity&nbsp;is&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">80</span></font></font> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">结论：<br><font color="#000000">当设置StringBuffer的容量</font><br></font>1、小于当前容量时，容量不变。<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本例中，容量依然为16。<br> 2、大于当前容量，并且小于(当前容量+1)*2，则容量变为(当前容量+1)*2。<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本例中，16&lt;20&lt;(16+1)*2=34，所以容量为34。<br> 3、大于当前容量，并且大于(当前容量+1)*2，则容量变为用户所设置的容量。<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本例中，80&gt;16，80&gt;(16+1)*2=34，所以容量为80。<br><br></font></font><font><font><font color="#0000ff">原因：<br></font>函数：ensureCapacity( )和 expandCapacity( )进行了控制</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,255);">public</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">synchronized</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">void</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;ensureCapacity(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;minimumCapacity)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(minimumCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&gt;</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;value.length)&nbsp;{<br></span><span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">当设置StringBuffer的容量小于当前容量时，容量不变。</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expandCapacity(minimumCapacity);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> }<br><br></span><span style="color:rgb(0,0,255);">private</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">void</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;expandCapacity(</span>&nbsp;<span style="color:rgb(0,0,255);">int</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;minimumCapacity)&nbsp;{<br></span><span style="color:rgb(0,0,255);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(value.length&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">1</span>&nbsp;<span style="color:rgb(0,0,0);">)&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">*</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">2</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">;<br></span><span style="color:rgb(0,0,255);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&lt;</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;Integer.MAX_VALUE;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">else</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(minimumCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&gt;</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;newCapacity)&nbsp;{<br></span><span style="color:rgb(0,128,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,128,0);">当设置StringBuffer的容量大于(当前容量+1)*2，则容量变为用户所设置的容量。<br></span><span style="color:rgb(0,128,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span>&nbsp;<span style="color:rgb(0,128,0);">否则，容量为(当前容量+1)*2，即newCapacity</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newCapacity&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;minimumCapacity;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;<br></span><span style="color:rgb(0,0,255);">char</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;newValue[]&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">new</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">char</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">[newCapacity];<br> System.arraycopy(value,&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;<span style="color:rgb(0,0,0);">,&nbsp;newValue,&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">,&nbsp;count);<br> value&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;newValue;<br> shared&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">false</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">;<br> }&nbsp;</span></font></font>
    <span style="font-family:Verdana;font-size:small;">&nbsp;</span>
    <span style="font-family:Verdana;font-size:small;">&nbsp;</span> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font><font><font color="#0000ff">注：<br></font>问一下<br> String str = String.valueOf(null);<br> System.out.println(str.length());</font></font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>你们执行的话会出错么？<br> 我的报错，我的是jdk1.4</font></p> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font>因为StringBuffer中的append(String str)函数中有这样的语句，<br></font></p> 
   <div style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;border-width:1px;border-style:solid;"> 
    <font><font><span style="color:rgb(0,0,255);">public</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">synchronized</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;StringBuffer&nbsp;append(String&nbsp;str)&nbsp;{<br></span><span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(str&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">==</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">null</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">)&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;String.valueOf(str);<br> }<br><br></span><span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;len&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;str.length();</span>&nbsp;<span style="color:rgb(0,128,0);">//</span>&nbsp;<span style="color:rgb(0,128,0);">len有可能得负值么？</span>&nbsp;</font></font>
    <span style="color:rgb(0,128,0);"><br></span>
    <font><font><span style="color:rgb(0,0,255);">int</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;newcount&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;count&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">+</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;len;<br></span><span style="color:rgb(0,0,255);">if</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;(newcount&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">&gt;</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;value.length)<br> expandCapacity(newcount);<br> str.getChars(</span>&nbsp;<span style="color:rgb(0,0,0);">0</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">,&nbsp;len,&nbsp;value,&nbsp;count);<br> count&nbsp;</span>&nbsp;<span style="color:rgb(0,0,0);">=</span>&nbsp;</font></font>
    <font><font><span style="color:rgb(0,0,0);">&nbsp;newcount;<br></span><span style="color:rgb(0,0,255);">return</span>&nbsp;<span style="color:rgb(0,0,0);">&nbsp;</span>&nbsp;<span style="color:rgb(0,0,255);">this</span>&nbsp;</font></font>
    <span style="color:rgb(0,0,0);"><font>;<br> }&nbsp;<br></font></span> 
   </div> 
   <p style="color:rgb(75,75,75);font-family:georgia, verdana, Arial, helvetica, 'sans-seriff';font-size:13px;"><font></font>&nbsp;本文转自BlogJavaOo缘来是你oO的博客，原文链接：<a href="http://www.blogjava.net/majianan/archive/2006/09/20/70493.html" rel="nofollow" title="如何让你的程序运行的更快(1)之续---揭秘StringBuffer的capacity">如何让你的程序运行的更快(1)之续---揭秘StringBuffer的capacity</a>，如需转载请自行联系原博主。</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
