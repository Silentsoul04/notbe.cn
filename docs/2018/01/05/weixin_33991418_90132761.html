<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>#pragma指令的用法 « NotBeCN</title>
  <meta name="description" content="             在所有的预处理指令中，#Pragma 指令可能是最复杂的了，它的作用是设定编译器的状态或者是指示编译器完成一些特定的动作。#pragma指令对每个编译器给出了一个方法,在保持与C和C++语言完全兼容的情况下,给出主机或操作系统专有的特征。依据定义,编译指示是机器或操作系统专有的,且对于每...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2018/01/05/weixin_33991418_90132761.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">#pragma指令的用法</h1>
    <p class="post-meta">Jan 5, 2018</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:18px;letter-spacing:-1px;background-image:url(&quot;images/dotsH.gif&quot;);background-position:left bottom;background-repeat:repeat-x;font-weight:normal;line-height:21.6px;color:rgb(51,51,51);font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';">在所有的预处理指令中，#Pragma 指令可能是最复杂的了，它的作用是设定编译器的状态或者是指示编译器完成一些特定的动作。#pragma指令对每个编译器给出了一个方法,在保持与C和C++语言完全兼容的情况下,给出主机或操作系统专有的特征。依据定义,编译指示是机器或操作系统专有的,且对于每个编译器都是不同的。&nbsp;<br></h2> 
   <div class="entry" style="line-height:1.8;"> 
    <div class="blogpost-body" style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">其格式一般为: #Pragma Para&nbsp;<br> 其中Para 为参数，下面来看一些常用的参数。&nbsp;<br><br> (1)message 参数。 Message 参数是我最喜欢的一个参数，它能够在编译信息输出窗&nbsp;<br> 口中输出相应的信息，这对于源代码信息的控制是非常重要的。其使用方法为：&nbsp;<br> #Pragma message(“消息文本”)&nbsp;<br> 当编译器遇到这条指令时就在编译输出窗口中将消息文本打印出来。&nbsp;<br> 当我们在程序中定义了许多宏来控制源代码版本的时候，我们自己有可能都会忘记有没有正确的设置这些宏，此时我们可以用这条指令在编译的时候就进行检查。假设我们希望判断自己有没有在源代码的什么地方定义了_X86这个宏可以用下面的方法&nbsp;<br> #ifdef _X86&nbsp;<br> #Pragma message(“_X86 macro activated!”)&nbsp;<br> #endif&nbsp;<br> 当我们定义了_X86这个宏以后，应用程序在编译时就会在编译输出窗口里显示“_&nbsp;<br> X86 macro activated!”。我们就不会因为不记得自己定义的一些特定的宏而抓耳挠腮了&nbsp;<br> 。&nbsp;<br><br> (2)另一个使用得比较多的pragma参数是code_seg。格式如：&nbsp;<br> #pragma code_seg( ["section-name"[,"section-class"] ] )&nbsp;<br> 它能够设置程序中函数代码存放的代码段，当我们开发驱动程序的时候就会使用到它。&nbsp;<br><br> (3)#pragma once (比较常用）&nbsp;<br> 只要在头文件的最开始加入这条指令就能够保证头文件被编译一次，这条指令实际上在VC6中就已经有了，但是考虑到兼容性并没有太多的使用它。&nbsp;<br><br> (4)#pragma hdrstop表示预编译头文件到此为止，后面的头文件不进行预编译。BCB可以预编译头文件以加快链接的速度，但如果所有头文件都进行预编译又可能占太多磁盘空间，所以使用这个选项排除一些头文件。&nbsp;<br> 有时单元之间有依赖关系，比如单元A依赖单元B，所以单元B要先于单元A编译。你可以用#pragma startup指定编译优先级，如果使用了#pragma package(smart_init) ，BCB就会根据优先级的大小先后编译。&nbsp;<br><br> (5)#pragma resource "*.dfm"表示把*.dfm文件中的资源加入工程。*.dfm中包括窗体&nbsp;<br> 外观的定义。&nbsp;<br><br> (6)#pragma warning( disable : 4507 34; once : 4385; error : 164 )&nbsp;<br> 等价于：&nbsp;<br> #pragma warning(disable:4507 34) // 不显示4507和34号警告信息&nbsp;<br> #pragma warning(once:4385) // 4385号警告信息仅报告一次&nbsp;<br> #pragma warning(error:164) // 把164号警告信息作为一个错误。&nbsp;<br> 同时这个pragma warning 也支持如下格式：&nbsp;<br> #pragma warning( push [ ,n ] )&nbsp;<br> #pragma warning( pop )&nbsp;<br> 这里n代表一个警告等级(1---4)。&nbsp;<br> #pragma warning( push )保存所有警告信息的现有的警告状态。&nbsp;<br> #pragma warning( push, n)保存所有警告信息的现有的警告状态，并且把全局警告&nbsp;<br> 等级设定为n。&nbsp;<br> #pragma warning( pop )向栈中弹出最后一个警告信息，在入栈和出栈之间所作的&nbsp;<br> 一切改动取消。例如：&nbsp;<br> #pragma warning( push )&nbsp;<br> #pragma warning( disable : 4705 )&nbsp;<br> #pragma warning( disable : 4706 )&nbsp;<br> #pragma warning( disable : 4707 )&nbsp;<br> //.......&nbsp;<br> #pragma warning( pop )&nbsp;<br> 在这段代码的最后，重新保存所有的警告信息(包括4705，4706和4707)。&nbsp;<br> （7）pragma comment(...)&nbsp;<br> 该指令将一个注释记录放入一个对象文件或可执行文件中。&nbsp;<br> 常用的lib关键字，可以帮我们连入一个库文件。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">＃pragma pack(1) 作用</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">主要用来设置结构定义的字节对齐方式，比如是单字节对齐，双字节对齐等，比如如果是双字节对齐，那么结构的成员变量的地址必须是2的整数倍，这就造成了字节补齐，但是提高了访问速度。单字节呢，就是没有补齐，成员变量的地址是连续的，其他依次类推，通常是4，8等。通常用于网络传输数据，特别是传输整个结构时，必须采取单字节对齐，这样才可以直接把结构地址，以及结构长度，作为Send的参数发送整个结构，否则只能依次发送结构的成员，要不然会出现结构解释的差异。&nbsp;<br><br> 另外，在Project－&gt;Setting-&gt;C/C++-&gt;Code Generation-&gt;Struct member alignment中可以设置结构的对齐方式。&nbsp;&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">传输结构时和pack无关，只要Recv端定义的结构和Send方一样就没问题了。&nbsp;<br> pack多用于Hook程序，比如Hook Api技术，因为需要硬编码，所以必须将结构&nbsp;<br> 压缩，将内容补齐！&nbsp;<br> 比如：&nbsp;<br> ASM_STRUCT{&nbsp;<br> BYTE bJmp;&nbsp;<br> DWORD dwDes;&nbsp;<br> }a;&nbsp;<br> 如果不用Pack时，编译为：&nbsp;<br> a.bJmp = 0xEB; // jmp的编码&nbsp;<br> a.dwDes = 0x00410123; // jmp 0x00410123&nbsp;<br> 不用pack的话，内存内容为 0xEB XX XX XX 23 01 41 00 // 共8BYTE&nbsp;<br> 其中XX为不定值，用pack后 0xEB 23 01 41 00 // 共5BYTE&nbsp;<br> 这样，在Hook时运行这些指令，就必须用#parama pack(1) // 1 BYTE方式对齐。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">如果直接把结构地址，以及结构长度，作为Send的参数发送整个结构，难道不需要pack吗？请教verybigbug()兄</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">不需要。&nbsp;<br> send(struct, sizeof(struct));就可以了，如果两个程序都没有pack的话，&nbsp;<br> 相同的结构体在接收数据时就没有问题。必须保证两边的pack都是一样才行。&nbsp;<br> 我在写socket的程序(SDK方式)时送结构就从来不用pack的。&nbsp;<br> 只在写Hook Api时才用pack(1)。&nbsp;&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">#pragma comment(lib, "ws2_32") 是什么意思 ？？？</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">.就相当于你将ws2_32.lib包含到工程中去。这样你就可以使用DLL接口函数了</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">#pragma data_seg 是什么意思？？</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">用#pragma data_seg建立一个新的数据段并定义共享数据，其具体格式为：&nbsp;<br><br> #pragma data_seg （"shareddata")&nbsp;<br><br> HWND sharedwnd="NULL";//共享数据&nbsp;<br><br> #pragma data_seg()&nbsp;&nbsp;&nbsp;&nbsp; // 再windows 核心编程思想中有很多地方用到。</p> 
    </div> 
    <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <br> ==============================================================================
    </div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;">本文转自被遗忘的博客园博客，原文链接：http://www.cnblogs.com/rollenholt/articles/2421844.html，如需转载请自行联系原作者</span></font>
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
