<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>java NIO « NotBeCN</title>
  <meta name="description" content="              接上次写的《java IO整理》http://www.cnblogs.com/rollenholt/archive/2011/09/11/2173787.html               这次是关于java nio,有一些重复的发的地方。本文中的源代码可以在此处下载，下载链接为：h...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2018/01/05/weixin_34402408_90122919.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">java NIO</h1>
    <p class="post-meta">Jan 5, 2018</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:18px;letter-spacing:-1px;background-image:url(&quot;images/dotsH.gif&quot;);background-position:left bottom;background-repeat:repeat-x;font-weight:normal;line-height:21.6px;color:rgb(51,51,51);font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';"> <strong style="font-size:15px;">接上次写的《java IO整理》</strong><a href="http://www.cnblogs.com/rollenholt/archive/2011/09/11/2173787.html" rel="nofollow" style="font-size:15px;text-decoration:none;color:rgb(61,129,238);border-bottom-width:1px;border-bottom-style:dashed;">http://www.cnblogs.com/rollenholt/archive/2011/09/11/2173787.html</a><br></h2> 
   <div class="entry" style="line-height:1.8;"> 
    <div class="blogpost-body" style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">这次是关于java nio,有一些重复的发的地方。本文中的源代码可以在此处下载，下载链接为：http://115.com/file/cltlj10i#nio-src.zip</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><strong>本文简介：</strong>&nbsp; JDK 1.4 中引入的新输入输出 (NIO) 库在标准 Java 代码中提供了高速的、面向块的 I/O。本实用教程从高级概念到底层的编程细节，非常详细地介绍了 NIO 库。您将学到诸如缓冲区和通道这样的关键 I/O 元素的知识，并考察更新后的库中的标准 I/O 是如何工作的。您还将了解只能通过 NIO 来完成的工作，如异步 I/O 和直接缓冲区。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">输入/输出：概念性描述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10095" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">I/O 简介</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">I/O ? 或者输入/输出 ? 指的是计算机与外部世界或者一个程序与计算机的其余部分的之间的接口。它对于任何计算机系统都非常关键，因而所有 I/O 的主体实际上是内置在操作系统中的。单独的程序一般是让系统为它们完成大部分的工作。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 Java 编程中，直到最近一直使用&nbsp;<em>流&nbsp;</em>的方式完成 I/O。所有 I/O 都被视为单个的字节的移动，通过一个称为 Stream 的对象一次移动一个字节。流 I/O 用于与外部世界接触。它也在内部使用，用于将对象转换为字节，然后再转换回对象。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">NIO 与原来的 I/O 有同样的作用和目的，但是它使用不同的方式?&nbsp;<em>块 I/O</em>。正如您将在本教程中学到的，块 I/O 的效率可以比流 I/O 高许多。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N100A9" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">为什么要使用 NIO?</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">NIO 的创建目的是为了让 Java 程序员可以实现高速 I/O 而无需编写自定义的本机代码。NIO 将最耗时的 I/O 操作(即填充和提取缓冲区)转移回操作系统，因而可以极大地提高速度。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N100B1" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">流与块的比较</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">原来的 I/O 库(在&nbsp;<code style="font-size:small;">java.io.*</code>中) 与 NIO 最重要的区别是数据打包和传输的方式。正如前面提到的，原来的 I/O 以流的方式处理数据，而 NIO 以块的方式处理数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><em>面向流&nbsp;</em>的 I/O 系统一次一个字节地处理数据。一个输入流产生一个字节的数据，一个输出流消费一个字节的数据。为流式数据创建过滤器非常容易。链接几个过滤器，以便每个过滤器只负责单个复杂处理机制的一部分，这样也是相对简单的。不利的一面是，面向流的 I/O 通常相当慢。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">一个&nbsp;<em>面向块&nbsp;</em>的 I/O 系统以块的形式处理数据。每一个操作都在一步中产生或者消费一个数据块。按块处理数据比按(流式的)字节处理数据要快得多。但是面向块的 I/O 缺少一些面向流的 I/O 所具有的优雅性和简单性。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N100C9" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">集成的 I/O</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 JDK 1.4 中原来的 I/O 包和 NIO 已经很好地集成了。&nbsp;<code style="font-size:small;">java.io.*</code>&nbsp;已经以 NIO 为基础重新实现了，所以现在它可以利用 NIO 的一些特性。例如，&nbsp;<code style="font-size:small;">java.io.*</code>&nbsp;包中的一些类包含以块的形式读写数据的方法，这使得即使在更面向流的系统中，处理速度也会更快。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">也可以用 NIO 库实现标准 I/O 功能。例如，可以容易地使用块 I/O 一次一个字节地移动数据。但是正如您会看到的，NIO 还提供了原 I/O 包中所没有的许多好处。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">通道和缓冲区</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N100E5" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">通道&nbsp;</code>和&nbsp;<code style="font-size:small;">缓冲区&nbsp;</code>是 NIO 中的核心对象，几乎在每一个 I/O 操作中都要使用它们。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">通道是对原 I/O 包中的流的模拟。到任何目的地(或来自任何地方)的所有数据都必须通过一个 Channel 对象。一个 Buffer 实质上是一个容器对象。发送给一个通道的所有对象都必须首先放到缓冲区中；同样地，从通道中读取的任何数据都要读到缓冲区中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在本节中，您会了解到 NIO 中通道和缓冲区是如何工作的。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N100FB" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">什么是缓冲区？</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">Buffer</code>&nbsp;是一个对象， 它包含一些要写入或者刚读出的数据。 在 NIO 中加入&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;对象，体现了新库与原 I/O 的一个重要区别。在面向流的 I/O 中，您将数据直接写入或者将数据直接读到&nbsp;<code style="font-size:small;">Stream</code>&nbsp;对象中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 NIO 库中，所有数据都是用缓冲区处理的。在读取数据时，它是直接读到缓冲区中的。在写入数据时，它是写入到缓冲区中的。任何时候访问 NIO 中的数据，您都是将它放到缓冲区中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">缓冲区实质上是一个数组。通常它是一个字节数组，但是也可以使用其他种类的数组。但是一个缓冲区不&nbsp;<em>仅仅&nbsp;</em>是一个数组。缓冲区提供了对数据的结构化访问，而且还可以跟踪系统的读/写进程。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10118" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">缓冲区类型</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">最常用的缓冲区类型是&nbsp;<code style="font-size:small;">ByteBuffer</code>。一个&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;可以在其底层字节数组上进行 get/set 操作(即字节的获取和设置)。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">ByteBuffer</code>&nbsp;不是 NIO 中唯一的缓冲区类型。事实上，对于每一种基本 Java 类型都有一种缓冲区类型：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">CharBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ShortBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">IntBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">LongBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">FloatBuffer</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">DoubleBuffer</code></li> 
     </ul>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">每一个&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;类都是&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;接口的一个实例。 除了&nbsp;<code style="font-size:small;">ByteBuffer</code>，每一个 Buffer 类都有完全一样的操作，只是它们所处理的数据类型不一样。因为大多数标准 I/O 操作都使用&nbsp;<code style="font-size:small;">ByteBuffer</code>，所以它具有所有共享的缓冲区操作以及一些特有的操作。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">现在您可以花一点时间运行 UseFloatBuffer.java，它包含了类型化的缓冲区的一个应用例子。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10179" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">什么是通道？</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">Channel</code>是一个对象，可以通过它读取和写入数据。拿 NIO 与原来的 I/O 做个比较，通道就像是流。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">正如前面提到的，所有数据都通过&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;对象来处理。您永远不会将字节直接写入通道中，相反，您是将数据写入包含一个或者多个字节的缓冲区。同样，您不会直接从通道中读取字节，而是将数据从通道读入缓冲区，再从缓冲区获取这个字节。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1018C" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">通道类型</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">通道与流的不同之处在于通道是双向的。而流只是在一个方向上移动(一个流必须是&nbsp;<code style="font-size:small;">InputStream</code>&nbsp;或者&nbsp;<code style="font-size:small;">OutputStream</code>&nbsp;的子类)， 而&nbsp;<code style="font-size:small;">通道&nbsp;</code>可以用于读、写或者同时用于读写。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">因为它们是双向的，所以通道可以比流更好地反映底层操作系统的真实情况。特别是在 UNIX 模型中，底层操作系统通道是双向的。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">从理论到实践：NIO 中的读和写</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N101AC" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">读和写是 I/O 的基本过程。从一个通道中读取很简单：只需创建一个缓冲区，然后让通道将数据读到这个缓冲区中。写入也相当简单：创建一个缓冲区，用数据填充它，然后让通道用这些数据来执行写入操作。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在本节中，我们将学习有关在 Java 程序中读取和写入数据的一些知识。我们将回顾 NIO 的主要组件(缓冲区、通道和一些相关的方法)，看看它们是如何交互以进行读写的。在接下来的几节中，我们将更详细地分析这其中的每个组件以及其交互。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N101B7" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">从文件中读取</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在我们第一个练习中，我们将从一个文件中读取一些数据。如果使用原来的 I/O，那么我们只需创建一个&nbsp;<code style="font-size:small;">FileInputStream</code>&nbsp;并从它那里读取。而在 NIO 中，情况稍有不同：我们首先从&nbsp;<code style="font-size:small;">FileInputStream</code>&nbsp;获取一个&nbsp;<code style="font-size:small;">FileInputStream</code>&nbsp;对象，然后使用这个通道来读取数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 NIO 系统中，任何时候执行一个读操作，您都是从通道中读取，但是您不是&nbsp;<em>直接&nbsp;</em>从通道读取。因为所有数据最终都驻留在缓冲区中，所以您是从通道读到缓冲区中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">因此读取文件涉及三个步骤：(1) 从&nbsp;<code style="font-size:small;">FileInputStream</code>&nbsp;获取&nbsp;<code style="font-size:small;">Channel</code>，(2) 创建&nbsp;<code style="font-size:small;">Buffer</code>，(3) 将数据从&nbsp;<code style="font-size:small;">Channel</code>&nbsp;读到&nbsp;<code style="font-size:small;">Buffer&nbsp;</code>中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">现在，让我们看一下这个过程。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N101EB" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">三个容易的步骤</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">第一步是获取通道。我们从&nbsp;<code style="font-size:small;">FileInputStream</code>&nbsp;获取通道：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileInputStream fin = </code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">new</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileInputStream( </code>
             <code class="java string" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:#0000FF;">"readandshow.txt"</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileChannel fc = fin.getChannel();</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">下一步是创建缓冲区：</p> 
     <div class="cnblogs_Highlighter sh-gutter"> 
      <div class="syntaxhighlighter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;font-size:12px;color:rgb(175,175,175);"> 
           <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            1
           </div> </td> 
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer buffer = ByteBuffer.allocate(&nbsp;</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1024</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
           </div> </td> 
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">最后，需要将数据从通道读到缓冲区中，如下所示：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fc.read( buffer );</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">您会注意到，我们不需要告诉通道要读&nbsp;<em>多少数据&nbsp;</em>到缓冲区中。每一个缓冲区都有复杂的内部统计机制，它会跟踪已经读了多少数据以及还有多少空间可以容纳更多的数据</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10213" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">写入文件</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 NIO 中写入文件类似于从文件中读取。首先从&nbsp;<code style="font-size:small;">FileOutputStream</code>&nbsp;获取一个通道：</p> 
     <div class="cnblogs_Highlighter sh-gutter"> 
      <div class="syntaxhighlighter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;font-size:12px;color:rgb(175,175,175);"> 
           <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            1
           </div> 
           <div class="line number2 index1 alt1" style="background-image:none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            2
           </div> </td> 
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileOutputStream fout =&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">new</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileOutputStream(&nbsp;</code>
             <code class="java string" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:#0000FF;">"writesomebytes.txt"</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileChannel fc = fout.getChannel();</code>
            </div> 
           </div> </td> 
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">下一步是创建一个缓冲区并在其中放入一些数据 - 在这里，数据将从一个名为&nbsp;<code style="font-size:small;">message</code>&nbsp;的数组中取出，这个数组包含字符串 "Some bytes" 的 ASCII 字节(本教程后面将会解释&nbsp;<code style="font-size:small;">buffer.flip()</code>&nbsp;和&nbsp;<code style="font-size:small;">buffer.put()</code>&nbsp;调用)。</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer buffer = ByteBuffer.allocate( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1024</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">for</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">i=</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">; i&lt;message.length; ++i) {</code> 
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.put( message[i] );</code> 
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
            <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.flip();</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">最后一步是写入缓冲区中</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fc.write( buffer );</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">注意在这里同样不需要告诉通道要写入多数据。缓冲区的内部统计机制会跟踪它包含多少数据以及还有多少数据要写入。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10240" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">读写结合</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下面我们将看一下在结合读和写时会有什么情况。我们以一个名为 CopyFile.java 的简单程序作为这个练习的基础，它将一个文件的所有内容拷贝到另一个文件中。CopyFile.java 执行三个基本操作：首先创建一个&nbsp;<code style="font-size:small;">Buffer</code>，然后从源文件中将数据读到这个缓冲区中，然后将缓冲区写入目标文件。这个程序不断重复 ― 读、写、读、写 ― 直到源文件结束。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">CopyFile 程序让您看到我们如何检查操作的状态，以及如何使用&nbsp;<code style="font-size:small;">clear()</code>&nbsp;和&nbsp;<code style="font-size:small;">flip()</code>&nbsp;方法重设缓冲区，并准备缓冲区以便将新读取的数据写到另一个通道中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10257" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">运行 CopyFile 例子</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">因为缓冲区会跟踪它自己的数据，所以 CopyFile 程序的内部循环 (inner loop) 非常简单，如下所示：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fcin.read( buffer );</code>
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fcout.write( buffer );</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">第一行将数据从输入通道&nbsp;<code style="font-size:small;">fcin</code>&nbsp;中读入缓冲区，第二行将这些数据写到输出通道&nbsp;<code style="font-size:small;">fcout</code>&nbsp;。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1026E" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">检查状态</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下一步是检查拷贝何时完成。当没有更多的数据时，拷贝就算完成，并且可以在&nbsp;<code style="font-size:small;">read()</code>&nbsp;方法返回 -1 是判断这一点，如下所示：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">r = fcin.read( buffer );</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">if</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(r==-</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">) {</code> 
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">break</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">;</code> 
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1027E" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">重设缓冲区</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">最后，在从输入通道读入缓冲区之前，我们调用&nbsp;<code style="font-size:small;">clear()</code>&nbsp;方法。同样，在将缓冲区写入输出通道之前，我们调用&nbsp;<code style="font-size:small;">flip()</code>&nbsp;方法，如下所示</p> 
     <div class="cnblogs_Highlighter sh-gutter"> 
      <div class="syntaxhighlighter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;font-size:12px;color:rgb(175,175,175);"> 
           <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            1
           </div> 
           <div class="line number2 index1 alt1" style="background-image:none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            2
           </div> 
           <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            3
           </div> 
           <div class="line number4 index3 alt1" style="background-image:none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            4
           </div> 
           <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            5
           </div> 
           <div class="line number6 index5 alt1" style="background-image:none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            6
           </div> 
           <div class="line number7 index6 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            7
           </div> 
           <div class="line number8 index7 alt1" style="background-image:none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            8
           </div> 
           <div class="line number9 index8 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;font-size:12px;">
            9
           </div> </td> 
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.clear();</code>
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">r = fcin.read( buffer );</code> 
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">if</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(r==-</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">) {</code> 
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">break</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">;</code> 
            </div> 
            <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
            <div class="line number7 index6 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number8 index7 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.flip();</code>
            </div> 
            <div class="line number9 index8 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fcout.write( buffer );</code>
            </div> 
           </div> </td> 
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><code style="font-size:small;">clear()</code>&nbsp;方法重设缓冲区，使它可以接受读入的数据。&nbsp;<code style="font-size:small;">flip()</code>&nbsp;方法让缓冲区可以将新读入的数据写入另一个通道。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">缓冲区内部细节</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N102A6" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">本节将介绍 NIO 中两个重要的缓冲区组件：状态变量和访问方法 (accessor)。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">状态变量是前一节中提到的"内部统计机制"的关键。每一个读/写操作都会改变缓冲区的状态。通过记录和跟踪这些变化，缓冲区就可能够内部地管理自己的资源。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在从通道读取数据时，数据被放入到缓冲区。在有些情况下，可以将这个缓冲区直接写入另一个通道，但是在一般情况下，您还需要查看数据。这是使用&nbsp;<em>访问方法&nbsp;</em><code style="font-size:small;">get()</code>&nbsp;来完成的。同样，如果要将原始数据放入缓冲区中，就要使用访问方法&nbsp;<code style="font-size:small;">put()</code>。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在本节中，您将学习关于 NIO 中的状态变量和访问方法的内容。我们将描述每一个组件，并让您有机会看到它的实际应用。虽然 NIO 的内部统计机制初看起来可能很复杂，但是您很快就会看到大部分的实际工作都已经替您完成了。您可能习惯于通过手工编码进行簿记 ― 即使用字节数组和索引变量，现在它已在 NIO 中内部地处理了。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N102C2" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">状态变量</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">可以用三个值指定缓冲区在任意时刻的状态：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">position</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">limit</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">capacity</code></li> 
     </ul>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">这三个变量一起可以跟踪缓冲区的状态和它所包含的数据。我们将在下面的小节中详细分析每一个变量，还要介绍它们如何适应典型的读/写(输入/输出)进程。在这个例子中，我们假定要将数据从一个输入通道拷贝到一个输出通道。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N102E5" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">Position</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">您可以回想一下，缓冲区实际上就是美化了的数组。在从通道读取时，您将所读取的数据放到底层的数组中。&nbsp;<code style="font-size:small;">position</code>&nbsp;变量跟踪已经写了多少数据。更准确地说，它指定了下一个字节将放到数组的哪一个元素中。因此，如果您从通道中读三个字节到缓冲区中，那么缓冲区的&nbsp;<code style="font-size:small;">position</code>&nbsp;将会设置为3，指向数组中第四个元素。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">同样，在写入通道时，您是从缓冲区中获取数据。&nbsp;<code style="font-size:small;">position</code>&nbsp;值跟踪从缓冲区中获取了多少数据。更准确地说，它指定下一个字节来自数组的哪一个元素。因此如果从缓冲区写了5个字节到通道中，那么缓冲区的&nbsp;<code style="font-size:small;">position</code>&nbsp;将被设置为5，指向数组的第六个元素。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10300" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">Limit</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">limit</code>&nbsp;变量表明还有多少数据需要取出(在从缓冲区写入通道时)，或者还有多少空间可以放入数据(在从通道读入缓冲区时)。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">position</code>&nbsp;总是小于或者等于&nbsp;<code style="font-size:small;">limit</code>。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10317" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">Capacity</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">缓冲区的&nbsp;<code style="font-size:small;">capacity</code>&nbsp;表明可以储存在缓冲区中的最大数据容量。实际上，它指定了底层数组的大小 ― 或者至少是指定了准许我们使用的底层数组的容量。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">limit</code>&nbsp;决不能大于&nbsp;<code style="font-size:small;">capacity</code>。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1032E" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">观察变量</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们首先观察一个新创建的缓冲区。出于本例子的需要，我们假设这个缓冲区的&nbsp;<code style="font-size:small;">总容量&nbsp;</code>为8个字节。&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;的状态如下所示：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Buffer state" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure1.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">回想一下 ，<code style="font-size:small;">limit</code>&nbsp;决不能大于&nbsp;<code style="font-size:small;">capacity</code>，此例中这两个值都被设置为 8。我们通过将它们指向数组的尾部之后(如果有第8个槽，则是第8个槽所在的位置)来说明这点。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Array" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure2.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">position</code>&nbsp;设置为0。如果我们读一些数据到缓冲区中，那么下一个读取的数据就进入 slot 0 。如果我们从缓冲区写一些数据，从缓冲区读取的下一个字节就来自 slot 0 。&nbsp;<code style="font-size:small;">position</code>&nbsp;设置如下所示：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Position setting" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure3.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">由于&nbsp;<code style="font-size:small;">capacity</code>&nbsp;不会改变，所以我们在下面的讨论中可以忽略它。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10379" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">第一次读取</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">现在我们可以开始在新创建的缓冲区上进行读/写操作。首先从输入通道中读一些数据到缓冲区中。第一次读取得到三个字节。它们被放到数组中从&nbsp;<code style="font-size:small;">position</code>&nbsp;开始的位置，这时 position 被设置为 0。读完之后，position 就增加到 3，如下所示：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Position increased to 3" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure4.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">limit</code>&nbsp;没有改变。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10396" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">第二次读取</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在第二次读取时，我们从输入通道读取另外两个字节到缓冲区中。这两个字节储存在由&nbsp;<code style="font-size:small;">position</code>&nbsp;所指定的位置上，&nbsp;<code style="font-size:small;">position</code>&nbsp;因而增加 2：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Position increased by 2" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure5.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">limit</code>&nbsp;没有改变。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N103B7" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">flip</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">现在我们要将数据写到输出通道中。在这之前，我们必须调用&nbsp;<code style="font-size:small;">flip()</code>&nbsp;方法。这个方法做两件非常重要的事：</p> 
     <ol style="font-size:.76em;">
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">它将&nbsp;<code style="font-size:small;">limit</code>&nbsp;设置为当前&nbsp;<code style="font-size:small;">position</code>。</li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">它将&nbsp;<code style="font-size:small;">position</code>&nbsp;设置为 0。</li> 
     </ol>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">前一小节中的图显示了在 flip 之前缓冲区的情况。下面是在 flip 之后的缓冲区：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Buffer after the flip" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure6.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们现在可以将数据从缓冲区写入通道了。&nbsp;<code style="font-size:small;">position</code>&nbsp;被设置为 0，这意味着我们得到的下一个字节是第一个字节。&nbsp;<code style="font-size:small;">limit</code>&nbsp;已被设置为原来的&nbsp;<code style="font-size:small;">position</code>，这意味着它包括以前读到的所有字节，并且一个字节也不多。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N103F4" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">第一次写入</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在第一次写入时，我们从缓冲区中取四个字节并将它们写入输出通道。这使得&nbsp;<code style="font-size:small;">position</code>&nbsp;增加到 4，而&nbsp;<code style="font-size:small;">limit</code>&nbsp;不变，如下所示：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Position advanced to 4, limit unchanged" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure7.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1040E" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">第二次写入</span></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们只剩下一个字节可写了。&nbsp;<code style="font-size:small;">limit</code>在我们调用&nbsp;<code style="font-size:small;">flip()</code>&nbsp;时被设置为 5，并且&nbsp;<code style="font-size:small;">position</code>&nbsp;不能超过&nbsp;<code style="font-size:small;">limit</code>。所以最后一次写入操作从缓冲区取出一个字节并将它写入输出通道。这使得&nbsp;<code style="font-size:small;">position</code>&nbsp;增加到 5，并保持&nbsp;<code style="font-size:small;">limit</code>&nbsp;不变，如下所示：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="Position advanced to 5, limit unchanged" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure8.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10438" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">clear</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">最后一步是调用缓冲区的&nbsp;<code style="font-size:small;">clear()</code>&nbsp;方法。这个方法重设缓冲区以便接收更多的字节。&nbsp;<code style="font-size:small;">Clear</code>&nbsp;做两种非常重要的事情：</p> 
     <ol style="font-size:.76em;">
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">它将&nbsp;<code style="font-size:small;">limit</code>&nbsp;设置为与&nbsp;<code style="font-size:small;">capacity</code>&nbsp;相同。</li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">它设置&nbsp;<code style="font-size:small;">position</code>&nbsp;为 0。</li> 
     </ol>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下图显示了在调用&nbsp;<code style="font-size:small;">clear()</code>&nbsp;后缓冲区的状态：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br><img alt="State of the buffer after clear() has been called" src="http://www.ibm.com/developerworks/cn/education/java/j-nio/figure9.gif" class="quimby_search_image" style="border:0px;">&nbsp;</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">缓冲区现在可以接收新的数据了。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10471" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">访问方法</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">到目前为止，我们只是使用缓冲区将数据从一个通道转移到另一个通道。然而，程序经常需要直接处理数据。例如，您可能需要将用户数据保存到磁盘。在这种情况下，您必须将这些数据直接放入缓冲区，然后用通道将缓冲区写入磁盘。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">或者，您可能想要从磁盘读取用户数据。在这种情况下，您要将数据从通道读到缓冲区中，然后检查缓冲区中的数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在本节的最后，我们将详细分析如何使用&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;类的&nbsp;<code style="font-size:small;">get()</code>&nbsp;和&nbsp;<code style="font-size:small;">put()</code>&nbsp;方法直接访问缓冲区中的数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1048B" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">get() 方法</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">ByteBuffer</code>&nbsp;类中有四个&nbsp;<code style="font-size:small;">get()</code>&nbsp;方法：</p> 
     <ol style="font-size:.76em;">
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">byte get();</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer get( byte dst[] );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer get( byte dst[], int offset, int length );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">byte get( int index );</code></li> 
     </ol>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">第一个方法获取单个字节。第二和第三个方法将一组字节读到一个数组中。第四个方法从缓冲区中的特定位置获取字节。那些返回<code style="font-size:small;">ByteBuffer</code>&nbsp;的方法只是返回调用它们的缓冲区的&nbsp;<code style="font-size:small;">this</code>&nbsp;值。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">此外，我们认为前三个&nbsp;<code style="font-size:small;">get()</code>&nbsp;方法是相对的，而最后一个方法是绝对的。&nbsp;<em>相对&nbsp;</em>意味着&nbsp;<code style="font-size:small;">get()</code>&nbsp;操作服从&nbsp;<code style="font-size:small;">limit</code>&nbsp;和&nbsp;<code style="font-size:small;">position</code>&nbsp;值 ― 更明确地说，字节是从当前&nbsp;<code style="font-size:small;">position</code>&nbsp;读取的，而&nbsp;<code style="font-size:small;">position</code>&nbsp;在&nbsp;<code style="font-size:small;">get</code>&nbsp;之后会增加。另一方面，一个&nbsp;<em>绝对&nbsp;</em>方法会忽略&nbsp;<code style="font-size:small;">limit</code>&nbsp;和&nbsp;<code style="font-size:small;">position</code>&nbsp;值，也不会影响它们。事实上，它完全绕过了缓冲区的统计方法。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">上面列出的方法对应于&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;类。其他类有等价的&nbsp;<code style="font-size:small;">get()</code>&nbsp;方法，这些方法除了不是处理字节外，其它方面是是完全一样的，它们处理的是与该缓冲区类相适应的类型。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N104FD" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">put()方法</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">ByteBuffer</code>&nbsp;类中有五个&nbsp;<code style="font-size:small;">put()</code>&nbsp;方法：</p> 
     <ol style="font-size:.76em;">
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer put( byte b );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer put( byte src[] );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer put( byte src[], int offset, int length );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer put( ByteBuffer src );</code></li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">ByteBuffer put( int index, byte b );</code></li> 
     </ol>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">第一个方法&nbsp;<code style="font-size:small;">写入（put）&nbsp;</code>单个字节。第二和第三个方法写入来自一个数组的一组字节。第四个方法将数据从一个给定的源<code style="font-size:small;">ByteBuffer</code>&nbsp;写入这个&nbsp;<code style="font-size:small;">ByteBuffer</code>。第五个方法将字节写入缓冲区中特定的&nbsp;<code style="font-size:small;">位置&nbsp;</code>。那些返回&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;的方法只是返回调用它们的缓冲区的&nbsp;<code style="font-size:small;">this</code>&nbsp;值。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">与&nbsp;<code style="font-size:small;">get()</code>&nbsp;方法一样，我们将把&nbsp;<code style="font-size:small;">put()</code>&nbsp;方法划分为&nbsp;<em>相对&nbsp;</em>或者&nbsp;<em>绝对&nbsp;</em>的。前四个方法是相对的，而第五个方法是绝对的。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">上面显示的方法对应于&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;类。其他类有等价的&nbsp;<code style="font-size:small;">put()</code>&nbsp;方法，这些方法除了不是处理字节之外，其它方面是完全一样的。它们处理的是与该缓冲区类相适应的类型。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1056A" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">类型化的 get() 和 put() 方法</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">除了前些小节中描述的&nbsp;<code style="font-size:small;">get()</code>&nbsp;和&nbsp;<code style="font-size:small;">put()</code>&nbsp;方法，&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;还有用于读写不同类型的值的其他方法，如下所示：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getByte()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getChar()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getShort()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getInt()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getLong()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getFloat()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">getDouble()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putByte()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putChar()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putShort()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putInt()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putLong()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putFloat()</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">putDouble()</code></li> 
     </ul>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">事实上，这其中的每个方法都有两种类型 ― 一种是相对的，另一种是绝对的。它们对于读取格式化的二进制数据（如图像文件的头部）很有用。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">您可以在例子程序 TypesInByteBuffer.java 中看到这些方法的实际应用。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N105E9" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">缓冲区的使用：一个内部循环</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下面的内部循环概括了使用缓冲区将数据从输入通道拷贝到输出通道的过程。</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">while</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">true</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">) {</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.clear();</code> 
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">r = fcin.read( buffer );</code> 
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">if</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(r==-</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">) {</code> 
            </div> 
            <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">break</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">;</code> 
            </div> 
            <div class="line number7 index6 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code> 
            </div> 
            <div class="line number8 index7 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number9 index8 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.flip();</code> 
            </div> 
            <div class="line number10 index9 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">fcout.write( buffer );</code> 
            </div> 
            <div class="line number11 index10 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><code style="font-size:small;">read()</code>&nbsp;和&nbsp;<code style="font-size:small;">write()</code>&nbsp;调用得到了极大的简化，因为许多工作细节都由缓冲区完成了。&nbsp;<code style="font-size:small;">clear()</code>&nbsp;和&nbsp;<code style="font-size:small;">flip()</code>&nbsp;方法用于让缓冲区在读和写之间切换。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">关于缓冲区的更多内容</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10611" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">到目前为止，您已经学习了使用缓冲区进行日常工作所需要掌握的大部分内容。我们的例子没怎么超出标准的读/写过程种类，在原来的 I/O 中可以像在 NIO 中一样容易地实现这样的标准读写过程。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">本节将讨论使用缓冲区的一些更复杂的方面，比如缓冲区分配、包装和分片。我们还会讨论 NIO 带给 Java 平台的一些新功能。您将学到如何创建不同类型的缓冲区以达到不同的目的，如可保护数据不被修改的&nbsp;<em>只读&nbsp;</em>缓冲区，和直接映射到底层操作系统缓冲区的&nbsp;<em>直接&nbsp;</em>缓冲区。我们将在本节的最后介绍如何在 NIO 中创建内存映射文件。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10622" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">缓冲区分配和包装</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在能够读和写之前，必须有一个缓冲区。要创建缓冲区，您必须&nbsp;<em>分配&nbsp;</em>它。我们使用静态方法&nbsp;<code style="font-size:small;">allocate()</code>&nbsp;来分配缓冲区：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer buffer = ByteBuffer.allocate( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1024</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">allocate()</code>&nbsp;方法分配一个具有指定大小的底层数组，并将它包装到一个缓冲区对象中 ― 在本例中是一个&nbsp;<code style="font-size:small;">ByteBuffer</code>。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">您还可以将一个现有的数组转换为缓冲区，如下所示：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">byte</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">array[] = </code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">new</code>&nbsp;
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">byte</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">[</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1024</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">];</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer buffer = ByteBuffer.wrap( array );</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">本例使用了&nbsp;<code style="font-size:small;">wrap()</code>&nbsp;方法将一个数组包装为缓冲区。必须非常小心地进行这类操作。一旦完成包装，底层数据就可以通过缓冲区或者直接访问。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1064E" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">缓冲区分片</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><code style="font-size:small;">slice()</code>&nbsp;方法根据现有的缓冲区创建一种&nbsp;<em>子缓冲区&nbsp;</em>。也就是说，它创建一个新的缓冲区，新缓冲区与原来的缓冲区的一部分共享数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">使用例子可以最好地说明这点。让我们首先创建一个长度为 10 的&nbsp;<code style="font-size:small;">ByteBuffer</code>：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer buffer = ByteBuffer.allocate( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">10</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">)</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">然后使用数据来填充这个缓冲区，在第&nbsp;<em>n</em>&nbsp;个槽中放入数字&nbsp;<em>n</em>：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">for</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">i=</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">; i&lt;buffer.capacity(); ++i) {</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.put( (</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">byte</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">)i );</code> 
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">现在我们对这个缓冲区&nbsp;<em>分片&nbsp;</em>，以创建一个包含槽 3 到槽 6 的子缓冲区。在某种意义上，子缓冲区就像原来的缓冲区中的一个&nbsp;<em>窗口&nbsp;</em>。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">窗口的起始和结束位置通过设置&nbsp;<code style="font-size:small;">position</code>&nbsp;和&nbsp;<code style="font-size:small;">limit</code>&nbsp;值来指定，然后调用&nbsp;<code style="font-size:small;">Buffer</code>&nbsp;的&nbsp;<code style="font-size:small;">slice()</code>&nbsp;方法：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.position( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">3</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.limit( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">7</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer slice = buffer.slice();</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><code style="font-size:small;">片&nbsp;</code>是缓冲区的&nbsp;<code style="font-size:small;">子缓冲区&nbsp;</code>。不过，&nbsp;<code style="font-size:small;">片段&nbsp;</code>和&nbsp;<code style="font-size:small;">缓冲区&nbsp;</code>共享同一个底层数据数组，我们在下一节将会看到这一点。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N106A8" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">缓冲区份片和数据共享</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们已经创建了原缓冲区的子缓冲区，并且我们知道缓冲区和子缓冲区共享同一个底层数据数组。让我们看看这意味着什么。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们遍历子缓冲区，将每一个元素乘以 11 来改变它。例如，5 会变成 55。</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">for</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">i=</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">; i&lt;slice.capacity(); ++i) {</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">byte</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">b = slice.get( i );</code> 
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">b *= </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">11</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">;</code> 
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">slice.put( i, b );</code> 
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">最后，再看一下原缓冲区中的内容：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.position( </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">buffer.limit( buffer.capacity() );</code>
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             &nbsp;
            </div> 
            <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">while</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(buffer.remaining()&gt;</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">) {</code> 
            </div> 
            <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">System.out.println( buffer.get() );</code> 
            </div> 
            <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">结果表明只有在子缓冲区窗口中的元素被改变了：</p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"> <pre class="displaycode">$ java SliceBuffer
0
1
2
33
44
55
66
7
8
9</pre> <pre class="displaycode"></pre> </td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">缓冲区片对于促进抽象非常有帮助。可以编写自己的函数处理整个缓冲区，而且如果想要将这个过程应用于子缓冲区上，您只需取主缓冲区的一个片，并将它传递给您的函数。这比编写自己的函数来取额外的参数以指定要对缓冲区的哪一部分进行操作更容易。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N106C8" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">只读缓冲区</span></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">只读缓冲区非常简单 ― 您可以读取它们，但是不能向它们写入。可以通过调用缓冲区的&nbsp;<code style="font-size:small;">asReadOnlyBuffer()</code>&nbsp;方法，将任何常规缓冲区转换为只读缓冲区，这个方法返回一个与原缓冲区完全相同的缓冲区(并与其共享数据)，只不过它是只读的。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">只读缓冲区对于保护数据很有用。在将缓冲区传递给某个对象的方法时，您无法知道这个方法是否会修改缓冲区中的数据。创建一个只读的缓冲区可以&nbsp;<em>保证&nbsp;</em>该缓冲区不会被修改。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">不能将只读的缓冲区转换为可写的缓冲区。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N106DD" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">直接和间接缓冲区</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">另一种有用的&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;是直接缓冲区。&nbsp;<em>直接缓冲区&nbsp;</em>是为加快 I/O 速度，而以一种特殊的方式分配其内存的缓冲区。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">实际上，直接缓冲区的准确定义是与实现相关的。Sun 的文档是这样描述直接缓冲区的：</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><em>给定一个直接字节缓冲区，Java 虚拟机将尽最大努力直接对它执行本机 I/O 操作。也就是说，它会在每一次调用底层操作系统的本机 I/O 操作之前(或之后)，尝试避免将缓冲区的内容拷贝到一个中间缓冲区中(或者从一个中间缓冲区中拷贝数据)。</em></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">您可以在例子程序 FastCopyFile.java 中看到直接缓冲区的实际应用，这个程序是 CopyFile.java 的另一个版本，它使用了直接缓冲区以提高速度。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">还可以用内存映射文件创建直接缓冲区。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N106F9" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">内存映射文件 I/O</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">内存映射文件 I/O 是一种读和写文件数据的方法，它可以比常规的基于流或者基于通道的 I/O 快得多。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">内存映射文件 I/O 是通过使文件中的数据神奇般地出现为内存数组的内容来完成的。这其初听起来似乎不过就是将整个文件读到内存中，但是事实上并不是这样。一般来说，只有文件中实际读取或者写入的部分才会送入（或者&nbsp;<em>映射&nbsp;</em>）到内存中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">内存映射并不真的神奇或者多么不寻常。现代操作系统一般根据需要将文件的部分映射为内存的部分，从而实现文件系统。Java 内存映射机制不过是在底层操作系统中可以采用这种机制时，提供了对该机制的访问。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">尽管创建内存映射文件相当简单，但是向它写入可能是危险的。仅只是改变数组的单个元素这样的简单操作，就可能会直接修改磁盘上的文件。修改数据与将数据保存到磁盘是没有分开的。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1070D" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">将文件映射到内存</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">了解内存映射的最好方法是使用例子。在下面的例子中，我们要将一个&nbsp;<code style="font-size:small;">FileChannel</code>&nbsp;(它的全部或者部分)映射到内存中。为此我们将使用&nbsp;<code style="font-size:small;">FileChannel.map()</code>&nbsp;方法。下面代码行将文件的前 1024 个字节映射到内存中：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">MappedByteBuffer mbb = fc.map( FileChannel.MapMode.READ_WRITE,</code>
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">0</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">, </code>
             <code class="java value" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,153,0);">1024</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><code style="font-size:small;">map()</code>&nbsp;方法返回一个&nbsp;<code style="font-size:small;">MappedByteBuffer</code>，它是&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;的子类。因此，您可以像使用其他任何&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;一样使用新映射的缓冲区，操作系统会在需要时负责执行行映射。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">分散和聚集</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1073D" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">分散/聚集 I/O 是使用多个而不是单个缓冲区来保存数据的读写方法。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">一个分散的读取就像一个常规通道读取，只不过它是将数据读到一个缓冲区数组中而不是读到单个缓冲区中。同样地，一个聚集写入是向缓冲区数组而不是向单个缓冲区写入数据。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">分散/聚集 I/O 对于将数据流划分为单独的部分很有用，这有助于实现复杂的数据格式。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1074B" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">分散/聚集 I/O</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">通道可以有选择地实现两个新的接口：&nbsp;<code style="font-size:small;">ScatteringByteChannel</code>&nbsp;和&nbsp;<code style="font-size:small;">GatheringByteChannel</code>。一个&nbsp;<code style="font-size:small;">ScatteringByteChannel</code>&nbsp;是一个具有两个附加读方法的通道：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">long read( ByteBuffer[] dsts );</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">long read( ByteBuffer[] dsts, int offset, int length );</code></li> 
     </ul>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">这些&nbsp;<code style="font-size:small;">long read()</code>&nbsp;方法很像标准的&nbsp;<code style="font-size:small;">read</code>&nbsp;方法，只不过它们不是取单个缓冲区而是取一个缓冲区数组。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在&nbsp;<em>分散读取&nbsp;</em>中，通道依次填充每个缓冲区。填满一个缓冲区后，它就开始填充下一个。在某种意义上，缓冲区数组就像一个大缓冲区。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N10781" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">分散/聚集的应用</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">分散/聚集 I/O 对于将数据划分为几个部分很有用。例如，您可能在编写一个使用消息对象的网络应用程序，每一个消息被划分为固定长度的头部和固定长度的正文。您可以创建一个刚好可以容纳头部的缓冲区和另一个刚好可以容难正文的缓冲区。当您将它们放入一个数组中并使用分散读取来向它们读入消息时，头部和正文将整齐地划分到这两个缓冲区中。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们从缓冲区所得到的方便性对于缓冲区数组同样有效。因为每一个缓冲区都跟踪自己还可以接受多少数据，所以分散读取会自动找到有空间接受数据的第一个缓冲区。在这个缓冲区填满后，它就会移动到下一个缓冲区。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N1078C" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">聚集写入</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><em>聚集写入&nbsp;</em>类似于分散读取，只不过是用来写入。它也有接受缓冲区数组的方法：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">long write( ByteBuffer[] srcs );</code></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"><code style="font-size:small;">long write( ByteBuffer[] srcs, int offset, int length );</code></li> 
     </ul>
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">聚集写对于把一组单独的缓冲区中组成单个数据流很有用。为了与上面的消息例子保持一致，您可以使用聚集写入来自动将网络消息的各个部分组装为单个数据流，以便跨越网络传输消息。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">从例子程序 UseScatterGather.java 中可以看到分散读取和聚集写入的实际应用。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">文件锁定</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N107B7" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">文件锁定初看起来可能让人迷惑。它&nbsp;<em>似乎&nbsp;</em>指的是防止程序或者用户访问特定文件。事实上，文件锁就像常规的 Java 对象锁 ― 它们是&nbsp;<em>劝告式的（advisory）&nbsp;</em>锁。它们不阻止任何形式的数据访问，相反，它们通过锁的共享和获取赖允许系统的不同部分相互协调。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">您可以锁定整个文件或者文件的一部分。如果您获取一个排它锁，那么其他人就不能获得同一个文件或者文件的一部分上的锁。如果您获得一个共享锁，那么其他人可以获得同一个文件或者文件一部分上的共享锁，但是不能获得排它锁。文件锁定并不总是出于保护数据的目的。例如，您可能临时锁定一个文件以保证特定的写操作成为原子的，而不会有其他程序的干扰。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">大多数操作系统提供了文件系统锁，但是它们并不都是采用同样的方式。有些实现提供了共享锁，而另一些仅提供了排它锁。事实上，有些实现使得文件的锁定部分不可访问，尽管大多数实现不是这样的。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在本节中，您将学习如何在 NIO 中执行简单的文件锁过程，我们还将探讨一些保证被锁定的文件尽可能可移植的方法。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="N107CE" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">锁定文件</span></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">要获取文件的一部分上的锁，您要调用一个打开的&nbsp;<code style="font-size:small;">FileChannel</code>&nbsp;上的&nbsp;<code style="font-size:small;">lock()</code>&nbsp;方法。注意，如果要获取一个排它锁，您必须以写方式打开文件。</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">RandomAccessFile raf = </code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">new</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">RandomAccessFile( </code>
             <code class="java string" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:#0000FF;">"usefilelocks.txt"</code>
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">, </code>
             <code class="java string" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:#0000FF;">"rw"</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
            <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileChannel fc = raf.getChannel();</code>
            </div> 
            <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">FileLock lock = fc.lock( start, end, </code>
             <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">false</code>&nbsp;
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">在拥有锁之后，您可以执行需要的任何敏感操作，然后再释放锁：</p> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
        <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
         <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
          <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
           <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
            <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
             <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">lock.release();</code>
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在释放锁后，尝试获得锁的其他任何程序都有机会获得它。</p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">本小节的例子程序 UseFileLocks.java 必须与它自己并行运行。这个程序获取一个文件上的锁，持有三秒钟，然后释放它。如果同时运行这个程序的多个实例，您会看到每个实例依次获得锁。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">文件锁定可能是一个复杂的操作，特别是考虑到不同的操作系统是以不同的方式实现锁这一事实。下面的指导原则将帮助您尽可能保持代码的可移植性：</p> 
     <ul style="list-style:none;font-size:.76em;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">只使用排它锁。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">将所有的锁视为劝告式的（advisory）。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <p style="line-height:1.8;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">连网和异步 I/O</span></p> <p style="line-height:1.8;font-size:.76em;"><a name="N10809" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">概述</span></p> <p style="line-height:1.8;font-size:.76em;">连网是学习异步 I/O 的很好基础，而异步 I/O 对于在 Java 语言中执行任何输入/输出过程的人来说，无疑都是必须具备的知识。NIO 中的连网与 NIO 中的其他任何操作没有什么不同 ― 它依赖通道和缓冲区，而您通常使用&nbsp;<code style="font-size:small;">InputStream</code>&nbsp;和&nbsp;<code style="font-size:small;">OutputStream</code>&nbsp;来获得通道。</p> <p style="line-height:1.8;font-size:.76em;">本节首先介绍异步 I/O 的基础 ― 它是什么以及它不是什么，然后转向更实用的、程序性的例子。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N1081C" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">异步 I/O</span></p> <p style="line-height:1.8;font-size:.76em;">异步 I/O 是一种&nbsp;<em>没有阻塞地&nbsp;</em>读写数据的方法。通常，在代码进行&nbsp;<code style="font-size:small;">read()</code>&nbsp;调用时，代码会阻塞直至有可供读取的数据。同样，<code style="font-size:small;">write()</code>&nbsp;调用将会阻塞直至数据能够写入。</p> <p style="line-height:1.8;font-size:.76em;">另一方面，异步 I/O 调用不会阻塞。相反，您将注册对特定 I/O 事件的兴趣 ― 可读的数据的到达、新的套接字连接，等等，而在发生这样的事件时，系统将会告诉您。</p> <p style="line-height:1.8;font-size:.76em;">异步 I/O 的一个优势在于，它允许您同时根据大量的输入和输出执行 I/O。同步程序常常要求助于轮询，或者创建许许多多的线程以处理大量的连接。使用异步 I/O，您可以监听任何数量的通道上的事件，不用轮询，也不用额外的线程。</p> <p style="line-height:1.8;font-size:.76em;">我们将通过研究一个名为 MultiPortEcho.java 的例子程序来查看异步 I/O 的实际应用。这个程序就像传统的&nbsp;<em>echo server</em>，它接受网络连接并向它们回响它们可能发送的数据。不过它有一个附加的特性，就是它能同时监听多个端口，并处理来自所有这些端口的连接。并且它只在单个线程中完成所有这些工作。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N1083B" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">Selectors</span></p> <p style="line-height:1.8;font-size:.76em;">本节的阐述对应于&nbsp;<code style="font-size:small;">MultiPortEcho</code>&nbsp;的源代码中的&nbsp;<code style="font-size:small;">go()</code>&nbsp;方法的实现，因此应该看一下源代码，以便对所发生的事情有个更全面的了解。</p> <p style="line-height:1.8;font-size:.76em;">异步 I/O 中的核心对象名为&nbsp;<code style="font-size:small;">Selector</code>。<code style="font-size:small;">Selector</code>&nbsp;就是您注册对各种 I/O 事件的兴趣的地方，而且当那些事件发生时，就是这个对象告诉您所发生的事件。</p> <p style="line-height:1.8;font-size:.76em;">所以，我们需要做的第一件事就是创建一个&nbsp;<code style="font-size:small;">Selector</code>：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">Selector selector = Selector.open();</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">然后，我们将对不同的通道对象调用&nbsp;<code style="font-size:small;">register()</code>&nbsp;方法，以便注册我们对这些对象中发生的 I/O 事件的兴趣。<code style="font-size:small;">register()</code>&nbsp;的第一个参数总是这个&nbsp;<code style="font-size:small;">Selector</code>。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N10870" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">打开一个 ServerSocketChannel</span></p> <p style="line-height:1.8;font-size:.76em;">为了接收连接，我们需要一个&nbsp;<code style="font-size:small;">ServerSocketChannel</code>。事实上，我们要监听的每一个端口都需要有一个&nbsp;<code style="font-size:small;">ServerSocketChannel</code>&nbsp;。对于每一个端口，我们打开一个&nbsp;<code style="font-size:small;">ServerSocketChannel</code>，如下所示：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ServerSocketChannel ssc = ServerSocketChannel.open();</code>
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ssc.configureBlocking( </code>
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">false</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
              </div> 
              <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               &nbsp;
              </div> 
              <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ServerSocket ss = ssc.socket();</code>
              </div> 
              <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">InetSocketAddress address = </code>
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">new</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">InetSocketAddress( ports[i] );</code> 
              </div> 
              <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ss.bind( address );</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">第一行创建一个新的&nbsp;<code style="font-size:small;">ServerSocketChannel</code>&nbsp;，最后三行将它绑定到给定的端口。第二行将&nbsp;<code style="font-size:small;">ServerSocketChannel</code>&nbsp;设置为&nbsp;<em>非阻塞的&nbsp;</em>。我们必须对每一个要使用的套接字通道调用这个方法，否则异步 I/O 就不能工作。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N10896" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">选择键</span></p> <p style="line-height:1.8;font-size:.76em;">下一步是将新打开的&nbsp;<code style="font-size:small;">ServerSocketChannels</code>&nbsp;注册到&nbsp;<code style="font-size:small;">Selector</code>上。为此我们使用 ServerSocketChannel.register() 方法，如下所示</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">SelectionKey key = ssc.register( selector, SelectionKey.OP_ACCEPT );</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-size:.76em;"><code style="font-size:small;">register()</code>&nbsp;的第一个参数总是这个&nbsp;<code style="font-size:small;">Selector</code>。第二个参数是&nbsp;<code style="font-size:small;">OP_ACCEPT</code>，这里它指定我们想要监听&nbsp;<em>accept</em>&nbsp;事件，也就是在新的连接建立时所发生的事件。这是适用于&nbsp;<code style="font-size:small;">ServerSocketChannel</code>&nbsp;的唯一事件类型。</p> <p style="line-height:1.8;font-size:.76em;">请注意对&nbsp;<code style="font-size:small;">register()</code>&nbsp;的调用的返回值。&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;代表这个通道在此&nbsp;<code style="font-size:small;">Selector</code>&nbsp;上的这个注册。当某个&nbsp;<code style="font-size:small;">Selector</code>&nbsp;通知您某个传入事件时，它是通过提供对应于该事件的&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;来进行的。<code style="font-size:small;">SelectionKey</code>&nbsp;还可以用于取消通道的注册。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N108DB" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">内部循环</span></p> <p style="line-height:1.8;font-size:.76em;">现在已经注册了我们对一些 I/O 事件的兴趣，下面将进入主循环。使用&nbsp;<code style="font-size:small;">Selectors</code>&nbsp;的几乎每个程序都像下面这样使用内部循环：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">int</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">num = selector.select();</code> 
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               &nbsp;
              </div> 
              <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">Set selectedKeys = selector.selectedKeys();</code>
              </div> 
              <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">Iterator it = selectedKeys.iterator();</code>
              </div> 
              <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               &nbsp;
              </div> 
              <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">while</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">(it.hasNext()) {</code> 
              </div> 
              <div class="line number7 index6 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">SelectionKey key = (SelectionKey)it.next();</code> 
              </div> 
              <div class="line number8 index7 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java comments" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,130,0);">// ... deal with I/O event ...</code> 
              </div> 
              <div class="line number9 index8 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-size:.76em;">首先，我们调用&nbsp;<code style="font-size:small;">Selector</code>&nbsp;的&nbsp;<code style="font-size:small;">select()</code>&nbsp;方法。这个方法会阻塞，直到至少有一个已注册的事件发生。当一个或者更多的事件发生时，<code style="font-size:small;">select()</code>&nbsp;方法将返回所发生的事件的数量。</p> <p style="line-height:1.8;font-size:.76em;">接下来，我们调用&nbsp;<code style="font-size:small;">Selector</code>&nbsp;的&nbsp;<code style="font-size:small;">selectedKeys()</code>&nbsp;方法，它返回发生了事件的&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;对象的一个&nbsp;<code style="font-size:small;">集合&nbsp;</code>。</p> <p style="line-height:1.8;font-size:.76em;">我们通过迭代&nbsp;<code style="font-size:small;">SelectionKeys</code>&nbsp;并依次处理每个&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;来处理事件。对于每一个&nbsp;<code style="font-size:small;">SelectionKey</code>，您必须确定发生的是什么 I/O 事件，以及这个事件影响哪些 I/O 对象。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N1091C" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">监听新连接</span></p> <p style="line-height:1.8;font-size:.76em;">程序执行到这里，我们仅注册了&nbsp;<code style="font-size:small;">ServerSocketChannel</code>，并且仅注册它们“接收”事件。为确认这一点，我们对&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;调用<code style="font-size:small;">readyOps()</code>&nbsp;方法，并检查发生了什么类型的事件：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">if</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">((key.readyOps() &amp; SelectionKey.OP_ACCEPT)</code> 
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">== SelectionKey.OP_ACCEPT) {</code> 
              </div> 
              <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               &nbsp;
              </div> 
              <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java comments" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,130,0);">// Accept the new connection</code> 
              </div> 
              <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java comments" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,130,0);">// ...</code> 
              </div> 
              <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">可以肯定地说，&nbsp;<code style="font-size:small;">readOps()</code>&nbsp;方法告诉我们该事件是新的连接。</p> <p style="line-height:1.8;font-size:.76em;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">接受新的连接</span></p> <p style="line-height:1.8;font-size:.76em;">因为我们知道这个服务器套接字上有一个传入连接在等待，所以可以安全地接受它；也就是说，不用担心&nbsp;<code style="font-size:small;">accept()</code>&nbsp;操作会阻塞：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ServerSocketChannel ssc = (ServerSocketChannel)key.channel();</code>
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">SocketChannel sc = ssc.accept();</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">下一步是将新连接的&nbsp;<code style="font-size:small;">SocketChannel</code>&nbsp;配置为非阻塞的。而且由于接受这个连接的目的是为了读取来自套接字的数据，所以我们还必须将&nbsp;<code style="font-size:small;">SocketChannel</code>&nbsp;注册到&nbsp;<code style="font-size:small;">Selector</code>上，如下所示：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">sc.configureBlocking( </code>
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">false</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">SelectionKey newKey = sc.register( selector, SelectionKey.OP_READ );</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">注意我们使用&nbsp;<code style="font-size:small;">register()</code>&nbsp;的&nbsp;<code style="font-size:small;">OP_READ</code>&nbsp;参数，将&nbsp;<code style="font-size:small;">SocketChannel</code>&nbsp;注册用于&nbsp;<em>读取&nbsp;</em>而不是&nbsp;<em>接受&nbsp;</em>新连接。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N10973" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">删除处理过的 SelectionKey</span></p> <p style="line-height:1.8;font-size:.76em;">在处理&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;之后，我们几乎可以返回主循环了。但是我们必须首先将处理过的&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;从选定的键集合中删除。如果我们没有删除处理过的键，那么它仍然会在主集合中以一个激活的键出现，这会导致我们尝试再次处理它。我们调用迭代器的<code style="font-size:small;">remove()</code>&nbsp;方法来删除处理过的&nbsp;<code style="font-size:small;">SelectionKey</code>：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">it.remove();</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">现在我们可以返回主循环并接受从一个套接字中传入的数据(或者一个传入的 I/O 事件)了。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N10992" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">传入的 I/O</span></p> <p style="line-height:1.8;font-size:.76em;">当来自一个套接字的数据到达时，它会触发一个 I/O 事件。这会导致在主循环中调用&nbsp;<code style="font-size:small;">Selector.select()</code>，并返回一个或者多个 I/O 事件。这一次，&nbsp;<code style="font-size:small;">SelectionKey</code>&nbsp;将被标记为&nbsp;<code style="font-size:small;">OP_READ</code>&nbsp;事件，如下所示：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">} </code>
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">else</code>&nbsp;
               <code class="java keyword" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,255);">if</code>&nbsp;
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">((key.readyOps() &amp; SelectionKey.OP_READ)</code> 
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">== SelectionKey.OP_READ) {</code> 
              </div> 
              <div class="line number3 index2 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java comments" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,130,0);">// Read the data</code> 
              </div> 
              <div class="line number4 index3 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">SocketChannel sc = (SocketChannel)key.channel();</code> 
              </div> 
              <div class="line number5 index4 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
               <code class="java spaces" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
               <code class="java comments" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,130,0);">// ...</code> 
              </div> 
              <div class="line number6 index5 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">}</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">与以前一样，我们取得发生 I/O 事件的通道并处理它。在本例中，由于这是一个 echo server，我们只希望从套接字中读取数据并马上将它发送回去。</p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> <p style="line-height:1.8;font-size:.76em;">每次返回主循环，我们都要调用&nbsp;<code style="font-size:small;">select</code>&nbsp;的&nbsp;<code style="font-size:small;">Selector()</code>方法，并取得一组&nbsp;<code style="font-size:small;">SelectionKey</code>。每个键代表一个 I/O 事件。我们处理事件，从选定的键集中删除&nbsp;<code style="font-size:small;">SelectionKey</code>，然后返回主循环的顶部。</p> <p style="line-height:1.8;font-size:.76em;">这个程序有点过于简单，因为它的目的只是展示异步 I/O 所涉及的技术。在现实的应用程序中，您需要通过将通道从&nbsp;<code style="font-size:small;">Selector</code>&nbsp;中删除来处理关闭的通道。而且您可能要使用多个线程。这个程序可以仅使用一个线程，因为它只是一个演示，但是在现实场景中，创建一个线程池来负责 I/O 事件处理中的耗时部分会更有意义。</p> <p style="line-height:1.8;font-size:.76em;"></p> <p style="line-height:1.8;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">字符集</span></p> <p style="line-height:1.8;font-size:.76em;">根据 Sun 的文档，一个&nbsp;<code style="font-size:small;">Charset</code>&nbsp;是“十六位 Unicode 字符序列与字节序列之间的一个命名的映射”。实际上，一个&nbsp;<code style="font-size:small;">Charset</code>&nbsp;允许您以尽可能最具可移植性的方式读写字符序列。</p> <p style="line-height:1.8;font-size:.76em;">Java 语言被定义为基于 Unicode。然而在实际上，许多人编写代码时都假设一个字符在磁盘上或者在网络流中用一个字节表示。这种假设在许多情况下成立，但是并不是在所有情况下都成立，而且随着计算机变得对 Unicode 越来越友好，这个假设就日益变得不能成立了。</p> <p style="line-height:1.8;font-size:.76em;">在本节中，我们将看一下如何使用&nbsp;<code style="font-size:small;">Charsets</code>&nbsp;以适合现代文本格式的方式处理文本数据。这里将使用的示例程序相当简单，不过，它触及了使用&nbsp;<code style="font-size:small;">Charset</code>&nbsp;的所有关键方面：为给定的字符编码创建&nbsp;<code style="font-size:small;">Charset</code>，以及使用该&nbsp;<code style="font-size:small;">Charset</code>&nbsp;解码和编码文本数据。</p> <p style="line-height:1.8;font-size:.76em;"></p> <p style="line-height:1.8;font-size:.76em;"><a name="N109FF" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">编码/解码</span></p> <p style="line-height:1.8;font-size:.76em;">要读和写文本，我们要分别使用&nbsp;<code style="font-size:small;">CharsetDecoder</code>&nbsp;和&nbsp;<code style="font-size:small;">CharsetEncoder</code>。将它们称为&nbsp;<em>编码器&nbsp;</em>和&nbsp;<em>解码器&nbsp;</em>是有道理的。一个&nbsp;<em>字符&nbsp;</em>不再表示一个特定的位模式，而是表示字符系统中的一个实体。因此，由某个实际的位模式表示的字符必须以某种特定的&nbsp;<em>编码&nbsp;</em>来表示。</p> <p style="line-height:1.8;font-size:.76em;"><code style="font-size:small;">CharsetDecoder</code>&nbsp;用于将逐位表示的一串字符转换为具体的&nbsp;<code style="font-size:small;">char</code>&nbsp;值。同样，一个&nbsp;<code style="font-size:small;">CharsetEncoder</code>&nbsp;用于将字符转换回位。</p> <p style="line-height:1.8;font-size:.76em;">在下一个小节中，我们将考察一个使用这些对象来读写数据的程序。</p> <p style="line-height:1.8;font-size:.76em;"><a name="N10A2D" style="border-bottom-width:1px;border-bottom-style:dashed;"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">处理文本的正确方式</span></p> <p style="line-height:1.8;font-size:.76em;">现在我们将分析这个例子程序 UseCharsets.java。这个程序非常简单 ― 它从一个文件中读取一些文本，并将该文本写入另一个文件。但是它把该数据当作文本数据，并使用&nbsp;<code style="font-size:small;">CharBuffer</code>&nbsp;来将该数句读入一个&nbsp;<code style="font-size:small;">CharsetDecoder</code>&nbsp;中。同样，它使用&nbsp;<code style="font-size:small;">CharsetEncoder</code>&nbsp;来写回该数据。</p> <p style="line-height:1.8;font-size:.76em;">我们将假设字符以 ISO-8859-1(Latin1) 字符集（这是 ASCII 的标准扩展）的形式储存在磁盘上。尽管我们必须为使用 Unicode 做好准备，但是也必须认识到不同的文件是以不同的格式储存的，而 ASCII 无疑是非常普遍的一种格式。事实上，每种 Java 实现都要求对以下字符编码提供完全的支持：</p> 
       <ul style="list-style:none;font-size:.76em;">
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">US-ASCII</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">ISO-8859-1</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">UTF-8</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">UTF-16BE</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">UTF-16LE</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">UTF-16</li> 
        <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;"> <p style="line-height:1.8;font-size:.76em;"><a name="N10A59" style="border-bottom-width:1px;border-bottom-style:dashed;color:rgb(76,110,148);"></a><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">示例程序</span></p> <p style="line-height:1.8;font-size:.76em;">在打开相应的文件、将输入数据读入名为&nbsp;<code style="font-size:small;">inputData</code>&nbsp;的&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;之后，我们的程序必须创建 ISO-8859-1 (Latin1) 字符集的一个实例：</p> 
         <div class="cnblogs_Highlighter"> 
          <div class="syntaxhighlighter nogutter java" style="width:674px;font-size:1em;"> 
           <table border="0" style="border:1px solid #C0C0C0;width:674px;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
            <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
             <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
              <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
               <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
                <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;"> 
                 <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">Charset latin1 = Charset.forName( </code>
                 <code class="java string" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:#0000FF;">"ISO-8859-1"</code>&nbsp;
                 <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">);</code> 
                </div> 
               </div> </td>
             </tr>
            </tbody>
           </table>
          </div> 
         </div> </li> 
       </ul><p style="line-height:1.8;font-size:.76em;">然后，创建一个解码器（用于读取）和一个编码器 （用于写入）：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">CharsetDecoder decoder = latin1.newDecoder();</code>
              </div> 
              <div class="line number2 index1 alt1" style="background-image:none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">CharsetEncoder encoder = latin1.newEncoder();</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">　为了将字节数据解码为一组字符，我们把&nbsp;<code style="font-size:small;">ByteBuffer</code>&nbsp;传递给&nbsp;<code style="font-size:small;">CharsetDecoder</code>，结果得到一个&nbsp;<code style="font-size:small;">CharBuffer</code></p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">CharBuffer cb = decoder.decode( inputData );</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">　如果想要处理字符，我们可以在程序的此处进行。但是我们只想无改变地将它写回，所以没有什么要做的。</p> <p style="line-height:1.8;font-size:.76em;">要写回数据，我们必须使用&nbsp;<code style="font-size:small;">CharsetEncoder</code>&nbsp;将它转换回字节：</p> 
       <div class="cnblogs_Highlighter"> 
        <div class="syntaxhighlighter nogutter java" style="font-size:1em;"> 
         <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
          <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
           <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;">
            <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
             <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;font-size:12px;"> 
              <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;font-size:12px;">
               <code class="java plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;color:rgb(0,0,0);">ByteBuffer outputData = encoder.encode( cb );</code>
              </div> 
             </div> </td>
           </tr>
          </tbody>
         </table>
        </div> 
       </div> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">　在转换完成之后，我们就可以将数据写到文件中了。</p> <p style="line-height:1.8;font-size:.76em;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">结束语和参考资料</span></p> <p style="line-height:1.8;font-size:.76em;"><a name="N10AA1" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">结束语</span></a></p> <p style="line-height:1.8;font-size:.76em;">正如您所看到的， NIO 库有大量的特性。在一些新特性（例如文件锁定和字符集）提供新功能的同时，许多特性在优化方面也非常优秀。</p> <p style="line-height:1.8;font-size:.76em;">在基础层次上，通道和缓冲区可以做的事情几乎都可以用原来的面向流的类来完成。但是通道和缓冲区允许以&nbsp;<em>快得多&nbsp;</em>的方式完成这些相同的旧操作 ― 事实上接近系统所允许的最大速度。</p> <p style="line-height:1.8;font-size:.76em;">不过 NIO 最强大的长度之一在于，它提供了一种在 Java 语言中执行进行输入/输出的新的（也是迫切需要的）结构化方式。随诸如缓冲区、通道和异步 I/O 这些概念性（且可实现的）实体而来的，是我们重新思考 Java 程序中的 I/O过程的机会。这样，NIO 甚至为我们最熟悉的 I/O 过程也带来了新的活力，同时赋予我们通过和以前不同并且更好的方式执行它们的机会。</p> <p style="line-height:1.8;font-size:.76em;"></p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;">　</p> <p style="line-height:1.8;font-size:.76em;"></p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> <p style="line-height:1.8;font-size:.76em;"></p> </li> 
     </ul>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
    </div> 
    <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <br> ==============================================================================
    </div> 
    <div> 
     <font color="#333333">本文转自被遗忘的博客园博客，原文链接：http://www.cnblogs.com/rollenholt/archive/2011/09/29/2195730.html，如需转载请自行联系原作者</font>
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
