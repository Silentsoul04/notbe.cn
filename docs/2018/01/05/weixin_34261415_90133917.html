<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>深入探讨 java.lang.ref 包 « NotBeCN</title>
  <meta name="description" content="              简介：&nbsp;本文主要探讨了 java.lang.ref 包的使用方法，以及源码解读。并就该包在不同 JVM 上的表现进行了比较与分析。通过阅读本文，读者可以加深对 java.lang.ref 的理解，从而在开发中更好地利用该包。               概述      Jav...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2018/01/05/weixin_34261415_90133917.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">深入探讨 java.lang.ref 包</h1>
    <p class="post-meta">Jan 5, 2018</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:18px;letter-spacing:-1px;background-image:url(&quot;images/dotsH.gif&quot;);background-position:left bottom;background-repeat:repeat-x;font-weight:normal;line-height:21.6px;color:rgb(51,51,51);font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';"> <strong style="font-family:arial, nsimsun, sans-serif;font-size:12px;line-height:normal;">简介：</strong><span style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:12px;">&nbsp;本文主要探讨了 java.lang.ref 包的使用方法，以及源码解读。并就该包在不同 JVM 上的表现进行了比较与分析。通过阅读本文，读者可以加深对 java.lang.ref 的理解，从而在开发中更好地利用该包。</span><br></h2> 
   <div class="entry" style="line-height:1.8;"> 
    <div class="blogpost-body" style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major1" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">概述</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">Java.lang.ref 是 Java 类库中比较特殊的一个包，它提供了与 Java 垃圾回收器密切相关的引用类。这些引用类对象可以指向其它对象，但它们不同于一般的引用，因为它们的存在并不防碍 Java 垃圾回收器对它们所指向的对象进行回收。其好处就在于使者可以保持对使用对象的引用，同时 JVM 依然可以在内存不够用的时候对使用对象进行回收。因此这个包在用来实现与缓存相关的应用时特别有用。同时该包也提供了在对象的“可达”性发生改变时，进行提醒的机制。本文通过对该包进行由浅入深的介绍与分析，使读者可以加深对该包的理解，从而更好地利用该包进行开发。</p> 
     <div class="ibm-alternate-rule" style="clear:both;background-image:url(&quot;http://1.www.s81c.com/i/solid.gif&quot;);font-family:Simsun;line-height:normal;font-size:medium;background-repeat:repeat-x;"></div> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;clear:both;text-align:right;"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/index.html?ca=drs-#ibm-pcon" rel="nofollow" class="ibm-anchor-up-link" style="text-decoration:none;color:rgb(76,110,148);border-bottom-width:1px;border-bottom-style:dashed;background-image:url(&quot;http://1.www.s81c.com/i/v16/icons/u_bold.gif&quot;);font-weight:bold;background-position:0px -1px;background-repeat:no-repeat;">回页首</a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major2" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">java.lang.ref 包的介绍</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们可以先来看一下 java.lang.ref 这个包的结构，如图 1 所示</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="fig1" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">图 1. java.lang.ref 包结构</strong></a><br style="font-family:Simsun;line-height:normal;font-size:medium;"><img alt="图 1. java.lang.ref 包结构" height="137" src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/image002.jpg" width="196" class="quimby_search_image" style="border:0px;font-family:Simsun;line-height:normal;font-size:medium;"><span style="line-height:normal;font-family:Simsun;font-size:medium;">&nbsp;</span></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">该包中各类的继承关系如图 2 所示</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="fig2" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">图 2. java.lang.ref 包中类的继承关系 :</strong></a><br style="font-family:Simsun;line-height:normal;font-size:medium;"><img alt="图 2. java.lang.ref 包中类的继承关系 :" height="253" src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/image004.jpg" width="553" class="quimby_search_image" style="border:0px;font-family:Simsun;line-height:normal;font-size:medium;"><span style="line-height:normal;font-family:Simsun;font-size:medium;">&nbsp;</span></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">Reference 是一个抽象类，而 SoftReference，WeakReference，PhantomReference 以及 FinalReference 都是继承它的具体类。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">接下来我们来分别介绍和分析强引用以及 java.lang.ref 包下各种虚引用的特性及用法。</p> 
     <div class="ibm-alternate-rule" style="clear:both;background-image:url(&quot;http://1.www.s81c.com/i/solid.gif&quot;);font-family:Simsun;line-height:normal;font-size:medium;background-repeat:repeat-x;"></div> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;clear:both;text-align:right;"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/index.html?ca=drs-#ibm-pcon" rel="nofollow" class="ibm-anchor-up-link" style="text-decoration:none;color:rgb(76,110,148);border-bottom-width:1px;border-bottom-style:dashed;background-image:url(&quot;http://1.www.s81c.com/i/v16/icons/u_bold.gif&quot;);font-weight:bold;background-position:0px -1px;background-repeat:no-repeat;">回页首</a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major3" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">StrongReference, SoftReference, WeakReference 以及 PhantomReference 的特性及用法</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor3.1" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">StrongReference：</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们都知道 JVM 中对象是被分配在堆（heap）上的，当程序行动中不再有引用指向这个对象时，这个对象就可以被垃圾回收器所回收。这里所说的引用也就是我们一般意义上申明的对象类型的变量（如 String, Object, ArrayList 等），区别于原始数据类型的变量（如 int, short, long 等）也称为强引用。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在了解虚引用之前，我们一般都是使用强引用来对对象进行引用。如：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing1" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 1. StrongReference usage</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 String tag = new String("T"); 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">此处的 tag 引用就称之为强引用。而强引用有以下特征：</p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">强引用可以直接访问目标对象。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">强引用所指向的对象在任何时候都不会被系统回收。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">强引用可能导致内存泄漏。</li> 
     </ul>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">我们要讨论的这三种 Reference 较之于强引用而言都属于“弱引用”，也就是他们所引用的对象只要没有强引用，就会根据条件被 JVM 的垃圾回收器所回收，它们被回收的时机以及用法各不相同。下面分别来进行讨论。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor3.2" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">SoftReference：</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">SoftReference 在“弱引用”中属于最强的引用。SoftReference 所指向的对象，当没有强引用指向它时，会在内存中停留一段的时间，垃圾回收器会根据 JVM 内存的使用情况（内存的紧缺程度）以及 SoftReference 的 get() 方法的调用情况来决定是否对其进行回收。（后面章节会用几个实验进行阐述）</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">具体使用一般是通过 SoftReference 的构造方法，将需要用弱引用来指向的对象包装起来。当需要使用的时候，调用 SoftReference 的 get() 方法来获取。当对象未被回收时 SoftReference 的 get() 方法会返回该对象的强引用。如下：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing2" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 2. SoftReference usage</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 SoftReference&lt;Bean&gt; bean = new SoftReference&lt;Bean&gt;(new Bean("name", 10)); 
 System.out.println(bean.get());// “name:10”
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="OLE_LINK3" style="border-bottom-width:1px;border-bottom-style:dashed;">软引用有以下特征：</a></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><a style="border-bottom-width:1px;border-bottom-style:dashed;"></a></p> 
     <a> 软引用使用 get() 方法取得对象的强引用从而访问目标对象。 软引用所指向的对象按照 JVM 的使用情况（Heap 内存是否临近阈值）来决定是否回收。 软引用可以避免 Heap 内存不足所导致的异常。</a>
     <a></a> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"></a></p> 
     <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;">当垃圾回收器决定对其回收时，会先清空它的 SoftReference，也就是说 SoftReference 的 get() 方法将会返回 null，然后再调用对象的 finalize() 方法，并在下一轮 GC 中对其真正进行回收。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a style="border-bottom-width:1px;border-bottom-style:dashed;"></a><a name="minor3.3" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">WeakReference：</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">WeakReference 是弱于 SoftReference 的引用类型。弱引用的特性和基本与软引用相似，区别就在于弱引用所指向的对象只要进行系统垃圾回收，不管内存使用情况如何，永远对其进行回收（get() 方法返回 null）。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">完全可以通过和 SoftReference 一样的方式来操作 WeakReference，这里就不再复述。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">弱引用有以下特征：</p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">弱引用使用 get() 方法取得对象的强引用从而访问目标对象。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">一旦系统内存回收，无论内存是否紧张，弱引用指向的对象都会被回收。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">弱引用也可以避免 Heap 内存不足所导致的异常。</li> 
     </ul>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor3.4" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">PhantomReference：</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">PhantomReference 是所有“弱引用”中最弱的引用类型。不同于软引用和弱引用，虚引用无法通过 get() 方法来取得目标对象的强引用从而使用目标对象，观察源码可以发现 get() 被重写为永远返回 null。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">那虚引用到底有什么作用？其实虚引用主要被用来&nbsp;<strong>跟踪对象被垃圾回收的状态</strong>，通过查看引用队列中是否包含对象所对应的虚引用来判断它是否&nbsp;<strong>即将</strong>被垃圾回收，从而采取行动。它并不被期待用来取得目标对象的引用，而目标对象被回收前，它的引用会被放入一个 ReferenceQueue 对象中，从而达到跟踪对象垃圾回收的作用。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">所以具体用法和之前两个有所不同，它必须传入一个 ReferenceQueue 对象。当虚引用所引用对象被垃圾回收后，虚引用会被添加到这个队列中。如：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing3" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 3. PhantomReference usage</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public static void main(String[] args) { 
 ReferenceQueue&lt;String&gt; refQueue = new ReferenceQueue&lt;String&gt;(); 
 PhantomReference&lt;String&gt; referent = new PhantomReference&lt;String&gt;(
     new String("T"), refQueue); 
 System.out.println(referent.get());// null 

 System.gc(); 
 System.runFinalization(); 

 System.out.println(refQueue.poll() == referent); //true 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">值得注意的是，对于引用回收方面，虚引用类似强引用不会自动根据内存情况自动对目标对象回收，Client 需要自己对其进行处理以防 Heap 内存不足异常。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">虚引用有以下特征：</p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">虚引用永远无法使用 get() 方法取得对象的强引用从而访问目标对象。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">虚引用所指向的对象在被系统内存回收前，虚引用自身会被放入 ReferenceQueue 对象中从而跟踪对象垃圾回收。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">虚引用不会根据内存情况自动回收目标对象。</li> 
     </ul>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">另外值得注意的是，其实 SoftReference, WeakReference 以及 PhantomReference 的构造函数都可以接收一个 ReferenceQueue 对象。当 SoftReference 以及 WeakReference 被清空的同时，也就是 Java 垃圾回收器准备对它们所指向的对象进行回收时，调用对象的 finalize() 方法之前，它们自身会被加入到这个&nbsp;<code style="font-size:small;">ReferenceQueue 对象</code>中，此时可以通过 ReferenceQueue 的 poll() 方法取到它们。而 PhantomReference 只有当 Java 垃圾回收器对其所指向的对象真正进行回收时，会将其加入到这个&nbsp;<code style="font-size:small;">ReferenceQueue 对象</code>中，这样就可以追综对象的销毁情况。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor3.5" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">各种引用类型总结：</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下表对于各种引用类型的特征进行了小结：</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">表 1. 引用类型特性总结</strong></a></p> 
     <table border="0" class="data-table-1" style="border-width:0px 1px 1px;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-right-color:rgb(204,204,204);border-bottom-color:rgb(204,204,204);border-left-color:rgb(204,204,204);border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>引用类型</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>取得目标对象方式</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>垃圾回收条件</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>是否可能内存泄漏</strong></th> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">强引用</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">直接调用</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">可能</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">软引用</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;"> <a name="OLE_LINK5"></a><a name="OLE_LINK4">通过 get() 方法</a> </td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">视内存情况回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不可能</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">弱引用</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">通过 get() 方法</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">永远回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不可能</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">虚引用</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">无法取得</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">可能</td> 
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><strong>注意：</strong></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">如果想使用这些相对强引用来说较弱的引用来进行对象操作的时候，就必须保证没有强引用指向被操作对象。否则将会被视为强引用指向，不会具有任何的弱引用的特性。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">下一章我们将做 2 个实验来佐证上面这些总结的内容。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor3.6" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">StrongReference, SoftReference, WeakReference 以及 PhantomReference 的各种特性实验分析</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">为了更好的描述它们的特性，先以表格进行归纳，再以示例程序加以说明。</p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">JVM 使用 Oracle 的 Java SE6</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">首先将 JVM 运行环境的初始以及最大 Heap 数设到最低以便更明显的看出结果：</li> 
     </ul>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="fig3" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">图 3. 设置 JVM 运行环境初始值</strong></a><br style="font-family:Simsun;line-height:normal;font-size:medium;"><img alt="图 3. 设置 JVM 运行环境初始值" height="310" src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/image006.jpg" width="434" class="quimby_search_image" style="border:0px;font-family:Simsun;line-height:normal;font-size:medium;"><span style="line-height:normal;font-family:Simsun;font-size:medium;">&nbsp;</span></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">接下来就开始我们的实验。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">表 2：各个引用在 GC 后是否被回收？</strong></a></p> 
     <table border="0" class="data-table-1" style="border-width:0px 1px 1px;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-right-color:rgb(204,204,204);border-bottom-color:rgb(204,204,204);border-left-color:rgb(204,204,204);border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>类型</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>GC 后是否回收</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>示例代码</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>运行结果</strong></th> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">StrongReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 3</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">name:10</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">SoftReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 4</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">name:10</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">WeakReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">回收</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 5</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">name:10</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">PhantomReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">N/A</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">N/A</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">N/A</td> 
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing4" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 4</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public static void main(String[] args) { 
 Bean bean = new Bean("name", 10); 
 System.gc(); 
 System.runFinalization(); 

 System.out.println(bean);// “name:10”
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：强引用所指向的对象在任何时候都不会被系统回收。结果输入</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing5" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 5</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public static void main(String[] args) { 
 SoftReference&lt;Bean&gt; bean = new SoftReference&lt;Bean&gt;(new Bean("name", 10)); 
 System.gc(); 
 System.runFinalization(); 

 System.out.println(bean.get());// “name:10”
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="OLE_LINK8" style="border-bottom-width:1px;border-bottom-style:dashed;">总结：软引用所指向的对象会根据内存使用情况来决定是否回收，这里内存还充足，所以不会被回收。</a></p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><br></a><a name="listing6" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 6</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public static void main(String[] args) { 
 WeakReference&lt;Bean&gt; bean = new WeakReference&lt;Bean&gt;(new Bean("name", 10)); 
 System.gc(); 
 System.runFinalization(); 

 System.out.println(bean.get());// “null”
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：弱引用所指向的对象只要进行 GC，就会自动进行回收，get() 返回 null。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">表 3：各个引用创建大量对象时是否导致 Heap 不足异常？</strong></a></p> 
     <table border="0" class="data-table-1" style="border-width:0px 1px 1px;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-right-color:rgb(204,204,204);border-bottom-color:rgb(204,204,204);border-left-color:rgb(204,204,204);border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>类型</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>是否抛出异常</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>示例代码</strong></th> 
        <th style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;background-image:url(&quot;http://dw1.s81c.com/i/v16/t/text-tabs-bg.gif&quot;);font-size:.7em;background-repeat:repeat-x;"><strong>运行结果</strong></th> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">StrongReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">抛出异常</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 6</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">SoftReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">不抛异常，之前的引用自动清空并返回 null</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 7</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">null</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">WeakReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">同上</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 8</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">null</td> 
       </tr>
       <tr>
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">PhantomReference</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">抛出异常</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">见清单 9</td> 
        <td style="border-width:1px;border-style:solid;border-color:#C0C0C0 #C0C0C0;border-collapse:collapse;font-family:arial, nsimsun, sans-serif;vertical-align:top;font-size:.7em;">Exception in thread "main" java.lang.OutOfMemoryError: Java heap space</td> 
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing7" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 7</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
				<a name="OLE_LINK13">public static void main(String[] args) { Bean[] referent = new Bean[100000]; for (int i=0;i&lt;referent.length;i++){ referent[i] = new Bean("mybean:" + i,100);// 抛 Exception } } </a></pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：在新开辟 100000 个 Bean 对象时，由于强引用永远不会被系统回收，当最大 Heap 阈值达到 2m 时，系统就会报出 Heap 不足的异常。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing8" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 8</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
				<a name="OLE_LINK10"></a><a name="OLE_LINK9">public static void main(String[] args) { Reference&lt;Bean&gt;[] referent = new SoftReference[100000]; for (int i=0;i&lt;referent.length;i++){ referent[i] = new SoftReference&lt;Bean&gt;(new Bean("mybean:" + i,100)); } System.out.println(referent[100].get());// “null” } </a></pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：在新开辟 100000 个 Bean 对象时，由于软引用会视内存使用情况来判断是否自动回收，所以当最大 Heap 阈值达到 2m 时，系统自动回收最前面开辟的对象，取第 100 个对象时，返回为 null。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing9" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 9</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public static void main(String[] args) { 
 Reference&lt;Bean&gt;[] referent = new WeakReference[100000]; 
 for (int i=0;i&lt;referent.length;i++){ 
 referent[i] = new WeakReference&lt;Bean&gt;(new Bean("mybean:" + i,100)); 
 } 

 System.out.println(referent[100].get());// “null”
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：WeakReference 与 SoftReference 具有相同的特性，也会视内存使用情况来判断是否自动回收。取第 100 个对象时，返回为 null。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing10" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 10</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
public static void main(String[] args) { 
 Reference&lt;Bean&gt;[] referent = new PhantomReference[100000]; 
 ReferenceQueue&lt;Bean&gt; queue = new ReferenceQueue&lt;Bean&gt;(); 
 for (int i=0;i&lt;referent.length;i++){ 
 referent[i] = new PhantomReference&lt;Bean&gt;(new Bean("mybean:" + i,100), 
 queue);// throw Exception 
 } 

 System.out.println(referent[100].get()); 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">总结：PhantomReference 类似强引用，它不会自动根据内存情况自动对目标对象回收，所以这里在 Heap 里不断开辟新空间，当达到 2m 阈值时，系统报出 OutOfMemoryError 异常。</p> 
     <div class="ibm-alternate-rule" style="clear:both;background-image:url(&quot;http://1.www.s81c.com/i/solid.gif&quot;);font-family:Simsun;line-height:normal;font-size:medium;background-repeat:repeat-x;"></div> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;clear:both;text-align:right;"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/index.html?ca=drs-#ibm-pcon" rel="nofollow" class="ibm-anchor-up-link" style="text-decoration:none;color:rgb(76,110,148);border-bottom-width:1px;border-bottom-style:dashed;background-image:url(&quot;http://1.www.s81c.com/i/v16/icons/u_bold.gif&quot;);font-weight:bold;background-position:0px -1px;background-repeat:no-repeat;">回页首</a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major4" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">FinalReference 以及 Finzlizer</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">FinalReference 作为 java.lang.ref 里的一个不能被公开访问的类，又起到了一个什么样的作用呢？作为他的子类， Finalizer 又在垃圾回收机制里扮演了怎么样的角色呢？</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">实际上，FinalReference 代表的正是 Java 中的强引用，如这样的代码 :</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">Bean bean = new Bean();</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在虚拟机的实现过程中，实际采用了 FinalReference 类对其进行引用。而 Finalizer，除了作为一个实现类外，更是在虚拟机中实现一个 FinalizerThread，以使虚拟机能够在所有的强引用被解除后实现内存清理。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">让我们来看看 Finalizer 是如何工作的。首先，通过声明 FinalizerThread，并将该线程实例化，设置为守护线程后，加入系统线程中去。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing11" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 11</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 static { 
        ThreadGroup tg = Thread.currentThread().getThreadGroup(); 
        for (ThreadGroup tgn = tg; 
             tgn != null; 
             tg = tgn, tgn = tg.getParent()); 
 Thread finalizer = new FinalizerThread(tg); 
 finalizer.setPriority(Thread.MAX_PRIORITY - 2); 
 finalizer.setDaemon(true); 
 finalizer.start(); 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">在 GC 的过程中，当一个强引用被释放，由系统垃圾收集器标记后的对象，会被加入 Finalizer 对象中的 ReferenceQueue 中去，并调用 Finalizer.runFinalizer() 来执行对象的 finalize 方法。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing12" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 12</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 private void runFinalizer() { 
 synchronized (this) { 
    if (hasBeenFinalized()) return; 
    remove(); 
 } 
 try { 
    Object finalizee = this.get(); 
    if (finalizee != null &amp;&amp; !(finalizee instanceof java.lang.Enum)) { 
 invokeFinalizeMethod(finalizee); 
 /* <em>注意，这里需要清空栈中包含该变量的的 slot</em>, 
                   ** 从而来减少因为一个保守的 GC 实现所造成的变量未被回收的假象 */ 
 finalizee = null; 
    } 
 } catch (Throwable x) { } 
 super.clear(); 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">注意，标记处所调用的 invokeFinalizeMethod 为 native 方法，由于 finalize 方法在 Object 类中被声明为 protected，这里必须采用 native 方法才能调用。随后通过将本地强引用设置为空，以便使垃圾回收器清理内存。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">可以看到，通过这样的方法，Java 将四种引用对象类型：软引用 (SoftReference)，弱引用 (WeakReference)，强引用 (FinalReference)，虚引用 (PhantomReference) 平等地对待，并在垃圾回收器中进行统一调度和管理。</p> 
     <div class="ibm-alternate-rule" style="clear:both;background-image:url(&quot;http://1.www.s81c.com/i/solid.gif&quot;);font-family:Simsun;line-height:normal;font-size:medium;background-repeat:repeat-x;"></div> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;clear:both;text-align:right;"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/index.html?ca=drs-#ibm-pcon" rel="nofollow" class="ibm-anchor-up-link" style="text-decoration:none;color:rgb(76,110,148);border-bottom-width:1px;border-bottom-style:dashed;background-image:url(&quot;http://1.www.s81c.com/i/v16/icons/u_bold.gif&quot;);font-weight:bold;background-position:0px -1px;background-repeat:no-repeat;">回页首</a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major5" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">不同 Java 虚拟机上的表现与分析</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">让我们来回顾一下四种引用类型的表现以及在垃圾回收器回收清理内存时的表现 .</p> 
     <ol style="font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">软引用 (SoftReference), 引用类型表现为当内存接近满负荷 , 或对象由 SoftReference.get() 方法的调用没有发生一段时间后 , 垃圾回收器将会清理该对象 . 在运行对象的 finalize 方法前 , 会将软引用对象加入 ReferenceQueue 中去 .</li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">弱引用 (WeakReference), 引用类型表现为当系统垃圾回收器开始回收时 , 则立即会回收该对象的引用 . 与软引用一样 , 弱引用也会在运行对象的 finalize 方法之前将弱引用对象加入 ReferenceQueue.</li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">强引用 (FinalReference), 这是最常用的引用类型 . JVM 系统采用 Finalizer 来管理每个强引用对象 , 并将其被标记要清理时加入 ReferenceQueue, 并逐一调用该对象的 finalize() 方法 .</li> 
      <li style="list-style-type:decimal;font-family:arial, nsimsun, sans-serif;">虚引用 (PhantomReference), 这是一个最虚幻的引用类型 . 无论是从哪里都无法再次返回被虚引用所引用的对象 . 虚引用在系统垃圾回收器开始回收对象时 , 将直接调用 finalize() 方法 , 但不会立即将其加入回收队列 . 只有在真正对象被 GC 清除时 , 才会将其加入 Reference 队列中去 .</li> 
     </ol>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">这里比较两个比较典型的 JVM 环境，Oracle Java SE6 和 IBM JDK 6。采用了如下的测试代码 :</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing13" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 13. 类 RefTestObj</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 public class RefTestObj { 
 private int id; 

 public int getId() { 
 return id; 
 } 

 public void setId(int id) { 
 this.id = id; 
 } 

 @Override 
 public int hashCode() { 
 return super.hashCode(); 
 } 

 @Override 
 public String toString() { 
 return super.toString() + "[id=" + this.id + "]"; 
 } 

 @Override 
 protected void finalize() { 
 System.out.println("Object [" + this.hashCode() + "][
 id=" + this.id + "] come into finalize"); 
 try { 
 super.finalize(); 
 } catch (Throwable e) { 
 e.printStackTrace(); 
 } 
 } 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing14" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 14. 类 RefMainThread</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 import java.lang.ref.PhantomReference; 
 import java.lang.ref.Reference; 
 import java.lang.ref.ReferenceQueue; 
 import java.lang.ref.SoftReference; 
 import java.lang.ref.WeakReference; 

 public class RefMainThread { 
 public static void main(String[] args) { 
 // 创建三种不同的引用类型所需对象
 RefTestObj softRef = new RefTestObj(); 
 RefTestObj weakRef = new RefTestObj(); 
 RefTestObj phanRef = new RefTestObj(); 

 softRef.setId(1); 
 weakRef.setId(2); 
 phanRef.setId(3); 

 ReferenceQueue&lt;RefTestObj&gt; softRefQueue = new ReferenceQueue&lt;RefTestObj&gt;(); 
 ReferenceQueue&lt;RefTestObj&gt; weakRefQueue = new ReferenceQueue&lt;RefTestObj&gt;(); 
 ReferenceQueue&lt;RefTestObj&gt; phanRefQueue = new ReferenceQueue&lt;RefTestObj&gt;(); 

 SoftReference&lt;RefTestObj&gt; softRefObj = 
 new SoftReference&lt;RefTestObj&gt;(softRef, softRefQueue); 
 WeakReference&lt;RefTestObj&gt; weakRefObj = 
 new WeakReference&lt;RefTestObj&gt;(weakRef, weakRefQueue); 
 PhantomReference&lt;RefTestObj&gt; phanRefObj = 
 new PhantomReference&lt;RefTestObj&gt;(phanRef, phanRefQueue); 

 // 打印正常情况下三种对象引用
 print(softRefObj); 
 print(weakRefObj); 
 print(phanRefObj); 

 // 将对象清空
 softRef = null; 
 weakRef = null; 
 phanRef = null; 

 // 打印引用队列及 get() 方法所能取到的对象自身
 if (softRefObj != null) { 
 System.out.println("Soft Reference Object run get():" + softRefObj.get()); 
 System.out.println("Check soft queue:" + softRefQueue.poll()); 
 } 

 if (weakRefObj != null) { 
 System.out.println("Weak Reference Object run get():" + weakRefObj.get()); 
 System.out.println("Check weak queue:" + weakRefQueue.poll()); 
 } 

 if (phanRefObj != null) { 
 System.out.println("Phantom Reference Object run get():" + phanRefObj.get()); 
 System.out.println("Check Phantom queue:" + phanRefQueue.poll()); 
 } 

 // 开始执行垃圾回收
 System.gc(); 
 System.runFinalization(); 


 // 检查队列，是否已经被加入队列，是否还能取回对象
 if (softRefObj != null) { 
 System.out.println("Soft Reference Object run get():" + softRefObj.get()); 
 System.out.println("Check soft queue:" + softRefQueue.poll()); 
 } 

 if (weakRefObj != null) { 
 System.out.println("Weak Reference Object run get():" + weakRefObj.get()); 
 System.out.println("Check weak queue:" + weakRefQueue.poll()); 
 } 

 if (phanRefObj != null) { 
 System.out.println("Phantom Reference Object run get():" + phanRefObj.get()); 
 System.out.println("Check Phantom queue:" + phanRefQueue.poll()); 
 } 

 // 对于虚引用对象，在经过多次 GC 之后， 才会加入到队列中去
 Reference&lt;? extends RefTestObj&gt; mynewphan = null; 
 int refCount = 1; 
 while (mynewphan == null) { 
 mynewphan = phanRefQueue.poll(); 
 System.gc(); 
 System.runFinalization(); 
 if (mynewphan != null) { 
 System.out.println("Check Phantom queue:" + mynewphan); 
 System.out.println("Count for " + refCount + " times"); 
 break; 
 } 
 refCount ++; 
 } 
 } 

 public static void print(Reference&lt;RefTestObj&gt; ref) { 
 RefTestObj obj = ref.get(); 
 System.out.println("The Reference is " + ref.toString() + " and with object " + obj +
      " which is " + (obj == null ? "null" : "not null")); 
 } 
 } 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">通过执行 RefMainThread, 我们可以清晰地根据打印结果看到对象在内存中被加入队列 , 以及调用 finalize 方法的顺序及过程 .</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">为了测试不同的 JVM 环境并消除其他因素的印象 , 本例采用的背景环境均为 Windows2003 下的 32bit JVM.</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">首先采用了环境为 Oracle Java SE 6 update 23 进行测试 , 结果如下 :</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing15" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 15. Oracle Java SE 6 update 23 下测试结果</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 The Reference is java.lang.ref.SoftReference@c17164 and 
 with object RefTestObj@1fb8ee3[id=1] which is not null 
 The Reference is java.lang.ref.WeakReference@61de33 and 
 with object RefTestObj@14318bb[id=2] which is not null 
 The Reference is java.lang.ref.PhantomReference@ca0b6 and with object null which is null 
 Soft Reference Object run get():RefTestObj@1fb8ee3[id=1] 
 Check soft queue:null 
 Weak Reference Object run get():RefTestObj@14318bb[id=2] 
 Check weak queue:null 
 Phantom Reference Object run get():null 
 Check Phantom queue:null 
 Object [27744459][id=3] come into finalize 
 Object [21174459][id=2] come into finalize 
 Soft Reference Object run get():RefTestObj@1fb8ee3[id=1] 
 Check soft queue:null 
 Weak Reference Object run get():null 
 Check weak queue:java.lang.ref.WeakReference@61de33 
 Phantom Reference Object run get():null 
 Check Phantom queue:null 
 Check Phantom queue:java.lang.ref.PhantomReference@ca0b6 
 Count for 2 times 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">可以看到 , 当运行了系统回收后 , 虚引用与弱引用被回收 , 由于内存并不吃紧 , 软引用依然保持原样 . 弱引用立即被加入了队列 , 而虚引用则在循环两次的手动调用 GC 后被加入了队列 . 其次 , 采用的环境是 IBM JDK 6, 结果如下 :</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"><br style="font-family:Simsun;line-height:normal;font-size:medium;"><a name="listing16" style="border-bottom-width:1px;border-bottom-style:dashed;font-family:Simsun;line-height:normal;font-size:medium;"><strong style="font-size:.76em;font-family:arial, sans-serif;">清单 16. IBM JDK 6 下测试结果</strong></a></p> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-size:.8em;color:rgb(0,0,0);font-family:Simsun;">
      <tbody>
       <tr>
        <td class="code-outline" style="border:1px solid rgb(204,204,204);border-collapse:collapse;font-family:arial, nsimsun, sans-serif;"><pre class="displaycode">				
 The Reference is java.lang.ref.SoftReference@3a2c3a2c and 
 with object RefTestObj@391e391e[id=1] which is not null 
 The Reference is java.lang.ref.WeakReference@3a303a30 and 
 with object RefTestObj@39203920[id=2] which is not null 
 The Reference is java.lang.ref.PhantomReference@3a353a35 
 and with object null which is null 
 Soft Reference Object run get():RefTestObj@391e391e[id=1] 
 Check soft queue:null 
 Weak Reference Object run get():RefTestObj@39203920[id=2] 
 Check weak queue:null 
 Phantom Reference Object run get():null 
 Check Phantom queue:null 
 Object [958544162][id=3] come into finalize 
 Object [958413088][id=2] come into finalize 
 Soft Reference Object run get():RefTestObj@391e391e[id=1] 
 Check soft queue:null 
 Weak Reference Object run get():null 
 Check weak queue:java.lang.ref.WeakReference@3a303a30 
 Phantom Reference Object run get():null 
 Check Phantom queue:null 
 Object [958282014][id=1] come into finalize 
 ............ 
</pre></td>
       </tr>
      </tbody>
     </table>
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">程序运行到这里进入了无限循环，必须手动终止。比对上下两份结果可以看到，当多次运行系统垃圾回收后，IBM JVM 将软引用一并加入了回收队列中，并运行了其 finalize 方法。另外，即使经过很多次系统垃圾回收，虚引用也没有被加入到队列中去。不知道这是不是 IBM JVM 的一个小小的 BUG 所在。</p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="minor5.1" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="smalltitle" style="line-height:1.8;font-size:1.2em;font-weight:bold;">结论</span></a></p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">SoftReference 中 Oracle JVM 的表现满足规范，只当内存不足时才进行回收。而 IBM JVM 的策略则更为积极，在内存尚且充足的情况下也进行了回收，值得注意。</li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">PhantomReference 中 Oracle JVM 的表现满足规范，执行 finalize 后若干次 GC 就被添加到了 Queue 中。而 IBM JVM 则始终没有被添加到 Queue 中导致了死循环。所以在使用 PhantomReference 时出现类似的情况时，可以考虑是否是因为使用了不同 JVM 所导致。</li> 
     </ul>
     <div class="ibm-alternate-rule" style="clear:both;background-image:url(&quot;http://1.www.s81c.com/i/solid.gif&quot;);font-family:Simsun;line-height:normal;font-size:medium;background-repeat:repeat-x;"></div> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;clear:both;text-align:right;"><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/index.html?ca=drs-#ibm-pcon" rel="nofollow" class="ibm-anchor-up-link" style="text-decoration:none;color:rgb(76,110,148);border-bottom-width:1px;border-bottom-style:dashed;background-image:url(&quot;http://1.www.s81c.com/i/v16/icons/u_bold.gif&quot;);font-weight:bold;background-position:0px -1px;background-repeat:no-repeat;">回页首</a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="major6" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">小结</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;">本文深入地介绍了 java.lang.ref 包使用方法，并结合实验分析了包内不同类的表现。同时对该包在不同 Java 虚拟机上的表现进行了深入地分析。</p> 
     <p style="line-height:1.8;font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';font-size:15px;"></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="resources" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">参考资料</span></a></p> 
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><strong>学习</strong></p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://download.oracle.com/javase/6/docs/" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">《 Java 2 标准版 6 文档》</a>关于 java.lang.ref 包的帮助文档，这是 Oracle 公司提供的标准文档，里面包含的所有 Oracle 公司提供的 Java 2 SE 6 实现的帮助文档。<br><br></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://www.amazon.cn/%E7%96%AF%E7%8B%82Java-%E7%AA%81%E7%A0%B4%E7%A8%8B%E5%BA%8F%E5%91%98%E5%9F%BA%E6%9C%AC%E5%8A%9F%E7%9A%8416%E8%AF%BE-%E6%9D%8E%E5%88%9A/dp/B003H4PKA6" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">《疯狂 java-- 突破程序员基本功的 16 课》第 4 课 Java 的内存回收</a>, 李刚，该书讲述了大部分 Java 程序员容易忽视的细节性问题。<br><br></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://www.ibm.com/developerworks/cn/java/i-garbage2/index.html?ca=drs-" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">《出色的 “清洁工具”—— 理解 IBM Java 垃圾收集器》，第 2 部分 : 垃圾收集 Sam Borman</a>，在本文中，Sam Borman 回顾了垃圾收集的工作原理，并描述了 GC 的主要三个阶段：标记、清理和压缩。他还讨论了并发标记和并行按位（bitwise）清理。本文简要讨论了引用对象、堆扩展和堆收缩。<br><br></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://weblogs.java.net/blog/2006/05/04/understanding-weak-references" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">《 Understanding Weak References 》Ethan Nicholas</a>，该文是&nbsp;<a href="http://weblogs.java.net/blog/194311" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">Ethan Nicholas</a>在面试 Java 开发人员过程中发现的一些问题和其在项目实践中对 Weak References 的理解。<br><br></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://www.javaworld.com/javaworld/jw-01-2002/jw-0104-java101.html" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">《 Trash talk 》， Part 2 The Reference Objects API allows programs to interact with the garbage collector，Jeff Friesen</a>，论文讲述了如何利用 Java 的 reference API 来管理图像缓存以及当重要对象失去强引用时如何收到通知并做一些相应对象回收后的清理工作。<br><br></li> 
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;"> <a href="http://www.ibm.com/developerworks/java" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">developerWorks Java 技术专区</a>：这里有数百篇关于 Java 编程各个方面的文章。&nbsp;<br><br></li> 
     </ul>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><strong>讨论</strong></p> 
     <ul style="list-style:none;font-size:.76em;font-family:Simsun;line-height:normal;">
      <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;font-family:arial, nsimsun, sans-serif;">加入&nbsp;<a href="http://www.ibm.com/developerworks/cn/community/" rel="nofollow" style="text-decoration:none;color:rgb(76,110,148);">developerWorks 中文社区</a>。查看开发人员推动的博客、论坛、组和维基，并与其他 developerWorks 用户交流。<br><br></li>
     </ul>
     <p style="line-height:normal;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="author" style="border-bottom-width:1px;border-bottom-style:dashed;"><span class="atitle" style="line-height:1.8;font-size:1.5em;font-weight:bold;">作者简介</span></a></p> 
     <div class="ibm-container ibm-portrait-module ibm-alternate-two" style="border-top:1px solid rgb(204,204,204);font-family:Simsun;line-height:normal;font-size:medium;"> 
      <div class="ibm-container-body" style="background-image:url(&quot;http://1.www.s81c.com/i/v16/t/container-gradient.gif&quot;);border-bottom:1px solid rgb(204,204,204);border-left:1px solid rgb(204,204,204);border-right:1px solid rgb(204,204,204);background-position:0px 100%;background-repeat:repeat-x;"> 
       <img src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/zhouxiang.jpg" class="dw-author-img quimby_search_image" width="64" height="80" alt="/developerworks/cn/java/j-lo-langref/zhouxiang.jpg" style="border:0px;">
       <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="author1" style="border-bottom-width:1px;border-bottom-style:dashed;"></a>周祥，毕业于复旦大学计算机系，现在 ebay 从事平台架构开发。之前在 IBM STG 部门从事了 4 年多的系统管理软件开发，有丰富的 Java/J2EE 项目开发经验。</p> 
      </div> 
      <div class="ibm-container-body" style="background-image:url(&quot;http://1.www.s81c.com/i/v16/t/container-gradient.gif&quot;);border-bottom:1px solid rgb(204,204,204);border-left:1px solid rgb(204,204,204);border-right:1px solid rgb(204,204,204);background-position:0px 100%;background-repeat:repeat-x;"> 
       <img src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/caiming.jpg" class="dw-author-img quimby_search_image" width="64" height="80" alt="/developerworks/cn/java/j-lo-langref/caiming.jpg" style="border:0px;">
       <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="author2" style="border-bottom-width:1px;border-bottom-style:dashed;"></a>蔡敏具有多年大型 Java 企业管理软件开发及管理经验。主要专攻 Java Web 及 OSGi Plugin 应用程序开发。善于应用成熟流行技术快速设计完成电子商务站点，对软件工程也有独到的见解。</p> 
      </div> 
      <div class="ibm-container-body" style="background-image:url(&quot;http://1.www.s81c.com/i/v16/t/container-gradient.gif&quot;);border-bottom:1px solid rgb(204,204,204);border-left:1px solid rgb(204,204,204);border-right:1px solid rgb(204,204,204);background-position:0px 100%;background-repeat:repeat-x;"> 
       <img src="http://www.ibm.com/developerworks/cn/java/j-lo-langref/zhangjm.gif" class="dw-author-img quimby_search_image" width="64" height="80" alt="/developerworks/cn/java/j-lo-langref/zhangjm.gif" style="border:0px;">
       <p style="line-height:1.8;font-family:arial, nsimsun, sans-serif;font-size:.76em;"><a name="author3" style="border-bottom-width:1px;border-bottom-style:dashed;"></a>张嘉鸣，1997 年加入 IBM STG 部门，从事系统管理软件的开发。他具有多年的 Java/J2EE 项目的开发经验。</p> 
      </div> 
     </div> 
    </div> 
    <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <br> ==============================================================================
    </div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;">本文转自被遗忘的博客园博客，原文链接：http://www.cnblogs.com/rollenholt/archive/2011/09/21/2183077.html，如需转载请自行联系原作者</span></font>
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
