<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>About Cast in C++(C++中的类型转换) « NotBeCN</title>
  <meta name="description" content="             原文：http://hi.baidu.com/_%E2d_%B7%B3_%DE%B2%C2%D2/blog/item/b46a27d9dc50c0ed39012f8f.html                     C&nbsp;风格（C-style）强制转型如下：          ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2018/01/05/weixin_34128411_90131958.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">About Cast in C++(C++中的类型转换)</h1>
    <p class="post-meta">Jan 5, 2018</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:18px;letter-spacing:-1px;background-image:url(&quot;images/dotsH.gif&quot;);background-position:left bottom;background-repeat:repeat-x;font-weight:normal;line-height:21.6px;color:rgb(51,51,51);font-family:Merriweather, Georgia, '微软雅黑', '黑体', '宋体';">原文：<a href="http://hi.baidu.com/_%E2d_%B7%B3_%DE%B2%C2%D2/blog/item/b46a27d9dc50c0ed39012f8f.html" rel="nofollow" style="font-size:15px;text-decoration:none;color:rgb(61,129,238);border-bottom-width:1px;border-bottom-style:dashed;">http://hi.baidu.com/_%E2d_%B7%B3_%DE%B2%C2%D2/blog/item/b46a27d9dc50c0ed39012f8f.html</a><br></h2> 
   <div class="entry" style="line-height:1.8;"> 
    <div class="blogpost-body" style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <div>
      C&nbsp;风格（C-style）强制转型如下：
     </div> 
     <div>
      (T) exdivssion // cast exdivssion to be of type T
     </div> 
     <div>
      函数风格（Function-style）强制转型使用这样的语法：
     </div> 
     <div>
      T(exdivssion) // cast exdivssion to be of type T
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      这两种形式之间没有本质上的不同，它纯粹就是一个把括号放在哪的问题。我把这两种形式称为旧风格（old-style）的强制转型。
     </div> 
     <div>
      使用标准C++的类型转换符：static_cast、dynamic_cast、reinterdivt_cast、和const_cast。
     </div> 
     <div>
      3.1 static_cast
      <br> 用法：static_cast &lt; type-id &gt; ( exdivssion )&nbsp;
      <br> 该运算符把exdivssion转换为type-id类型，但没有运行时类型检查来保证转换的安全性。它主要有如下几种用法：
      <br> ①用于类层次结构中基类和子类之间指针或引用的转换。
      <br> 进行上行转换（把子类的指针或引用转换成基类表示）是安全的；
      <br> 进行下行转换（把基类指针或引用转换成子类表示）时，由于没有动态类型检查，所以是不安全的。
      <br> ②用于基本数据类型之间的转换，如把int转换成char，把int转换成enum。这种转换的安全性也要开发人员来保证。
      <br> ③把空指针转换成目标类型的空指针。
      <br> ④把任何类型的表达式转换成void类型。
     </div> 
     <div>
      注意：static_cast不能转换掉exdivssion的const、volitale、或者__unaligned属性。
     </div> 
     <div> 
      <br> 3.2 dynamic_cast
      <br> 用法：dynamic_cast &lt; type-id &gt; ( exdivssion )
      <br> 该运算符把exdivssion转换成type-id类型的对象。Type-id必须是类的指针、类的引用或者void *；
      <br> 如果type-id是类指针类型，那么exdivssion也必须是一个指针，如果type-id是一个引用，那么exdivssion也必须是一个引用。
     </div> 
     <div>
      dynamic_cast主要用于类层次间的上行转换和下行转换，还可以用于类之间的交叉转换。
      <br> 在类层次间进行上行转换时，dynamic_cast和static_cast的效果是一样的；
      <br> 在进行下行转换时，dynamic_cast具有类型检查的功能，比static_cast更安全。
      <br> class B{
      <br> public:
      <br> int m_iNum;
      <br> virtual void foo();
      <br> };
     </div> 
     <div>
      class D:public B{
      <br> public:
      <br> char *m_szName[100];
      <br> };
     </div> 
     <div>
      void func(B *pb){
      <br> D *pd1 = static_cast(pb);
      <br> D *pd2 = dynamic_cast(pb);
      <br> }
     </div> 
     <div>
      在上面的代码段中，如果pb指向一个D类型的对象，pd1和pd2是一样的，并且对这两个指针执行D类型的任何操作都是安全的；
      <br> 但是，如果pb指向的是一个B类型的对象，那么pd1将是一个指向该对象的指针，对它进行D类型的操作将是不安全的（如访问m_szName），
      <br> 而pd2将是一个空指针。
     </div> 
     <div>
      另外要注意：B要有虚函数，否则会编译出错；static_cast则没有这个限制。
      <br> 这是由于运行时类型检查需要运行时类型信息，而这个信息存储在类的虚函数表（
      <br> 关于虚函数表的概念，详细可见）中，只有定义了虚函数的类才有虚函数表，
      <br> 没有定义虚函数的类是没有虚函数表的。
     </div> 
     <div>
      另外，dynamic_cast还支持交叉转换（cross cast）。如下代码所示。
      <br> class A{
      <br> public:
      <br> int m_iNum;
      <br> virtual void f(){}
      <br> };
     </div> 
     <div>
      class B:public A{
      <br> };
     </div> 
     <div>
      class D:public A{
      <br> };
     </div> 
     <div>
      void foo(){
      <br> B *pb = new B;
      <br> pb-&gt;m_iNum = 100;
     </div> 
     <div>
      D *pd1 = static_cast(pb); //compile error
      <br> D *pd2 = dynamic_cast(pb); //pd2 is NULL
      <br> delete pb;
      <br> }
     </div> 
     <div>
      在函数foo中，使用static_cast进行转换是不被允许的，将在编译时出错；而使用&nbsp;dynamic_cast的转换则是允许的，结果是空指针。
     </div> 
     <div> 
      <br> 3.3 reindivter_cast
      <br> 用法：reindivter_cast (exdivssion)
      <br> type-id必须是一个指针、引用、算术类型、函数指针或者成员指针。
      <br> 它可以把一个指针转换成一个整数，也可以把一个整数转换成一个指针（先把一个指针转换成一个整数，
      <br> 在把该整数转换成原类型的指针，还可以得到原先的指针值）。
     </div> 
     <div>
      该运算符的用法比较多。
     </div> 
     <div>
      3.4 const_cast&nbsp;
      <br> 用法：const_cast (exdivssion)
      <br> 该运算符用来修改类型的const或volatile属性。除了const&nbsp;或volatile修饰之外，&nbsp;type_id和exdivssion的类型是一样的。
      <br> 常量指针被转化成非常量指针，并且仍然指向原来的对象；
      <br> 常量引用被转换成非常量引用，并且仍然指向原来的对象；常量对象被转换成非常量对象。
     </div> 
     <div>
      Voiatile和const类试。举如下一例：
      <br> class B{
      <br> public:
      <br> int m_iNum;
      <br> }
      <br> void foo(){
      <br> const B b1;
      <br> b1.m_iNum = 100; //comile error
      <br> B b2 = const_cast(b1);
      <br> b2. m_iNum = 200; //fine
      <br> }
      <br> 上面的代码编译时会报错，因为b1是一个常量对象，不能对它进行改变；
      <br> 使用const_cast把它转换成一个常量对象，就可以对它的数据成员任意改变。注意：b1和b2是两个不同的对象。
      <br>
     </div> 
     <div>
      == ===========================================
     </div> 
     <div>
      == dynamic_cast .vs. static_cast&nbsp;
      <br> == ===========================================
     </div> 
     <div>
      class B { ... };&nbsp;
      <br> class D : public B { ... };
     </div> 
     <div>
      void f(B* pb)&nbsp;
      <br> {
     </div> 
     <div>
      D* pd1 = dynamic_cast(pb);
     </div> 
     <div>
      D* pd2 = static_cast(pb);&nbsp;
      <br> }
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      If pb really points to an object of type D, then pd1 and pd2 will get the same value. They will also get the same value if pb == 0.
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      If pb points to an object of type B and not to the complete D class, then dynamic_cast will know enough to return zero. However, static_cast relies on the programmer’s assertion that pb points to an object of type D and simply returns a pointer to that supposed D object.
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      即dynamic_cast可用于继承体系中的向下转型，即将基类指针转换为派生类指针，比static_cast更严格更安全。dynamic_cast在执行效率上比static_cast要差一些，但static_cast在更宽上范围内可以完成映射，这种不加限制的映射伴随着不安全性。static_cast覆盖的变换类型除类层次的静态导航以外，还包括无映射变换、窄化变换(这种变换会导致对象切片,丢失信息)、用VOID*的强制变换、隐式类型变换等...
     </div> 
     <div> 
      <br> == ===========================================
      <br> == static_cast .vs. reinterdivt_cast&nbsp;
      <br> == ================================================
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      reinterdivt_cast是为了映射到一个完全不同类型的意思，这个关键词在我们需要把类型映射回原有类型时用到它。我们映射到的类型仅仅是为了故弄玄虚和其他目的，这是所有映射中最危险的。(这句话是C++编程思想中的原话)
     </div> 
     <div>
      static_cast&nbsp;和&nbsp;reinterdivt_cast&nbsp;操作符修改了操作数类型。它们不是互逆的；&nbsp;static_cast&nbsp;在编译时使用类型信息执行转换，在转换执行必要的检测(诸如指针越界计算,&nbsp;类型检查).&nbsp;其操作数相对是安全的。另一方面；reinterdivt_cast&nbsp;仅仅是重新解释了给出的对象的比特模型而没有进行二进制转换，例子如下：
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      int n=9; double d=static_cast &lt; double &gt; (n);
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      上面的例子中,&nbsp;我们将一个变量从&nbsp;int&nbsp;转换到&nbsp;double。这些类型的二进制表达式是不同的。要将整数&nbsp;9&nbsp;转换到双精度整数&nbsp;9，static_cast&nbsp;需要正确地为双精度整数&nbsp;d补足比特位。其结果为&nbsp;9.0。而reinterdivt_cast&nbsp;的行为却不同:
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      int n=9;
     </div> 
     <div>
      double d=reinterdivt_cast (n);
     </div> 
     <div> 
      <br> 这次,&nbsp;结果有所不同.&nbsp;在进行计算以后, d&nbsp;包含无用值.&nbsp;这是因为&nbsp;reinterdivt_cast&nbsp;仅仅是复制&nbsp;n&nbsp;的比特位到&nbsp;d,&nbsp;没有进行必要的分析.
     </div> 
     <div>
      &nbsp;
     </div> 
     <div>
      因此,&nbsp;你需要谨慎使用&nbsp;reinterdivt_cast.
     </div> 
    </div> 
    <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"> 
     <br> ==============================================================================
    </div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;">本文转自被遗忘的博客园博客，原文链接：http://www.cnblogs.com/rollenholt/articles/2420407.html，如需转载请自行联系原作者</span></font>
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
