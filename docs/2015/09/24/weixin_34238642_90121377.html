<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>大内高手—常见内存错误 « NotBeCN</title>
  <meta name="description" content="             &nbsp;    &nbsp;转自：http://blog.chinaunix.net/uid-23228758-id-4355524.html    &nbsp;    随着诸如代码重构和单元测试等方法引入实践，调试技能渐渐弱化了，甚至有人主张废除调试器。这是有道理的，原因在于调试的...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2015/09/24/weixin_34238642_90121377.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">大内高手—常见内存错误</h1>
    <p class="post-meta">Sep 24, 2015</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>&nbsp;</p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;转自：<a href="http://blog.chinaunix.net/uid-23228758-id-4355524.html" rel="nofollow">http://blog.chinaunix.net/uid-23228758-id-4355524.html</a></span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">随着诸如代码重构和单元测试等方法引入实践，调试技能渐渐弱化了，甚至有人主张废除调试器。这是有道理的，原因在于调试的代价往往太大了，特别是调试系统集成之后的<span style="font-family:'Times New Roman';">BUG</span>，一个<span style="font-family:'Times New Roman';">BUG</span>花了几天甚至数周时间并非罕见。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">而这些难以定位的<span style="font-family:'Times New Roman';">BUG</span>基本上可以归为两类：内存错误和并发问题。而又以内存错误最为普遍，即使是久经沙场的老手，也有时也难免落入陷阱。前事不忘，后世之师，了解这些常见的错误，在编程时就加以注意，把出错的概率降到最低，可以节省不少时间。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">这些列举一些常见的内存错误，供新手参考。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">1.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">内存泄露。</span></p> 
   <p><span style="font-size:medium;">大家都知道，在堆上分配的内存，如果不再使用了，应该把它释放掉，以便后面其它地方可以重用。在<span style="font-family:'Times New Roman';">C/C++</span>中，内存管理器不会帮你自动回收不再使用的内存。如果你忘了释放不再使用的内存，这些内存就不能被重用，就造成了所谓的内存泄露。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">把 内存泄露列为首位，倒并不是因为它有多么严重的后果，而因为它是最为常见的一类错误。一两处内存泄露通常不至于让程序崩溃，也不会出现逻辑上的错误，加上 进程退出时，系统会自动释放该进程所有相关的内存，所以内存泄露的后果相对来说还是比较温和的。当然了，量变会产生质变，一旦内存泄露过多以致于耗尽内 存，后续内存分配将会失败，程序可能因此而崩溃。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">现在的<span style="font-family:'Times New Roman';">PC</span>机内存够大了，加上进程有独立的内存空间，对于一些小程序来说，内存泄露已经不是太大的威胁。但对于大型软件，特别是长时间运行的软件，或者嵌入式系统来说，内存泄露仍然是致命的因素之一。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">不管在什么情况下，采取比较谨慎的态度，杜绝内存泄露的出现，都是可取的。相反，认为内存有的是，对内存泄露放任自流都不是负责的。尽管一些工具可以帮助我们检查内存泄露问题，我认为还是应该在编程时就仔细一点，及早排除这类错误，工具只是用作验证的手段。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">2.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">内存越界访问。</span></p> 
   <p><span style="font-size:medium;">内 存越界访问有两种：一种是读越界，即读了不属于自己的数据，如果所读的内存地址是无效的，程度立刻就崩溃了。如果所读内存地址是有效的，在读的时候不会出 问题，但由于读到的数据是随机的，它会产生不可预料的后果。另外一种是写越界，又叫缓冲区溢出。所写入的数据对别人来说是随机的，它也会产生不可预料的后 果。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">内存越界访问造成的后果非常严重，是程序稳定性的致命威胁之一。更麻烦的是，它造成的后果是随机的，表现出来的症状和时机也是随机的，让<span style="font-family:'Times New Roman';">BUG</span>的现象和本质看似没有什么联系，这给<span style="font-family:'Times New Roman';">BUG</span>的定位带来极大的困难。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">一 些工具可以够帮助检查内存越界访问的问题，但也不能太依赖于工具。内存越界访问通常是动态出现的，即依赖于测试数据，在极端的情况下才会出现，除非精心设 计测试数据，工具也无能为力。工具本身也有一些限制，甚至在一些大型项目中，工具变得完全不可用。比较保险的方法还是在编程是就小心，特别是对于外部传入 的参数要仔细检查。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">3.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">野指针。</span></p> 
   <p><span style="font-size:medium;">野指针是指那些你已经释放掉的内存指针。当你调用<span style="font-family:'Times New Roman';">free(p)</span>时，你真正清楚这个动作背后的内容吗？你会说<span style="font-family:'Times New Roman';">p</span>指向的内存被释放了。没错，<span style="font-family:'Times New Roman';">p</span>本身有变化吗？答案是<span style="font-family:'Times New Roman';">p</span>本身没有变化。它指向的内存仍然是有效的，你继续读写<span style="font-family:'Times New Roman';">p</span>指向的内存，没有人能拦得住你。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">释放掉的内存会被内存管理器重新分配，此时，野指针指向的内存已经被赋予新的意义。对野指针指向内存的访问，无论是有意还是无意的，都为此会付出巨大代价，因为它造成的后果，如同越界访问一样是不可预料的。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">释放内存后立即把对应指针置为空值，这是避免野指针常用的方法。这个方法简单有效，只是要注意，当然指针是从函数外层传入的时，在函数内把指针置为空值，对外层的指针没有影响。比如，你在析构函数里把<span style="font-family:'Times New Roman';">this</span>指针置为空值，没有任何效果，这时应该在函数外层把指针置为空值。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">4.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">访问空指针。</span></p> 
   <p><span style="font-size:medium;">空指针在<span style="font-family:'Times New Roman';">C/C++</span>中占有特殊的地址，通常用来判断一个指针的有效性。空指针一般定义为<span style="font-family:'Times New Roman';">0</span>。现代操作系统都会保留从<span style="font-family:'Times New Roman';">0</span>开始的一块内存，至于这块内存有多大，视不同的操作系统而定。一旦程序试图访问这块内存，系统就会触发一个异常。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">操作系统为什么要保留一块内存，而不是仅仅保留一个字节的内存呢？原因是：一般内存管理都是按页进行管理的，无法单纯保留一个字节，至少要保留一个页面。保留一块内存也有额外的好处，可以检查诸如<span style="font-family:'Times New Roman';">p=NULL; p[1]</span>之类的内存错误。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">在一些嵌入式系统<span style="font-family:'Times New Roman';">(</span>如<span style="font-family:'Times New Roman';">arm7)</span>中，从<span style="font-family:'Times New Roman';">0</span>开始的一块内存是用来安装中断向量的，没有<span style="font-family:'Times New Roman';">MMU</span>的保护，直接访问这块内存好像不会引发异常。不过这块内存是代码段的，不是程序中有效的变量地址，所以用空指针来判断指针的有效性仍然可行。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">在访问指针指向的内存时，在确保指针不是空指针。访问空指针指向的内存，通常会导致程度崩溃，或者不可预料的错误。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">5.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">引用未初始化的变量。</span></p> 
   <p><span style="font-size:medium;">未初始化变量的内容是随机的<span style="font-family:'Times New Roman';">(</span>像<span style="font-family:'Times New Roman';">VC</span>一类的编译器会把它们初始化为固定值，如<span style="font-family:'Times New Roman';">0xcc)</span>，使用这些数据会造成不可预料的后果，调试这样的<span style="font-family:'Times New Roman';">BUG</span>也是非常困难的。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">对于态度严谨的程度员来说，防止这类<span style="font-family:'Times New Roman';">BUG</span>非常容易。在声明变量时就对它进行初始化，是一个编程的好习惯。另外也要重视编译器的警告信息，发现有引用未初始化的变量，立即修改过来。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">6.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">不清楚指针运算。</span></p> 
   <p><span style="font-size:medium;">对于一些新手来说，指针常常让他们犯糊涂。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">比如<span style="font-family:'Times New Roman';">int *p = …; p+1</span>等于<span style="font-family:'Times New Roman';">(size_t)p + 1</span>吗</span></p> 
   <p><span style="font-size:medium;">老手自然清楚，新手可能就搞不清了。事实上<span style="font-family:'Times New Roman';">, p+n&nbsp;</span>等于<span style="font-family:'Times New Roman';">&nbsp;(size_t)p + n * sizeof(*p)</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">指针是<span style="font-family:'Times New Roman';">C/C++</span>中最有力的武器，功能非常强大，无论是变量指针还是函数指针，都应该掌握都非常熟练。只要有不确定的地方，马上写个小程序验证一下。对每一个细节都了然于胸，在编程时会省下不少时间。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">7.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">结构的成员顺序变化引发的错误。</span></p> 
   <p><span style="font-size:medium;">在初始化一个结构时，老手可能很少像新手那样老老实实的，一个成员一个成员的为结构初始化，而是采用快捷方式，如：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">Struct&nbsp;s</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;l;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;p;</span></p> <p align="left"><span style="font-family:'Times New Roman';">};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char*&nbsp;argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;s&nbsp;s1&nbsp;= {4,&nbsp;"abcd"};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p><span style="font-family:'Times New Roman';">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">以 上这种方式是非常危险的，原因在于你对结构的内存布局作了假设。如果这个结构是第三方提供的，他很可能调整结构中成员的相对位置。而这样的调整往往不会在 文档中说明，你自然很少去关注。如果调整的两个成员具有相同数据类型，编译时不会有任何警告，而程序的逻辑上可能相距十万八千里了。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">正确的初始化方法应该是（当然，一个成员一个成员的初始化也行）：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">struct&nbsp;s</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;l;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;p;</span></p> <p align="left"><span style="font-family:'Times New Roman';">};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char*&nbsp;argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;s&nbsp;s1&nbsp;= {.l=4, .p&nbsp;=&nbsp;"abcd"};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;s&nbsp;s2&nbsp;= {l:4,&nbsp;p:"abcd"};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p><span style="font-family:'Times New Roman';">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">8.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">结构的大小变化引发的错误。</span></p> 
   <p><span style="font-size:medium;">我们看看下面这个例子：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">struct&nbsp;base</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n;</span></p> <p align="left"><span style="font-family:'Times New Roman';">};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">struct&nbsp;s</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;base&nbsp;b;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;m;</span></p> <p><span style="font-family:'Times New Roman';">};</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">在<span style="font-family:'Times New Roman';">OOP</span>中，我们可以认为第二个结构继承了第一结构，这有什么问题吗？当然没有，这是<span style="font-family:'Times New Roman';">C</span>语言中实现继承的基本手法。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">现在假设第一个结构是第三方提供的，第二个结构是你自己的。第三方提供的库是以<span style="font-family:'Times New Roman';">DLL</span>方式分发的，<span style="font-family:'Times New Roman';">DLL</span>最大好处在于可以独立替换。但随着软件的进化，问题可能就来了。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">当第三方在第一个结构中增加了一个新的成员<span style="font-family:'Times New Roman';">int k;</span>，编译好后把<span style="font-family:'Times New Roman';">DLL</span>给你，你直接给了客户了。程序加载时不会有任何问题，在运行逻辑可能完全改变！原因是两个结构的内存布局重叠了。解决这类错误的唯一办法就是全部重新相关的代码。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">解决这类错误的唯一办法就是重新编译全部代码。由此看来，<span style="font-family:'Times New Roman';">DLL</span>并不见得可以动态替换，如果你想了解更多相关内容，建议阅读《<span style="font-family:'Times New Roman';">COM</span>本质论》。</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">9.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">分配<span style="font-family:'Times New Roman';">/</span>释放不配对。</span></p> 
   <p><span style="font-size:medium;">大家都知道<span style="font-family:'Times New Roman';">malloc</span>要和<span style="font-family:'Times New Roman';">free</span>配对使用，<span style="font-family:'Times New Roman';">new</span>要和<span style="font-family:'Times New Roman';">delete/delete[]</span>配对使用，重载了类<span style="font-family:'Times New Roman';">new</span>操作，应该同时重载类的<span style="font-family:'Times New Roman';">delete/delete[]</span>操作。这些都是书上反复强调过的，除非当时晕了头，一般不会犯这样的低级错误。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">而有时候我们却被蒙在鼓里，两个代码看起来都是调用的<span style="font-family:'Times New Roman';">free</span>函数，实际上却调用了不同的实现。比如在<span style="font-family:'Times New Roman';">Win32</span>下，调试版与发布版，单线程与多线程是不同的运行时库，不同的运行时库使用的是不同的内存管理器。一不小心链接错了库，那你就麻烦了。程序可能动则崩溃，原因在于在一个内存管理器中分配的内存，在另外一个内存管理器中释放时出现了问题。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">10.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">返回指向临时变量的指针</span></p> 
   <p><span style="font-size:medium;">大家都知道，栈里面的变量都是临时的。当前函数执行完成时，相关的临时变量和参数都被清除了。不能把指向这些临时变量的指针返回给调用者，这样的指针指向的数据是随机的，会给程序造成不可预料的后果。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">下面是个错误的例子：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">char* get_str(void)</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;str[] = {"abcd"};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;</span></p> <p align="left"><span style="font-family:'Times New Roman';">}</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char* argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;p&nbsp;= get_str();</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;printf("%s\n",&nbsp;p);</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p align="left"><span style="font-family:'Times New Roman';">}</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">下面这个例子没有问题，大家知道为什么吗？</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">char*&nbsp;get_str(void)</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;str&nbsp;= {"abcd"};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;</span></p> <p align="left"><span style="font-family:'Times New Roman';">}</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char*&nbsp;argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;p&nbsp;=&nbsp;get_str();</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;printf("%s\n",&nbsp;p);</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p><span style="font-family:'Times New Roman';">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">11.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">试图修改常量</span></p> 
   <p><span style="font-size:medium;">在函数参数前加上<span style="font-family:'Times New Roman';">const</span>修饰符，只是给编译器做类型检查用的，编译器禁止修改这样的变量。但这并不是强制的，你完全可以用强制类型转换绕过去，一般也不会出什么错。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">而全局常量和字符串，用强制类型转换绕过去，运行时仍然会出错。原因在于它们是是放在<span style="font-family:'Times New Roman';">.rodata</span>里面的，而<span style="font-family:'Times New Roman';">.rodata</span>内存页面是不能修改的。试图对它们修改，会引发内存错误。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">下面这个程序在运行时会出错：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char*&nbsp;argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char*&nbsp;p&nbsp;=&nbsp;"abcd";</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;*p&nbsp;=&nbsp;'1';</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p><span style="font-family:'Times New Roman';">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">12.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">误解传值与传引用</span></p> 
   <p><span style="font-size:medium;">在<span style="font-family:'Times New Roman';">C/C++</span>中，参数默认传递方式是传值的，即在参数入栈时被拷贝一份。在函数里修改这些参数，不会影响外面的调用者。如：</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">#include</span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">#include</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">void get_str(char* p)</span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">{</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;p = malloc(sizeof("abcd"));</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;strcpy(p, "abcd");</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">}</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">int main(int argc, char* argv[])</span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">{</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;char* p = NULL;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;get_str(p);</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;printf("p=%p\n", p);</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">在<span style="font-family:'Times New Roman';">main</span>函数里，<span style="font-family:'Times New Roman';">p</span>的值仍然是空值。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">13.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">重名符号。</span></p> 
   <p><span style="font-size:medium;">无论是函数名还是变量名，如果在不同的作用范围内重名，自然没有问题。但如果两个符号的作用域有交集，如全局变量和局部变量，全局变量与全局变量之间，重名的现象一定要坚决避免。<span style="font-family:'Times New Roman';">gcc</span>有一些隐式规则来决定处理同名变量的方式，编译时可能没有任何警告和错误，但结果通常并非你所期望的。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">下面例子编译时就没有警告：</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">t.c</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">#include</span></p> <p align="left"><span style="font-family:'Times New Roman';">#include&nbsp;&lt;stdio.h&gt;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;count&nbsp;= 0;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;get_count(void)</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;count;</span></p> <p align="left"><span style="font-family:'Times New Roman';">}</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">main.c</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">#include</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">extern int get_count(void);</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">int count;</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">int main(int argc, char* argv[])</span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">{</span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;count = 10;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;printf("get_count=%d\n", get_count());</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</span></span></p> <p><span style="font-family:'Times New Roman';font-size:medium;">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">如果把<span style="font-family:'Times New Roman';">main.c</span>中的<span style="font-family:'Times New Roman';">int count;</span>修改为<span style="font-family:'Times New Roman';">int count = 0;</span>，<span style="font-family:'Times New Roman';">gcc</span>就会编辑出错，说<span style="font-family:'Times New Roman';">multiple definition of `count'</span>。它的隐式规则比较奇妙吧，所以还是不要依赖它为好。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">14.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">栈溢出。</span></p> 
   <p><span style="font-size:medium;">我们在前面关于堆栈的一节讲过，在<span style="font-family:'Times New Roman';">PC</span>上，普通线程的栈空间也有十几<span style="font-family:'Times New Roman';">M</span>，通常够用了，定义大一点的临时变量不会有什么问题。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">而在一些嵌入式中，线程的栈空间可能只<span style="font-family:'Times New Roman';">5K</span>大小，甚至小到只有<span style="font-family:'Times New Roman';">256</span>个字节。在这样的平台中，栈溢出是最常用的错误之一。在编程时应该清楚自己平台的限制，避免栈溢出的可能。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">15.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">误用<span style="font-family:'Times New Roman';">sizeof</span>。</span></p> 
   <p><span style="font-size:medium;">尽管<span style="font-family:'Times New Roman';">C/C++</span>通常是按值传递参数，而数组则是例外，在传递数组参数时，数组退化为指针（即按引用传递），用<span style="font-family:'Times New Roman';">sizeof</span>是无法取得数组的大小的。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">从下面这个例子可以看出：</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p align="left"><span style="font-family:'Times New Roman';">void&nbsp;test(char&nbsp;str[20])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;printf("%s:size=%d\n", __func__,&nbsp;sizeof(str));</span></p> <p align="left"><span style="font-family:'Times New Roman';">}&nbsp;&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">int&nbsp;main(int&nbsp;argc,&nbsp;char*&nbsp;argv[])</span></p> <p align="left"><span style="font-family:'Times New Roman';">{</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;str[20]&nbsp;&nbsp;= {0};</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;test(str);</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;printf("%s:size=%d\n", __func__,&nbsp;sizeof(str));</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;</span></p> <p align="left"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></p> <p><span style="font-family:'Times New Roman';">}</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';font-size:medium;">[root@localhost mm]# ./t.exe</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">test:size=4</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">main:size=20</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">16.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">字节对齐。</span></p> 
   <p><span style="font-size:medium;">字节对齐主要目的是提高内存访问的效率。但在有的平台<span style="font-family:'Times New Roman';">(</span>如<span style="font-family:'Times New Roman';">arm7)</span>上，就不光是效率问题了，如果不对齐，得到的数据是错误的。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">所幸的是，大多数情况下，编译会保证全局变量和临时变量按正确的方式对齐。内存管理器会保证动态内存按正确的方式对齐。要注意的是，在不同类型的变量之间转换时要小心，如把<span style="font-family:'Times New Roman';">char*</span>强制转换为<span style="font-family:'Times New Roman';">int*</span>时，要格外小心。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">另外，字节对齐也会造成结构大小的变化，在程序内部用<span style="font-family:'Times New Roman';">sizeof</span>来取得结构的大小，这就足够了。若数据要在不同的机器间传递时，在通信协议中要规定对齐的方式，避免对齐方式不一致引发的问题。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">17.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">字节顺序。</span></p> 
   <p><span style="font-size:medium;">字节顺序历来是设计跨平台软件时头疼的问题。字节顺序是关于数据在物理内存中的布局的问题，最常见的字节顺序有两种：大端模式与小端模式。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">大端模式是高位字节数据存放在低地址处，低位字节数据存放在高地址处。</span></p> 
   <p><span style="font-size:medium;">小端模式指低位字节数据存放在内存低地址处，高位字节数据存放在内存高地址处；</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>比如<span style="font-family:'Times New Roman';">long n = 0x11223344</span>。</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
   <table border="1">
    <tbody>
     <tr>
      <td valign="top"> <p><span style="font-size:medium;">模式</span></p> </td> 
      <td valign="top"> <p><span style="font-size:medium;">第<span style="font-family:'Times New Roman';">1</span>个字节</span></p> </td> 
      <td valign="top"> <p><span style="font-size:medium;">第<span style="font-family:'Times New Roman';">2</span>个字节</span></p> </td> 
      <td valign="top"> <p><span style="font-size:medium;">第<span style="font-family:'Times New Roman';">3</span>个字节</span></p> </td> 
      <td valign="top"> <p><span style="font-size:medium;">第<span style="font-family:'Times New Roman';">4</span>个字节</span></p> </td> 
     </tr>
     <tr>
      <td valign="top"> <p><span style="font-size:medium;">大端模式</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x11</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x22</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x33</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x44</span></p> </td> 
     </tr>
     <tr>
      <td valign="top"> <p><span style="font-size:medium;">小端模式</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x44</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x33</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x22</span></p> </td> 
      <td valign="top"> <p><span style="font-family:'Times New Roman';font-size:medium;">0x11</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">在普通软件中，字节顺序问题并不引人注目。而在开发与网络通信和数据交换有关的软件时，字节顺序问题就要特殊注意了。</span></p> 
   <p><span style="font-size:medium;"><span style="font-family:'Times New Roman';">&nbsp;</span></span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">18.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size:medium;">多线程共享变量没有用<span style="font-family:'Times New Roman';">valotile</span>修饰。</span></p> 
   <p><span style="font-size:medium;">在关于全局内存的一节中，我们讲了<span style="font-family:'Times New Roman';">valotile</span>的作用，它告诉编译器，不要把变量优化到寄存器中。在开发多线程并发的软件时，如果这些线程共享一些全局变量，这些全局变量最好用<span style="font-family:'Times New Roman';">valotile</span>修饰。这样可以避免因为编译器优化而引起的错误，这样的错误非常难查。</span></p> 
   <p><span style="font-family:'Times New Roman';"><span style="font-size:medium;">&nbsp;</span></span></p> 
   <p><span style="font-size:medium;">可能还有其它一些内存相关错误，一时想不全面，这里算是抛砖引玉吧，希望各位高手补充。</span></p> 
   <p><span style="font-family:'Times New Roman';font-size:medium;">~~end~~</span></p> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
