<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux内核源码分析--内核启动之(2)Image内核启动(汇编部分)（Linux-3.0 ARMv7） 【转】... « NotBeCN</title>
  <meta name="description" content="                        转自：http://blog.chinaunix.net/uid-25909619-id-4938389.html&nbsp;      在完成了zImage自解压之后，就跳转到了解压后的内核（也就是vmlinux的bin版本Image），具体的入口可以在arch/...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2015/09/29/weixin_33826268_90123925.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux内核源码分析--内核启动之(2)Image内核启动(汇编部分)（Linux-3.0 ARMv7） 【转】...</h1>
    <p class="post-meta">Sep 29, 2015</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="Blog_wz1"> 
    <div> 
     <p>转自：<a href="http://blog.chinaunix.net/uid-25909619-id-4938389.html" rel="nofollow">http://blog.chinaunix.net/uid-25909619-id-4938389.html&nbsp;</a></p> 
     <p>在完成了zImage自解压之后，就跳转到了解压后的内核（也就是vmlinux的bin版本Image），具体的入口可以在arch/arm/kernel/vmlinux.lds.S（最终的链接脚本是通过这个文件产生的）中获得：</p> 
     <p>&nbsp;</p> 
     <div class="codeText">
      <ol>
       <li>......</li> 
       <li>SECTIONS</li> 
       <li>{</li> 
       <li>#ifdef CONFIG_XIP_KERNEL</li> 
       <li>. = XIP_VIRT_ADDR(CONFIG_XIP_PHYS_ADDR);</li> 
       <li>#else</li> 
       <li>. = PAGE_OFFSET + TEXT_OFFSET;</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>.init : { /* Init code and data */</li> 
       <li><strong><span style="color:#f00000;">_stext = .;</span></strong></li> 
       <li>_sinittext = .;</li> 
       <li>......</li> 
      </ol>
     </div> 
     <p>&nbsp;</p> 
    </div> 
    <div>
     &nbsp; &nbsp; 这个入口在arch/arm/kernel/head.S中，这个文件就是Linux内核真正启动的地方，是初始化部分的开始，用汇编写成。他必须为后面的C代码做好准备，下面先给出程序的流程图，后面是中文注释的代码。
    </div> 
    <div>
     &nbsp;
    </div> 
    <div>
     &nbsp; &nbsp; 这里有一些宏定义必须知道他的含义：
    </div> 
    <div> 
     <table border="1">
      <tbody>
       <tr>
        <td valign="top"> <p><span style="color:#000000;"><strong>宏</strong></span></p> </td> 
        <td valign="top"> <p align="left"><span style="color:#000000;"><strong>出现的位置</strong></span></p> </td> 
        <td valign="top"> <p align="left"><span style="color:#000000;"><strong>默认值</strong></span></p> </td> 
        <td valign="top"> <p align="left"><span style="color:#000000;"><strong>定义</strong></span></p> </td> 
       </tr>
       <tr>
        <td valign="top"> <p align="left">KERNEL_RAM_ADDR</p> </td> 
        <td valign="top"> <p align="left">arch/arm/kernel/head.S</p> </td> 
        <td valign="top"> <p align="left">0xC0008000</p> </td> 
        <td valign="top"> <p align="left">内核在内存中的虚拟地址</p> </td> 
       </tr>
       <tr>
        <td valign="top"> <p align="left">PAGE_OFFSET</p> </td> 
        <td valign="top"> <p align="left">arch/arm/include/asm/memory.h&nbsp;</p> </td> 
        <td valign="top"> <p align="left">0xC0000000</p> </td> 
        <td valign="top"> <p align="left">内核虚拟地址空间的起始地址</p> </td> 
       </tr>
       <tr>
        <td valign="top"> <p align="left">TEXT_OFFSET</p> </td> 
        <td valign="top"> <p align="left">arch/arm/Makefile</p> </td> 
        <td valign="top"> <p align="left">0x00008000</p> </td> 
        <td valign="top"> <p align="left">内核起始位置相对于内存起始位置的偏移</p> </td> 
       </tr>
       <tr>
        <td valign="top"> <p align="left">PHYS_OFFSET</p> </td> 
        <td valign="top"> <p align="left">&nbsp;</p> <p align="left"><span style="color:#000000;font-family:'宋体';">arch/arm/include/asm/memory.h&nbsp;</span></p> <p>&nbsp;</p> </td> 
        <td valign="top"> <p align="left">构架相关</p> </td> 
        <td valign="top"> <p align="left">物理内存的起始地址</p> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
    <div>
     &nbsp;
    </div> 
    <div>
     &nbsp;
     <img src="https://yqfile.alicdn.com/img_fcf33412c450112ed0383d0461e26fc8.jpeg" alt="">
    </div> 
    <p><strong><span style="color:#0000f0;font-size:large;">arch/arm/kernel/head.S</span></strong></p> 
    <div> 
     <div class="codeText">
      <ol>
       <li>/*</li> 
       <li>&nbsp;*&nbsp;linux/arch/arm/kernel/head.S</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;Copyright&nbsp;(C)&nbsp;1994-2002 Russell King</li> 
       <li>&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2003 ARM Limited</li> 
       <li>&nbsp;*&nbsp;All Rights Reserved</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;This program&nbsp;is&nbsp;free software;&nbsp;you can redistribute it&nbsp;and/or&nbsp;modify</li> 
       <li>&nbsp;*&nbsp;it under the terms of the GNU General&nbsp;Public&nbsp;License version 2 as</li> 
       <li>&nbsp;*&nbsp;published by the Free Software Foundation.</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;所有32-bit CPU的内核启动代码</li> 
       <li>&nbsp;*/</li> 
       <li>#include&nbsp;&lt;linux/linkage.h&gt;</li> 
       <li>#include&nbsp;&lt;linux/init.h&gt;</li> 
       <li> </li> 
       <li>#include&nbsp;&lt;asm/assembler.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/domain.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/ptrace.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/asm-offsets.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/memory.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/thread_info.h&gt;</li> 
       <li>#include&nbsp;&lt;asm/system.h&gt;</li> 
       <li> </li> 
       <li>#ifdef CONFIG_DEBUG_LL</li> 
       <li>#include&nbsp;&lt;mach/debug-macro.S&gt;</li> 
       <li>#endif</li> 
       <li><strong>&nbsp;</strong></li> 
       <li><strong>/*<br></strong></li> 
       <li> <strong>&nbsp;</strong>*<span style="color:#f00000;"><strong>&nbsp;swapper_pg_dir 是初始页表的虚拟地址.</strong></span> </li> 
       <li><strong>&nbsp;*&nbsp;我们将页表放在KERNEL_RAM_VADDR以下16K的空间中.&nbsp;因此我们必须保证<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;KERNEL_RAM_VADDR已经被正常设置.&nbsp;当前,&nbsp;我们期望的是<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这个地址的最后16 bits为0x8000,&nbsp;但我们或许可以放宽这项限制到<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;<span style="color:#f00000;">KERNEL_RAM_VADDR &gt;= PAGE_OFFSET + 0x4000.</span></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li><strong><span style="color:#f00000;">#define KERNEL_RAM_VADDR&nbsp;&nbsp;&nbsp;&nbsp;(PAGE_OFFSET + TEXT_OFFSET)</span></strong></li> 
       <li>#if&nbsp;(KERNEL_RAM_VADDR&nbsp;&amp;&nbsp;0xffff)&nbsp;!=&nbsp;0x8000</li> 
       <li>#error&nbsp;KERNEL_RAM_VADDR must start at 0xXXXX8000</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.globl&nbsp;&nbsp;&nbsp;&nbsp;swapper_pg_dir</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.equ&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#f00000;"><strong>swapper_pg_dir, KERNEL_RAM_VADDR - 0x4000</strong></span> </li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*<span style="color:#f00000;">&nbsp;TEXT_OFFSET 是内核代码（解压后）相对于RAM起始的偏移.</span><br></strong></li> 
       <li><strong>&nbsp;*&nbsp;而<span style="color:#f00000;">#TEXT_OFFSET - 0x4000就是页表相对于RAM起始的偏移.</span><br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这个宏的作用是将phys（RAM的启示地址）加上页表的偏移，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;而得到页表的起始物理地址<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.macro&nbsp;&nbsp;&nbsp;&nbsp;pgtbl,&nbsp;rd,&nbsp;phys</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;\rd,&nbsp;\phys,&nbsp;#TEXT_OFFSET&nbsp;-&nbsp;0x4000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.endm</li> 
       <li> </li> 
       <li>#ifdef CONFIG_XIP_KERNEL</li> 
       <li>#define KERNEL_START&nbsp;&nbsp;&nbsp;&nbsp;XIP_VIRT_ADDR(CONFIG_XIP_PHYS_ADDR)</li> 
       <li>#define KERNEL_END&nbsp;&nbsp;&nbsp;&nbsp;_edata_loc</li> 
       <li>#else</li> 
       <li><strong><span style="color:#f00000;">#define KERNEL_START&nbsp;&nbsp;&nbsp;&nbsp;KERNEL_RAM_VADDR<br></span></strong></li> 
       <li><strong><span style="color:#f00000;">#define KERNEL_END&nbsp;&nbsp;&nbsp;&nbsp;_end</span></strong></li> 
       <li>#endif</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*<span style="color:#0000f0;">&nbsp;内核启动入口点.</span><br></strong></li> 
       <li><strong>&nbsp;*&nbsp;---------------------------<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这个入口正常情况下是在解压完成后被调用的.<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;调用条件:&nbsp;MMU&nbsp;=&nbsp;off,&nbsp;D-cache&nbsp;=&nbsp;off,&nbsp;I-cache&nbsp;=&nbsp;dont care,&nbsp;r0&nbsp;=&nbsp;0,<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r1&nbsp;=&nbsp;machine nr,&nbsp;r2&nbsp;=&nbsp;atags&nbsp;or&nbsp;dtb pointer.<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这些条件在解压完成后会被逐一满足，然后才跳转过来。<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这些代码大多数是位置无关的,&nbsp;如果你的内核入口地址在连接时确定为<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;0xc0008000,&nbsp;你调用此函数的物理地址就是 __pa(0xc0008000).<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;完整的machineID列表，请参见 linux/arch/arm/tools/mach-types<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;我们尽量让代码简洁;&nbsp;不在此处添加任何设备特定的代码<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;-&nbsp;这些特定的初始化代码是boot loader的工作(或在极端情况下，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;有充分理由的情况下,&nbsp;可以由zImage完成)。<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__HEAD</li> 
       <li><strong><span style="color:#f00000;">ENTRY(stext)</span></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000f0;">setmode&nbsp;&nbsp;&nbsp;&nbsp;PSR_F_BIT | PSR_I_BIT | SVC_MODE, r9 @ CPU模式设置宏<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ （进入svc模式并且关闭中断）<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;mrc&nbsp;&nbsp;&nbsp;&nbsp;p15, 0, r9, c0, c0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ 获取处理器id--&gt;r9<br></span></strong></li> 
       <li><strong><span style="color:#f00000;">&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__lookup_processor_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ 返回r5=procinfo r9=cpuid</span><br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;movs&nbsp;&nbsp;&nbsp;&nbsp;r10,&nbsp;r5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @ r10=r5，并可以检测r5=0?注意当前r10的值</strong></li> 
       <li>&nbsp;THUMB(&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;eq&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ force fixup-able long branch encoding</li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;__error_p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ yes,&nbsp;error&nbsp;'p'如果r5=0，则内核处理器不匹配，出错～死循环</strong></li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<span style="color:#0000f0;">&nbsp;获取RAM的起始物理地址，并保存于 r8 = phys_offset</span></strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;XIP内核与普通在RAM中运行的内核不同</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;（1）CONFIG_XIP_KERNEL</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过运行时计算？？？？</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<strong><span style="color:#0000f0;">（2）正常RAM中运行的内核</span><br></strong> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000f0;">通过编译时确定（PLAT_PHYS_OFFSET 一般在arch/arm/mach-xxx/include/mach/memory.h定义）</span></strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>#ifndef CONFIG_XIP_KERNEL</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;2f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;{r4,&nbsp;r8}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r3,&nbsp;r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;(PHYS_OFFSET&nbsp;-&nbsp;PAGE_OFFSET)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r8,&nbsp;r8,&nbsp;r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ PHYS_OFFSET</li> 
       <li>#else</li> 
       <li>&nbsp;<strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r8, =PLAT_PHYS_OFFSET</span></strong> </li> 
       <li>#endif</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;r1&nbsp;=&nbsp;machine no,&nbsp;r2&nbsp;=&nbsp;atags&nbsp;or&nbsp;dtb,</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;r8&nbsp;=&nbsp;phys_offset,&nbsp;r9&nbsp;=&nbsp;cpuid,&nbsp;r10&nbsp;=&nbsp;procinfo</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li><span style="color:#f00000;">&nbsp;&nbsp;&nbsp;<strong>&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__vet_atags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 判断r2（内核启动参数）指针的有效性</strong></span></li> 
       <li>#ifdef CONFIG_SMP_ON_UP</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__fixup_smp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;???如果运行SMP内核在单处理器系统中启动，做适当调整</li> 
       <li>#endif</li> 
       <li>#ifdef CONFIG_ARM_PATCH_PHYS_VIRT</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__fixup_pv_table&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;????根据内核在内存中的位置修正物理地址与虚拟地址的转换机制</li> 
       <li>#endif</li> 
       <li><strong><span style="color:#f00000;">&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__create_page_tables&nbsp;&nbsp;&nbsp;&nbsp;@ 初始化页表！</span></strong></li> 
       <li> </li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;/*<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; * 以下使用位置无关的方法调用的是CPU特定代码。<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; * 详情请见arch/arm/mm/proc-*.S<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; * r10 = xxx_proc_info 结构体的基地址（在上面__lookup_processor_type函数中选中的）<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; * 返回时, CPU 已经为 MMU 的启动做好了准备，<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; * 且 r0 保存着CPU控制寄存器的值.<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp; */</span></strong></li> 
       <li><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r13, =__mmap_switched&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 在MMU启动之后跳入的第一个虚拟地址<br></span></li> 
       <li><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;lr, BSYM(1f)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 设置返回的地址(PIC)<br></span></li> 
       <li><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r8, r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 将swapper_pg_dir的物理地址放入r8，<br></span></li> 
       <li><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 以备__enable_mmu中将其放入TTBR1<br></span></li> 
       <li><span style="color:#0000f0;">&nbsp;ARM(&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;pc, r10, #PROCINFO_INITFUNC&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;@ 跳入构架相关的初始化处理器函数(例如A8的是__v7_setup)</span></li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r12,&nbsp;r10,&nbsp;#PROCINFO_INITFUNC&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;@主要目的只配置CP15（包括缓存配置）</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;r12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li><span style="color:#0000f0;">1:&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__enable_mmu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 启动MMU</span></li> 
       <li>ENDPROC(stext)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.ltorg</li> 
       <li>#ifndef CONFIG_XIP_KERNEL</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;PAGE_OFFSET</li> 
       <li>#endif</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;创建初始化页表.&nbsp;我们只创建最基本的页表，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;以满足内核运行的需要，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;这通常意味着仅映射内核代码本身.<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r8&nbsp;=&nbsp;phys_offset,&nbsp;r9&nbsp;=&nbsp;cpuid,&nbsp;r10&nbsp;=&nbsp;procinfo<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;返回:<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r0,&nbsp;r3,&nbsp;r5-r7 被篡改<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r4&nbsp;=&nbsp;页表物理地址<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li><span style="color:#f00000;"><strong>__create_page_tables:</strong></span></li> 
       <li><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;pgtbl&nbsp;&nbsp;&nbsp;&nbsp;r4, r8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 现在r4 = 页表的起始物理地址</span></li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;清零16K的一级初始页表区<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这些页表在内核自解压时被设置过<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;（此时MMU已关闭）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r0,&nbsp;#0x4000</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获取节描述符的默认配置（除节基址外的其他配置）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这个数据依构架而不同，数据是用汇编文件配置的：<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;arch/arm/mm/proc-xxx.S<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;（此时MMU已关闭）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;[r10,&nbsp;#PROCINFO_MM_MMUFLAGS]&nbsp;@ 获取mm_mmuflags(节描述符默认配置)，保存于r7</li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;创建特定映射，以满足__enable_mmu的需求。<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;此特定映射将被paging_init()删除。<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;其实这个特定的映射就是仅映射__enable_mmu功能函数区的页表<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;以保证在启用mmu时代码的正确执行--1:1映射（物理地址=虚拟地址）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;__enable_mmu_loc</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;{r3,&nbsp;r5,&nbsp;r6}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 获取编译时确定的虚拟地址到当前物理地址的偏移</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __enable_mmu的当前物理地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __enable_mmu_end的当前物理地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;lsr #20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __enable_mmu的节基址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;lsr #20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __enable_mmu_end的节基址</li> 
       <li> </li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;r5,&nbsp;lsl #20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 生成节描述符：flags&nbsp;+&nbsp;节基址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r4,&nbsp;r5,&nbsp;lsl #2]&nbsp;&nbsp;&nbsp;&nbsp;@ 设置节描述符,1:1映射（物理地址=虚拟地址）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 完成映射？（理论上一次就够了，这个函数应该不会大于1M吧～）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;addne&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r5&nbsp;=&nbsp;下一节的基址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;现在创建内核的逻辑映射区页表（节映射）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;创建范围：KERNEL_START---KERNEL_END<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;KERNEL_START：内核最终运行的虚拟地址<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;KERNEL_END：内核代码结束的虚拟地址（bss段之后，但XIP不是）<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;pc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 获取当前物理地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;lsr #20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r3&nbsp;=&nbsp;当前物理地址的节基址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;r3,&nbsp;lsl #20&nbsp;&nbsp;&nbsp;&nbsp;@ r3 为当前物理地址的节描述符</li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;下面是为了确定页表项的入口地址<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;其实页表入口项的偏移就反应了对应的虚拟地址的高位<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;由于ARM指令集的8bit位图问题，只能分两次得到<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;KERNEL_START：内核最终运行的虚拟地址<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;#(KERNEL_START&nbsp;&amp;&nbsp;0xff000000)&nbsp;&gt;&gt;&nbsp;18</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0,&nbsp;#(KERNEL_START&nbsp;&amp;&nbsp;0x00f00000)&nbsp;&gt;&gt;&nbsp;18]!</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;=(KERNEL_END&nbsp;-&nbsp;1)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r4,&nbsp;r6,&nbsp;lsr #18&nbsp;&nbsp;&nbsp;&nbsp;@ r6&nbsp;=&nbsp;内核逻辑映射结束的节基址</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#1&nbsp;&lt;&lt;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;@ 生成节描述符（只需做基址递增）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;strls&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4&nbsp;&nbsp;&nbsp;&nbsp;@ 设置节描述符</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bls&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li>#ifdef CONFIG_XIP_KERNEL</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如果是XIP技术的内核，上面的映射只能映射内核代码和只读数据部分</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里我们再映射一些RAM来作为&nbsp;.data&nbsp;and&nbsp;.bss 空间.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r8,&nbsp;#TEXT_OFFSET</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;r7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 生成节描述符：flags&nbsp;+&nbsp;节基址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;#(KERNEL_RAM_VADDR&nbsp;&amp;&nbsp;0xff000000)&nbsp;&gt;&gt;&nbsp;18</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0,&nbsp;#(KERNEL_RAM_VADDR&nbsp;&amp;&nbsp;0x00f00000)&nbsp;&gt;&gt;&nbsp;18]!</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;=(_end&nbsp;-&nbsp;1)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r4,&nbsp;r6,&nbsp;lsr #18</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#1&nbsp;&lt;&lt;&nbsp;20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;strls&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bls&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li>#endif</li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;然后映射启动参数区（现在r2中的atags物理地址）&nbsp;<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;或者<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如果启动参数区的虚拟地址没有确定（或者无效），则会映射RAM的头1MB.<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r2,&nbsp;lsr #20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;movs&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;lsl #20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;moveq&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 如果atags指针无效，则r0&nbsp;=&nbsp;r8（映射RAM的头1MB）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r0,&nbsp;r8</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#PAGE_OFFSET&nbsp;&nbsp;&nbsp;&nbsp;@ 转换为虚拟地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r4,&nbsp;r3,&nbsp;lsr #18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 确定页表项（节描述符）入口地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r7,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 生成节描述符</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 设置节描述符</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;下面是调试信息的输出函数区</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这里做了IO内存空间的节映射</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>#ifdef CONFIG_DEBUG_LL</li> 
       <li>#ifndef CONFIG_DEBUG_ICEDCC</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;为串口调试映射IO内存空间（将串口IO内存之上的所有地址都映射了）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;这允许调试信息（在paging_init之前）从串口控制台输出</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;addruart r7,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 宏代码，位于arch/arm/mach-xxx/include/mach/debug-macro.S</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 作用是将串口控制寄存器的基址放入r7(物理地址)和r3(虚拟地址)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;lsr #20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;lsl #2</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r0为串口IO内存映射页表项的入口地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;rsb&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#0x4000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 16K(PTRS_PER_PGD*sizeof(long))-r3</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0x0800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ limit&nbsp;to&nbsp;512MB,入口地址有效性检查（只能在最后#0x0800内）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;movhi&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0x0800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 也就是说虚拟地址被限制在3.5G以上</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r0,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r6为页表结束地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;lsr #20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;[r10,&nbsp;#PROCINFO_IO_MMUFLAGS]&nbsp;@ io_mmuflags</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;r3,&nbsp;lsl #20&nbsp;&nbsp;&nbsp;&nbsp;@ 生成节描述符</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#1&nbsp;&lt;&lt;&nbsp;20</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li>#else&nbsp;/*&nbsp;CONFIG_DEBUG_ICEDCC&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;我们无需任何串口调试映射&nbsp;for&nbsp;ICEDCC&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;[r10,&nbsp;#PROCINFO_IO_MMUFLAGS]&nbsp;@ io_mmuflags</li> 
       <li>#endif&nbsp;/*&nbsp;!CONFIG_DEBUG_ICEDCC&nbsp;*/</li> 
       <li> </li> 
       <li>#if&nbsp;defined(CONFIG_ARCH_NETWINDER)&nbsp;||&nbsp;defined(CONFIG_ARCH_CATS)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;如果我们在使用 NetWinder 或 CATS,我们也需要为调试信息映射</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;16550-type 串口</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;#0xff000000&nbsp;&gt;&gt;&nbsp;18</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;#0x7c000000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0]</li> 
       <li>#endif</li> 
       <li>#ifdef CONFIG_ARCH_RPC</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Map&nbsp;in&nbsp;screen at 0x02000000&nbsp;&amp;&nbsp;SCREEN2_BASE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Similar reasons here&nbsp;-&nbsp;for&nbsp;debug.&nbsp;This&nbsp;is</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;only&nbsp;for&nbsp;Acorn RiscPC architectures.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;#0x02000000&nbsp;&gt;&gt;&nbsp;18</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r7,&nbsp;#0x02000000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0]</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r4,&nbsp;#0xd8000000&nbsp;&gt;&gt;&nbsp;18</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0]</li> 
       <li>#endif</li> 
       <li>#endif</li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc, lr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@页表创建结束，返回</span></strong></li> 
       <li>ENDPROC(__create_page_tables)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.ltorg</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li>__enable_mmu_loc:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__enable_mmu</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__enable_mmu_end</li> 
       <li> </li> 
       <li>#if&nbsp;defined(CONFIG_SMP)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__CPUINIT</li> 
       <li>ENTRY(secondary_startup)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Common entry point&nbsp;for&nbsp;secondary CPUs.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Ensure that we're&nbsp;in&nbsp;SVC mode,&nbsp;and&nbsp;IRQs are disabled.&nbsp;Lookup</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the processor type&nbsp;-&nbsp;there&nbsp;is&nbsp;no need&nbsp;to&nbsp;check the machine type</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;as it has already been validated by the primary processor.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;setmode&nbsp;&nbsp;&nbsp;&nbsp;PSR_F_BIT&nbsp;|&nbsp;PSR_I_BIT&nbsp;|&nbsp;SVC_MODE,&nbsp;r9</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mrc&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r9,&nbsp;c0,&nbsp;c0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;processor id</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__lookup_processor_type</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;movs&nbsp;&nbsp;&nbsp;&nbsp;r10,&nbsp;r5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ invalid processor?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;moveq&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#'p'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ yes,&nbsp;error&nbsp;'p'</li> 
       <li>&nbsp;THUMB(&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;eq&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ force fixup-able long branch encoding</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;__error_p</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Use the page tables supplied from __cpu_up.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;__secondary_data</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;{r5,&nbsp;r7,&nbsp;r12}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ address&nbsp;to&nbsp;jump&nbsp;to&nbsp;after</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;lr,&nbsp;r4,&nbsp;r5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ mmu has been enabled</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;[r7,&nbsp;lr]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;secondary_data.pgdir</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;r7,&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r8,&nbsp;[r7,&nbsp;lr]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;secondary_data.swapper_pg_dir</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;lr,&nbsp;BSYM(__enable_mmu)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ return address</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r13,&nbsp;r12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __secondary_switched address</li> 
       <li>&nbsp;ARM(&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;r10,&nbsp;#PROCINFO_INITFUNC&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;@ initialise processor</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @&nbsp;(return control reg)</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r12,&nbsp;r10,&nbsp;#PROCINFO_INITFUNC&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;r12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>ENDPROC(secondary_startup)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;r6&nbsp;=&nbsp;&amp;secondary_data</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>ENTRY(__secondary_switched)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;sp,&nbsp;[r7,&nbsp;#4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;secondary_data.stack</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;fp,&nbsp;#0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;secondary_start_kernel</li> 
       <li>ENDPROC(__secondary_switched)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.type&nbsp;&nbsp;&nbsp;&nbsp;__secondary_data,&nbsp;%object</li> 
       <li>__secondary_data:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;secondary_data</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__secondary_switched</li> 
       <li>#endif&nbsp;/*&nbsp;defined(CONFIG_SMP)&nbsp;*/</li> 
       <li> </li> 
       <li> </li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;在最后启动MMU前，设置一些常用位 Essentially<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;其实，这里只是加载了页表指针和域访问控制数据寄存器<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r0&nbsp;=&nbsp;cp#15 control register<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r1&nbsp;=&nbsp;machine ID<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r2&nbsp;=&nbsp;atags&nbsp;or&nbsp;dtb pointer<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r4&nbsp;=&nbsp;page table pointer<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r9&nbsp;=&nbsp;processor ID<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r13&nbsp;=&nbsp;最后要跳入的虚拟地址<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>__enable_mmu:</li> 
       <li>#ifdef CONFIG_ALIGNMENT_TRAP</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#CR_A</li> 
       <li>#else</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#CR_A</li> 
       <li>#endif</li> 
       <li>#ifdef CONFIG_CPU_DCACHE_DISABLE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#CR_C</li> 
       <li>#endif</li> 
       <li>#ifdef CONFIG_CPU_BPREDICT_DISABLE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#CR_Z</li> 
       <li>#endif</li> 
       <li>#ifdef CONFIG_CPU_ICACHE_DISABLE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#CR_I</li> 
       <li>#endif</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;#(domain_val(DOMAIN_USER,&nbsp;DOMAIN_MANAGER)&nbsp;|&nbsp;\</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domain_val(DOMAIN_KERNEL,&nbsp;DOMAIN_MANAGER)&nbsp;|&nbsp;\</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domain_val(DOMAIN_TABLE,&nbsp;DOMAIN_MANAGER)&nbsp;|&nbsp;\</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domain_val(DOMAIN_IO,&nbsp;DOMAIN_CLIENT))&nbsp;&nbsp;&nbsp;&nbsp;@设置域访问控制数据</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mcr&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r5,&nbsp;c3,&nbsp;c0,&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 载入域访问控制数据到DACR</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mcr&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r4,&nbsp;c2,&nbsp;c0,&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 载入页表基址到TTBR0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__turn_mmu_on&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 开启MMU</li> 
       <li>ENDPROC(__enable_mmu)</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;使能 MMU.&nbsp;这完全改变了可见的内存地址空间结构。<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;您将无法通过这里跟踪执行。<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;如果你已对此进行探究,&nbsp;*请*在向邮件列表发送另一个新帖之前，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;检查linux-arm-kernel的邮件列表归档<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r0&nbsp;=&nbsp;cp#15 control register<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r1&nbsp;=&nbsp;machine ID<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r2&nbsp;=&nbsp;atags&nbsp;or&nbsp;dtb pointer<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r9&nbsp;=&nbsp;processor ID<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r13&nbsp;=&nbsp;最后要跳入的*虚拟*地址<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;其他寄存器依赖上面的调用函数<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align&nbsp;&nbsp;&nbsp;&nbsp;5</li> 
       <li>__turn_mmu_on:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mcr&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r0,&nbsp;c1,&nbsp;c0,&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 设置cp#15控制寄存器（启用MMU）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mrc&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r3,&nbsp;c0,&nbsp;c0,&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ read id reg</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r3中装入最后要跳入的*虚拟*地址</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 跳转到__mmap_switched</li> 
       <li>__enable_mmu_end:</li> 
       <li>ENDPROC(__turn_mmu_on)</li> 
       <li> </li> 
       <li> </li> 
       <li>#ifdef CONFIG_SMP_ON_UP</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__INIT</li> 
       <li>__fixup_smp:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r9,&nbsp;#0x000f0000&nbsp;&nbsp;&nbsp;&nbsp;@ architecture version</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0x000f0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ CPU ID supported?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;__fixup_smp_on_up&nbsp;&nbsp;&nbsp;&nbsp;@ no,&nbsp;assume UP</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r9,&nbsp;#0x00ff0000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;#0x0000000f&nbsp;&nbsp;&nbsp;&nbsp;@ mask 0xff00fff0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;#0x41000000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r4,&nbsp;#0x0000b000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r4,&nbsp;#0x00000020&nbsp;&nbsp;&nbsp;&nbsp;@ val 0x4100b020</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ ARM 11MPCore?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;moveq&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ yes,&nbsp;assume SMP</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mrc&nbsp;&nbsp;&nbsp;&nbsp;p15,&nbsp;0,&nbsp;r0,&nbsp;c0,&nbsp;c0,&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;@ read MPIDR</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;#0xc0000000&nbsp;&nbsp;&nbsp;&nbsp;@ multiprocessing extensions&nbsp;and</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#0x80000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;not&nbsp;part of a uniprocessor system?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;moveq&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ yes,&nbsp;assume SMP</li> 
       <li> </li> 
       <li>__fixup_smp_on_up:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;1f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;{r3&nbsp;-&nbsp;r5}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r0,&nbsp;r3</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r4,&nbsp;r3</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;r3</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__do_fixup_smp_on_up</li> 
       <li>ENDPROC(__fixup_smp)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;.word&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.word&nbsp;&nbsp;&nbsp;&nbsp;__smpalt_begin</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.word&nbsp;&nbsp;&nbsp;&nbsp;__smpalt_end</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.pushsection&nbsp;.data</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.globl&nbsp;&nbsp;&nbsp;&nbsp;smp_on_up</li> 
       <li>smp_on_up:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ALT_SMP(.long&nbsp;&nbsp;&nbsp;&nbsp;1)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ALT_UP(.long&nbsp;&nbsp;&nbsp;&nbsp;0)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.popsection</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.text</li> 
       <li>__do_fixup_smp_on_up:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;movhs&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r0,&nbsp;r6}</li> 
       <li>&nbsp;ARM(&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r0,&nbsp;r3]&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>#ifdef __ARMEB__</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;ror #16&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;@ Convert word order&nbsp;for&nbsp;big-endian.</li> 
       <li>#endif</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;strh&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r0],&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;For&nbsp;Thumb-2,&nbsp;store as two halfwords</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;lsr #16&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;to&nbsp;be robust against misaligned r3.</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;strh&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r0]&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__do_fixup_smp_on_up</li> 
       <li>ENDPROC(__do_fixup_smp_on_up)</li> 
       <li> </li> 
       <li>ENTRY(fixup_smp)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;stmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r6,&nbsp;lr}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r0,&nbsp;r1</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__do_fixup_smp_on_up</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r6,&nbsp;pc}</li> 
       <li>ENDPROC(fixup_smp)</li> 
       <li> </li> 
       <li>#ifdef CONFIG_ARM_PATCH_PHYS_VIRT</li> 
       <li> </li> 
       <li>/*&nbsp;__fixup_pv_table&nbsp;-&nbsp;patch the stub instructions with the delta between</li> 
       <li>&nbsp;*&nbsp;PHYS_OFFSET&nbsp;and&nbsp;PAGE_OFFSET,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be 16MiB aligned&nbsp;and</li> 
       <li>&nbsp;*&nbsp;can be expressed by an immediate shifter operand.&nbsp;The stub instruction</li> 
       <li>&nbsp;*&nbsp;has a&nbsp;form&nbsp;of&nbsp;'(add|sub)&nbsp;rd,&nbsp;rn,&nbsp;#imm'.</li> 
       <li>&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__HEAD</li> 
       <li>__fixup_pv_table:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;1f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;{r3-r5,&nbsp;r7}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r0,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;@ PHYS_OFFSET&nbsp;-&nbsp;PAGE_OFFSET</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r4,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;@ adjust table start address</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;@ adjust table&nbsp;end&nbsp;address</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;r7,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;@ adjust __pv_phys_offset address</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r8,&nbsp;[r7]&nbsp;&nbsp;&nbsp;&nbsp;@ save computed PHYS_OFFSET&nbsp;to&nbsp;__pv_phys_offset</li> 
       <li>#ifndef CONFIG_ARM_PATCH_PHYS_VIRT_16BIT</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r3,&nbsp;lsr #24&nbsp;&nbsp;&nbsp;&nbsp;@ constant&nbsp;for&nbsp;add/sub&nbsp;instructions</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r6,&nbsp;lsl #24 @ must be 16MiB aligned</li> 
       <li>#else</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r3,&nbsp;lsr #16&nbsp;&nbsp;&nbsp;&nbsp;@ constant&nbsp;for&nbsp;add/sub&nbsp;instructions</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r6,&nbsp;lsl #16&nbsp;&nbsp;&nbsp;&nbsp;@ must be 64kiB aligned</li> 
       <li>#endif</li> 
       <li>THUMB(&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;ne&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ cross section branch&nbsp;)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;__error</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r7,&nbsp;#4]&nbsp;&nbsp;&nbsp;&nbsp;@ save&nbsp;to&nbsp;__pv_offset</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__fixup_a_pv_table</li> 
       <li>ENDPROC(__fixup_pv_table)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__pv_table_begin</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__pv_table_end</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__pv_phys_offset</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.text</li> 
       <li>__fixup_a_pv_table:</li> 
       <li>#ifdef CONFIG_THUMB2_KERNEL</li> 
       <li>#ifdef CONFIG_ARM_PATCH_PHYS_VIRT_16BIT</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsls&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6,&nbsp;#24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#8</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;1f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;clz&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;r0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsl&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r7</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;0x0080</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsrs&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;#1</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orrcs r0,&nbsp;#0x0080</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0,&nbsp;r7,&nbsp;lsl #12</li> 
       <li>#endif</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;lsls&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;4f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;clz&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsl&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r7</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#0x0080</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;lsrs&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;#1</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orrcs&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#0x0080</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;r7,&nbsp;lsl #12</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;#0x4000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;4f</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;@ at this point the C flag&nbsp;is&nbsp;always clear</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add r7,&nbsp;r3</li> 
       <li>#ifdef CONFIG_ARM_PATCH_PHYS_VIRT_16BIT</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldrh&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7]</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;tst&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;0x0400&nbsp;&nbsp;&nbsp;&nbsp;@ the i bit tells us LS&nbsp;or&nbsp;MS byte</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;3f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;set&nbsp;C flag,&nbsp;and&nbsp;...</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;biceq&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;0x0400&nbsp;&nbsp;&nbsp;&nbsp;@ immediate zero value has a special encoding</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;streqh&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7]&nbsp;&nbsp;&nbsp;&nbsp;@ that requires the i bit cleared</li> 
       <li>#endif</li> 
       <li>3:&nbsp;&nbsp;&nbsp;&nbsp;ldrh&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7,&nbsp;#2]</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;0x8f00</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orrcc&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;@ mask&nbsp;in&nbsp;offset bits 31-24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orrcs&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;@ mask&nbsp;in&nbsp;offset bits 23-16</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;strh&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7,&nbsp;#2]</li> 
       <li>4:&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldrcc&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;[r4],&nbsp;#4&nbsp;&nbsp;&nbsp;&nbsp;@ use branch&nbsp;for&nbsp;delay slot</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bcc&nbsp;&nbsp;&nbsp;&nbsp;2b</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bx&nbsp;&nbsp;&nbsp;&nbsp;lr</li> 
       <li>#else</li> 
       <li>#ifdef CONFIG_ARM_PATCH_PHYS_VIRT_16BIT</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r6,&nbsp;#255&nbsp;&nbsp;&nbsp;&nbsp;@ offset bits 23-16</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;lsr #8&nbsp;&nbsp;&nbsp;&nbsp;@ offset bits 31-24</li> 
       <li>#else</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ just&nbsp;in&nbsp;case...</li> 
       <li>#endif</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;3f</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7,&nbsp;r3]</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;ip,&nbsp;#0x000000ff</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;tst&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;#0x400&nbsp;&nbsp;&nbsp;&nbsp;@ rotate shift tells us LS&nbsp;or&nbsp;MS byte</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orrne&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;ip,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;@ mask&nbsp;in&nbsp;offset bits 31-24</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orreq&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;ip,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;@ mask&nbsp;in&nbsp;offset bits 23-16</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;ip,&nbsp;[r7,&nbsp;r3]</li> 
       <li>3:&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldrcc&nbsp;&nbsp;&nbsp;&nbsp;r7,&nbsp;[r4],&nbsp;#4&nbsp;&nbsp;&nbsp;&nbsp;@ use branch&nbsp;for&nbsp;delay slot</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bcc&nbsp;&nbsp;&nbsp;&nbsp;2b</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr</li> 
       <li>#endif</li> 
       <li>ENDPROC(__fixup_a_pv_table)</li> 
       <li> </li> 
       <li>ENTRY(fixup_pv_table)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;stmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r7,&nbsp;lr}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r2,&nbsp;2f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;address of __pv_phys_offset</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ no offset</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r0&nbsp;=&nbsp;table start</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r0,&nbsp;r1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r1&nbsp;=&nbsp;table size</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;[r2,&nbsp;#4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;get&nbsp;__pv_offset</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__fixup_a_pv_table</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r7,&nbsp;pc}</li> 
       <li>ENDPROC(fixup_pv_table)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__pv_phys_offset</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.data</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.globl&nbsp;&nbsp;&nbsp;&nbsp;__pv_phys_offset</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.type&nbsp;&nbsp;&nbsp;&nbsp;__pv_phys_offset,&nbsp;%object</li> 
       <li>__pv_phys_offset:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.size&nbsp;&nbsp;&nbsp;&nbsp;__pv_phys_offset,&nbsp;.&nbsp;-&nbsp;__pv_phys_offset</li> 
       <li>__pv_offset:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;0</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>#include&nbsp;"head-common.S"</li> 
      </ol>
     </div> 
    </div> 
    <div>
     <strong><span style="color:#0000f0;font-size:large;">arch/arm/kernel/head-common.S</span></strong>
    </div> 
    <div> 
     <div class="codeText">
      <ol>
       <li>/*</li> 
       <li>&nbsp;*&nbsp;linux/arch/arm/kernel/head-common.S</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;Copyright&nbsp;(C)&nbsp;1994-2002 Russell King</li> 
       <li>&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2003 ARM Limited</li> 
       <li>&nbsp;*&nbsp;All Rights Reserved</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;This program&nbsp;is&nbsp;free software;&nbsp;you can redistribute it&nbsp;and/or&nbsp;modify</li> 
       <li>&nbsp;*&nbsp;it under the terms of the GNU General&nbsp;Public&nbsp;License version 2 as</li> 
       <li>&nbsp;*&nbsp;published by the Free Software Foundation.</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*/</li> 
       <li> </li> 
       <li>#define ATAG_CORE 0x54410001</li> 
       <li>#define ATAG_CORE_SIZE&nbsp;((2*4&nbsp;+&nbsp;3*4)&nbsp;&gt;&gt;&nbsp;2)</li> 
       <li>#define ATAG_CORE_SIZE_EMPTY&nbsp;((2*4)&nbsp;&gt;&gt;&nbsp;2)</li> 
       <li> </li> 
       <li>#ifdef CONFIG_CPU_BIG_ENDIAN</li> 
       <li>#define OF_DT_MAGIC 0xd00dfeed</li> 
       <li>#else</li> 
       <li>#define OF_DT_MAGIC 0xedfe0dd0&nbsp;/*&nbsp;0xd00dfeed&nbsp;in&nbsp;big-endian&nbsp;*/</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>/*</li> 
       <li>&nbsp;*&nbsp;异常处理.&nbsp;一些我们无法处理的错误.</li> 
       <li>&nbsp;*&nbsp;我们应当告诉用户(这些错误信息)，但因为我们甚至无法保证是在正确的架构上运行，</li> 
       <li>&nbsp;*&nbsp;所以我们什么都不做（死循环）。</li> 
       <li>&nbsp;*</li> 
       <li>&nbsp;*&nbsp;如果 CONFIG_DEBUG_LL 被设置，我们试图打印出错误信息，</li> 
       <li>&nbsp;*&nbsp;并希望这可以对我们有帮助&nbsp;(例如这对bootloader没有提供适当的处理器ID</li> 
       <li>&nbsp;*&nbsp;是有帮助的).</li> 
       <li>&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__HEAD</li> 
       <li><strong>&nbsp;</strong></li> 
       <li><strong>/*&nbsp;确定r2（内核启动参数）指针的有效性。 The heuristic 要求<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;是4Byte对齐的、在物理内存的头16K中，且以ATAG_CORE标记开头。<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;如果选择了CONFIG_OF_FLATTREE，dtb指针也是可以接受的.<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;在这个函数的未来版本中 可能会对物理地址的要求更为宽松，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;且如果有必要的话，可能可以移动ATAGS数据块.<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;返回:<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r2 可能是有效的 atags 指针,&nbsp;有效的 dtb 指针，或者0<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r5,&nbsp;r6 被篡改<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>__vet_atags:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;tst&nbsp;&nbsp;&nbsp;&nbsp;r2,&nbsp;#0x3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 是否4Byte对齐?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 不是则认为指针无效，返回</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;[r2,&nbsp;#0]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@获取r2指向的前4Byte，用于下面测试</li> 
       <li>#ifdef CONFIG_OF_FLATTREE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;=OF_DT_MAGIC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@&nbsp;is&nbsp;it a DTB?</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;2f</li> 
       <li>#endif</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;/*<span style="color:#0000f0;">&nbsp;内核启动参数块的规范是：</span> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<strong><span style="color:#0000f0;">（wait for updata）</span></strong> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;#ATAG_CORE_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 第一个tag是ATAG_CORE吗?测试的是tag_header中的size</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 如果为ATAG_CORE，那么必为ATAG_CORE_SIZE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmpne&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;#ATAG_CORE_SIZE_EMPTY&nbsp;&nbsp;&nbsp;&nbsp;@ 如果第一个tag的tag_header中的size为ATAG_CORE_SIZE_EMPTY</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 说明此处也有atags</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1f</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;[r2,&nbsp;#4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 第一个tag_header的tag（魔数）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;=ATAG_CORE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 获取ATAG_CORE的魔数</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 判断第一个tag是否为ATAG_CORE</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 不是则认为指针无效，返回</li> 
       <li> </li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ atag/dtb 指针有效</li> 
       <li> </li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r2,&nbsp;#0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr</li> 
       <li>ENDPROC(__vet_atags)</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;以下的代码段是在MMU开启的状态下执行的,<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;而且使用的是绝对地址;&nbsp;这不是位置无关代码.<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r0&nbsp;=&nbsp;cp#15 控制寄存器值<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r1&nbsp;=&nbsp;machine ID<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r2&nbsp;=&nbsp;atags/dtb pointer<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;r9&nbsp;=&nbsp;processor ID<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__INIT</li> 
       <li>__mmap_switched:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;__mmap_switched_data</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4,&nbsp;r5,&nbsp;r6,&nbsp;r7}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 如果有必要，拷贝数据段。</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 对比__data_loc和_sdata</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ __data_loc是数据段在内核代码映像中的存储位置</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ _sdata是数据段的链接位置（在内存中的位置）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 如果是XIP技术的内核，这两个数据肯定不同</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;cmpne&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 检测数据是否拷贝完成</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldrne&nbsp;&nbsp;&nbsp;&nbsp;fp,&nbsp;[r4],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;strne&nbsp;&nbsp;&nbsp;&nbsp;fp,&nbsp;[r5],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bne&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;fp,&nbsp;#0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 清零 BSS 段(and&nbsp;zero fp)</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 检测是否完成</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;strcc&nbsp;&nbsp;&nbsp;&nbsp;fp,&nbsp;[r6],#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bcc&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li> </li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;这里将需要的数据从寄存器中转移到全局变量中，<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;因为最后会跳入C代码，寄存器会被使用。<br></strong></li> 
       <li><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</strong></li> 
       <li>&nbsp;ARM(&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;{r4,&nbsp;r5,&nbsp;r6,&nbsp;r7,&nbsp;sp})</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;{r4,&nbsp;r5,&nbsp;r6,&nbsp;r7}&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li>&nbsp;THUMB(&nbsp;&nbsp;&nbsp;&nbsp;ldr&nbsp;&nbsp;&nbsp;&nbsp;sp,&nbsp;[r3,&nbsp;#16]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r9, [r4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 保存 processor ID到全局变量processor_id<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r1, [r5]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 保存 machine type到全局变量__machine_arch_type<br></span></strong></li> 
       <li><strong><span style="color:#0000f0;">&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r2, [r6]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 保存 atags指针到全局变量__atags_pointer<br></span></strong></li> 
       <li><strong><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;bic&nbsp;&nbsp;&nbsp;&nbsp;r4, r0, #CR_A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 清除cp15 控制寄存器值的 'A' bit（禁用对齐错误检查）<br></span></strong></li> 
       <li><strong><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;stmia&nbsp;&nbsp;&nbsp;&nbsp;r7, {r0, r4}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 保存控制寄存器值到全局变量cr_alignment(在arch/arm/kernel/entry-armv.S)</span></strong></li> 
       <li><strong><span style="color:#f00000;">&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;start_kernel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 跳入C代码（init/main.c）</span></strong></li> 
       <li>ENDPROC(__mmap_switched)</li> 
       <li> </li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align&nbsp;&nbsp;&nbsp;&nbsp;2</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.type&nbsp;&nbsp;&nbsp;&nbsp;__mmap_switched_data,&nbsp;%object</li> 
       <li>__mmap_switched_data:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__data_loc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;_sdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__bss_start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;_end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r7</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;processor_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__machine_arch_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__atags_pointer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r6</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;cr_alignment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r7</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;init_thread_union&nbsp;+&nbsp;THREAD_START_SP @ sp</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.size&nbsp;&nbsp;&nbsp;&nbsp;__mmap_switched_data,&nbsp;.&nbsp;-&nbsp;__mmap_switched_data</li> 
       <li> </li> 
       <li>/*</li> 
       <li>&nbsp;*&nbsp;这里提供一个 C-API 版本的 __lookup_processor_type</li> 
       <li>&nbsp;*/</li> 
       <li>ENTRY(lookup_processor_type)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;stmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r6,&nbsp;r9,&nbsp;lr}</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r9,&nbsp;r0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;__lookup_processor_type</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r5</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmfd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{r4&nbsp;-&nbsp;r6,&nbsp;r9,&nbsp;pc}</li> 
       <li>ENDPROC(lookup_processor_type)</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;读取处理器ID寄存器&nbsp;(CP#15,&nbsp;CR0),&nbsp;并且查找编译时确定的处理器<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;支持列表.&nbsp;注意：我们不能对__proc_info使用绝对地址，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;因为我们还没有重新初始化页表（MMU已关闭，之前是解压时使用的1：1映射）。<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;(我们不在正确的地址空间：内核是按虚拟地址（0xc00008000）编译的，<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;而现在我们运行在MMU关闭的情况下)。<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;我们必须计算偏移量。<br></strong></li> 
       <li><strong>&nbsp;*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;r9&nbsp;=&nbsp;cpuid<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;Returns:<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r4,&nbsp;r6 被篡改<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;r5&nbsp;=&nbsp;proc_info 指针（物理地址空间）<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;r9&nbsp;=&nbsp;cpuid&nbsp;(保留)<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;__CPUINIT</li> 
       <li>__lookup_processor_type:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;__lookup_processor_type_data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@获取运行时的地址数据</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;{r4&nbsp;-&nbsp;r6}&nbsp;&nbsp;&nbsp;&nbsp;@获取编译时确定的地址数据（虚拟地址）</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 获取地址偏移 virt&amp;phys(r3)</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 将虚拟地址空间转换为物理地址空间</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r6,&nbsp;r6,&nbsp;r3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ r5=__proc_info_begin r6=__proc_info_end</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;ldmia&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;{r3,&nbsp;r4}&nbsp;&nbsp;&nbsp;&nbsp;@ 获取proc_info_list结构体中的value,&nbsp;mask</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;r4,&nbsp;r4,&nbsp;r9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 利用掩码处理从CP15获取的处理器ID</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;teq&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 对比编译时确定的处理器ID</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;beq&nbsp;&nbsp;&nbsp;&nbsp;2f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 若处理器ID匹配，返回</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r5,&nbsp;#PROC_INFO_SZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 利用sizeof(proc_info_list)跳入下一个处理器ID的匹配</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;r6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 是否已经处理完proc_info_list数据</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;blo&nbsp;&nbsp;&nbsp;&nbsp;1b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 如果还有proc_info_list数据，再次检查匹配</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r5,&nbsp;#0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ 否则，编译的内核与此处理器不匹配，r5&nbsp;=&nbsp;#0</li> 
       <li>2:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;pc,&nbsp;lr</li> 
       <li>ENDPROC(__lookup_processor_type)</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;参见&nbsp;&lt;asm/procinfo.h&gt;&nbsp;中关于 __proc_info 结构体的信息.<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align&nbsp;&nbsp;&nbsp;&nbsp;2</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.type&nbsp;&nbsp;&nbsp;&nbsp;__lookup_processor_type_data,&nbsp;%object</li> 
       <li>__lookup_processor_type_data:</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;.</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__proc_info_begin</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.long&nbsp;&nbsp;&nbsp;&nbsp;__proc_info_end</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.size&nbsp;&nbsp;&nbsp;&nbsp;__lookup_processor_type_data,&nbsp;.&nbsp;-&nbsp;__lookup_processor_type_data</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;处理器ID不匹配时的入口<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;如果启用了调试信息，会从consol打印提示信息<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;之后会进入__error的死循环<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>__error_p:</li> 
       <li>#ifdef CONFIG_DEBUG_LL</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;str_p1</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;printascii</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r9</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;printhex8</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;adr&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;str_p2</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;bl&nbsp;&nbsp;&nbsp;&nbsp;printascii</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;__error</li> 
       <li>str_p1:&nbsp;&nbsp;&nbsp;&nbsp;.asciz&nbsp;&nbsp;&nbsp;&nbsp;"\nError: unrecognized/unsupported processor variant (0x"</li> 
       <li>str_p2:&nbsp;&nbsp;&nbsp;&nbsp;.asciz&nbsp;&nbsp;&nbsp;&nbsp;").\n"</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;.align</li> 
       <li>#endif</li> 
       <li>ENDPROC(__error_p)</li> 
       <li> </li> 
       <li><strong>/*<br></strong></li> 
       <li><strong>&nbsp;*&nbsp;出错时的死循环入口<br></strong></li> 
       <li><strong>&nbsp;*/</strong></li> 
       <li>__error:</li> 
       <li>#ifdef CONFIG_ARCH_RPC</li> 
       <li>/*</li> 
       <li>&nbsp;*&nbsp;出错时屏幕变红&nbsp;-&nbsp;RiscPC only.</li> 
       <li>&nbsp;*/</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;#0x02000000</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;#0x11</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;r3,&nbsp;lsl #8</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;orr&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;r3,&nbsp;r3,&nbsp;lsl #16</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;str&nbsp;&nbsp;&nbsp;&nbsp;r3,&nbsp;[r0],&nbsp;#4</li> 
       <li>#endif</li> 
       <li>1:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;r0,&nbsp;r0</li> 
       <li>&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;1b</li> 
       <li>ENDPROC(__error)</li> 
      </ol>
     </div> 
    </div> 
    <div>
     &nbsp;
    </div> 
   </div> 
   <div class="Blog_con2_1 Blog_con3_2">
    &nbsp;
   </div> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
