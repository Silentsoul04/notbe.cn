<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Unity原厂讲师大解密 « NotBeCN</title>
  <meta name="description" content="                                     文章目录[点击展开](?)[+]             Asset Bundle工作流程及人物换装实例- 刘刚               Unity内部的资源有两种         AB选项的差异         WWWDispose ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/15/weixin_33840661_90129005.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Unity原厂讲师大解密</h1>
    <p class="post-meta">Nov 15, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1><br></h1> 
   <div class="clear"></div> 
   <div class="postBody"> 
    <div style="clear:both;"></div> 
    <div class="cnblogs_toc"> 
     <p><span><a title="系统根据文章中H1到H6标签自动生成文章目录" id="TocTitle" href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#" rel="nofollow">文章目录[点击展开](?)</a></span><a title="展开" id="TocTitleSymbol" href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#" rel="nofollow">[+]</a></p> 
     <ol style="line-height:160%;margin-left:14px;">
      <li> <a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t0" rel="nofollow">Asset Bundle工作流程及人物换装实例- 刘刚</a>
       <ol>
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t1" rel="nofollow">Unity内部的资源有两种</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t2" rel="nofollow">AB选项的差异</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t3" rel="nofollow">WWWDispose</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t4" rel="nofollow">AssetBundle可以作相关性</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t5" rel="nofollow">Code安全性</a></li> 
       </ol></li> 
      <li> <a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t6" rel="nofollow">大规模场景的资源拆解和动态载入-张鑫</a>
       <ol>
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t7" rel="nofollow">拆分有两种</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t8" rel="nofollow">地形资源怎么拆先生成空的NxN的Terrain</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t9" rel="nofollow">地表资料怎么拆</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t10" rel="nofollow">拆好了 如何显示</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t11" rel="nofollow">载入时间比较</a></li> 
       </ol></li> 
      <li> <a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t12" rel="nofollow">使用Unity引擎开发3D网页游戏- 刘刚</a>
       <ol>
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t13" rel="nofollow">Web游戏内容保护</a></li>
       </ol></li> 
      <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t14" rel="nofollow">Unity的网络解决方案</a></li> 
      <li> <a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t15" rel="nofollow">Unity引擎的性能優化 - 張鑫</a>
       <ol>
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t16" rel="nofollow">Mobile優化</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t17" rel="nofollow">静态对象</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t18" rel="nofollow">纹理格式</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t19" rel="nofollow">粒子</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t20" rel="nofollow">动画部分</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t21" rel="nofollow">渲染部份</a></li> 
        <li><a href="http://www.cnblogs.com/zhaoqingqing/p/4021915.html#t22" rel="nofollow">文献资料</a></li> 
       </ol></li> 
     </ol>
    </div> 
    <div style="clear:both;">
     <br>
    </div> 
    <div class="blogpost-body"> 
     <h2> <a name="t0"></a>Asset Bundle工作流程及人物换装实例- 刘刚</h2> 
     <h3> <a name="t1"></a>Unity内部的资源有两种</h3> 
     <ul>
      <li>Resources：有10年历史，尽量用资产包</li> 
      <li>Asset Bundle：昵称AB，现今Unity处理资源的中心</li> 
     </ul>
     <h3> <a name="t2"></a>AB选项的差异</h3> 
     <ul>
      <li>透过Web Player下载Asset Bundle的Cache需要收费，在iOS，Android的Cache不需收费。---&gt;手持游戏顶起来用!!!</li> 
      <li>浏览器本身也有Cache，为什么要用Unity的Cache？</li> 
     </ul>
     <ol>
      <li>因为存在Cache里面是解压状态，下次调用不需再解压一次，大省CPU时间。</li> 
      <li>Unity会管理Cache大小，压缩档案解压后会丢掉。</li> 
     </ol>
     <ul>
      <li>Browser就只能存压缩状态的Asset Bundle，而且位置每种Browser都不同。--&gt;有付钱有差</li>
     </ul>
     <ul>
      <li>AssetBundle.CreateFromMemory：大多数用在对内容作加解密，无法Cache，也就是每次执行都要下载一次，Script也可加密</li> 
      <li>AssetBundle.CreateFromFile</li> 
      <li>AssetBundle.Load与Application.Load的差异，Application.Load只能装载StreamAsset里面的东西。</li> 
      <li>每开一个www用来下载AssetBundle，就要用掉8MB的Buffer，所以www下载完要作以下动作来清掉那8M：</li> 
     </ul>
     <h3> <a name="t3"></a>WWW.Dispose</h3> 
     <ul>
      <li>AssetBundle.Unload（假）</li> 
      <li>Resources.UnloadUnusedAssets</li> 
     </ul>
     <h3> <a name="t4"></a>AssetBundle可以作相关性！</h3> 
     <ol>
      <li>BuildPipeline.PushAssetDependencies，把资源推进去</li> 
      <li>BuildPipelinePopAssetDependencies，把资源弹出来</li> 
     </ol>
     <p>&nbsp;</p> 
     <ul>
      <li>假设Push以下资源：A，B，C，透过Push&amp;Pop，可以产生3个Packege，C依赖B，A，B依赖A，A独立的Asset Bundles，完全不会重复包资源！</li> 
      <li>在一个Prefab里面会有Mesh，Material，Shader，Texture，Script，都应该分开包，Load的时候再按照顺序Load回来，再配合上Cache机制，已经下载过的Asset Bundle就不需再下载一遍，可以达到资源、频宽的最佳使用-​​-&gt;不过这个资源相依的逻辑必须要设计清楚，否则会很乱</li> 
      <li>官方的实务建议是每个Asset Bundle在1M左右，太小下载次数会过多，太大下载时间过久。</li> 
      <li>可以把Script放在ScriptObject里面，再透过Asset Bundle载回来，如此就不需一定要将Script放在第一包​​。</li> 
      <li>官方Demo案例，透过Dependency的使用可将131MB大小缩成8.2M!</li> 
      <li>角色纸娃娃的处理方式，可以参考Unity提供的Character Customization范例，看里面如何拆分Asset Bundle。</li> 
      <li>地图处理方式，可以把地图拆成多个子场景，在主角移动时即时下载，即时显示。</li> 
      <li>Asset Bundle有CRC机制，如果下载有问题会自行重新下载</li> 
     </ul>
     <h3> <a name="t5"></a>Code安全性</h3> 
     <ul>
      <li>iOS平台封閉，不需擔心(JB就再說)</li> 
      <li>其他平台可用资产包+把代码作成。NET组件+ AssetBundle.CreateFromMemory加解密来作</li> 
      <li>Web不适用于把code包成Native DLL的形式</li> 
     </ul>
     <h2> <a name="t6"></a>大规模场景的资源拆解和动态载入-张鑫</h2> 
     <ul>
      <li>进入场景全部载入，耗时，玩家根本没走到</li> 
      <li>Unity场景只有支援4096X4096，单位公尺，没办法作更大的场景</li> 
     </ul>
     <h3> <a name="t7"></a>拆分有两种</h3> 
     <ul>
      <li>地形资源拆分</li> 
      <li>地表拆分</li> 
     </ul>
     <ul>
      <li>推薦拆分工具：Terrain Composer，<a href="http://www.terraincomposer.com/" rel="nofollow">http://www.terraincomposer.com/</a>，最大可以拆8x8，每塊大小2000x2000，也就是16000x16000，也就是16kmX16km</li> 
      <li>如果地形早就已经编好一堆了，该怎么办？自行拆分</li> 
     </ul>
     <h3> <a name="t8"></a>地形资源怎么拆？先生成空的NxN的Terrain</h3> 
     <ul>
      <li>Terrain Data：把Data放到對應分塊--&gt;大工程</li> 
      <li>光照图：用免费图片来拆光地图的.exr档案，免费图片有提供c + +原生的DLL</li> 
      <li>LOD：重新把每一块地形作Terrain.SetNeighbors</li> 
     </ul>
     <h3> <a name="t9"></a>地表资料怎么拆？</h3> 
     <ul>
      <li> 
       <ul>
        <li>根据地形分块来拆</li> 
        <li>用之前提到AssetBundle Depedency的方式打包</li> 
        <li>一包在1M左右</li> 
       </ul></li>
     </ul>
     <h3> <a name="t10"></a>拆好了， 如何显示？</h3> 
     <ul>
      <li> 
       <ul>
        <li>AssetBundle太大，在進場景就先Load</li> 
        <li>摄影机移动时，载入以摄影机为中心那一个的九宫格，其他的就释放掉，确保记忆体使用量，兼顾效率。</li> 
        <li>避免頻繁的Instantiate，Destroy，造成拉機(?)回收機制太頻繁(平均要10幾ms)，可用Object Pool。</li> 
        <li>避免开多个www同时下载，耗记忆体，www是使用Thread，会加大系统负担。</li> 
        <li>Coroutine也不要开太多，官方建议一个Coroutine循序下载多个Resource</li> 
       </ul></li>
     </ul>
     <h3> <a name="t11"></a>载入时间比较：</h3> 
     <ul>
      <li>Shader，Material：载入时间最久，主要在Parse内容进GPU，建议先载进来，反正不占记忆体。这也是Demo案例1xFPS到5xFPS的关键。--&gt; 第一次提到</li> 
      <li>纹理，粒子</li> 
      <li>Mecanim，音频</li> 
     </ul>
     <ul>
      <li>Object Pool范例请参考AngryBot里面的子弹</li> 
      <li>现场Demo拆分后的场景，画面精细度很好，地图超过4096x4096，飞机一边飞一边动态下载AssetBundle后显示地形，FPS在50以上，在主流手机上也顺畅。</li> 
     </ul>
     <hr>
     <h2> <a name="t12"></a>使用Unity引擎开发3D网页游戏- 刘刚</h2> 
     <ul>
      <li>改加载统一显示的标志，unityObject.embedUnity，设定参数为3.4</li> 
      <li>UnityObject2（PARAMS），改PARAMS在4.X</li> 
      <li>要彈出新視窗，OpenUrl不行，ExternalEval不行，要用html的iFrame/div，也可用rokbox，<a href="http://www.rockettheme.com/extensions-joomla/rokbox" rel="nofollow">http://www.rockettheme.com/extensions-joomla/rokbox</a> </li> 
      <li>Unity對DB，用WWWForm作Post，用WWW作GET--&gt;直接讀寫DB有點瞎</li> 
     </ul>
     <h3> <a name="t13"></a>Web游戏内容保护</h3> 
     <ul>
      <li>code加密：把Code包成Asset Bundle後，存成TextAsset，再包成AssetBundle(For Cache!)，取用時要用Reflection取用，極難用。</li> 
      <li>code混淆：推薦作法，Web平台要官方幫忙，Android可以自己作，iOS聽說不用作</li> 
      <li>资源加密：最需要的是Texture，可加密后存成TextAsset，记得再包成AssetBundle才能用Cache。</li> 
     </ul>
     <ul>
      <li>记忆体Leak，4.1.2的Profile可以看到所有GameObject的状态，请多用Profiler</li> 
      <li>动态载入，用ScriptableObject定义场景描述档，记录Dependency，然后根据这些资料来载场景内容。</li> 
      <li>协程在团结不是多线程，多用还是会拖为主线，请慎用。</li> 
      <li>在一个新场景或新关卡，把Material与Shader先Load出来，放到一个空的GameObject里面，然后Diactive，有需要在放到正确的地方。--&gt; 第二次提到</li> 
      <li>AssetBundle打包顆粒度，Debug可以包越小越好，Release建議1MB</li> 
      <li>封住右键功能，防止使用者更换Unity Player版本。</li> 
      <li>从放游戏的Web Server上取其他URL的资源，要设定CrossDomain.xml</li> 
      <li>如果不用Asset Bundle，自行作压缩解压缩，一定要在载下来的时候马上解压缩，而且用AssetBundle.CreateFromMemory，耗时。--&gt;AssetBundle的确是要Load才需要解压...</li> 
      <li>Material，Shader先打包吧！--&gt; 这应该算第三次提到吧？因为很重要所以要讲三次？?</li> 
     </ul>
     <hr>
     <h2> <a name="t14"></a>Unity的网络解决方案</h2> 
     <ul>
      <li>非常好睡zzzzz</li> 
      <li>Photon Server：C#界面，底层用C++实作，可负荷30K同时在线，Load Balance机制，有FPS范例，用TCP与RUDP，只能用Windows。</li> 
      <li>SmartFox Server，&nbsp; <a href="http://www.smartfoxserver.com/" rel="nofollow">http://www.smartfoxserver.com/</a>，Java实作，可用Windows/Linux，没有Load Balance，提供多种监控与管理界面。</li> 
      <li>用RakNet自己作</li> 
     </ul>
     <hr>
     <h2> <a name="t15"></a>Unity引擎的性能優化 - 張鑫</h2> 
     <h3> <a name="t16"></a>Mobile優化</h3> 
     <ul>
      <li>300~2000個Polygon</li> 
      <li>蒙皮网格渲染器同时最多一个</li> 
      <li>Texture數量同時1~3</li> 
      <li>bone數量&lt;30</li> 
     </ul>
     <h3> <a name="t17"></a>静态对象</h3> 
     <ul>
      <li>&lt;500 poly</li> 
      <li>标记 static</li> 
      <li>不要用Animation</li> 
     </ul>
     <ul>
      <li>地形：Texture數量&lt;4，用Texture融合，可加5fps~10fps</li>
     </ul>
     <h3> <a name="t18"></a>纹理格式</h3> 
     <ul>
      <li>用PNG，TGA</li> 
      <li>不要超过1024</li> 
      <li>看起来像就好，可以用128x128，就不要用256x256</li> 
      <li>用mipmap</li> 
      <li>控制UV范围在(0, 1)--&gt;原来还可以超过?</li> 
     </ul>
     <ul>
      <li>Mesh簡化，用MeshLab，但只能簡化靜態Mesh。用Simplygon，</li> 
      <li>Mesh簡化，Animation簡化，用Simplygon，<a href="http://www.simplygon.com/" rel="nofollow">http://www.simplygon.com/</a>，要錢，效果好。</li> 
      <li>不要用System.xml用mono.xml，减少程式码大小</li> 
      <li>Forwarding Light原理，要draw的Object數量X光源數，所以光源越少越好。</li> 
      <li>把Pixel Light设定固定值，美术再多光也只有一个。</li> 
     </ul>
     <h3> <a name="t19"></a>粒子</h3> 
     <p>粒子在Mobile平台，是以Block为单位Render，太多粒子会加高像素填充率，因为粒子没有深度，所以一定要画，Mobile平台的功率不够就会大大拖效能。</p> 
     <ul>
      <li>粒子小一点</li> 
      <li>粒子數量&lt;50</li> 
      <li>粒子不要有Alpha</li> 
      <li>粒子不要碰撞</li> 
     </ul>
     <ul>
      <li>儘量不使用Mesh Colider，用Box，CapsuleCollider</li>
     </ul>
     <h3> <a name="t20"></a>动画部分</h3> 
     <ul>
      <li>没需要不用Animation，不需要每个东西都会动</li> 
      <li>没有缩放，手动或程式作业把Scale Curve去掉，可以减少33% Blending作业</li> 
      <li>Mecanim是多绪执行，不会拖Main Thread，一个Game Object上多个Animation clip才有用，如果只有一个clip，可考虑只用Animation</li> 
      <li>用Body Mask告訴Mecanim哪邊不需要計算</li> 
     </ul>
     <h3> <a name="t21"></a>渲染部份</h3> 
     <ul>
      <li>避免alpha测试，alpha混合</li> 
      <li>Static Batching需要大量的VertexBuffer，如果Vertex過多，要把一堆Vertex搬來搬去，反而拖效能</li> 
      <li>Dynamic Batching在Polygon &lt; 900會自動作用，如果GameObject的Shader有Position，Normal，UV，每多用一個，900就要減半。</li> 
      <li>在使用Dynamic Batching時，Vertex只能在CPU作結合，所以Vertex不能太多</li> 
      <li>如果同一场景中小块Texture很多，可以考虑用程式将Texture拼合，要拼合的Texture如果UV超过(0, 1)就很难作。</li> 
     </ul>
     <ul>
      <li>移动平台的遮挡剔除适合用PV和动态对象</li> 
      <li>用for代替foreach，因为的foreach会生一堆迭代器</li> 
      <li>用Struct代替class，快30倍</li> 
      <li>传说中8小时一定回信的高级 email support</li> 
      <li>影子的优化，可参考ShadowGun模拟影子的实作</li> 
      <li>接下来Unity的Roadmap会支援新UI(讲好久了)与Server。</li> 
     </ul>
     <h3> <a name="t22"></a>文献资料</h3> 
     <p>本文转载自：<a title="http://nedwu13.blogspot.tw/2013_11_01_archive.html" href="http://nedwu13.blogspot.tw/2013_11_01_archive.html" rel="nofollow">http://nedwu13.blogspot.tw/2013_11_01_archive.html</a> (墙外)</p> 
     <p><br></p> 
     <p>本文转自赵青青博客园博客，原文链接：http://www.cnblogs.com/zhaoqingqing/p/4021915.html，如需转载请自行联系原作者<br></p> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
