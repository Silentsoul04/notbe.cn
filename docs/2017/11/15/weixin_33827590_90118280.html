<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>GDI+ 两个汇总 ： 为什么CImage类别是根据GDI+的？ « NotBeCN</title>
  <meta name="description" content="             &nbsp; 在很多资料上都说CImage类是基于GDI+的，可是为什么是基于GDI+的呢？    &nbsp;    &nbsp;&nbsp;&nbsp;&nbsp; 由于使用这个类时，并没有增加#include &lt;gdiplus.h&gt; 。也没有在程序開始和结束时分别写GD...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/15/weixin_33827590_90118280.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">GDI+ 两个汇总 ： 为什么CImage类别是根据GDI+的？</h1>
    <p class="post-meta">Nov 15, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp; 在很多资料上都说CImage类是基于GDI+的，可是为什么是基于GDI+的呢？</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp;&nbsp; 由于使用这个类时，并没有增加#include &lt;gdiplus.h&gt; 。也没有在程序開始和结束时分别写GDI+启动代码GdiplusStartupInput和结束代码GdiplusShutdown</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">使用这个类时。只须要加入头文件# include&lt;altimage.h&gt;就能够了，比GDI+得使用要简单一些。</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;而CImage 对图片的处理非常类似GDI+ 。其内部是不是封装了GDI+呢？ 幸好，CImage类 是源代码公开的，我们能够研究其源代码。以便加深理解。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp; 首先，看看altimage.h头文件</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#ifndef&nbsp;__ATLIMAGE_H__</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#define&nbsp;__ATLIMAGE_H__</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;once</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;atldef.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;atlbase.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;atlstr.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;atlsimpcoll.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;atltypes.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#ifndef&nbsp;_ATL_NO_PRAGMA_WARNINGS</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;warning&nbsp;(push)</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;warning(disable&nbsp;:&nbsp;4820)&nbsp;//&nbsp;padding&nbsp;added&nbsp;after&nbsp;member</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#endif&nbsp;//!_ATL_NO_PRAGMA_WARNINGS</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;warning(&nbsp;push,&nbsp;3&nbsp;)</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;push_macro("new")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#undef&nbsp;new</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;gdiplus.h&gt;&nbsp;&nbsp;&nbsp;//&nbsp;注意这里：加入了GDI+得头文件</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;pop_macro("new")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;warning(&nbsp;pop&nbsp;)</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#include&nbsp;&lt;shlwapi.h&gt;</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#ifndef&nbsp;_ATL_NO_DEFAULT_LIBS</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;comment(lib,&nbsp;"gdi32.lib")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;comment(lib,&nbsp;"shlwapi.lib")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;comment(lib,&nbsp;"gdiplus.lib")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#if&nbsp;WINVER&nbsp;&gt;=&nbsp;0x0500</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;comment(lib,&nbsp;"msimg32.lib")</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#endif&nbsp;&nbsp;//&nbsp;WINVER&nbsp;&gt;=&nbsp;0x0500</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#endif&nbsp;&nbsp;//&nbsp;!_ATL_NO_DEFAULT_LIBS</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#pragma&nbsp;pack(push,&nbsp;_ATL_PACKING)</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> 上面包括了GDI+得头文件</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">再来看CImage的定义：</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">class</span><span style="line-height:1.8;border:none;">&nbsp;CImage&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">private</span><span style="line-height:1.8;border:none;">:&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">class</span><span style="line-height:1.8;border:none;">&nbsp;CDCCache&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">public</span><span style="line-height:1.8;border:none;">:&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CDCCache()&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~CDCCache()&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HDC</span><span style="line-height:1.8;border:none;">&nbsp;GetDC()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;ReleaseDC(&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HDC</span><span style="line-height:1.8;border:none;">&nbsp;)&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">private</span><span style="line-height:1.8;border:none;">:&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HDC</span><span style="line-height:1.8;border:none;">&nbsp;m_ahDCs[CIMAGE_DC_CACHE_SIZE];&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">class</span><span style="line-height:1.8;border:none;">&nbsp;CInitGDIPlus&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">public</span><span style="line-height:1.8;border:none;">:&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CInitGDIPlus()&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~CInitGDIPlus()&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">bool</span><span style="line-height:1.8;border:none;">&nbsp;Init()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;ReleaseGDIPlus()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;IncreaseCImageCount()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;DecreaseCImageCount()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">();&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">private</span><span style="line-height:1.8;border:none;">:&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">ULONG_PTR</span><span style="line-height:1.8;border:none;">&nbsp;m_dwToken;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CRITICAL_SECTION&nbsp;m_sect;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LONG</span><span style="line-height:1.8;border:none;">&nbsp;m_nCImageObjects;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static</span><span style="line-height:1.8;border:none;">&nbsp;CInitGDIPlus&nbsp;s_initGDIPlus;&nbsp;&nbsp;</span></span></li>
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static</span><span style="line-height:1.8;border:none;">&nbsp;CDCCache&nbsp;s_cache;&nbsp;&nbsp;</span></span></li>
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br><br> 它定义了两个类成员变量： 当中CInitGDIPlus 是负责GDI+的启动和释放</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">我们再看一下，这个成员类的Init()方法：</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">bool</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CInitGDIPlus::Init()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">bool</span><span style="line-height:1.8;border:none;">&nbsp;fRet&nbsp;=&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">true</span><span style="line-height:1.8;border:none;">;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;m_dwToken&nbsp;==&nbsp;0&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::GdiplusStartupInput&nbsp;input;&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::GdiplusStartupOutput&nbsp;output;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Status&nbsp;status&nbsp;=&nbsp;Gdiplus::GdiplusStartup(&nbsp;&amp;m_dwToken,&nbsp;&amp;input,&nbsp;&amp;output&nbsp;);&nbsp;&nbsp;&nbsp;<span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">//启动GDI+</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fRet&nbsp;=&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">false</span><span style="line-height:1.8;border:none;">;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;fRet;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> 也就是说 使用这个函数 启动GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">再看下一个函数：</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CInitGDIPlus::ReleaseGDIPlus()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;m_dwToken&nbsp;!=&nbsp;0&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::GdiplusShutdown(&nbsp;m_dwToken&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_dwToken&nbsp;=&nbsp;0;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> 也就是说， 使用这一个函数，用来关闭GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">到此，我们便可知道。CImage类是基于GDI+的，可是我们还不知道CImage 对象是不是在初始化时就启动了GDI+？假设不是。那什么时候才启动GDI+呢？</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">为解决这个疑惑，我们查看CImage 构造函数</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CImage()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;:&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_hBitmap(&nbsp;NULL&nbsp;),&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_pBits(&nbsp;NULL&nbsp;),&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_hDC(&nbsp;NULL&nbsp;),&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nDCRefCount(&nbsp;0&nbsp;),&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_hOldBitmap(&nbsp;NULL&nbsp;),&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nWidth(&nbsp;0&nbsp;),&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nHeight(&nbsp;0&nbsp;),&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nPitch(&nbsp;0&nbsp;),&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nBPP(&nbsp;0&nbsp;),&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_iTransparentColor(&nbsp;-1&nbsp;),&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_bHasAlphaChannel(&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">false</span><span style="line-height:1.8;border:none;">&nbsp;),&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_bIsDIBSection(&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">false</span><span style="line-height:1.8;border:none;">&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s_initGDIPlus.IncreaseCImageCount();&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CInitGDIPlus::IncreaseCImageCount()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_nCImageObjects++;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> 由此可见，构造函数并没有启动GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">也就是说定义&nbsp; CImage image;&nbsp; 这个image变量时。并没有启动GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">我们继续查找：</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">bool</span><span style="line-height:1.8;border:none;">&nbsp;CImage::InitGDIPlus()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">bool</span><span style="line-height:1.8;border:none;">&nbsp;bSuccess&nbsp;=&nbsp;s_initGDIPlus.Init();&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;bSuccess&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> CImage使用InitGDIPlus（） 来初始化GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">因此我们查找InitGDIPlus() 的全部引用 。发现下面函数：</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::GetImporterFilterString(&nbsp;CSimpleString&amp;&nbsp;strImporters,&nbsp;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;CSimpleArray&lt;&nbsp;GUID&nbsp;&gt;&amp;&nbsp;aguidFileTypes,&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LPCTSTR</span><span style="line-height:1.8;border:none;">&nbsp;pszAllFilesDescription&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;NULL&nbsp;*/</span><span style="line-height:1.8;border:none;">,&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">DWORD</span><span style="line-height:1.8;border:none;">&nbsp;dwExclude&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;excludeDefaultLoad&nbsp;*/</span><span style="line-height:1.8;border:none;">,&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">TCHAR</span><span style="line-height:1.8;border:none;">&nbsp;chSeparator&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;'|'&nbsp;*/</span><span style="line-height:1.8;border:none;">&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nCodecs;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nSize;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Status&nbsp;status;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;pCodecs;&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageDecodersSize(&nbsp;&amp;nCodecs,&nbsp;&amp;nSize&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;USES_ATL_SAFE_ALLOCA;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;pCodecs&nbsp;=&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;&gt;(&nbsp;_ATL_SAFE_ALLOCA(nSize,&nbsp;_ATL_SAFE_ALLOCA_DEF_THRESHOLD)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;pCodecs&nbsp;==&nbsp;NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;E_OUTOFMEMORY;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageDecoders(&nbsp;nCodecs,&nbsp;nSize,&nbsp;pCodecs&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;BuildCodecFilterString(&nbsp;pCodecs,&nbsp;nCodecs,&nbsp;strImporters,&nbsp;aguidFileTypes,&nbsp;pszAllFilesDescription,&nbsp;dwExclude,&nbsp;chSeparator&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;S_OK&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::GetExporterFilterString(&nbsp;CSimpleString&amp;&nbsp;strExporters,&nbsp;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;CSimpleArray&lt;&nbsp;GUID&nbsp;&gt;&amp;&nbsp;aguidFileTypes,&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LPCTSTR</span><span style="line-height:1.8;border:none;">&nbsp;pszAllFilesDescription&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;NULL&nbsp;*/</span><span style="line-height:1.8;border:none;">,&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">DWORD</span><span style="line-height:1.8;border:none;">&nbsp;dwExclude&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;excludeDefaultSave&nbsp;*/</span><span style="line-height:1.8;border:none;">,&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">TCHAR</span><span style="line-height:1.8;border:none;">&nbsp;chSeparator&nbsp;</span><span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">/*&nbsp;=&nbsp;'|'&nbsp;*/</span><span style="line-height:1.8;border:none;">&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nCodecs;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nSize;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Status&nbsp;status;&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;pCodecs;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageDecodersSize(&nbsp;&amp;nCodecs,&nbsp;&amp;nSize&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;USES_ATL_SAFE_ALLOCA;&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;pCodecs&nbsp;=&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;&gt;(&nbsp;_ATL_SAFE_ALLOCA(nSize,&nbsp;_ATL_SAFE_ALLOCA_DEF_THRESHOLD)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;pCodecs&nbsp;==&nbsp;NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;E_OUTOFMEMORY;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageDecoders(&nbsp;nCodecs,&nbsp;nSize,&nbsp;pCodecs&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;BuildCodecFilterString(&nbsp;pCodecs,&nbsp;nCodecs,&nbsp;strExporters,&nbsp;aguidFileTypes,&nbsp;pszAllFilesDescription,&nbsp;dwExclude,&nbsp;chSeparator&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;S_OK&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::Load(&nbsp;IStream*&nbsp;pStream&nbsp;)&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bmSrc(&nbsp;pStream&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;bmSrc.GetLastStatus()&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;CreateFromGdiplusBitmap(&nbsp;bmSrc&nbsp;)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::Load(&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LPCTSTR</span><span style="line-height:1.8;border:none;">&nbsp;pszFileName&nbsp;)&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bmSrc(&nbsp;(CT2W)pszFileName&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;bmSrc.GetLastStatus()&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;CreateFromGdiplusBitmap(&nbsp;bmSrc&nbsp;)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::Save(&nbsp;IStream*&nbsp;pStream,&nbsp;REFGUID&nbsp;guidFileType&nbsp;)&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">const</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nEncoders;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nBytes;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Status&nbsp;status;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageEncodersSize(&nbsp;&amp;nEncoders,&nbsp;&amp;nBytes&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;USES_ATL_SAFE_ALLOCA;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;pEncoders&nbsp;=&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;&gt;(&nbsp;_ATL_SAFE_ALLOCA(nBytes,&nbsp;_ATL_SAFE_ALLOCA_DEF_THRESHOLD)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;pEncoders&nbsp;==&nbsp;NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;E_OUTOFMEMORY;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageEncoders(&nbsp;nEncoders,&nbsp;nBytes,&nbsp;pEncoders&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;CLSID&nbsp;clsidEncoder&nbsp;=&nbsp;FindCodecForFileType(&nbsp;guidFileType,&nbsp;pEncoders,&nbsp;nEncoders&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;clsidEncoder&nbsp;==&nbsp;CLSID_NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;m_bHasAlphaChannel&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATLASSUME(&nbsp;m_nBPP&nbsp;==&nbsp;32&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bm(&nbsp;m_nWidth,&nbsp;m_nHeight,&nbsp;m_nPitch,&nbsp;PixelFormat32bppARGB,&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">BYTE</span><span style="line-height:1.8;border:none;">*&nbsp;&gt;(&nbsp;m_pBits&nbsp;)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;bm.Save(&nbsp;pStream,&nbsp;&amp;clsidEncoder,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bm(&nbsp;m_hBitmap,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;bm.Save(&nbsp;pStream,&nbsp;&amp;clsidEncoder,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;S_OK&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">HRESULT</span><span style="line-height:1.8;border:none;">&nbsp;CImage::Save(&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LPCTSTR</span><span style="line-height:1.8;border:none;">&nbsp;pszFileName,&nbsp;REFGUID&nbsp;guidFileType&nbsp;)&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">const</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;!InitGDIPlus()&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nEncoders;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">UINT</span><span style="line-height:1.8;border:none;">&nbsp;nBytes;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Status&nbsp;status;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageEncodersSize(&nbsp;&amp;nEncoders,&nbsp;&amp;nBytes&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;USES_CONVERSION_EX;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;pEncoders&nbsp;=&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;Gdiplus::ImageCodecInfo*&nbsp;&gt;(&nbsp;_ATL_SAFE_ALLOCA(nBytes,&nbsp;_ATL_SAFE_ALLOCA_DEF_THRESHOLD)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;pEncoders&nbsp;==&nbsp;NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;E_OUTOFMEMORY;&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;Gdiplus::GetImageEncoders(&nbsp;nEncoders,&nbsp;nBytes,&nbsp;pEncoders&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;CLSID&nbsp;clsidEncoder&nbsp;=&nbsp;CLSID_NULL;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;guidFileType&nbsp;==&nbsp;GUID_NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">//&nbsp;Determine&nbsp;clsid&nbsp;from&nbsp;extension</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clsidEncoder&nbsp;=&nbsp;FindCodecForExtension(&nbsp;::PathFindExtension(&nbsp;pszFileName&nbsp;),&nbsp;pEncoders,&nbsp;nEncoders&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="line-height:1.8;border:none;color:rgb(0,130,0);">//&nbsp;Determine&nbsp;clsid&nbsp;from&nbsp;file&nbsp;type</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clsidEncoder&nbsp;=&nbsp;FindCodecForFileType(&nbsp;guidFileType,&nbsp;pEncoders,&nbsp;nEncoders&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;clsidEncoder&nbsp;==&nbsp;CLSID_NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">LPCWSTR</span><span style="line-height:1.8;border:none;">&nbsp;pwszFileName&nbsp;=&nbsp;T2CW_EX(&nbsp;pszFileName,&nbsp;_ATL_SAFE_ALLOCA_DEF_THRESHOLD&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#ifndef&nbsp;_UNICODE</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;pwszFileName&nbsp;==&nbsp;NULL&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">&nbsp;E_OUTOFMEMORY;&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="preprocessor" style="line-height:1.8;border:none;color:#808080;">#endif&nbsp;//&nbsp;_UNICODE</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;m_bHasAlphaChannel&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATLASSUME(&nbsp;m_nBPP&nbsp;==&nbsp;32&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bm(&nbsp;m_nWidth,&nbsp;m_nHeight,&nbsp;m_nPitch,&nbsp;PixelFormat32bppARGB,&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static_cast</span><span style="line-height:1.8;border:none;">&lt;&nbsp;</span><span class="datatypes" style="line-height:1.8;border:none;color:rgb(46,139,87);font-weight:bold;">BYTE</span><span style="line-height:1.8;border:none;">*&nbsp;&gt;(&nbsp;m_pBits&nbsp;)&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;bm.Save(&nbsp;pwszFileName,&nbsp;&amp;clsidEncoder,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">else</span><span style="line-height:1.8;border:none;">&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::Bitmap&nbsp;bm(&nbsp;m_hBitmap,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status&nbsp;=&nbsp;bm.Save(&nbsp;pwszFileName,&nbsp;&amp;clsidEncoder,&nbsp;NULL&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;status&nbsp;!=&nbsp;Gdiplus::Ok&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;E_FAIL&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">return</span><span style="line-height:1.8;border:none;">(&nbsp;S_OK&nbsp;);&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><strong>有上面可知： CImage对象 在第一次Load() 或第一次Save() 时 启动GDI+</strong></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">以下我们看看 CImage析构时，能否将GDI+关闭掉：</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;CImage::~CImage()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Destroy();&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s_initGDIPlus.DecreaseCImageCount();&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CInitGDIPlus::DecreaseCImageCount()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;--m_nCImageObjects&nbsp;==&nbsp;0&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReleaseGDIPlus();&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">inline</span><span style="line-height:1.8;border:none;">&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">void</span><span style="line-height:1.8;border:none;">&nbsp;CImage::CInitGDIPlus::ReleaseGDIPlus()&nbsp;</span><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">throw</span><span style="line-height:1.8;border:none;">()&nbsp;&nbsp;</span></span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">{&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;EnterCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">if</span><span style="line-height:1.8;border:none;">(&nbsp;m_dwToken&nbsp;!=&nbsp;0&nbsp;)&nbsp;&nbsp;</span></span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gdiplus::GdiplusShutdown(&nbsp;m_dwToken&nbsp;);&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;m_dwToken&nbsp;=&nbsp;0;&nbsp;&nbsp;</span></li> 
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;LeaveCriticalSection(&amp;m_sect);&nbsp;&nbsp;</span></li> 
     <li style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;">}&nbsp;&nbsp;</span></li> 
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> 也就是说，一个CImage对象退出时。并不直接关闭GDI+ ，而是只将GDI+使用计数减一。 当其为0时。再关闭GDI+</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">而这是通过类静态变量来实现计数的：</p> 
   <div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);line-height:26px;"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <strong>[cpp]</strong>&nbsp;
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">view plain</a>
      <a href="http://blog.csdn.net/shuilan0066/article/details/7086371#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);background-image:none;border:none;width:16px;text-indent:-2000px;">copy</a> 
      <div style="width:18px;"></div> 
     </div> 
    </div> 
    <ol style="border:none;color:rgb(92,92,92);">
     <li class="alt" style="list-style:outside;border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;"><span style="line-height:1.8;border:none;color:#000000;"><span class="keyword" style="line-height:1.8;border:none;color:rgb(0,102,153);font-weight:bold;">static</span><span style="line-height:1.8;border:none;">&nbsp;CInitGDIPlus&nbsp;s_initGDIPlus;&nbsp;&nbsp;</span></span></li>
    </ol>
   </div> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br> &nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><strong>由此，我们可作例如以下总结：</strong></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><strong></strong>&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当定义多个CImge 变量时， 当某个变量载入图片或保存图片时，启动GDI+。之后。 当其它变量再载入图片或保存时，添加GDI+计数变量</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当全部CImage变量都析构完成时，才关闭GDI+。否则，仅仅是降低GDI+计算变量值。</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;&nbsp;&nbsp; &nbsp; 所以说，CImage类是基于GDI+的。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;">&nbsp;</p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><strong></strong>&nbsp;转会：<a href="http://blog.csdn.net/shuilan0066/article/details/7086371" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">http://blog.csdn.net/shuilan0066/article/details/7086371</a></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;color:rgb(51,51,51);font-size:14px;font-family:Arial;line-height:26px;"><br></p> 
   <p style="margin-left:auto;line-height:26px;"><font color="#333333"><span style="font-size:14px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/4732065.html，如需转载请自行联系原作者</span></font></p> 
   <div>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
