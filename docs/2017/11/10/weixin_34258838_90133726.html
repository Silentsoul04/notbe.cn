<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Spring IOC 源码浅析 « NotBeCN</title>
  <meta name="description" content="             &nbsp;控制反转（Inversion of Control，英文缩写为IoC）是一个重要的面向对象编程的法则来削减计算机程序的耦合问题，也是轻量级的Spring框架的核心。    &nbsp; &nbsp; &nbsp;控制反转一般分为两种类型，依赖注入（Dependency Inj...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/10/weixin_34258838_90133726.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Spring IOC 源码浅析</h1>
    <p class="post-meta">Nov 10, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;控制反转（Inversion of Control，英文缩写为IoC）是一个重要的面向对象编程的法则来削减计算机程序的耦合问题，也是轻量级的Spring框架的核心。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp;控制反转一般分为两种类型，依赖注入（Dependency Injection，简称DI）和依赖查找。依赖注入应用比较广泛。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp;将控制权从具体的对象手中交给平台或者是框架。</p> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">BeanFactory是基本的功能接口</span></li>
   </ul>
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">interface</span><span style="line-height:1.8;"> BeanFactory {

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里是对FactoryBean的转义定义，因为如果使用bean的名字检索FactoryBean得到的对象是工厂生成的对象，
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果需要得到工厂本身，需要转义       </span>
    String FACTORY_BEAN_PREFIX = "&amp;"<span style="line-height:1.8;">;


    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里根据bean的名字，在IOC容器中得到bean实例，这个IOC容器就是一个大的抽象工厂。</span>
    Object getBean(String name) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException;

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里根据bean的名字和Class类型来得到bean实例，和上面的方法不同在于它会抛出异常：如果根据名字取得的bean实例的Class类型和需要的不同的话。</span>
    Object getBean(String name, Class requiredType) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException;

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里提供对bean的检索，看看是否在IOC容器有这个名字的bean</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">boolean</span><span style="line-height:1.8;"> containsBean(String name);

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里根据bean名字得到bean实例，并同时判断这个bean是不是单件</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">boolean</span> isSingleton(String name) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> NoSuchBeanDefinitionException;

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里对得到bean实例的Class类型</span>
    Class getType(String name) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> NoSuchBeanDefinitionException;

    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里得到bean的别名，如果根据别名检索，那么其原名也会被检索出来</span>
<span style="line-height:1.8;">    String[] getAliases(String name);

}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; BeanFactory只是对IOC容器中的基本行为作了定义，但是并没有管理如何加载 baen.XmlBeanFactory和ApplicationContext。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; Spring提供了一个BeanFactory的基本实现----xmlBaenFactory.AbstractBeanFactory,DefaultListableBeanFactory这些抽象类为其提供模板服务.</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; Resource接口来抽象Bean的数据</span><span style="line-height:1.8;font-size:15px;">对XML定义文件的解释委托给XmlBeanDefinitionReader来完成。</span></p> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">XmlBeanFacotry的使用过程</span></li>
   </ul>
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';">
       <pre>    ClassPathResource res = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> ClassPathResource("beans.xml"<span style="line-height:1.8;">);
    DefaultListableBeanFactory factory </span>= <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> DefaultListableBeanFactory();
    XmlBeanDefinitionReader reader </span>= <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> XmlBeanDefinitionReader(factory);
    reader.loadBeanDefinitions(res);</span></pre>
      </div> 
     </div> 
    </div> 
   </div> 
   <ol style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:decimal;"><span style="line-height:1.8;font-size:15px;">创建IOC配置文件的抽象资源</span></li> 
    <li style="list-style:decimal;"><span style="line-height:1.8;font-size:15px;">创建一个BeanFactory</span></li> 
    <li style="list-style:decimal;"><span style="line-height:1.8;font-size:15px;">把XmlBeanDefinitionReader配置给BeanFactory</span></li> 
    <li style="list-style:decimal;"> <span style="line-height:1.8;font-size:15px;">XmlBeanDefinitionReader完成资源的解释，完成对IOC容器的加载</span><span style="line-height:1.8;font-size:15px;"><span style="line-height:1.5;">&nbsp;</span></span> </li> 
   </ol>
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">XmlBeanFactory的源代码</span></li> 
    <li style="list-style:disc;"> 
     <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
      </div> 
      <pre><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span> XmlBeanFactory <span style="line-height:1.8;color:rgb(0,0,255);">extends</span><span style="line-height:1.8;"> DefaultListableBeanFactory {
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里为容器定义了一个默认使用的bean定义读取器</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">private</span> <span style="line-height:1.8;color:rgb(0,0,255);">final</span> XmlBeanDefinitionReader reader = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> XmlBeanDefinitionReader(<span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">);
    </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> XmlBeanFactory(Resource resource) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">this</span>(resource, <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">);
    }
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">在初始化函数中使用读取器来对资源进行读取，得到bean定义信息。</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> XmlBeanFactory(Resource resource, BeanFactory parentBeanFactory) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">super</span><span style="line-height:1.8;">(parentBeanFactory);
        </span><span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.reader.loadBeanDefinitions(resource);
    }</span></pre> 
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
      </div> 
     </div> </li> 
   </ul>
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; &nbsp;XmlBeanFactoy和ApplicationContext的区别,</span><span style="line-height:1.8;font-size:15px;">XmlBeanFactory不具备定义资源的能力，</span></p> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">ApplicationContext</span></li>
   </ul>
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';">
       <pre>   ApplicationContext = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> FileSystemXmlApplicationContext(xmlPath);</pre>
      </div> 
     </div> 
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp; 继承Messagesource，可以支持不同的信息源</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp; 访问资源，ResourceLoader和Resource，可以从不同的地方来获取Bean的定义资源</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp; 支持应用事件，继承了ApplicationEvnetPublisher接口</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; ApplicationContext允许上下文嵌套 - 通过保持父上下文可以维持一个上下文体系 - 这个体系我们在以后对Web容器中的上下文环境的分析中可以清楚地看到。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; 对于bean的查找可以在这个上下文体系中发生，首先检查当前上下文，其次是父上下文，逐级向上，这样为不同的Spring应用提供了一个共享的bean定义环境。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; 这个我们在分析Web容器中的上下文环境时也能看到。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; ApplicationContext提供IoC容器的主要接口，在其体系中有许多抽象子类比如AbstractApplicationContext为具体的BeanFactory的实现。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; 比如FileSystemXmlApplicationContext和 ClassPathXmlApplicationContext提供上下文的模板，使得他们只需要关心具体的资源定位问题。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; 当应用程序代码实例化 FileSystemXmlApplicationContext的时候，得到IoC容器的一种具体表现 - ApplicationContext，从而应用程序通过ApplicationContext来管理对bean的操作。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp; BeanFactory 是一个接口，在实际应用中我们一般使用ApplicationContext来使用IOC容器，</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;它们也是IOC容器展现给应用开发者的使用接口。对应用程序开发者来说，可以认为BeanFactory和ApplicationFactory在不同的使用层面上代表了SPRING提供的IOC容器服务。</span></p> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">FileSystemXmlApplicationContext简历IOC容器</span></li>
   </ul>
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';"> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
       <pre>   ApplicationContext = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> FileSystemXmlApplicationContext(xmlPath);
    </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> FileSystemXmlApplicationContext(String[] configLocations, <span style="line-height:1.8;color:rgb(0,0,255);">boolean</span><span style="line-height:1.8;"> refresh, ApplicationContext parent)
            </span><span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">super</span><span style="line-height:1.8;">(parent);
        </span><span style="line-height:1.8;color:rgb(0,0,255);">this</span>.configLocations =<span style="line-height:1.8;"> configLocations;
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (refresh) {
          　</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里是IoC容器的初始化过程，其初始化过程的大致步骤由AbstractApplicationContext来定义</span>
<span style="line-height:1.8;">            refresh();
        }
    }</span></pre> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">Refresh的模板在AbstractApplicationContext:refresh的模板在AbstractApplicationContext:refresh的模板在AbstractApplicationContext</span></p> 
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';"> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
       <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span> refresh() <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException, IllegalStateException {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">synchronized</span> (<span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.startupShutdownMonitor) {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">synchronized</span> (<span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.activeMonitor) {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">this</span>.active = <span style="line-height:1.8;color:rgb(0,0,255);">true</span><span style="line-height:1.8;">;
            }

            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 这里需要子类来协助完成资源位置定义,bean载入和向IOC容器注册的过程</span>
<span style="line-height:1.8;">            refreshBeanFactory();
            ............
     }</span></pre> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;这个方法包含了整个BeanFactory初始化的过程，对于特定的FileSystemXmlBeanFactory,我们看到定位资源位置由refreshBeanFactory()来实现</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">在AbstractXmlApplicationContext中定义了对资源的读取过程，默认由XmlBeanDefinitionReader来读取：</span></p> 
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';"> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
       <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span> loadBeanDefinitions(DefaultListableBeanFactory beanFactory) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> IOException {
        </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 这里使用XMLBeanDefinitionReader来载入bean定义信息的XML文件</span>
        XmlBeanDefinitionReader beanDefinitionReader = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> XmlBeanDefinitionReader(beanFactory);

        </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里配置reader的环境，其中ResourceLoader是我们用来定位bean定义信息资源位置的</span>
        <span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">/因为上下文本身实现了ResourceLoader接口，所以可以直接把上下文作为ResourceLoader传递给XmlBeanDefinitionReader</span>
        beanDefinitionReader.setResourceLoader(<span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">);
        beanDefinitionReader.setEntityResolver(</span><span style="line-height:1.8;color:rgb(0,0,255);">new</span> ResourceEntityResolver(<span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">));

        initBeanDefinitionReader(beanDefinitionReader);
        </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里转到定义好的XmlBeanDefinitionReader中对载入bean信息进行处理</span>
<span style="line-height:1.8;">        loadBeanDefinitions(beanDefinitionReader);
    </span></pre> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">&nbsp;转到beanDefinitionReader中进行处理</span></li>
   </ul>
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span> loadBeanDefinitions(XmlBeanDefinitionReader reader) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException, IOException {
        Resource[] configResources </span>=<span style="line-height:1.8;"> getConfigResources();
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (configResources != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">调用XmlBeanDefinitionReader来载入bean定义信息。</span>
<span style="line-height:1.8;">            reader.loadBeanDefinitions(configResources);
        }
        String[] configLocations </span>=<span style="line-height:1.8;"> getConfigLocations();
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (configLocations != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
            reader.loadBeanDefinitions(configLocations);
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">&nbsp;转到beanDefinitionReader中进行处理</span></li>
   </ul>
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';"> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
       <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span> loadBeanDefinitions(XmlBeanDefinitionReader reader) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeansException, IOException {
        Resource[] configResources </span>=<span style="line-height:1.8;"> getConfigResources();
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (configResources != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">调用XmlBeanDefinitionReader来载入bean定义信息。</span>
<span style="line-height:1.8;">            reader.loadBeanDefinitions(configResources);
        }
        String[] configLocations </span>=<span style="line-height:1.8;"> getConfigLocations();
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (configLocations != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
            reader.loadBeanDefinitions(configLocations);
        }
    }</span></pre> 
       <div class="cnblogs_code_toolbar">
        <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">&nbsp;而在作为其抽象父类的AbstractBeanDefinitionReader中来定义载入过程</span></li>
   </ul>
   <div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;color:rgb(51,51,51);"> 
    <div class="bar"> 
     <div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left:3px solid rgb(108,226,108);"> 
      <div> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">int</span> loadBeanDefinitions(String location) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeanDefinitionStoreException {
     </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里得到当前定义的ResourceLoader,默认的我们使用DefaultResourceLoader</span>
     ResourceLoader resourceLoader =<span style="line-height:1.8;"> getResourceLoader();
     .........</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果没有找到我们需要的ResourceLoader，直接抛出异常</span>
        <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (resourceLoader <span style="line-height:1.8;color:rgb(0,0,255);">instanceof</span><span style="line-height:1.8;"> ResourcePatternResolver) {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 这里处理我们在定义位置时使用的各种pattern,需要ResourcePatternResolver来完成</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">try</span><span style="line-height:1.8;"> {
                Resource[] resources </span>=<span style="line-height:1.8;"> ((ResourcePatternResolver) resourceLoader).getResources(location);
                </span><span style="line-height:1.8;color:rgb(0,0,255);">int</span> loadCount =<span style="line-height:1.8;"> loadBeanDefinitions(resources);
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> loadCount;
            }
          ........
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;"> {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 这里通过ResourceLoader来完成位置定位</span>
            Resource resource =<span style="line-height:1.8;"> resourceLoader.getResource(location);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 这里已经把一个位置定义转化为Resource接口，可以供XmlBeanDefinitionReader来使用了</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">int</span> loadCount =<span style="line-height:1.8;"> loadBeanDefinitions(resource);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> loadCount;
        }
    }</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="color:rgb(160,160,160);background-image:none;font-size:9px;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:15px;">当我们通过ResourceLoader来载入资源，别忘了了我们的GenericApplicationContext也实现了ResourceLoader接口</span></li>
   </ul>
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span> GenericApplicationContext <span style="line-height:1.8;color:rgb(0,0,255);">extends</span> AbstractApplicationContext <span style="line-height:1.8;color:rgb(0,0,255);">implements</span><span style="line-height:1.8;"> BeanDefinitionRegistry {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span><span style="line-height:1.8;"> Resource getResource(String location) {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里调用当前的loader也就是DefaultResourceLoader来完成载入</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (<span style="line-height:1.8;color:rgb(0,0,255);">this</span>.resourceLoader != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.resourceLoader.getResource(location);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">super</span><span style="line-height:1.8;">.getResource(location);
        }
    .......
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;而我们的FileSystemXmlApplicationContext就是一个DefaultResourceLoader - GenericApplicationContext()通过DefaultResourceLoader</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span><span style="line-height:1.8;"> Resource getResource(String location) {
        </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果是类路径的方式，那需要使用ClassPathResource来得到bean文件的资源对象</span>
        <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (location.startsWith(CLASSPATH_URL_PREFIX)) {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()), getClassLoader());
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;"> {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">try</span><span style="line-height:1.8;"> {
                </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 如果是URL方式，使用UrlResource作为bean文件的资源对象</span>
                URL url = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> URL(location);
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> UrlResource(url);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">catch</span><span style="line-height:1.8;"> (MalformedURLException ex) {
                </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);"> 如果都不是，那我们只能委托给子类由子类来决定使用什么样的资源对象了</span>
                <span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> getResourceByPath(location);
            }
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;我们的FileSystemXmlApplicationContext本身就是是DefaultResourceLoader的实现类，实现了以下的接口</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> <span style="line-height:1.8;color:rgb(0,0,255);">protected</span><span style="line-height:1.8;"> Resource getResourceByPath(String path) {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (path != <span style="line-height:1.8;color:rgb(0,0,255);">null</span> &amp;&amp; path.startsWith("/"<span style="line-height:1.8;">)) {
            path </span>= path.substring(1<span style="line-height:1.8;">);
        }
        </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里使用文件系统资源对象来定义bean文件</span>
        <span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> FileSystemResource(path);
    }</span><span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;这样代码就回到了FileSystemXmlApplicationContext中来，他提供了FileSystemResource来完成从文件系统得到配置文件的资源定义。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;这样就可以从文件系统路径上对IOC配置文件进行加载 - 当然我们可以按照这个逻辑从任何地方加载，在Spring中我们看到它提供的各种资源抽象，比如ClassPathResource, URLResource,FileSystemResource等来供我们使用。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;上面我们看到的是定位Resource的一个过程，而这只是加载过程的一部分 。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:15px;">&nbsp; &nbsp; &nbsp;回到AbstractBeanDefinitionReaderz中的loadDefinitions(resource)来看看得到代表bean文件的资源定义以后的载入过程,默认的我们使用XmlBeanDefinitionReader&nbsp;</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">int</span> loadBeanDefinitions(EncodedResource encodedResource) <span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeanDefinitionStoreException {
        .......
        </span><span style="line-height:1.8;color:rgb(0,0,255);">try</span><span style="line-height:1.8;"> {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里通过Resource得到InputStream的IO流</span>
            InputStream inputStream =<span style="line-height:1.8;"> encodedResource.getResource().getInputStream();
            </span><span style="line-height:1.8;color:rgb(0,0,255);">try</span><span style="line-height:1.8;"> {
                </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">从InputStream中得到XML的解析源</span>
                InputSource inputSource = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> InputSource(inputStream);
                </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (encodedResource.getEncoding() != <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">) {
                    inputSource.setEncoding(encodedResource.getEncoding());
                }
                </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">这里是具体的解析和注册过程</span>
                <span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> doLoadBeanDefinitions(inputSource, encodedResource.getResource());
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">finally</span><span style="line-height:1.8;"> {
                </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">关闭从Resource中得到的IO流</span>
<span style="line-height:1.8;">                inputStream.close();
            }
        }
    }

    </span><span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">int</span><span style="line-height:1.8;"> doLoadBeanDefinitions(InputSource inputSource, Resource resource)
            </span><span style="line-height:1.8;color:rgb(0,0,255);">throws</span><span style="line-height:1.8;"> BeanDefinitionStoreException {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">try</span><span style="line-height:1.8;"> {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">int</span> validationMode =<span style="line-height:1.8;"> getValidationModeForResource(resource);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">通过解析得到DOM，然后完成bean在IOC容器中的注册</span>
            Document doc = <span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.documentLoader.loadDocument(
                    inputSource, </span><span style="line-height:1.8;color:rgb(0,0,255);">this</span>.entityResolver, <span style="line-height:1.8;color:rgb(0,0,255);">this</span>.errorHandler, validationMode, <span style="line-height:1.8;color:rgb(0,0,255);">this</span><span style="line-height:1.8;">.namespaceAware);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> registerBeanDefinitions(doc, resource);
        }
    }


    </span><span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;"> parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (delegate.isDefaultNamespace(root)) {
            NodeList nl </span>=<span style="line-height:1.8;"> root.getChildNodes();
            </span><span style="line-height:1.8;color:rgb(0,0,255);">for</span> (<span style="line-height:1.8;color:rgb(0,0,255);">int</span> i = 0; i &lt; nl.getLength(); i++<span style="line-height:1.8;">) {
                Node node </span>=<span style="line-height:1.8;"> nl.item(i);
                </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (node <span style="line-height:1.8;color:rgb(0,0,255);">instanceof</span><span style="line-height:1.8;"> Element) {
                    Element ele </span>=<span style="line-height:1.8;"> (Element) node;
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (delegate.isDefaultNamespace(ele)) {
                        parseDefaultElement(ele, delegate);
                    }
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;"> {
                        delegate.parseCustomElement(ele);
                    }
                }
            }
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;"> {
            delegate.parseCustomElement(root);
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;本文转自Orson博客园博客，原文链接：http://www.cnblogs.com/java-class/p/5422691.html，如需转载请自行联系原作者</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
