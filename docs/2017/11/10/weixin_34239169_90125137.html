<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>理解 OpenStack Swift （1）：OpenStack + 三节点Swift 集群+ HAProxy + UCARP 安装和配置 « NotBeCN</title>
  <meta name="description" content="             本系列文章着重学习和研究OpenStack Swift，包括环境搭建、原理、架构、监控和性能等。    （1）OpenStack + 三节点Swift 集群+ HAProxy + UCARP 安装和配置&nbsp;    （2）原理、架构和性能    （3）监控    &nbsp;   ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/10/weixin_34239169_90125137.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">理解 OpenStack Swift （1）：OpenStack + 三节点Swift 集群+ HAProxy + UCARP 安装和配置</h1>
    <p class="post-meta">Nov 10, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本系列文章着重学习和研究OpenStack Swift，包括环境搭建、原理、架构、监控和性能等。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）<a href="http://www.cnblogs.com/sammyliu/p/4923432.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">OpenStack + 三节点Swift 集群+ HAProxy + UCARP 安装和配置</a>&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）<a href="http://www.cnblogs.com/sammyliu/p/4955241.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">原理、架构和性能</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）<a href="http://www.cnblogs.com/sammyliu/p/4964528.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">监控</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">要实现的系统的效果图：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201511/697113-20151109162155915-633140462.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">特点：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">使用三个对等物理节点，每个节点上部署所有Swift 服务</li> 
    <li style="list-style-type:disc;">使用开源的 UCARP 控制一个 VIP，它会被绑定到三个物理网卡中的一个。</li> 
    <li style="list-style-type:disc;">使用开源的 HAProxy 做负载均衡</li> 
    <li style="list-style-type:disc;">开启 Swift TempURL</li> 
   </ul>
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1. Swift 集群安装和配置</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">1.1 Swift 安装</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; Swift 是被设计来在商用硬件上运行的。而且在存储磁盘上不需要而且不推荐使用RAID，相反，使用 RAID 5 或者 6 的和，会带来严重的性能下降。Swift 中包含多种服务，主要的有四种：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">Proxy Services</li> 
    <li style="list-style-type:disc;">Object Services</li> 
    <li style="list-style-type:disc;">Container Services</li> 
    <li style="list-style-type:disc;">Account Services</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 这些服务都可以独立运行。这些服务中，Proxy service 是更需要 CPU 和 网络带宽的，因此，可以使用 10GbE 或者更高的带宽。如果将 SSL 段设在proxy service 上的话，它也会消耗 CPU。其它三种服务是磁盘和网络带宽敏感的。由于每个服务的独立性，因此，有多种部署方式。比如将所有服务部署在一个节点上，这样所有服务都可以水平扩展。也可以将 proxy service 单独出来，它可以使用 10GbE 或者更高的网络，而 storage 节点可以使用更加经济的 1GbE 网络。如果你需要更高的 Account 或者 Container service 吞吐能力，他们都可以被部署在单独的服务器上，比如使用更快的 SAS 或者 SSD 磁盘来放置它们的数据库文件。另外，还需要考虑负载均衡问题。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本案例<span style="line-height:1.5;">使用 OpenStack Swift Kilo 版本，按照社区官方文档安装和配置 Swift，没什么花头。</span>基本流程：</p> 
   <ol style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">系统盘准备（操作系统磁盘往往使用 RAID 1提高可靠性）</li> 
    <li style="list-style-type:decimal;">操作系统安装</li> 
    <li style="list-style-type:decimal;">Swift 软件安安装</li> 
    <li style="list-style-type:decimal;">数据盘准备（不需要 RAID）</li> 
    <li style="list-style-type:decimal;">Swift 配置</li> 
   </ol>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201511/697113-20151109182144165-561795222.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本案例使用的环境的特点：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">物理节点运行 Ubuntu 操作系统</li> 
    <li style="list-style-type:disc;">三个物理节点，每个节点上部署所有Swift 服务，因此三节点是对等的。</li> 
    <li style="list-style-type:disc;">只使用一个网络。其实是可以将Swift 集群的数据复制（replication）需要的网络单独出来。</li> 
    <li style="list-style-type:disc;">每个节点添加两块磁盘，使用 XFS 文件系统，作为 Swift 的数据盘。</li> 
    <li style="list-style-type:disc;">Swift 使用 Keystone 来进行用户验证。</li> 
   </ul>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">1.2 Swift 配置</h3> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1.2.1 Ring 配置</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Swift 配置中，需要注意的是 Ring 的配置，它包含几个关键值：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><span style="line-height:1.5;font-family:Arial;">Partition 数目：推荐集群磁盘数目（将来的或者说规划的）乘以100，然后取模2。同时，这个数字也不能过大，因为过大的话，Swift replicator 和其它后端进程就会消耗更多的内存。因此，需要在 small ring 和 最大的集群规模之间做平衡。</span></li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;font-family:Arial;">Replica 数目：推荐 3.越大，消耗的存储空间会越大，当然，丢失数据的可能性就越小。</span></li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;font-family:Arial;">Zone 数目：社区推荐至少5个zone。</span></li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-family:Arial;">然后使用<em>&nbsp;swift-ring-builder &lt;builder_file&gt; create &lt;part_power&gt; &lt;replicas&gt; &lt;min_part_hours&gt;</em>&nbsp;命令分布创建 Account，Container 和 Object ring。比如本案例使用的命令是&nbsp;swift-ring-builder object.builder create 10 3 1。它表示：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><span style="line-height:1.5;font-family:Arial;">集群规划的最大规模为 10 块磁盘</span></li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;font-family:Arial;">数目保存 3 份</span></li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-family:Arial;">然后使用&nbsp;</span><em>swift-ring-builder &lt;builder_file&gt; add z&lt;zone&gt;-&lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt; &lt;weight&gt;</em>&nbsp;命令将每个节点上的数据服务（比如 Object-server 服务）加入到 ring 中：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">swift-ring-builder object.builder add r1z1-9.115.251.235:6000/sdb1 100
swift-ring-builder object.builder add r1z1-9.115.251.235:6000/sdc1 100
swift-ring-builder object.builder add r1z2-9.115.251.234:6000/sdb1 100
swift-ring-builder object.builder add r1z2-9.115.251.234:6000/sdc1 100
swift-ring-builder object.builder add r1z3-9.115.251.233:6000/sdb1 100
swift-ring-builder object.builder add r1z3-9.115.251.233:6000/sdc1 100</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这里配置了 3 个 zone，就是每个节点单独一个 zone。另一个比较ticky 的参数是 weight，它表示一个磁盘上分区的数目，因此它和磁盘的大小有直接关系，社区推荐使用 100 * TB 作为该值。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">接下来就需要运行&nbsp;<span class="n" style="line-height:1.5;"><em>swift</em><span class="o" style="line-height:1.5;"><em>-</em><span class="n" style="line-height:1.5;"><em>ring</em><span class="o" style="line-height:1.5;"><em>-</em><span class="n" style="line-height:1.5;"><em>builder&nbsp;</em><span class="o" style="line-height:1.5;"><em>&lt;</em><span class="n" style="line-height:1.5;"><em>builder_file</em><span class="o" style="line-height:1.5;"><em>&gt;&nbsp;</em><span class="n" style="line-height:1.5;"><em>rebalance</em>&nbsp;命令了。它会使得Ring配置在所有磁盘的分区上生效，并会生产&nbsp;object.ring.gz 文件。该文件和 container.ring.gz &nbsp;以及 account.ring.gz 文件一道，需要发到集群所有的存储节点上。</span></span></span></span></span></span></span></span></span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">最终 object ring 的配置如下：</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@swift1:/etc/swift# swift-ring-builder <span style="color:rgb(0,0,255);line-height:1.5;">object</span><span style="line-height:1.5;">.builder
</span><span style="color:rgb(0,0,255);line-height:1.5;">object</span>.builder, build version <span style="color:rgb(128,0,128);line-height:1.5;">6</span>
<span style="color:rgb(128,0,128);line-height:1.5;">1024</span> partitions, <span style="color:rgb(128,0,128);line-height:1.5;">3.000000</span> replicas, <span style="color:rgb(128,0,128);line-height:1.5;">1</span> regions, <span style="color:rgb(128,0,128);line-height:1.5;">3</span> zones, <span style="color:rgb(128,0,128);line-height:1.5;">6</span> devices, <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span> balance, <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span><span style="line-height:1.5;"> dispersion
The minimum number of hours before a partition can be reassigned </span><span style="color:rgb(0,0,255);line-height:1.5;">is</span> <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">
The overload factor </span><span style="color:rgb(0,0,255);line-height:1.5;">is</span> <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>% (<span style="color:rgb(128,0,128);line-height:1.5;">0.000000</span><span style="line-height:1.5;">)
Devices:    id  region  zone      ip address  port  replication ip  replication port      name weight partitions balance meta
             </span><span style="color:rgb(128,0,128);line-height:1.5;">0</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">1</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdb1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>
             <span style="color:rgb(128,0,128);line-height:1.5;">1</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">1</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdc1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>
             <span style="color:rgb(128,0,128);line-height:1.5;">2</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">2</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.234</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.234</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdb1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>
             <span style="color:rgb(128,0,128);line-height:1.5;">3</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">2</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.234</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.234</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdc1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>
             <span style="color:rgb(128,0,128);line-height:1.5;">4</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">3</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdb1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span>
             <span style="color:rgb(128,0,128);line-height:1.5;">5</span>       <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     <span style="color:rgb(128,0,128);line-height:1.5;">3</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span>  <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span>              <span style="color:rgb(128,0,128);line-height:1.5;">6000</span>      sdc1 <span style="color:rgb(128,0,128);line-height:1.5;">100.00</span>        <span style="color:rgb(128,0,128);line-height:1.5;">512</span>    <span style="color:rgb(128,0,128);line-height:1.5;">0.00</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">当 Ring 的配置需要改动的话，上面步骤需要重做。</span></p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;">1.2.2 磁盘性能</span></span></span></span></span></span></span></span></span></h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">为了提高 Account service 和 Container service 的性能，可以将它们的挂载点放在SAS 或者 SSD 磁盘上，然后修改它们的配置文件中的 devices 选项：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201511/697113-20151109175138619-798488465.jpg" alt="" style="border:0px;"></p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1.2.3 Memcached</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; Swift 本身不对数据做任何缓存，它的 Proxy service 服务会利用 Memcached 来做数据缓存，比如用它来缓存 tokens、account 和 container 数据等。因此，memcached 往往会安装在 proxy service 所在的服务器上。</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1.2.4 其它</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1） 文件系统</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">理论上Swift 支持所有支持扩展属性的文件系统，但是社区推荐使用 XFS。使用其他的文件系统之前，建议进行严格的测试。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）worker 数目</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">每个服务的 workers 数目可以进行配置。设置的值需要考虑可用的内核数目。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;（3）日志</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Swift 的日志会被输出到系统日志。官方建议使用 syslog-ng 来进行日志的分离，更多的资料可以参考&nbsp;<a href="http://latteye.com/2008/03/build-a-secure-logging-server-with-syslog-ng.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">使用 syslog-ng 搭建安全的日志集中服务器</a>&nbsp;和&nbsp;<a href="https://github.com/btorch/swift-saio.sh/blob/master/etc/syslog-ng/syslog-ng.conf.tmpl" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">syslog-ng.conf 实例</a>。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">1.3 Swift 使用</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">要访问 Swift，必须安装 Swift 客户端。在 Ubuntu 环境中，运行 “<span class="pre" style="line-height:1.5;">sudo&nbsp;<span class="pre" style="line-height:1.5;">pip&nbsp;<span class="pre" style="line-height:1.5;">install&nbsp;<span class="pre" style="line-height:1.5;">python-swiftclient” 即可，然后再</span></span></span></span>使用&nbsp;admin-openrc.sh 中的如下配置：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>export OS_PROJECT_DOMAIN_ID=<span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
export OS_USER_DOMAIN_ID</span>=<span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
export OS_PROJECT_NAME</span>=<span style="line-height:1.5;">admin
export OS_TENANT_NAME</span>=<span style="line-height:1.5;">admin
export OS_USERNAME</span>=<span style="line-height:1.5;">admin
export OS_PASSWORD</span>=***<span style="line-height:1.5;">
export OS_AUTH_URL</span>=http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">controller:35357/v3</span>
export OS_IMAGE_API_VERSION=<span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">
export OS_VOLUME_API_VERSION</span>=<span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">
export OS_AUTH_VERSION</span>=<span style="color:rgb(128,0,128);line-height:1.5;">3</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">进行常见的 swift 操作：</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@controller:~/<span style="line-height:1.5;">s1# swift upload conatiner10 a
a
root@controller:</span>~/<span style="line-height:1.5;">s1# swift list conatiner10
a
root@controller:</span>~/<span style="line-height:1.5;">s1# swift download conatiner10 a
a [auth </span><span style="color:rgb(128,0,128);line-height:1.5;">0</span>.408s, headers <span style="color:rgb(128,0,128);line-height:1.5;">0</span>.458s, total <span style="color:rgb(128,0,128);line-height:1.5;">3</span>.564s, <span style="color:rgb(128,0,128);line-height:1.5;">34.404</span> MB/<span style="line-height:1.5;">s]
root@controller:</span>~/<span style="line-height:1.5;">s1# swift delete conatiner10 a
a
root@controller:</span>~/<span style="line-height:1.5;">s1# swift list conatiner10
root@controller:</span>~/s1#</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">如果不使用配置文件，也可以在命令行中直接指定参数，比如&nbsp;<span class="pre" style="line-height:1.5;">swift&nbsp;<span class="pre" style="line-height:1.5;">[-A&nbsp;<span class="pre" style="line-height:1.5;">*Auth&nbsp;<span class="pre" style="line-height:1.5;">URL*]&nbsp;<span class="pre" style="line-height:1.5;">[-U&nbsp;<span class="pre" style="line-height:1.5;">*username*]&nbsp;<span class="pre" style="line-height:1.5;">[-K&nbsp;<span class="pre" style="line-height:1.5;">*password*]&nbsp;<span class="pre" style="line-height:1.5;">stat。</span></span></span></span></span></span></span></span></span></p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">2. HAProxy 安装和配置</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在每个节点上安装 HAProxy，然后修改配置文件：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@swift1:~/s1# vi /etc/haproxy/<span style="line-height:1.5;">haproxy.cfg
</span><span style="line-height:1.5;">global</span><span style="line-height:1.5;">
        log </span>/dev/<span style="line-height:1.5;">log    local0
        log </span>/dev/<span style="line-height:1.5;">log    local1 notice
        chroot </span>/<span style="line-height:1.5;">var</span>/lib/<span style="line-height:1.5;">haproxy
        user haproxy
        group haproxy
        daemon

defaults
        log     </span><span style="line-height:1.5;">global</span><span style="line-height:1.5;">
        mode    http
        option  httplog
        option  dontlognull
        contimeout </span><span style="color:rgb(128,0,128);line-height:1.5;">5000</span><span style="line-height:1.5;">
        clitimeout </span><span style="color:rgb(128,0,128);line-height:1.5;">50000</span><span style="line-height:1.5;">
        srvtimeout </span><span style="color:rgb(128,0,128);line-height:1.5;">50000</span><span style="line-height:1.5;">

frontend localnodes
        bind </span>*:<span style="color:rgb(128,0,128);line-height:1.5;">1002 <span style="color:rgb(0,0,255);line-height:1.5;">#HAProxy 在 1002 端口上监听</span></span><span style="line-height:1.5;">
        mode http
        default_backend swift</span>-<span style="line-height:1.5;">cluster
        maxconn </span><span style="color:rgb(128,0,128);line-height:1.5;">100</span><span style="line-height:1.5;">
        option forwardfor

backend swift</span>-<span style="line-height:1.5;">cluster
        mode http
        balance  roundrobin <span style="color:rgb(0,0,255);line-height:1.5;">#使用轮询策略</span>
        option httpchk HEAD </span>/healthcheck HTTP/<span style="color:rgb(128,0,128);line-height:1.5;">1.0</span><span style="line-height:1.5;">
        option forwardfor <span style="color:rgb(0,0,255);line-height:1.5;">#</span></span><span style="color:rgb(0,0,255);line-height:1.5;"> 当 mode 为 ”http“时，设置 forwardfor，使得通过 X-Forward-For 头来保存原始的源 IP 地址</span><br><span style="line-height:1.5;">        server  proxy1 </span><span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span>:<span style="color:rgb(128,0,128);line-height:1.5;">8080</span> weight <span style="color:rgb(128,0,128);line-height:1.5;">5</span><span style="line-height:1.5;"> check inter 5s <span style="color:rgb(0,0,255);line-height:1.5;">#节点1<br></span></span><span style="line-height:1.5;">        server  proxy2 </span><span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span>:<span style="color:rgb(128,0,128);line-height:1.5;">8080</span> weight <span style="color:rgb(128,0,128);line-height:1.5;">5</span><span style="line-height:1.5;"> check inter 5s <span style="color:rgb(0,0,255);line-height:1.5;">#节点2<br></span></span><span style="line-height:1.5;">        server  proxy3 </span><span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.234</span>:<span style="color:rgb(128,0,128);line-height:1.5;">8080</span> weight <span style="color:rgb(128,0,128);line-height:1.5;">5</span> check inter 5s <span style="color:rgb(0,0,255);line-height:1.5;">#节点3</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后运行命令<em>/usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg</em>&nbsp;来启动 HAProxy 进程。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3. UCARP 配置和安装</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.1 CARP 协议</h3> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3.1.1 CARP 协议</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">CARP 是由 FreeBSD 提出并率先实现的一种协议。UCARP 是 CARP 在 Linux 上的一个实现。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">CARP （Common Address Redundancy Protocol，公共地址冗余协议）是一个用来实现系统冗余性的协议，通过将一组在同一个网段内的（on the same network）主机放到一个冗余组来共享一个IP地址。这么配置以后，在一个机器宕机的情况下，冗余组内的另外一个主机会接替它承担的任务。它同时也运行系统之间一定程度的负载共享。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">一开始，OpenBSD 团队打算做 IETF 标准协议 VRRP （Virtual Router Redundancy Protocol，定义在&nbsp;<a href="http://www.faqs.org/rfcs/rfc3768.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">RFC3768</a>）的一个免费实现；但是，Cisco 声称他们拥有专利，“坚定地通过 OpenBSD 社区，Ciso 肯定会保护他们的VRRP实现的专利”（参考&nbsp;<a href="http://www.openbsd.org/lyrics.html#35" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">CARP</a>&nbsp;获得更多的信息），因此，这也使得 OpenBSD 团队去创造一个新的，与VRRP基础性不同的，竞争性的协议。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">CRAP 是一个多播协议，将多个物理主机组成一个使用一个或者多个虚拟地址的组。该组内，一个系统是主（master），它响应目的为该组的网络包；其它主机是备（backup），它们会 standby，等待主出现问题而接替它。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在一个可配置的时间间隔上，主在 IP 协议号码 112 上不断向网段发出广播，使得各备实例都知道它还活着。如果备实例在一段时间内收不到主的广播，它们中的一个将成为新主&nbsp;(其中那个配置了最小advbase&nbsp;和&nbsp;advskew值的那个实例）。<span style="line-height:1.5;">当老主重新恢复后，默认地它成为一个备，尽管可以通过配置让它尝试着重新成为新的主。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">每个 CARP 冗余组以一个虚拟网卡表示，使用 ifconfig 来创建和配置。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="line-height:1.5;">ifconfig carpN create
ifconfig carpN vhid vhid [pass password] [carpdev carpdev] [advbase advbase] [advskew advskew] [state state] [group</span>|-<span style="line-height:1.5;">group group] \
   ipaddress netmask mask</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">其中比较关键的几个参数：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">carpN：虚拟网卡的名字，其中 N 是一个整数，表示虚拟网卡的号码</li> 
    <li style="list-style-type:disc;">vhid：冗余组ID</li> 
    <li style="list-style-type:disc;">password：一个CARP 实例和组内其它实例通信使用的密码</li> 
    <li style="list-style-type:disc;">carpdev：绑定的网卡</li> 
    <li style="list-style-type:disc;">advbase：广播的频率，单位为秒，默认为1s。值越小，越大概率成为主。</li> 
    <li style="list-style-type:disc;">advskew：how much to skew the&nbsp;<em>advbase</em>&nbsp;when sending CARP advertisements。影响主选举的另一个因子。值越大，越小概率成为主。</li> 
    <li style="list-style-type:disc;">ipaddress/mask：虚拟IP和子网掩码</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">要触发主备zh failover，通常有几个办法：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">在主节点上 ifup carp 网卡：ifconfig carp1 down。这会使得主的广播信息中&nbsp;advbase&nbsp;和&nbsp;advskew 为无限大，备收到后会立刻选举出新主。</li> 
    <li style="list-style-type:disc;">增加主节点上 carp 的&nbsp;advskew&nbsp; 值，使得它比备大。这个办法会使得主保留在 carp 冗余组内。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">同时，你也可以看到，CARP 只是创建和管理虚拟网络设备；系统管理员需要去在应用之间同步数据。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（以上文字翻译自&nbsp;<a href="http://www.kernel-panic.it/openbsd/carp/carp4.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://www.kernel-panic.it/openbsd/carp/carp4.html</a>。更多信息，可参考&nbsp;<a href="http://www.openbsd.org/faq/pf/carp.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://www.openbsd.org/faq/pf/carp.html</a>）</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3.1.2 CARP， VRRP 和 HSRP 之间的比较</h4> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"> <a href="http://en.wikipedia.org/wiki/VRRP" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;line-height:1.5;">VRRP</a>：<span style="line-height:1.5;">Virtual Router Redundacy Protocol</span> </li> 
    <li style="list-style-type:disc;"> <a href="http://en.wikipedia.org/wiki/HSRP" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;line-height:1.5;">HSRP</a>：<span style="line-height:1.5;">Hot Standby Router Protocol</span> </li> 
    <li style="list-style-type:disc;"> <a href="http://en.wikipedia.org/wiki/Common_Address_Redundancy_Protocol" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;line-height:1.5;">CARP</a>：<span style="line-height:1.5;">Common Address Redundancy Protocol</span> </li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">这三个协议都能向防火墙和路由器提供 failover redundancy，通过在多个实例之间共享虚拟MAC地址和IP地址。通过这个方法，如果你的主防火墙或者路由器失效，其它备可以几乎透明地接替它。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">简单比较如下：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><span style="line-height:1.5;">HSRP 是 Cisco 的一个专利私有协议。具体内容可以查看&nbsp;<a href="http://www.faqs.org/rfcs/rfc2281.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">RFC 2281 - Cisco Hot Standby Router Protocol (HSRP)</a>。</span></li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;">VRRP 是一个 IETF 标准协议，它解决了 HSRP 的一些问题。但是，Cisco 声称它拥有它的实现专利。<a href="http://www.faqs.org/rfcs/rfc3768.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Virtual Router Redundancy Protocol (VRRP)</a></span></li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;">CARP 是由 OpenBSD 开发的与 HSRP 和 VRRP 类似的一个协议。</span></li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">（本段内容来自&nbsp;</span><a href="https://ppires.wordpress.com/2007/02/07/hight-network-availability-vrrp-hsrp-carp/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;line-height:1.5;">https://ppires.wordpress.com/2007/02/07/hight-network-availability-vrrp-hsrp-carp/</a><span style="line-height:1.5;">）</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.2 UCARP</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; UCARP 允许多个主机共享一个虚拟的ip地址，以提供自动的故障恢复功能，当其中某个主机宕机时，其它的主机会自动接管服务。UCARP是CARP协议（通用地址冗余协议，最早在OpenBSD上实现）的linux实现版本，同时也能移植到其它多个unix平台，UCARP的官方网站：<a href="http://www.ucarp.org/project/ucarp" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://www.ucarp.org/project/ucarp</a>&nbsp;。CARP协议的特点在于其非常低的开销，主机间使用加密数据传递信息，并且在冗余主机之间不需要任何额外的网络链接。</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3.2.1 ucarp 工具</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>ucarp <span style="color:rgb(128,0,128);line-height:1.5;">1.5</span>.<span style="color:rgb(128,0,128);line-height:1.5;">2</span> - Mar <span style="color:rgb(128,0,128);line-height:1.5;">25</span> <span style="color:rgb(128,0,128);line-height:1.5;">2014</span>

<span style="line-height:1.5;">--interface=&lt;if&gt; (-i &lt;if&gt;): bind interface &lt;if&gt;
--srcip=&lt;ip&gt; (-s &lt;ip&gt;): source (real) IP address of that host
--vhid=&lt;id&gt; (-v &lt;id&gt;): virtual IP identifier (1-255)
--pass=&lt;pass&gt; (-p &lt;pass&gt;): password
--passfile=&lt;file&gt; (-o &lt;file&gt;): read password from file
--preempt (-P): becomes a master as soon as possible
--neutral (-n): don't run downscript at start if backup
--addr=&lt;ip&gt; (-a &lt;ip&gt;): virtual shared IP address
--help (-h): summary of command-line options
--advbase=&lt;seconds&gt; (-b &lt;seconds&gt;): advertisement frequency
--advskew=&lt;skew&gt; (-k &lt;skew&gt;): advertisement skew (0-255)
--upscript=&lt;file&gt; (-u &lt;file&gt;): run &lt;file&gt; to become a master
--downscript=&lt;file&gt; (-d &lt;file&gt;): run &lt;file&gt; to become a backup
--deadratio=&lt;ratio&gt; (-r &lt;ratio&gt;): ratio to consider a host as dead
--shutdown (-z): call shutdown script at exit
--daemonize (-B): run in background
--ignoreifstate (-S): ignore interface state (down, no carrier)
--nomcast (-M): use broadcast (instead of multicast) advertisements
--facility=&lt;facility&gt; (-f): set syslog facility (default=daemon)
--xparam=&lt;value&gt; (-x): extra parameter to send to up/down scripts</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">3.2.2 通常的做法</span></h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">在冗余组内的所有节点上，编辑&nbsp;<em>/etc/network/interfaces</em>，添加：</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">ucarp-vid 1
ucarp-passwd tequila123
ucarp-vip 192.168.3.31
ucarp-advbase 1
ucarp-advskew 50
ucarp-master no
iface eth0:ucarp inet static
address 192.168.3.31
netmask 255.255.255.0</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后，</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">在&nbsp;upscript 文件中，ifup eth0:ucarp</li> 
    <li style="list-style-type:disc;">在 downscript&nbsp;文件中，ifdown eth0:ucarp</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">触发主备 failover 的两个方法:</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">ifdown eth0</li> 
    <li style="list-style-type:disc;">kill -usr2 &lt;pid of ucarp&gt;</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">更多信息，可以参考：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><a href="https://ucarp.wordpress.com/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://ucarp.wordpress.com/</a></li>
   </ul>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.3 UCARP 配置</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在三个节点上安装 UCARP，然后分配创建三个 shell 文件（注意每个节点上需要使用不同的IP地址）：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">root@swift1:/etc/</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">ucarp# cat master.sh <span style="color:rgb(255,0,0);line-height:1.5;">#用于启动 ucarp 进程，指定 VIP 为 9.115.251.238</span></span>
#</span>!/bin/<span style="line-height:1.5;">bash

</span>/usr/sbin/ucarp -i eth0 -v <span style="color:rgb(128,0,128);line-height:1.5;">40</span> -p gw22 -a <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.238</span> -u /etc/ucarp/master-up.sh -d /etc/ucarp/master-down.sh -s <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.235</span> -P -<span style="line-height:1.5;">B

<span style="color:rgb(0,0,255);line-height:1.5;">root@swift1:</span></span><span style="color:rgb(0,0,255);line-height:1.5;">/etc/ucarp# cat master-</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">up.sh <span style="color:rgb(255,0,0);line-height:1.5;">#当UCARP使得本节点做为 VIP 的承载节点时运行的脚本</span></span>
#</span>!/bin/<span style="line-height:1.5;">bash

GATEWAY</span>=<span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.1</span>
/sbin/ip addr add <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.238</span>/<span style="color:rgb(128,0,128);line-height:1.5;">24</span><span style="line-height:1.5;"> dev eth0
</span>/bin/<span style="line-height:1.5;">hostname swiftproxy
</span>/sbin/route add <span style="line-height:1.5;">default</span><span style="line-height:1.5;"> gw $GATEWAY
service httpd start

<span style="color:rgb(0,0,255);line-height:1.5;">root@swift1:</span></span><span style="color:rgb(0,0,255);line-height:1.5;">/etc/ucarp# cat master-</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">down.sh <span style="color:rgb(255,0,0);line-height:1.5;">#当 UCARP 使得本节点不再作为 VIP 的承载节点时运行的脚本</span></span>
#</span>!/bin/<span style="line-height:1.5;">bash

GATEWAY</span>=<span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.1</span>
/sbin/ip addr del <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.238</span>/<span style="color:rgb(128,0,128);line-height:1.5;">24</span><span style="line-height:1.5;"> dev eth0
</span>/bin/<span style="line-height:1.5;">hostname swift1
</span>/sbin/route add <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;"> gw $GATEWAY
service httpd stop</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 简单来说，UCAPR 类似于一个简化版的 VRRP。它在三个服务器之间选择一个作为主节点，由它提供服务，另外两个节点做为备节点，在主节点无法提供服务时升级为主节点。脚本也相对简单，就是将 VIP 加到物理网卡上，在修改 hostname 和 gateway。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">最后运行 master.sh 来启动 ucarp 进程。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4. Glance 使用 Swift 的配置</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）创建 openstack endpoint，使用 UCARP 管理的 VIP 和 HAProxy 管理的 port：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@controller:~/<span style="line-height:1.5;">s1# openstack endpoint show 1f107e61c4024f0a9655fa7276a09c61
</span>+--------------+-------------------------------------------------+
| Field        | Value                                           |
+--------------+-------------------------------------------------+
| adminurl     | http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">9.115.251.238:1002                       |</span>
| enabled      | True                                            |
| id           | 1f107e61c4024f0a9655fa7276a09c61                |
| internalurl  | http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">9.115.251.238:1002/v1/AUTH_%(tenant_id)s |</span>
| publicurl    | http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">9.115.251.238:1002/v1/AUTH_%(tenant_id)s |</span>
| region       | RegionOne                                       |
| service_id   | 3281409aec0c4628a3360bf9403e45e8                |
| service_name | swift                                           |
| service_type | <span style="line-height:1.5;">object</span>-store                                    |
+--------------+-------------------------------------------------+</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）配置 Glance API</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">使用 Glance API V2，不使用 glance-registry V2。使用 keystone V3 API。修改<em>&nbsp;/etc/glance/glance-api.conf</em>&nbsp;文件，</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">[glance_store]
stores </span>=<span style="line-height:1.5;"> glance.store.filesystem.Store, glance.store.swift.Store
default_store </span>=<span style="line-height:1.5;"> swift

swift_store_auth_version </span>= <span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">
swift_store_auth_address </span>= http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">controller:35357/v3/</span>
swift_store_user =<span style="line-height:1.5;"> service:glance
swift_store_key </span>= <span style="color:rgb(128,0,128);line-height:1.5;">1111</span><span style="line-height:1.5;">
swift_store_container </span>= glance</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这里的一个疑惑是 glance 是 service account 而不是 end user account，按照一些文章，需要配置 proxy node 上的&nbsp;reseller_prefix，但是在这个环境中没配置功能也能工作。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）接下来就可以使用 glance CLI 来将镜像保存到 Swift 中了。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">当使用 glance image-download CLI 下载 image 时，从 glance-api 的日志中可以看出，glance 是使用 python-swiftclient 来从 Swift 中获取 image 的：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(128,0,128);line-height:1.5;">2015</span>-<span style="color:rgb(128,0,128);line-height:1.5;">11</span>-<span style="color:rgb(128,0,128);line-height:1.5;">09</span> <span style="color:rgb(128,0,128);line-height:1.5;">10</span>:<span style="color:rgb(128,0,128);line-height:1.5;">39</span>:<span style="color:rgb(128,0,128);line-height:1.5;">21.723</span> <span style="color:rgb(128,0,128);line-height:1.5;">28246</span> DEBUG swiftclient [req-df449af5-7ac5-<span style="color:rgb(128,0,128);line-height:1.5;">4413</span>-a65c-89e3d37d82f4 0677bcabfe36412199289a21f773c03c dea8b51d28bf41599e63464828102759 - - -] REQ: curl -i http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">9.115.251.238:1002/v1/AUTH_25c6bd7a4b174d54bc483dae2e293a14/glance/6b3acfc1-0012-4c92-85ba-5946a96bab65 -X GET -H "X-Auth-Token: d6e8681da8384715b3e446117e91424c" http_log /usr/lib/python2.7/dist-packages/swiftclient/client.py:95</span>
<span style="color:rgb(128,0,128);line-height:1.5;">2015</span>-<span style="color:rgb(128,0,128);line-height:1.5;">11</span>-<span style="color:rgb(128,0,128);line-height:1.5;">09</span> <span style="color:rgb(128,0,128);line-height:1.5;">10</span>:<span style="color:rgb(128,0,128);line-height:1.5;">39</span>:<span style="color:rgb(128,0,128);line-height:1.5;">21.724</span> <span style="color:rgb(128,0,128);line-height:1.5;">28246</span> DEBUG swiftclient [req-df449af5-7ac5-<span style="color:rgb(128,0,128);line-height:1.5;">4413</span>-a65c-89e3d37d82f4 0677bcabfe36412199289a21f773c03c dea8b51d28bf41599e63464828102759 - - -] RESP STATUS: <span style="color:rgb(128,0,128);line-height:1.5;">200</span></pre>
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">5. Swift TempUrl</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;这本来是Swift一个比较简单的功能，但是用由于存在于不同文档中的问题（不一致、不全面、没更新），导致花了不少时间才弄出来。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）配置</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp;修改&nbsp;/etc/swift/proxy-server.conf 文件，在 main pipeline 中加入 tempurl 这个 middleware。需要注意的是，它必须加到 auth middleware 前面，这是因为这些middleware 是按照顺序被调用的。然后打开允许使用的 HTTP 操作。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">[pipeline:main]
pipeline </span>= catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit <span style="color:rgb(0,0,255);line-height:1.5;">tempurl</span> authtoken keystoneauth container-quotas account-quotas slo dlo proxy-logging proxy-server</pre> 
    <p style="line-height:1.5;">&nbsp;[filter:tempurl]<br> &nbsp;use = egg:swift#tempurl<br> &nbsp;# The methods allowed with Temp URLs.<br> &nbsp;methods = GET HEAD PUT POST DELETE</p> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">另外，需要确保&nbsp;[filter:authtoken] 部分设置了&nbsp;delay_auth_decision = true。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）添加 Temp-URL-Key meta，设置它为一个 secret key</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@controller:~/s1# swift post -m <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Temp-URL-Key:1111</span><span style="color:rgb(128,0,0);line-height:1.5;">" <span style="color:rgb(0,0,255);line-height:1.5;">#设置</span></span><span style="line-height:1.5;">
root@controller:</span>~/<span style="line-height:1.5;">s1# swift stat <span style="color:rgb(0,0,255);line-height:1.5;">#查看</span>
                        <span style="color:rgb(255,0,0);line-height:1.5;">Account: AUTH_dea8b51d28bf41599e63464828102759 <span style="color:rgb(0,0,255);line-height:1.5;">（下面第三步会用到）</span></span>
                     Containers: </span><span style="color:rgb(128,0,128);line-height:1.5;">5</span><span style="line-height:1.5;">
                        Objects: </span><span style="color:rgb(128,0,128);line-height:1.5;">11</span><span style="line-height:1.5;">
                          Bytes: </span><span style="color:rgb(128,0,128);line-height:1.5;">416894908</span><span style="line-height:1.5;">
Containers </span><span style="color:rgb(0,0,255);line-height:1.5;">in</span> policy <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">policy-0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,128);line-height:1.5;">5</span><span style="line-height:1.5;">
   Objects </span><span style="color:rgb(0,0,255);line-height:1.5;">in</span> policy <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">policy-0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,128);line-height:1.5;">11</span><span style="line-height:1.5;">
     Bytes </span><span style="color:rgb(0,0,255);line-height:1.5;">in</span> policy <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">policy-0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,128);line-height:1.5;">416894908</span><span style="color:rgb(255,0,0);line-height:1.5;">
              Meta Temp-Url-Key: 1111</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）产生 Temp URL。这里需要注意的是，AUTH 后面不是 account name 比如 “admin”，而是 project id。这个也可以使用 swift stat 命令查看其 Account 的值。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@controller:~/s1# swift tempurl GET <span style="color:rgb(128,0,128);line-height:1.5;">3600</span> /v1/<span style="color:rgb(255,0,0);line-height:1.5;">AUTH_dea8b51d28bf41599e63464828102759</span>/container1/<span style="color:rgb(128,0,128);line-height:1.5;">1</span> <span style="color:rgb(128,0,128);line-height:1.5;">1111</span>
/v1/AUTH_dea8b51d28bf41599e63464828102759/container1/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>?temp_url_sig=fc9f80211aa5c6262f62ca4d57db65b25f1cef7a&amp;temp_url_expires=<span style="color:rgb(128,0,128);line-height:1.5;">1447087996</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）使用 tempurl。需要确保URL的完整性，否则会得到 401 错误。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@controller:~/s1# curl <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">http://9.115.251.238:1002/v1/AUTH_dea8b51d28bf41599e63464828102759/container1/1?temp_url_sig=fc9f80211aa5c6262f62ca4d57db65b25f1cef7a&amp;temp_url_expires=1447087996</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>
<span style="color:rgb(128,0,128);line-height:1.5;">222222222222</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">另外需要注意的是，各个节点需要（最好）使用 UTC 时区，必须使用 NTP 服务确保时间一致。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）得到 401 错误时的调试</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Swift 默认情况下日志会写到 /var/log/syslog&nbsp;文件中。有如下一下调试技巧：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（a）. 设置 proxy-server 的 log leve 为 DEBUG</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">[app:proxy-server]
# You can override the default log routing for this app here:
set log_name = proxy-server
set log_level = DEBUG</span></pre> 
    <p style="line-height:1.5;"><span style="line-height:1.5;font-size:12px;">[filter:tempurl]</span><br><span style="line-height:1.5;font-size:12px;">set log_name = tempurl</span></p> 
    <p style="line-height:1.5;"><span style="line-height:1.5;font-size:12px;">set log_level = DEBUG</span></p> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（b）. 将 worker 数目设为 0 可以方便调试，默认的话为 2.</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>workers = <span style="color:rgb(128,0,128);line-height:1.5;">0</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（c）可以在&nbsp;/usr/lib/python2.7/dist-packages/swift/common/middleware/tempurl.py 中加入 logger 输出。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后你就可以看到 proxy server 和 tempurl 的详细日志了：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">Nov  9 15:55:48</span> swift3 <span style="color:rgb(255,0,0);line-height:1.5;">proxy-server</span>: <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.219</span> <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.233</span> <span style="color:rgb(0,0,255);line-height:1.5;">09/Nov/2015/15/55/48</span> GET /v1/AUTH_dea8b51d28bf41599e63464828102759/container1/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>%3Ftemp_url_expires%3D1447087996%26temp_url_sig%3Dfc9f80211aa5c6262f62ca4d57db65b25f1cef7a HTTP/<span style="color:rgb(128,0,128);line-height:1.5;">1.0</span> <span style="color:rgb(128,0,128);line-height:1.5;">200</span> - curl/<span style="color:rgb(128,0,128);line-height:1.5;">7.35</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0</span> - - <span style="color:rgb(128,0,128);line-height:1.5;">12</span> - tx9ce884232d5a48bb9b5d8-005640c204 - <span style="color:rgb(128,0,128);line-height:1.5;">0.0261</span> - - <span style="color:rgb(128,0,128);line-height:1.5;">1447084548.853318930</span> <span style="color:rgb(128,0,128);line-height:1.5;">1447084548.879395962<br></span></pre> 
    <p style="line-height:1.5;">&nbsp; Nov 9 15:55:48 swift3&nbsp;<span style="color:rgb(255,0,0);line-height:1.5;font-size:12px;">tempurl</span>: hmac_vals is ['fc9f80211aa5c6262f62ca4d57db65b25f1cef7a'] (txn: tx9ce884232d5a48bb9b5d8-005640c204)</p> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">如果使用非 UTC 时区的话，上面蓝色字体部分的两个时间会不一致，会导致问题。</p> 
   <h1 style="font-size:28px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">&nbsp;6. 备份 Cinder 卷到 Swift</h1> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">一直没机会试试 cinder-backup，现在有 Swift 了，终于可以试试了。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 cinder.conf 中的配置：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>backup_driver =<span style="line-height:1.5;"> cinder.backup.drivers.swift
backup_swift_url </span>= http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">9.115.251.238:1002/v1/AUTH_</span>
backup_swift_auth =<span style="line-height:1.5;"> per_user
backup_swift_auth_version </span>= <span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">
backup_swift_user </span>=<span style="line-height:1.5;"> cinder
backup_swift_tenant </span>=<span style="line-height:1.5;"> service
backup_swift_key </span>= <span style="color:rgb(128,0,128);line-height:1.5;">1111</span><span style="line-height:1.5;">
backup_swift_container </span>=<span style="line-height:1.5;"> volumebackups
backup_swift_object_size </span>= <span style="color:rgb(128,0,128);line-height:1.5;">52428800</span><span style="line-height:1.5;">
backup_swift_retry_attempts </span>= <span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">
backup_swift_retry_backoff </span>= <span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">
backup_compression_algorithm </span>= zlib</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">重启 cinder-backup 服务，然后创建一个 cinder backup：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@controller:~/s1# cinder backup-create --name vol100bk 76192a47-3be3-4ce9-b6df-<span style="line-height:1.5;">0416558910a6
</span>+-----------+--------------------------------------+
|  Property |                Value                 |
+-----------+--------------------------------------+
|     id    | c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-68779716b151 |
|    name   |               vol100bk               |
| volume_id | 76192a47-3be3-4ce9-b6df-0416558910a6 |
+-----------+--------------------------------------+</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后一段时间（和卷大小有关）后，Swift 中就有了若干个对象：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@controller:~/<span style="line-height:1.5;">s1# swift list volumebackups
volume_76192a47</span>-3be3-4ce9-b6df-0416558910a6/<span style="color:rgb(128,0,128);line-height:1.5;">20151110123343</span>/az_nova_backup_c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-68779716b151-<span style="color:rgb(128,0,128);line-height:1.5;">00001</span><span style="line-height:1.5;">
volume_76192a47</span>-3be3-4ce9-b6df-0416558910a6/<span style="color:rgb(128,0,128);line-height:1.5;">20151110123343</span>/az_nova_backup_c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-68779716b151-<span style="color:rgb(128,0,128);line-height:1.5;">00002</span><span style="line-height:1.5;">......
0416558910a6</span>/<span style="color:rgb(128,0,128);line-height:1.5;">20151110123343</span>/az_nova_backup_c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-68779716b151-<span style="color:rgb(128,0,128);line-height:1.5;">00021</span><span style="line-height:1.5;">
volume_76192a47</span>-3be3-4ce9-b6df-0416558910a6/<span style="color:rgb(128,0,128);line-height:1.5;">20151110123343</span>/az_nova_backup_c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-<span style="line-height:1.5;">68779716b151_metadata
volume_76192a47</span>-3be3-4ce9-b6df-0416558910a6/<span style="color:rgb(128,0,128);line-height:1.5;">20151110123343</span>/az_nova_backup_c4b31f0b-<span style="color:rgb(128,0,128);line-height:1.5;">5145</span>-4bf2-b033-68779716b151_sha256file</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后就可以继续使用cinder backup 相关的一些命令来操作它：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    backup-<span style="line-height:1.5;">delete       Removes a backup.
    backup</span>-<span style="line-height:1.5;">export       Export backup metadata record.
    backup</span>-<span style="line-height:1.5;">import       Import backup metadata record.
    backup</span>-<span style="line-height:1.5;">list         Lists all backups.
    backup</span>-<span style="line-height:1.5;">restore      Restores a backup.
    backup</span>-show         Shows backup details.</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;具体的细节，比如为什么创建了那么多的对象，还得进一步的学习。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">7. 向已有集群添加新的节点</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">7.1 步骤</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">添加一个带 3TB 磁盘的节点：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>$ swift-ring-builder account.builder add z1-<span style="color:rgb(128,0,128);line-height:1.5;">192.168</span>.<span style="color:rgb(128,0,128);line-height:1.5;">12.104</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6002</span>/d16 <span style="color:rgb(128,0,128);line-height:1.5;">3000</span><span style="line-height:1.5;">
$ swift</span>-ring-builder container.builder add z1-<span style="color:rgb(128,0,128);line-height:1.5;">192.168</span>.<span style="color:rgb(128,0,128);line-height:1.5;">12.104</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6001</span>/d16 <span style="color:rgb(128,0,128);line-height:1.5;">3000</span><span style="line-height:1.5;">
$ swift</span>-ring-builder <span style="color:rgb(0,0,255);line-height:1.5;">object</span>.builder add z1-<span style="color:rgb(128,0,128);line-height:1.5;">192.168</span>.<span style="color:rgb(128,0,128);line-height:1.5;">12.104</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6000</span>/d16 <span style="color:rgb(128,0,128);line-height:1.5;">3000</span><span style="line-height:1.5;">

$ swift</span>-ring-<span style="line-height:1.5;">builder account.builder rebalance
$ swift</span>-ring-<span style="line-height:1.5;">builder container.builder rebalance
$ swift</span>-ring-builder <span style="color:rgb(0,0,255);line-height:1.5;">object</span><span style="line-height:1.5;">.builder rebalance

$ scp account.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">1</span>:/etc/swift/<span style="line-height:1.5;">account.ring.gz
$ scp container.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">1</span>:/etc/swift/<span style="line-height:1.5;">container.ring.gz
$ scp </span><span style="color:rgb(0,0,255);line-height:1.5;">object</span>.ring.gz swift-node-<span style="color:rgb(128,0,128);line-height:1.5;">1</span>:/etc/swift/<span style="line-height:1.5;">account.ring.gz

$ scp account.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">2</span>:/etc/swift/<span style="line-height:1.5;">account.ring.gz
$ scp container.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">2</span>:/etc/swift/<span style="line-height:1.5;">container.ring.gz
$ scp </span><span style="color:rgb(0,0,255);line-height:1.5;">object</span>.ring.gz swift-node-<span style="color:rgb(128,0,128);line-height:1.5;">2</span>:/etc/swift/<span style="line-height:1.5;">account.ring.gz
 ...
$ scp account.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">10</span>:/etc/swift/<span style="line-height:1.5;">account.ring.gz
$ scp container.ring.gz swift</span>-node-<span style="color:rgb(128,0,128);line-height:1.5;">10</span>:/etc/swift/<span style="line-height:1.5;">container.ring.gz
$ scp </span><span style="color:rgb(0,0,255);line-height:1.5;">object</span>.ring.gz swift-node-<span style="color:rgb(128,0,128);line-height:1.5;">10</span>:/etc/swift/account.ring.gz</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">7.2 问题</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">文章&nbsp;<a href="https://swiftstack.com/blog/2012/04/09/swift-capacity-management/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Swift Capacity Management</a>&nbsp;说明了这么做的一个问题：由于数据移动，会导致短期内集群的性能大大下降。建议是分步增加 weight：</p> 
   <ol style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">第一次：<code>$ swift-ring-builder account.builder add z1-192.168.12.104:6002/d16 25</code> </li> 
    <li style="list-style-type:decimal;">第二次：<code>$ swift-ring-builder account.builder set_weight z1-192.168.12.104:6002/d16 50</code> </li> 
    <li style="list-style-type:decimal;">...</li> 
    <li style="list-style-type:decimal;">第120次：<code>$ swift-ring-builder account.builder set_weight z1-192.168.12.104:6002/d16 3000</code> </li> 
   </ol>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">更详细的 Swift 说明，在接下来的文章中会分析。&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong>参考文档：</strong></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><a href="http://netsword.blog.51cto.com/13993/787589" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">利用ucarp实现虚拟IP故障转移</a></li>
   </ul>
   <div>
    <font color="#4b4b4b"><span style="font-size:15px;"><br></span></font>
   </div> 
   <div> 
    <font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/4923432.html</span></font>
    <span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
   </div> 
   <div>
    <font color="#4b4b4b"><span style="font-size:15px;"><br></span></font>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
