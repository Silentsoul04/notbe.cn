<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>MVC文件上传与下载 « NotBeCN</title>
  <meta name="description" content="             想想自己从毕业到工作也有一年多，以前公司的任务的比较重，项目中有的时候需要用到什么东西都去搜索一下，基础知识感觉还没有以前在学校中的好。最近开始写博客，真的是有一种心中虽有千言，下笔实无一字的感概，本人不擅长理论，不擅长说教，不懂框架，现在写博客是即兴而言，均是自己的工作和个人学习中的感...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/24/weixin_33851429_90130992.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">MVC文件上传与下载</h1>
    <p class="post-meta">Nov 24, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">想想自己从毕业到工作也有一年多，以前公司的任务的比较重，项目中有的时候需要用到什么东西都去搜索一下，基础知识感觉还没有以前在学校中的好。最近开始写博客，真的是有一种心中虽有千言，下笔实无一字的感概，本人不擅长理论，不擅长说教，不懂框架，现在写博客是即兴而言，均是自己的工作和个人学习中的感悟而写，本来以为写个文件上传下载两个小时之类博客神马的都全部搞定，实际耗费的时候三倍左右，不多说了，正题开始:</span></p> 
   <h2 style="color:#FFFFFF;font-family:'宋体', Calibri;font-size:21px;line-height:1.5;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">1.上传文件File的Model建立</span></h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">FileName 文件名称 &nbsp; FileContent上传的文件以二进制的形式保存 &nbsp; &nbsp;FileExtName 文件后缀名 &nbsp; FilePath文件不保存在数据库时，存放一个相对路径</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span>  <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> File
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span> <span style="line-height:1.8;">    {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>       
<span style="line-height:1.8;color:rgb(0,128,128);"> 4</span> <span style="line-height:1.8;">        [Key]
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span> <span style="line-height:1.8;">        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">int</span> ID { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 7</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">string</span> FileName { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 8</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">byte</span>[] FileContent { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">string</span> FileExtName { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> DateTime UploadDate { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span>         <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">string</span> FilePath { <span style="line-height:1.8;color:rgb(0,0,255);">get</span>; <span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">; }
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="color:#FFFFFF;font-family:'宋体', Calibri;font-size:21px;line-height:1.5;"><span style="line-height:1.8;font-family:'楷体';">2.文件上传及保存的两种方式</span></h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">前台页面的建立，这里如果你喜欢使用Razor的话直接使用Html.BeginForm就行.</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>&lt;form action=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">/File/UploadHanlder</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>  id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">myForm</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> method=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">post</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>  enctype = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">multipart/form-data</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;
    &lt;input name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">MyUploadile</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">file</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt;
    &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> value=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">提交</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;
&lt;/form&gt;</pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">文件上传之后保存在网站目录:</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span>     <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (Request.Files.Count == <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span> <span style="line-height:1.8;">            {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>                 <span style="line-height:1.8;color:rgb(0,0,255);">return</span> Content(<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">请重新选择文件</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text/plain</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 4</span> <span style="line-height:1.8;">            }
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span>             <span style="line-height:1.8;color:rgb(0,0,255);">string</span> path = AppDomain.CurrentDomain.BaseDirectory + <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Upload\\</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span>             <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">Directory.Exists(path))
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 7</span> <span style="line-height:1.8;">            {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 8</span> <span style="line-height:1.8;">                Directory.CreateDirectory(path);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span> <span style="line-height:1.8;">            }
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>             <span style="line-height:1.8;color:rgb(0,0,255);">string</span> fileName = Request.Files[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">].FileName;
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span>             <span style="line-height:1.8;color:rgb(0,0,255);">string</span> uploadPath =<span style="line-height:1.8;"> Path.GetFileName(fileName);
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>             Request.Files[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">].SaveAs(Path.Combine(path, uploadPath));
</span><span style="line-height:1.8;color:rgb(0,128,128);">13</span>             <span style="line-height:1.8;color:rgb(0,0,255);">var</span> file = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MvcFileUpload.Models.File
</span><span style="line-height:1.8;color:rgb(0,128,128);">14</span> <span style="line-height:1.8;">            {
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span>                 FileName = GetFileNameOrSuffix(fileName, <span style="line-height:1.8;color:rgb(0,0,255);">true</span><span style="line-height:1.8;">),
</span><span style="line-height:1.8;color:rgb(0,128,128);">16</span>                 FilePath = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">/Upload/</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> +<span style="line-height:1.8;"> fileName,
</span><span style="line-height:1.8;color:rgb(0,128,128);">17</span>                 FileExtName = GetFileNameOrSuffix(fileName, <span style="line-height:1.8;color:rgb(0,0,255);">false</span><span style="line-height:1.8;">),
</span><span style="line-height:1.8;color:rgb(0,128,128);">18</span>                 UploadDate =<span style="line-height:1.8;"> DateTime.Now
</span><span style="line-height:1.8;color:rgb(0,128,128);">19</span> <span style="line-height:1.8;">            };
</span><span style="line-height:1.8;color:rgb(0,128,128);">20</span> <span style="line-height:1.8;">            dbConext.Files.Add(file);
</span><span style="line-height:1.8;color:rgb(0,128,128);">21</span> <span style="line-height:1.8;">            dbConext.SaveChanges();
</span><span style="line-height:1.8;color:rgb(0,128,128);">22</span>             <span style="line-height:1.8;color:rgb(0,0,255);">return</span> Json(<span style="line-height:1.8;color:rgb(0,0,255);">new</span> { Flag = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">1</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, Message = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">文件上传成功</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> }, JsonRequestBehavior.AllowGet);</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">文件名辅助方法:</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span> <span style="line-height:1.8;color:rgb(0,0,255);">public</span>  <span style="line-height:1.8;color:rgb(0,0,255);">string</span>   GetFileNameOrSuffix(<span style="line-height:1.8;color:rgb(0,0,255);">string</span>  name,<span style="line-height:1.8;color:rgb(0,0,255);">bool</span><span style="line-height:1.8;">  flag)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span> <span style="line-height:1.8;">        {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>            <span style="line-height:1.8;color:rgb(0,0,255);">int</span>  index= name.LastIndexOf(<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 4</span>            <span style="line-height:1.8;color:rgb(0,0,255);">string</span>[]  arr=name.Split(<span style="line-height:1.8;color:rgb(0,0,255);">new</span>  <span style="line-height:1.8;color:rgb(0,0,255);">char</span>[]{<span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;">},StringSplitOptions.RemoveEmptyEntries);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span>            <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;">(flag)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span> <span style="line-height:1.8;">           {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 7</span>                <span style="line-height:1.8;color:rgb(0,0,255);">return</span> name.Substring(<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">, index);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 8</span>              <span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  return   arr[0];</span>
<span style="line-height:1.8;color:rgb(0,128,128);"> 9</span> <span style="line-height:1.8;">           }
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>            <span style="line-height:1.8;color:rgb(0,0,255);">else</span>  
<span style="line-height:1.8;color:rgb(0,128,128);">11</span> <span style="line-height:1.8;">           {
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>                <span style="line-height:1.8;color:rgb(0,0,255);">return</span> name.Substring(index+<span style="line-height:1.8;color:rgb(128,0,128);">1</span>, name.Length-index-<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,128,128);">13</span>              <span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  return  arr[1];</span>
<span style="line-height:1.8;color:rgb(0,128,128);">14</span> <span style="line-height:1.8;">           }
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span>     
<span style="line-height:1.8;color:rgb(0,128,128);">16</span>             
<span style="line-height:1.8;color:rgb(0,128,128);">17</span>         }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">文件以二进制流的形式保存在数据库中:</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span>    <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (Request.Files.Count == <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span> <span style="line-height:1.8;">            {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>                 <span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">return Json(new { Flag = "0", Message = "文件上传失败" }, JsonRequestBehavior.AllowGet);</span>
<span style="line-height:1.8;color:rgb(0,128,128);"> 4</span>                 <span style="line-height:1.8;color:rgb(0,0,255);">return</span> Content(<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">没有文件</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text/plain</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span> <span style="line-height:1.8;">            }
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span>             <span style="line-height:1.8;color:rgb(0,0,255);">int</span> contentLength = Request.Files[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">].ContentLength;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 7</span>             Stream fileStream = Request.Files[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">].InputStream;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 8</span>             <span style="line-height:1.8;color:rgb(0,0,255);">byte</span>[] fileContent = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> <span style="line-height:1.8;color:rgb(0,0,255);">byte</span><span style="line-height:1.8;">[contentLength];
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span>             fileStream.Read(fileContent, <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">, contentLength);
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>             <span style="line-height:1.8;color:rgb(0,0,255);">string</span> fileName = Request.Files[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">].FileName;
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span>             <span style="line-height:1.8;color:rgb(0,0,255);">var</span> file = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MvcFileUpload.Models.File
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span> <span style="line-height:1.8;">            {
</span><span style="line-height:1.8;color:rgb(0,128,128);">13</span>                 FileName = GetFileNameOrSuffix(fileName, <span style="line-height:1.8;color:rgb(0,0,255);">true</span><span style="line-height:1.8;">),
</span><span style="line-height:1.8;color:rgb(0,128,128);">14</span>                 FileContent =<span style="line-height:1.8;"> fileContent,
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span>                 FileExtName = GetFileNameOrSuffix(fileName, <span style="line-height:1.8;color:rgb(0,0,255);">false</span><span style="line-height:1.8;">),
</span><span style="line-height:1.8;color:rgb(0,128,128);">16</span>                 UploadDate =<span style="line-height:1.8;"> DateTime.Now
</span><span style="line-height:1.8;color:rgb(0,128,128);">17</span> <span style="line-height:1.8;">            };
</span><span style="line-height:1.8;color:rgb(0,128,128);">18</span> <span style="line-height:1.8;">            dbConext.Files.Add(file);
</span><span style="line-height:1.8;color:rgb(0,128,128);">19</span> <span style="line-height:1.8;">            dbConext.SaveChanges();
</span><span style="line-height:1.8;color:rgb(0,128,128);">20</span>             <span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    return Content("文件上传成功", "text/plain");</span>
<span style="line-height:1.8;color:rgb(0,128,128);">21</span>             <span style="line-height:1.8;color:rgb(0,0,255);">return</span> Json(<span style="line-height:1.8;color:rgb(0,0,255);">new</span> { Flag = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">1</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, Message = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">文件上传成功</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> }, JsonRequestBehavior.AllowGet);</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">好了一个简单的文件上传两种方式都保存方式都搞定了，如果我只写到这里的话网上到处都是，你没兴趣往下看，我不好意思写.各位看官继续看~</span></p> 
   <h2 style="color:#FFFFFF;font-family:'宋体', Calibri;font-size:21px;line-height:1.5;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">3.表单的异步提交和Ajax.BeginForm()</span></h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';"><span style="line-height:24px;">耗费时间最多的地方是在这里，你自己可以尝试一下当你使用Ajax.BeginForm提交表单的时候你明明传了文件发现结果确为空，Ajax不支持异步提交文件的方式，如果要实现文件的异步提交需要引用一个Jquery.form.js.</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';"><span style="line-height:24px;">(吐槽一两句，博客园有的博友好坑爹，我搜索的时候一不小心进去看到一个博友使用Jaqury.Form.js上面特意给了一个js下载，二话不说的下了之后发现很悲催，使用的时候有些方法一直没有执行到，怀疑自己的写错了，也没找到哪里有错，最后跑到因为官网下载一个最新版的js)</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';"><span style="line-height:24px;">Jquery.form.js的官网地址:<a href="http://www.malsup.com/jquery/form/" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">http://www.malsup.com/jquery/form/</a>,研究英文的你会发现比中文搜索的内容好的多，中文都是各种半瓶水的加工.</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';"><span style="line-height:24px;">前台页面如下:</span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span> <span style="line-height:1.8;">@{
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span>     ViewBag.Title = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">文件上传</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span> <span style="line-height:1.8;">}
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 4</span> &lt;script src=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">../../Scripts/jquery-1.7.1.js</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;&lt;/script&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 5</span> 
<span style="line-height:1.8;color:rgb(0,128,128);"> 6</span> &lt;script src=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">../../Scripts/jquery.form.js</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;&lt;/script&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 7</span> &lt;script&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 8</span> <span style="line-height:1.8;">    (function () {
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span>         $(<span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">#myForm</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;">).ajaxForm({
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>             target: <span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">#outputdiv</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;">,
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span> <span style="line-height:1.8;">            beforeSend: function () {
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>                 alert(<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">表单提交前</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,128,128);">13</span> <span style="line-height:1.8;">            },
</span><span style="line-height:1.8;color:rgb(0,128,128);">14</span>             target: <span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">#outputdiv</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;">,
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span> <span style="line-height:1.8;">            success: function (data) {;
</span><span style="line-height:1.8;color:rgb(0,128,128);">16</span> 
<span style="line-height:1.8;color:rgb(0,128,128);">17</span> <span style="line-height:1.8;">                    alert(data.Message);
</span><span style="line-height:1.8;color:rgb(0,128,128);">18</span> <span style="line-height:1.8;">            }
</span><span style="line-height:1.8;color:rgb(0,128,128);">19</span>            
<span style="line-height:1.8;color:rgb(0,128,128);">20</span> <span style="line-height:1.8;">        }); 
</span><span style="line-height:1.8;color:rgb(0,128,128);">21</span> 
<span style="line-height:1.8;color:rgb(0,128,128);">22</span> <span style="line-height:1.8;">    })();
</span><span style="line-height:1.8;color:rgb(0,128,128);">23</span> &lt;/script&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">24</span> &lt;h1&gt;上传文件&lt;/h1&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">25</span> &lt;div id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">outputdiv</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt; &lt;/div&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">26</span> &lt;form action=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">/File/UploadHanlder</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>  id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">myForm</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> method=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">post</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>  enctype = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">multipart/form-data</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">27</span>     &lt;input name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">MyUploadile</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">file</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">28</span>     &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> value=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">提交</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">29</span> &lt;/form&gt;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">下载最新的插件，研究官网api的用法和Demo比你看其他人写的要快，后台处理的方法可以参考上面.</span></p> 
   <h2 style="color:#FFFFFF;font-family:'宋体', Calibri;font-size:21px;line-height:1.5;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">4.图片，PDF文件预览和下载（针对的是保存在是网站目录下的文件）</span></h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'楷体';font-size:medium;"><span style="line-height:24px;">这个就是调用一下后台的数据在展示一下:</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'楷体';font-size:medium;"><span style="line-height:24px;">后台处理方法:</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,128);">1</span>&nbsp;List&lt;Models.File&gt; list=dbConext.Files.Where(item=&gt;item.FilePath!=<span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">).ToList();&nbsp;</span><span style="line-height:1.8;color:rgb(0,128,128);">2</span>&nbsp;<span style="line-height:1.8;color:rgb(0,0,255);">return</span>&nbsp;View(list);</span>&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">前台页面展示:</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span> <span style="line-height:1.8;">@{
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span>     ViewBag.Title = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">ShowData</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>     List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; typeList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpeg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> };
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 4</span>     List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; otherList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">xls</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">doc</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">docx</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">zip</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">rar</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">pdf</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">};
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span> <span style="line-height:1.8;">}
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span> @model IEnumerable&lt;MvcFileUpload.Models.File&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 7</span> &lt;h2&gt;图片&lt;/h2&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 8</span> @foreach (<span style="line-height:1.8;color:rgb(0,0,255);">var</span> item <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> Model)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span> <span style="line-height:1.8;">{
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>     <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (typeList.Contains(item.FileExtName))
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span> <span style="line-height:1.8;">    {
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>         &lt;img  src=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">@item.FilePath</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> alt=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">@item.FileName</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> height=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">200px</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> width=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">300px</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">13</span> <span style="line-height:1.8;">    }
</span><span style="line-height:1.8;color:rgb(0,128,128);">14</span> <span style="line-height:1.8;">}
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span> &lt;h2&gt;其他文件&lt;/h2&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">16</span> @foreach (<span style="line-height:1.8;color:rgb(0,0,255);">var</span> item <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> Model)
</span><span style="line-height:1.8;color:rgb(0,128,128);">17</span> <span style="line-height:1.8;">{
</span><span style="line-height:1.8;color:rgb(0,128,128);">18</span>     <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (otherList.Contains(item.FileExtName))
</span><span style="line-height:1.8;color:rgb(0,128,128);">19</span> <span style="line-height:1.8;">    {
</span><span style="line-height:1.8;color:rgb(0,128,128);">20</span>     &lt;a href=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">@item.FilePath</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> &gt;@(item.FileName+<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>+item.FileExtName)&lt;/a&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">21</span> <span style="line-height:1.8;">    }
</span><span style="line-height:1.8;color:rgb(0,128,128);">22</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="color:#FFFFFF;font-family:'宋体', Calibri;font-size:21px;line-height:1.5;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">5.二进制图片预览和文件下载</span></h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'楷体';font-size:16px;">后台控制器处理:</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  <span style="line-height:1.8;color:rgb(0,0,255);">public</span><span style="line-height:1.8;"> ActionResult ShowBinaryData()
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">var</span> list = dbConext.Files.Where(item =&gt;item.FilePath==<span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">);

            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> View(list);
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> FileResult GetFile(<span style="line-height:1.8;color:rgb(0,0,255);">int</span><span style="line-height:1.8;">  id)
        {
            Models.File file </span>= dbConext.Files.Where(item =&gt; item.ID ==<span style="line-height:1.8;"> id).FirstOrDefault();
            List</span>&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; typeList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpeg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> };
            List</span>&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; otherList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">xls</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">doc</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">docx</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">zip</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">rar</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">pdf</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">};
            </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (file==<span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">)
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">;  
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (typeList.Contains(file.FileExtName))
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span> FileContentResult(file.FileContent, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">image/jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (otherList.Contains(file.FileExtName))
            {
               </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> File(file.FileContent, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">application/octet-stream</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,file.FileName+<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>+<span style="line-height:1.8;">file.FileExtName);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">;
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,128);"> 1</span> <span style="line-height:1.8;">@{
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 2</span>     ViewBag.Title = <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">ShowData</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 3</span>     List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; typeList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">jpeg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> };
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 4</span>     List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt; otherList = <span style="line-height:1.8;color:rgb(0,0,255);">new</span> List&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;() { <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">xls</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">doc</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>, <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">docx</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">zip</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">rar</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>,<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">pdf</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">};
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 5</span> <span style="line-height:1.8;">}
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 6</span> @model IEnumerable&lt;MvcFileUpload.Models.File&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 7</span> &lt;h2&gt;图片&lt;/h2&gt;
<span style="line-height:1.8;color:rgb(0,128,128);"> 8</span> @foreach (<span style="line-height:1.8;color:rgb(0,0,255);">var</span> item <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> Model)
</span><span style="line-height:1.8;color:rgb(0,128,128);"> 9</span> <span style="line-height:1.8;">{
</span><span style="line-height:1.8;color:rgb(0,128,128);">10</span>     <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (typeList.Contains(item.FileExtName))
</span><span style="line-height:1.8;color:rgb(0,128,128);">11</span> <span style="line-height:1.8;">    {
</span><span style="line-height:1.8;color:rgb(0,128,128);">12</span>         &lt;img  src=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">/File/GetFile?Id=@item.ID</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> alt=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">@item.FileName</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> height=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">200px</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> width=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">300px</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">13</span> <span style="line-height:1.8;">    }
</span><span style="line-height:1.8;color:rgb(0,128,128);">14</span> <span style="line-height:1.8;">}
</span><span style="line-height:1.8;color:rgb(0,128,128);">15</span> &lt;h2&gt;其他文件&lt;/h2&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">16</span> @foreach (<span style="line-height:1.8;color:rgb(0,0,255);">var</span> item <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> Model)
</span><span style="line-height:1.8;color:rgb(0,128,128);">17</span> <span style="line-height:1.8;">{
</span><span style="line-height:1.8;color:rgb(0,128,128);">18</span>     <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (otherList.Contains(item.FileExtName))
</span><span style="line-height:1.8;color:rgb(0,128,128);">19</span> <span style="line-height:1.8;">    {
</span><span style="line-height:1.8;color:rgb(0,128,128);">20</span>     &lt;a href=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">/File/GetFile?Id=@item.ID</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;@(item.FileName+<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>+item.FileExtName)&lt;/a&gt;
<span style="line-height:1.8;color:rgb(0,128,128);">21</span> <span style="line-height:1.8;">    }
</span><span style="line-height:1.8;color:rgb(0,128,128);">22</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">&nbsp;这里面因为存储的是二进制数据FileContentResult(file.FileContent, "image/jpg");如果是PDF,Word，xls的话，你需要给出一个下载名，不然下载出来的内容是没有格式的，File(file.FileContent, "application/octet-stream",file.FileName+"."+file.FileExtName).</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'Microsoft YaHei';">如果在上传的时候有限制的话加个配置&lt;httpRuntime executionTimeout="5400" maxRequestLength="10485760" useFullyQualifiedRedirectUrl="false"&nbsp;<em><span style="line-height:1.5;">/&gt;</span></em></span></p> 
   <p><span style="line-height:1.8;"><em><span style="line-height:1.5;"><font color="#333333"><span style="font-size:14px;">本文转自Fly_Elephant博客园博客，原文链接：http://www.cnblogs.com/xiaofeixiang/p/3676597.html，如需转载请自行联系原作者</span></font><br></span></em></span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
