<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>C#对硬件的控制 « NotBeCN</title>
  <meta name="description" content="                                         C# code                                       using System;                using System.Collections.Generic;        ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/26/weixin_33794672_90134996.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">C#对硬件的控制</h1>
    <p class="post-meta">Nov 26, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1></h1> 
   <div class="postBody"> 
    <div class="blogpost-body"> 
     <dl>
      <dt>
       C# code 
      </dt> 
      <dd> 
       <pre>
</pre> 
       <div> 
        <span style="color:rgb(0,0,255);">using</span> System;
        <br>
        <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;
        <br>
        <span style="color:rgb(0,0,255);">using</span> System.Text;
        <br>
        <span style="color:rgb(0,0,255);">using</span> System.Runtime.InteropServices;
        <br>
        <br>
        <span style="color:rgb(0,0,255);">namespace</span> Hardware
        <br> {
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 下列所需函数可参考MSDN中与驱动程序相关的API函数<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> 
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> Externs
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DIGCF_ALLCLASSES = (
        <span style="color:rgb(128,0,128);">0x00000004</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DIGCF_PRESENT = (
        <span style="color:rgb(128,0,128);">0x00000002</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> INVALID_HANDLE_VALUE = -
        <span style="color:rgb(128,0,128);">1</span>;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> SPDRP_DEVICEDESC = (
        <span style="color:rgb(128,0,128);">0x00000000</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> MAX_DEV_LEN = 
        <span style="color:rgb(128,0,128);">1000</span>;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DEVICE_NOTIFY_WINDOW_HANDLE = (
        <span style="color:rgb(128,0,128);">0x00000000</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DEVICE_NOTIFY_SERVICE_HANDLE = (
        <span style="color:rgb(128,0,128);">0x00000001</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DEVICE_NOTIFY_ALL_INTERFACE_CLASSES = (
        <span style="color:rgb(128,0,128);">0x00000004</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DBT_DEVTYP_DEVICEINTERFACE = (
        <span style="color:rgb(128,0,128);">0x00000005</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DBT_DEVNODES_CHANGED = (
        <span style="color:rgb(128,0,128);">0x0007</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> WM_DEVICECHANGE = (
        <span style="color:rgb(128,0,128);">0x0219</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DIF_PROPERTYCHANGE = (
        <span style="color:rgb(128,0,128);">0x00000012</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DICS_FLAG_GLOBAL = (
        <span style="color:rgb(128,0,128);">0x00000001</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DICS_FLAG_CONFIGSPECIFIC = (
        <span style="color:rgb(128,0,128);">0x00000002</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DICS_ENABLE = (
        <span style="color:rgb(128,0,128);">0x00000001</span>);
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">const</span> 
        <span style="color:rgb(0,0,255);">int</span> DICS_DISABLE = (
        <span style="color:rgb(128,0,128);">0x00000002</span>);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 注册设备或者设备类型，在指定的窗口返回相关的信息<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="hRecipient"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="NotificationFilter"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="Flags"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">user32.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, CharSet = CharSet.Auto)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> IntPtr RegisterDeviceNotification(IntPtr hRecipient, DEV_BROADCAST_DEVICEINTERFACE NotificationFilter, UInt32 Flags);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 通过名柄，关闭指定设备的信息。<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="hHandle"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">user32.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, CharSet = CharSet.Auto)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> 
        <span style="color:rgb(0,0,255);">uint</span> UnregisterDeviceNotification(IntPtr hHandle);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 获取一个指定类别或全部类别的所有已安装设备的信息<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="gClass"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="iEnumerator"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="hParent"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="nFlags"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, SetLastError = 
        <span style="color:rgb(0,0,255);">true</span>)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> IntPtr SetupDiGetClassDevs(
        <span style="color:rgb(0,0,255);">ref</span> Guid gClass, UInt32 iEnumerator, IntPtr hParent, UInt32 nFlags);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 销毁一个设备信息集合，并且释放所有关联的内存<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="lpInfoSet"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, SetLastError = 
        <span style="color:rgb(0,0,255);">true</span>)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> 
        <span style="color:rgb(0,0,255);">int</span> SetupDiDestroyDeviceInfoList(IntPtr lpInfoSet);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 枚举指定设备信息集合的成员，并将数据放在SP_DEVINFO_DATA中<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="lpInfoSet"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="dwIndex"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="devInfoData"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, SetLastError = 
        <span style="color:rgb(0,0,255);">true</span>)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> 
        <span style="color:rgb(0,0,255);">bool</span> SetupDiEnumDeviceInfo(IntPtr lpInfoSet, UInt32 dwIndex, SP_DEVINFO_DATA devInfoData);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 获取指定设备的属性<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="lpInfoSet"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="DeviceInfoData"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="Property"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="PropertyRegDataType"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="PropertyBuffer"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="PropertyBufferSize"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="RequiredSize"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, SetLastError = 
        <span style="color:rgb(0,0,255);">true</span>)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> 
        <span style="color:rgb(0,0,255);">bool</span> SetupDiGetDeviceRegistryProperty(IntPtr lpInfoSet, SP_DEVINFO_DATA DeviceInfoData, UInt32 Property, UInt32 PropertyRegDataType, StringBuilder PropertyBuffer, UInt32 PropertyBufferSize, IntPtr RequiredSize);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 停用设备<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="DeviceInfoSet"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="DeviceInfoData"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="ClassInstallParams"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="ClassInstallParamsSize"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, SetLastError = 
        <span style="color:rgb(0,0,255);">true</span>, CharSet = CharSet.Auto)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> 
        <span style="color:rgb(0,0,255);">bool</span> SetupDiSetClassInstallParams(IntPtr DeviceInfoSet, IntPtr DeviceInfoData, IntPtr ClassInstallParams, 
        <span style="color:rgb(0,0,255);">int</span> ClassInstallParamsSize);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 启用设备<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="InstallFunction"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="DeviceInfoSet"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;param name="DeviceInfoData"&gt;&lt;/param&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [DllImport(
        <span style="color:rgb(128,0,0);">"</span>
        <span style="color:rgb(128,0,0);">setupapi.dll</span>
        <span style="color:rgb(128,0,0);">"</span>, CharSet = CharSet.Auto)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">static</span> 
        <span style="color:rgb(0,0,255);">extern</span> Boolean SetupDiCallClassInstaller(UInt32 InstallFunction, IntPtr DeviceInfoSet, IntPtr DeviceInfoData);
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> RegisterDeviceNotification所需参数<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">struct</span> DEV_BROADCAST_HANDLE
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbch_size;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbch_devicetype;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbch_reserved;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr dbch_handle;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr dbch_hdevnotify;
        <br>
        <span style="color:rgb(0,0,255);">public</span> Guid dbch_eventguid;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">long</span> dbch_nameoffset;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">byte</span> dbch_data;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">byte</span> dbch_data1;
        <br> }
        <br>
        <br>
        <span style="color:rgb(0,128,0);">//</span>
        <span style="color:rgb(0,128,0);"> WM_DEVICECHANGE message</span>
        <span style="color:rgb(0,128,0);"><br></span> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> DEV_BROADCAST_DEVICEINTERFACE
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbcc_size;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbcc_devicetype;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> dbcc_reserved;
        <br> }
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 设备信息数据<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> SP_DEVINFO_DATA
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> cbSize;
        <br>
        <span style="color:rgb(0,0,255);">public</span> Guid classGuid;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> devInst;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">ulong</span> reserved;
        <br> };
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 属性变更参数<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> SP_PROPCHANGE_PARAMS
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> SP_CLASSINSTALL_HEADER ClassInstallHeader = 
        <span style="color:rgb(0,0,255);">new</span> SP_CLASSINSTALL_HEADER();
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> StateChange;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> Scope;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> HwProfile;
        <br> };
        <br>
        <br>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
        <span style="color:rgb(0,128,0);"><br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> 设备安装<br></span>
        <span style="color:rgb(128,128,128);">///</span>
        <span style="color:rgb(0,128,0);"> </span>
        <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);"><br></span> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> SP_DEVINSTALL_PARAMS
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> cbSize;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> Flags;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> FlagsEx;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr hwndParent;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr InstallMsgHandler;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr InstallMsgHandlerContext;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr FileQueue;
        <br>
        <span style="color:rgb(0,0,255);">public</span> IntPtr ClassInstallReserved;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> Reserved;
        <br> [MarshalAs(UnmanagedType.LPTStr)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">string</span> DriverPath;
        <br> };
        <br>
        <br> [StructLayout(LayoutKind.Sequential)]
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">class</span> SP_CLASSINSTALL_HEADER
        <br> {
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> cbSize;
        <br>
        <span style="color:rgb(0,0,255);">public</span> 
        <span style="color:rgb(0,0,255);">int</span> InstallFunction;
        <br> };
        <br> }
        <br> }
        <br>
       </div> 
       <br>
      </dd> 
     </dl>
     <br>
     <table>
      <tbody>
       <tr>
        <td class="content">
         <dl>
          <dt>
           C# code 
          </dt> 
          <dd> 
           <pre>
</pre> 
           <div> 
            <span style="color:rgb(0,0,255);">using</span> System;
            <br>
            <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;
            <br>
            <span style="color:rgb(0,0,255);">using</span> System.Text;
            <br>
            <span style="color:rgb(0,0,255);">using</span> System.Runtime.InteropServices;
            <br>
            <br>
            <span style="color:rgb(0,0,255);">namespace</span> Hardware
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">public</span> 
            <span style="color:rgb(0,0,255);">class</span> HardwareClass
            <br> {
            <br> 属性
            <span style="color:rgb(0,0,255);">#region</span> 属性
            <br>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 返回所有硬件信息列表<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
            <span style="color:rgb(128,128,128);"><br></span> 
            <span style="color:rgb(0,0,255);">public</span> 
            <span style="color:rgb(0,0,255);">string</span>[] List
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">get</span>
            <br> {
            <br> List&lt;
            <span style="color:rgb(0,0,255);">string</span>&gt; HWList = 
            <span style="color:rgb(0,0,255);">new</span> List&lt;
            <span style="color:rgb(0,0,255);">string</span>&gt;();
            <br>
            <span style="color:rgb(0,0,255);">try</span>
            <br> {
            <br> Guid myGUID = System.Guid.Empty;
            <br> IntPtr hDevInfo = Externs.SetupDiGetClassDevs(
            <span style="color:rgb(0,0,255);">ref</span> myGUID, 
            <span style="color:rgb(128,0,128);">0</span>, IntPtr.Zero, Externs.DIGCF_ALLCLASSES | Externs.DIGCF_PRESENT);
            <br>
            <span style="color:rgb(0,0,255);">if</span> (hDevInfo.ToInt32() == Externs.INVALID_HANDLE_VALUE)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">throw</span> 
            <span style="color:rgb(0,0,255);">new</span> Exception(
            <span style="color:rgb(128,0,0);">"</span>
            <span style="color:rgb(128,0,0);">Invalid Handle</span>
            <span style="color:rgb(128,0,0);">"</span>);
            <br> }
            <br> Externs.SP_DEVINFO_DATA DeviceInfoData;
            <br> DeviceInfoData = 
            <span style="color:rgb(0,0,255);">new</span> Externs.SP_DEVINFO_DATA();
            <br> DeviceInfoData.cbSize = 
            <span style="color:rgb(128,0,128);">28</span>;
            <br> DeviceInfoData.devInst = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> DeviceInfoData.classGuid = System.Guid.Empty;
            <br> DeviceInfoData.reserved = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> UInt32 i;
            <br> StringBuilder DeviceName = 
            <span style="color:rgb(0,0,255);">new</span> StringBuilder(
            <span style="color:rgb(128,0,0);">""</span>);
            <br> DeviceName.Capacity = Externs.MAX_DEV_LEN;
            <br>
            <span style="color:rgb(0,0,255);">for</span> (i = 
            <span style="color:rgb(128,0,128);">0</span>; Externs.SetupDiEnumDeviceInfo(hDevInfo, i, DeviceInfoData); i++)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">while</span> (!Externs.SetupDiGetDeviceRegistryProperty(hDevInfo, DeviceInfoData, Externs.SPDRP_DEVICEDESC, 
            <span style="color:rgb(128,0,128);">0</span>, DeviceName, Externs.MAX_DEV_LEN, IntPtr.Zero))
            <br> {
            <br>
            <span style="color:rgb(0,128,0);">//</span>
            <span style="color:rgb(0,128,0);">Skip</span>
            <span style="color:rgb(0,128,0);"><br></span> }
            <br> HWList.Add(DeviceName.ToString());
            <br> }
            <br> Externs.SetupDiDestroyDeviceInfoList(hDevInfo);
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">catch</span> (Exception ex)
            <br> ...{
            <br>
            <span style="color:rgb(0,0,255);">throw</span> 
            <span style="color:rgb(0,0,255);">new</span> Exception(
            <span style="color:rgb(128,0,0);">"</span>
            <span style="color:rgb(128,0,0);">枚举设备列表出错</span>
            <span style="color:rgb(128,0,0);">"</span>, ex);
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">return</span> HWList.ToArray();
            <br> }
            <br> }
            <br>
            <br>
            <span style="color:rgb(0,0,255);">#endregion</span>
            <br>
            <br> 公共事件
            <span style="color:rgb(0,0,255);">#region</span> 公共事件
            <br>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 清理非托管资源<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="callback"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(128,128,128);"><br></span> 
            <span style="color:rgb(0,0,255);">public</span> 
            <span style="color:rgb(0,0,255);">void</span> Dispose(IntPtr callback)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">try</span>
            <br> {
            <br> Externs.UnregisterDeviceNotification(callback);
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">catch</span>
            <br> {
            <br> }
            <br> }
            <br>
            <br>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 设置指定设备的状态<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="match"&gt;</span>
            <span style="color:rgb(0,128,0);">设备名称</span>
            <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="bEnable"&gt;</span>
            <span style="color:rgb(0,128,0);">是否启用</span>
            <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
            <span style="color:rgb(128,128,128);"><br></span> 
            <span style="color:rgb(0,0,255);">public</span> 
            <span style="color:rgb(0,0,255);">bool</span> SetState(
            <span style="color:rgb(0,0,255);">string</span>[] match, 
            <span style="color:rgb(0,0,255);">bool</span> bEnable)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">try</span>
            <br> {
            <br> Guid myGUID = System.Guid.Empty;
            <br> IntPtr hDevInfo = Externs.SetupDiGetClassDevs(
            <span style="color:rgb(0,0,255);">ref</span> myGUID, 
            <span style="color:rgb(128,0,128);">0</span>, IntPtr.Zero, Externs.DIGCF_ALLCLASSES | Externs.DIGCF_PRESENT);
            <br>
            <span style="color:rgb(0,0,255);">if</span> (hDevInfo.ToInt32() == Externs.INVALID_HANDLE_VALUE)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">false</span>;
            <br> }
            <br> Externs.SP_DEVINFO_DATA DeviceInfoData;
            <br> DeviceInfoData = 
            <span style="color:rgb(0,0,255);">new</span> Externs.SP_DEVINFO_DATA();
            <br> DeviceInfoData.cbSize = 
            <span style="color:rgb(128,0,128);">28</span>;
            <br> DeviceInfoData.devInst = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> DeviceInfoData.classGuid = System.Guid.Empty;
            <br> DeviceInfoData.reserved = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> UInt32 i;
            <br> StringBuilder DeviceName = 
            <span style="color:rgb(0,0,255);">new</span> StringBuilder(
            <span style="color:rgb(128,0,0);">""</span>);
            <br> DeviceName.Capacity = Externs.MAX_DEV_LEN;
            <br>
            <span style="color:rgb(0,0,255);">for</span> (i = 
            <span style="color:rgb(128,0,128);">0</span>; Externs.SetupDiEnumDeviceInfo(hDevInfo, i, DeviceInfoData); i++)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">while</span> (!Externs.SetupDiGetDeviceRegistryProperty(hDevInfo, DeviceInfoData, Externs.SPDRP_DEVICEDESC, 
            <span style="color:rgb(128,0,128);">0</span>, DeviceName, Externs.MAX_DEV_LEN, IntPtr.Zero))
            <br> {
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">bool</span> bMatch = 
            <span style="color:rgb(0,0,255);">true</span>;
            <br>
            <span style="color:rgb(0,0,255);">foreach</span> (
            <span style="color:rgb(0,0,255);">string</span> search 
            <span style="color:rgb(0,0,255);">in</span> match)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">if</span> (!DeviceName.ToString().ToLower().Contains(search.ToLower()))
            <br> {
            <br> bMatch = 
            <span style="color:rgb(0,0,255);">false</span>;
            <br>
            <span style="color:rgb(0,0,255);">break</span>;
            <br> }
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">if</span> (bMatch)
            <br> {
            <br> OpenClose(hDevInfo, DeviceInfoData, bEnable);
            <br> }
            <br> }
            <br> Externs.SetupDiDestroyDeviceInfoList(hDevInfo);
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">catch</span> (Exception ex)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">throw</span> 
            <span style="color:rgb(0,0,255);">new</span> Exception(
            <span style="color:rgb(128,0,0);">"</span>
            <span style="color:rgb(128,0,0);">枚举设备信息出错！</span>
            <span style="color:rgb(128,0,0);">"</span>, ex);
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">false</span>;
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">true</span>;
            <br> }
            <br>
            <br>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 允许一个窗口或者服务接收所有硬件的通知<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 注:目前还没有找到一个比较好的方法来处理如果通知服务。<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="callback"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="UseWindowHandle"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
            <span style="color:rgb(128,128,128);"><br></span> 
            <span style="color:rgb(0,0,255);">public</span> 
            <span style="color:rgb(0,0,255);">bool</span> AllowNotifications(IntPtr callback, 
            <span style="color:rgb(0,0,255);">bool</span> UseWindowHandle)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">try</span>
            <br> {
            <br> Externs.DEV_BROADCAST_DEVICEINTERFACE dbdi = 
            <span style="color:rgb(0,0,255);">new</span> Externs.DEV_BROADCAST_DEVICEINTERFACE();
            <br> dbdi.dbcc_size = Marshal.SizeOf(dbdi);
            <br> dbdi.dbcc_reserved = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> dbdi.dbcc_devicetype = Externs.DBT_DEVTYP_DEVICEINTERFACE;
            <br>
            <span style="color:rgb(0,0,255);">if</span> (UseWindowHandle)
            <br> Externs.RegisterDeviceNotification(callback, dbdi, Externs.DEVICE_NOTIFY_ALL_INTERFACE_CLASSES | Externs.DEVICE_NOTIFY_WINDOW_HANDLE);
            <br>
            <span style="color:rgb(0,0,255);">else</span>
            <br> Externs.RegisterDeviceNotification(callback, dbdi, Externs.DEVICE_NOTIFY_ALL_INTERFACE_CLASSES | Externs.DEVICE_NOTIFY_SERVICE_HANDLE);
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">true</span>;
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">catch</span> (Exception ex)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">string</span> err = ex.Message;
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">false</span>;
            <br> }
            <br> }
            <br>
            <br>
            <span style="color:rgb(0,0,255);">#endregion</span> 
           </div> 
           <br>
          </dd> 
         </dl></td>
       </tr>
       <tr>
        <td> </td>
       </tr>
       <tr>
        <td class="function"></td>
       </tr>
      </tbody>
     </table>
     <br>
     <table>
      <tbody>
       <tr>
        <td class="content">
         <dl>
          <dt>
           <strong>C# code</strong>
          </dt> 
          <dd> 
           <pre>
</pre> 
           <div> 
            <br>
            <span style="color:rgb(0,0,255);">#region</span> 私有事件
            <br>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 开启或者关闭指定的设备驱动<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> 注意：该方法目前没有检查是否需要重新启动计算机。^.^<br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="hDevInfo"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="devInfoData"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;param name="bEnable"&gt;&lt;/param&gt;</span>
            <span style="color:rgb(0,128,0);"><br></span>
            <span style="color:rgb(128,128,128);">///</span>
            <span style="color:rgb(0,128,0);"> </span>
            <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
            <span style="color:rgb(128,128,128);"><br></span> 
            <span style="color:rgb(0,0,255);">private</span> 
            <span style="color:rgb(0,0,255);">bool</span> OpenClose(IntPtr hDevInfo, Externs.SP_DEVINFO_DATA devInfoData, 
            <span style="color:rgb(0,0,255);">bool</span> bEnable)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">try</span>
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">int</span> szOfPcp;
            <br> IntPtr ptrToPcp;
            <br>
            <span style="color:rgb(0,0,255);">int</span> szDevInfoData;
            <br> IntPtr ptrToDevInfoData;
            <br> Externs.SP_PROPCHANGE_PARAMS SP_PROPCHANGE_PARAMS1 = 
            <span style="color:rgb(0,0,255);">new</span> Externs.SP_PROPCHANGE_PARAMS();
            <br>
            <span style="color:rgb(0,0,255);">if</span> (bEnable)
            <br> {
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.cbSize = Marshal.SizeOf(
            <span style="color:rgb(0,0,255);">typeof</span>(Externs.SP_CLASSINSTALL_HEADER));
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.InstallFunction = Externs.DIF_PROPERTYCHANGE;
            <br> SP_PROPCHANGE_PARAMS1.StateChange = Externs.DICS_ENABLE;
            <br> SP_PROPCHANGE_PARAMS1.Scope = Externs.DICS_FLAG_GLOBAL;
            <br> SP_PROPCHANGE_PARAMS1.HwProfile = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br>
            <br> szOfPcp = Marshal.SizeOf(SP_PROPCHANGE_PARAMS1);
            <br> ptrToPcp = Marshal.AllocHGlobal(szOfPcp);
            <br> Marshal.StructureToPtr(SP_PROPCHANGE_PARAMS1, ptrToPcp, 
            <span style="color:rgb(0,0,255);">true</span>);
            <br> szDevInfoData = Marshal.SizeOf(devInfoData);
            <br> ptrToDevInfoData = Marshal.AllocHGlobal(szDevInfoData);
            <br>
            <br>
            <span style="color:rgb(0,0,255);">if</span> (Externs.SetupDiSetClassInstallParams(hDevInfo, ptrToDevInfoData, ptrToPcp, Marshal.SizeOf(
            <span style="color:rgb(0,0,255);">typeof</span>(Externs.SP_PROPCHANGE_PARAMS))))
            <br> {
            <br> Externs.SetupDiCallClassInstaller(Externs.DIF_PROPERTYCHANGE, hDevInfo, ptrToDevInfoData);
            <br> }
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.cbSize = Marshal.SizeOf(
            <span style="color:rgb(0,0,255);">typeof</span>(Externs.SP_CLASSINSTALL_HEADER));
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.InstallFunction = Externs.DIF_PROPERTYCHANGE;
            <br> SP_PROPCHANGE_PARAMS1.StateChange = Externs.DICS_ENABLE;
            <br> SP_PROPCHANGE_PARAMS1.Scope = Externs.DICS_FLAG_CONFIGSPECIFIC;
            <br> SP_PROPCHANGE_PARAMS1.HwProfile = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">else</span>
            <br> {
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.cbSize = Marshal.SizeOf(
            <span style="color:rgb(0,0,255);">typeof</span>(Externs.SP_CLASSINSTALL_HEADER));
            <br> SP_PROPCHANGE_PARAMS1.ClassInstallHeader.InstallFunction = Externs.DIF_PROPERTYCHANGE;
            <br> SP_PROPCHANGE_PARAMS1.StateChange = Externs.DICS_DISABLE;
            <br> SP_PROPCHANGE_PARAMS1.Scope = Externs.DICS_FLAG_CONFIGSPECIFIC;
            <br> SP_PROPCHANGE_PARAMS1.HwProfile = 
            <span style="color:rgb(128,0,128);">0</span>;
            <br> }
            <br> szOfPcp = Marshal.SizeOf(SP_PROPCHANGE_PARAMS1);
            <br> ptrToPcp = Marshal.AllocHGlobal(szOfPcp);
            <br> Marshal.StructureToPtr(SP_PROPCHANGE_PARAMS1, ptrToPcp, 
            <span style="color:rgb(0,0,255);">true</span>);
            <br> szDevInfoData = Marshal.SizeOf(devInfoData);
            <br> ptrToDevInfoData = Marshal.AllocHGlobal(szDevInfoData);
            <br> Marshal.StructureToPtr(devInfoData, ptrToDevInfoData, 
            <span style="color:rgb(0,0,255);">true</span>);
            <br>
            <br>
            <span style="color:rgb(0,0,255);">bool</span> rslt1 = Externs.SetupDiSetClassInstallParams(hDevInfo, ptrToDevInfoData, ptrToPcp, Marshal.SizeOf(
            <span style="color:rgb(0,0,255);">typeof</span>(Externs.SP_PROPCHANGE_PARAMS)));
            <br>
            <span style="color:rgb(0,0,255);">bool</span> rstl2 = Externs.SetupDiCallClassInstaller(Externs.DIF_PROPERTYCHANGE, hDevInfo, ptrToDevInfoData);
            <br>
            <span style="color:rgb(0,0,255);">if</span> ((!rslt1) || (!rstl2))
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">throw</span> 
            <span style="color:rgb(0,0,255);">new</span> Exception(
            <span style="color:rgb(128,0,0);">"</span>
            <span style="color:rgb(128,0,0);">不能更改设备状态。</span>
            <span style="color:rgb(128,0,0);">"</span>);
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">false</span>;
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">else</span>
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">true</span>;
            <br> }
            <br> }
            <br>
            <span style="color:rgb(0,0,255);">catch</span> (Exception ex)
            <br> {
            <br>
            <span style="color:rgb(0,0,255);">return</span> 
            <span style="color:rgb(0,0,255);">false</span>;
            <br> }
            <br> }
            <br>
            <br>
            <span style="color:rgb(0,0,255);">#endregion</span>
            <br> }
            <br> }
            <br>
           </div> 
           <br>
          </dd> 
         </dl></td>
       </tr>
       <tr>
        <td> </td>
       </tr>
       <tr>
        <td class="function"></td>
       </tr>
      </tbody>
     </table>
     <br>
     <dl>
      <dt>
       <strong>C# code</strong>
      </dt> 
      <dd>
       <pre>        <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">void</span> Form1_Load(<span style="color:rgb(0,0,255);">object</span> sender, EventArgs e)<br>
{<br><span style="color:rgb(0,128,0);">//</span><span style="color:rgb(0,128,0);">枚举硬件列表</span><span style="color:rgb(0,128,0);"><br></span>            <span style="color:rgb(0,0,255);">string</span>[] HardList = hc.List;<br><span style="color:rgb(0,0,255);">foreach</span> (<span style="color:rgb(0,0,255);">string</span> s <span style="color:rgb(0,0,255);">in</span> HardList)<br>
{<br>
listBox1.Items.Add(s);<br>
}<br>
hc.AllowNotifications(Handle, <span style="color:rgb(0,0,255);">true</span>);<br>
label1.Text = <span style="color:rgb(128,0,0);">"</span><span style="color:rgb(128,0,0);">计算机内的设备数量为：</span><span style="color:rgb(128,0,0);">"</span> + listBox1.Items.Count.ToString();<br>
}<br><br><span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">void</span> Form1_FormClosing(<span style="color:rgb(0,0,255);">object</span> sender, FormClosingEventArgs e)<br>
{<br><span style="color:rgb(0,128,0);">//</span><span style="color:rgb(0,128,0);">清理非托管资源</span><span style="color:rgb(0,128,0);"><br></span>            hc.Dispose(Handle);<br>
hc = <span style="color:rgb(0,0,255);">null</span>;<br>
}<br><br><span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">void</span> button1_Click(<span style="color:rgb(0,0,255);">object</span> sender, EventArgs e)<br>
{<br><span style="color:rgb(0,128,0);">//</span><span style="color:rgb(0,128,0);">启用硬件</span><span style="color:rgb(0,128,0);"><br></span>            <span style="color:rgb(0,0,255);">string</span>[] dev = <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(0,0,255);">string</span>[<span style="color:rgb(128,0,128);">1</span>];<br>
hc.Dispose(Handle);<br>
dev[<span style="color:rgb(128,0,128);">0</span>] = listBox1.SelectedItem.ToString();<br>
hc.SetState(dev, <span style="color:rgb(0,0,255);">true</span>);<br>
hc.Dispose(Handle);<br>
}<br><br><span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">void</span> button2_Click(<span style="color:rgb(0,0,255);">object</span> sender, EventArgs e)<br>
{<br><span style="color:rgb(0,128,0);">//</span><span style="color:rgb(0,128,0);">停用硬件</span><span style="color:rgb(0,128,0);"><br></span>            <span style="color:rgb(0,0,255);">string</span>[] dev = <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(0,0,255);">string</span>[<span style="color:rgb(128,0,128);">1</span>];<br>
hc.Dispose(Handle);<br>
dev[<span style="color:rgb(128,0,128);">0</span>] = listBox1.SelectedItem.ToString();<br>
hc.SetState(dev, <span style="color:rgb(0,0,255);">false</span>);<br>
hc.Dispose(Handle);</pre>
      </dd> 
      <dd> 
       <pre>        }本文转自94cool博客园博客，原文链接：http://www.cnblogs.com/94cool/archive/2009/08/14/1545717.html，如需转载请自行联系原作者</pre> 
       <font><span>&nbsp;<br></span></font> 
      </dd> 
     </dl>
     <div>
      <br>
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
