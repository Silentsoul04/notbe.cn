<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ASP.NET MVC 5 学习教程：Edit方法和Edit视图详解 « NotBeCN</title>
  <meta name="description" content="                                起飞网 ASP.NET MVC 5 学习教程目录：            添加控制器       添加视图       修改视图和布局页       控制器传递数据给视图       添加模型       创建连接字符串       通过控制器访问模...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/26/weixin_33998125_90122132.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">ASP.NET MVC 5 学习教程：Edit方法和Edit视图详解</h1>
    <p class="post-meta">Nov 26, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1></h1> 
   <div class="clear"></div> 
   <div class="postBody"> 
    <div class="blogpost-body"> 
     <p><a href="http://www.qeefee.com/" rel="nofollow">起飞网</a> ASP.NET MVC 5 学习教程目录：</p> 
     <ul>
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-a-controller" rel="nofollow">添加控制器</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-a-view" rel="nofollow">添加视图</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-changing-views-and-layout-pages" rel="nofollow">修改视图和布局页</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-passing-data-from-the-controller-to-the-view" rel="nofollow">控制器传递数据给视图</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-a-model" rel="nofollow">添加模型</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-creating-a-connection-string" rel="nofollow">创建连接字符串</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-accessing-your-models-data-from-a-controller" rel="nofollow">通过控制器访问模型的数据</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-examining-the-generated-code" rel="nofollow">生成的代码详解</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-working-with-localdb" rel="nofollow">使用 SQL Server LocalDB</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-examining-the-edit-methods-and-edit-view" rel="nofollow">Edit方法和Edit视图详解</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-search" rel="nofollow">添加查询</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-a-new-field" rel="nofollow">Entity Framework 数据迁移之添加字段</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-adding-validation" rel="nofollow">添加验证</a></li> 
      <li><a href="http://www.qeefee.com/mvc/mvc-5-examining-the-details-and-delete-methods" rel="nofollow">Details 和 Delete 方法详解</a></li> 
     </ul>
     <p>在本节中，我们继续研究生成的Edit方法和视图。但在研究之前，我们先将 release date 弄得好看一点。打开 <em>Models\Movie.cs</em> 文件，添加下面黄色背景的行：</p> 
     <p><strong><em>代码清单1：Models\Movie.cs 文件</em></strong></p> 
     <pre class="code"><span style="color:#0000FF;">using </span>System;
<span style="color:#0000FF;"><span>using </span></span><span>System.ComponentModel.DataAnnotations;</span>
<span style="color:#0000FF;">using </span>System.Data.Entity;

<span style="color:#0000FF;">namespace </span>MvcMovie.Models
{
    <span style="color:#0000FF;">public class </span><span style="color:rgb(43,145,175);">Movie
    </span>{
        <span style="color:#0000FF;">public int </span>ID { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
        <span style="color:#0000FF;">public string </span>Title { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
<span>        [</span></pre> 
     <p><span><span style="color:rgb(43,145,175);">Display</span>(Name = <span style="color:rgb(163,21,21);">"Release Date"</span></span><span>)] [<span style="color:rgb(43,145,175);">DataType</span>(<span style="color:rgb(43,145,175);">DataType</span></span></p> 
     <pre class="code"><span>.Date)]</span>
        <span style="color:#0000FF;">public </span><span style="color:rgb(43,145,175);">DateTime </span>ReleaseDate { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
        <span style="color:#0000FF;">public string </span>Genre { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
        <span style="color:#0000FF;">public decimal </span>Price { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
    }

    <span style="color:#0000FF;">public class </span><span style="color:rgb(43,145,175);">MovieDBContext </span>: <span style="color:rgb(43,145,175);">DbContext
    </span>{
        <span style="color:#0000FF;">public </span><span style="color:rgb(43,145,175);">DbSet</span>&lt;<span style="color:rgb(43,145,175);">Movie</span>&gt; Movies { <span style="color:#0000FF;">get</span>; <span style="color:#0000FF;">set</span>; }
    }
}</pre> 
     <p>我们将在下一节中介绍 DataAnnotations。Display 特性指定了显示的字段名（本例中“Release Date”替换了“ReleaseDate”）。DataType 特性指定了数据类型，在本例中它是日期类型，因此存储在该字段的时间信息将不会显示出来。</p> 
     <p>运行应用程序，在浏览器地址栏中追加<em>/movies </em>来访问 <em>Movies </em>控制器。将鼠标放在Edit 链接上面，查看它链接到的地址：</p> 
     <p><em><strong>图1：查看Edit链接地址</strong></em></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092004-caea652f19a0405e8e86264e915d4dec.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image" alt="image" src="https://images0.cnblogs.com/blog/44814/201307/19092005-fea9c70af91941ef95b86a2cfc1d89b5.png" width="604" height="480"></a></p> 
     <p>Edit 链接是通过Html.ActionLink 方法生成的，在<em>Views\Movies\Index.cshtml</em> 视图中，代码如下：</p> 
     <p><strong><em>代码清单2：Html.ActionLink 方法</em></strong></p> 
     <pre class="code">@Html.ActionLink(<span style="color:rgb(163,21,21);">"Edit"</span>, <span style="color:rgb(163,21,21);">"Edit"</span>, <span style="color:#0000FF;">new </span>{ id=item.ID })</pre> 
     <p><strong><em>图2：Html.ActionLink 方法介绍</em></strong></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092005-2e66e87444c0456eb8ff2479df0a457f.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image" alt="image" src="https://images0.cnblogs.com/blog/44814/201307/19092006-95d97b6f72824b529f65165df42c5282.png" width="640" height="145"></a></p> 
     <p>Html 对象是System.Web.Mvc.WebViewPage 基类中的一个属性，ActionLink 方法使动态生成 控制器中方法的 HTML 超链接更为简单。ActionLink 方法的第一个参数是要显示的链接文字（例如<code>&lt;a&gt;Edit Me&lt;/a&gt;</code>）；第二个参数是要调用的控制器方法（在这里是 Edit 方法）；最后一个参数是生成路由数据用的匿名对象（在这里是id，值为1）。</p> 
     <p>在图1中显示的生成地址是<em>http://localhost:2264/Movies/Edit/1</em> 。默认的路由匹配 <code>{controller}/{action}/{id} </code>URL模式 。因此，ASP.NET 将请求地址<em>http://localhost:2264/Movies/Edit/1</em> 翻译为MoviesController 的Edit 方法，参数id为1。查看<em>App_Start\RouteConfig.cs </em>文件中的代码：</p> 
     <p><strong><em>代码清单3：默认路由规则</em></strong></p> 
     <pre class="code">routes.MapRoute(
    name: <span style="color:rgb(163,21,21);">"Default"</span>,
    url: <span style="color:rgb(163,21,21);">"{controller}/{action}/{id}"</span>,
    defaults: <span style="color:#0000FF;">new </span>{ controller = <span style="color:rgb(163,21,21);">"Home"</span>, action = <span style="color:rgb(163,21,21);">"Index"</span>, id = <span style="color:rgb(43,145,175);">UrlParameter</span>.Optional }
);</pre> 
     <p>你还可以使用查询字符串传递参数，例如 <em>http://localhost:xxxxx/Movies/Edit?ID=1 </em>也可以将参数id为1的值传递给Movies控制器。</p> 
     <p><strong><em>图3：通过查询字符串传递参数</em></strong></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092006-0aace90299a345818ffe382fb1d257af.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image" alt="image" src="https://images0.cnblogs.com/blog/44814/201307/19092007-3cd99159e235498e924cd1107e548bc7.png" width="533" height="480"></a></p> 
     <p>打开Movies控制器，它包含了两个Edit 方法，代码如下：</p> 
     <p><strong><em>代码清单4：两个Edit方法 - MoviesController.cs</em></strong></p> 
     <pre class="code"><span style="color:#008000;">//
// GET: /Movies/Edit/5
</span><span style="color:#0000FF;">public </span><span style="color:rgb(43,145,175);">ActionResult </span>Edit(<span style="color:rgb(43,145,175);">Int32 </span>id)
{
    <span style="color:rgb(43,145,175);">Movie </span>movie = db.Movies.Find(id);
    <span style="color:#0000FF;">if </span>(movie == <span style="color:#0000FF;">null</span>)
    {
        <span style="color:#0000FF;">return </span>HttpNotFound();
    }
    <span style="color:#0000FF;">return </span>View(movie);
}

<span style="color:#008000;">//
// POST: /Movies/Edit/5
</span></pre> 
     <p><span>[<span style="color:rgb(43,145,175);">HttpPost</span></span></p> 
     <pre class="code"><span>]</span>
[<span style="color:rgb(43,145,175);">ValidateAntiForgeryToken</span>]
<span style="color:#0000FF;">public </span><span style="color:rgb(43,145,175);">ActionResult </span>Edit(<span style="color:rgb(43,145,175);">Movie </span>movie)
{
    <span style="color:#0000FF;">if </span>(ModelState.IsValid)
    {
        db.Entry(movie).State = <span style="color:rgb(43,145,175);">EntityState</span>.Modified;
        db.SaveChanges();
        <span style="color:#0000FF;">return </span>RedirectToAction(<span style="color:rgb(163,21,21);">"Index"</span>);
    }
    <span style="color:#0000FF;">return </span>View(movie);
}</pre> 
     <p>注意第二个 Edit 方法，它被HttpPost特性修饰（代码中黄色背景标注），这个特性指定只有POST请求才能调用这个重载的Edit方法。我们可以为第一个Edit方法添加HttpGet特性，但这不是必须的，因为它是默认值（我们将未标记的方法认定为HttpGet方法）。第二个Edit 方法还有一个 <em>ValidateAntiForgeryToken </em>特性，这个特性用来阻止伪造的请求，它和视图（<em>Views\Movies\Edit.cshtml</em>）中的 <em>@Html.AntiForgeryToken() </em>是成对出现的。</p> 
     <p><em><strong>代码清单5：@Html.AntiForgeryToken() 用法</strong></em></p> 
     <pre class="code">@model MvcMovie.Models.<span style="color:rgb(43,145,175);">Movie

</span>@{
    ViewBag.Title = <span style="color:rgb(163,21,21);">"Edit"</span>;
}

<span style="color:#0000FF;">&lt;</span><span style="color:#800000;">h2</span><span style="color:#0000FF;">&gt;</span>Edit<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">h2</span><span style="color:#0000FF;">&gt;

</span>@<span style="color:#0000FF;">using </span>(Html.BeginForm()) {
    <span>@</span><span>Html.AntiForgeryToken()</span>
    @Html.ValidationSummary(<span style="color:#0000FF;">true</span>)

    <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">fieldset </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="form-horizontal"&gt;
        &lt;</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;</span>Movie<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;

        </span>@Html.HiddenFor(model =&gt; model.ID)

        <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            </span>@Html.LabelFor(model =&gt; model.Title, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"control-label" </span>})
            <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                </span>@Html.EditorFor(model =&gt; model.Title)
                @Html.ValidationMessageFor(model =&gt; model.Title, <span style="color:#0000FF;">null</span>, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"help-inline" </span>})
            <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;</span></pre> 
     <p><em>@Html.AntiForgeryToken()</em> 生成一个表单防伪标记，必须与 <em>MoviesController</em> 中的 <em>Edit</em> 方法匹配。</p> 
     <p>HttpGet标记的Edit方法接收一个ID的参数，通过Entity Framework Find方法查找电影，并将找到的结果返回个Edit 视图。如果调用Edit方法的时候没有参数，ID参数的值将会是默认的0。如果未找到电影信息，控制器将返回一个HttpNotFound。当支架系统创建Edit 视图的时候，它会检查Movie类，为它的每一个属性创建绘制<code>&lt;label&gt;</code>和<code>&lt;input&gt;</code> 元素的代码。下面的示例展示了Visual Studio 支架系统创建的Edit视图代码：</p> 
     <p><strong><em>代码清单6：Edit 视图</em></strong></p> 
     <pre class="code">@model MvcMovie.Models.<span style="color:rgb(43,145,175);">Movie

</span>@{
    ViewBag.Title = <span style="color:rgb(163,21,21);">"Edit"</span>;
}

<span style="color:#0000FF;">&lt;</span><span style="color:#800000;">h2</span><span style="color:#0000FF;">&gt;</span>Edit<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">h2</span><span style="color:#0000FF;">&gt;

</span>@<span style="color:#0000FF;">using </span>(Html.BeginForm()) {
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(<span style="color:#0000FF;">true</span>)

    <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">fieldset </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="form-horizontal"&gt;
        &lt;</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;</span>Movie<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;

        </span>@Html.HiddenFor(model =&gt; model.ID)

        <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            </span>@Html.LabelFor(model =&gt; model.Title, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"control-label" </span>})
            <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                </span>@Html.EditorFor(model =&gt; model.Title)
                @Html.ValidationMessageFor(model =&gt; model.Title, <span style="color:#0000FF;">null</span>, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"help-inline" </span>})
            <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            </span>@Html.LabelFor(model =&gt; model.ReleaseDate, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"control-label" </span>})
            <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                </span>@Html.EditorFor(model =&gt; model.ReleaseDate)
                @Html.ValidationMessageFor(model =&gt; model.ReleaseDate, <span style="color:#0000FF;">null</span>, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"help-inline" </span>})
            <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            </span>@Html.LabelFor(model =&gt; model.Genre, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"control-label" </span>})
            <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                </span>@Html.EditorFor(model =&gt; model.Genre)
                @Html.ValidationMessageFor(model =&gt; model.Genre, <span style="color:#0000FF;">null</span>, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"help-inline" </span>})
            <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            </span>@Html.LabelFor(model =&gt; model.Price, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"control-label" </span>})
            <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                </span>@Html.EditorFor(model =&gt; model.Price)
                @Html.ValidationMessageFor(model =&gt; model.Price, <span style="color:#0000FF;">null</span>, <span style="color:#0000FF;">new </span>{ @class = <span style="color:rgb(163,21,21);">"help-inline" </span>})
            <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="form-actions no-color"&gt;
            &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="submit" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="Save" </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="btn" /&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
    &lt;/</span><span style="color:#800000;">fieldset</span><span style="color:#0000FF;">&gt;
</span>}

<span style="color:#0000FF;">&lt;</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
    </span>@Html.ActionLink(<span style="color:rgb(163,21,21);">"Back to List"</span>, <span style="color:rgb(163,21,21);">"Index"</span>)
<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

</span>@section Scripts {
@<span style="color:rgb(43,145,175);">Scripts</span>.Render(<span style="color:rgb(163,21,21);">"~/bundles/jqueryval"</span>)
}
</pre> 
     <p>在视图文件顶部的语句 <em>@model MvcMovie.Models.Movie</em> 指明该视图需要一个 <em>Movie </em>型的模型。 </p> 
     <p>支架生成的代码使用了很多精简HTML标记的帮助方法，<em>Html.LabelFor</em> 方法用来显示字段名( "Title", "ReleaseDate", "Genre", 和 "Price")，Html.EditorFor 方法生成一个HTML <em>&lt;input&gt; </em>元素，Html.ValidationMessageFor 方法结合属性显示一些验证信息。</p> 
     <p>运行应用程序，导航到 <em>/movies</em> 地址，点击 <em>Edit</em> 链接，在浏览器中，查看页面源代码，form标签的HTML代码如下：</p> 
     <p><em><strong>代码清单7：生成的form标签HTML代码</strong></em></p> 
     <pre class="code"><span style="color:#0000FF;">&lt;</span><span style="color:#800000;">form </span><span style="color:#FF0000;">action</span><span style="color:#0000FF;">="/Movies/Edit/1" </span><span style="color:#FF0000;">method</span><span style="color:#0000FF;">="post"&gt;
    <span>&lt;</span></span></pre> 
     <p><span><span style="color:#800000;">input </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="__RequestVerificationToken" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="hidden" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="vM6-yBtYJY5uRgKm3ivFw9gLMjauE9i2-Wi6Y--2Swm4-BlucfrG71zQV3n773tT9i8ytaG5WSanfBBd54qIhAKAkTJO_Z0UhRaGPDhMJ9M1" /&gt; &lt;</span><span style="color:#800000;">fieldset </span><span style="color:#FF0000;">class</span></span></p> 
     <pre class="code"><span style="color:#0000FF;"><span>="form-horizontal"&gt;</span>
        &lt;</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;</span>Movie<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">legend</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">data-val</span><span style="color:#0000FF;">="true" </span><span style="color:#FF0000;">data-val-number</span><span style="color:#0000FF;">="The field ID must be a number." </span><span style="color:#FF0000;">data-val-required</span><span style="color:#0000FF;">="ID 字段是必需的。" </span><span style="color:#FF0000;">id</span><span style="color:#0000FF;">="ID" </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="ID" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="hidden" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="1" /&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            &lt;</span><span style="color:#800000;">label </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-label" </span><span style="color:#FF0000;">for</span><span style="color:#0000FF;">="Title"&gt;</span>Title<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">label</span><span style="color:#0000FF;">&gt;
            &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="text-box single-line" </span><span style="color:#FF0000;">id</span><span style="color:#0000FF;">="Title" </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="Title" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="text" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="中国合伙人" /&gt;
                &lt;</span><span style="color:#800000;">span </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="field-validation-valid help-inline" </span><span style="color:#FF0000;">data-valmsg-for</span><span style="color:#0000FF;">="Title" </span><span style="color:#FF0000;">data-valmsg-replace</span><span style="color:#0000FF;">="true"&gt;&lt;/</span><span style="color:#800000;">span</span><span style="color:#0000FF;">&gt;
            &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            &lt;</span><span style="color:#800000;">label </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-label" </span><span style="color:#FF0000;">for</span><span style="color:#0000FF;">="ReleaseDate"&gt;</span>Release Date<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">label</span><span style="color:#0000FF;">&gt;
            &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="text-box single-line" </span><span style="color:#FF0000;">data-val</span><span style="color:#0000FF;">="true" </span><span style="color:#FF0000;">data-val-date</span><span style="color:#0000FF;">="The field Release Date must be a date." </span><span style="color:#FF0000;">data-val-required</span><span style="color:#0000FF;">="Release Date 字段是必需的。" </span><span style="color:#FF0000;">id</span><span style="color:#0000FF;">="ReleaseDate" </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="ReleaseDate" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="date" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="2013/6/18" /&gt;
                &lt;</span><span style="color:#800000;">span </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="field-validation-valid help-inline" </span><span style="color:#FF0000;">data-valmsg-for</span><span style="color:#0000FF;">="ReleaseDate" </span><span style="color:#FF0000;">data-valmsg-replace</span><span style="color:#0000FF;">="true"&gt;&lt;/</span><span style="color:#800000;">span</span><span style="color:#0000FF;">&gt;
            &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            &lt;</span><span style="color:#800000;">label </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-label" </span><span style="color:#FF0000;">for</span><span style="color:#0000FF;">="Genre"&gt;</span>Genre<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">label</span><span style="color:#0000FF;">&gt;
            &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="text-box single-line" </span><span style="color:#FF0000;">id</span><span style="color:#0000FF;">="Genre" </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="Genre" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="text" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="励志" /&gt;
                &lt;</span><span style="color:#800000;">span </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="field-validation-valid help-inline" </span><span style="color:#FF0000;">data-valmsg-for</span><span style="color:#0000FF;">="Genre" </span><span style="color:#FF0000;">data-valmsg-replace</span><span style="color:#0000FF;">="true"&gt;&lt;/</span><span style="color:#800000;">span</span><span style="color:#0000FF;">&gt;
            &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-group"&gt;
            &lt;</span><span style="color:#800000;">label </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="control-label" </span><span style="color:#FF0000;">for</span><span style="color:#0000FF;">="Price"&gt;</span>Price<span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">label</span><span style="color:#0000FF;">&gt;
            &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="controls"&gt;
                &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="text-box single-line" </span><span style="color:#FF0000;">data-val</span><span style="color:#0000FF;">="true" </span><span style="color:#FF0000;">data-val-number</span><span style="color:#0000FF;">="The field Price must be a number." </span><span style="color:#FF0000;">data-val-required</span><span style="color:#0000FF;">="Price 字段是必需的。" </span><span style="color:#FF0000;">id</span><span style="color:#0000FF;">="Price" </span><span style="color:#FF0000;">name</span><span style="color:#0000FF;">="Price" </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="text" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="70.00" /&gt;
                &lt;</span><span style="color:#800000;">span </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="field-validation-valid help-inline" </span><span style="color:#FF0000;">data-valmsg-for</span><span style="color:#0000FF;">="Price" </span><span style="color:#FF0000;">data-valmsg-replace</span><span style="color:#0000FF;">="true"&gt;&lt;/</span><span style="color:#800000;">span</span><span style="color:#0000FF;">&gt;
            &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;

        &lt;</span><span style="color:#800000;">div </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="form-actions no-color"&gt;
            &lt;</span><span style="color:#800000;">input </span><span style="color:#FF0000;">type</span><span style="color:#0000FF;">="submit" </span><span style="color:#FF0000;">value</span><span style="color:#0000FF;">="Save" </span><span style="color:#FF0000;">class</span><span style="color:#0000FF;">="btn" /&gt;
        &lt;/</span><span style="color:#800000;">div</span><span style="color:#0000FF;">&gt;
    &lt;/</span><span style="color:#800000;">fieldset</span><span style="color:#0000FF;">&gt;
&lt;/</span><span style="color:#800000;">form</span><span style="color:#0000FF;">&gt;</span></pre> 
     <p>看一下这个form标签，它的action属性是<em>/movies/edit/1</em>，说明form将提交到这个地址，而它里面包含的<em>&lt;input&gt;</em>标签则对应每一个Movie类的字段。当点击“Save”按钮时，form中的数据将提交到服务器。第二行代码中，我使用高亮提示，这行代码是使用<em>@Html.AntiForgeryToken() </em>生成的隐藏域，用来阻止伪造的请求。</p> 
     <h2>处理POST请求</h2> 
     <p>下面是接收POST请求的Edit方法：</p> 
     <p><strong><em>代码清单8：Edit 方法</em></strong></p> 
     <pre class="code">[<span style="color:rgb(43,145,175);">HttpPost</span>]
[<span style="color:rgb(43,145,175);">ValidateAntiForgeryToken</span>]
<span style="color:#0000FF;">public </span><span style="color:rgb(43,145,175);">ActionResult </span>Edit(<span style="color:rgb(43,145,175);">Movie </span>movie)
{
    <span style="color:#0000FF;">if </span>(ModelState.IsValid)
    {
        db.Entry(movie).State = <span style="color:rgb(43,145,175);">EntityState</span>.Modified;
        db.SaveChanges();
        <span style="color:#0000FF;">return </span>RedirectToAction(<span style="color:rgb(163,21,21);">"Index"</span>);
    }
    <span style="color:#0000FF;">return </span>View(movie);
}</pre> 
     <p><em>ASP.NET MVC model binder</em> 使用提交的表单数据创建一个 <em>Movie</em> 对象，作为 <em>movie</em> 参数传递给 <em>Edit</em> 方法。<em>ModelState.IsValid</em> 验证 <em>form </em>提交的数据是否能够用来修改（编辑或更新）<em>Movie</em>对象，如果验证通过，电影数据就会保存在 <em>db.Movies</em> 列表中（<em>db</em> 是 <em>MovieDBContext</em> 的实例），通过调用 db.SaveChanges 方法将修改后的电影数据保存在数据库中。在数据保存之后，RedirectToAction 将跳转到 Index 方法，用来显示电影列表，此时就能看到更新后的电影信息。</p> 
     <p>在用户输入过程中，一旦输入了未通过验证的值，客户端就会显示一个错误信息，这些功能是通过Javascript 完成的，如果你禁用了Javascript，客户端验证功能将会失效，但服务器会检查到不合法的数据，然后将包含错误信息的表单重新显示在客户端。在后面的章节中我们将介绍更多验证的细节。</p> 
     <p><em>Edit.cshtml</em> 视图中的 <em>Html.ValidationMessageFor</em> 方法会显示相应的错误信息。如下图：</p> 
     <p><strong><em>图4：编辑Movie时的验证信息</em></strong></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092007-9f64223451224834b0215ba2e568432a.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image_thumb" alt="image_thumb" src="https://images0.cnblogs.com/blog/44814/201307/19092008-ef523c64a93c4c76a0eb9c53f426b19a.png" width="451" height="448"></a></p> 
     <p>所有处理Get请求的方法都有相似的模式：他们获取一个电影对象（在Index中是电影列表），然后传递给View。Create 方法传递一个空的电影数据给视图。使用HTTP GET 方法修改数据存在安全风险，也同样违背了HTTP最佳实践，并且 REST 模式中明确指出，GET 请求不应该改变应用程序的状态，换句话说，GET 操作应该是一个安全的操作，没有副作用，也不会修改你的持久化数据。</p> 
     <h2>本地化验证</h2> 
     <p>如果你是用英语，这部分可以跳过。作为汉语国家用户，我还是把这部分翻译一下吧。</p> 
     <p>对于非英语地区的用户来说，小数点使用逗号（","），还有非美语的日期格式，为了支持Jquery 验证，你必须包含 globalize.js 和特定的 <em>cultures/globalize.cultures.js</em> 文件，在Javascript中使用 Globalize.parseFloat。你可以通过NuGet获得 jQuery non-English validation （英语地区不要安装Globalize）。</p> 
     <p>From the <strong>Tools </strong>menu click <strong>Library Package Manager</strong>, and then click <strong>Manage NuGet Packages for Solution</strong>.</p> 
     <p>在菜单栏中单击“工具”&gt;“库程序包管理器”&gt;“管理解决方案的 NuGet程序包”。</p> 
     <p><em><strong>图5：NuGet 菜单</strong></em></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092008-62fe3b092f5a4013b208741e534d4931.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image" alt="image" src="https://images0.cnblogs.com/blog/44814/201307/19092008-28c6487ba9a84600a9a34d3e9447a4dc.png" width="604" height="349"></a></p> 
     <p>在左侧单击“联机”，在查询框中输入“Globalize”：</p> 
     <p><strong><em>图6：查询 Globalize 安装包</em></strong></p> 
     <p><a href="https://images0.cnblogs.com/blog/44814/201307/19092009-9c35b7f43b5245b98572795602f97341.png" rel="nofollow"><img style="border-width:0px;background-image:none;" title="image" alt="image" src="https://images0.cnblogs.com/blog/44814/201307/19092010-7524e8d9d62b4885ac581f1937fa55ca.png" width="640" height="427"></a></p> 
     <p>点击“安装”按钮，<em>Scripts\jquery.globalize\globalize.js </em>文件将会添加到项目中，文件夹 <em>Scripts\jquery.globalize\cultures\ </em>中包含了很多Javascript文件。</p> 
     <p>下面的代码显示了将文件 Views\Movies\Edit.cshtml 使用汉语区域所作的修改（原文作者使用法语作为演示）：</p> 
     <p><strong><em>代码清单9：script 代码 - Edit.cshtml</em></strong></p> 
     <pre class="code">@section Scripts {
@<span style="color:rgb(43,145,175);">Scripts</span>.Render(<span style="color:rgb(163,21,21);">"~/bundles/jqueryval"</span>)
    <span style="color:#0000FF;">&lt;</span><span style="color:#800000;">script </span><span style="color:#FF0000;">src</span><span style="color:#0000FF;">="~/Scripts/jquery.globalize/globalize.js"&gt;&lt;/</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
    &lt;</span><span style="color:#800000;">script </span><span style="color:#FF0000;">src</span><span style="color:#0000FF;">="~/Scripts/jquery.globalize/cultures/globalize.culture.zh-CN.js"&gt;&lt;/</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
    &lt;</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
        </span>$.validator.methods.number = <span style="color:#0000FF;">function </span>(value, element) {
            <span style="color:#0000FF;">return this</span>.optional(element) ||
                !isNaN(Globalize.parseFloat(value));
        }
        $(document).ready(<span style="color:#0000FF;">function </span>() {
            Globalize.culture(<span style="color:rgb(163,21,21);">'zh-CN'</span>);
        });
    <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
    &lt;</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
        </span>jQuery.extend(jQuery.validator.methods, {
            range: <span style="color:#0000FF;">function </span>(value, element, param) {
                <span style="color:#008000;">//Use the Globalization plugin to parse the value
                </span><span style="color:#0000FF;">var </span>val = $.global.parseFloat(value);
                <span style="color:#0000FF;">return this</span>.optional(element) || (
                    val &gt;= param[0] &amp;&amp; val &lt;= param[1]);
            }
        });
    <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
    &lt;</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
        </span>$.validator.methods.date = <span style="color:#0000FF;">function </span>(value, element) {
            <span style="color:#0000FF;">return this</span>.optional(element) ||
            !isDate(Globalize.parseDate(value));
        }
    <span style="color:#0000FF;">&lt;/</span><span style="color:#800000;">script</span><span style="color:#0000FF;">&gt;
</span>}</pre> 
     <p>为了避免在每个编辑视图都写上这么一大段代码，你可以将他们写在布局页。</p> 
     <p>在下一节中我们将为程序实现查找功能。</p> 
     <p>本文同时发布在<a href="http://www.qeefee.com/" rel="nofollow">起飞网</a>，原文地址：<a title="http://www.qeefee.com/mvc/mvc-5-examining-the-edit-methods-and-edit-view" href="http://www.qeefee.com/mvc/mvc-5-examining-the-edit-methods-and-edit-view" rel="nofollow">http://www.qeefee.com/mvc/mvc-5-examining-the-edit-methods-and-edit-view</a></p> 
     <p><font color="#0000ee"><u><br></u></font></p> 
     <p><font color="#0000ee"><u><br></u></font></p> 
     <p><font color="#0000ee"><u><br></u></font></p> 
     <p><font color="#0000ee"><u>本文转自齐师傅博客园博客，原文链接：http://www.cnblogs.com/youring2/p/mvc-5-examining-the-edit-methods-and-edit-view.html，如需转载请自行联系原作者</u></font></p> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
