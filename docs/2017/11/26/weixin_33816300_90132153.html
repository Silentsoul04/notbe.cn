<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>LocalReport Print with C# C#打印RDLC « NotBeCN</title>
  <meta name="description" content="                                    &nbsp;1 代码             2       #region public static             3       ///             &lt;summary&gt;             4   ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/26/weixin_33816300_90132153.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">LocalReport Print with C# C#打印RDLC</h1>
    <p class="post-meta">Nov 26, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1> </h1> 
   <div class="cnblogs_code"> 
    <div class="cnblogs_code_hide"> 
     <div> 
      <span style="color:rgb(0,128,128);">&nbsp;1</span> 代码
      <br>
      <span style="color:rgb(0,128,128);"> 2</span> 
      <span style="color:rgb(0,0,255);">#region</span> public static
      <br>
      <span style="color:rgb(0,128,128);"> 3</span> 
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);"> 4</span> 
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 获取指定ReportViewer总物理页数<br></span>
      <span style="color:rgb(0,128,128);"> 5</span> 
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> guog2009-05-06新增<br></span>
      <span style="color:rgb(0,128,128);"> 6</span> 
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);"> 7</span> 
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="reportViewer"&gt;</span>
      <span style="color:rgb(0,128,0);">ReportViewer控件</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);"> 8</span> 
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;returns&gt;</span>
      <span style="color:rgb(0,128,0);">总物理页数，默认值为0</span>
      <span style="color:rgb(128,128,128);">&lt;/returns&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span>
      <span style="color:rgb(0,128,128);"> 9</span> 
      <span style="color:rgb(128,128,128);"></span> 
      <span style="color:rgb(0,0,255);">public</span> 
      <span style="color:rgb(0,0,255);">static</span> 
      <span style="color:rgb(0,0,255);">int</span> GetTotalPage(ReportViewer reportViewer)
      <br>
      <span style="color:rgb(0,128,128);">10</span> {
      <br>
      <span style="color:rgb(0,128,128);">11</span> 
      <span style="color:rgb(0,0,255);">int</span> result = 
      <span style="color:rgb(128,0,128);">0</span>;
      <br>
      <span style="color:rgb(0,128,128);">12</span> 
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">设置为打印预览模式</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);">13</span> 
      <span style="color:rgb(0,128,0);"></span> reportViewer.SetDisplayMode(DisplayMode.PrintLayout);
      <br>
      <span style="color:rgb(0,128,128);">14</span> 
      <br>
      <span style="color:rgb(0,128,128);">15</span> 
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">记录当前页</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);">16</span> 
      <span style="color:rgb(0,128,0);"></span> 
      <span style="color:rgb(0,0,255);">int</span> currentPage = reportViewer.CurrentPage;
      <br>
      <span style="color:rgb(0,128,128);">17</span> 
      <span style="color:rgb(0,0,255);">if</span> (reportViewer.LocalReport.GetTotalPages() &gt; 
      <span style="color:rgb(128,0,128);">0</span>)
      <br>
      <span style="color:rgb(0,128,128);">18</span> {
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">自带的GetTotalPages()方法返回的是逻辑页面总数，所以这里重新处理</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);">19</span> 
      <span style="color:rgb(0,128,0);"></span> 
      <br>
      <span style="color:rgb(0,128,128);">20</span> 
      <span style="color:rgb(0,0,255);">while</span> (
      <span style="color:rgb(0,0,255);">true</span>)
      <br>
      <span style="color:rgb(0,128,128);">21</span> {
      <br>
      <span style="color:rgb(0,128,128);">22</span> 
      <span style="color:rgb(0,0,255);">try</span>
      <br>
      <span style="color:rgb(0,128,128);">23</span> {
      <br>
      <span style="color:rgb(0,128,128);">24</span> reportViewer.CurrentPage += 
      <span style="color:rgb(128,0,128);">1</span>;
      <br>
      <span style="color:rgb(0,128,128);">25</span> }
      <br>
      <span style="color:rgb(0,128,128);">26</span> 
      <span style="color:rgb(0,0,255);">catch</span>
      <br>
      <span style="color:rgb(0,128,128);">27</span> {
      <br>
      <span style="color:rgb(0,128,128);">28</span> reportViewer.CurrentPage -= 
      <span style="color:rgb(128,0,128);">1</span>;
      <br>
      <span style="color:rgb(0,128,128);">29</span> result = reportViewer.CurrentPage;
      <br>
      <span style="color:rgb(0,128,128);">30</span> 
      <span style="color:rgb(0,0,255);">break</span>;
      <br>
      <span style="color:rgb(0,128,128);">31</span> }
      <br>
      <span style="color:rgb(0,128,128);">32</span> 
      <span style="color:rgb(0,0,255);">finally</span>
      <br>
      <span style="color:rgb(0,128,128);">33</span> {
      <br>
      <span style="color:rgb(0,128,128);">34</span> 
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">指定到原始位置</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(0,128,128);">35</span> 
      <span style="color:rgb(0,128,0);"></span> reportViewer.CurrentPage = currentPage;
      <br>
      <span style="color:rgb(0,128,128);">36</span> }
      <br>
      <span style="color:rgb(0,128,128);">37</span> }
      <br>
      <span style="color:rgb(0,128,128);">38</span> }
      <br>
      <span style="color:rgb(0,128,128);">39</span> 
      <br>
      <span style="color:rgb(0,128,128);">40</span> 
      <span style="color:rgb(0,0,255);">return</span> result;
      <br>
      <span style="color:rgb(0,128,128);">41</span> }
      <br>
      <span style="color:rgb(0,128,128);">42</span> 
      <br>
      <span style="color:rgb(0,128,128);">43</span> 
      <br>
      <span style="color:rgb(0,128,128);">44</span> 
      <span style="color:rgb(0,0,255);">#endregion</span> public static
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy"><img alt="复制代码" src="http://common.cnblogs.com/images/copycode.gif"></span>
     </div> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" alt="" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
    <img class="code_img_opened" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="ExpandedBlockStart.gif">
    <div class="cnblogs_code_hide"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy"><img alt="复制代码" src="http://common.cnblogs.com/images/copycode.gif"></span>
     </div> 
     <div>
      代码
      <br>
      <span style="color:rgb(0,0,255);">using</span> System;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.ComponentModel;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Data;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Drawing;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Text;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Windows.Forms;
      <br>
      <span style="color:rgb(0,0,255);">using</span> yxsoft.emcms.cs.ReportPrintBaseLib;
      <br>
      <span style="color:rgb(0,0,255);">using</span> yxsoft.emcms.common;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Reflection;
      <br>
      <span style="color:rgb(0,0,255);">using</span> Microsoft.Reporting.WinForms;
      <br>
      <span style="color:rgb(0,0,255);">using</span> Guog.Emcms.Win.Business.GeneralDataQuery.VerifyPrintView;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Drawing.Printing;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.IO;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Drawing.Imaging;
      <br>
      <span style="color:rgb(0,0,255);">using</span> System.Xml;
      <br>
      <br>
      <span style="color:rgb(0,0,255);">namespace</span> Guog.Emcms.Win.YXEmcms.Forms
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">public</span> 
      <span style="color:rgb(0,0,255);">partial</span> 
      <span style="color:rgb(0,0,255);">class</span> FrmMeterVerifyPrintView : Form
      <br> {
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 成员变量
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 打印的对象<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> PrintDocument m_printDocument = 
      <span style="color:rgb(0,0,255);">new</span> PrintDocument();
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 页面设置<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> PageSettings m_pageSettings = 
      <span style="color:rgb(0,0,255);">new</span> PageSettings();
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 打印文件流列表<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> IList&lt;Stream&gt; m_streams = 
      <span style="color:rgb(0,0,255);">new</span> List&lt;Stream&gt;();
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 当前呈现的页<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">int</span> m_currentPageIndex = 
      <span style="color:rgb(128,0,128);">0</span>;
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 是否横向打印,true表示横向,false表示纵向<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">bool</span> m_isLandSapce = 
      <span style="color:rgb(0,0,255);">false</span>;
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 打印输出的对象<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> ReportPrintBase m_reportPrintBase = 
      <span style="color:rgb(0,0,255);">null</span>;
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 要打印输出的记录总数<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">int</span> m_chkedCount = 
      <span style="color:rgb(128,0,128);">0</span>;
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 空白页<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">bool</span> m_isBlank = 
      <span style="color:rgb(0,0,255);">true</span>;
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 双面打印<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">bool</span> m_duplex = 
      <span style="color:rgb(0,0,255);">false</span>;
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 成员变量
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 窗体事件
      <br>
      <span style="color:rgb(0,0,255);">public</span> FrmMeterVerifyPrintView(ReportPrintBase reportPrintBase,
      <span style="color:rgb(0,0,255);">int</span> chkedCount)
      <br> {
      <br> InitializeComponent();
      <br>
      <span style="color:rgb(0,0,255);">this</span>.m_chkedCount = chkedCount;
      <br>
      <span style="color:rgb(0,0,255);">this</span>.m_reportPrintBase = reportPrintBase;
      <br>
      <span style="color:rgb(0,0,255);">this</span>.m_isLandSapce=
      <span style="color:rgb(0,0,255);">this</span>.IsLandSapces(
      <span style="color:rgb(0,0,255);">this</span>.m_reportPrintBase.MainReport.ReportFileStream);
      <br>
      <span style="color:rgb(0,0,255);">this</span>.DoubleBuffered = 
      <span style="color:rgb(0,0,255);">true</span>;
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> FrmMeterVerifyPrintView_Load(
      <span style="color:rgb(0,0,255);">object</span> sender, EventArgs e)
      <br> {
      <br> BindPrinters();
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> FrmMeterVerifyPrintView_Shown(
      <span style="color:rgb(0,0,255);">object</span> sender, EventArgs e)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">if</span> (m_reportPrintBase != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp; m_reportPrintBase.MainReport != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp;
      <br> m_reportPrintBase.MainReport.Validate)
      <br> {
      <br> BindReportData(
      <span style="color:rgb(0,0,255);">this</span>.m_reportPrintBase);
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">this</span>.rptView.SetDisplayMode(DisplayMode.PrintLayout);
      <br>
      <span style="color:rgb(0,0,255);">this</span>.rptView.ZoomMode = ZoomMode.PageWidth;
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">this.rptView.ZoomPercent = 100;</span>
      <span style="color:rgb(0,128,0);"><br></span> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 加载报表数据
      <br>
      <br>
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> BindReportData(ReportPrintBase reportPrintBase)
      <br> {
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">报表信息有效</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">if</span> (reportPrintBase != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp; reportPrintBase.MainReport != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp; reportPrintBase.MainReport.Validate)
      <br> {
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">支持的打印类型</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">#region</span> 添加子报表加载事件,向子报表提供数据源支持
      <br>
      <span style="color:rgb(0,0,255);">if</span> (reportPrintBase.subreportProcessingEventHandler != 
      <span style="color:rgb(0,0,255);">null</span>)
      <br> {
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">加载子报表指定的事件,每个子报表加载时通过此事件指向的方法添加对应的数据源</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.rptView.LocalReport.SubreportProcessing += reportPrintBase.subreportProcessingEventHandler;
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 加载子报表事件
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 添加报表
      <br>
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">加载主报表文件流</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.rptView.LocalReport.LoadReportDefinition(reportPrintBase.MainReport.ReportFileStream);
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">添加主报表数据源</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.rptView.LocalReport.DataSources.Add(reportPrintBase.MainReport.DataSource);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (reportPrintBase.SubReports != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp; reportPrintBase.SubReports.Count &gt; 
      <span style="color:rgb(128,0,128);">0</span>)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">foreach</span> (ReportBaseInfo rpt 
      <span style="color:rgb(0,0,255);">in</span> reportPrintBase.SubReports)
      <br> {
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">加载子报表文件流</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.rptView.LocalReport.LoadSubreportDefinition(rpt.Name, rpt.ReportFileStream);
      <br> }
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 添加报表
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">重新呈现(刷新)ReportViewer</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.rptView.RefreshReport();
      <br> }
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">报表信息有效</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 加载报表数据 
      <br>
      <br>
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> FrmMeterVerifyPrintView_FormClosing(
      <span style="color:rgb(0,0,255);">object</span> sender, FormClosingEventArgs e)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">this</span>.rptView.Reset();
      <br> CloseStreams();
      <br> Application.DoEvents();
      <br> }
      <br>
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 关闭当前所有文件流<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> CloseStreams()
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">if</span> (
      <span style="color:rgb(0,0,255);">this</span>.m_streams != 
      <span style="color:rgb(0,0,255);">null</span> &amp;&amp; 
      <span style="color:rgb(0,0,255);">this</span>.m_streams.Count &gt; 
      <span style="color:rgb(128,0,128);">0</span>)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">foreach</span> (Stream s 
      <span style="color:rgb(0,0,255);">in</span> 
      <span style="color:rgb(0,0,255);">this</span>.m_streams)
      <br> {
      <br> s.SetLength(
      <span style="color:rgb(128,0,128);">0</span>);
      <br> s.Flush();
      <br> s.Close();
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">this</span>.m_streams.Clear();
      <br> }
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span>
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 获取所有打印机
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 获取当前安装在计算机上的所有打印机名称<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">public</span> 
      <span style="color:rgb(0,0,255);">static</span> PrinterSettings.StringCollection GetAllPrintNames()
      <br> { 
      <br>
      <span style="color:rgb(0,0,255);">return</span> System.Drawing.Printing.PrinterSettings.InstalledPrinters;
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 获取所有打印机
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 绑定打印机列表
      <br>
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> BindPrinters()
      <br> {
      <br> cmbSelectPrinter.Items.Clear();
      <br> cmbSelectPrinter.DropDownStyle = ComboBoxStyle.DropDownList;
      <br>
      <span style="color:rgb(0,0,255);">string</span> printerName;
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">获取默认打印机</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">string</span> defaultPrinterName = 
      <span style="color:rgb(0,0,255);">this</span>.m_printDocument.PrinterSettings.PrinterName;
      <br>
      <span style="color:rgb(0,0,255);">for</span> (
      <span style="color:rgb(0,0,255);">int</span> i = 
      <span style="color:rgb(128,0,128);">0</span>; i &lt; PrinterSettings.InstalledPrinters.Count; i++)
      <br> {
      <br> printerName = PrinterSettings.InstalledPrinters[i];
      <br> cmbSelectPrinter.Items.Add(printerName);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (printerName == defaultPrinterName)
      <br> {
      <br> cmbSelectPrinter.SelectedIndex = i;
      <br> }
      <br> }
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 绑定打印机列表
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy"><img alt="复制代码" src="http://common.cnblogs.com/images/copycode.gif"></span>
     </div> 
    </div> 
    <span class="cnblogs_code_collapse">View Code</span> 
   </div> 
   <div class="cnblogs_code"> 
    <img class="code_img_closed" alt="" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif">
    <img class="code_img_opened" src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="ExpandedBlockStart.gif">
    <div class="cnblogs_code_hide"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy"><img alt="复制代码" src="http://common.cnblogs.com/images/copycode.gif"></span>
     </div> 
     <div>
      代码
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 打印
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#region</span> 判断是否为横向
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 判断是否为横向<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="stm"&gt;</span>
      <span style="color:rgb(0,128,0);">Rdlc文件流</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;returns&gt;&lt;/returns&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">bool</span> IsLandSapces(Stream stm)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">string</span> strPageWidth = 
      <span style="color:rgb(128,0,0);">""</span>;
      <br>
      <span style="color:rgb(0,0,255);">string</span> strPageHeight = 
      <span style="color:rgb(128,0,0);">""</span>;
      <br> XmlReader xmlReader = XmlReader.Create(stm);
      <br>
      <br>
      <span style="color:rgb(0,0,255);">if</span> (xmlReader.ReadToFollowing(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">PageWidth</span>
      <span style="color:rgb(128,0,0);">"</span>))
      <br> {
      <br> strPageWidth = xmlReader.ReadElementString(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">PageWidth</span>
      <span style="color:rgb(128,0,0);">"</span>);
      <br> }
      <br>
      <br> xmlReader.Close();
      <br>
      <br>
      <span style="color:rgb(0,0,255);">return</span> strPageWidth == 
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">29.7cm</span>
      <span style="color:rgb(128,0,0);">"</span>;
      <br> }
      <br>
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 读取XML文件
      <br>
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 提供 Stream 对象以进行呈现的 CreateStreamCallback 委托指向的方法<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 这里为将报表的每一个页面作为一个EMF图片存放，通常用于报表呈现<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="name"&gt;</span>
      <span style="color:rgb(0,128,0);">流的名称</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="fileNameExtension"&gt;</span>
      <span style="color:rgb(0,128,0);">创建文件流时要使用的文件扩展名</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="encoding"&gt;</span>
      <span style="color:rgb(0,128,0);">指定流的字符编码的 Encoding 枚举器值。如果流不包含字符，则此值可能为 null。</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="mimeType"&gt;</span>
      <span style="color:rgb(0,128,0);">一个包含流的 MIME 类型的 string</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="willSeek"&gt;</span>
      <span style="color:rgb(0,128,0);">指示流是否需要支持查找的 Boolean 值。如果值为 false，则流将为只前推，并将按其创建顺序发送到块区中的客户端。如果值为 true，则流可以任何顺序写入。</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;returns&gt;</span>
      <span style="color:rgb(0,128,0);">ReportViewer 控件可以写入数据的 Stream 对象</span>
      <span style="color:rgb(128,128,128);">&lt;/returns&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> Stream CreateStream(
      <span style="color:rgb(0,0,255);">string</span> name,
      <span style="color:rgb(0,0,255);">string</span> fileNameExtension, Encoding encoding,
      <br>
      <span style="color:rgb(0,0,255);">string</span> mimeType, 
      <span style="color:rgb(0,0,255);">bool</span> willSeek)
      <br> {
      <br> Stream stream = 
      <span style="color:rgb(0,0,255);">new</span> FileStream(Path.GetTempPath() + name +
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">.</span>
      <span style="color:rgb(128,0,0);">"</span> + fileNameExtension, FileMode.Create,FileAccess.ReadWrite,FileShare.ReadWrite);
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">Stream stream = new FileStream(Path.GetTempFileName(), FileMode.Create,FileAccess.ReadWrite,FileShare.ReadWrite,8000,true);</span>
      <span style="color:rgb(0,128,0);"><br></span> m_streams.Add(stream);
      <br>
      <span style="color:rgb(0,0,255);">return</span> stream;
      <br> }
      <br>
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 导出报表的每一个页面到一个EMF文件<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="report"&gt;</span>
      <span style="color:rgb(0,128,0);">ReportViewer.LocalReport</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="pageSettings"&gt;</span>
      <span style="color:rgb(0,128,0);">页面设置</span>
      <span style="color:rgb(128,128,128);">&lt;/param&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> Export(LocalReport report,PageSettings pageSettings)
      <br> {
      <br> StringBuilder sbDeviceInfo = 
      <span style="color:rgb(0,0,255);">new</span> StringBuilder();
      <br>
      <span style="color:rgb(0,0,255);">if</span> (pageSettings != 
      <span style="color:rgb(0,0,255);">null</span>)
      <br> {
      <br> sbDeviceInfo.AppendLine(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">&lt;DeviceInfo&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>);
      <br> sbDeviceInfo.AppendLine(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;OutputFormat&gt;EMF&lt;/OutputFormat&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>);
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;PageWidth&gt;{0}cm&lt;/PageWidth&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.PaperSize.Width)));
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;PageHeight&gt;{0}cm&lt;/PageHeight&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.PaperSize.Height)));
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginTop&gt;{0}cm&lt;/MarginTop&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.Margins.Top)));
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginLeft&gt;{0}cm&lt;/MarginLeft&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.Margins.Left)));
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginRight&gt;{0}cm&lt;/MarginRight&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.Margins.Right)));
      <br> sbDeviceInfo.AppendLine(String.Format(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginBottom&gt;{0}cm&lt;/MarginBottom&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>, FromInchToCM(pageSettings.Margins.Bottom)));
      <br> sbDeviceInfo.AppendLine(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">&lt;/DeviceInfo&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>);
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">string</span> deviceInfo =
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">&lt;DeviceInfo&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;OutputFormat&gt;EMF&lt;/OutputFormat&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;PageWidth&gt;21cm&lt;/PageWidth&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;PageHeight&gt;29.7cm&lt;/PageHeight&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginTop&gt;2.5cm&lt;/MarginTop&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginLeft&gt;2.5cm&lt;/MarginLeft&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginRight&gt;2.5cm&lt;/MarginRight&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);"> &lt;MarginBottom&gt;2.5cm&lt;/MarginBottom&gt;</span>
      <span style="color:rgb(128,0,0);">"</span> +
      <br>
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">&lt;/DeviceInfo&gt;</span>
      <span style="color:rgb(128,0,0);">"</span>;
      <br>
      <br> sbDeviceInfo.AppendLine(deviceInfo);
      <br> }
      <br> Warning[] warnings;
      <br> m_streams = 
      <span style="color:rgb(0,0,255);">new</span> List&lt;Stream&gt;();
      <br> report.Render(
      <span style="color:rgb(128,0,0);">"</span>
      <span style="color:rgb(128,0,0);">Image</span>
      <span style="color:rgb(128,0,0);">"</span>, sbDeviceInfo.ToString(), 
      <span style="color:rgb(0,0,255);">new</span> CreateStreamCallback(CreateStream), 
      <span style="color:rgb(0,0,255);">out</span> warnings);
      <br>
      <span style="color:rgb(0,0,255);">foreach</span> (Stream stream 
      <span style="color:rgb(0,0,255);">in</span> m_streams)
      <br> stream.Position = 
      <span style="color:rgb(128,0,128);">0</span>;
      <br>
      <br> }
      <br>
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 当前页打印的输出<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="sender"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="ev"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> PrintPage(
      <span style="color:rgb(0,0,255);">object</span> sender, PrintPageEventArgs ev)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">if</span> (
      <span style="color:rgb(0,0,255);">this</span>.m_duplex)
      <br> {
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">双面打印</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">#region</span> 双面打印
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">获取每份页数</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">int</span> pagePerCopy = GetPageCountPerCopy(
      <span style="color:rgb(0,0,255);">this</span>.m_streams.Count, 
      <span style="color:rgb(0,0,255);">this</span>.m_chkedCount);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (
      <span style="color:rgb(0,0,255);">this</span>.m_currentPageIndex &gt; 
      <span style="color:rgb(128,0,128);">0</span> &amp;&amp; (
      <span style="color:rgb(0,0,255);">this</span>.m_currentPageIndex + 
      <span style="color:rgb(128,0,128);">1</span>) % pagePerCopy == 
      <span style="color:rgb(128,0,128);">1</span> &amp;&amp; 
      <span style="color:rgb(0,0,255);">this</span>.m_isBlank &amp;&amp; pagePerCopy % 
      <span style="color:rgb(128,0,128);">2</span> != 
      <span style="color:rgb(128,0,128);">0</span>)
      <br> {
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">输出空白页<br></span>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">当前页面不是第一页，且当前页面为此份报表第一页，且每份报表页数为奇数</span>
      <span style="color:rgb(0,128,0);"><br></span> Bitmap emptyImage = 
      <span style="color:rgb(0,0,255);">new</span> Bitmap(
      <span style="color:rgb(128,0,128);">10</span>, 
      <span style="color:rgb(128,0,128);">10</span>);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (ev.PageSettings.Landscape)
      <br> {
      <br> ev.Graphics.DrawImage(emptyImage, 
      <span style="color:rgb(0,0,255);">new</span> Rectangle(
      <span style="color:rgb(128,0,128);">0</span>, 
      <span style="color:rgb(128,0,128);">0</span>, ev.PageBounds.Height, ev.PageBounds.Width));
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <br> ev.Graphics.DrawImage(emptyImage, ev.PageBounds);
      <br> }
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">标记已经打印空白页</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.m_isBlank = 
      <span style="color:rgb(0,0,255);">false</span>;
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <br> Metafile pageImage = 
      <span style="color:rgb(0,0,255);">new</span> Metafile(m_streams[m_currentPageIndex]);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (ev.PageSettings.Landscape)
      <br> {
      <br> ev.Graphics.DrawImage(pageImage, 
      <span style="color:rgb(0,0,255);">new</span> Rectangle(
      <span style="color:rgb(128,0,128);">0</span>, 
      <span style="color:rgb(128,0,128);">0</span>, ev.PageBounds.Height, ev.PageBounds.Width));
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <br> ev.Graphics.DrawImage(pageImage, ev.PageBounds);
      <br> }
      <br> m_currentPageIndex++;
      <br>
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">标记等待打印下一个空白页</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">this</span>.m_isBlank = 
      <span style="color:rgb(0,0,255);">true</span>;
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 双面打印
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <span style="color:rgb(0,128,0);">//</span>
      <span style="color:rgb(0,128,0);">单面打印</span>
      <span style="color:rgb(0,128,0);"><br></span> 
      <span style="color:rgb(0,0,255);">#region</span> 单面打印
      <br> Metafile pageImage = 
      <span style="color:rgb(0,0,255);">new</span> Metafile(m_streams[m_currentPageIndex]);
      <br>
      <span style="color:rgb(0,0,255);">if</span> (ev.PageSettings.Landscape)
      <br> {
      <br> ev.Graphics.DrawImage(pageImage, 
      <span style="color:rgb(0,0,255);">new</span> Rectangle(
      <span style="color:rgb(128,0,128);">0</span>, 
      <span style="color:rgb(128,0,128);">0</span>, ev.PageBounds.Height, ev.PageBounds.Width));
      <br> }
      <br>
      <span style="color:rgb(0,0,255);">else</span>
      <br> {
      <br> ev.Graphics.DrawImage(pageImage, ev.PageBounds);
      <br> }
      <br> m_currentPageIndex++;
      <br>
      <span style="color:rgb(0,0,255);">#endregion</span> 单面打印
      <br> }
      <br> ev.HasMorePages = (m_currentPageIndex &lt; m_streams.Count);
      <br> }
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 打印开始<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="sender"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="e"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> BeginPrint(
      <span style="color:rgb(0,0,255);">object</span> sender, PrintEventArgs e)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">this</span>.btnPrint.Enabled = 
      <span style="color:rgb(0,0,255);">false</span>;
      <br> }
      <br>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> 打印结束<br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;/summary&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="sender"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(0,128,0);"><br></span>
      <span style="color:rgb(128,128,128);">///</span>
      <span style="color:rgb(0,128,0);"> </span>
      <span style="color:rgb(128,128,128);">&lt;param name="e"&gt;&lt;/param&gt;</span>
      <span style="color:rgb(128,128,128);"><br></span> 
      <span style="color:rgb(0,0,255);">private</span> 
      <span style="color:rgb(0,0,255);">void</span> EndPrint(
      <span style="color:rgb(0,0,255);">object</span> sender, PrintEventArgs e)
      <br> {
      <br>
      <span style="color:rgb(0,0,255);">this</span>.btnPrint.Enabled = 
      <span style="color:rgb(0,0,255);">true</span>;
      <br> }
     </div> 
     <div>
      <br>
     </div> 
     <div>
      <br>
     </div> 
     <div>
      <br>
     </div> 
     <div>
      本文转自94cool博客园博客，原文链接：http://www.cnblogs.com/94cool/p/4276956.html，如需转载请自行联系原作者
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
