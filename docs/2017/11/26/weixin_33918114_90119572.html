<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>【译】微型ORM：PetaPoco « NotBeCN</title>
  <meta name="description" content="                             PetaPoco是一款适用于.Net 和Mono的微小、快速、单文件的微型ORM。     PetaPoco有以下特色：          微小，没有依赖项……单个的C#文件可以方便的添加到任何项目中。      工作于严格的没有装饰的Poco类，和几乎全...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/26/weixin_33918114_90119572.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">【译】微型ORM：PetaPoco</h1>
    <p class="post-meta">Nov 26, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div>
    <br>
   </div> 
   <div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco是一款适用于.Net 和Mono的微小、快速、单文件的微型ORM。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco有以下特色：</p> 
    <ul style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:disc;">微小，没有依赖项……单个的C#文件可以方便的添加到任何项目中。</li> 
     <li style="list-style:disc;">工作于严格的没有装饰的Poco类，和几乎全部加了特性的Poco类</li> 
     <li style="list-style:disc;"><span>Insert/Delete/Update/Save and IsNew 等帮助方法。</span></li> 
     <li style="list-style:disc;"><span>分页支持：自动得到总行数和数据</span></li> 
     <li style="list-style:disc;"><span>支持简单的事务</span></li> 
     <li style="list-style:disc;"><span>更好的支持参数替换，包括从对象属性中抓取命名的参数。</span></li> 
     <li style="list-style:disc;"><span>很好的性能，剔除了Linq，并通过Dynamic方法快速的为属性赋值</span></li> 
     <li style="list-style:disc;"><span>T4模板自动生成Poco类</span></li> 
     <li style="list-style:disc;"><span>查询语言是Sql……不支持别扭的fluent或Linq语法（仁者见仁，智者见智）</span></li> 
     <li style="list-style:disc;"><span>包含一个低耦合的Sql Builder类，让内联的Sql更容易书写</span></li> 
     <li style="list-style:disc;"><span>为异常信息记录、值转换器安装和数据映射提供钩子。（<span>Hooks for logging exceptions, installing value converters and mapping columns to properties without attributes.</span>）</span></li> 
     <li style="list-style:disc;"><span>兼容SQL Server, SQL Server CE, MySQL, PostgreSQL and Oracle。</span></li> 
     <li style="list-style:disc;"><span>可以在.NET 3.5 或Mono 2.6或更高版本上运行</span></li> 
     <li style="list-style:disc;"><span>在.NET 4.0 和Mono 2.8下支持dynamic</span></li> 
     <li style="list-style:disc;"><span>NUnit单元测试</span></li> 
     <li style="list-style:disc;"><span>开源（Apache License）</span></li> 
     <li style="list-style:disc;"><span>所有功能大约用了1500行代码</span></li> 
    </ul>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">可以从这里获得PetaPoco：</h3> 
    <ul style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:disc;">NuGet -&nbsp;<a href="http://nuget.org/List/Packages/PetaPoco" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">http://nuget.org/List/Packages/PetaPoco</a> </li> 
     <li style="list-style:disc;">GitHub -&nbsp;<a href="https://github.com/toptensoftware/petapoco" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">https://github.com/toptensoftware/petapoco</a> </li> 
    </ul>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>&nbsp;</span></p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">代码展示：</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>首先，定义一个Poco类：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Represents a record in the "articles" table</span>
<span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> article
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> article_id { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> title { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime date_created { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span> draft { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> content { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>接下来，创建一个PetaPoco.Database，来执行查询：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Create a PetaPoco database object</span>
<span style="color:rgb(0,0,255);line-height:1.5;">var</span> db=<span style="color:rgb(0,0,255);line-height:1.5;">new</span> PetaPoco.Database(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">connectionStringName</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Show all articles    </span>
<span style="color:rgb(0,0,255);line-height:1.5;">foreach</span> (<span style="color:rgb(0,0,255);line-height:1.5;">var</span> a <span style="color:rgb(0,0,255);line-height:1.5;">in</span> db.Query&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT * FROM articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">))
{
    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">{0} - {1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, a.article_id, a.title);
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">得到一个<span>scalar：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">long</span> count=db.ExecuteScalar&lt;<span style="color:rgb(0,0,255);line-height:1.5;">long</span>&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT Count(*) FROM articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">得到一行记录：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> a = db.SingleOrDefault&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT * FROM articles WHERE article_id=@0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);line-height:1.5;">123</span>));</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">获取分页数据：</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco能够自动完成分页请求</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> result=db.Page&lt;article&gt;(<span style="color:rgb(128,0,128);line-height:1.5;">1</span>, <span style="color:rgb(128,0,128);line-height:1.5;">20</span>, <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> &lt;-- page number and items per page</span>
        <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT * FROM articles WHERE category=@0 ORDER BY date_posted DESC</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">coolstuff</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">你将会得到一个PagedFetch对象：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> Page&lt;T&gt; <span style="color:rgb(0,0,255);line-height:1.5;">where</span> T:<span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;">()
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> CurrentPage { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> ItemsPerPage { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> TotalPages { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> TotalItems { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> List&lt;T&gt; Items { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco在背后为我们做了一下处理：</p> 
    <ol style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:decimal;">生成并执行一个查询，得到匹配的数据行数</li> 
     <li style="list-style:decimal;">修改原始的查询语句，使其只得到所有匹配数据的一个子集</li> 
    </ol>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">你现在已经拥有了一个展示单页数据的一切东西和一个分页控制器，他们被封装在一个现成的小对象中。（<span>You now have everything to display a page of data and a pager control all wrapped up in one handy little object!</span>）</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">Query vs Fetch</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">Database 对象有两个获取数据的方法：Query 和Fetch。这两个方法非常相似，不同的是Fetch方法返回一个POCO类的List&lt;&gt;，而Query使用&nbsp;<code>yield return</code>&nbsp;迭代所有数据，这些数据并没有加载到内存中。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>&nbsp;</span></p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><span>不带查询的命令</span></h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>使用Execute 方法执行一个不带查询的命令：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>db.Execute(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">DELETE FROM articles WHERE draft&lt;&gt;0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">Inserts、Updates 和 Deletes</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco提供了insert、update和delete操作的帮助。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">在插入一条记录时，你需要指定插入的表名和主键：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Create the article</span>
<span style="color:rgb(0,0,255);line-height:1.5;">var</span> a=<span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> article();
a.title</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">My new article</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
a.content</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">PetaPoco was here</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
a.date_created</span>=<span style="line-height:1.5;">DateTime.UtcNow;

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Insert it</span>
db.Insert(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, a);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> by now a.article_id will have the id of the new article</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">更新记录也一样：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Get a record</span>
<span style="color:rgb(0,0,255);line-height:1.5;">var</span> a=db.SingleOrDefault&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT * FROM articles WHERE article_id=@0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);line-height:1.5;">123</span><span style="line-height:1.5;">);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Change it</span>
a.content=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">PetaPoco was here again</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Save it</span>
db.Update(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, a);</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">或者你可以传一个匿名类来更新一部分字段。下面的代码只更新article的title字段：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>db.Update(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(0,0,255);line-height:1.5;">new</span> { title=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">New title</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> }, <span style="color:rgb(128,0,128);line-height:1.5;">123</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>删除：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Delete an article extracting the primary key from a record</span>
db.Delete(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, a);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Or if you already have the ID elsewhere</span>
db.Delete(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, <span style="color:rgb(128,0,128);line-height:1.5;">123</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">修饰POCO类</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;"><span>在上面的例子中，必须指明表名和主键是很烦人的，你可以在你的Poco类中附加这些信息：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Represents a record in the "articles" table</span>
[PetaPoco.TableName(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
[PetaPoco.PrimaryKey(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> article
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> article_id { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> title { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime date_created { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span> draft { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> content { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">简化后的insert、update、delete：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Insert a record</span>
<span style="color:rgb(0,0,255);line-height:1.5;">var</span> a=<span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> article();
a.title</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">My new article</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
a.content</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">PetaPoco was here</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
a.date_created</span>=<span style="line-height:1.5;">DateTime.UtcNow;
db.Insert(a);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Update it</span>
a.content=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Blah blah</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
db.Update(a);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Delete it</span>
db.Delete(a);</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">delete和update的其它方式</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Delete an article</span>
db.Delete&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">WHERE article_id=@0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);line-height:1.5;">123</span><span style="line-height:1.5;">);

</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Update an article</span>
db.Update&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SET title=@0 WHERE article_id=@1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">New Title</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);line-height:1.5;">123</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">你还可以告诉POCO忽略某列</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> article
{
    [PetaPoco.Ignore]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span><span style="line-height:1.5;"> SomeCalculatedFieldPerhaps
    { 
        </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; 
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">或许你喜欢一点更详细的描述。和自动映射所有列相比，你可以通过使用类和列的属性来指明哪些列需要映射。</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Represents a record in the "articles" table</span>
[PetaPoco.TableName(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">articles</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
[PetaPoco.PrimaryKey(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">article_id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
[PetaPoco.ExplicitColumns]
public class article
{
    [PetaPoco.Column]publiclong article_id { </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}
    [PetaPoco.Column]publicstring title { </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}
    [PetaPoco.Column]publicDateTime date_created { </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}
    [PetaPoco.Column]</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span> draft { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}
    [PetaPoco.Column]publicstring content { </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}
}</span>&nbsp;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">它可以结合partial class 很好的工作，把需要绑定的字段放在一个.cs文件中，把计算得到的和别的有用的属性添加到分开的文件中，而不用去考虑DAL。</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">Hey！是不是已经有装饰POCO数据库的标准属性了呢？</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">好吧，PetaPoco仅支持少数几个，因为我不想引起混乱。</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">Hey！稍等……它们不是POCO对象了！</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">当然，它们打破了严格的POCO概念，但使用它们可以让POCO更容易工作。</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">T4 模板</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">Writing all those POCO objects can soon get tedious and error prone... so PetaPoco includes a&nbsp;<a href="http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">T4 template</a>&nbsp;that can automatically write classes for all the tables in your your SQL Server, SQL Server CE, MySQL, PostgreSQL or Oracle database.</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">Using the T4 template is pretty simple. The git repository includes three files (The NuGet package adds these to your project automatically in the folder&nbsp;<code>\Models\Generated</code>).</p> 
    <ul style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:disc;">PetaPoco.Core.ttinclude - includes all the helper routines for reading the DB schema</li> 
     <li style="list-style:disc;">PetaPoco.Generator.ttinclude - the actual template that defines what's generated</li> 
     <li style="list-style:disc;">Database.tt - the template itself that includes various settings and includes the two other ttinclude files.</li> 
    </ul>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">A typical Database.tt file looks like this:</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="pun">&lt;</span><span class="com">#@ include file="PetaPoco.Core.ttinclude" #&gt;</span><span class="pln"><br></span><span class="pun">&lt;</span><span class="com">#</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="com">// Settings</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="typ">ConnectionStringName</span><span class="pun">=</span><span class="str">"jab"</span><span class="pun">;</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="typ">Namespace</span><span class="pun">=</span><span class="typ">ConnectionStringName</span><span class="pun">;</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="typ">DatabaseName</span><span class="pun">=</span><span class="typ">ConnectionStringName</span><span class="pun">;</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="kwd">string</span><span class="typ">RepoName</span><span class="pun">=</span><span class="typ">DatabaseName</span><span class="pun">+</span><span class="str">"DB"</span><span class="pun">;</span><span class="pln"><br> &nbsp; &nbsp; bool </span><span class="typ">GenerateOperations</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">;</span><span class="pln"><br><br> &nbsp; &nbsp; </span><span class="com">// Load tables</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> tables </span><span class="pun">=</span><span class="typ">LoadTables</span><span class="pun">();</span><span class="pln"><br><br></span><span class="com">#&gt;</span><span class="pln"><br></span><span class="pun">&lt;</span><span class="com">#@ include file="PetaPoco.Generator.ttinclude" #&gt;</span><span class="pln"><br></span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">To use the template:</p> 
    <ol style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:decimal;">Add the three files to you C# project</li> 
     <li style="list-style:decimal;">Make sure you have a connection string and provider name set in your app.config or web.config file</li> 
     <li style="list-style:decimal;">Edit ConnectionStringName property in Records.tt (ie: change it from "jab" to the name of your connection string)</li> 
     <li style="list-style:decimal;">Save Database.tt.</li> 
    </ol>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">All going well Database.cs should be generated with POCO objects representing all the tables in your database. To get the project to build you'll also need to add PetaPoco.cs to your project and ensure it is set to compile (NuGet does this for you) .</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">The template is based on the&nbsp;<a href="http://subsonicproject.com/" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">SubSonic</a>&nbsp;template. If you're familiar with its ActiveRecord templates you'll find PetaPoco's template very similar.</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">自动的Select语句</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">当使用PetaPoco时，大多数查询都以"SELECT * FROM table"开头。鉴于我们现在可以从POCO对象的attribute中得到表名，我们没有理由不自动生成Select语句。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">如果你运行一个不以select开头的查询， PetaPoco会自动的将它加上：</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"></code></pre> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Get a record</span>
<span style="color:rgb(0,0,255);line-height:1.5;">var</span> a=db.SingleOrDefault&lt;article&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SELECT * FROM articles WHERE article_id=@0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,128);line-height:1.5;">123</span>);</pre>
    </div> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">可以简写：</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="com">// Get a record</span><span class="pln"><br></span><span class="kwd">var</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">db</span><span class="pun">.</span><span class="typ">SingleOrDefault</span><span class="str">&lt;article&gt;</span><span class="pun">(</span><span class="str">"WHERE article_id=@0"</span><span class="pun">,</span><span class="lit">123</span><span class="pun">);</span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco实际上并不生成"SELECT *"，它更准确的得到要查询的列名。</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">IsNew 和Save 方法</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">有时你有一个POCO，你想要知道数据库中是否已经存在。因为我们有主键，我们所要做的检查是该属性被设置为别的值还是默认值。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">检测是否为新增:</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="com">// Is this a new record </span><span class="pln"><br></span><span class="kwd">if</span><span class="pun">(</span><span class="pln">db</span><span class="pun">.</span><span class="typ">IsNew</span><span class="pun">(</span><span class="pln">a</span><span class="pun">))</span><span class="pln"><br></span><span class="pun">{</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="com">// Yes it is...</span><span class="pln"><br></span><span class="pun">}</span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">和它相关联还有一个Save方法，它将根据判断的结果执行Insert或Update。</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="com">// Save a new or existing record</span><span class="pln"><br> db</span><span class="pun">.</span><span class="typ">Save</span><span class="pun">(</span><span class="pln">a</span><span class="pun">);</span><span class="pln"><br></span></code></pre> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">事务</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">事务相当的简单:</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="pln">using </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> scope</span><span class="pun">=</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Transaction</span><span class="pun">)</span><span class="pln"><br></span><span class="pun">{</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="com">// Do transacted updates here</span><span class="pln"><br><br> &nbsp; &nbsp; </span><span class="com">// Commit</span><span class="pln"><br> &nbsp; &nbsp; scope</span><span class="pun">.</span><span class="typ">Complete</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">事务可以是嵌套的，因此你可以调用其它包含事务的方法，或者被包含在单个的事务中。当所有事务都执行完成了，事务将会提交，否则所有操作都将回滚。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">注意：为了使用事务，所有操作都需要相同的PetaPoco Database对象实例。你很可能想到IOC容器中为在每一个http请求或每一个线程共享同一个实体，我喜欢用<a href="http://structuremap.net/" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">StructureMap</a>。</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">Linq从哪儿实现？</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">没有任何支持。我在Subsonic中使用Linq很长时间，我发现自己下降到使用<a href="http://subsonicproject.com/docs/CodingHorror" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">CodingHorror</a>&nbsp;来做这些事情，因为：</p> 
    <ul style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:disc;">&nbsp;不能用简单的Linq实现</li> 
     <li style="list-style:disc;">&nbsp;在.NET 下工作，但不支持Mono（尤其是Mono 2.6）</li> 
     <li style="list-style:disc;">低效。例如：Subsonic 中activerecord.SingleOrDefault(x=x.id==123)的效率比CodingHorror 低20倍。</li> 
    </ul>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">&nbsp;</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">Now that I've got CodingHorror all over the place it bugs me that half the code is Linq and half is SQL.</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">Also, I've realized that for me the most annoying thing about SQL directly in the code is not the fact that it's SQL but that it's nasty to format nicely and to build up those SQL strings.</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">So...</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">PetaPoco's SQL Builder</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">目前已经有很多构建SQL的API，以下是我的版本，它确实很基础！</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">我的目标是格式化SQL更简单，并且通过适当的参数替换达到防止SQL注入的作用。这不能保证SQL语法的正确，也不支持使用intellisense。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">以下是非常基础的写法：</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="kwd">var</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">123</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">var</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Query</span><span class="str">&lt;article&gt;</span><span class="pun">(</span><span class="typ">PetaPoco</span><span class="pun">.</span><span class="typ">Sql</span><span class="pun">.</span><span class="typ">Builder</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"SELECT * FROM articles"</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"WHERE article_id=@0"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"><br></span><span class="pun">)</span><span class="pln"><br></span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">很管用吧，参数索引器来通过调用.Append是多么酷啊！【Big deal right? Well what's cool about this is that the parameter indicies are specific to each&nbsp;<code>.Append</code>&nbsp;call:】</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="kwd">var</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">123</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">var</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Query</span><span class="str">&lt;article&gt;</span><span class="pun">(</span><span class="typ">PetaPoco</span><span class="pun">.</span><span class="typ">Sql</span><span class="pun">.</span><span class="typ">Builder</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"SELECT * FROM articles"</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"WHERE article_id=@0"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"AND date_created&lt;@0"</span><span class="pun">,</span><span class="typ">DateTime</span><span class="pun">.</span><span class="typ">UtcNow</span><span class="pun">)</span><span class="pln"><br></span><span class="pun">)</span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">你也可以根据条件构建SQL：</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="kwd">var</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">123</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">var</span><span class="pln"> sql</span><span class="pun">=</span><span class="typ">PetaPoco</span><span class="pun">.</span><span class="typ">Sql</span><span class="pun">.</span><span class="typ">Builder</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"SELECT * FROM articles"</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"WHERE article_id=@0"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">);</span><span class="pln"><br><br></span><span class="kwd">if</span><span class="pun">(</span><span class="pln">start_date</span><span class="pun">.</span><span class="typ">HasValue</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; sql</span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"AND date_created&gt;=@0"</span><span class="pun">,</span><span class="pln"> start_date</span><span class="pun">.</span><span class="typ">Value</span><span class="pun">);</span><span class="pln"><br><br></span><span class="kwd">if</span><span class="pun">(</span><span class="pln">end_date</span><span class="pun">.</span><span class="typ">HasValue</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; sql</span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"AND date_created&lt;=@0"</span><span class="pun">,</span><span class="pln"> end_date</span><span class="pun">.</span><span class="typ">Value</span><span class="pun">);</span><span class="pln"><br><br></span><span class="kwd">var</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">db</span><span class="pun">.</span><span class="typ">Query</span><span class="str">&lt;article&gt;</span><span class="pun">(</span><span class="pln">sql</span><span class="pun">)</span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">注意到每个append调用都用到餐厨@0了吗？PetaPoco构建整个列表的参数，将这些参数索引更新到内部。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">你也可以使用命名参数，然后他会在传递的参数中找到合适的属性名。</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="pln">sql</span><span class="pun">.</span><span class="typ">Append</span><span class="pun">(</span><span class="str">"AND date_created&gt;=@start AND date_created&lt;=@end"</span><span class="pun">,</span><span class="pln"> <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">new</span><span class="pln"> <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">{</span><span class="pln"> <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start</span><span class="pun">=</span><span class="typ">DateTime</span><span class="pun">.</span><span class="typ">UtcNow</span><span class="pun">.</span><span class="typ">AddDays</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">),</span><span class="pln"> <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end</span><span class="pun">=</span><span class="typ">DateTime</span><span class="pun">.</span><span class="typ">UtcNow</span><span class="pln"> <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">);</span></code></pre> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">不管是数字的还是命名的参数，如果任何一个参数不能被推断出来，都会抛出一个异常。</p> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">这里还有几个创建SQL的公用方法：</p> 
    <pre class="prettyprint lang-cs"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="kwd">var</span><span class="pln"> sql</span><span class="pun">=</span><span class="typ">PetaPoco</span><span class="pun">.</span><span class="typ">Sql</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span><span class="pln"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Select</span><span class="pun">(</span><span class="str">"*"</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">From</span><span class="pun">(</span><span class="str">"articles"</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">Where</span><span class="pun">(</span><span class="str">"date_created &lt; @0"</span><span class="pun">,</span><span class="typ">DateTime</span><span class="pun">.</span><span class="typ">UtcNow</span><span class="pun">)</span><span class="pln"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="typ">OrderBy</span><span class="pun">(</span><span class="str">"date_created DESC"</span><span class="pun">);</span><span class="pln"><br></span></code></pre> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">跟踪Sql命令</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">有些时候能够看到执行的Sql语句会非常有用，PetaPoco为此提供了三个属性：</p> 
    <ul style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">
     <li style="list-style:disc;">LastSQL - 非常明显，不解释</li> 
     <li style="list-style:disc;">LastArgs - 传递的参数数组</li> 
     <li style="list-style:disc;">LastCommand - SQL语句和参数字符串</li> 
    </ul>
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">在调试器中查看LastCommand属性能够简单的看到执行了那些操作！</p> 
    <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">OnException Handler Routine</h3> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">PetaPoco所执行的Sql命令都封装在try/catch语句块中，所有的异常信息都会传递给OnException虚方法。通过记录这些异常（或在这个方法中设置断点），你可以轻松的跟踪那些地方出现了问题。</p> 
    <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">More</h2> 
    <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13.3333px;">上面的内容展示了最基本的PetaPoco使用方法，想了解更多，请<a href="http://www.toptensoftware.com/Categories/PetaPoco" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">查看这些博客内容</a>。</p> 
    <p><font color="#333333"><span style="font-size:13.3333px;"><br></span></font></p> 
    <p><font color="#333333"><span style="font-size:13.3333px;"><br></span></font></p> 
    <p><font color="#333333"><span style="font-size:13.3333px;"><br></span></font></p> 
    <p><font color="#333333"><span style="font-size:13.3333px;">本文转自齐师傅博客园博客，原文链接：http://www.cnblogs.com/youring2/archive/2012/06/04/2532130.html，如需转载请自行联系原作者</span></font></p> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
