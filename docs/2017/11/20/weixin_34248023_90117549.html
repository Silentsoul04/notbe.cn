<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ES练习代码 « NotBeCN</title>
  <meta name="description" content="             &nbsp;&nbsp;                         1 package elasticsearch;  2   3 import java.util.HashMap;  4 import java.util.List;  5 import java.util.Map...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/20/weixin_34248023_90117549.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">ES练习代码</h1>
    <p class="post-meta">Nov 20, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> elasticsearch;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  2</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  3</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.HashMap;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  4</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.List;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  5</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.Map;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  6</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  7</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.bulk.BulkItemResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  8</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.bulk.BulkRequestBuilder;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  9</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.bulk.BulkResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 10</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.delete.DeleteRequest;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 11</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.delete.DeleteResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 12</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.deletebyquery.DeleteByQueryResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 13</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.get.GetResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 14</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.index.IndexRequest;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 15</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.index.IndexResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 16</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.search.SearchResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 17</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.search.SearchType;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 18</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.action.update.UpdateResponse;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 19</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.client.transport.TransportClient;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 20</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.cluster.node.DiscoveryNode;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 21</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.collect.ImmutableList;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 22</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.settings.ImmutableSettings;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 23</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.settings.Settings;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 24</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.text.Text;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 25</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.transport.InetSocketTransportAddress;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 26</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.transport.TransportAddress;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 27</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.xcontent.XContentBuilder;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 28</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.common.xcontent.XContentFactory;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 29</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.index.query.QueryBuilders;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 30</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.SearchHit;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 31</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.SearchHits;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 32</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.aggregations.AggregationBuilders;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 33</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.aggregations.bucket.terms.Terms;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 34</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.aggregations.bucket.terms.Terms.Bucket;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 35</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.aggregations.metrics.sum.Sum;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 36</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.highlight.HighlightField;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 37</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.elasticsearch.search.sort.SortOrder;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 38</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.junit.Before;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 39</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.junit.Test;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 40</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 41</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> com.fasterxml.jackson.databind.ObjectMapper;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 42</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 43</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> TestEs {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 44</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 45</span>     TransportClient transportClient = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> TransportClient();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 46</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">before表示在执行每个test方法之前运行</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 47</span> <span style="font-size:12px;line-height:1.5;">    @Before
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 48</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test0() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 49</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定es集群中的节点信息</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 50</span>         TransportAddress transportAddress = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> InetSocketTransportAddress("192.168.1.99",9300<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 51</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">TransportAddress transportAddress1 = new InetSocketTransportAddress("192.168.1.98",9300);</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 52</span> <span style="font-size:12px;line-height:1.5;">        transportClient.addTransportAddresses(transportAddress);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 53</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 54</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 55</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 56</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 通过java代码操作es-1
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 57</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 在实际工作中这样写不是很靠谱,需要完善,做测试可以
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 58</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 59</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 60</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 61</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test1() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 62</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">通过TransportClient可以和es集群交互
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 63</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">TransportClient transportClient = new TransportClient();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 64</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 65</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定es集群中的节点信息, 这个地方指定的端口是节点和节点之间的通信端口是9300,不是Http请求的端口9200.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 66</span>         TransportAddress transportAddress = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> InetSocketTransportAddress("192.168.1.99",9300<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 67</span>         TransportAddress transportAddress1 = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> InetSocketTransportAddress("192.168.1.98",9300<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 68</span>         transportClient.addTransportAddresses(transportAddress,transportAddress1);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">加入多个地址
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 69</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 70</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取当前transportClient连接到了集群多少个节点</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 71</span>         ImmutableList&lt;DiscoveryNode&gt; connectedNodes =<span style="font-size:12px;line-height:1.5;"> transportClient.connectedNodes();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 72</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (DiscoveryNode discoveryNode : connectedNodes) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 73</span>             System.out.println(discoveryNode.getHostAddress());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">打印192.168.1.99;192.168.1.98
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 74</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">如果加入transportClient.addTransportAddresses(transportAddress)  只有一个ip,打印的就只有一个.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 75</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 76</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 77</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 78</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 79</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 80</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 81</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 通过java代码操作es-2
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 82</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 实际工作中使用的时候建议加上下面这些配置信息
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 83</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 84</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 85</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 86</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test2() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 87</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定es的配置信息   Immutable不可改变的;</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 88</span>         Settings settings =<span style="font-size:12px;line-height:1.5;"> ImmutableSettings.settingsBuilder()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 89</span>                 .put("cluster.name", "elasticsearch")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">如果集群名称在配置文件中被修改了，那么在这需要显式定义一下
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 90</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">es集群名称默认是 elasticsearch  sniff嗅; 发现;</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 91</span>                 .put("client.transport.sniff", <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span>)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">开启集群的嗅探功能，这样可以保证es会自动把集群中的其他节点信息添加到transportClient里面
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 92</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">开启嗅探功能后 只要指定集群中的任意一个可用节点就可以了.当把代码运行之后TransportClient里面会把集群中所有节点的信息都拿到,能识别集群中的所有节点.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 93</span> <span style="font-size:12px;line-height:1.5;">                .build();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 94</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 95</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">通过TransportClient可以和es集群交互</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 96</span>         TransportClient transportClient = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> TransportClient(settings);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 97</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定es集群中的节点信息</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 98</span>         TransportAddress transportAddress = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> InetSocketTransportAddress("192.168.1.99",9300<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 99</span> <span style="font-size:12px;line-height:1.5;">        transportClient.addTransportAddresses(transportAddress);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">100</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">101</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取当前transportClient连接到了集群多少个节点</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">102</span>         ImmutableList&lt;DiscoveryNode&gt; connectedNodes =<span style="font-size:12px;line-height:1.5;"> transportClient.connectedNodes();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">103</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (DiscoveryNode discoveryNode : connectedNodes) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">104</span>             System.out.println(discoveryNode.getHostAddress()); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">虽然前面只指定了1.99 但是打印192.168.1.99  192.168.1.98</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">105</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">106</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">107</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">108</span>     String index = "crxy"<span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">109</span>     String type = "emp"<span style="font-size:12px;line-height:1.5;">;    
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">110</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">111</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * index-1
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">112</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">113</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">114</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">115</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test3() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">116</span>         String jsonStr = "{\"name\":\"zs\",\"age\":20}";<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">向索引库中传入一个String字符串,还可以接受其他类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">117</span>         IndexResponse indexResponse = transportClient.prepareIndex(index, type, "7")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">添加一个id=7的数据</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">118</span> <span style="font-size:12px;line-height:1.5;">                            .setSource(jsonStr)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">119</span>                             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.execute().actionGet();   这个和下面的get()方法是一样的,get()就是对.execute().actionGet() 进行了封装</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">120</span>                             .get();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">执行</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">121</span>         System.out.println(indexResponse.getVersion());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">得到这个数据的version,如果version=1代表是新添加的数据</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">122</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">123</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">124</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">125</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * index-2
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">126</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 实际工作中使用
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">127</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">128</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">129</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">130</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test4() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> Exception {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">把hashmap类型的数据放入index库</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">131</span>         HashMap&lt;String, Object&gt; hashMap = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> HashMap&lt;String, Object&gt;<span style="font-size:12px;line-height:1.5;">();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">132</span>         hashMap.put("name", "heeh"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">133</span>         hashMap.put("age", 20<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">134</span>         IndexResponse indexResponse = transportClient.prepareIndex(index, type, "8"<span style="font-size:12px;line-height:1.5;">).setSource(hashMap).get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">135</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(indexResponse.getVersion());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">136</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">137</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">138</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">139</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * index -3
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">140</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 实际工作中使用
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">141</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 使用对象的时候需要把对象中的属性转化成json字符串
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">142</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">143</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * &lt;dependency&gt;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">144</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">145</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">146</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">            &lt;version&gt;2.1.3&lt;/version&gt;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">147</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        &lt;/dependency&gt;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">148</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">149</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">150</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">151</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test5() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> Exception {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">传入一个对象到index索引库</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">152</span>         Person person = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Person();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">153</span>         person.setName("lisi"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">154</span>         person.setAge(30<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">155</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">156</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">如果直接传入一个person对象会报错,java.lang.IllegalArgumentException,必须把对象转换成一个Json字符串,使用jackson依赖
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">157</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">IndexResponse indexResponse = transportClient.prepareIndex(index, type, "9").setSource(person).get();</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">158</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">159</span>         ObjectMapper objectMapper = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> ObjectMapper();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">160</span>         IndexResponse indexResponse = transportClient.prepareIndex(index, type, "9"<span style="font-size:12px;line-height:1.5;">).setSource(objectMapper.writeValueAsString(person)).get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">161</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(indexResponse.getVersion());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">162</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">163</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">164</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">165</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * index -4
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">166</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 测试数据这样使用
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">167</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">168</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">169</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">170</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test6() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">171</span>         XContentBuilder builder = XContentFactory.jsonBuilder()<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">XContentFactory 这个是ES官方提供的可以构建Json字符串的工具类.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">172</span>                 .startObject()<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">{</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">173</span>                 .field("name", "zs"<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">174</span>                 .field("age", 18<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">175</span>                 .endObject();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">}</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">176</span>         IndexResponse indexResponse = transportClient.prepareIndex(index, type, "11"<span style="font-size:12px;line-height:1.5;">).setSource(builder).get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">177</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(indexResponse.getVersion());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">178</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">179</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">180</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">181</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">182</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">183</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 查询 通过id
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">184</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">185</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">186</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">187</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test7() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">188</span>         GetResponse getResponse = transportClient.prepareGet(index, type, "9").get();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">查询id为9的数据</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">189</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(getResponse.getSourceAsString());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">190</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">191</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">192</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">193</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 局部更新
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">194</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">195</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">196</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">197</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test8() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">198</span>         XContentBuilder builder = XContentFactory.jsonBuilder().startObject().field("age", 19<span style="font-size:12px;line-height:1.5;">).endObject();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">199</span>         UpdateResponse updateResponse = transportClient.prepareUpdate(index, type, "9"<span style="font-size:12px;line-height:1.5;">).setDoc(builder).get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">200</span>         System.out.println(updateResponse.getVersion());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">version打印2 数据更新</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">201</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">202</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">203</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">204</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 删除-通过id删除
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">205</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">206</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">207</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">208</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test9() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">209</span>         DeleteResponse deleteResponse = transportClient.prepareDelete(index, type, "5").get();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">删除比较简单</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">210</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">211</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">212</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">213</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 求总数
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">214</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 类似于mysql中的select count(*)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">215</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">216</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">217</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">218</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test10() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> Exception {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">查找索引库中的数据个数</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">219</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> count =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareCount(index).get().getCount();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">220</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(count);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">221</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">222</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">223</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">224</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">225</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 批量操作 bulk
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">226</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">227</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">228</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">229</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test11() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">230</span>         BulkRequestBuilder bulkBuilder =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareBulk();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">231</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">232</span>         IndexRequest indexRequest = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> IndexRequest(index, type, "12"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">233</span>         XContentBuilder builder = XContentFactory.jsonBuilder().startObject().field("name", "haha").field("age", 18<span style="font-size:12px;line-height:1.5;">).endObject();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">234</span> <span style="font-size:12px;line-height:1.5;">        indexRequest.source(builder);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">235</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">236</span>         DeleteRequest deleteRequest = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> DeleteRequest(index, type, "13"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">237</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">238</span>         bulkBuilder.add(indexRequest);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">bulkBuilder中可以添加多个操作,这里一个是建立索引的操作,一个是删除的操作.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">239</span> <span style="font-size:12px;line-height:1.5;">        bulkBuilder.add(deleteRequest);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">240</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">241</span>         BulkResponse bulkResponse =<span style="font-size:12px;line-height:1.5;"> bulkBuilder.get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">242</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(bulkResponse.hasFailures()){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">批量操作中可能有的操作会出现问题,这个地方对操作失败的处理
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">243</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取所有错误信息，并打印</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">244</span>             BulkItemResponse[] items =<span style="font-size:12px;line-height:1.5;"> bulkResponse.getItems();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">245</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (BulkItemResponse bulkItemResponse : items) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">246</span> <span style="font-size:12px;line-height:1.5;">                System.out.println(bulkItemResponse.getFailureMessage());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">247</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">248</span>         }<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;">{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">249</span>             System.out.println("全部OK"<span style="font-size:12px;line-height:1.5;">);    
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">250</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">251</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">252</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">253</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">254</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">255</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">256</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 查询
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">257</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * lt:小于
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">258</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * lte:小于等于
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">259</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * gt:大于
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">260</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * gte:大于等于
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">261</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">262</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">263</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">264</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">265</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test12() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">266</span>         SearchResponse searchResponse = transportClient.prepareSearch(index)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定索引库</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">267</span>             .setTypes(type)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">268</span>             .setQuery(QueryBuilders.matchQuery("name", "zs"))<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定查询条件,不支持通配符
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">269</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setQuery(QueryBuilders.multiMatchQuery("zs", "name","title"))</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">根据多个属性进行查询
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">270</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setQuery(QueryBuilders.matchAllQuery())</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">查询所有
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">271</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setQuery(QueryBuilders.queryString("name:z* AND age:20"))</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">支持通配符* ?，可以实现复杂查询，可以使用AND OR 之类的运算符(运算符要大写)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">272</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setQuery(QueryBuilders.termQuery("name", "zs"))</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">在查询的时候不分词，主要针对 人名 地名等特殊的词语
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">273</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">工作中没有说明特殊需求，就是用默认的查询类型，如果对搜索准确度要求非常高，建议使用DFS_QUERY_THEN_FETCH,如果只追求查询效果，对其他的指标不关心，可以使用QUERY_AND_FETCH</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">274</span>             .setSearchType(SearchType.QUERY_THEN_FETCH)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定查询类型，可以指定四种</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">275</span>             .setExplain(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span>)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">返回的数据按照搜索词的相关度排序
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">276</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">分页参数</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">277</span>             .setFrom(0<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">278</span>             .setSize(10<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">279</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">根据某一个字段排序</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">280</span>             .addSort("age"<span style="font-size:12px;line-height:1.5;">,SortOrder.DESC)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">281</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">过滤
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">282</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setPostFilter(FilterBuilders.rangeFilter("age").from(0).to(18).includeLower(true).includeUpper(false))</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">默认是闭区间
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">283</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setPostFilter(FilterBuilders.rangeFilter("age").gt(0).lt(18))
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">284</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">实现高亮</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">285</span>             .addHighlightedField("name")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设置高亮字段</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">286</span>             .setHighlighterPreTags("&lt;font color='red'&gt;")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设置高亮前缀和后缀</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">287</span>             .setHighlighterPostTags("&lt;/font&gt;"<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">288</span> <span style="font-size:12px;line-height:1.5;">            .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">289</span>         SearchHits hits =<span style="font-size:12px;line-height:1.5;"> searchResponse.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">290</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> totalHits =<span style="font-size:12px;line-height:1.5;"> hits.getTotalHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">291</span>         System.out.println("总数："+<span style="font-size:12px;line-height:1.5;">totalHits);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">292</span>         SearchHit[] hits2 =<span style="font-size:12px;line-height:1.5;"> hits.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">293</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (SearchHit searchHit : hits2) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">294</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取高亮内容</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">295</span>             Map&lt;String, HighlightField&gt; highlightFields =<span style="font-size:12px;line-height:1.5;"> searchHit.getHighlightFields();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">296</span>             HighlightField highlightField = highlightFields.get("name"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">297</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(highlightField!=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">298</span>                 String name_h = ""<span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">299</span>                 Text[] fragments =<span style="font-size:12px;line-height:1.5;"> highlightField.fragments();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">300</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (Text text : fragments) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">301</span>                     name_h+=<span style="font-size:12px;line-height:1.5;">text;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">302</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">303</span>                 System.out.println("高亮内容："+<span style="font-size:12px;line-height:1.5;">name_h);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">304</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">305</span> <span style="font-size:12px;line-height:1.5;">            System.out.println(searchHit.getSourceAsString());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">306</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">307</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">308</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">309</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">ES是一个分布式是搜索引擎,天生就是为分布式而生的,但是分布式有优点,也是有缺点.
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">310</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">一个索引库crxy的数据分布到了5个分片,去哪个分片去查,由于是分布式,可能每个分片中都有数据,所以一定要到所有分片中去查找.</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">311</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">312</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">313</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">314</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">315</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 根据查询条件删除数据
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">316</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">317</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">318</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">319</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test13() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">320</span>         DeleteByQueryResponse deleteByQueryResponse =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareDeleteByQuery(index)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">321</span> <span style="font-size:12px;line-height:1.5;">                .setQuery(QueryBuilders.matchAllQuery())
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">322</span> <span style="font-size:12px;line-height:1.5;">                .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">323</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">324</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">325</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">326</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">327</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 统计分析-count
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">328</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 根据年龄进行分组，统计相同年龄的数据有多少条
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">329</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">330</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 默认情况下，如果分组个数大于10条的话，默认只会返回前10条分组数据
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">331</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 如果想获取所有分组数据，或者想要获取指定数量的分组数据，如何实现呢？
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">332</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     *     .size(0)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">333</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">334</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">335</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">336</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">337</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test14() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">338</span>         SearchResponse searchResponse =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareSearch(index)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">339</span> <span style="font-size:12px;line-height:1.5;">            .setTypes(type)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">340</span>             .addAggregation(AggregationBuilders.terms("age_term").field("age").size(0))<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">给分组起个名称，并且指定分组字段</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">341</span> <span style="font-size:12px;line-height:1.5;">            .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">342</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">343</span>         Terms terms = searchResponse.getAggregations().get("age_term");<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定分组的名字.
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">344</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取分组数据</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">345</span>         List&lt;Bucket&gt; buckets =<span style="font-size:12px;line-height:1.5;"> terms.getBuckets();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">346</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (Bucket bucket : buckets) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">347</span>             System.out.println(bucket.getKey()+"----"+<span style="font-size:12px;line-height:1.5;">bucket.getDocCount());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">348</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">349</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">350</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">打印
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">351</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     21----3
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">352</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     18----2
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">353</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     19----1
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">354</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     20----1
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">355</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">356</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">357</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">358</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">359</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 统计分析-sum   select name,sum(score) from table group by name;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">360</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 需要使用.subAggregation
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">361</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">362</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">363</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">364</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         使用数据:
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">365</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        #aggregations-2
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">366</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        curl -XPUT 'localhost:9200/crxy/emp/1' -d'{"name":"zs","score":60}'
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">367</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        curl -XPUT 'localhost:9200/crxy/emp/2' -d'{"name":"zs","score":90}'
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">368</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        curl -XPUT 'localhost:9200/crxy/emp/3' -d'{"name":"ls","score":80}'
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">369</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        curl -XPUT 'localhost:9200/crxy/emp/4' -d'{"name":"ls","score":70}'
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">370</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">371</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">372</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test15() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">373</span>         SearchResponse searchResponse =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareSearch(index)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">374</span> <span style="font-size:12px;line-height:1.5;">            .setTypes(type)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">375</span>             .addAggregation(AggregationBuilders.terms("name_term").field("name")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定分组字段</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">376</span>                     .subAggregation(AggregationBuilders.sum("score_sum").field("score")))<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定求sum的字段</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">377</span> <span style="font-size:12px;line-height:1.5;">            .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">378</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">379</span>         Terms terms = searchResponse.getAggregations().get("name_term"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">380</span>         List&lt;Bucket&gt; buckets =<span style="font-size:12px;line-height:1.5;"> terms.getBuckets();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">381</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (Bucket bucket : buckets) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">382</span>             Sum sum = bucket.getAggregations().get("score_sum"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">383</span>             System.out.println(bucket.getKey()+"----"+<span style="font-size:12px;line-height:1.5;">sum.getValue());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">384</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">385</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">386</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">387</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 打印输出
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">388</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        ls----150.0
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">389</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        zs----150.0
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">390</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">391</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">392</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">393</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">394</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 指定分片查询(_shards),指定某个节点(_only_node)和某些节点(自定义的_only_nodes)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">395</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">396</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">397</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">398</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test16() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">399</span>         SearchResponse searchResponse =<span style="font-size:12px;line-height:1.5;"> transportClient.prepareSearch(index)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">400</span> <span style="font-size:12px;line-height:1.5;">                .setTypes(type)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">401</span> <span style="font-size:12px;line-height:1.5;">                .setQuery(QueryBuilders.matchAllQuery())
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">402</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setPreference("_shards:0,2") </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setPreference("_local")   .setPreference("")</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">403</span>                 .setPreference("_only_node:8PoWbRVvQQ6NU283Bfd_7A,BJwexRvDTJ-VRx7Njs8uxA")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">8PoWbRVvQQ6NU283Bfd_7A是一个节点的id</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">404</span> <span style="font-size:12px;line-height:1.5;">                .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">405</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">406</span>         SearchHits hits =<span style="font-size:12px;line-height:1.5;"> searchResponse.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">407</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> totalHits =<span style="font-size:12px;line-height:1.5;"> hits.getTotalHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">408</span>         System.out.println("总数："+<span style="font-size:12px;line-height:1.5;">totalHits);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">409</span>         SearchHit[] hits2 =<span style="font-size:12px;line-height:1.5;"> hits.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">410</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (SearchHit searchHit : hits2) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">411</span> <span style="font-size:12px;line-height:1.5;">            System.out.println(searchHit.getSourceAsString());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">412</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">413</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">414</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">415</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test16() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>         SearchResponse searchResponse = transportClient.prepareSearch("crxy*"<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span> <span style="font-size:12px;line-height:1.5;">                .setTypes(type)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span> <span style="font-size:12px;line-height:1.5;">                .setQuery(QueryBuilders.matchAllQuery())
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">查询指定分片的数据可以使用下面这两种方案，第一种直接指定分片id，第二种根据routing参数的值计算分片id
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setPreference("_shards:0")
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">.setRouting("hehe")</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span> <span style="font-size:12px;line-height:1.5;">                .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>         SearchHits hits =<span style="font-size:12px;line-height:1.5;"> searchResponse.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> totalHits =<span style="font-size:12px;line-height:1.5;"> hits.getTotalHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span>         System.out.println("总数："+<span style="font-size:12px;line-height:1.5;">totalHits);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span>         SearchHit[] hits2 =<span style="font-size:12px;line-height:1.5;"> hits.getHits();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (SearchHit searchHit : hits2) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span> <span style="font-size:12px;line-height:1.5;">            System.out.println(searchHit.getSourceAsString());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span> <span style="font-size:12px;line-height:1.5;">    @Test
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">22</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> test17() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">23</span>         HashMap&lt;String, Object&gt; hashMap = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> HashMap&lt;String, Object&gt;<span style="font-size:12px;line-height:1.5;">();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">24</span>         hashMap.put("name", "hello world"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">25</span>         hashMap.put("age", 20<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">26</span>         IndexResponse indexResponse = transportClient.prepareIndex(index, type, "7"<span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">27</span> <span style="font-size:12px;line-height:1.5;">                .setSource(hashMap)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">28</span>                 .setRouting("heha")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">指定一个路由参数，参数相同的数据会保存到同一个分片</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">29</span> <span style="font-size:12px;line-height:1.5;">                .get();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">30</span> <span style="font-size:12px;line-height:1.5;">        System.out.println(indexResponse.getVersion());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">31</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">32</span>     </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font><span style="font-size:14px;">本文转自SummerChill博客园博客，原文链接：http://www.cnblogs.com/DreamDrive/p/6072478.html，如需转载请自行联系原作者</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
