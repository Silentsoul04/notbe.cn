<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hadoop MapReduce编程 API入门系列之自定义多种输入格式数据类型和排序多种输出格式（十一）... « NotBeCN</title>
  <meta name="description" content="             &nbsp;&nbsp; &nbsp;自定义输入格式，将明星微博数据排序后按粉丝数 关注数 微博数 分别输出到不同文件中。    &nbsp;                                    &nbsp;    &nbsp;    &nbsp;    &nbsp; ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/20/weixin_33892359_90120931.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Hadoop MapReduce编程 API入门系列之自定义多种输入格式数据类型和排序多种输出格式（十一）...</h1>
    <p class="post-meta">Nov 20, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp; &nbsp;自定义输入格式，将明星微博数据<strong>排序后</strong>按粉丝数 关注数 微博数 分别输出到不同文件中。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212144058729-119845219.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212143901761-382551034.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212143909761-1809017023.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212143925933-1500095456.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212143936292-1213212267.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212143951417-1308951362.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212144000573-1769363719.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212144033448-572845921.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201612/855959-20161212144153464-601005004.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<strong style="color:rgb(0,0,255);font-size:18pt;">代码</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> zhouls.bigdata.myMapReduce.ScoreCount;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  2</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  3</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.DataInput;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  4</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.DataOutput;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  5</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.IOException;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  6</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.io.WritableComparable;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  7</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  8</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">* 学习成绩读写类
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  9</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">* 数据格式参考：19020090017 小讲 90 99 100 89 95
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 10</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">* </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@author</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Bertron
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 11</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">* 需要自定义一个 ScoreWritable 类实现 WritableComparable 接口，将学生各门成绩封装起来。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 12</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 13</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> ScoreWritable <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span> WritableComparable&lt; Object &gt; {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">其实这里，跟TVPlayData一样的
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 14</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">  注意：    Hadoop通过Writable接口实现的序列化机制，不过没有提供比较功能，所以和java中的Comparable接口合并，提供一个接口WritableComparable。（自定义比较）
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 15</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         Writable接口提供两个方法(write和readFields)。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 16</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 17</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 18</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> Chinese;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 19</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 20</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 21</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 22</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 23</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 24</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 25</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    问：这里我们自己编程时，是一定要创建一个带有参的构造方法，为什么还要显式的写出来一个带无参的构造方法呢？
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 26</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    答：构造器其实就是构造对象实例的方法，无参数的构造方法是默认的，但是如果你创造了一个带有参数的构造方法，那么无参的构造方法必须显式的写出来，否则会编译失败。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 27</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 28</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> ScoreWritable(){}<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">java里的无参构造函数，是用来在创建对象时初始化对象  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 29</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">在hadoop的每个自定义类型代码里，好比，现在的ScoreWritable，都必须要写无参构造函数。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 30</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 31</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 32</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">问：为什么我们在编程的时候，需要创建一个带有参的构造方法？
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 33</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">答:就是能让赋值更灵活。构造一般就是初始化数值，你不想别人用你这个类的时候每次实例化都能用另一个构造动态初始化一些信息么(当然没有需要额外赋值就用默认的)。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 34</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 35</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> ScoreWritable(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Chinese,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Math,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> English,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Physics,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Chemistry){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">java里的有参构造函数,是用来在创建对象时初始化对象  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 36</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chinese =<span style="font-size:12px;line-height:1.5;"> Chinese;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 37</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Math =<span style="font-size:12px;line-height:1.5;"> Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 38</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.English =<span style="font-size:12px;line-height:1.5;"> English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 39</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Physics =<span style="font-size:12px;line-height:1.5;"> Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 40</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chemistry =<span style="font-size:12px;line-height:1.5;"> Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 41</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 42</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 43</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">问：其实set和get方法，这两个方法只是类中的setxxx和getxxx方法的总称，
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 44</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    那么，为什么在编程时，有set和set***两个，只有get***一个呢？</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 45</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 46</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> set(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Chinese,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Math,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> English,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Physics,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span><span style="font-size:12px;line-height:1.5;"> Chemistry){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 47</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chinese = Chinese;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">即float Chinese赋值给private float Chinese;</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 48</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Math =<span style="font-size:12px;line-height:1.5;"> Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 49</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.English =<span style="font-size:12px;line-height:1.5;"> English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 50</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Physics =<span style="font-size:12px;line-height:1.5;"> Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 51</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chemistry =<span style="font-size:12px;line-height:1.5;"> Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 52</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 53</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    public float get(float Chinese,float Math,float English,float Physics,float Chemistry){因为这是错误的，所以对于set可以分开，get只能是get***
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 54</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        return Chinese;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 55</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        return Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 56</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        return English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 57</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        return Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 58</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        return Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 59</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    }</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 60</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 61</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 62</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getChinese() {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值，得返回，所以需有返回类型float</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 63</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> Chinese;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 64</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 65</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setChinese(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Chinese){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设值，不需，所以空返回类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 66</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chinese =<span style="font-size:12px;line-height:1.5;"> Chinese;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 67</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 68</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getMath() {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 69</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 70</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 71</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setMath(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Math){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 72</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Math =<span style="font-size:12px;line-height:1.5;"> Math;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 73</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 74</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getEnglish() {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 75</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 76</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 77</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setEnglish(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> English){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 78</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.English =<span style="font-size:12px;line-height:1.5;"> English;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 79</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 80</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getPhysics() {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 81</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 82</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 83</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setPhysics(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Physics){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 84</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Physics =<span style="font-size:12px;line-height:1.5;"> Physics;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 85</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 86</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getChemistry() {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 87</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 88</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 89</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setChemistry(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> Chemistry) {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 90</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.Chemistry =<span style="font-size:12px;line-height:1.5;"> Chemistry;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 91</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 92</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 93</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 实现WritableComparable的readFields()方法
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 94</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    对象不能传输的，需要转化成字节流！
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 95</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    将对象转换为字节流并写入到输出流out中是序列化，write 的过程（最好记!!!）
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 96</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    从输入流in中读取字节流反序列化为对象      是反序列化，readFields的过程（最好记!!!）</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 97</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> readFields(DataInput in) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿代码来说的话，对象就是比如Chinese、Math。。。。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 98</span>         Chinese = in.readFloat();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">因为，我们这里的对象是float类型，所以是readFloat()</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 99</span>         Math =<span style="font-size:12px;line-height:1.5;"> in.readFloat();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">100</span>         English = in.readFloat();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">注意:反序列化里，需要生成对象对吧，所以，是用到的是get那边对象</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">101</span>         Physics =<span style="font-size:12px;line-height:1.5;"> in.readFloat();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">102</span>         Chemistry =<span style="font-size:12px;line-height:1.5;"> in.readFloat();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">103</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readByte()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">104</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readChar()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">105</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readDouble()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">106</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readLine() 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">107</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readFloat()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">108</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readLong()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">109</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        in.readShort()</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">110</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">111</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">112</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 实现WritableComparable的write()方法，以便该数据能被序列化后完成网络传输或文件输出 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">113</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    将对象转换为字节流并写入到输出流out中是序列化，write 的过程（最好记!!!）
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">114</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    从输入流in中读取字节流反序列化为对象      是反序列化，readFields的过程（最好记!!!）</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">115</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> write(DataOutput out) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">拿代码来说的话，对象就是比如Chinese、Math。。。。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">116</span>         out.writeFloat(Chinese);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">因为，我们这里的对象是float类型，所以是writeFloat()</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">117</span> <span style="font-size:12px;line-height:1.5;">        out.writeFloat(Math);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">118</span>         out.writeFloat(English);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">注意:序列化里，需要对象对吧，所以，用到的是set那边的对象</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">119</span> <span style="font-size:12px;line-height:1.5;">        out.writeFloat(Physics);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">120</span> <span style="font-size:12px;line-height:1.5;">        out.writeFloat(Chemistry);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">121</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeByte()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">122</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeChar()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">123</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeDouble()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">124</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeFloat()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">125</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeLong()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">126</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeShort()
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">127</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        out.writeUTF()</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">128</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">129</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">130</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> compareTo(Object o) {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">java里的比较，Java String.compareTo()</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">131</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> 0<span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">132</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">133</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">134</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">135</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    Hadoop中定义了两个序列化相关的接口：Writable 接口和 Comparable 接口，这两个接口可以合并成一个接口 WritableComparable。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">136</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    Writable 接口中定义了两个方法，分别为write(DataOutput out)和readFields(DataInput in)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">137</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    所有实现了Comparable接口的对象都可以和自身相同类型的对象比较大小
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">138</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">139</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">140</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    Hadoop中定义了两个序列化相关的接口：Writable 接口和 Comparable 接口，这两个接口可以合并成一个接口 WritableComparable。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">141</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    Writable 接口中定义了两个方法，分别为write(DataOutput out)和readFields(DataInput in)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">142</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    所有实现了Comparable接口的对象都可以和自身相同类型的对象比较大小
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">143</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">144</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">145</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">  源码是
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">146</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    package java.lang;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">147</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    import java.util.*;      
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">148</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    public interface Comparable {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">149</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        /** 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">150</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        * 将this对象和对象o进行比较，约定：返回负数为小于，零为大于，整数为大于 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">151</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        */  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">152</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        public int compareTo(T o);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">153</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    }</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">154</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">155</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> zhouls.bigdata.myMapReduce.WeiboCount;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  2</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  3</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.IOException;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  4</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  5</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.conf.Configuration;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  6</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.fs.FSDataInputStream;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  7</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.fs.FileSystem;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  8</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.fs.Path;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  9</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.io.Text;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 10</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.InputSplit;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 11</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.JobContext;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 12</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.RecordReader;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 13</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.TaskAttemptContext;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 14</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 15</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.input.FileSplit;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 16</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.util.LineReader;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 17</span> <span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 19</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 20</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 21</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">其实这个程序，就是在实现InputFormat接口，TVPlayInputFormat是InputFormat接口的实现类
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 22</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">比如   WeiboInputFormat  extends FileInputFormat implements InputFormat。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 23</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 24</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">问：自定义输入格式 WeiboInputFormat 类，首先继承 FileInputFormat，然后分别重写 isSplitable() 方法和 createRecordReader() 方法。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 25</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 26</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 27</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> WeiboInputFormat <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span> FileInputFormat&lt;Text,WeiBo&gt;<span style="font-size:12px;line-height:1.5;">{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 28</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 29</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    线路是： boolean  isSplitable()   -&gt;   RecordReader&lt;Text,WeiBo&gt; createRecordReader()   -&gt;   WeiboRecordReader extends RecordReader&lt;Text, WeiBo &gt; </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 30</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 31</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 32</span> <span style="font-size:12px;line-height:1.5;">    @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 33</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span> isSplitable(JobContext context, Path filename) {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">这是InputFormat的isSplitable方法
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 34</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">isSplitable方法就是是否要切分文件，这个方法显示如果是压缩文件就不切分，非压缩文件就切分。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 35</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        如果不允许分割，则isSplitable==false，则将第一个block、文件目录、开始位置为0，长度为整个文件的长度封装到一个InputSplit，加入splits中
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 36</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        如果文件长度不为0且支持分割，则isSplitable==true,获取block大小，默认是64MB</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 37</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span>;    <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">整个文件封装到一个InputSplit
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 38</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">要么就是return true;        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">切分64MB大小的一块一块，再封装到InputSplit</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 39</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 40</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 41</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 42</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 43</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 44</span> <span style="font-size:12px;line-height:1.5;">     @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 45</span>      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> RecordReader&lt;Text, WeiBo&gt; createRecordReader(InputSplit arg0,TaskAttemptContext arg1) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException, InterruptedException{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 46</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         RecordReader&lt;k1, v1&gt;是返回类型,返回的RecordReader对象的封装
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 47</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         createRecordReader是方法,在这里是，WeiboInputFormat.createRecordReader。WeiboInputFormat是InputFormat类的实例
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 48</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         InputSplit input和TaskAttemptContext context是传入参数
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 49</span>          
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 50</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         isSplitable(),如果是压缩文件就不切分，整个文件封装到一个InputSplit
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 51</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         isSplitable(),如果是非压缩文件就切，切分64MB大小的一块一块，再封装到InputSplit
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 52</span>          
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 53</span>          <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">这里默认是系统实现的的RecordReader，按行读取，下面我们自定义这个类WeiboRecordReader。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 54</span>          <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">类似与Excel、WeiBo、TVPlayData代码写法</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 55</span>           <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> WeiboRecordReader();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">新建一个ScoreRecordReader实例，所有才有了上面RecordReader&lt;Text,ScoreWritable&gt;，所以才如下ScoreRecordReader，写我们自己的</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 56</span> <span style="font-size:12px;line-height:1.5;">     }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 57</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 58</span>      
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 59</span>      
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 60</span>      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> WeiboRecordReader <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span> RecordReader&lt;Text, WeiBo&gt;<span style="font-size:12px;line-height:1.5;">{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 61</span>              <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">LineReader      in是1，行号。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 62</span>              <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">Text line;      俞灏明    俞灏明    10591367    206    558，每行的相关记录</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 63</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> LineReader in;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">行读取器</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 64</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> Text line;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">每行数据类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 65</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> Text lineKey;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义key类型，即k1</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 66</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> WeiBo lineValue;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义value类型，即v1</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 67</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 68</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 69</span> <span style="font-size:12px;line-height:1.5;">             @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 70</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> close() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">关闭输入流</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 71</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(in !=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 72</span> <span style="font-size:12px;line-height:1.5;">                        in.close();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 73</span> <span style="font-size:12px;line-height:1.5;">                    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 74</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 75</span> <span style="font-size:12px;line-height:1.5;">                @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 76</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> Text getCurrentKey() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException, InterruptedException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取当前的key,即CurrentKey</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 77</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> lineKey;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">返回类型是Text,即Text lineKey</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 78</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 79</span> <span style="font-size:12px;line-height:1.5;">                @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 80</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> WeiBo getCurrentValue() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException,InterruptedException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取当前的Value，即CurrentValue</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 81</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> lineValue;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">返回类型是WeiBo,即WeiBo lineValue</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 82</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 83</span> <span style="font-size:12px;line-height:1.5;">                @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 84</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">float</span> getProgress() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException, InterruptedException {<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取进程，即Progress</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 85</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> 0;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">返回类型是float,即float 0</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 86</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 87</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 88</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 89</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 90</span> <span style="font-size:12px;line-height:1.5;">            @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 91</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> initialize(InputSplit input, TaskAttemptContext context)<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException, InterruptedException{<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">初始化，都是模板</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 92</span>                 FileSplit split=(FileSplit)input;<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">获取split   </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 93</span>                 Configuration job=<span style="font-size:12px;line-height:1.5;">context.getConfiguration();  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 94</span>                 Path file=split.getPath();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">得到文件路径     </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 95</span>                 FileSystem fs=<span style="font-size:12px;line-height:1.5;">file.getFileSystem(job); 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 96</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 97</span>                 FSDataInputStream filein=fs.open(file);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">打开文件   </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 98</span>                 in=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> LineReader(filein,job); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">输入流in</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 99</span>                 line=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">每行数据类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">100</span>                 lineKey=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义key类型，即k1。</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">新建一个Text实例作为自定义格式输入的key</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">101</span>                 lineValue = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> WeiBo();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义value类型，即v1。</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">新建一个TVPlayData实例作为自定义格式输入的value</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">102</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">103</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">104</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">105</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">此方法读取每行数据，完成自定义的key和value</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">106</span> <span style="font-size:12px;line-height:1.5;">            @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">107</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span> nextKeyValue() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span> IOException, InterruptedException{<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">这里面，才是篡改的重点</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">108</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> linesize=in.readLine(line); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">line是每行数据，我们这里用到的是in.readLine(str)这个构造函数，默认读完读到文件末尾。其实这里有三种。
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">109</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">110</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              是SplitLineReader.readLine  -&gt;  SplitLineReader  extends   LineReader  -&gt;  org.apache.hadoop.util.LineReader
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">111</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">112</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              in.readLine(str)</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">这个构造方法执行时，会首先将value原来的值清空。默认读完读到文件末尾
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">113</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              in.readLine(str, maxLineLength)</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">只读到maxLineLength行
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">114</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              in.readLine(str, maxLineLength, maxBytesToConsume)</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">这个构造方法来实现不清空，前面读取的行的值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">115</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">116</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">117</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(linesize==0)  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">; 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">118</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">119</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">通过分隔符'\t'，将每行的数据解析成数组 pieces</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">120</span>                 String[] pieces = line.toString().split("\t"<span style="font-size:12px;line-height:1.5;">); 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">121</span>                     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">因为，我们这里是。默认读完读到文件末尾。line是Text类型。pieces是String[]，即String数组。</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">122</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">123</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(pieces.length != 5<span style="font-size:12px;line-height:1.5;">){  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">124</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> IOException("Invalid record received"<span style="font-size:12px;line-height:1.5;">);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">125</span> <span style="font-size:12px;line-height:1.5;">                } 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">126</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">127</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> a,b,c;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">128</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">129</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">try</span><span style="font-size:12px;line-height:1.5;">{  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">130</span>                     a = Integer.parseInt(pieces[2].trim());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">粉丝,</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">将String类型，如pieces[2]转换成，float类型，给a  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">131</span>                     b = Integer.parseInt(pieces[3].trim());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">关注</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">132</span>                     c = Integer.parseInt(pieces[4].trim());<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">微博数</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">133</span>                 }<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">catch</span><span style="font-size:12px;line-height:1.5;">(NumberFormatException nfe)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">134</span> <span style="font-size:12px;line-height:1.5;">                {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">135</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> IOException("Error parsing floating poing value in record"<span style="font-size:12px;line-height:1.5;">);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">136</span> <span style="font-size:12px;line-height:1.5;">                } 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">137</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">138</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">139</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义key和value值</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">140</span>                 lineKey.set(pieces[0]); <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">完成自定义key数据 </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">141</span>                 lineValue.set(b, a, c);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">完成自定义value数据
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">142</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              或者写
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">143</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">              lineValue.set(Integer.parseInt(pieces[2].trim()),Integer.parseInt(pieces[3].trim()),Integer.parseInt(pieces[4].trim()));
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">144</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">145</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">146</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                pieces[0]   pieces[1] pieces[2]  ... pieces[4]
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">147</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                俞灏明    俞灏明    10591367    206    558
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">148</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                李敏镐    李敏镐    22898071    11    268
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">149</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                大自然保护协会-马云    大自然保护协会-马云    15616866    0    39
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">150</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                林心如    林心如    57488649    214    5940
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">151</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                时尚小编Anne    时尚小编Anne    10064227    136    2103
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">152</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                黄晓明    黄晓明    22616497    506    2011
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">153</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                张靓颖    张靓颖    27878708    238    3846
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">154</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                张成龙2012    张成龙2012    9813621    199    744
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">155</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                吳君如大美女    吳君如大美女    18490338    190    412
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">156</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                李娜    李娜    23309493    81    631
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">157</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                徐小平    徐小平    11659926    1929    13795
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">158</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                唐嫣    唐嫣    24301532    200    2391
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">159</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                有斐君    有斐君    8779383    577    4251</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">160</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">161</span>                 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">162</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">163</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">164</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">165</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">166</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">167</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">168</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> zhouls.bigdata.myMapReduce.WeiboCount;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  2</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  3</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.IOException;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  4</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.Arrays;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  5</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.Comparator;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  6</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.HashMap;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  7</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.Set;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  8</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.util.Map;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">  9</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 10</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.conf.Configuration;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 11</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.conf.Configured;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 12</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.fs.FileSystem;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 13</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.fs.Path;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 14</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 15</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.io.IntWritable;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 16</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.io.Text;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 17</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.Job;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 18</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.Mapper;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 19</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.Reducer;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 20</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 21</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 22</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.output.MultipleOutputs;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 23</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.mapreduce.lib.output.TextOutputFormat;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 24</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.util.Tool;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 25</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.hadoop.util.ToolRunner;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 26</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 27</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> WeiboCount <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span> Configured <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span><span style="font-size:12px;line-height:1.5;"> Tool{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 28</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> WeiBoMapper <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span> Mapper&lt;Text, WeiBo, Text, Text&gt;<span style="font-size:12px;line-height:1.5;">{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 29</span> <span style="font-size:12px;line-height:1.5;">        @Override
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 30</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> map(Text key, WeiBo value, Context context) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException, InterruptedException{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 31</span>             context.write(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text("follower"),<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text(key.toString() + "\t" +<span style="font-size:12px;line-height:1.5;"> value.getFollowers()));
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 32</span>             context.write(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text("friend"),<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text(key.toString() + "\t" +<span style="font-size:12px;line-height:1.5;"> value.getFriends()));
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 33</span>             context.write(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text("statuses"),<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Text(key.toString() + "\t" +<span style="font-size:12px;line-height:1.5;"> value.getStatuses()));
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 34</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 35</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 36</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 37</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> WeiBoReducer <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span> Reducer&lt;Text, Text, Text, IntWritable&gt;<span style="font-size:12px;line-height:1.5;"> {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 38</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> MultipleOutputs&lt;Text, IntWritable&gt;<span style="font-size:12px;line-height:1.5;"> mos;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 39</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 40</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setup(Context context) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException,InterruptedException{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 41</span>             mos = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> MultipleOutputs&lt;Text, IntWritable&gt;<span style="font-size:12px;line-height:1.5;">(context);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 42</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 43</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 44</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> Text text = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Text();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 45</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 46</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> reduce(Text Key, Iterable&lt;Text&gt; Values,Context context) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException, InterruptedException{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 47</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> N = context.getConfiguration().getInt("reduceHasMaxLength"<span style="font-size:12px;line-height:1.5;">, Integer.MAX_VALUE);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 48</span>             Map&lt;String,Integer&gt; m = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> HashMap&lt;String,Integer&gt;<span style="font-size:12px;line-height:1.5;">();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 49</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span>(Text value:Values){<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">星型for循环，意思是把Values的值传给Text value
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 50</span>                 <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">value=名称+(粉丝数 或 关注数 或 微博数)</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 51</span>                 String[] records = value.toString().split("\t"<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 52</span>                 m.put(records[0],Integer.parseInt(records[1<span style="font-size:12px;line-height:1.5;">].toString()));
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 53</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 54</span>             
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 55</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">对Map内的数据进行排序</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 56</span>             Map.Entry&lt;String, Integer&gt;[] entries =<span style="font-size:12px;line-height:1.5;"> getSortedHashtableByValue(m);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 57</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> i = 0; i&lt; N  &amp;&amp;  i&lt; entries.length;i++<span style="font-size:12px;line-height:1.5;">){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 58</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(Key.toString().equals("follower"<span style="font-size:12px;line-height:1.5;">)){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 59</span>                     mos.write("follower"<span style="font-size:12px;line-height:1.5;">,entries[i].getKey(), entries[i].getValue());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 60</span>                 }<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(Key.toString().equals("friend"<span style="font-size:12px;line-height:1.5;">)){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 61</span>                     mos.write("friend"<span style="font-size:12px;line-height:1.5;">, entries[i].getKey(), entries[i].getValue());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 62</span>                 }<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(Key.toString().equals("status"<span style="font-size:12px;line-height:1.5;">)){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 63</span>                     mos.write("statuses"<span style="font-size:12px;line-height:1.5;">, entries[i].getKey(), entries[i].getValue()); 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 64</span> <span style="font-size:12px;line-height:1.5;">                }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 65</span> <span style="font-size:12px;line-height:1.5;">            }               
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 66</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 67</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 68</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> cleanup(Context context) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException,InterruptedException {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 69</span> <span style="font-size:12px;line-height:1.5;">            mos.close();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 70</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 71</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 72</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 73</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 74</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> run(String[] args) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 75</span>         Configuration conf = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Configuration();<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 配置文件对象</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 76</span>         Path mypath = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path(args[1<span style="font-size:12px;line-height:1.5;">]);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 77</span>         FileSystem hdfs = mypath.getFileSystem(conf);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 创建输出路径</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 78</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span><span style="font-size:12px;line-height:1.5;"> (hdfs.isDirectory(mypath)){
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 79</span>             hdfs.delete(mypath, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 80</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 81</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 82</span>         Job job = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Job(conf, "weibo");<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 构造任务</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 83</span>         job.setJarByClass(WeiboCount.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 主类</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 84</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 85</span>         job.setMapperClass(WeiBoMapper.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Mapper</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 86</span>         job.setMapOutputKeyClass(Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Mapper key输出类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 87</span>         job.setMapOutputValueClass(Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Mapper value输出类型</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 88</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 89</span>         job.setReducerClass(WeiBoReducer.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Reducer</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 90</span>         job.setOutputKeyClass(Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 91</span>         job.setOutputValueClass(IntWritable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 92</span>         FileInputFormat.addInputPath(job, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path(args[0]));<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 输入路径</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 93</span>         FileOutputFormat.setOutputPath(job, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path(args[1]));<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 输出路径</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 94</span>         job.setInputFormatClass(WeiboInputFormat.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 自定义输入格式
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 95</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">自定义文件输出类别</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 96</span>         MultipleOutputs.addNamedOutput(job, "follower", TextOutputFormat.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>,Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, IntWritable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 97</span>         MultipleOutputs.addNamedOutput(job, "friend", TextOutputFormat.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>,Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, IntWritable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 98</span>         MultipleOutputs.addNamedOutput(job, "status", TextOutputFormat.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>,Text.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, IntWritable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 99</span>         job.waitForCompletion(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">100</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> 0<span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">101</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">102</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">103</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">104</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">对Map内的数据进行排序（只适合小数据量）</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">105</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span><span style="font-size:12px;line-height:1.5;"> Map.Entry[] getSortedHashtableByValue(Map h){  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">106</span>         Set set =<span style="font-size:12px;line-height:1.5;"> h.entrySet();  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">107</span>         Map.Entry[] entries = (Map.Entry[]) set.toArray(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Map.Entry[set.size()]);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">108</span>         Arrays.sort(entries, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Comparator(){  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">109</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> compare(Object arg0, Object arg1){  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">110</span>                 Long key1 =<span style="font-size:12px;line-height:1.5;"> Long.valueOf(((Map.Entry) arg0).getValue().toString());  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">111</span>                 Long key2 =<span style="font-size:12px;line-height:1.5;"> Long.valueOf(((Map.Entry) arg1).getValue().toString());  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">112</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> key2.compareTo(key1);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">113</span> <span style="font-size:12px;line-height:1.5;">        } });
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">114</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> entries;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">115</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">116</span>     
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">117</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> main(String[] args) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception{
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">118</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">        String[] args0 = { "hdfs:</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">HadoopMaster:9000/weibo/weibo.txt",
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">119</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">                "hdfs:</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">HadoopMaster:9000/out/weibo/" };</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">120</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">121</span>         String[] args0 = { "./data/weibo/weibo.txt"<span style="font-size:12px;line-height:1.5;">,
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">122</span>         "./out/weibo/"<span style="font-size:12px;line-height:1.5;"> };
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">123</span>         
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">124</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> ec = ToolRunner.run(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Configuration(), <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> WeiboCount(), args0);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">125</span> <span style="font-size:12px;line-height:1.5;">        System.exit(ec);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">126</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">127</span> <span style="font-size:12px;line-height:1.5;">}
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">128</span>         </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font><span style="font-size:14px;">本文转自大数据躺过的坑博客园博客，原文链接：http://www.cnblogs.com/zlslch/p/6164435.html，如需转载请自行联系原作者</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
