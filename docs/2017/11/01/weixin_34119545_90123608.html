<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>memcached了解及使用及命令 « NotBeCN</title>
  <meta name="description" content="             ./memcached -d -p 11214 -u root -m 32    官网地址：http://memcached.org/    Memcached是什么?        &nbsp;       　　Memcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/01/weixin_34119545_90123608.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">memcached了解及使用及命令</h1>
    <p class="post-meta">Nov 1, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>./memcached -d -p 11214 -u root -m 32</strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>官网地址：<a href="http://memcached.org/" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://memcached.org/</a></strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>Memcached是什么?</strong></p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　Memcached 是一个高性能的分布式<a href="http://baike.baidu.com/view/1082.htm" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">内存</a>对象缓存系统，用于动态Web应用以减轻<a href="http://baike.baidu.com/view/1088.htm" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">数据库</a>负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提供动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是<a href="http://baike.baidu.com/view/930.htm" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">客户端</a>可以用任何语言来编写，并通过memcached协议与守护进程通信。但是它并不提供冗余（例如，复制其hashmap条目）；当某个服务器S停止运行或崩溃了，所有存放在S上的键/值对都将丢失。</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　Memcached由Danga Interactive开发，其最新版本发布于2010年，作者为Anatoly Vorobey和Brad Fitzpatrick。用于提升LiveJournal . com访问速度的。LJ每秒动态页面访问量几千次，用户700万。Memcached将数据库负载大幅度降低，更好的分配资源，更快速访问。</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<strong>如何使用memcached-Server端?</strong></p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在服务端运行：</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　# ./memcached -d -m 2048 -l 10.0.0.40 -p 11211</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　这将会启动一个占用2G内存的进程，并打开11211端口用于接收请求。由于32位系统只能处理4G内存的寻址，所以在大于4G内存使用PAE的32位服务器上可以运行2-3个进程，并在不同端口进行监听。</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<strong>如何使用memcached-Client端?</strong></p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在应用端包含一个用于描述Client的Class后，就可以直接使用，非常简单。</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　PHP Example:</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$options["servers"] = array("192.168.1.41:11211", "192.168.1.42:11212");</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$options["debug"] = false;</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$memc = new MemCachedClient($options);</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$myarr = array("one","two", 3);</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$memc-&gt;set("key_one", $myarr);</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　$val = $memc-&gt;get("key_one");</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　print $val[0]."\n"; // prints 'one‘</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　print $val[1]."\n"; // prints 'two‘</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　print $val[2]."\n"; // prints 3</p> 
   <h3 style="font-size:16px;background-image:url(&quot;images/bg_list.gif&quot;);background-position:left top;background-repeat:no-repeat;line-height:1.8;color:rgb(102,102,102);font-family:verdana, Arial, Helvetica, sans-serif;"><span class="headline-content">一个用PHP编写的可视化的MemCached管理系统</span></h3> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　MemAdmin是一款可视化的Memcached管理与监控工具，使用PHP开发，体积小，操作简单。</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　主要功能：</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　服务器参数监控：STATS、SETTINGS、ITEMS、SLABS、SIZES实时刷新</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　服务器性能监控：GET、DELETE、INCR、DECR、CAS等常用操作命中率实时监控</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　支持数据遍历，方便对存储内容进行监视</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　支持条件查询，筛选出满足条件的KEY或VALUE</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　数组、JSON等序列化字符反序列显示</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　兼容memcache协议的其他服务，如Tokyo Tyrant (遍历功能除外)</p> 
   <div class="spctrl" style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　支持服务器连接池，多服务器管理切换方便简洁</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">摘自<a href="http://baike.baidu.com/view/794242.htm" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://baike.baidu.com/view/794242.htm</a>&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>Memcache是什么？</strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Memcache是一个自由和开放源代码、高性能、分配的内存对象缓存系统。用于加速动态web应用程序，减轻数据库负载。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个HashTable，Memcached自管理这 些HashTable。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>Memcached又是什么？</strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Memcached是Memcache系统的主程序文件，以守护程序方式运行于一个或多个服务器中，随时接受客 户端的连接操作，使用共享内存存取数据。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">那PHP中的Memcache是什么？php中的所讲的memcache是用于连接Memecached的php支持扩展之一（可用phpinfo查看），类似mbstring，eAccelerator。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>简单的说</strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Memcache是总的缓存系统项目名称，容易和PHP中的Memcache混淆。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">我们常提到Memcache其实是PHP中的Memcache，即PHP的Memcached扩展支持。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">我们常提到Memcached是服务端主程序文件，服务端安装程序。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">为了让你的程序飞起来，必须安装memcached服务端程序和PHP的Memcached扩展，所以如果您要使用Memcache来缓存系统，memcache和memcached两样我们都需要安装。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>安装memcache</strong></p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># cd /usr/local/src<br> # wget http://pecl.php.net/get/memcache-2.2.5.tgz<br> # gzip -d memcache-2.2.5.tgz<br> # tar xvf memcache-2.2.5.tar<br> # cd memcache-2.2.5</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">以下几句，是以php所在目录为/usr/local/php为例，如果您的php有变化，请自行替换几句中/usr/local/php的部分</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># /usr/local/php/bin/phpize<br> # ./configure --enable-memcache --with-php-config=/usr/local/php/bin/php-config --with-zlib-dir<br> # make &amp;&amp; make install</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">将memcache加入php扩展</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"># vi /etc/php.ini（/etc/php.ini地址为我的php.ini位置，如果你不知道你的php.ini在哪里，可以用# find / -name php.ini进行查找，或者传个探针phpinfo，找到Configuration File (php.ini) Path）中php.ini的位置.</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">末尾加入</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">按键盘上的 i 开始编辑</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">CTRL+F翻页拉到最下面在［Zend］之前加入</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">extension_dir = "/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/"<br> extension=memcache.so</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">按Esc键，再输入</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">：wq</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">保存退出</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">重启你的web服务器，比如apache</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">/etc/init.d/httpd restart</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面刷新下PHP探针，看下是不是有这个了，有的话就是装好了</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">memcache<br> Version&nbsp; 2.2.5memcache<br> Version&nbsp; 2.2.5</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>下面安装memcached</strong></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">装memcached首先需要安装安装libevent</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果是centos可以yum安装</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># yum install libevent-devel</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果不支持yum的系统，可以这样装libevent</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># cd /usr/local/src<br> # wget http://www.monkey.org/~provos/libevent-1.4.12-stable.tar.gz<br> # tar vxf libevent-1.4.12-stable.tar.gz<br> # cd libevent-1.4.12<br> # ./configure --prefix=/usr/local/libevent<br> # make &amp;&amp; make install</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">接续安装memcached</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># cd /usr/local/src<br> # wget http://cloud.github.com/downloads/saberma/saberma.github.com/memcached-1.4.4.tar.gz<br> # tar vxf memcached-1.4.4.tar.gz<br> # cd memcached-1.4.4<br> # ./configure --prefix=/usr/local/memcached<br> # make &amp;&amp; make install</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">安装完后启动memcached并分配32m内存（32为使用内存数，可按自身情况修改）</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">/usr/local/memcached/bin/memcached -d -m 32 -l 127.0.0.1 -p 11211 -u root</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">将memcached加入启动项</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"># vi /etc/rc.d/rc.local</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">按键盘上的 i 开始编辑</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">在最后加入</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">/usr/local/memcached/bin/memcached -d -m 32 -l 127.0.0.1 -p 11211 -u root</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">按Esc键，再输入</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">：wq</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">保存退出</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果需要，可以reboot一下，不过不用reboot应该已经生效~</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">加速效果测试</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">用没有什么负载的Discuz X1做个测试，未启用时</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GMT+8, 2010-9-12 09:08, Processed in 0.038893 second(s), 2 queries.</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">缓存启用后的效果，不过总体感觉VPS上效果不如用eAccelerato缓存加入效果那么明显</p> 
   <table border="0" style="border:1px solid rgb(0,153,204);border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GMT+8, 2010-9-12 09:08, Processed in 0.008383 second(s), 2 queries, Memcache On.</td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">摘自&nbsp;<a href="http://www.chinaz.com/web/2010/0916/133310_2.shtml" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://www.chinaz.com/web/2010/0916/133310_2.shtml</a></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N1007C"></a><span class="atitle">如何将 memcached 融入到您的环境中？</span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">在开始安装和使用 using memcached 之前，我们需要了解如何将 memcached 融入到您的环境中。虽然在任何地方都可以使用 memcached，但我发现需要在数据库层中执行几个经常性查询时，memcached 往往能发挥最大的效用。我经常会在数据库和应用服务器之间设置一系列 memcached 实例，并采用一种简单的模式来读取和写入这些服务器。图 1 可以帮助您了解如何设置应用程序体系结构：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="fig1"></a><strong>图 1. 使用 memcached 的示例应用程序体系结构</strong><br><img src="http://www.ibm.com/developerworks/cn/java/j-memcached1/memcached1-fig1.gif" alt="使用 memcached 的示例应用程序体系结构" width="327" height="228" style="border:0px;"></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">体系结构相当容易理解。我建立了一个 Web 层，其中包括一些 Apache 实例。下一层是应用程序本身。这一层通常运行于 Apache Tomcat 或其他开源应用服务器之上。再下面一层是配置 memcached 实例的地方 — 即应用服务器与数据库服务器之间。在使用这种配置时，需要采用稍微不同的方式来执行数据库的读取和写入操作。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N1009A"></a><span class="smalltitle"><strong><span style="font-family:Arial;">读取</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">我执行读取操作的顺序是从 Web 层获取请求（需要执行一次数据库查询）并检查之前在缓存中存储的查询结果。如果我找到所需的值，则返回它。如果未找到，则执行查询并将结果存储在缓存中，然后再将结果返回给 Web 层。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N100A3"></a><span class="smalltitle"><strong><span style="font-family:Arial;">写入</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">将数据写入到数据库中时，首先需要执行数据库写入操作，然后将之前缓存的任何受此写入操作影响的结果设定为无效。此过程有助于防止缓存和数据库之间出现数据不一致性。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N100AC"></a><span class="atitle">安装 memcached</span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">memcached 支持一些操作系统，包括 Linux®、Windows®、Mac OS 和 Solaris。在本文中，我将详细介绍如何通过源文件构建和安装 memcached。采用这种方式的主要原因是我在遇到问题时可以查看源代码。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N100BA"></a><span class="smalltitle"><strong><span style="font-family:Arial;">libevent</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a href="http://www.ibm.com/developerworks/cn/java/j-memcached1/#resources" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;"><span style="color:rgb(92,129,167);">libevent</span></a>&nbsp;是安装 memcached 的唯一前提条件。它是 memcached 所依赖的异步事件通知库。您可以在&nbsp;<a href="http://www.ibm.com/developerworks/cn/java/j-memcached1/#resources" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;"><span style="color:rgb(92,129,167);">monkey.org</span></a>&nbsp;上找到关于 libevent 的源文件。接下来，找到其最新版本的源文件。对于本文，我们使用稳定的 1.4.11 版本。获取了归档文件之后，将它解压到一个方便的位置，然后执行清单 1 中的命令：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing1"></a><strong>清单 1. 生成和安装 libevent</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
cd libevent-1.4.11-stable/

./configure
			
make
				
make install
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N100D5"></a><span class="smalltitle"><strong><span style="font-family:Arial;">memcached</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">从&nbsp;<a href="http://www.ibm.com/developerworks/cn/java/j-memcached1/#resources" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;"><span style="color:rgb(92,129,167);">Danga Interactive</span></a>&nbsp;获取 memcached 源文件，仍然选择最新的分发版。在撰写本文时，其最新版本是 1.4.0。将 tar.gz 解压到方便的位置，并执行清单 2 中的命令：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing2"></a><strong>清单 2. 生成和安装 memcached</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
cd memcached-1.4.0/

./configure
			
make
				
make install
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">完成这些步骤之后，您应该安装了一个 memcached 工作副本，并且可以使用它了。让我们进行简单介绍，然后使用它。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N100EF"></a><span class="atitle">使用 memcached</span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">要开始使用 memcached，您首先需要启动 memcached 服务器，然后使用 telnet 客户机连接到它。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">要启动 memcached，执行清单 3 中的命令：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing3"></a><strong>清单 3. 启动 memcached</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
./memcached -d -m 2048 -l 10.0.0.40 -p 11211
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">这会以守护程序的形式启动 memcached（<code>-d</code>），为其分配 2GB 内存（<code>-m 2048</code>），并指定监听 localhost，即端口 11211。您可以根据需要修改这些值，但以上设置足以完成本文中的练习。接下来，您需要连接到 memcached。您将使用一个简单的 telnet 客户机连接到 memcached 服务器。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">大多数操作系统都提供了内置的 telnet 客户机，但如果您使用的是基于 Windows 的操作系统，则需要下载第三方客户机。我推荐使用&nbsp;<a href="http://www.ibm.com/developerworks/cn/java/j-memcached1/#resources" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;"><span style="color:rgb(92,129,167);">PuTTy</span></a>。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">安装了 telnet 客户机之后，执行清单 4 中的命令：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing4"></a><strong>清单 4. 连接到 memcached</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
telnet localhost 11211
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果一切正常，则应该得到一个 telnet 响应，它会指示&nbsp;<strong>Connected to localhost（已经连接到 localhost）</strong>。如果未获得此响应，则应该返回之前的步骤并确保 libevent 和 memcached 的源文件都已成功生成。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">您现现已经登录到 memcached 服务器。此后，您将能够通过一系列简单的命令来与 memcached 通信。9 个 memcached 客户端命令可以分为三类：</p> 
   <ul style="margin-left:30px;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style-type:disc;">基本</li> 
    <li style="list-style-type:disc;">高级</li> 
    <li style="list-style-type:disc;">管理</li> 
   </ul>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N1013A"></a><span class="smalltitle"><strong><span style="font-family:Arial;">基本 memcached 客户机命令</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">您将使用五种基本 memcached 命令执行最简单的操作。这些命令和操作包括：</p> 
   <ul style="margin-left:30px;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style-type:disc;"><code>set</code></li> 
    <li style="list-style-type:disc;"><code>add</code></li> 
    <li style="list-style-type:disc;"><code>replace</code></li> 
    <li style="list-style-type:disc;"><code>get</code></li> 
    <li style="list-style-type:disc;"><code>delete</code></li> 
   </ul>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">前三个命令是用于操作存储在 memcached 中的键值对的标准修改命令。它们都非常简单易用，且都使用清单 5 所示的语法：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing5"></a><strong>清单 5. 修改命令语法</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
command &lt;key&gt; &lt;flags&gt; &lt;expiration time&gt; &lt;bytes&gt;
&lt;value&gt;
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">表 1 定义了 memcached 修改命令的参数和用法。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="table1"></a><strong>表 1. memcached 修改命令参数</strong></p> 
   <table class="data-table-1" border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <th style="border:1px solid #C0C0C0;border-collapse:collapse;">参数</th> 
      <th style="border:1px solid #C0C0C0;border-collapse:collapse;">用法</th> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">key</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">key 用于查找缓存值</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">flags</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">expiration time</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">bytes</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">在缓存中存储的字节点</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">value</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">存储的值（始终位于第二行）</td> 
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">现在，我们来看看这些命令的实际使用。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>set</strong>&nbsp;<br><code>set</code>&nbsp;命令用于向缓存添加新的键值对。如果键已经存在，则之前的值将被替换。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">注意以下交互，它使用了&nbsp;<code>set</code>&nbsp;命令：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
12345
STORED
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果使用&nbsp;<code>set</code>&nbsp;命令正确设定了键值对，服务器将使用单词&nbsp;<strong>STORED</strong>&nbsp;进行响应。本示例向缓存中添加了一个键值对，其键为&nbsp;<code>userId</code>，其值为&nbsp;<code>12345</code>。并将过期时间设置为 0，这将向 memcached 通知您希望将此值存储在缓存中直到删除它为止。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>add</strong>&nbsp;<br> 仅当缓存中不存在键时，<code>add</code>&nbsp;命令才会向缓存中添加一个键值对。如果缓存中已经存在键，则之前的值将仍然保持相同，并且您将获得响应&nbsp;<strong>NOT_STORED</strong>。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面是使用&nbsp;<code>add</code>&nbsp;命令的标准交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
12345
STORED

add userId 0 0 5
55555
NOT_STORED

add companyId 0 0 3
564
STORED
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>replace</strong>&nbsp;<br> 仅当键已经存在时，<code>replace</code>&nbsp;命令才会替换缓存中的键。如果缓存中不存在键，那么您将从 memcached 服务器接受到一条&nbsp;<strong>NOT_STORED</strong>&nbsp;响应。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面是使用&nbsp;<code>replace</code>&nbsp;命令的标准交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">replace accountId 0 0 5
67890
NOT_STORED

set accountId 0 0 5
67890
STORED

replace accountId 0 0 5
55555
STORED
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">最后两个基本命令是&nbsp;<code>get</code>&nbsp;和&nbsp;<code>delete</code>。这些命令相当容易理解，并且使用了类似的语法，如下所示：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">command &lt;key&gt;
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">接下来看这些命令的应用。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>get</strong>&nbsp;<br><code>get</code>&nbsp;命令用于检索与之前添加的键值对相关的值。您将使用&nbsp;<code>get</code>&nbsp;执行大多数检索操作。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面是使用&nbsp;<code>get</code>&nbsp;命令的典型交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
12345
STORED

get userId
VALUE userId 0 5
12345
END

get bob
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如您所见，<code>get</code>&nbsp;命令相当简单。您使用一个键来调用&nbsp;<code>get</code>，如果这个键存在于缓存中，则返回相应的值。如果不存在，则不返回任何内容。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>delete</strong>&nbsp;<br> 最后一个基本命令是&nbsp;<code>delete</code>。<code>delete</code>&nbsp;命令用于删除 memcached 中的任何现有值。您将使用一个键调用&nbsp;<code>delete</code>，如果该键存在于缓存中，则删除该值。如果不存在，则返回一条&nbsp;<strong>NOT_FOUND</strong>&nbsp;消息。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面是使用&nbsp;<code>delete</code>&nbsp;命令的客户机服务器交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
98765
STORED

delete bob
NOT_FOUND

delete userId
DELETED

get userId
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N10282"></a><span class="smalltitle"><strong><span style="font-family:Arial;">高级 memcached 客户机命令</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">可以在 memcached 中使用的两个高级命令是&nbsp;<code>gets</code>&nbsp;和&nbsp;<code>cas</code>。<code>gets</code>&nbsp;和&nbsp;<code>cas</code>&nbsp;命令需要结合使用。您将使用这两个命令来确保不会将现有的名称/值对设置为新值（如果该值已经更新过）。我们来分别看看这些命令。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>gets</strong>&nbsp;<br><code>gets</code>&nbsp;命令的功能类似于基本的&nbsp;<code>get</code>&nbsp;命令。两个命令之间的差异在于，<code>gets</code>&nbsp;返回的信息稍微多一些：64 位的整型值非常像名称/值对的 “版本” 标识符。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">下面是使用&nbsp;<code>gets</code>&nbsp;命令的客户机服务器交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
12345
STORED

get userId
VALUE userId 0 5
12345
END

gets userId
VALUE userId 0 5 <span class="boldcode"><strong>4</strong></span>
12345
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">考虑&nbsp;<code>get</code>&nbsp;和&nbsp;<code>gets</code>&nbsp;命令之间的差异。<code>gets</code>&nbsp;命令将返回一个额外的值 — 在本例中是整型值 4，用于标识名称/值对。如果对此名称/值对执行另一个&nbsp;<code>set</code>&nbsp;命令，则&nbsp;<code>gets</code>返回的额外值将会发生更改，以表明名称/值对已经被更新。清单 6 显示了一个例子：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing6"></a><strong>清单 6. set 更新版本指示符</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
set userId 0 0 5
33333
STORED

gets userId
VALUE userId 0 5 <span class="boldcode"><strong>5</strong></span>
33333
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">您看到&nbsp;<code>gets</code>&nbsp;返回的值了吗？它已经更新为 5。您每次修改名称/值对时，该值都会发生更改。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>cas</strong>&nbsp;<br><code>cas</code>（check 和 set）是一个非常便捷的 memcached 命令，用于设置名称/值对的值（如果该名称/值对在您上次执行&nbsp;<code>gets</code>&nbsp;后没有更新过）。它使用与&nbsp;<code>set</code>&nbsp;命令相类似的语法，但包括一个额外的值：<code>gets</code>&nbsp;返回的额外值。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">注意以下使用&nbsp;<code>cas</code>&nbsp;命令的交互：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
55555
STORED

gets userId
VALUE userId 0 5 <span class="boldcode"><strong>6</strong></span>
55555
END

cas userId 0 0 5 <span class="boldcode"><strong>6</strong></span>
33333
STORED
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如您所见，我使用额外的整型值 6 来调用&nbsp;<code>gets</code>&nbsp;命令，并且操作运行非常顺序。现在，我们来看看清单 7 中的一系列命令：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing7"></a><strong>清单 7. 使用旧版本指示符的&nbsp;<code>cas</code>&nbsp;命令</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
set userId 0 0 5
55555
STORED

gets userId
VALUE userId 0 5 <span class="boldcode"><strong>8</strong></span>
55555
END

cas userId 0 0 5 <span class="boldcode"><strong>6</strong></span>
33333
EXISTS
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">注意，我并未使用&nbsp;<code>gets</code>&nbsp;最近返回的整型值，并且&nbsp;<code>cas</code>&nbsp;命令返回 EXISTS 值以示失败。从本质上说，同时使用&nbsp;<code>gets</code>&nbsp;和&nbsp;<code>cas</code>&nbsp;命令可以防止您使用自上次读取后经过更新的名称/值对。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N10344"></a><span class="smalltitle"><strong><span style="font-family:Arial;">缓存管理命令</span></strong></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">最后两个 memcached 命令用于监控和清理 memcached 实例。它们是&nbsp;<code>stats</code>&nbsp;和&nbsp;<code>flush_all</code>&nbsp;命令。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>stats</strong>&nbsp;<br><code>stats</code>&nbsp;命令的功能正如其名：转储所连接的 memcached 实例的当前统计数据。在下例中，执行&nbsp;<code>stats</code>&nbsp;命令显示了关于当前 memcached 实例的信息：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">stats
STAT pid 63
STAT uptime 101758
STAT time 1248643186
STAT version 1.4.11
STAT pointer_size 32
STAT rusage_user 1.177192
STAT rusage_system 2.365370
STAT curr_items 2
STAT total_items 8
STAT bytes 119
STAT curr_connections 6
STAT total_connections 7
STAT connection_structures 7
STAT cmd_get 12
STAT cmd_set 12
STAT get_hits 12
STAT get_misses 0
STAT evictions 0
STAT bytes_read 471
STAT bytes_written 535
STAT limit_maxbytes 67108864
STAT threads 4
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">此处的大多数输出都非常容易理解。稍后在讨论缓存性能时，我还将详细解释这些值的含义。至于目前，我们先来看看输出，然后再使用新的键来运行一些&nbsp;<code>set</code>&nbsp;命令，并再次运行&nbsp;<code>stats</code>&nbsp;命令，注意发生了哪些变化。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>flush_all</strong>&nbsp;<br><code>flush_all</code>&nbsp;是最后一个要介绍的命令。这个最简单的命令仅用于清理缓存中的所有名称/值对。如果您需要将缓存重置到干净的状态，则&nbsp;<code>flush_all</code>&nbsp;能提供很大的用处。下面是一个使用&nbsp;<code>flush_all</code>&nbsp;的例子：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">set userId 0 0 5
55555
STORED

get userId
VALUE userId 0 5
55555
END

flush_all
OK

get userId
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><a name="N1038F"></a><span class="atitle">缓存性能</span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">在本文的最后，我将讨论如何使用高级 memcached 命令来确定缓存的性能。<code>stats</code>&nbsp;命令用于调优缓存的使用。需要注意的两个最重要的统计数据是 et_hits 和 get_misses。这两个值分别指示找到名称/值对的次数（get_hits）和未找到名称/值对的次数（get_misses）。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">结合这些值，我们可以确定缓存的利用率如何。初次启动缓存时，可以看到 get_misses 会自然地增加，但在经过一定的使用量之后，这些 get_misses 值应该会逐渐趋于平稳 — 这表示缓存主要用于常见的读取操作。如果您看到 get_misses 继续快速增加，而 get_hits 逐渐趋于平稳，则需要确定一下所缓存的内容是什么。您可能缓存了错误的内容。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">确定缓存效率的另一种方法是查看缓存的命中率（hit ratio）。缓存命中率表示执行&nbsp;<code>get</code>&nbsp;的次数与错过&nbsp;<code>get</code>&nbsp;的次数的百分比。要确定这个百分比，需要再次运行&nbsp;<code>stats</code>&nbsp;命令，如清单 8 所示：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><a name="listing8"></a><strong>清单 8. 计算缓存命中率</strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="code-outline" style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre class="displaycode">				
stats
STAT pid 6825
STAT uptime 540692
STAT time 1249252262
STAT version 1.2.6
STAT pointer_size 32
STAT rusage_user 0.056003
STAT rusage_system 0.180011
STAT curr_items 595
STAT total_items 961
STAT bytes 4587415
STAT curr_connections 3
STAT total_connections 22
STAT connection_structures 4
STAT cmd_get 2688
STAT cmd_set 961
STAT get_hits 1908
STAT get_misses 780
STAT evictions 0
STAT bytes_read 5770762
STAT bytes_written 7421373
STAT limit_maxbytes 536870912
STAT threads 1
END
</pre></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">现在，用 get_hits 的数值除以 cmd_gets。在本例中，您的命中率大约是 71%。在理想情况下，您可能希望得到更高的百分比 — 比率越高越好。查看统计数据并不时测量它们可以很好地判定缓存策略的效率。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">常有命令如下：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">启动/结束<br> memcached -d -m 10 -u root -l 192.168.0.122 -p 11200 -c 256 -P /tmp/memcached.pid<br> -d 选项是启动一个守护进程，&nbsp;<br> -m 是分配给Memcache使用的内存数量，单位是MB，这里是10MB<br> -u 是运行Memcache的用户，这里是root<br> -l 是监听的服务器IP地址，如果有多个地址的话，这里指定了服务器的IP地址192.168.0.122&nbsp;<br> -p 是设置Memcache监听的端口，这里设置了12000，最好是1024以上的端口<br> -c 选项是最大运行的并发连接数，默认是1024，这里设置了256，按照你服务器的负载量来设定<br> -P 是设置保存Memcache的pid文件<br> kill `cat /tmp/memcached.pid`</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">获取运行状态<br> echo stats | nc 192.168.1.123 11200<br> watch "echo stats | nc 192.168.1.123 11200" (实时状态)</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">摘自&nbsp;<a href="http://www.cnblogs.com/czh-liyu/archive/2010/04/27/1722084.html" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://www.cnblogs.com/czh-liyu/archive/2010/04/27/1722084.html</a></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p><font><span style="font-size:14px;">本文转自茄子_2008博客园博客，原文链接：http://www.cnblogs.com/xd502djj/archive/2012/05/08/2490115.html</span></font><span style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者。</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
