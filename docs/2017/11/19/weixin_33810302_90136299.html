<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>spark高级排序彻底解秘 « NotBeCN</title>
  <meta name="description" content="                             　　排序，真的非常重要！     RDD.scala（源码）     　　在其，没有罗列排序，不是说它不重要！     &nbsp;     &nbsp;     本博文的主要内容有:     　　1、基础排序算法实战     　　2、二次排序算法实战  ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/19/weixin_33810302_90136299.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">spark高级排序彻底解秘</h1>
    <p class="post-meta">Nov 19, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div>
    <br>
   </div> 
   <div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong>　　排序，真的非常重要！</strong></span></p> 
    <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/zlslch/p/5912331.html" rel="nofollow" style="color:#000000;">RDD.scala（源码）</a></h1> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在其，没有罗列排序，不是说它不重要！</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong>本博文的主要内容有:</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18px;"><strong>　　1、基础排序算法实战</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18px;"><strong>　　2、二次排序算法实战</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18px;"><strong>　　3、更高级别排序算法</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18px;"><strong>　　4、排序算法内幕解密</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong>1、基础排序算法实战</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<strong>启动hdfs集群</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929195854422-646091560.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>spark@SparkSingleNode:/usr/local/hadoop/hadoop-2.6.0$ sbin/start-dfs.sh</pre>
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929200459297-2015365299.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　<strong>　启动spark集群</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929195952422-1286398652.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>spark@SparkSingleNode:/usr/local/spark/spark-1.5.2-bin-hadoop2.6$ sbin/start-all.sh</pre>
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929201056328-1539449265.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<strong>启动spark-shell</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929211559469-1271302781.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>spark@SparkSingleNode:/usr/local/spark/spark-1.5.2-bin-hadoop2.6/bin$ ./spark-shell --master spark:<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">SparkSingleNode:7077 --executor-memory 1g</span></pre>
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre>scala&gt; sc.setLogLevel("WARN")    <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">过滤日志提醒</span>
<span style="font-size:12px;line-height:1.5;">
scala</span>&gt; sc.textFile("/README.md").flatMap(_.split(" ")).map(word =&gt;(word,1)).reduceByKey(_+_,1).map(pair =&gt; (pair._2,pair._1)).sortByKey(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span>).map(pair =&gt; (pair._2,pair._1)).collect</pre>
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="color:rgb(255,0,0);"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929211638172-860260508.png" alt="" style="border:0px;"></span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>scala&gt; sc.textFile("/README.md").flatMap(_.split(" ")).map(word =&gt;(word,1)).reduceByKey(_+_,1).map(pair =&gt; (pair._2,pair._1)).sortByKey(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span>).map(pair =&gt;<span style="font-size:12px;line-height:1.5;"> (pair._2,pair._1)).collect
res2: Array[(String, Int)] </span>= Array(("",67), (the,21), (Spark,14), (to,14), (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span>,12), (a,10), (and,10), (##,8), (run,7), (is,6), (on,6), (can,6), (of,5), (also,5), (in,5), (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>,4), (or,4), (Hadoop,4), (with,4), (you,4), (build,3), (including,3), (Please,3), (use,3), (particular,3), (documentation,3), (example,3), (an,3), (You,3), (building,3), (that,3), (guidance,3), (For,2), (This,2), (Hive,2), (To,2), (SparkPi,2), (refer,2), (Interactive,2), (be,2), (./bin/run-example,2), (1000:,2), (tests,2), (examples,2), (at,2), (using,2), (Shell,2), (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>,2), (`examples`,2), (set,2), (Hadoop,,2), (cluster,2), (supports,2), (Python,2), (general,2), (locally,2), (following,2), (which,2), (should,2), ([project,2), (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">do</span>,2), (how,2), (It,2), (Scala,2), (detailed,2), (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span>,2), (one,2), (Python,,2<span style="font-size:12px;line-height:1.5;">), (SQL...
scala</span>&gt;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　则，可看出，是<strong><span style="color:rgb(0,0,255);">sortByKey(false)是按key排序且降序.</span></strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong>sortByKey源码</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929210922000-1466811718.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 * Sort the RDD by key, so that each partition contains a sorted range of the elements. Calling
 * `collect` or `save` on the resulting RDD will return or output an ordered list of records
 * (in the `save` case, they will be written to multiple `part-X` files in the filesystem, in
 * order of the keys).
 </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO: this currently doesn't work on P other than Tuple2!</span>
def sortByKey(ascending: Boolean = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span>, numPartitions: Int =<span style="font-size:12px;line-height:1.5;"> self.partitions.length)
    : RDD[(K, V)] </span>=<span style="font-size:12px;line-height:1.5;"> self.withScope
{
  val part </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> RangePartitioner(numPartitions, self, ascending)
  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> ShuffledRDD[K, V, V](self, part)
    .setKeyOrdering(</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (ascending) ordering <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> ordering.reverse)
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <pre><br><br><br></pre> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　由此，可看出，<strong><span style="color:rgb(0,0,255);">一旦排序，则产生ShuffledRDD。</span></strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929212036266-964195999.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929212056485-342092711.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929213105625-2037448259.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　为什么我的是没显示出来？</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929213057594-1516870699.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　rangPartition是怎么排序的呢？</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">好的，<strong>基础排序算法实战至此。</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong><strong>2、二次排序算法实战</strong></strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　所谓，<strong>二次排序</strong>，就是指排序的时候<strong><span style="color:rgb(0,0,255);">考虑两个维度</span></strong>。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　如，在第一列，按照降序排，第一列的key相同，那么，再怎么排呢？则，考虑第二列，按照降序排。即，用到了<strong>二次排序</strong>。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>准备</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929213815625-1547379736.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929214003813-33129597.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">【数据文件Input】</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
     <pre> 2 3
 4 1
 3 2
 4 3
 8 7
 2 1</pre>
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">【运行结果Output】</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre> 2 1
 2 3
 3 2
 4 1
 4 3
 8 7</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　如果是去大公司的话，则要掌握，5个维度，甚至8个维度，而不是才2个维度而已。加油！zhouls。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　这里，就用，Scala IDE for Eclipse，来写，</p> 
    <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><a class="postTitle2" href="http://www.cnblogs.com/zlslch/p/5880006.html" rel="nofollow" style="color:#000000;">Scala IDE for Eclipse的下载、安装和WordCount的初步使用（本地模式和集群模式）</a></h1> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929221837375-48781594.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929222106110-223258203.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong>　　SecondarySortKey.java</strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929222432563-285894997.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929222521313-120686360.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929224354047-1112883348.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929224456328-642589171.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929224538094-835671389.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.zhouls.spark.SparkApps.cores;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.Serializable;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.math.Ordered;


</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> SecondarySortKey <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span> Ordered&lt;SecondarySortKey&gt;<span style="font-size:12px;line-height:1.5;">,Serializable{
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> first;
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> second;


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $greater(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $greater$eq(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $less(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $less$eq(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> compare(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> 0<span style="font-size:12px;line-height:1.5;">;
　　}


　　@Override
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> compareTo(SecondarySortKey arg0) {
　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> TODO Auto-generated method stub</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> 0<span style="font-size:12px;line-height:1.5;">;
　　}
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在这里，学下技巧。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930151227078-487047406.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　然后，修改成我们自己想要的。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:18pt;"><strong><span style="color:rgb(255,0,0);">最终的SecondarySortKey.java如下:</span></strong></span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.zhouls.spark.SparkApps.cores;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.Serializable;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.math.Ordered;


</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> SecondarySortKey <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span> Ordered&lt;SecondarySortKey&gt;<span style="font-size:12px;line-height:1.5;">,Serializable{
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> first;
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> second;

　　</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">二次排序的公开构造器</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> SecondarySortKey(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> first,<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> second){
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first=<span style="font-size:12px;line-height:1.5;">first;
　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second=<span style="font-size:12px;line-height:1.5;">second;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $greater(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first&gt;<span style="font-size:12px;line-height:1.5;">other.getFirst()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first==other.getFirst()&amp;&amp;<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second&gt;<span style="font-size:12px;line-height:1.5;">other.getSecond()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　}
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $greater$eq(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span><span style="font-size:12px;line-height:1.5;">.$greater(other)){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first==other.getFirst()&amp;&amp;<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second==<span style="font-size:12px;line-height:1.5;">other.getSecond()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　}
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $less(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first&lt;<span style="font-size:12px;line-height:1.5;">other.getFirst()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first==other.getFirst()&amp;&amp;<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second&lt;<span style="font-size:12px;line-height:1.5;">other.getSecond()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　}
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> $less$eq(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span><span style="font-size:12px;line-height:1.5;">.$less(other)){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first==other.getFirst()&amp;&amp;<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second==<span style="font-size:12px;line-height:1.5;">other.getSecond()){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　}
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> compare(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-other.getFirst() !=0<span style="font-size:12px;line-height:1.5;">){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-<span style="font-size:12px;line-height:1.5;">other.getFirst();
　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;">{
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second-<span style="font-size:12px;line-height:1.5;">other.getSecond();
　　　　}
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> compareTo(SecondarySortKey other) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-other.getFirst() !=0<span style="font-size:12px;line-height:1.5;">){
　　　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-<span style="font-size:12px;line-height:1.5;">other.getFirst();
　　}</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;">{
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second-<span style="font-size:12px;line-height:1.5;">other.getSecond();
　　　　}
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> hashCode() {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> prime = 31<span style="font-size:12px;line-height:1.5;">;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> result = 1<span style="font-size:12px;line-height:1.5;">;
　　　　result </span>= prime * result +<span style="font-size:12px;line-height:1.5;"> first;
　　　　result </span>= prime * result +<span style="font-size:12px;line-height:1.5;"> second;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> result;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> equals(Object obj) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span> ==<span style="font-size:12px;line-height:1.5;"> obj)
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (obj == <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">)
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (getClass() !=<span style="font-size:12px;line-height:1.5;"> obj.getClass())
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　　　SecondarySortKey other </span>=<span style="font-size:12px;line-height:1.5;"> (SecondarySortKey) obj;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (first !=<span style="font-size:12px;line-height:1.5;"> other.first)
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (second !=<span style="font-size:12px;line-height:1.5;"> other.second)
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> getFirst() {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> first;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setFirst(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> first) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first =<span style="font-size:12px;line-height:1.5;"> first;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> getSecond() {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> second;
　　}

　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setSecond(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> second) {
　　　　</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second =<span style="font-size:12px;line-height:1.5;"> second;
　　}
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160929230706531-839257395.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <span style="font-size:14pt;"><strong>SecondarySortApp.java的完整代码：</strong></span>
    </div> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
     <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
      </div> 
      <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.zhouls.spark.SparkApps.cores;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.SparkConf;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.JavaPairRDD;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.JavaRDD;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.JavaSparkContext;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.function.Function;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.function.PairFunction;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.api.java.function.VoidFunction;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.Tuple2;

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
* 二次排序，具体的实现步骤：
* 第一步：安装Ordered和Serrializable接口实现自定义排序的key
* 第二步:将要进行二次排序的文件加载进来&lt;key,value&gt;类型的RDD
* 第三步：使用sortByKey基于自定义的Key进行二次排序
* 第四步：去除掉排序的Key,只保留排序的结果
</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> SecondarySortApp {
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) {
SparkConf conf</span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkConf().setAppName("SecondarySortApp").setMaster("local"<span style="font-size:12px;line-height:1.5;">);
JavaSparkContext sc</span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> JavaSparkContext(conf);<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">其底层实际上就是Scala的SparkContext</span>
JavaRDD&lt;String&gt; lines = sc.textFile("D://SoftWare//spark-1.5.2-bin-hadoop2.6//helloSpark.txt"<span style="font-size:12px;line-height:1.5;">); 
JavaPairRDD</span>&lt;SecondarySortKey, String&gt; pairs = lines.mapToPair(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> PairFunction&lt;String, SecondarySortKey, String&gt;<span style="font-size:12px;line-height:1.5;">() {

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> serialVersionUID = 1L<span style="font-size:12px;line-height:1.5;">;

@Override
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> Tuple2&lt;SecondarySortKey, String&gt; call(String line) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
String[] splited </span>= line.split(" "<span style="font-size:12px;line-height:1.5;">);
SecondarySortKey key </span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SecondarySortKey(Integer.valueOf(splited[0]),Integer.valueOf(splited[1<span style="font-size:12px;line-height:1.5;">]));
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Tuple2&lt;SecondarySortKey,String&gt;<span style="font-size:12px;line-height:1.5;">(key,line);
}
});

JavaPairRDD</span>&lt;SecondarySortKey, String&gt; sorted =<span style="font-size:12px;line-height:1.5;"> pairs.sortByKey();

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">过滤掉排序后自定的Key，保留排序的结果</span>
JavaRDD&lt;String&gt; SecondaySorted=sorted.map(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Function&lt;Tuple2&lt;SecondarySortKey,String&gt;, String&gt;<span style="font-size:12px;line-height:1.5;">() {

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> serialVersionUID = 1L<span style="font-size:12px;line-height:1.5;">;

@Override
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> String call(Tuple2&lt;SecondarySortKey, String&gt; sortedContent) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {

System.out.println(</span>"sortedContent._1 "+<span style="font-size:12px;line-height:1.5;">(sortedContent._1).toString());
System.out.println(</span>"sortedContent._2 "+<span style="font-size:12px;line-height:1.5;">sortedContent._2);

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> sortedContent._2;
}
});
SecondaySorted.foreach(</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> VoidFunction&lt;String&gt;<span style="font-size:12px;line-height:1.5;">() {

@Override
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> call(String sorted) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
System.out.println(sorted);
}
});

}
}</span></pre> 
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
      </div> 
     </div> 
     <p>&nbsp;</p> 
     <p>&nbsp;</p> 
     <p>&nbsp;</p> 
    </div> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     &nbsp;
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>&nbsp;　　Scala</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930160018985-495029792.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930160243500-1635138726.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930160322063-1127155168.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930162858781-1168550265.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.zhouls.spark.cores

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
  * Created by Administrator on 2016/9/30.
  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> SecondarySortKey(val first:Int,val second:Int) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> Ordered[SecondarySortKey] with Serializable {
    def compare(that: SecondarySortKey): Int </span>=<span style="font-size:12px;line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-that.first!=0<span style="font-size:12px;line-height:1.5;">){
          </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-<span style="font-size:12px;line-height:1.5;">that.first
        }</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;">{
          </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second-<span style="font-size:12px;line-height:1.5;">that.second
        }
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <pre><br><br><br><br></pre> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930160732156-1106523766.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930162944516-1542981863.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.zhouls.spark.cores
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.{SparkConf, SparkContext}
</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
  * Created by Administrator on 2016/9/30.
  * 二次排序：具体的实现步骤：
  * 第一步：按照Ordered和Serrializable接口实现自定义排序的Key
  * 第二步：将要进行二次排序的文件加载进来&lt; key,value&gt; 类型的RDD
  * 第三步：使用sortByKey基于自定义的Key进行二次排序
  * 第四步：去除掉排序的Key,只保留排序的结果
  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span><span style="font-size:12px;line-height:1.5;">
object SecondarySortApp {
  def main (args: Array[String]) {
    val conf</span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkConf().setAppName("SecondarySortApp").setMaster("local")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">创建SparkConf,初始化程序的配置</span>
    val sc = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkContext(conf)<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">创建SparkContext，这是第一个RDD创建的唯一入口，也是Driver的灵魂，是通往集群的唯一通道</span>
<span style="font-size:12px;line-height:1.5;">
    val lines </span>= sc.textFile("D:\\SoftWare\\spark-1.5.2-bin-hadoop2.6\\helloSpark.txt")<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">读取文件
</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">    val results = lines.map(line=&gt;(new SecondarySortKey(line.split(" ")(0).toInt , line.split(" ")(1).toInt), line)).sortByKey().map(pair =&gt; pair._2)</span>
    val pairWithSortKey =  lines.map (line=&gt;<span style="font-size:12px;line-height:1.5;"> (
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SecondarySortKey(line.split(" ")(0).toInt ,line.split(" ")(1<span style="font-size:12px;line-height:1.5;">).toInt), line
      ))
    val sorted </span>=<span style="font-size:12px;line-height:1.5;"> pairWithSortKey.sortByKey()
    val sortedResult </span>= sorted.map(sortedLine =&gt;<span style="font-size:12px;line-height:1.5;"> sortedLine._2)
    sortedResult.collect.foreach(println)
  }

}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-size:14pt;"><strong><span style="font-family:Arial;">作业：</span></strong></span></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><span style="font-family:Arial;">1：Scala实现二次排序</span></strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-family:Arial;">SecondarySortKey.scala的完整代码：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> SecondarySortKey(val first:Int,val second:Int) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> Ordered[SecondarySortKey] with Serializable{
  override def compare(that: SecondarySortKey): Int </span>=<span style="font-size:12px;line-height:1.5;"> {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-that.first!=0<span style="font-size:12px;line-height:1.5;">){
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.first-<span style="font-size:12px;line-height:1.5;">that.first
    }</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;">{
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.second-<span style="font-size:12px;line-height:1.5;">that.second
    }
  }
}

 

object SecondarySortKey </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> scala.AnyRef with Serializable{
  def apply(first:Int,second:Int): SecondarySortKey </span>=<span style="font-size:12px;line-height:1.5;">{
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> SecondarySortKey(first,second)
  }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="font-family:Arial;">SecondarySortApp.scala的完整代码：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-size:12px;line-height:1.5;">object SecondarySortApp {
  def main (args: Array[String]) {
    val conf</span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkConf().setAppName("SecondarySortApp").setMaster("local"<span style="font-size:12px;line-height:1.5;">)
    val sc</span>=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> SparkContext(conf)
    val lines</span>=sc.textFile("D:\\SoftWare\\spark-1.5.2-bin-hadoop2.6\\helloSpark.txt"<span style="font-size:12px;line-height:1.5;">)
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">val results=lines.map(line=&gt;(new SecondarySortKey(line.split(" ")(0).toInt,line.split(" ")(1).toInt),line)).sortByKey().map(pair=&gt;pair._2)</span><span style="font-size:12px;line-height:1.5;">
    val results</span>=lines.map(line=&gt;(SecondarySortKey.apply(line.split(" ")(0).toInt,line.split(" ")(1).toInt),line)).sortByKey().map(pair=&gt;<span style="font-size:12px;line-height:1.5;">pair._2)
    results.collect.foreach(println)
  }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>2：RangePartitioner的源码阅读：</strong></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930163606781-206785731.png" alt="" style="border:0px;"></p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/855959/201609/855959-20160930163717891-644397951.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">http://www.apache.org/licenses/LICENSE-2.0</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>

<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.{IOException, ObjectInputStream, ObjectOutputStream}

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.collection.mutable
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.collection.mutable.ArrayBuffer
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.reflect.{ClassTag, classTag}
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> scala.util.hashing.byteswap32

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.rdd.{PartitionPruningRDD, RDD}
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.serializer.JavaSerializer
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.util.{CollectionsUtils, Utils}
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.spark.util.random.{XORShiftRandom, SamplingUtils}

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 * An object that defines how the elements in a key-value pair RDD are partitioned by key.
 * Maps each key to a partition ID, from 0 to `numPartitions - 1`.
 </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> Partitioner <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> Serializable {
  def numPartitions: Int
  def getPartition(key: Any): Int
}

object Partitioner {
  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
   * Choose a partitioner to use for a cogroup-like operation between a number of RDDs.
   *
   * If any of the RDDs already has a partitioner, choose that one.
   *
   * Otherwise, we use a default HashPartitioner. For the number of partitions, if
   * spark.default.parallelism is set, then we'll use the value from SparkContext
   * defaultParallelism, otherwise we'll use the max number of upstream partitions.
   *
   * Unless spark.default.parallelism is set, the number of partitions will be the
   * same as the number of partitions in the largest upstream RDD, as this should
   * be least likely to cause out-of-memory errors.
   *
   * We use two method parameters (rdd, others) to enforce callers passing at least 1 RDD.
   </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span><span style="font-size:12px;line-height:1.5;">
  def defaultPartitioner(rdd: RDD[_], others: RDD[_]</span>*): Partitioner =<span style="font-size:12px;line-height:1.5;"> {
    val bySize </span>= (Seq(rdd) ++<span style="font-size:12px;line-height:1.5;"> others).sortBy(_.partitions.size).reverse
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (r &lt;- bySize <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> r.partitioner.isDefined &amp;&amp; r.partitioner.get.numPartitions &gt; 0<span style="font-size:12px;line-height:1.5;">) {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> r.partitioner.get
    }
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (rdd.context.conf.contains("spark.default.parallelism"<span style="font-size:12px;line-height:1.5;">)) {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> HashPartitioner(rdd.context.defaultParallelism)
    } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> HashPartitioner(bySize.head.partitions.size)
    }
  }
}

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 * A [[org.apache.spark.Partitioner]] that implements hash-based partitioning using
 * Java's `Object.hashCode`.
 *
 * Java arrays have hashCodes that are based on the arrays' identities rather than their contents,
 * so attempting to partition an RDD[Array[_]] or RDD[(Array[_], _)] using a HashPartitioner will
 * produce an unexpected or incorrect result.
 </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> HashPartitioner(partitions: Int) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> Partitioner {
  require(partitions </span>&gt;= 0, s"Number of partitions ($partitions) cannot be negative."<span style="font-size:12px;line-height:1.5;">)

  def numPartitions: Int </span>=<span style="font-size:12px;line-height:1.5;"> partitions

  def getPartition(key: Any): Int </span>=<span style="font-size:12px;line-height:1.5;"> key match {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> =&gt; 0
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> _ =&gt;<span style="font-size:12px;line-height:1.5;"> Utils.nonNegativeMod(key.hashCode, numPartitions)
  }

  override def equals(other: Any): Boolean </span>=<span style="font-size:12px;line-height:1.5;"> other match {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> h: HashPartitioner =&gt;<span style="font-size:12px;line-height:1.5;">
      h.numPartitions </span>==<span style="font-size:12px;line-height:1.5;"> numPartitions
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> _ =&gt;
      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">
  }

  override def hashCode: Int </span>=<span style="font-size:12px;line-height:1.5;"> numPartitions
}

</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
 * A [[org.apache.spark.Partitioner]] that partitions sortable records by range into roughly
 * equal ranges. The ranges are determined by sampling the content of the RDD passed in.
 *
 * Note that the actual number of partitions created by the RangePartitioner might not be the same
 * as the `partitions` parameter, in the case where the number of sampled records is less than
 * the value of `partitions`.
 </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> RangePartitioner[K : Ordering : ClassTag, V](
    @</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">transient</span><span style="font-size:12px;line-height:1.5;"> partitions: Int,
    @</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">transient</span> rdd: RDD[_ &lt;<span style="font-size:12px;line-height:1.5;">: Product2[K, V]],
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> var ascending: Boolean = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">)
  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;"> Partitioner {

  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> We allow partitions = 0, which happens when sorting an empty RDD under the default settings.</span>
  require(partitions &gt;= 0, s"Number of partitions cannot be negative but found $partitions."<span style="font-size:12px;line-height:1.5;">)

  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> var ordering =<span style="font-size:12px;line-height:1.5;"> implicitly[Ordering[K]]

  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> An array of upper bounds for the first (partitions - 1) partitions</span>
  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> var rangeBounds: Array[K] =<span style="font-size:12px;line-height:1.5;"> {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (partitions &lt;= 1<span style="font-size:12px;line-height:1.5;">) {
      Array.empty
    } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> This is the sample size we need to have roughly balanced output partitions, capped at 1M.</span>
      val sampleSize = math.min(20.0 *<span style="font-size:12px;line-height:1.5;"> partitions, 1e6)
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Assume the input partitions are roughly balanced and over-sample a little bit.</span>
      val sampleSizePerPartition = math.ceil(3.0 * sampleSize /<span style="font-size:12px;line-height:1.5;"> rdd.partitions.size).toInt
      val (numItems, sketched) </span>=<span style="font-size:12px;line-height:1.5;"> RangePartitioner.sketch(rdd.map(_._1), sampleSizePerPartition)
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (numItems == 0L<span style="font-size:12px;line-height:1.5;">) {
        Array.empty
      } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> If a partition contains much more than the average number of items, we re-sample from it
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> to ensure that enough items are collected from that partition.</span>
        val fraction = math.min(sampleSize / math.max(numItems, 1L), 1.0<span style="font-size:12px;line-height:1.5;">)
        val candidates </span>=<span style="font-size:12px;line-height:1.5;"> ArrayBuffer.empty[(K, Float)]
        val imbalancedPartitions </span>=<span style="font-size:12px;line-height:1.5;"> mutable.Set.empty[Int]
        sketched.foreach { </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (idx, n, sample) =&gt;
          <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (fraction * n &gt;<span style="font-size:12px;line-height:1.5;"> sampleSizePerPartition) {
            imbalancedPartitions </span>+=<span style="font-size:12px;line-height:1.5;"> idx
          } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
            </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> The weight is 1 over the sampling probability.</span>
            val weight = (n.toDouble /<span style="font-size:12px;line-height:1.5;"> sample.size).toFloat
            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (key &lt;-<span style="font-size:12px;line-height:1.5;"> sample) {
              candidates </span>+=<span style="font-size:12px;line-height:1.5;"> ((key, weight))
            }
          }
        }
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span><span style="font-size:12px;line-height:1.5;"> (imbalancedPartitions.nonEmpty) {
          </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Re-sample imbalanced partitions with the desired sampling probability.</span>
          val imbalanced = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> PartitionPruningRDD(rdd.map(_._1), imbalancedPartitions.contains)
          val seed </span>= byteswap32(-rdd.id - 1<span style="font-size:12px;line-height:1.5;">)
          val reSampled </span>= imbalanced.sample(withReplacement = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">, fraction, seed).collect()
          val weight </span>= (1.0 /<span style="font-size:12px;line-height:1.5;"> fraction).toFloat
          candidates </span>++= reSampled.map(x =&gt;<span style="font-size:12px;line-height:1.5;"> (x, weight))
        }
        RangePartitioner.determineBounds(candidates, partitions)
      }
    }
  }

  def numPartitions: Int </span>= rangeBounds.length + 1

  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> var binarySearch: ((Array[K], K) =&gt; Int) =<span style="font-size:12px;line-height:1.5;"> CollectionsUtils.makeBinarySearch[K]

  def getPartition(key: Any): Int </span>=<span style="font-size:12px;line-height:1.5;"> {
    val k </span>=<span style="font-size:12px;line-height:1.5;"> key.asInstanceOf[K]
    var partition </span>= 0
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (rangeBounds.length &lt;= 128<span style="font-size:12px;line-height:1.5;">) {
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> If we have less than 128 partitions naive search</span>
      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">while</span> (partition &lt; rangeBounds.length &amp;&amp;<span style="font-size:12px;line-height:1.5;"> ordering.gt(k, rangeBounds(partition))) {
        partition </span>+= 1<span style="font-size:12px;line-height:1.5;">
      }
    } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Determine which binary search method to use only once.</span>
      partition =<span style="font-size:12px;line-height:1.5;"> binarySearch(rangeBounds, k)
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> binarySearch either returns the match location or -[insertion point]-1</span>
      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (partition &lt; 0<span style="font-size:12px;line-height:1.5;">) {
        partition </span>= -partition-1<span style="font-size:12px;line-height:1.5;">
      }
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (partition &gt;<span style="font-size:12px;line-height:1.5;"> rangeBounds.length) {
        partition </span>=<span style="font-size:12px;line-height:1.5;"> rangeBounds.length
      }
    }
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span><span style="font-size:12px;line-height:1.5;"> (ascending) {
      partition
    } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
      rangeBounds.length </span>-<span style="font-size:12px;line-height:1.5;"> partition
    }
  }

  override def equals(other: Any): Boolean </span>=<span style="font-size:12px;line-height:1.5;"> other match {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> r: RangePartitioner[_, _] =&gt;<span style="font-size:12px;line-height:1.5;">
      r.rangeBounds.sameElements(rangeBounds) </span>&amp;&amp; r.ascending ==<span style="font-size:12px;line-height:1.5;"> ascending
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> _ =&gt;
      <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">
  }

  override def hashCode(): Int </span>=<span style="font-size:12px;line-height:1.5;"> {
    val prime </span>= 31<span style="font-size:12px;line-height:1.5;">
    var result </span>= 1<span style="font-size:12px;line-height:1.5;">
    var i </span>= 0
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">while</span> (i &lt;<span style="font-size:12px;line-height:1.5;"> rangeBounds.length) {
      result </span>= prime * result +<span style="font-size:12px;line-height:1.5;"> rangeBounds(i).hashCode
      i </span>+= 1<span style="font-size:12px;line-height:1.5;">
    }
    result </span>= prime * result +<span style="font-size:12px;line-height:1.5;"> ascending.hashCode
    result
  }

  @</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;">(classOf[IOException])
  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> def writeObject(out: ObjectOutputStream): Unit =<span style="font-size:12px;line-height:1.5;"> Utils.tryOrIOException {
    val sfactory </span>=<span style="font-size:12px;line-height:1.5;"> SparkEnv.get.serializer
    sfactory match {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> js: JavaSerializer =&gt;<span style="font-size:12px;line-height:1.5;"> out.defaultWriteObject()
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> _ =&gt;<span style="font-size:12px;line-height:1.5;">
        out.writeBoolean(ascending)
        out.writeObject(ordering)
        out.writeObject(binarySearch)

        val ser </span>=<span style="font-size:12px;line-height:1.5;"> sfactory.newInstance()
        Utils.serializeViaNestedStream(out, ser) { stream </span>=&gt;<span style="font-size:12px;line-height:1.5;">
          stream.writeObject(scala.reflect.classTag[Array[K]])
          stream.writeObject(rangeBounds)
        }
    }
  }

  @</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;">(classOf[IOException])
  </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> def readObject(in: ObjectInputStream): Unit =<span style="font-size:12px;line-height:1.5;"> Utils.tryOrIOException {
    val sfactory </span>=<span style="font-size:12px;line-height:1.5;"> SparkEnv.get.serializer
    sfactory match {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> js: JavaSerializer =&gt;<span style="font-size:12px;line-height:1.5;"> in.defaultReadObject()
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> _ =&gt;<span style="font-size:12px;line-height:1.5;">
        ascending </span>=<span style="font-size:12px;line-height:1.5;"> in.readBoolean()
        ordering </span>=<span style="font-size:12px;line-height:1.5;"> in.readObject().asInstanceOf[Ordering[K]]
        binarySearch </span>= in.readObject().asInstanceOf[(Array[K], K) =&gt;<span style="font-size:12px;line-height:1.5;"> Int]

        val ser </span>=<span style="font-size:12px;line-height:1.5;"> sfactory.newInstance()
        Utils.deserializeViaNestedStream(in, ser) { ds </span>=&gt;<span style="font-size:12px;line-height:1.5;">
          implicit val classTag </span>=<span style="font-size:12px;line-height:1.5;"> ds.readObject[ClassTag[Array[K]]]()
          rangeBounds </span>=<span style="font-size:12px;line-height:1.5;"> ds.readObject[Array[K]]()
        }
    }
  }
}

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span><span style="font-size:12px;line-height:1.5;">[spark] object RangePartitioner {

  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
   * Sketches the input RDD via reservoir sampling on each partition.
   *
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@param</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> rdd the input RDD to sketch
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@param</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> sampleSizePerPartition max sample size per partition
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@return</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> (total number of items, an array of (partitionId, number of items, sample))
   </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span><span style="font-size:12px;line-height:1.5;">
  def sketch[K : ClassTag](
      rdd: RDD[K],
      sampleSizePerPartition: Int): (Long, Array[(Int, Int, Array[K])]) </span>=<span style="font-size:12px;line-height:1.5;"> {
    val shift </span>=<span style="font-size:12px;line-height:1.5;"> rdd.id
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> val classTagK = classTag[K] </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> to avoid serializing the entire partitioner object</span>
    val sketched = rdd.mapPartitionsWithIndex { (idx, iter) =&gt;<span style="font-size:12px;line-height:1.5;">
      val seed </span>= byteswap32(idx ^ (shift &lt;&lt; 16<span style="font-size:12px;line-height:1.5;">))
      val (sample, n) </span>=<span style="font-size:12px;line-height:1.5;"> SamplingUtils.reservoirSampleAndCount(
        iter, sampleSizePerPartition, seed)
      Iterator((idx, n, sample))
    }.collect()
    val numItems </span>=<span style="font-size:12px;line-height:1.5;"> sketched.map(_._2.toLong).sum
    (numItems, sketched)
  }

  </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
   * Determines the bounds for range partitioning from candidates with weights indicating how many
   * items each represents. Usually this is 1 over the probability used to sample this candidate.
   *
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@param</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> candidates unordered candidates with weights
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@param</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> partitions number of partitions
   * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@return</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> selected bounds
   </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span><span style="font-size:12px;line-height:1.5;">
  def determineBounds[K : Ordering : ClassTag](
      candidates: ArrayBuffer[(K, Float)],
      partitions: Int): Array[K] </span>=<span style="font-size:12px;line-height:1.5;"> {
    val ordering </span>=<span style="font-size:12px;line-height:1.5;"> implicitly[Ordering[K]]
    val ordered </span>=<span style="font-size:12px;line-height:1.5;"> candidates.sortBy(_._1)
    val numCandidates </span>=<span style="font-size:12px;line-height:1.5;"> ordered.size
    val sumWeights </span>=<span style="font-size:12px;line-height:1.5;"> ordered.map(_._2.toDouble).sum
    val step </span>= sumWeights /<span style="font-size:12px;line-height:1.5;"> partitions
    var cumWeight </span>= 0.0<span style="font-size:12px;line-height:1.5;">
    var target </span>=<span style="font-size:12px;line-height:1.5;"> step
    val bounds </span>=<span style="font-size:12px;line-height:1.5;"> ArrayBuffer.empty[K]
    var i </span>= 0<span style="font-size:12px;line-height:1.5;">
    var j </span>= 0<span style="font-size:12px;line-height:1.5;">
    var previousBound </span>=<span style="font-size:12px;line-height:1.5;"> Option.empty[K]
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">while</span> ((i &lt; numCandidates) &amp;&amp; (j &lt; partitions - 1<span style="font-size:12px;line-height:1.5;">)) {
      val (key, weight) </span>=<span style="font-size:12px;line-height:1.5;"> ordered(i)
      cumWeight </span>+=<span style="font-size:12px;line-height:1.5;"> weight
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (cumWeight &gt;<span style="font-size:12px;line-height:1.5;"> target) {
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Skip duplicate values.</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (previousBound.isEmpty ||<span style="font-size:12px;line-height:1.5;"> ordering.gt(key, previousBound.get)) {
          bounds </span>+=<span style="font-size:12px;line-height:1.5;"> key
          target </span>+=<span style="font-size:12px;line-height:1.5;"> step
          j </span>+= 1<span style="font-size:12px;line-height:1.5;">
          previousBound </span>=<span style="font-size:12px;line-height:1.5;"> Some(key)
        }
      }
      i </span>+= 1<span style="font-size:12px;line-height:1.5;">
    }
    bounds.toArray
  }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
    <p><font><span style="font-size:14px;">本文转自大数据躺过的坑博客园博客，原文链接：http://www.cnblogs.com/zlslch/p/5921572.html，如需转载请自行联系原作者</span></font><br></p> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
