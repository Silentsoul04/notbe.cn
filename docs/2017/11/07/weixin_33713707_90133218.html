<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HDU 5052 Yaoge’s maximum profit 光秃秃的树链拆分 2014 ACM/ICPC Asia Regional Shanghai Online... « NotBeCN</title>
  <meta name="description" content="             意甲冠军：    特定n小点的树权。    以下n每一行给出了正确的一点点来表达一个销售点每只鸡价格的格    以下n-1行给出了树的侧    以下Q操作    Q行    u, v, val    从u走v，程中能够买一个鸡腿，然后到后面卖掉，输出max(0, 最大的收益)    然后...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/07/weixin_33713707_90133218.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">HDU 5052 Yaoge’s maximum profit 光秃秃的树链拆分 2014 ACM/ICPC Asia Regional Shanghai Online...</h1>
    <p class="post-meta">Nov 7, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">意甲冠军：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">特定n小点的树权。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">以下n每一行给出了正确的一点点来表达一个销售点每只鸡价格的格</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">以下n-1行给出了树的侧</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">以下Q操作</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Q行</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">u, v, val</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">从u走v，程中能够买一个鸡腿，然后到后面卖掉，输出max(0, 最大的收益)</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">然后给[u,v]路径上点点权+=val</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">思路：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">树链剖分裸题。记录区间的最大最小值，→走的答案和←走的答案。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">官方题解：<a href="http://www.kuangbin.net/archives/2014shanghaionline" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">点击打开链接</a></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <pre><code class="language-cpp">#pragma comment(linker, "/STACK:1024000000,1024000000")
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;cmath&gt;
#include &lt;queue&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
using namespace std;
typedef long long ll;
const ll inf = 1e16;
inline void rd(int &amp;n){
	n = 0;
	char c = getchar();
	while(c &lt; '0' || c &gt; '9') c = getchar();
	while(c &gt;= '0' &amp;&amp; c &lt;= '9') n *= 10, n += (c - '0'),c = getchar();
}
void pt64(ll num){
     if(num&lt;0) {
         putchar('-');
         num=-num;
     }
     int ans[20],top=0;
     while(num!=0)     {
         ans[top++]=num%10;
         num/=10;
     }
     if(top==0) putchar('0');
     for(int i=top-1;i&gt;=0;i--)
         putchar(ans[i]+'0');
	 putchar('\n');
}
#define N 50010
struct Edge{
	int to, nex;
}edge[N*2];
int head[N], edgenum;
void add(int u, int v){	Edge E = {v, head[u]}; edge[edgenum] = E; head[u] = edgenum++;}
void init(){memset(head, -1, sizeof head); edgenum = 0;}
int fa[N], son[N], siz[N], dep[N], tree_id;
//父节点 重儿子 子树节点数 深度 线段树标号
int w[N], fw[N], p[N];
//父边在线段树中的标号 节点顶端的点
void dfs(int u, int Father, int deep){
	fa[u] = Father; son[u] = 0; dep[u] = deep; siz[u] = 1;
	for(int i = head[u]; ~i; i = edge[i].nex) {
		int v = edge[i].to; if(v == Father) continue;
		dfs(v, u, deep+1);
		siz[u] += siz[v];
		if(siz[v] &gt; siz[son[u]])son[u] = v;
	}
}
void Have_p(int u, int Father){
	w[u] = ++ tree_id; fw[tree_id] = u; p[u] = Father;
	if(son[u])
		Have_p(son[u], Father);
	else return ;
	for(int i = head[u]; ~i; i = edge[i].nex) {
		int v = edge[i].to; if(v == fa[u] || v == son[u])continue;
		Have_p(v, v);
	}
}
#define Lson(x) tree[x].l
#define Rson(x) tree[x].r
#define L(x) (x&lt;&lt;1)
#define R(x) (x&lt;&lt;1|1)
#define Lazy(x) tree[x].lazy
#define Ans0(x) tree[x].ans[0]
#define Ans1(x) tree[x].ans[1]
#define Min(x) tree[x].min
#define Max(x) tree[x].max
struct node {
	int l, r;
	ll ans[2], min, max, lazy;
}tree[N&lt;&lt;2];
int a[N];
void push_down(int id){
	if(Lazy(id)){
		Min(L(id)) += Lazy(id);
		Max(L(id)) += Lazy(id);
		Min(R(id)) += Lazy(id);
		Max(R(id)) += Lazy(id);
		Lazy(L(id)) += Lazy(id);
		Lazy(R(id)) += Lazy(id);
		Lazy(id) = 0;
	}
}
void push_up(int id){
	Min(id) = min(Min(L(id)), Min(R(id)));
	Max(id) = max(Max(L(id)), Max(R(id)));
	Ans0(id) = max(Ans0(L(id)), Ans0(R(id)));
	Ans0(id) = max(Ans0(id), Max(R(id)) - Min(L(id)));
	Ans1(id) = max(Ans1(L(id)), Ans1(R(id)));
	Ans1(id) = max(Ans1(id), Max(L(id)) - Min(R(id)));
}
void build(int l, int r, int id){
	Lson(id) = l; Rson(id) = r;
	Lazy(id) = 0;
	if(l == r) {
		Ans0(id) = Ans1(id) = 0;
		Min(id) = Max(id) = (ll)a[fw[l]];
		return ;
	}
	int mid = (l + r)&gt;&gt;1;
	build(l, mid, L(id)); build(mid+1, r, R(id));
	push_up(id);
}
void updata(int l, int r, ll val, int id){
	if(l == Lson(id) &amp;&amp; Rson(id) == r){
		Min(id) += val;
		Max(id) += val;
		Lazy(id) += val;
		return ;
	}
	push_down(id);
	int mid = (Lson(id) + Rson(id)) &gt;&gt;1;
	if(mid &lt; l)
		updata(l, r, val, R(id));
	else if(r &lt;= mid)
		updata(l, r, val, L(id));
	else {
		updata(l, mid, val, L(id));
		updata(mid+1, r, val, R(id));
	}
	push_up(id);
}
ll query(int l, int r, int hehe, ll &amp;minn, ll &amp;maxx, int id){
	if(l == Lson(id) &amp;&amp; Rson(id) == r){
		maxx = Max(id);
		minn = Min(id);
		if(hehe == 0) return Ans0(id);
		else return Ans1(id);
	}
	push_down(id);
	int mid = (Lson(id) + Rson(id)) &gt;&gt;1;
	if(mid &lt; l)
		return query(l, r, hehe, minn, maxx, R(id));
	else if(r &lt;= mid)
		return query(l, r, hehe, minn, maxx, L(id));
	else {
		ll maxl = 0, minl = 0, maxr = 0, minr = 0, ans;
		ans = max(query(l, mid, hehe, minl, maxl, L(id)), query(mid+1, r, hehe, minr, maxr, R(id)));
		maxx = max(maxl, maxr);
		minn = min(minl, minr);
		if(hehe == 0) {
			return max(ans, maxr - minl);
		}
		else {
			return max(ans, maxl - minr);
		}
	}
}
int n, que;
ll Qu(int l, int r){
	int f1 = p[l], f2 = p[r];
	ll ans = 0, maxl = -inf, minl = inf, maxr = -inf, minr = inf, tmax, tmin;
	while(f1 != f2){
		if(dep[f1] &gt; dep[f2]) {
			ans = max(ans, query(w[f1], w[l], 1, tmin, tmax, 1));
			ans = max(ans, tmax - minl);
			maxl = max(maxl, tmax);
			minl = min(minl, tmin);
			l = fa[f1]; f1 = p[l];
		}
		else {
			ans = max(ans, query(w[f2], w[r], 0, tmin, tmax, 1));
			ans = max(ans, maxr - tmin);
			maxr = max(maxr, tmax);
			minr = min(minr, tmin);
			r = fa[f2]; f2 = p[r];
		}
	}
	if(dep[l] &lt; dep[r])	{
		ans = max(ans, query(w[l], w[r], 0, tmin, tmax, 1));
	}
	else {
		ans = max(ans, query(w[r], w[l], 1, tmin, tmax, 1));
	}
	ans = max(ans, tmax - minl);
	ans = max(ans, maxr - tmin);
	ans = max(ans, maxr - minl);
	return ans;
}
void Up(int l, int r, ll val){
	int f1 = p[l], f2 = p[r];
	while(f1 != f2) {
		if(dep[f1] &lt; dep[f2])
			swap(f1, f2), swap(l, r);
		updata(w[f1], w[l], val, 1);
		l = fa[f1]; f1 = p[l];
	}
	if(dep[l] &gt; dep[r]) swap(l, r);
	updata(w[l], w[r], val, 1);
}
void input() {
	init();
	rd(n);
	for(int i = 1; i &lt;= n; i++) rd(a[i]);
	for(int i = 1, u, v; i &lt; n; i++) {
		rd(u); rd(v);
		add(u, v); add(v, u);
	}
	siz[0] = tree_id = 0;
	dfs(1, 1, 1);
	Have_p(1, 1);
	build(1, n, 1);
}
int main() {
	int T, Cas = 1, u, v, val; rd(T);
	while (T -- ) {
		input();
		rd(que);
		while( que -- ) {
			rd(u); rd(v); rd(val);
			pt64( Qu(u, v) );
			Up(u, v, (ll)val);
		}
	}
	return 0;
}
/*
99
8
3 2 1 5 4 6 7 2
1 2 
2 3
2 4
3 5
5 6
5 8
4 7
99
2 6 2
3 4 5
6 1 2
5 7 3
8 1 4
2 3 1
4 4 1
6 3 5
4 7 2 
7 6 3
5 8 3

12
3 4 2 1 5 9 6 10 8 7 11 12
1 3
1 2
3 4
2 5
2 6
5 7
7 9
7 10
6 8
8 11
12 8
8
1 12 0
4 5 0
10 12 0
7 12 3
11 6 2
4 12 100
4 12 0
7 12 3

8
42 68 35 1 70 25 79 59
1 2
2 3
2 4
3 5
5 6
5 8
4 7
30
3 1 2
2 2 4
2 4 4
7 4 5
8 5 7
2 5 7
6 5 7
8 8 7
4 3 6
1 4 4
4 7 8
4 3 6
2 1 6
8 6 5
4 5 7
6 6 4
4 6 2
3 5 4
7 3 1
3 1 7
1 1 7
6 3 2
3 7 7
6 2 5
6 8 5
3 5 1
7 1 4
5 1 8
3 4 2
3 7 3

*/
</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <div> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;">版权声明：本文博客原创文章。博客，未经同意，不得转载。</p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p><font color="#333333"><span style="font-size:12px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/4629248.html，如需转载请自行联系原作者</span></font></p> 
    <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
