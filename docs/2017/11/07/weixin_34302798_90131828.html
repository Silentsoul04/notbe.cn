<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>“老坛泡新菜”:SOD MVVM框架，让WinForms焕发新春 « NotBeCN</title>
  <meta name="description" content="             火热的MVVM框架    最近几年最热门的技术之一就是前端技术了，各种前端框架，前端标准和前端设计风格层出不穷，而在众多前端框架中具有MVC，MVVM功能的框架成为耀眼新星，比如GitHub关注度很高的Vue.js ,由于是国人作品，其设计风格和文档友好度对国人而言更胜一筹，因此我也将它...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/07/weixin_34302798_90131828.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">“老坛泡新菜”:SOD MVVM框架，让WinForms焕发新春</h1>
    <p class="post-meta">Nov 7, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">火热的MVVM框架</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">最近几年最热门的技术之一就是前端技术了，各种前端框架，前端标准和前端设计风格层出不穷，而在众多前端框架中具有MVC，MVVM功能的框架成为耀眼新星，比如GitHub关注度很高的Vue.js ,由于是国人作品，其设计风格和文档友好度对国人而言更胜一筹，因此我也将它推荐到公司采用，其中我推荐都理由就是它非常优秀的MVVM功能，面向数据而不是面向DOM细节相比jQuery等更加节省代码，更符合后端程序员的胃口，也更有利于UI设计人员跟程序员都分工配合。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是Vue.js实现MVVM功能的原理图：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113223417374-876447239.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">前面说的Vue.js框架这些优点的是否很眼熟？没错，这就是早些年流行于WPF的MVVM技术，相比WinForms技术，WPF可以提供给UI设计人员更加强大的设计能力，做出更炫更好看的界面。只不过MS的很多技术总是很超前技术更新很快，WPF新推出的时候WinForms还占据桌面开发主要领域，随后还没有火起来移动开发时代已经来临，基于Web的前端技术大大发展，从而风头盖过了WPF，但是WPF引入的MVVM思想却在Web前端得到了发扬光大，现在各种基于MVVM的前端框架犹如雨后春笋。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">WinForms上的MVVM需求</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">Web前端技术的大力发展，各种跨平台的基于HTML5的移动前端开发技术逐渐成熟，各种应用逐步由传统的C/S 转换到 B/S ,APP模式，基于C/S模式的前端技术比如WPF的关注度逐渐下降，因此WPF上的MVVM并不是应用得很广，目前很多遗留的或者新的 C/S系统仍然采用WinForms技术开发维护，然而WinForms 上却没有良好的MVVM框架，WinForms 的UI效果和整体开发质量，开发效率没有得到有效提高，要过度到WPF开发这种不同开发风格的技术难度又比较大，所以，如果有一种能够在 WinForms 上的MVVM框架，无疑是广大后端.NET程序员的福音。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">笔者一直是一个奋斗在一线的.NET开发人员，架构师，对于Web 和桌面，后端开发技术都有广泛的涉及，深刻理解开发人员自嘲自己为“码农”的心理的，工作辛苦又没有时间陪女朋友陪家人，所以我一直总结整理如何提高开发效率，改善开发质量的方法，经过近10年的时间，发展完善了一套开发框架—SOD框架。最近研究改善Web前端开发的技术，Vue.js框架的MVVM思想再一次让我觉得WinForms上MVVM技术的必要性，发现要实现MVVM框架其实并不难，关键在于模型（Model）和视图（View）的双向绑定，即模型的改变引起视图内容的改变，而视图的改变也能够引起模型的改变。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">SOD WinForms MVVM实现原理</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">要实现这种改变，对于被绑定方，必须具有属性改变通知功能，当绑定方改变的时候，通知被绑定方让它做相应的处理。在.NET中，实现这种通知功能的接口就是：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;INotifyPropertyChanged</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">它的定义在System.dll 中，早在 .NET 2.0 就已经支持。下面是该接口的具体定义：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> System.ComponentModel
{
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 摘要: 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">     向客户端发出某一属性值已更改的通知。</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">interface</span><span style="line-height:1.5;"> INotifyPropertyChanged
    {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 摘要: 
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">     在更改属性值时发生。</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">event</span><span style="line-height:1.5;"> PropertyChangedEventHandler PropertyChanged;
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br> SOD框架的实体类基类 EntityBase 实现了此接口：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> EntityBase : INotifyPropertyChanged, ICloneable, PWMIS.Common.IEntity
{
</span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
        <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> 属性改变事件
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">event</span><span style="line-height:1.5;"> PropertyChangedEventHandler PropertyChanged;
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
        <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> 触发属性改变事件
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
        <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;param name="propertyFieldName"&gt;</span><span style="color:rgb(0,128,0);line-height:1.5;">属性改变事件对象</span><span style="color:rgb(128,128,128);line-height:1.5;">&lt;/param&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);line-height:1.5;">virtual</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> OnPropertyChanged(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> propertyFieldName)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (<span style="color:rgb(0,0,255);line-height:1.5;">this</span>.PropertyChanged != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">string</span> currPropName = EntityFieldsCache.Item(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.GetType()).GetPropertyName(propertyFieldName);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span>.PropertyChanged(<span style="color:rgb(0,0,255);line-height:1.5;">this</span>, <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> PropertyChangedEventArgs(currPropName));
            }
       }
</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 其它代码略… … </span>
  }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">所以SOD框架的实体类可以直接用来作为MVVM上的Model提供给View 做为被绑定对象，因此要我们只需要解决WinForms 形式的View 元素如何实现绑定操作，那么我们的WinForms 应用即可实现MVVM功能了。在WinForms 上，控件基本上都已经实现了绑定功能，它就是控件的 DataBindings，向它添加绑定即可，例如下面的例子：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">this</span>.textbox1.DataBindings.Add(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Text</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, userEntity, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>);</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这样当文本框架输入的内容改变后，实体类对象 userEntity.Name 属性的值也会改变。如果userEntity是SOD实体类，所以userEntity.Name 改变，文本框的Text属性也会同步改变。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">SOD框架的数据控件(WinForms,WebForms)都实现了 IDataControl 接口，它定义了几个重要的属性 LinkObject，LinkProperty ：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
    <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> 数据映射控件接口
    </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">interface</span><span style="line-height:1.5;"> IDataControl
    {
        
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
        <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> 与数据库数据项相关联的数据
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> LinkProperty
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;
        }
        
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
        <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> 与数据关联的表名
        </span><span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> LinkObject
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;
        }
</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 其它接口方法内容略… … </span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span style="font-family:'宋体';font-size:10.5pt;">我们可以使用<span style="font-family:Calibri, sans-serif;font-size:10.5pt;">&nbsp;<span>LinkObject&nbsp;<span style="font-family:'宋体';font-size:10.5pt;">来指定要绑定的实体类对象，而<span style="font-family:Calibri, sans-serif;font-size:10.5pt;">LinkProperty&nbsp;<span style="font-family:'宋体';font-size:10.5pt;">来指定要绑定的对象的属性，因此可以通过下面的代码实现<span style="font-family:Calibri, sans-serif;font-size:10.5pt;">WinForms&nbsp;<span style="font-family:'宋体';font-size:10.5pt;">控件与<span style="font-family:Calibri, sans-serif;font-size:10.5pt;">SOD<span style="font-family:'宋体';font-size:10.5pt;">实体类的双向绑定：</span></span></span></span></span></span></span></span></span></span></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> BindDataControls(Control.ControlCollection controls)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> dataControls =<span style="line-height:1.5;"> MyWinForm.GetIBControls(controls);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">foreach</span> (IDataControl control <span style="color:rgb(0,0,255);line-height:1.5;">in</span><span style="line-height:1.5;"> dataControls)
            {
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">control.LinkObject 这里都是 "DataContext"</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">object</span> dataSource =<span style="line-height:1.5;"> GetInstanceByMemberName(control.LinkObject);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (control <span style="color:rgb(0,0,255);line-height:1.5;">is</span><span style="line-height:1.5;"> TextBox)
                {
                    ((TextBox)control).DataBindings.Add(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Text</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, dataSource, control.LinkProperty);
                }
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (control <span style="color:rgb(0,0,255);line-height:1.5;">is</span><span style="line-height:1.5;"> Label)
                {
                    ((Label)control).DataBindings.Add(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Text</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, dataSource, control.LinkProperty);
                }
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (control <span style="color:rgb(0,0,255);line-height:1.5;">is</span><span style="line-height:1.5;"> ListBox)
                {
                    ((ListBox)control).DataBindings.Add(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SelectedValue</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, dataSource, control.LinkProperty, <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">, DataSourceUpdateMode.OnPropertyChanged);
                }
            }
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">另外，我们可能还需要将 一些命令绑定到视图上，而要实现此功能也比较简单：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">private</span> Dictionary&lt;<span style="color:rgb(0,0,255);line-height:1.5;">object</span>, CommandMethod&gt;<span style="line-height:1.5;"> dictCommand;
</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">delegate</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> CommandMethod();

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> BindCommandControls(Control control,CommandMethod command)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (control <span style="color:rgb(0,0,255);line-height:1.5;">is</span><span style="line-height:1.5;"> Button)
            {
                dictCommand.Add(control, command);
                ((Button)control).Click </span>+= (sender, e) =&gt;<span style="line-height:1.5;"> {
                    dictCommand[sender](); 
                };
            }
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">经过这样的过程后，我们仅需要在窗体加载事件上写下面的几行代码就行了：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>SubmitedUsersViewModel DataContext{<span style="color:rgb(0,0,255);line-height:1.5;">get</span>;<span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">;}

       </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> Form1_Load(<span style="color:rgb(0,0,255);line-height:1.5;">object</span><span style="line-height:1.5;"> sender, EventArgs e)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">base</span>.BindDataControls(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.Controls);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">base</span>.BindCommandControls(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.button1, DataContext.SubmitCurrentUsers);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">base</span>.BindCommandControls(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.button2, DataContext.UpdateUser);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">base</span>.BindCommandControls(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.button3, DataContext.RemoveUser);
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面的代码中，首先定义了一个视图模型对象 DataContext,在方法 BindDataControls 里面作为绑定到视图控件上的对象，它里面的 CurrentUser属性的Name属性绑定到了文本框控件上，所以 CurrentUser.Name 是作为复合属性来绑定的，对于标签控件和列表框控件，也是类似的过程，如下图:</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113223830280-1365914432.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113223848499-1183625850.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这样，在视图上做简单的数据属性设置和写少量的code behind绑定代码，一个具有双向绑定功能的程序就好了。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">MVVM示例解决方案</h1> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">解决方案概览</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">为了向大家演示SOD框架对于MVVM的支持，我们搭建一个简单的解决方案，一共分为三个项目程序集，分别对应MVVM的三大部分：</p> 
   <p align="left" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">WinFormMvvm:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WinForm 示例程序主程序，视图类所在程序集</p> 
   <p align="left" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">WinFormMvvm.Model:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 模型类程序集</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">WinFormMvvm.ViewModel:&nbsp; 视图模型程序集</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">搭建好的解决方案图如下：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113223926311-514619070.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">注意：此解决方案是使用SOD Ver 5.5.5.1019 做的，因为这是目前nuget 上SOD的版本，最新的SOD框架已经把WinFormMvvm项目的 MvvmForm.cs 文件纳入到框架之内了。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;程序在App.config中指定了本次附加测试的数据库，数据库类型为 Access，默认的连接字符串可能要求Office 2007以上版本支持。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是App.config 的内容：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);line-height:1.5;">xml version="1.0" encoding="utf-8"</span><span style="color:rgb(0,0,255);line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">configuration</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">connectionStrings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">name </span><span style="color:rgb(0,0,255);line-height:1.5;">="default"</span><span style="color:rgb(255,0,0);line-height:1.5;"> connectionString </span><span style="color:rgb(0,0,255);line-height:1.5;">="Provider=Microsoft.ACE.OLEDB.12.0;Jet OLEDB:Engine Type=6;Data Source=testdb.accdb"</span><span style="color:rgb(255,0,0);line-height:1.5;"> providerName</span><span style="color:rgb(0,0,255);line-height:1.5;">="Access"</span><span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">connectionStrings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">startup</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span> 
        <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">supportedRuntime </span><span style="color:rgb(255,0,0);line-height:1.5;">version</span><span style="color:rgb(0,0,255);line-height:1.5;">="v4.0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> sku</span><span style="color:rgb(0,0,255);line-height:1.5;">=".NETFramework,Version=v4.5"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">startup</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">runtime</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">assemblyBinding </span><span style="color:rgb(255,0,0);line-height:1.5;">xmlns</span><span style="color:rgb(0,0,255);line-height:1.5;">="urn:schemas-microsoft-com:asm.v1"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">dependentAssembly</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">assemblyIdentity </span><span style="color:rgb(255,0,0);line-height:1.5;">name</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.Core"</span><span style="color:rgb(255,0,0);line-height:1.5;"> publicKeyToken</span><span style="color:rgb(0,0,255);line-height:1.5;">="17ba13a12b9fd814"</span><span style="color:rgb(255,0,0);line-height:1.5;"> culture</span><span style="color:rgb(0,0,255);line-height:1.5;">="neutral"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">bindingRedirect </span><span style="color:rgb(255,0,0);line-height:1.5;">oldVersion</span><span style="color:rgb(0,0,255);line-height:1.5;">="0.0.0.0-5.5.5.1019"</span><span style="color:rgb(255,0,0);line-height:1.5;"> newVersion</span><span style="color:rgb(0,0,255);line-height:1.5;">="5.5.5.1019"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">dependentAssembly</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">assemblyBinding</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">runtime</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">configuration</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果你需要更低版本的 Access 数据库支持，或者换用其它数据库（比如 SqlServer)，请阅读参考下面步骤提供的信息：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">1，打开下面链接：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;&nbsp; http://pwmis.codeplex.com/</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">2，看到内容章节“3，修改下App.config 文件的连接配置”；</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">3，点击本节下的链接“2.2.3 扩展数据访问类配置”。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">创建MVVM的WinForm视图</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这是一个简单的WinForm 窗体，有三个SOD“数据控件”，包括：一个标签控件显示用户的ID，文本框控件显示用户名，一个列表框控件显示已经有用户列表，三个按钮分别用来向列表添加，修改和删除数据。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113224032467-509737894.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">对于数据控件，可以在此窗体设计器界面，打开“工具箱”，在“常规”选项卡里面，选择上下文菜单“选择项”，浏览到packages\PDF.NET.SOD.WinForm.Extensions.5.5.5.1020\lib目录，选择“Pwmis.Windows.dll” ，即可看到SOD的数据控件，然后拖拽到窗体上即可。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113224055295-1939351502.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">注意我们不会给这三个按钮控件直接设置单击事件，而是通过命令绑定的形式。例如对应添加按钮，我们如下绑定命令（视图模型的一个方法）：</p> 
   <p align="left" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">base.BindCommandControls(this.button1, DataContext.SubmitCurrentUsers);</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这会将添加用户的按钮控件的单击事件，绑定到DataContext的SubmitCurrentUsers 方法上。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">而对于数据控件的绑定，只需要下面的一行代码：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">base</span>.BindDataControls(<span style="color:rgb(0,0,255);line-height:1.5;">this</span>.Controls);</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">前面已经说过，该方法会遍历方法上第一个参数里面的所有数据控件，找到LinkObject和LinkProperty属性，实现数据控件和视图模型对象的绑定，这里绑定的是 DataContext对象的CurrentUser对象的属性。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">单击属性浏览器中数据控件的LinkProperty 属性旁边的“…”按钮，会弹出下面的“数据控件属性选择器”窗体：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113224156217-1016085053.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">由于这里我们要绑定的对象是当前窗体的DataContext对象，所以需要浏览选择到主程序集，这样在属性名称一栏，会显示此对象所有的属性和子属性。注意如果DataContext对象没有出现在列表里面，需要检查Form 窗体是否声明了 DataContext对象，并且需要首先编译一次程序集。最后，单击确定，我们就设置好了数据控件要绑定的信息。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">创建MVVM的模型</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">我们的模型很简单，就是负责创建新用户，加载已有用户，添加，修改或者删除用户，并且这些操作都是针对数据库的，也就是我们通常的CRUD操作。由于是示例没有太多逻辑，我们直接看代码即可：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">用户模型类会使用用户实体类，它也很简单，只有一个ID属性和一个Name属性，详细内容如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> UserEntity:EntityBase
    {
       </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> UserEntity()
       {
           TableName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Tb_User</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
           PrimaryKeys.Add(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">UserID</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
       }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> ID {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">return</span> getProperty&lt;<span style="color:rgb(0,0,255);line-height:1.5;">int</span>&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">UserID</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">); }
            </span><span style="color:rgb(0,0,255);line-height:1.5;">set</span> { setProperty(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">UserID</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, value); }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> Name
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">return</span> getProperty&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">UserName</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">); }
            </span><span style="color:rgb(0,0,255);line-height:1.5;">set</span> { setProperty(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">UserName</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, value); }
        }

    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">该用户实体类虽然很简单，却可以直接提供给视图作为模型绑定的元素，因为SOD实体类都实现了“属性修改通知”接口，前面已经详细说明。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">接下来就是操作此用户实体类的数据上下文了，用户模型类展示了如何使用它，但是它的定义却很简单：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> LocalDbContext : DbContext
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> LocalDbContext()
            : </span><span style="color:rgb(0,0,255);line-height:1.5;">base</span>(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">default</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">local 是连接字符串名字 </span>
<span style="line-height:1.5;">        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);line-height:1.5;">override</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> CheckAllTableExists()
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">创建用户表 </span>
            CheckTableExists&lt;UserEntity&gt;<span style="line-height:1.5;">();
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">至此，一个简单的MVVM模型类的全部定义就完成了。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">创建MVVM的视图模型</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">视图模型是对视图的一个抽象，它封装了主要的视图处理逻辑，与MVP的Presenter不同，视图模型并不会包含详细视图元素的抽象，比如一个抽象的列表控件，而是对视图可能用到的数据进行封装，并且可能包含对后端MVVM的模型对象调用。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在本例中，我们的用户视图模型的功能也很简单，就是提供视图需要的用户列表和响应视图的增加，修改，删除用户的命令，详细代码如下</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</h2> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">添加Nuget包引用</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">对于整个解决方案，我们都需要添加 PDF.NET Core 包，但是对于我们的WinForms 主程序，需要额外添加2个相关的包，一个SOD WinForm扩展和一个SOD Access 扩展，下面是解决方案安装的全部包示意图：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113224449155-1904314089.png" alt="" style="border:0px;"></p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</h2> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">运行解决方案</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">经过上面的过程，我们添加了视图元素，设置好了视图元素的数据绑定，创建了模型和视图模型对象，一个简单的MVVM示例程序就好了，下面是运行效果图：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/114517/201611/114517-20161113231047639-1150266717.png" alt="" style="border:0px;"></p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</h1> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">MVVM模式总结</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">通过运行此示例，相信你已经体验了MVVM的一些特点，但可能难以表述贴切，正好我跟几个WPF资深专家交流后，他们总结出了MVVM的几个核心特点（卖点）：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">1，视图逻辑（视图模型）和视图（视图元素，样式）的解除耦合；<br> 2，视图和视图模型或者模型的双向数据绑定，面向数据驱动视图而不是视图驱动数据；</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">3，视图和视图模型的分离将界面功能全部代码化，并提供TDD可能性。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">SOD WinForms MVVM支持</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">自SOD框架版本 5.6.0.1111 发布的这个“光棍节“版本中，您已经可以在此以后的版本中获得直接的WinForms MVVM支持，如果是之前的版本，那么需要本示例程序一样稍微多做一点工作，但这对于你现有的SOD支持的解决方案来说不会造成任何影响。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">本示例方案将会放到框架的开源网站&nbsp;<a href="http://pwmis.codeplex.com/" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">http://pwmis.codeplex.com</a>&nbsp;上提供直接的下载，并且源码已经全部提交，可以通过下面地址查看详细的代码说明：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://pwmis.codeplex.com/SourceControl/latest#SOD/Example/WinFormMvvm/WinFormMvvm/Readme.txt" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">http://pwmis.codeplex.com/SourceControl/latest#SOD/Example/WinFormMvvm/WinFormMvvm/Readme.txt</a></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">了解更多信息或者加入社区QQ群讨论，或者捐助本框架，请移步框架官网：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://www.pwmis.com/sqlmap" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">http://www.pwmis.com/sqlmap</a></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">感谢你选择SOD框架，相信它能够为你的开发带来很大的便利！</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">SOD开发团队</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">深蓝医生</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">2016.11.13</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">------------PS---------------</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">感谢SOD开发团队的 @广州-银古 同学，他已经及时将SOD框架的 nuget包更新到了最新版本，没有前面说的 nuget包问题了。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p><font><span style="font-size:15px;">&nbsp; &nbsp; 本文转自深蓝医生博客园博客，原文链接：http://www.cnblogs.com/bluedoctor/p/6060278.html</span></font><span style="font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
