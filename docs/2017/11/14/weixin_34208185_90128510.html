<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>如何扩展 Visual Studio 编辑器 « NotBeCN</title>
  <meta name="description" content="             　　在 Visual Studio 2010 的时代，扩展 Visual Studio 的途径有很多，开发者可以选择宏、Add-in、MEF 和 VSPackages&nbsp;进行自定义的扩展。但是宏在 Visual Studio 2012 的时候被阉割了，Add-in 也在 Visu...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/14/weixin_34208185_90128510.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">如何扩展 Visual Studio 编辑器</h1>
    <p class="post-meta">Nov 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在 Visual Studio 2010 的时代，扩展 Visual Studio 的途径有很多，开发者可以选择宏、Add-in、MEF 和 VSPackages&nbsp;进行自定义的扩展。但是宏在 Visual Studio 2012 的时候被阉割了，Add-in 也在 Visual Studio 2013 里被抹杀了，这样的调整对于 Visual Studio 来说是好的，但是对于那些习惯了使用宏和Add-in的团队可能就郁闷了。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　本文将一步步教你如何实现对 Visual Studio 代码编辑器的扩展，最终将实现一个可以支持如下两个功能的扩展。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　1. 自动任务注释（支持后期扩展）</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　任务注释就是 //TODO、//FIXME 之类可以被 Visual Studio 区别对待的注释，不同的任务注释可能需要不同的格式，比如有些需要先注释掉方法体，有些需要在代码行的前后加上开始、结束标记等，过去在宏还支持的时候，我们可以使用宏来实现此类操作。不同的项目组使用这些标记的方法不同，因此会有不同的要求，本工具支持自定义的扩展。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　2. 跳转到方法的头部或尾部</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　这个功能看似无用，但是当一个方法有几百行，甚至上千行的时候，如何快速跳转到方法的开头或结尾就比较麻烦了。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><img src="https://images0.cnblogs.com/i/30991/201405/011441484709435.gif" alt="" style="border:0px;margin-left:auto;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图1 最终效果动画演示（请点击放大后查看）</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="text-indent:2em;font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:1.5em;border-style:solid;border-width:1px 0px;color:rgb(93,86,54);">阅读此文，需要您对如下知识点有一定了解:<br><br> &nbsp;&nbsp;&nbsp;&nbsp;1. MVVM 与 WPF -&gt;&nbsp;<a title="最简单的MVVM示例" href="http://blog.chenxu.me/post/detail?id=773989fc-9404-4186-a627-5dec1d989e43" rel="nofollow" style="color:rgb(120,175,211);">赶紧去了解一下</a>&nbsp;（此篇文章躺在自己网站上，没有来得及同步到博客园，大家将就一下）<br> &nbsp;&nbsp;&nbsp;&nbsp;2. MEF -&gt;&nbsp;<a title="小试 MEF 扩展应用程序" href="http://www.cnblogs.com/stg609/p/3702802.html" rel="nofollow" style="color:rgb(120,175,211);">赶紧去了解一下</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　如果想赶紧体验下这个扩展的话，请猛击<a title="TskComment.vsix" href="http://pan.baidu.com/s/1i3gd6Bj" rel="nofollow" style="color:rgb(120,175,211);">这里</a>! （仅限 Visual Studio 2012）</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<span style="font-size:14pt;"><strong>本文提纲</strong></span></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#MEFnVSPackage" rel="nofollow" style="color:rgb(120,175,211);">MEF 和 VSPackage</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#prepare" rel="nofollow" style="color:rgb(120,175,211);">准备工作</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#editortemplate" rel="nofollow" style="color:rgb(120,175,211);">各种 Editor 模板的区别</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#environment" rel="nofollow" style="color:rgb(120,175,211);">Visual Studio 实验环境</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#viewport" rel="nofollow" style="color:rgb(120,175,211);">Editor Viewport Adornment 原理解析</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#basecode" rel="nofollow" style="color:rgb(120,175,211);">添加控件和基础代码</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#dte" rel="nofollow" style="color:rgb(120,175,211);">获取DTE对象</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#completelogic" rel="nofollow" style="color:rgb(120,175,211);">完成功能逻辑</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#addmef" rel="nofollow" style="color:rgb(120,175,211);">增加扩展点，让注释支持后期扩展</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#why" rel="nofollow" style="color:rgb(120,175,211);">Why VSPackages or MEF ?</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#sourcecontrol" rel="nofollow" style="color:rgb(120,175,211);">源代码管理</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　<a href="http://www.cnblogs.com/stg609/p/3711443.html#reference" rel="nofollow" style="color:rgb(120,175,211);">参考资源</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在进入正文前，我们先来快速认识下这仅存的两位英雄~</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="MEFnVSPackage"></a>MEF 和 VSPackage</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　从 Visual Studio 2013 开始，对 Visual Studio 的扩展只剩下 MEF 和 VSPackage。来来来，给大家介绍下你们自己~~&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　MEF(Managed Extensibility Framework)</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　这个框架最初是独立于 .Net Framework 发布，后来整合到了 .Net 4.0 中，并伴随着 .Net 4.0 一起发布（包含在 System.ComponentModel.Composition.dll 程序集中）。从名字上看得出这个框架主要就是为编写可扩展的应用程序而生的。随着 .Net 4.0 的推出，还有一项重大的改变就是 Visual Studio IDE中的编辑器，该部分原先和其它组件一样都是采用 COM 方式开发，但现在却被 WPF 技术顶替了。采用了WPF技术搭建的编辑可以完全支持使用 MEF 来进行扩展，这不能不说是一个非常完美的改进。唯一遗憾的是，截止2013的出现，Visual Studio 的其余部分仍然没有从 COM 中脱离出来。</p> 
   <blockquote style="border:2px solid rgb(239,239,239);font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;background:rgb(255,255,255) none;"> 
    <p>The MEF is a .NET library that lets you add and modify features of an application or component that follows the MEF programming model. The Visual Studio editor can both provide and consume MEF component parts. The MEF is contained in the .NET Framework version 4 System.ComponentModel.Composition.dll assembly.</p> 
    <p>&nbsp;</p> 
    <p style="text-align:right;">---&nbsp;<a title="Managed Extensibility Framework in the Editor" href="http://msdn.microsoft.com/en-us/library/dd885013.aspx" rel="nofollow" style="color:rgb(120,175,211);">Managed Extensibility Framework in the Editor</a></p> 
   </blockquote> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　因此，如果想要扩展已有的编辑器，就可以基于MEF进行开发（比如修改针对C#代码编辑器的高亮颜色、智能提示、括号补全等）。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　VSPackage</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　可以说除了编辑器， Visual Studio 就是多个 VSPackage 的集合，因此使用 VSPackage 可以完美得与 Visual Studio 进行集成，而且能够获得几乎全部的能力。如果想开发对工具栏、菜单栏，甚至是全新的编辑器时（提供对新语言的解析、智能提示等）可以选择VSPackage。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="prepare"></a>准备工作</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　童鞋们，请检查下吃饭的家伙准备好了吗？</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　1. 英文版的 Visual Studio，中文版的 Visual Studio 无法看到 Editor Text Adornment 等模板。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　2. 想要扩展编辑器或整个 Visual Stuio，必须先下载安装 Visual Studio SDK（VS2012版本，请点击<a title="SDK" href="http://go.microsoft.com/fwlink/?LinkId=299070" rel="nofollow" style="color:rgb(120,175,211);">链接</a>下载），安装完后，就可以在 “其它项目类型” 的模板上找到想要的模板了。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><img src="https://images0.cnblogs.com/i/30991/201405/011443522526485.jpg" alt="" style="border:0px;margin-left:auto;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图2 SDK安装后的模板</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　</p> 
   <p style="text-indent:2em;font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:1.5em;border-style:solid;border-width:1px 0px;color:rgb(93,86,54);">本文所有代码均基于 Visual Studio 2012 开发，如果您使用的是其它版本，请下载安装适合您版本的 SDK。扩展开发的过程在各个版本间可能会有细小的差距，但不影响整体开发流程。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="editortemplate"></a>各种 Editor 模板的区别</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　安装完 SDK 后，就会拥有如上图中所示的多种扩展模板，其中包含四种和 Editor 相关的模板，它们之间有什么区别吗？</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　Editor Classifier</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　可以修改编辑器中代码的高亮、添加一些智能的标签（比如当我们修改了某个变量名时，会在变量名下出现一个小短横，当你鼠标移上去后会提示你是否要修改所有引用的地方）等，示例效果如下：</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><img src="https://images0.cnblogs.com/i/30991/201405/011444406273564.jpg" alt="" style="border:0px;margin-left:auto;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图3 Editor Classifier 示例</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　Editor Margin</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在编辑器的周围添加一些WPF元素，比如当前文件是只读的时候，可以在编辑器下边沿提示文件为只读，示例效果如下：</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011444555022875.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图4 在下边沿添加了一条绿色的信息框</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　Editor Text Adornment</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　用于对编辑器中的文字进行修饰，添加一些WPF的元素，示例效果如下：</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011445099703128.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图5 用框框包裹所有字符 a&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　Editor Viewport Adornment</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　用于对编辑器本身进行修饰，添加一些WPF元素，示例如下：</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011445244701625.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图6 在编辑器的右上角添加了一个矩形元素</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　本工具使用 Editor Viewport Adornment 作为模板。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="environment"></a>Visual Studio 实验环境</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　对于这些扩展的测试，Visual Studio 提供了 Experimental Instance 用于实验环境，该环境和真实的 Visual Studio 完全一样，只不过它和真实版本各自独享一套配置文件，对于实验环境的配置不会影响到真实环境。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　第一次启动实验环境，会进入如图7所示的默认环境配置的界面。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011445427208266.jpg" alt="" width="397" height="455" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图7 默认环境配置</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　实验环境中的数据可以初始化</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　SDK目录中的 Tools提供了 “Reset the Visual Studio 2012 Experimental Instance” 命令行工具，运行该工具就会初始化实验环境。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011446114701717.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图10 初始化工具</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="viewport"></a>Editor Viewport Adornment&nbsp;原理解析</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　要想理解它，必先使用它。通过模板创建好的新&nbsp;Editor Viewport Adornment&nbsp;项目时，已经包含了示例代码，该示例代码的功能就是如图6所示在编辑区添加一个紫色的矩形框。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011446279554787.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图11 刚创建完的样子</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在运行示例代码前必须先修改 source.extension.vsixmanifest 文件中的 author 字段，否则运行将报错。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011446450026727.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图12 补全 Author 字段</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　实现原理</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在介绍 MEF 和 VSPackage 的时候，我说过整个 Editor 部分都是基于 MEF 思想开发的。简单来说，Visual Studio Editor 向第三方扩展提供了<strong>产物</strong>（Export）、<strong>接受者</strong>（Import）及各种<strong>协议</strong>，第三方扩展根据对应的协议制作生产出符合的产物，然后 VS 会将第三方的产物与自己的接受者进行组合（就好像是把符合形状的积木放入盒子中）。这样，我们就能在下次启动 VS 的时候使用这个扩展了。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011447088459344.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图13 MEF 思想</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　这个项目中主要的就两个文件：<strong>TskCommentFactory.cs</strong>&nbsp;和&nbsp;<strong>TskComment.cs</strong>。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　其中，TskCommentFactory 文件中的 PurpleBoxAdornmentFactory 就是基于 IWpfTextVIewCreationListener 这个协议的<strong>产物</strong>，也是本项目的主要入口。使用该协议可以在编辑器视图创建的时候加入我们想要的操作。其中最重要的就是 TextViewCreated 方法，该方法调用了 TskComment 构造函数，从而在编辑器上增加了一块紫色的区域。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     [Export(<span style="color:rgb(0,0,255);line-height:1.5;">typeof</span><span style="line-height:1.5;">(IWpfTextViewCreationListener))]
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span>     [ContentType(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">text</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span> <span style="line-height:1.5;">    [TextViewRole(PredefinedTextViewRoles.Document)]
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);line-height:1.5;">internal</span> <span style="color:rgb(0,0,255);line-height:1.5;">sealed</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> PurpleBoxAdornmentFactory : IWpfTextViewCreationListener
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> Defines the adornment layer for the scarlet adornment. This layer is ordered 
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> after the selection layer in the Z-order
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">10</span>         [Export(<span style="color:rgb(0,0,255);line-height:1.5;">typeof</span><span style="line-height:1.5;">(AdornmentLayerDefinition))]
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span>         [Name(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">TskComment</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span>         [Order(After =<span style="line-height:1.5;"> PredefinedAdornmentLayers.Caret)]
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> AdornmentLayerDefinition editorAdornmentLayer = <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
</span><span style="color:rgb(0,128,128);line-height:1.5;">14</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">15</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;summary&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">16</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span><span style="color:rgb(0,128,0);line-height:1.5;"> Instantiates a TskComment manager when a textView is created.
</span><span style="color:rgb(0,128,128);line-height:1.5;">17</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;/summary&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">18</span>         <span style="color:rgb(128,128,128);line-height:1.5;">///</span> <span style="color:rgb(128,128,128);line-height:1.5;">&lt;param name="textView"&gt;</span><span style="color:rgb(0,128,0);line-height:1.5;">The </span><span style="color:rgb(128,128,128);line-height:1.5;">&lt;see cref="IWpfTextView"/&gt;</span><span style="color:rgb(0,128,0);line-height:1.5;"> upon which the adornment should be placed</span><span style="color:rgb(128,128,128);line-height:1.5;">&lt;/param&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">19</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> TextViewCreated(IWpfTextView textView)
</span><span style="color:rgb(0,128,128);line-height:1.5;">20</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">21</span>             <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> TskComment(textView);
</span><span style="color:rgb(0,128,128);line-height:1.5;">22</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">23</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　TskComment 文件中主要就两个方法：构造函数 和 onSizeChange 方法。在构造函数中，通过 Brush 画出了一个紫色的矩形，并为编辑器视图绑定了 onSizeChange 方法。</span>&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     Brush brush = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> SolidColorBrush(Colors.BlueViolet);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">    brush.Freeze();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>     Brush penBrush = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> SolidColorBrush(Colors.Red);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span> <span style="line-height:1.5;">    penBrush.Freeze();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>     Pen pen = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> Pen(penBrush, <span style="color:rgb(128,0,128);line-height:1.5;">0.5</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span> <span style="line-height:1.5;">    pen.Freeze();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>     <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">draw a square with the created brush and pen</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>     System.Windows.Rect r = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> System.Windows.Rect(<span style="color:rgb(128,0,128);line-height:1.5;">0</span>, <span style="color:rgb(128,0,128);line-height:1.5;">0</span>, <span style="color:rgb(128,0,128);line-height:1.5;">30</span>, <span style="color:rgb(128,0,128);line-height:1.5;">30</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;">10</span>     Geometry g = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> RectangleGeometry(r);
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span>     GeometryDrawing drawing = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> GeometryDrawing(brush, pen, g);
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span> <span style="line-height:1.5;">    drawing.Freeze();
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">14</span>     DrawingImage drawingImage = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> DrawingImage(drawing);
</span><span style="color:rgb(0,128,128);line-height:1.5;">15</span> <span style="line-height:1.5;">    drawingImage.Freeze();
</span><span style="color:rgb(0,128,128);line-height:1.5;">16</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">17</span>     _image = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Image();
</span><span style="color:rgb(0,128,128);line-height:1.5;">18</span>     _image.Source = drawingImage;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　</span>上面代码创建了一个紫色的矩形。如果看不懂也不要紧，因为这部分代码是要被删除的。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　onSizeChange 中调用了 AddAdornment 这个方法，这才把紫色的矩形加到了编辑器上。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> onSizeChange()
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">clear the adornment layer of previous adornments</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 4</span> <span style="line-height:1.5;">        _adornmentLayer.RemoveAllAdornments();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">Place the image in the top right hand corner of the Viewport</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>         Canvas.SetLeft(_image, _view.ViewportRight - <span style="color:rgb(128,0,128);line-height:1.5;">60</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>         Canvas.SetTop(_image, _view.ViewportTop + <span style="color:rgb(128,0,128);line-height:1.5;">30</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">10</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">add the image to the adornment layer and make it relative to the viewport</span>
<span style="color:rgb(0,128,128);line-height:1.5;">11</span>         _adornmentLayer.AddAdornment(AdornmentPositioningBehavior.ViewportRelative, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, _image, <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　到现在，原理部分已经讲完了，不管你信不信，你已经可以通过修改 TskComment 中这两个方法来实现自己的扩展了。</span>&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="basecode"></a>添加控件和基础代码</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　如何实现我要的功能呢？</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　首先，我们的工具需要一个可以交互的界面，这没办法单纯的用 Brush 绘制。因此需要新建一个 WPF 控件（不能是 Winform 控件，AddAdornment 只能接受 WPF 元素）。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011448372059539.jpg" alt="" width="532" height="300" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图14 新建 WPF 用户控件</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　按照 MVVM 的思想，依次添加 DelegateCommand、ViewModelBase、MainViewModel 这几个文件，我们的核心逻辑全部在 MainViewModel 中。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;"><img src="https://images0.cnblogs.com/i/30991/201405/011449042363432.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图15 新增的文件</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　MainWindow.xaml 中的代码如下（省略了一些与逻辑无关的元素）。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">UserControl </span><span style="color:rgb(255,0,0);line-height:1.5;">x:Class</span><span style="color:rgb(0,0,255);line-height:1.5;">="TskComment.MainControl"</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="color:rgb(255,0,0);line-height:1.5;">             ...
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span> <span style="color:rgb(255,0,0);line-height:1.5;">             d:DesignHeight</span><span style="color:rgb(0,0,255);line-height:1.5;">="41"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Width</span><span style="color:rgb(0,0,255);line-height:1.5;">="300"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">UserControl.DataContext</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>         <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">local:MainViewModel</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">local:MainViewModel</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>     <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">UserControl.DataContext</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>     <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Expander</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>         <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Grid </span><span style="color:rgb(255,0,0);line-height:1.5;">Height</span><span style="color:rgb(0,0,255);line-height:1.5;">="41"</span><span style="color:rgb(255,0,0);line-height:1.5;"> VerticalAlignment</span><span style="color:rgb(0,0,255);line-height:1.5;">="Top"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">10</span>             <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Button </span><span style="color:rgb(255,0,0);line-height:1.5;">Content</span><span style="color:rgb(0,0,255);line-height:1.5;">="{}{"</span><span style="color:rgb(255,0,0);line-height:1.5;">  Command</span><span style="color:rgb(0,0,255);line-height:1.5;">="{Binding MoveToTopOfBlockCmd}"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">11</span>             <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Button </span><span style="color:rgb(255,0,0);line-height:1.5;">Content</span><span style="color:rgb(0,0,255);line-height:1.5;">="}"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Command</span><span style="color:rgb(0,0,255);line-height:1.5;">="{Binding MoveToBottomOfBlockCmd}"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">12</span>             <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Button </span><span style="color:rgb(255,0,0);line-height:1.5;">Content</span><span style="color:rgb(0,0,255);line-height:1.5;">="执行"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Command</span><span style="color:rgb(0,0,255);line-height:1.5;">="{Binding ExecuteCmd}"</span><span style="color:rgb(255,0,0);line-height:1.5;"> IsDefault</span><span style="color:rgb(0,0,255);line-height:1.5;">="True"</span><span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">13</span>             <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">ComboBox </span><span style="color:rgb(255,0,0);line-height:1.5;">IsEditable</span><span style="color:rgb(0,0,255);line-height:1.5;">="True"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ItemsSource</span><span style="color:rgb(0,0,255);line-height:1.5;">="{Binding CMTCollection}"</span><span style="color:rgb(255,0,0);line-height:1.5;"> SelectedItem</span><span style="color:rgb(0,0,255);line-height:1.5;">="{Binding SelectedItem}"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="cmtCol"</span><span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">14</span>         <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Grid</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">15</span>     <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Expander</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,128,128);line-height:1.5;">16</span> <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">UserControl</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　MainViewModel 中的代码如下（省略部分无关代码），其中的 MoveToTopOrBottomOfBlock 和 Execute 两个方法的代码因为缺少关键元素，暂时为空。</span>&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#region</span> Properties and Fields
<span style="color:rgb(0,128,128);line-height:1.5;"> 2</span>      
<span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>     <span style="color:rgb(0,0,255);line-height:1.5;">private</span> ObservableCollection&lt;BaseComment&gt; _cmtCollection = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> ObservableCollection&lt;BaseComment&gt;<span style="line-height:1.5;">();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> ObservableCollection&lt;BaseComment&gt;<span style="line-height:1.5;"> CMTCollection
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>         <span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> _cmtCollection; }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>         <span style="color:rgb(0,0,255);line-height:1.5;">set</span> { _cmtCollection = value; RaisePropertyChanged(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">CMTCollection</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">); }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 8</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">10</span>     <span style="color:rgb(0,0,255);line-height:1.5;">private</span> BaseComment selectedItem = <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> BaseComment SelectedItem
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span>         <span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> selectedItem; }
</span><span style="color:rgb(0,128,128);line-height:1.5;">14</span>         <span style="color:rgb(0,0,255);line-height:1.5;">set</span> { selectedItem = value; RaisePropertyChanged(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SelectedItem</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">); }
</span><span style="color:rgb(0,128,128);line-height:1.5;">15</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">16</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">17</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> DelegateCommand MoveToTopOfBlockCmd { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
</span><span style="color:rgb(0,128,128);line-height:1.5;">18</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> DelegateCommand MoveToBottomOfBlockCmd { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
</span><span style="color:rgb(0,128,128);line-height:1.5;">19</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> DelegateCommand ExecuteCmd { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
</span><span style="color:rgb(0,128,128);line-height:1.5;">20</span>      
<span style="color:rgb(0,128,128);line-height:1.5;">21</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#endregion</span>
<span style="color:rgb(0,128,128);line-height:1.5;">22</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">23</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#region</span> ctor
<span style="color:rgb(0,128,128);line-height:1.5;">24</span>      
<span style="color:rgb(0,128,128);line-height:1.5;">25</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> MainViewModel()
</span><span style="color:rgb(0,128,128);line-height:1.5;">26</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">27</span>         MoveToTopOfBlockCmd = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> DelegateCommand((o) =&gt; MoveToTopOrBottomOfBlock(<span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">));
</span><span style="color:rgb(0,128,128);line-height:1.5;">28</span>         MoveToBottomOfBlockCmd = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> DelegateCommand((o) =&gt; MoveToTopOrBottomOfBlock(<span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">));
</span><span style="color:rgb(0,128,128);line-height:1.5;">29</span>         ExecuteCmd = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> DelegateCommand((o) =&gt;<span style="line-height:1.5;"> Comment());
</span><span style="color:rgb(0,128,128);line-height:1.5;">30</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">31</span>      
<span style="color:rgb(0,128,128);line-height:1.5;">32</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#endregion</span>
<span style="color:rgb(0,128,128);line-height:1.5;">33</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">34</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#region</span> Methods
<span style="color:rgb(0,128,128);line-height:1.5;">35</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">36</span>     <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> MoveToTopOrBottomOfBlock(<span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> up)
</span><span style="color:rgb(0,128,128);line-height:1.5;">37</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">38</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">... 缺少关键元素</span>
<span style="color:rgb(0,128,128);line-height:1.5;">39</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">40</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">41</span>     <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> Comment()
</span><span style="color:rgb(0,128,128);line-height:1.5;">42</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">43</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">... 缺少关键元素</span>
<span style="color:rgb(0,128,128);line-height:1.5;">44</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">45</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">46</span>     <span style="color:rgb(0,0,255);line-height:1.5;">#endregion</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-size:1.5em;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';font-weight:bold;"><a name="dte"></a>获取DTE对象</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　上一节中所缺少的关键元素其实就是DTE，该对象相当于 Visual Studio 的实例，可以通过操作该实例对编辑器中的东东进行控制（如果想要进一步了解，请见<a href="http://www.cnblogs.com/stg609/p/3711443.html#%5B1%5D" rel="nofollow" style="color:rgb(120,175,211);">参考资源[1]</a>），比如剪切、粘贴、新建行、跳转到方法体等。所以，如果想实现开头我所讲的工具，就要依托这个对象。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　在宏编辑器中，可以很轻松的获取该对象，但是在这里稍微就有点麻烦了。我们必须借助 Visual Studio 的其中一个产物(Export) --&nbsp;SVsServiceProvider。该产物的&nbsp;GetService 可以获得这个对象。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　修改 TskCommentFactory 代码，如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);line-height:1.5;">internal</span> <span style="color:rgb(0,0,255);line-height:1.5;">sealed</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> TskCommentFactory : IWpfTextViewCreationListener
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">{
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span> <span style="line-height:1.5;">    [Import]
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);line-height:1.5;">internal</span> SVsServiceProvider ServiceProvider = <span style="color:rgb(0,0,255);line-height:1.5;">null</span>;   <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 通过这句代码，就可以获取 Visual Studio 的产物
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>          
<span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>     <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">省略无关代码</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> TextViewCreated(IWpfTextView textView)
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">10</span>         DTE dte = (DTE)ServiceProvider.GetService(<span style="color:rgb(0,0,255);line-height:1.5;">typeof</span>(DTE)); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 获取DTE对象</span>
<span style="color:rgb(0,128,128);line-height:1.5;">11</span>         <span style="color:rgb(0,0,255);line-height:1.5;">new</span> TskComment(textView, dte); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 把dte传给 view</span>
<span style="color:rgb(0,128,128);line-height:1.5;">12</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">14</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:1.5em;border-style:solid;border-width:1px 0px;color:rgb(93,86,54);"><span style="line-height:1.5;">注：DTE 存在于 EnvDTE.dll 程序集中，</span><span style="line-height:1.5;">SVsServiceProvider 存在于&nbsp;</span><span style="line-height:1.5;">Microsoft.VisualStudio.Shell.Immutable.10.0.dll 程序集中，需要先添加这些程序集到项目中</span>&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="completelogic"></a>完成功能逻辑</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　既然已经获取了关键元素，我们就把 MainViewModel 中的代码完善一下吧。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> MoveToTopOrBottomOfBlock(<span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> up)
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">{
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>     <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (DTE == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>         <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;">;
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>     CodeFunction func = Selection.ActivePoint.CodeElement[vsCMElement.vsCMElementFunction] <span style="color:rgb(0,0,255);line-height:1.5;">as</span><span style="line-height:1.5;"> CodeFunction;
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">10</span>     <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (func != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span>         <span style="color:rgb(0,0,255);line-height:1.5;">if</span><span style="line-height:1.5;"> (up)
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">14</span> <span style="line-height:1.5;">            Selection.MoveToPoint(func.StartPoint);
</span><span style="color:rgb(0,128,128);line-height:1.5;">15</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">16</span>         <span style="color:rgb(0,0,255);line-height:1.5;">else</span>
<span style="color:rgb(0,128,128);line-height:1.5;">17</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">18</span> <span style="line-height:1.5;">            Selection.MoveToPoint(func.EndPoint);
</span><span style="color:rgb(0,128,128);line-height:1.5;">19</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">20</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;">21</span> <span style="line-height:1.5;">}
</span><span style="color:rgb(0,128,128);line-height:1.5;">22</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">23</span> <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> Comment()
</span><span style="color:rgb(0,128,128);line-height:1.5;">24</span> <span style="line-height:1.5;">{
</span><span style="color:rgb(0,128,128);line-height:1.5;">25</span> <span style="line-height:1.5;">    Selection.StartOfLine();
</span><span style="color:rgb(0,128,128);line-height:1.5;">26</span> <span style="line-height:1.5;">    Selection.NewLine();
</span><span style="color:rgb(0,128,128);line-height:1.5;">27</span> <span style="line-height:1.5;">    Selection.LineUp();
</span><span style="color:rgb(0,128,128);line-height:1.5;">28</span>     Selection.Text = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">//TODO:</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
</span><span style="color:rgb(0,128,128);line-height:1.5;">29</span>     DTE.ExecuteCommand(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Edit.FormatSelection</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;">30</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　修改 MainWindow 的代码让它能够接受 DTE。</span>&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;">1</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">partial</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> MainWindow : UserControl
</span><span style="color:rgb(0,128,128);line-height:1.5;">2</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">3</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> MainWindow(DTE dte)
</span><span style="color:rgb(0,128,128);line-height:1.5;">4</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">5</span> <span style="line-height:1.5;">            InitializeComponent();
</span><span style="color:rgb(0,128,128);line-height:1.5;">6</span>             ((MainViewModel)<span style="color:rgb(0,0,255);line-height:1.5;">this</span>.DataContext).DTE =<span style="line-height:1.5;"> dte;
</span><span style="color:rgb(0,128,128);line-height:1.5;">7</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">8</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　修改 TskComment.cs 中对应的部分</span>&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> MainWindow _win;
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 3</span> <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">... 省略部分代码</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 5</span> <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> TskComment(IWpfTextView view,DTE dte)
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span> <span style="line-height:1.5;">{
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>     _win = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> MainWindow(dte);          
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 9</span>     <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">...</span>
<span style="color:rgb(0,128,128);line-height:1.5;">10</span> <span style="line-height:1.5;">}
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">12</span> <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> onSizeChange()
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span> <span style="line-height:1.5;">{
</span><span style="color:rgb(0,128,128);line-height:1.5;">14</span>     <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">...</span>
<span style="color:rgb(0,128,128);line-height:1.5;">15</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">16</span>     Canvas.SetLeft(_win, _view.ViewportRight - <span style="color:rgb(128,0,128);line-height:1.5;">310</span>); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 调整位置</span>
<span style="color:rgb(0,128,128);line-height:1.5;">17</span>     Canvas.SetTop(_win, _view.ViewportTop + <span style="color:rgb(128,0,128);line-height:1.5;">90</span>); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 调整位置</span>
<span style="color:rgb(0,128,128);line-height:1.5;">18</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">19</span>     _adornmentLayer.AddAdornment(AdornmentPositioningBehavior.ViewportRelative, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, _win, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">&lt;-- 把 win 放到界面上</span>
<span style="color:rgb(0,128,128);line-height:1.5;">20</span> }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　哦啦，现在可以运行了！</span>&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><img src="https://images0.cnblogs.com/i/30991/201405/011451254084994.gif" alt="" style="border:0px;margin-left:auto;"></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;text-align:center;">图16 动画演示</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="addmef"></a>增加扩展点，让注释支持后期扩展</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　上面的代码已经完成了，可惜这个注释太不人性化了，要是我想增加一个 Phase0 的注释或者 FixMe 的注释，还得修改代码。因此，这里也按照 MEF 的思想，对代码进行升级。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　这里只对关键代码进行解释说明，其它部分，请童鞋们查看源代码。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong>　　新建 “协议” 项目</strong></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　增加一个独立的项目，用于存放协议接口，同时基于此接口提供一个抽象类。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">interface</span><span style="line-height:1.5;"> IComment
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>         <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Title { <span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">; }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>         <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Description { <span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">; }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>         <span style="color:rgb(0,0,255);line-height:1.5;">void</span> Execute(DTE dte); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 把DTE提供给第三方，这样就可以利用这个来操纵编辑器了</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 6</span> <span style="line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>      
<span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>     <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> BaseComment:IComment
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 9</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;">10</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Title{<span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">;}
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">12</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Description{<span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;">;}
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">14</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> Execute(DTE dte);
</span><span style="color:rgb(0,128,128);line-height:1.5;">15</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">16</span>         <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">override</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> ToString()
</span><span style="color:rgb(0,128,128);line-height:1.5;">17</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">18</span>             <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> Title;
</span><span style="color:rgb(0,128,128);line-height:1.5;">19</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">20</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">21</span>         <span style="color:rgb(0,0,255);line-height:1.5;">protected</span><span style="line-height:1.5;"> TextSelection Selection(DTE dte)
</span><span style="color:rgb(0,128,128);line-height:1.5;">22</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">23</span>             <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> dte.ActiveDocument.Selection;
</span><span style="color:rgb(0,128,128);line-height:1.5;">24</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">25</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">26</span>         <span style="color:rgb(0,0,255);line-height:1.5;">protected</span><span style="line-height:1.5;"> CodeFunction Function(DTE dte)
</span><span style="color:rgb(0,128,128);line-height:1.5;">27</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">28</span>             <span style="color:rgb(0,0,255);line-height:1.5;">return</span> Selection(dte).ActivePoint.CodeElement[vsCMElement.vsCMElementFunction] <span style="color:rgb(0,0,255);line-height:1.5;">as</span><span style="line-height:1.5;"> CodeFunction;
</span><span style="color:rgb(0,128,128);line-height:1.5;">29</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">30</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong style="line-height:1.5;">　　新建 “接受者”&nbsp;</strong>&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　有了协议，就该在我们的工具上增加一个接收者从而让 MEF 帮我们把第三方的产物和我们的接受者组合在一起。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　修改 MainViewModel, 增加接收者，因为可能会有不只一个的注释，所以要使用 ImportMany。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>    [ImportMany(<span style="color:rgb(0,0,255);line-height:1.5;">typeof</span><span style="line-height:1.5;">(BaseComment))]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> IEnumerable&lt;BaseComment&gt; Comments;</pre>
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><strong style="line-height:1.5;">　　新建 “组合引擎”</strong>&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> Init()
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 2</span> <span style="line-height:1.5;">    {
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 3</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">设置目录</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 4</span>         <span style="color:rgb(0,0,255);line-height:1.5;">var</span> catalog = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> AggregateCatalog();
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 5</span>         catalog.Catalogs.Add(<span style="color:rgb(0,0,255);line-height:1.5;">new</span> DirectoryCatalog(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">D:\\plugin\\</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">));
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 6</span>  
<span style="color:rgb(0,128,128);line-height:1.5;"> 7</span>         _container = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> CompositionContainer(catalog);
</span><span style="color:rgb(0,128,128);line-height:1.5;"> 8</span>         <span style="color:rgb(0,0,255);line-height:1.5;">try</span>
<span style="color:rgb(0,128,128);line-height:1.5;"> 9</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">10</span>             <span style="color:rgb(0,0,255);line-height:1.5;">this</span>._container.ComposeParts(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
</span><span style="color:rgb(0,128,128);line-height:1.5;">11</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">12</span>         <span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (CompositionException compositionException)
</span><span style="color:rgb(0,128,128);line-height:1.5;">13</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">14</span> <span style="line-height:1.5;">            Console.WriteLine(compositionException.ToString());
</span><span style="color:rgb(0,128,128);line-height:1.5;">15</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">16</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">17</span>         <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">把新的注释绑定到集合中，让界面上能够显示</span>
<span style="color:rgb(0,128,128);line-height:1.5;">18</span>         <span style="color:rgb(0,0,255);line-height:1.5;">foreach</span> (BaseComment itm <span style="color:rgb(0,0,255);line-height:1.5;">in</span><span style="line-height:1.5;"> Comments)
</span><span style="color:rgb(0,128,128);line-height:1.5;">19</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">20</span> <span style="line-height:1.5;">            CMTCollection.Add(itm);
</span><span style="color:rgb(0,128,128);line-height:1.5;">21</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">22</span>  
<span style="color:rgb(0,128,128);line-height:1.5;">23</span>         <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (Comments != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp; Comments.Count() &gt; <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;">)
</span><span style="color:rgb(0,128,128);line-height:1.5;">24</span> <span style="line-height:1.5;">        {
</span><span style="color:rgb(0,128,128);line-height:1.5;">25</span>             SelectedItem = CMTCollection[<span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;">];
</span><span style="color:rgb(0,128,128);line-height:1.5;">26</span> <span style="line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);line-height:1.5;">27</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(120,175,211);text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><span style="line-height:1.5;">　　大功告成，如果您还能跟住我的节奏，那可喜可贺，您已经基本掌握了 MEF 的思想和扩展 Editor 的能力了。</span>&nbsp;</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="why"></a>Why VSPackages or MEF ?</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　换个问法就是 “为什么宏和Add-in不支持了？” 这答案谷歌一下肯定很多，但是考虑到文章的完整性，还是打算来做一下搬运工。</p> 
   <blockquote style="border:2px solid rgb(239,239,239);font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;background:rgb(255,255,255) none;"> 
    <p>根据Microsoft所做的使用率跟踪数据，Visual Studio中宏的使用人数不到开发人员总数的1%。这还不足以让Microsoft放弃这个功能，Visual Studio中的宏功能维护成本过高，是另外一个原因，与其他功能不同，对宏的支持，必须要随着Visual Studio每个新版本更新，并做大量令人疲倦的测试。理论上，用户应该可以在宏IDE中录制并播放任何功能，这给微软的维护增加了巨大负担。 Matt Kaufman说：宏IDE已经好几个版本都没有更新了。用户把它启动之后，很快就能看出来它像一个老版本的Visual Studio。更麻烦的是：它还是只支持Visual Basic。用户不能使用C#或是其他新的.NET语言来创建宏。</p> 
    <p>&nbsp;</p> 
    <p>&nbsp;---&nbsp;<a title="Visual Studio 11抛弃宏" href="http://www.infoq.com/cn/news/2011/10/VS-Macros" rel="nofollow" style="color:rgb(120,175,211);">Visual Studio 11抛弃宏</a></p> 
   </blockquote> 
   <blockquote style="border:2px solid rgb(239,239,239);font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;background:rgb(255,255,255) none;"> 
    <p>微软已经弃用Visual Studio加载项这一基础结构。根据MSDN上的说法，“Visual Studio 2013弃用了加载项。开发人员应该将加载项升级为VSPackage扩展。”稍后的文档指出，“VSPackage是Visual Studio的主要架构单位，也是部署、许可和安全的单位。Visual Studio本身的大部分就写成了VSPackage集合。”</p> 
    <p>---&nbsp;<a title="Visual Studio 2013弃用加载项" href="http://www.infoq.com/cn/news/2013/11/VS-2013-Extensions" rel="nofollow" style="color:rgb(120,175,211);">Visual Studio 2013弃用加载项</a></p> 
   </blockquote> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="sourcecontrol"></a>源代码管理</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　CodePlex:&nbsp;<a title="Visual Studio Editor Extension -- TaskComment" href="https://taskcomment.codeplex.com/" rel="nofollow" style="color:rgb(120,175,211);">Visual Studio Editor Extension -- TaskComment</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;&nbsp;　TskComment.vsix: 您也可以直接点击<a title="TskComment" href="http://pan.baidu.com/s/1i3gd6Bj" rel="nofollow" style="color:rgb(120,175,211);">这里</a>获取此扩展，并安装到您的 Visual Studio 当中。</p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">&nbsp;</p> 
   <h2 style="line-height:1.5;font-family:'Microsoft YaHei UI', 'Microsoft YaHei';"> <a name="reference"></a>参考资源</h2> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　[1]&nbsp;<a title="Visual Studio 宏的高级用法" href="http://blog.chenxu.me/post/detail?id=2c393950-acbe-4367-8039-a326449c8d22" rel="nofollow" style="color:rgb(120,175,211);">《Visual Studio 宏的高级用法》</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　[2]&nbsp;<a title="Managed Extensibility Framework (MEF)" href="http://msdn.microsoft.com/zh-cn/library/dd460648(v=vs.110).aspx" rel="nofollow" style="color:rgb(167,167,167);">Managed Extensibility Framework (MEF)</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">　　[3]&nbsp;<a title="Extending the Editor" href="http://msdn.microsoft.com/en-us/library/dd885242.aspx" rel="nofollow" style="color:rgb(120,175,211);">Extending the Editor</a></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><br></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><br></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><br></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><br></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;"><br></p> 
   <p style="font-family:'black Verdana', Arial, Helvetica, sans-serif;font-size:14px;line-height:21px;">本文转自stg609博客园博客，原文链接：http://www.cnblogs.com/stg609/p/3711443.html，如需转载请自行联系原作者</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
