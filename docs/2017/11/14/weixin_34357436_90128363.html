<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>理解Docker（5）：Docker 网络 « NotBeCN</title>
  <meta name="description" content="             本系列文章将介绍 Docker的相关知识：    （1）Docker 安装及基本用法    （2）Docker 镜像    （3）Docker 容器的隔离性 - 使用 Linux namespace 隔离容器的运行环境    （4）Docker 容器的隔离性 - 使用 cgroups 限...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/14/weixin_34357436_90128363.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">理解Docker（5）：Docker 网络</h1>
    <p class="post-meta">Nov 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本系列文章将介绍 Docker的相关知识：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）<a href="http://www.cnblogs.com/sammyliu/p/5875470.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 安装及基本用法</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）<a href="http://www.cnblogs.com/sammyliu/p/5877964.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 镜像</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）<a href="http://www.cnblogs.com/sammyliu/p/5878973.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 容器的隔离性 - 使用 Linux namespace 隔离容器的运行环境</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）<a href="http://www.cnblogs.com/sammyliu/p/5886833.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 容器的隔离性 - 使用 cgroups 限制容器使用的资源</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）<a href="http://www.cnblogs.com/sammyliu/p/5894191.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 网络</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1. Docker 网络概况</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">用一张图来说明 Docker 网络的基本概况：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201609/697113-20160922082500668-996094065.jpg" alt="" width="580" height="340" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">2. 四种单节点网络模式</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.1 bridge 模式</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Docker 容器默认使用 bridge 模式的网络。其特点如下：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">使用一个 linux bridge，默认为 docker0</li> 
    <li style="list-style-type:disc;">使用 veth 对，一头在容器的网络 namespace 中，一头在 docker0 上</li> 
    <li style="list-style-type:disc;">该模式下Docker Container不具有一个公有IP，因为宿主机的IP地址与veth pair的 IP地址不在同一个网段内</li> 
    <li style="list-style-type:disc;">Docker采用 NAT 方式，将容器内部的服务监听的端口与宿主机的某一个端口port 进行“绑定”，使得宿主机以外的世界可以主动将网络报文发送至容器内部</li> 
    <li style="list-style-type:disc;">外界访问容器内的服务时，需要访问宿主机的 IP 以及宿主机的端口 port</li> 
    <li style="list-style-type:disc;">NAT 模式由于是在三层网络上的实现手段，故肯定会影响网络的传输效率。</li> 
    <li style="list-style-type:disc;">容器拥有独立、隔离的网络栈；让容器和宿主机以外的世界通过NAT建立通信</li> 
    <li style="list-style-type:disc;">关于容器通过 NAT 连接外网的原理，请参考我的另一篇文章&nbsp;<a id="homepage1_HomePageDays_DaysList_ctl06_DayList_TitleUrl_0" class="postTitle2" href="http://www.cnblogs.com/sammyliu/p/5760125.html" rel="nofollow" style="text-decoration:none;color:rgb(26,139,200);">Netruon 理解（11）：使用 NAT 将 Linux network namespace 连接外网</a>。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">iptables 的 SNTA 规则，使得从容器离开去外界的网络包的源 IP 地址被转换为 Docker 主机的IP地址：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="line-height:1.5;">Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  </span>--  <span style="color:rgb(128,0,128);line-height:1.5;">172.17</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>/<span style="color:rgb(128,0,128);line-height:1.5;">16</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>/<span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;">
MASQUERADE  all  </span>--  <span style="color:rgb(128,0,128);line-height:1.5;">172.18</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>/<span style="color:rgb(128,0,128);line-height:1.5;">16</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>/<span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"><br></span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">效果是这样的：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161001091515719-188391370.jpg" alt="" width="388" height="184" style="border:0px;">（<a href="https://www.singlestoneconsulting.com/~/media/files/whitepapers/dockernetworking2.pdf" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">图片来源</a>）</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">示意图：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201609/697113-20160921210314981-2013047548.jpg" alt="" width="388" height="194" style="border:0px;"></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.2 Host 模式</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">定义：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Host 模式并没有为容器创建一个隔离的网络环境。而之所以称之为host模式，是因为该模式下的 Docker 容器会和 host 宿主机共享同一个网络 namespace，故 Docker Container可以和宿主机一样，使用宿主机的eth0，实现和外界的通信。换言之，Docker Container的 IP 地址即为宿主机 eth0 的 IP 地址。其特点包括：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:none;"> 
     <ul style="list-style:none;font-size:12px;">
      <li style="list-style-type:disc;">这种模式下的容器没有隔离的 network namespace</li> 
      <li style="list-style-type:disc;">容器的 IP 地址同 Docker host 的 IP 地址</li> 
      <li style="list-style-type:disc;">需要注意容器中服务的端口号不能与 Docker host 上已经使用的端口号相冲突</li> 
      <li style="list-style-type:disc;">host 模式能够和其它模式共存</li> 
     </ul></li>
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">实验：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）启动一个 host 网络模式的容器</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>docker run -d --name hostc1 --network host -p <span style="color:rgb(128,0,128);line-height:1.5;">5001</span>:<span style="color:rgb(128,0,128);line-height:1.5;">5001</span> training/webapp python app.py</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）检查其 network namespace，其中可以看到主机上的所有网络设备</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker2:/home/sammy# ln -s /proc/<span style="color:rgb(128,0,128);line-height:1.5;">28353</span>/ns/net /<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/run/netns/<span style="line-height:1.5;">hostc1
root@docker2:</span>/home/<span style="line-height:1.5;">sammy# ip netns
hostc1
root@docker2:</span>/home/<span style="line-height:1.5;">sammy# ip netns exec hostc1
No command specified
root@docker2:</span>/home/<span style="line-height:1.5;">sammy# ip netns exec hostc1 ip a
</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:rgb(128,0,128);line-height:1.5;">65536</span> qdisc noqueue state UNKNOWN group <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
    link</span>/loopback <span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span> brd <span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span><span style="line-height:1.5;">
    inet </span><span style="color:rgb(128,0,128);line-height:1.5;">127.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">8</span><span style="line-height:1.5;"> scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">128</span><span style="line-height:1.5;"> scope host
       valid_lft forever preferred_lft forever
</span><span style="color:rgb(128,0,128);line-height:1.5;">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:rgb(128,0,128);line-height:1.5;">1500</span> qdisc pfifo_fast state UP group <span style="color:rgb(0,0,255);line-height:1.5;">default</span> qlen <span style="color:rgb(128,0,128);line-height:1.5;">1000</span><span style="line-height:1.5;">
    link</span>/ether <span style="color:rgb(128,0,128);line-height:1.5;">08</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">27</span>:d4:<span style="color:rgb(128,0,128);line-height:1.5;">66</span>:<span style="color:rgb(128,0,128);line-height:1.5;">75</span><span style="line-height:1.5;"> brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color:rgb(128,0,128);line-height:1.5;">192.168</span>.<span style="color:rgb(128,0,128);line-height:1.5;">1.20</span>/<span style="color:rgb(128,0,128);line-height:1.5;">24</span> brd <span style="color:rgb(128,0,128);line-height:1.5;">192.168</span>.<span style="color:rgb(128,0,128);line-height:1.5;">1.255</span> scope <span style="color:rgb(0,0,255);line-height:1.5;">global</span><span style="line-height:1.5;"> eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fed4:</span><span style="color:rgb(128,0,128);line-height:1.5;">6675</span>/<span style="color:rgb(128,0,128);line-height:1.5;">64</span><span style="line-height:1.5;"> scope link
       valid_lft forever preferred_lft forever<br>
......</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">示意图：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201609/697113-20160921211323293-119309106.jpg" alt="" width="343" height="172" style="border:0px;"></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.3 container 模式</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">定义：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;Container 网络模式是 Docker 中一种较为特别的网络的模式。处于这个模式下的 Docker 容器会共享其他容器的网络环境，因此，至少这两个容器之间不存在网络隔离，而这两个容器又与宿主机以及除此之外其他的容器存在网络隔离。&nbsp;&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">实验：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）启动一个容器：&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">docker run -d --name hostcs1 -p 5001:5001 training/webapp python app.py</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）启动另一个容器，并使用第一个容器的 network namespace</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">docker run -d --name hostcs2 --network container:hostcs1 &nbsp;training/webapp python app.py</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">注意：因为此时两个容器要共享一个 network namespace，因此需要注意端口冲突情况，否则第二个容器将无法被启动。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">示意图：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201609/697113-20160921215054012-2042972351.jpg" alt="" width="333" height="205" style="border:0px;"></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.4 none 模式</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">定义：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;网络模式为 none，即不为 Docker 容器构造任何网络环境。一旦Docker 容器采用了none 网络模式，那么容器内部就只能使用loopback网络设备，不会再有其他的网络资源。Docker Container的none网络模式意味着不给该容器创建任何网络环境，容器只能使用127.0.0.1的本机网络。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">实验：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）创建并启动一个容器：&nbsp;docker run -d --name hostn1 --network none training/webapp python app.py</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）检查其网络设备，除了 loopback 设备外没有其它设备</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker2:/home/<span style="line-height:1.5;">sammy# ip netns exec hostn1 ip a
</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:rgb(128,0,128);line-height:1.5;">65536</span> qdisc noqueue state UNKNOWN group <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
    link</span>/loopback <span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span> brd <span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span><span style="line-height:1.5;">
    inet </span><span style="color:rgb(128,0,128);line-height:1.5;">127.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">8</span><span style="line-height:1.5;"> scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">128</span><span style="line-height:1.5;"> scope host
       valid_lft forever preferred_lft forever</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3. 多节点 Docker 网络</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; Docker 多节点网络模式可以分为两类，一类是 Docker 在 1.19 版本中引入的基于 VxLAN 的对跨节点网络的原生支持；另一种是通过插件（plugin）方式引入的第三方实现方案，比如 Flannel，Calico 等等。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.1&nbsp;Docker 原生overlay 网络</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; Docker 1.19 版本中增加了对 overlay 网络的原生支持。Docker 支持&nbsp;Consul, Etcd, 和 ZooKeeper 三种分布式key-value 存储。其中，etcd&nbsp;是一个高可用的分布式 k/v存储系统，使用etcd的场景默认处理的数据都是控制数据，对于应用数据，只推荐数据量很小，但是更新访问频繁的情况。</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3.1.1 安装配置</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">准备三个节点：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">devstack 192.168.1.18</li> 
    <li style="list-style-type:disc;">docker1 192.168.1.21</li> 
    <li style="list-style-type:disc;">docker2 192.168.1.19</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 devstack 上使用Docker 启动 etcd 容器：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>export HostIP=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">192.168.1.18</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">
docker run </span>-d -v /usr/share/ca-certificates/:/etc/ssl/certs -p <span style="color:rgb(128,0,128);line-height:1.5;">4001</span>:<span style="color:rgb(128,0,128);line-height:1.5;">4001</span> -p <span style="color:rgb(128,0,128);line-height:1.5;">2380</span>:<span style="color:rgb(128,0,128);line-height:1.5;">2380</span> -p <span style="color:rgb(128,0,128);line-height:1.5;">2379</span>:<span style="color:rgb(128,0,128);line-height:1.5;">2379</span><span style="line-height:1.5;"> \
 </span>--name etcd quay.io/coreos/<span style="line-height:1.5;">etcd \<br><span style="color:rgb(255,0,0);line-height:1.5;">/usr/local/bin/etcd \ </span></span>-<span style="line-height:1.5;">name etcd0 \
 </span>-advertise-client-urls http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">${HostIP}:2379,http:</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">${HostIP}:4001 \</span>
 -listen-client-urls http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">0.0.0.0:2379,</span><span style="color:rgb(0,128,0);text-decoration:underline;line-height:1.5;">http://0.0.0.0</span><span style="color:rgb(0,128,0);line-height:1.5;">:4001 \</span>
 -initial-advertise-peer-urls http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">${HostIP}:2380 \</span>
 -listen-peer-urls http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">0.0.0.0:2380 \</span>
 -initial-cluster-token etcd-cluster-<span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;"> \
 </span>-initial-cluster etcd0=http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">${HostIP}:2380 \</span>
 -initial-cluster-state <span style="color:rgb(0,0,255);line-height:1.5;">new</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">使用 Docker 启动 etcd 请参考&nbsp;<a href="https://coreos.com/etcd/docs/latest/docker_guide.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://coreos.com/etcd/docs/latest/docker_guide.html</a>。不过，应该是因为制造镜像所使用的Dockerfile 原因，官网上的命令因为少了上面红色字体部分而会造成启动失败：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="line-height:1.5;"> b847195507addf4fb5a01751eb9c4101416a13db4a8a835e1c2fa1db1e6f364e
docker: Error response </span><span style="color:rgb(0,0,255);line-height:1.5;">from</span> daemon: oci runtime error: exec: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">-name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: executable file not found <span style="color:rgb(0,0,255);line-height:1.5;">in</span> $PATH.</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">添加红色部分后，容器可以被正确创建：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@devstack:/# docker exec -it 179cd52b494d /usr/local/bin/etcdctl cluster-<span style="line-height:1.5;">health
member 5d72823aca0e00be </span><span style="color:rgb(0,0,255);line-height:1.5;">is</span> healthy: got healthy result <span style="color:rgb(0,0,255);line-height:1.5;">from</span> http:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">:2379</span>
cluster <span style="color:rgb(0,0,255);line-height:1.5;">is</span> healthy</pre>
   </div> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@devstack:/home/<span style="line-height:1.5;">sammy# docker ps
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                                      NAMES
179cd52b494d        quay.io</span>/coreos/etcd   <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/usr/local/bin/etcd </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>   <span style="color:rgb(128,0,128);line-height:1.5;">8</span> seconds ago       Up <span style="color:rgb(128,0,128);line-height:1.5;">8</span> seconds        <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>:<span style="color:rgb(128,0,128);line-height:1.5;">2379</span>-<span style="color:rgb(128,0,128);line-height:1.5;">2380</span>-&gt;<span style="color:rgb(128,0,128);line-height:1.5;">2379</span>-<span style="color:rgb(128,0,128);line-height:1.5;">2380</span>/tcp, <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>:<span style="color:rgb(128,0,128);line-height:1.5;">4001</span>-&gt;<span style="color:rgb(128,0,128);line-height:1.5;">4001</span>/<span style="line-height:1.5;">tcp   etcd
root@devstack:</span>/home/sammy# netstat -nltp | grep <span style="color:rgb(128,0,128);line-height:1.5;">2380</span><span style="line-height:1.5;">
tcp6       </span><span style="color:rgb(128,0,128);line-height:1.5;">0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0</span> :::<span style="color:rgb(128,0,128);line-height:1.5;">2380</span>                 :::*                    LISTEN      <span style="color:rgb(128,0,128);line-height:1.5;">4072</span>/docker-<span style="line-height:1.5;">proxy
root@devstack:</span>/home/sammy# netstat -nltp | grep <span style="color:rgb(128,0,128);line-height:1.5;">4001</span><span style="line-height:1.5;">
tcp6       </span><span style="color:rgb(128,0,128);line-height:1.5;">0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0</span> :::<span style="color:rgb(128,0,128);line-height:1.5;">4001</span>                 :::*                    LISTEN      <span style="color:rgb(128,0,128);line-height:1.5;">4047</span>/docker-proxy</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在docker1 和 docker2 节点上修改&nbsp;/etc/default/docker，添加：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>DOCKER_OPTS=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">--cluster-store=etcd://192.168.1.18:2379 --cluster-advertise=192.168.1.20:2379</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后分别重启 docker deamon。注意，要使用IP地址；要是使用 hostname 的话，docker 服务将启动失败：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@docker2:/home/<span style="line-height:1.5;">sammy# docker ps
An error occurred trying to connect: Get http:</span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json: read unix @-&gt;/var/run/docker.sock: read: connection reset by peer</span></pre>
   </div> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3.1.2 使用 Docker overlay 网络</h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）在docker1上运行下面的命令创建一个 overlay 网络：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/home/sammy# docker network create -<span style="line-height:1.5;">d overlay overlaynet1
1de982804f632169380609b9be7c1466b0064dce661a8f4c9e30d781e79fc45a
root@docker1:</span>/home/<span style="line-height:1.5;">sammy# docker network inspect overlaynet1
[
    {
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">overlaynet1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Id</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">1de982804f632169380609b9be7c1466b0064dce661a8f4c9e30d781e79fc45a</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Scope</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">global</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Driver</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">overlay</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">EnableIPv6</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(136,136,136);line-height:1.5;">false</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">IPAM</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {
            </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Driver</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">default</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
            </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Options</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {},
            </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Config</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: [
                {
                    </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Subnet</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">10.0.0.0/24</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                    </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Gateway</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">10.0.0.1/24</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">
                }
            ]
        },
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Internal</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(136,136,136);line-height:1.5;">false</span><span style="line-height:1.5;">,
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Containers</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {},
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Options</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {},
        </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Labels</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {}
    }
]</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 docker2 上你也会看到这个网络，说明通过 etcd，网络数据是分布式而不是本地的了。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）在网络中创建容器</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 docker2 上，运行&nbsp;docker run -d --name over2 --network overlaynet1 training/webapp python app.py</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 docker1 上，运行&nbsp;docker run -d --name over1 --network overlaynet1 training/webapp python app.py</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">进入容器 over2，发现它有两块网卡：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker2:/home/sammy# ln -s /proc/<span style="color:rgb(128,0,128);line-height:1.5;">23576</span>/ns/net /<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/run/netns/<span style="line-height:1.5;">over2
root@docker2:</span>/home/<span style="line-height:1.5;">sammy# ip netns
over2
root@docker2:</span>/home/<span style="line-height:1.5;">sammy# ip netns exec over2 ip a

</span><span style="color:rgb(128,0,128);line-height:1.5;">22</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:rgb(255,0,0);line-height:1.5;">1450 </span>qdisc noqueue state UP group <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
    link</span>/ether <span style="color:rgb(128,0,128);line-height:1.5;">02</span>:<span style="color:rgb(128,0,128);line-height:1.5;">42</span>:0a:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">02</span><span style="line-height:1.5;"> brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color:rgb(255,0,0);line-height:1.5;">10.0.0.2/24</span> scope <span style="color:rgb(0,0,255);line-height:1.5;">global</span><span style="line-height:1.5;"> eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::</span><span style="color:rgb(128,0,128);line-height:1.5;">42</span>:aff:fe00:<span style="color:rgb(128,0,128);line-height:1.5;">2</span>/<span style="color:rgb(128,0,128);line-height:1.5;">64</span><span style="line-height:1.5;"> scope link
       valid_lft forever preferred_lft forever
</span><span style="color:rgb(128,0,128);line-height:1.5;">24</span>: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:rgb(128,0,128);line-height:1.5;">1500</span> qdisc noqueue state UP group <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
    link</span>/ether <span style="color:rgb(128,0,128);line-height:1.5;">02</span>:<span style="color:rgb(128,0,128);line-height:1.5;">42</span>:ac:<span style="color:rgb(128,0,128);line-height:1.5;">13</span>:<span style="color:rgb(128,0,128);line-height:1.5;">00</span>:<span style="color:rgb(128,0,128);line-height:1.5;">02</span><span style="line-height:1.5;"> brd ff:ff:ff:ff:ff:ff
    inet </span><span style="color:rgb(255,0,0);line-height:1.5;">172.19.0.2/16</span> scope <span style="color:rgb(0,0,255);line-height:1.5;">global</span><span style="line-height:1.5;"> eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::</span><span style="color:rgb(128,0,128);line-height:1.5;">42</span>:acff:fe13:<span style="color:rgb(128,0,128);line-height:1.5;">2</span>/<span style="color:rgb(128,0,128);line-height:1.5;">64</span><span style="line-height:1.5;"> scope link
       valid_lft forever preferred_lft forever</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">其中 eth1 的网络是一个内部的网段，其实它走的还是普通的 NAT 模式；而 eth0 是 overlay 网段上分配的IP地址，也就是它走的是 overlay 网络，它的 MTU 是 1450 而不是 1500.</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">进一步查看它的路由表，你会发现只有同一个 overlay 网络中的容器之间的通信才会通过 eth0，其它所有通信还是走 eth1.</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker2:/home/sammy# ip netns exec over2 route -<span style="line-height:1.5;">n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span><span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>         <span style="color:rgb(128,0,128);line-height:1.5;">172.19</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.1</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>         UG    <span style="color:rgb(128,0,128);line-height:1.5;">0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> eth1
</span><span style="color:rgb(128,0,128);line-height:1.5;">10.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>         <span style="color:rgb(128,0,128);line-height:1.5;">255.255</span>.<span style="color:rgb(128,0,128);line-height:1.5;">255.0</span>   U     <span style="color:rgb(128,0,128);line-height:1.5;">0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> eth0
</span><span style="color:rgb(128,0,128);line-height:1.5;">172.19</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>         <span style="color:rgb(128,0,128);line-height:1.5;">255.255</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>     U     <span style="color:rgb(128,0,128);line-height:1.5;">0</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0</span>        <span style="color:rgb(128,0,128);line-height:1.5;">0</span> eth1</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">先看此时的网络拓扑图：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161001083118297-1525684169.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">可见：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">Docker 在每个节点上创建了两个 linux bridge，一个用于 overlay 网络（ov-000100-1de98），一个用于非 overlay 的 NAT 网络（docker_gwbridge）</li> 
    <li style="list-style-type:disc;">容器内的到overlay 网络的其它容器的网络流量走 overlay 网卡（eth0），其它网络流量走 NAT 网卡（eth1）</li> 
    <li style="list-style-type:disc;">当前 Docker 创建 vxlan 隧道的ID范围为 256～1000，因而最多可以创建745个网络，因此，本例中的这个 vxlan 隧道使用的 ID 是 256</li> 
    <li style="list-style-type:disc;">Docker vxlan 驱动使用&nbsp;4789 UDP 端口</li> 
    <li style="list-style-type:disc;">overlay网络模型底层需要类似 consul 或 etcd 的 KV 存储系统进行消息同步</li> 
    <li style="list-style-type:disc;">Docker overlay 不使用多播</li> 
    <li style="list-style-type:disc;">Overlay 网络中的容器处于一个虚拟的大二层网络中</li> 
    <li style="list-style-type:disc;">关于 linux bridge + vxlan 组网，请参考&nbsp;&nbsp;<a href="http://www.cnblogs.com/sammyliu/p/4985907.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Neutron 理解（14）：Neutron ML2 + Linux bridge + VxLAN 组网</a> </li> 
    <li style="list-style-type:disc;">关于 linux network namspace + NAT 组网，请参考&nbsp;<a class="postTitle2" href="http://www.cnblogs.com/sammyliu/p/5760125.html" rel="nofollow" style="text-decoration:none;color:rgb(26,139,200);">Netruon 理解（11）：使用 NAT 将 Linux network namespace 连接外网</a> </li> 
    <li style="list-style-type:disc;">github 上代码在这里&nbsp;<a href="https://github.com/docker/libnetwork/blob/master/drivers/overlay/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://github.com/docker/libnetwork/blob/master/drivers/overlay/</a> </li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">ov-000100-1de98&nbsp;的初始情形：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/home/sammy# ip -d link show dev vx-<span style="color:rgb(128,0,128);line-height:1.5;">000100</span>-<span style="line-height:1.5;">1de98
</span><span style="color:rgb(128,0,128);line-height:1.5;">8</span>: vx-<span style="color:rgb(128,0,128);line-height:1.5;">000100</span>-1de98: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:rgb(128,0,128);line-height:1.5;">1450</span> qdisc noqueue master ov-<span style="color:rgb(128,0,128);line-height:1.5;">000100</span>-1de98 state UNKNOWN mode DEFAULT group <span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;">
    link</span>/ether <span style="color:rgb(128,0,128);line-height:1.5;">22</span>:3c:3f:8f:<span style="color:rgb(128,0,128);line-height:1.5;">94</span>:f6 brd ff:ff:ff:ff:ff:ff promiscuity <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">
    vxlan id </span><span style="color:rgb(128,0,128);line-height:1.5;">256</span> port <span style="color:rgb(128,0,128);line-height:1.5;">32768</span> <span style="color:rgb(128,0,128);line-height:1.5;">61000</span> proxy l2miss l3miss ageing <span style="color:rgb(128,0,128);line-height:1.5;">300</span><span style="line-height:1.5;">
root@docker1:</span>/home/sammy# bridge fdb show dev vx-<span style="color:rgb(128,0,128);line-height:1.5;">000100</span>-<span style="line-height:1.5;">1de98
</span><span style="color:rgb(128,0,128);line-height:1.5;">22</span>:3c:3f:8f:<span style="color:rgb(128,0,128);line-height:1.5;">94</span>:f6 vlan <span style="color:rgb(128,0,128);line-height:1.5;">0</span> permanent</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这里很明显的一个问题是，vxlan dev&nbsp;vx-000100-1de98 的 fdb 表内容不全，导致从容器1 ping 容器2 不通。待选的解决方式不外乎下面几种：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">使用一个中央数据库，它保存所有容器的 IP 地址和所在节点的 IP 地址的映射关系</li> 
    <li style="list-style-type:disc;">使用多播</li> 
    <li style="list-style-type:disc;">使用比如 BGP 的特殊协议来广告（advertise）容器的 IP 和所在节点的 IP 的映射关系</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Docker 从某种程度上利用了第一种和第三种方式的组合，首先Docker 利用 consul 以及 etcd 这样的分布式 key/value 存储来保存IP地址映射关系，另一方面个Docker 节点也通过某种协议来直接广告映射关系。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">为了测试，中间重启了 docker1 节点，发现 over1 容器无法启动，报错如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>docker: Error response <span style="color:rgb(0,0,255);line-height:1.5;">from</span> daemon: network sandbox join failed: could not <span style="color:rgb(0,0,255);line-height:1.5;">get</span> network sandbox (oper <span style="color:rgb(0,0,255);line-height:1.5;">true</span>): failed <span style="color:rgb(0,0,255);line-height:1.5;">get</span> network <span style="color:rgb(0,0,255);line-height:1.5;">namespace</span> <span style="color:rgb(128,0,0);line-height:1.5;">""</span>: no such file or directory.</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">根据<a href="https://github.com/docker/docker/issues/25215" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">&nbsp;https://github.com/docker/docker/issues/25215</a>，这是 Docker 的一个bug，fix 刚刚推出。一个 workaround 是重新创建 overlay network。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">回到容器之间无法ping通对方的问题，尚不知道根本原因是什么（想吐槽Docker目前的问题真不少）。要使得互相 ping 能工作，至少必须具备下面的条件：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 docker1 上，</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">为 vxlan dev 添加一条 fdb entry：02:42:14:00:00:03 dst 192.168.1.20 self</li> 
    <li style="list-style-type:disc;">在容器中添加一条 arp entry：ip netns exec over1 arp -s 20.0.0.3 02:42:14:00:00:03</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 docker 2 上，</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">为 vxlan dev 添加一条 fdb entry：02:42:14:00:00:02 dst 192.168.1.21 self permanent</li> 
    <li style="list-style-type:disc;">在容器中添加一条 arp entry：ip netns exec over4 arp -s 20.0.0.2 02:42:14:00:00:02</li> 
   </ul>
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3. 网络性能对比</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.1 在我的测试环境中的数据</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">使用 iperf 工具检查测试了一下性能并做对比：</span></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <tbody>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">类型</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">TCP</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">UDP</span></strong></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">Overlay 网络中的两个容器之间 (A)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">913 Mbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">1.05 Mbits/sec</span></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">Bridge/NAT 网络中的两个容器之间 (B)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">1.73 Gbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">主机间 (C)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">2.06 Gbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">1.05 Mbits/sec</span></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">主机到另一个主机上的 bridge 网络模式的容器 (D)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">1.88&nbsp;Gbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">&nbsp;</span></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">主机到本主机上的容器 (E)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">20.5 Gbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">主机到另一个主机上的 host 网络模式的容器 (F)</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">2.02 Gbits/sec</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">1.05 Mbits/sec</span></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">容器 Overlay 效率 (A/C)</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">44%</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">&nbsp;100% ?</span></td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">单个 NAT 效率 (D/C)</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">91%</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">两个 NAT 效率 (B/C)</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">83%</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><strong><span style="line-height:1.5;font-size:14px;">Host 网络模式效率 (F/C)</span></strong></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">98%</span></td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"><span style="line-height:1.5;font-size:14px;">100%</span></td> 
     </tr>
    </tbody>
   </table>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;两台主机是同一个物理机上的两个虚机，因此，结果的绝对值其实没多少意义，相对值有一定的参考性。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.2 网上文章中的对比数据</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">文章&nbsp;</span><a href="http://www.cnblogs.com/sammyliu/p/Testing%20Docker%20multi-host%20network%20performance" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;font-size:14px;">Testing Docker multi-host network performance</a><span style="line-height:1.5;font-size:14px;">&nbsp;对比了多种网络模式下的性能，结果如下：</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201609/697113-20160929205031000-1538421698.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">看起来这个表里面的数据和我的表里面的数据差不了太多。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.3 关于Docker 网络模式选择的简单结论</h3> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">Bridge 模式的性能损耗大概为10%</li> 
    <li style="list-style-type:disc;">原生 overlay 模式的性能损耗非常高，甚至达到了 56%，因此，在生产环境下使用这种模式需要非常谨慎。</li> 
    <li style="list-style-type:disc;">如果一定要使用 overlay 模式的话，可以考虑使用 Cisco 发起的 &nbsp;Calico 模式，它的性能和 bridge 相当。</li> 
    <li style="list-style-type:disc;">Weave overlay 模式的性能数据非常可疑，按理说应该不可能这么差。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">参考链接：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><a href="http://kangkai.net.cn/etcd-cluster-guide/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://kangkai.net.cn/etcd-cluster-guide/</a></li> 
    <li style="list-style-type:disc;"><a href="https://www.singlestoneconsulting.com/~/media/files/whitepapers/dockernetworking2.pdf" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://www.singlestoneconsulting.com/~/media/files/whitepapers/dockernetworking2.pdf</a></li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="line-height:1.5;"><font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/5894191.html</span></font><span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
