<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[BigData]关于Hadoop学习笔记第二天(PPT总结)(一) « NotBeCN</title>
  <meta name="description" content="             Plan:                       分布式文件系统与HDFSHDFS体系结构与基本概念HDFS的shell操作java接口及常用apiHADOOP的RPC机制HDFS源码分析远程debug                      自己设计一分布式文件系统？     ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/14/weixin_33737134_90130444.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">[BigData]关于Hadoop学习笔记第二天(PPT总结)(一)</h1>
    <p class="post-meta">Nov 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>Plan:</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="font-size:12px;line-height:1.5;">分布式文件系统与HDFS
HDFS体系结构与基本概念
HDFS的shell操作
java接口及常用api
HADOOP的RPC机制
HDFS源码分析
远程debug</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>自己设计一分布式文件系统？</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images0.cnblogs.com/blog2015/610238/201506/111005031139630.jpg" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>Distributed File System</strong></p> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    1.数据量越来越多，在一个操作系统管辖的范围存不下了，那么就分配到更多的操作系统管理的磁盘中，但是不方便管理和维护，因此迫切需要一种系统来管理多台机器上的文件，这就是分布式文件管理系统 。
   </div> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    2.是一种允许文件通过网络在多台主机上分享的文件系统，可让多机器上的多用户分享文件和存储空间。
   </div> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    3.通透性。让实际上是通过网络来访问文件的动作，由程序与用户看来，就像是访问本地的磁盘一般。
   </div> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    4.容错。即使系统中有某些节点脱机，整体来说系统仍然可以持续运作而不会有数据损失。
   </div> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    5.分布式文件管理系统很多，hdfs只是其中一种。适用于一次写入多次查询的情况，不支持并发写情况，小文件不合适。
   </div> 
   <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <strong>HDFS的Shell</strong>
   </div> 
   <div> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     1.调用文件系统(FS)Shell命令应使用 bin/hadoop fs 的形式。
    </div> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     2.所有的FS shell命令使用URI路径作为参数。
    </div> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　URI格式是scheme://authority/path。HDFS的scheme是hdfs，对本地文件系统，scheme是file。其中scheme和authority参数都是可选的，如果未加指定，就会使用配置中指定的默认scheme。</p> 
    <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　例如：/parent/child可以表示成hdfs://namenode:namenodePort/parent/child，或者更简单的/parent/child（假设配置文件是namenode:namenodePort）</p> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     3.大多数FS Shell命令的行为和对应的Unix Shell命令类似。
    </div> 
    <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <strong>HDFS fs命令</strong>
    </div> 
    <div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -help [cmd]&nbsp; //显示命令的帮助信息
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -ls(r) &lt;path&gt;&nbsp; //显示当前目录下所有文件
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -du(s) &lt;path&gt;&nbsp; //显示目录中所有文件大小
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -count[-q] &lt;path&gt;&nbsp; //显示目录中文件数量
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -mv &lt;src&gt; &lt;dst&gt;&nbsp; //移动多个文件到目标目录
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -cp &lt;src&gt; &lt;dst&gt;&nbsp; //复制多个文件到目标目录
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -rm(r)&nbsp; //删除文件(夹)
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -put &lt;localsrc&gt; &lt;dst&gt;&nbsp; //本地文件复制到hdfs
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -copyFromLocal&nbsp; //同put
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -moveFromLocal&nbsp; //从本地文件移动到hdfs
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -get [-ignoreCrc] &lt;src&gt; &lt;localdst&gt;&nbsp; //复制文件到本地，可以忽略crc校验
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -getmerge &lt;src&gt; &lt;localdst&gt;&nbsp; //将源目录中的所有文件排序合并到一个文件中
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -cat &lt;src&gt;&nbsp; //在终端显示文件内容
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -text &lt;src&gt;&nbsp; //在终端显示文件内容
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -copyToLocal [-ignoreCrc] &lt;src&gt; &lt;localdst&gt;&nbsp; //复制到本地
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -moveToLocal &lt;src&gt; &lt;localdst&gt;
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -mkdir &lt;path&gt;&nbsp; //创建文件夹
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      -touchz &lt;path&gt;&nbsp; //创建一个空文件
     </div> 
     <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
      <strong>HDFS的Shell命令练习</strong>
     </div> 
     <div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -ls /&nbsp; 查看HDFS根目录
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -mkdir /test 在根目录创建一个目录test
      </div> 
      <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;&nbsp; #hadoop fs -mkdir /test1 在根目录创建一个目录test1</p> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -put ./test.txt /test　
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       或#hadoop fs -copyFromLocal ./test.txt /test
      </div> 
      <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;&nbsp; #hadoop fs -get /test/test.txt .</p> 
      <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp; 或#hadoop fs -getToLocal /test/test.txt .</p> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -cp /test/test.txt /test1
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -rm /test1/test.txt
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -mv /test/test.txt /test1
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       #hadoop fs -rmr /test1&nbsp; &nbsp;
      </div> 
      <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
       <strong>HDFS架构</strong>
      </div> 
      <div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        NameNode
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        DataNode
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        Secondary NameNode
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong>HDFS Architecture</strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong><img src="https://images0.cnblogs.com/blog2015/610238/201506/111013068488613.jpg" alt="" style="border:0px;"></strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong>元数据存储细节</strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong><img src="https://images0.cnblogs.com/blog2015/610238/201506/111016056915309.jpg" alt="" style="border:0px;"></strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        &nbsp;
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong>NameNode</strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
        <div>
         1.是整个文件系统的管理节点。它维护着整个文件系统的文件目录树，文件/目录的元信息和每个文件对应的数据块列表。接收用户的操作请求。
        </div> 
        <div>
         2.文件包括：
        </div> 
        <div>
         ①fsimage:元数据镜像文件。存储某一时段NameNode内存元数据信息。(hdfs-site.xml的dfs.name.dir属性
         <span style="line-height:1.5;">)</span> 
        </div> 
        <div>
         ②edits:操作日志文件。
        </div> 
        <div>
         ③fstime:保存最近一次checkpoint的时间
        </div> 
        <div>
         3.以上这些文件是保存在linux的文件系统中。
        </div> 
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
        <strong>NameNode的工作特点</strong>&nbsp;
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
        <div>
         1.Namenode始终在内存中保存metedata，用于处理“读请求”
        </div> 
        <div>
         2.到有“写请求”到来时，namenode会首先写editlog到磁盘，即向edits文件中写日志，成功返回后，才会修改内存，并且向客户端返回
        </div> 
        <div>
         3.Hadoop会维护一个fsimage文件，也就是namenode中metedata的镜像，但是fsimage不会随时与namenode内存中的metedata保持一致，而是每隔一段时间通过合并edits文件来更新内容。Secondary namenode就是用来合并fsimage和edits文件来更新NameNode的metedata的。
        </div> 
        <div>
         <strong>SecondaryNameNode</strong>
        </div> 
        <div> 
         <div>
          1.HA的一个解决方案。但不支持热备。配置即可。
         </div> 
         <div>
          2.执行过程：从NameNode上下载元数据信息（fsimage,edits），然后把二者合并，生成新的fsimage，在本地保存，并将其推送到NameNode，替换旧的fsimage.
         </div> 
         <div>
          3.默认在安装在NameNode节点上，但这样...不安全！
         </div> 
         <div>
          <strong>secondary namenode的工作流程<br></strong>
         </div> 
         <div> 
          <div>
           1.secondary通知namenode切换edits文件
          </div> 
          <div>
           2.secondary从namenode获得fsimage和edits(通过http)
          </div> 
          <div>
           3.secondary将fsimage载入内存，然后开始合并edits
          </div> 
          <div>
           4.secondary将新的fsimage发回给namenode
          </div> 
          <div>
           5.namenode用新的fsimage替换旧的fsimage
          </div> 
          <div>
           <strong>什么时候checkpiont&nbsp;</strong>
          </div> 
          <div> 
           <div>
            1.fs.checkpoint.period 指定两次checkpoint的最大时间间隔，默认3600秒。
           </div> 
           <div>
            2.fs.checkpoint.size&nbsp;&nbsp;&nbsp; 规定edits文件的最大值，一旦超过这个值则强制checkpoint，不管是否到达最大时间间隔。默认大小是64M。
           </div> 
          </div> 
         </div> 
        </div> 
        <div> 
         <img src="https://images0.cnblogs.com/blog2015/610238/201506/111731065044496.jpg" alt="" style="border:0px;">&nbsp;
        </div> 
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        &nbsp;
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong>Datanode</strong>
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
        <div>
         1.提供真实文件数据的存储服务。
        </div> 
        <div>
         2.文件块（block）：最基本的存储单位。对于文件内容而言，一个文件的长度大小是size，那么从文件的０偏移开始，按照固定的大小，顺序对文件进行划分并编号，划分好的每一个块称一个Block。HDFS默认Block大小是128MB，以一个256MB文件，共有256/128=2个Block.
        </div> 
        <p>dfs.block.size</p> 
        <div>
         3.不同于普通文件系统的是，HDFS中，如果一个文件小于一个数据块的大小，并不占用整个数据块存储空间
        </div> 
        <div>
         4.Replication。多复本。默认是三个。
        </div> 
        <div> 
         <p>hdfs-site.xml的dfs.replication属性</p> 
        </div> 
       </div> 
       <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
        <strong>Shell命令练习：验证块大小</strong>
       </div> 
       <div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         1.方法：上传大于128MB的文件，观察块大小
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         2.验证：使用 http://hadoop0:50070 观察
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         <img src="https://images0.cnblogs.com/blog2015/610238/201506/121443356607500.jpg" alt="" style="border:0px;">
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <p><strong>HDFS的java访问接口——FileSystem</strong></p> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <div>
          •写文件 create
         </div> 
         <div>
          •读取文件 open
         </div> 
         <div>
          •删除文件delete
         </div> 
         <div>
          •
         </div> 
         <div>
          •
         </div> 
         <div>
          •创建目录 mkdirs
         </div> 
         <div>
          •删除文件或目录 delete
         </div> 
         <div>
          •列出目录的内容 listStatus
         </div> 
         <div>
          •显示文件系统的目录和文件的元数据信息 getFileStatus
         </div> 
         <p><strong>&nbsp;HDFS的FileSystem读取文件</strong></p> 
         <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
          <pre>    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> FileSystem getFileSystem() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> URISyntaxException,
            IOException {
        Configuration conf </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Configuration();
        URI uri </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> URI("hdfs://hadoop240:9000"<span style="font-size:12px;line-height:1.5;">);
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> FileSystem fileSystem =<span style="font-size:12px;line-height:1.5;"> FileSystem.get(uri , conf);
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> fileSystem;
    }
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
     * 读取文件，调用fileSystem的open(path)
     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> readFile() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
        FileSystem fileSystem </span>=<span style="font-size:12px;line-height:1.5;"> getFileSystem();
        FSDataInputStream openStream </span>= fileSystem.open(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path("hdfs://itcast0106:9000/aaa"<span style="font-size:12px;line-height:1.5;">));
        IOUtils.copyBytes(openStream, System.out, </span>1024, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">);
        IOUtils.closeStream(openStream);
    }</span></pre> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
         </div> 
         <p><strong>HDFS的FileSystem目录</strong></p> 
         <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
          <pre>    <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
     * 创建目录，调用fileSystem的mkdirs(path)
     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> mkdir() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
        FileSystem fileSystem </span>=<span style="font-size:12px;line-height:1.5;"> getFileSystem();
        fileSystem.mkdirs(</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path("hdfs://itcast0106:9000/bbb"<span style="font-size:12px;line-height:1.5;">));
    }
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
     * 删除目录，调用fileSystem的deleteOnExit(path)
     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> rmdir() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception {
        FileSystem fileSystem </span>=<span style="font-size:12px;line-height:1.5;"> getFileSystem();
        fileSystem.delete(</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path("hdfs://itcast0106:9000/bbb"<span style="font-size:12px;line-height:1.5;">));
    }</span></pre> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
         </div> 
         <p><strong>HDFS的FileSystem遍历目录</strong></p> 
         <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
          <pre><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
     * 遍历目录，使用FileSystem的listStatus(path)
     * 如果要查看file状态，使用FileStatus对象
     * </span><span style="color:rgb(128,128,128);font-size:12px;line-height:1.5;">@throws</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Exception
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> list() <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> Exception{
        FileSystem fileSystem </span>=<span style="font-size:12px;line-height:1.5;"> getFileSystem();
        FileStatus[] listStatus </span>= fileSystem.listStatus(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Path("hdfs://itcast0106:9000/"<span style="font-size:12px;line-height:1.5;">));
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span><span style="font-size:12px;line-height:1.5;"> (FileStatus fileStatus : listStatus) {
            String isDir </span>= fileStatus.isDir()?"目录":"文件"<span style="font-size:12px;line-height:1.5;">;
            String name </span>=<span style="font-size:12px;line-height:1.5;"> fileStatus.getPath().toString();
            System.out.println(isDir</span>+"  "+<span style="font-size:12px;line-height:1.5;">name);
        }
    }</span></pre> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
         </div> 
         <p><strong>FileSystem</strong></p> 
         <div>
          用户代码操作HDFS时，是直接调用FileSystem的子类完成的。
         </div> 
         <p><strong style="line-height:1.5;">Remote Procedure Call</strong></p> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <div>
          1.RPC——远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。
         </div> 
         <div>
          <span style="line-height:1.5;">2.RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息的到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。</span>
         </div> 
         <div>
          <span style="line-height:1.5;">3.hadoop的整个体系结构就是构建在RPC之上的(见org.apache.hadoop.ipc)。</span>
         </div> 
         <div>
          <strong><span style="line-height:1.5;">RPC示例</span></strong>
         </div> 
         <div> 
          <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
           <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">interface</span> Bizable <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">extends</span><span style="font-size:12px;line-height:1.5;">  VersionedProtocol{
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">abstract</span><span style="font-size:12px;line-height:1.5;"> String hello(String name);
}

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> Biz <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span><span style="font-size:12px;line-height:1.5;"> Bizable{
    @Override
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> String hello(String name){
        System.out.println(</span>"被调用了"<span style="font-size:12px;line-height:1.5;">);
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> "hello "+<span style="font-size:12px;line-height:1.5;">name;
    }

    @Override
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> getProtocolVersion(String protocol, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span><span style="font-size:12px;line-height:1.5;"> clientVersion)
            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException {
        System.out.println(</span>"Biz.getProtocalVersion()="+<span style="font-size:12px;line-height:1.5;">MyServer.VERSION);
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> MyServer.VERSION;
    }
}

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> MyServer {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> PORT = 3242<span style="font-size:12px;line-height:1.5;">;
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">long</span> VERSION = 23234l<span style="font-size:12px;line-height:1.5;">;
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> main(String[] args) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> Server server = RPC.getServer(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Biz(), "127.0.0.1", PORT, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Configuration());
        server.start();
    }
}

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> MyClient {
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> main(String[] args) <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">throws</span><span style="font-size:12px;line-height:1.5;"> IOException {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> InetSocketAddress inetSocketAddress = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> InetSocketAddress("127.0.0.1"<span style="font-size:12px;line-height:1.5;">, MyServer.PORT);
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> Bizable proxy = (Bizable) RPC.getProxy(Bizable.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span>, MyServer.VERSION, inetSocketAddress, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Configuration());
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> String ret = proxy.hello("吴超"<span style="font-size:12px;line-height:1.5;">);
        System.out.println(ret);
        
        RPC.stopProxy(proxy);
    }
}</span></pre> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
          </div> 
          <p>&nbsp;</p> 
         </div> 
         <div>
          <strong>RPC调用流程</strong>
         </div> 
         <div>
          <strong><img src="https://images0.cnblogs.com/blog2015/610238/201506/121449232071657.jpg" alt="" style="border:0px;"></strong>
         </div> 
         <div>
          <strong>ClientProtocol</strong>
         </div> 
         <div> 
          <div>
           l是客户端(FileSystem)与NameNode通信的接口。
          </div> 
         </div> 
         <div> 
          <strong>DatanodeProtocol</strong>&nbsp;
         </div> 
         <div> 
          <div>
           l是DataNode与NameNode通信的接口
          </div> 
         </div> 
         <div> 
          <strong>NamenodeProtocol</strong>&nbsp;
         </div> 
         <div> 
          <div>
           l是SecondaryNameNode与NameNode通信的接口。
          </div> 
          <div>
           &nbsp;
          </div> 
         </div> 
         <div>
          <strong><span style="line-height:1.5;">HDFS读过程</span></strong>
         </div> 
         <div> 
          <div>
           1.初始化FileSystem，然后客户端(client)用FileSystem的open()函数打开文件
          </div> 
          <div>
           2.FileSystem用RPC调用元数据节点，得到文件的数据块信息，对于每一个数据块，元数据节点返回保存数据块的数据节点的地址。
          </div> 
          <div>
           3.FileSystem返回FSDataInputStream给客户端，用来读取数据，客户端调用stream的read()函数开始读取数据。
          </div> 
          <div>
           4.DFSInputStream连接保存此文件第一个数据块的最近的数据节点，data从数据节点读到客户端(client)
          </div> 
          <div>
           5.当此数据块读取完毕时，DFSInputStream关闭和此数据节点的连接，然后连接此文件下一个数据块的最近的数据节点。
          </div> 
          <div>
           6.当客户端读取完毕数据的时候，调用FSDataInputStream的close函数。
          </div> 
          <div>
           7.在读取数据的过程中，如果客户端在与数据节点通信出现错误，则尝试连接包含此数据块的下一个数据节点。
          </div> 
          <div>
           8.失败的数据节点将被记录，以后不再连接。
          </div> 
          <div>
           <img src="https://images0.cnblogs.com/blog2015/610238/201506/121428024578666.jpg" alt="" style="border:0px;">
          </div> 
         </div> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <strong>HDFS写过程</strong>&nbsp;
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <div>
          1.初始化FileSystem，客户端调用create()来创建文件
         </div> 
         <div>
          2.FileSystem用RPC调用元数据节点，在文件系统的命名空间中创建一个新的文件，元数据节点首先确定文件原来不存在，并且客户端有创建文件的权限，然后创建新文件。
         </div> 
         <div>
          3.FileSystem返回DFSOutputStream，客户端用于写数据，客户端开始写入数据。
         </div> 
         <div>
          4.DFSOutputStream将数据分成块，写入data queue。data queue由Data Streamer读取，并通知元数据节点分配数据节点，用来存储数据块(每块默认复制3块)。分配的数据节点放在一个pipeline里。Data Streamer将数据块写入pipeline中的第一个数据节点。第一个数据节点将数据块发送给第二个数据节点。第二个数据节点将数据发送给第三个数据节点。
         </div> 
         <div>
          5.DFSOutputStream为发出去的数据块保存了ack queue，等待pipeline中的数据节点告知数据已经写入成功。
         </div> 
         <div>
          6.当客户端结束写入数据，则调用stream的close函数。此操作将所有的数据块写入pipeline中的数据节点，并等待ack queue返回成功。最后通知元数据节点写入完毕。
         </div> 
         <div>
          7.如果数据节点在写入的过程中失败，关闭pipeline，将ack queue中的数据块放入data queue的开始，当前的数据块在已经写入的数据节点中被元数据节点赋予新的标示，则错误节点重启后能够察觉其数据块是过时的，会被删除。失败的数据节点从pipeline中移除，另外的数据块则写入pipeline中的另外两个数据节点。元数据节点则被通知此数据块是复制块数不足，将来会再创建第三份备份。
         </div> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         &nbsp;
         <img src="https://images0.cnblogs.com/blog2015/610238/201506/121428428164735.jpg" alt="" style="border:0px;">
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         <strong>练习题</strong>
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <div class="O1">
          1.练习shell命令
         </div> 
         <div class="O1">
          2.在HDFS创建一个文本文件hadoop.test。内容自定;然后，用Java程序在本地终端打印hadoop.test文件内容
         </div> 
         <div class="O1">
          3.用Java程序实现copyFromLocal
         </div> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         &nbsp;
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         <strong>思考题</strong>
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
         <div class="O1">
          1.hdfs的组成部分有哪些，分别解释一下
         </div> 
         <div class="O1">
          2.hdfs的高可靠如何实现
         </div> 
         <div class="O1">
          3.hdfs的常用shell命令有哪些
         </div> 
         <div class="O1">
          4.hdfs的常用java api有哪些
         </div> 
         <div class="O1">
          5.请用shell命令实现目录、文件的增删改查
         </div> 
         <div class="O1">
          6.请用java api实现目录、文件的增删改查
         </div> 
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         &nbsp;
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         &nbsp;
        </div> 
        <div style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
         <br>
        </div> 
        <div> 
         <font><span style="font-size:14px;">本文转自SummerChill博客园博客，原文链接：http://www.cnblogs.com/DreamDrive/p/4566838.html，如需转载请自行联系原作者</span></font>
         <br>
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
