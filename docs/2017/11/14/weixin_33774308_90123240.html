<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HashMap的实现原理总结 « NotBeCN</title>
  <meta name="description" content="             &nbsp;1. HashMap的数据结构    数据结构中有数组和链表来实现对数据的存储，但这两者基本上是两个极端。    &nbsp;数组    数组存储区间是连续的，占用内存严重，故空间复杂的很大。但数组的二分查找时间复杂度小，为O(1)；数组的特点是：寻址容易，插入和删除困难； ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/14/weixin_33774308_90123240.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">HashMap的实现原理总结</h1>
    <p class="post-meta">Nov 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;1. HashMap的数据结构</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">数据结构中有数组和链表来实现对数据的存储，但这两者基本上是两个极端。</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;数组</h3> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">数组存储区间是连续的，占用内存严重，故空间复杂的很大。但数组的二分查找时间复杂度小，为O(1)；数组的特点是：寻址容易，插入和删除困难；</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">链表</h3> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">链表存储区间离散，占用内存比较宽松，故空间复杂度很小，但时间复杂度很大，达O（N）。<strong>链表</strong>的特点是：寻址困难，插入和删除容易。</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">哈希表</h3> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">那么我们能不能综合两者的特性，做出一种寻址容易，插入删除也容易的数据结构？答案是肯定的，这就是我们要提起的哈希表。哈希表（(Hash table）既满足了数据的查找方便，同时不占用太多的内容空间，使用也十分方便。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">哈希表有多种不同的实现方法，我接下来解释的是最常用的一种方法——&nbsp;拉链法，我们可以理解为“<strong>链表的数组</strong>”&nbsp;，如图：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2017.cnblogs.com/blog/610238/201709/610238-20170913090541953-935687184.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2017.cnblogs.com/blog/610238/201709/610238-20170913090614453-799690716.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://images2017.cnblogs.com/blog/610238/201709/610238-20170913092231297-1534520546.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">从上图我们可以发现哈希表是由<strong>数组+链表</strong>组成的，一个长度为16的数组中，每个元素存储的是一个链表的头结点。那么这些元素是按照什么样的规则存储到数组中呢。一般情况是通过hash(key)%len获得，也就是元素的key的哈希值对数组长度取模得到。比如上述哈希表中，12%16=12, 28%16=12, 108%16=12, 140%16=12。所以12、28、108以及140都存储在数组下标为12的位置。　　</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">HashMap底层就是一个数组结构，数组中的每一项又是一个链表。当新建一个HashMap的时候，就会初始化一个数组。 那一个线性数组怎么实现按键值对来存取数据呢？这里HashMap有做一些处理。<br> HashMap存储的是key-value形式的键值对，这个键值对在实现中使用一个静态内部类Entry来表示，它存储了key、value、hash值、以及在hash冲突时链表中下一个元素的引用。这个数组就是Entry[]，Map里面的内容都保存在Entry[]里面。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">HashMap源码中有一个Entry类型的table数组:</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>    <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
     * The table, resized as necessary. Length MUST Always be a power of two.
     * 这个table数组成员变量是HashMap扩容所必须的,其长度必须是2的次幂
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">transient</span> Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">附录HashMap$Entry的源码如下:(它存储了key、value、hash值、以及在hash冲突时链表中下一个元素的引用)</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span> Entry&lt;K,V&gt; <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">implements</span> Map.Entry&lt;K,V&gt;<span style="font-size:12px;line-height:1.5;"> {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span><span style="font-size:12px;line-height:1.5;"> K key;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span> <span style="font-size:12px;line-height:1.5;">        V value;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span>         Entry&lt;K,V&gt;<span style="font-size:12px;line-height:1.5;"> next;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> hash;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">         * Creates new entry.
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span>          <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>         Entry(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> h, K k, V v, Entry&lt;K,V&gt;<span style="font-size:12px;line-height:1.5;"> n) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>             value =<span style="font-size:12px;line-height:1.5;"> v;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span>             next =<span style="font-size:12px;line-height:1.5;"> n;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span>             key =<span style="font-size:12px;line-height:1.5;"> k;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span>             hash =<span style="font-size:12px;line-height:1.5;"> h;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> equals(Object o) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (!(o <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">instanceof</span><span style="font-size:12px;line-height:1.5;"> Map.Entry))
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>             Map.Entry e =<span style="font-size:12px;line-height:1.5;"> (Map.Entry)o;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span>             Object k1 =<span style="font-size:12px;line-height:1.5;"> getKey();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">22</span>             Object k2 =<span style="font-size:12px;line-height:1.5;"> e.getKey();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">23</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (k1 == k2 || (k1 != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> &amp;&amp;<span style="font-size:12px;line-height:1.5;"> k1.equals(k2))) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">24</span>                 Object v1 =<span style="font-size:12px;line-height:1.5;"> getValue();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">25</span>                 Object v2 =<span style="font-size:12px;line-height:1.5;"> e.getValue();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">26</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (v1 == v2 || (v1 != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> &amp;&amp;<span style="font-size:12px;line-height:1.5;"> v1.equals(v2)))
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">27</span>                     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">true</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">28</span> <span style="font-size:12px;line-height:1.5;">            }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">29</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">false</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">30</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">31</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">32</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> hashCode() {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">33</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> Objects.hashCode(getKey()) ^<span style="font-size:12px;line-height:1.5;"> Objects.hashCode(getValue());
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">34</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">35</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">36</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span><span style="font-size:12px;line-height:1.5;"> String toString() {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">37</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> getKey() + "=" +<span style="font-size:12px;line-height:1.5;"> getValue();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">38</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">39</span>         **********
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">40</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2. HashMap的存取实现</h2> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">(1) put方法的实现:</h3> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> V put(K key, V value) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 创建时未分配空间，所以检查如果还是空表的话，就分配内存空间  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (table ==<span style="font-size:12px;line-height:1.5;"> EMPTY_TABLE) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span> <span style="font-size:12px;line-height:1.5;">        inflateTable(threshold);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span> <span style="font-size:12px;line-height:1.5;">    }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 对null的key进行的特殊处理  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (key == <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">)  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> putForNullKey(value);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 计算key的hashCode  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> hash =<span style="font-size:12px;line-height:1.5;"> hash(key);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 根据hashCode和当前容量来确定元素在hash表中的位置，即hash桶的位置  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> i =<span style="font-size:12px;line-height:1.5;"> indexFor(hash, table.length);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 检查key是否已经存在，如果已经存在，则替换旧值为新值，并返回旧值  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span>; e =<span style="font-size:12px;line-height:1.5;"> e.next) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span> <span style="font-size:12px;line-height:1.5;">        Object k;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 这里可以看到是根据hashCode和equals方法来判断一个key是否已经存在  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key ||<span style="font-size:12px;line-height:1.5;"> key.equals(k))) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span>             V oldValue =<span style="font-size:12px;line-height:1.5;"> e.value;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>             e.value =<span style="font-size:12px;line-height:1.5;"> value;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>             e.recordAccess(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span><span style="font-size:12px;line-height:1.5;">);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> oldValue;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">22</span> <span style="font-size:12px;line-height:1.5;">        }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">23</span> <span style="font-size:12px;line-height:1.5;">    }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">24</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 增加map的修改次数，这用于实现fail-fast机制  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">25</span>     modCount++<span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">26</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 真正把元素添加到hash表中指定的索引位置处理（也叫hash桶）  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">27</span> <span style="font-size:12px;line-height:1.5;">    addEntry(hash, key, value, i);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">28</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 返回null表示key之前不存在  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">29</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">30</span> }  </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<strong>上面put()源码中有关于Map初始化的方法inflateTable(),源码如下: &nbsp;(如何初始化并分配内存)</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * Inflates the table.
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> inflateTable(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> toSize) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> Find a power of 2 &gt;= toSize   
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">保证容量是2的整数次幂  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> capacity =<span style="font-size:12px;line-height:1.5;"> roundUpToPowerOf2(toSize);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 在初始化的时候就把扩容的阙值计算好并保存，避免每次都重新计算  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span>         threshold = (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span>) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1<span style="font-size:12px;line-height:1.5;">);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 这里才会真正的分配内存  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>         table = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Entry[capacity];
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 初始化hash种子  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span> <span style="font-size:12px;line-height:1.5;">        initHashSeedAsNeeded(capacity);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 保证容量是2的整数次幂，并且不超过最大容量。 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 比如：传入的是15，值变成16，传入的是17，则会变成32， 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * 即大于当前值且与最接近2的整数次幂的数 
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>      
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> roundUpToPowerOf2(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> number) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> assert number &gt;= 0 : "number must be non-negative";  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">22</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">保证容量是2的整数次幂，并且不超过最大容量</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">23</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> number &gt;=<span style="font-size:12px;line-height:1.5;"> MAXIMUM_CAPACITY
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">24</span>                 ?<span style="font-size:12px;line-height:1.5;"> MAXIMUM_CAPACITY
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">25</span>                 : (number &gt; 1) ? Integer.highestOneBit((number - 1) &lt;&lt; 1) : 1<span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">26</span>     }    </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<strong>上面put()源码中对空值null的处理方法putForNullKey</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/**</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">     * Offloaded version of put for null keys
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>      <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span><span style="font-size:12px;line-height:1.5;"> V putForNullKey(V value) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 如果已经存在，则替换旧值  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[0]; e != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span>; e =<span style="font-size:12px;line-height:1.5;"> e.next) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (e.key == <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>                 V oldValue =<span style="font-size:12px;line-height:1.5;"> e.value;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span>                 e.value =<span style="font-size:12px;line-height:1.5;"> value;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>                 e.recordAccess(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span><span style="font-size:12px;line-height:1.5;">);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> oldValue;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span> <span style="font-size:12px;line-height:1.5;">            }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span> <span style="font-size:12px;line-height:1.5;">        }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 增加map的修改次数，这用于实现fail-fast机制  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span>         modCount++<span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> null key的hashCode固定为0，并且桶的位置也固定为0  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span>         addEntry(0, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span>, value, 0<span style="font-size:12px;line-height:1.5;">);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>     }  </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<strong>上面put()源码中如何确定非null的key的位置,对应indexFor()方法.&nbsp;</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">
    put()源码中写法如下:
    根据hashCode和当前容量来确定元素在hash表中的位置，即hash桶的位置
    int i = indexFor(hash, table.length); 
</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> indexFor(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> h, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> length) {  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> h &amp; (length-1<span style="font-size:12px;line-height:1.5;">);  
}      </span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">h是key的hashCode，length是当前hash表的最大长度，h &amp; (length-1)与h % length等价，只是前者使用位运算，而位运算比取模运算速度更快。这里为什么可以用&amp;运算代替取模运算呢？</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">因为length是2的整数次幂，而它减1，低位正好全是1，与另一个数进行&amp;运算，结果肯定不会超过length，与%运算的效果一样。如果length不是2的整数次幂，那么是不能这样做的，所以这里运用的非常巧妙。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">举例:length=8; 8的2进制是1000,7的2进制是111 &nbsp; &nbsp; 任何一个数和7相与&amp; 取值范围都是0~7 &nbsp;任何一个数和8取余范围也都是0~7</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>上面put()源码中最核心的生成hashCode的hash方法:</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> hash(Object k) {  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> h =<span style="font-size:12px;line-height:1.5;"> hashSeed;  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (0 != h &amp;&amp; k <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">instanceof</span><span style="font-size:12px;line-height:1.5;"> String) {  
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> sun.misc.Hashing.stringHash32((String) k);  
    }  
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 调用key的hashCode()方法得到hashCode  </span>
    h ^=<span style="font-size:12px;line-height:1.5;"> k.hashCode();  
  
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 对hashCode进行一系列的位移与异或运算并把结果作为hashCode返回  </span>
    h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12<span style="font-size:12px;line-height:1.5;">);  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4<span style="font-size:12px;line-height:1.5;">);  
}  </span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">这里为什么要进行这一系列的位移与异或运算呢？主要是经过它这里的运算之后，能够使这个hashCode中的bit 0和1均匀分布，从而减少hash冲突，从而提高整个HashMap的效率。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>上面put()源码中向Table数组中添加元素对应的addEntry()和createEntry()方法:</strong></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> addEntry(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> hash, K key, V value, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> bucketIndex) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 判断是否需要扩容，当前容量达到阙值，并且产生了hash冲突（指定hash桶已经有元素存在）  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> ((size &gt;= threshold) &amp;&amp; (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> !=<span style="font-size:12px;line-height:1.5;"> table[bucketIndex])) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 容量扩展为之前的2倍  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span>         resize(2 *<span style="font-size:12px;line-height:1.5;"> table.length);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>         hash = (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> != key) ? hash(key) : 0<span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 重新计算存储的hash桶位置  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>         bucketIndex =<span style="font-size:12px;line-height:1.5;"> indexFor(hash, table.length);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span> <span style="font-size:12px;line-height:1.5;">    }  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 创建Entry并存储到hash表中  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span> <span style="font-size:12px;line-height:1.5;">    createEntry(hash, key, value, bucketIndex);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span> <span style="font-size:12px;line-height:1.5;">}  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span>   
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> createEntry(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> hash, K key, V value, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> bucketIndex) {  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 取出之前已经存在的元素  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span>     Entry&lt;K,V&gt; e =<span style="font-size:12px;line-height:1.5;"> table[bucketIndex];  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 把新元素放到链表的开头，即让新元素的next引用指向之前已经存在的元素  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span>     table[bucketIndex] = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> Entry&lt;&gt;<span style="font-size:12px;line-height:1.5;">(hash, key, value, e);  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 修改元素计数  </span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>     size++<span style="font-size:12px;line-height:1.5;">;  
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span> }  </pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">这个里面还有resize()方法,即HashMap的扩容方法,下面会单独提到.</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>以上put的过程大致可以总结为以下4步:</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>1.</strong><strong>对</strong><strong>key</strong><strong>做</strong><strong>null</strong><strong>检查。如果</strong><strong>key</strong><strong>是</strong><strong>null</strong><strong>，会被存储到</strong><strong>table[0]</strong><strong>，因为</strong><strong>null</strong><strong>的</strong><strong>hash</strong><strong>值总是</strong><strong>0</strong><strong>。</strong><strong>&nbsp;</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>2.key</strong><strong>的</strong><strong>hashcode()</strong><strong>方法会被调用，然后计算</strong><strong>hash</strong><strong>值。</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>3.indexFor(hash,table.length)</strong><strong>用来计算在</strong><strong>table</strong><strong>数组中存储</strong><strong>Entry</strong><strong>对象的精确的索引。</strong>&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>4.</strong><strong>如果两个</strong><strong>key</strong><strong>有相同的</strong><strong>hash</strong><strong>值</strong><strong>(</strong><strong>也叫冲突</strong><strong>)</strong><strong>，它们会以迭代链表的形式来存储。</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>如果在刚才计算出来的索引位置没有元素，直接把</strong><strong>Entry</strong><strong>对象放在那个索引上。</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong><strong>如果索引上有元素，然后会进行迭代，一直到</strong><strong>Entry-&gt;next</strong><strong>是</strong><strong>null</strong><strong>。当前的</strong><strong>Entry</strong><strong>对象变成链表的下一个节点。</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>如果我们再次放入同样的key会怎样呢？会调用equals()方法来检查key的相等性(key.equals(k))，如果这个方法返回true，它就会用当前Entry的value来替换之前的value。</strong></p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">(2)HashMap的扩容resize();</h3> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">从put的源代码中可以看到，扩容需要满足以下两个条件：</p> 
   <ol style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:decimal;">达到加载因子指定的阙值</li> 
    <li style="list-style:decimal;">put当前值时发生hash冲突（即当前桶的位置已经存在有元素了）</li> 
   </ol>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">只是当前容器中key value数量超过阙值是不会进行扩容的。就是说，比如初始容量为16，当达到阙值以前发生大量的hash冲突，而后添加的元素又很少发生hash冲突，那么有可能key value的数量超过16*0.75=12甚至超过16都不进行扩容，所以hash算法必须保证分布均匀，尽量减少hash冲突。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">扩容时候的rehash:</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> resize(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> newCapacity) {  
    Entry[] oldTable </span>=<span style="font-size:12px;line-height:1.5;"> table;  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> oldCapacity =<span style="font-size:12px;line-height:1.5;"> oldTable.length;  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (oldCapacity ==<span style="font-size:12px;line-height:1.5;"> MAXIMUM_CAPACITY) {  
        threshold </span>=<span style="font-size:12px;line-height:1.5;"> Integer.MAX_VALUE;  
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;">;  
    }  
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 重新创建底层数组  </span>
    Entry[] newTable = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> Entry[newCapacity];  
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 对已经存在的元素进行重新hash放到新的hash桶中  </span>
<span style="font-size:12px;line-height:1.5;">    transfer(newTable, initHashSeedAsNeeded(newCapacity));  
    table </span>=<span style="font-size:12px;line-height:1.5;"> newTable;  
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 更新扩容阙值  </span>
    threshold = (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1<span style="font-size:12px;line-height:1.5;">);  
}  
  
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> transfer(Entry[] newTable, <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">boolean</span><span style="font-size:12px;line-height:1.5;"> rehash) {  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> newCapacity =<span style="font-size:12px;line-height:1.5;"> newTable.length;  
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (Entry&lt;K,V&gt;<span style="font-size:12px;line-height:1.5;"> e : table) {  
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">while</span>(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> !=<span style="font-size:12px;line-height:1.5;"> e) {  
            Entry</span>&lt;K,V&gt; next =<span style="font-size:12px;line-height:1.5;"> e.next;  
            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span><span style="font-size:12px;line-height:1.5;"> (rehash) {  
                e.hash </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> == e.key ? 0<span style="font-size:12px;line-height:1.5;"> : hash(e.key);  
            }  
            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> i =<span style="font-size:12px;line-height:1.5;"> indexFor(e.hash, newCapacity);  
            e.next </span>=<span style="font-size:12px;line-height:1.5;"> newTable[i];  
            newTable[i] </span>=<span style="font-size:12px;line-height:1.5;"> e;  
            e </span>=<span style="font-size:12px;line-height:1.5;"> next;  
        }  
    }  
}  </span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">由于hash表长度变化了，所以对于已经存在的元素，需要重新计算hashCode并放到新的hash桶中。这是一个比较耗时的操作，所以在创建HashMap时，如果对数据量有个预期值，那么，应该设置更合适的初始容量，以避免添加数据的过程中不断的扩容造成的性能损失。</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">(3)get()方法实现</h2> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> V get(Object key) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 2</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> null key进行特殊操作</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 3</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (key == <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 4</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> getForNullKey();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 5</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 获取key对应的Entry</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 6</span>         Entry&lt;K,V&gt; entry =<span style="font-size:12px;line-height:1.5;"> getEntry(key);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 7</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 如果存在则返回key对应的值，不存在则返回null</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 8</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> == entry ? <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;"> : entry.getValue();
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 9</span> <span style="font-size:12px;line-height:1.5;">    }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">10</span> 
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">11</span>     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> Entry&lt;K,V&gt;<span style="font-size:12px;line-height:1.5;"> getEntry(Object key) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">12</span>     <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> size为0表示没有元素，所以直接返回null</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">13</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (size == 0<span style="font-size:12px;line-height:1.5;">) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">14</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">15</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">16</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 获取key的hashCode</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">17</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> hash = (key == <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span>) ? 0<span style="font-size:12px;line-height:1.5;"> : hash(key);
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">18</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 获取key对应的hash桶中的元素，并对链表进行迭代返回相应的value</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">19</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (Entry&lt;K,V&gt; e =<span style="font-size:12px;line-height:1.5;"> table[indexFor(hash, table.length)];
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">20</span>              e != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">21</span>              e =<span style="font-size:12px;line-height:1.5;"> e.next) {
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">22</span> <span style="font-size:12px;line-height:1.5;">            Object k;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">23</span>             <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 根据hashCode和equalse（）方法来确定key</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">24</span>             <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (e.hash == hash &amp;&amp;
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">25</span>                 ((k = e.key) == key || (key != <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span> &amp;&amp;<span style="font-size:12px;line-height:1.5;"> key.equals(k))))
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">26</span>                 <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> e;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">27</span> <span style="font-size:12px;line-height:1.5;">        }
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">28</span>         <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 如果不存在，返回null</span>
<span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">29</span>         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;
</span><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">30</span>     }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">对于加载因子，默认为0.75，这是一个折衷的值， 我们可以通过构造方法来改变这个值，但是需要注意，加载因子越大，查询数据的开销可能越大。因为加载因子越大，意味着map中存放的元素越多，所以hash冲突的可能性越大，根据hashCode计算出的hash桶的位置相同，则保存为链表，而链表的查询操作会遍历整个链表，所以查询效率不高。而在get和put时都要查询元素，所以提高查询效率就提高了hashmap的效率。这是一种用空间换取时间的策略。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>为什么HashMap很高效呢？HashMap通过以下几点保证了它的效率：</strong></p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;">高效的hash算法，使其不易产生hash冲突</li> 
    <li style="list-style:disc;">基于数组存储，实现了元素和链表的优点可以快速存取</li> 
    <li style="list-style:disc;">可通过加载因子，使用空间换取时间</li> 
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font><span style="font-size:14px;">本文转自SummerChill博客园博客，原文链接：http://www.cnblogs.com/DreamDrive/p/7505448.html，如需转载请自行联系原作者</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
