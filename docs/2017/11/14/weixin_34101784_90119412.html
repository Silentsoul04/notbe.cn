<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>懒加载异常 途径 « NotBeCN</title>
  <meta name="description" content="             &nbsp; &nbsp; &nbsp;首先，了解一下什么是延迟加载：        所谓懒载入(lazy)就是延时载入。延迟载入。    什么时候用懒载入呢，我仅仅能回答要用懒载入的时候就用懒载入。    至于为什么要用懒载入呢，就是当我们要訪问的数据量过大时，明显用缓存不太合适，  ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/14/weixin_34101784_90119412.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">懒加载异常 途径</h1>
    <p class="post-meta">Nov 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; &nbsp;首先，了解一下什么是延迟加载：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;"></span></p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">所谓懒载入(lazy)就是延时载入。延迟载入。</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">什么时候用懒载入呢，我仅仅能回答要用懒载入的时候就用懒载入。</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">至于为什么要用懒载入呢，就是当我们要訪问的数据量过大时，明显用缓存不太合适，</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">由于内存容量有限 ，为了降低并发量，降低系统资源的消耗。</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">我们让数据在须要的时候才进行载入，这时我们就用到了懒载入。</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">比方部门ENTITY和员工ENTITY,部门与员工1对多，假设lazy设置为 false。那么仅仅要载入了一个部门的po,就会依据一对多配置的关系把全部员工的po也载入出来。可是实际上有时候仅仅是须要用到部门的信息，不须要用到 员工的信息，这时员工po的载入就等于浪费资源。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">假设lazy设置为true,那么仅仅有当你訪问部门po的员工信息时候才回去载入员工的po的信息。</p> 
   <p style="margin-left:auto;text-indent:2em;color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;">&nbsp;</p> 
   <div class="cnt" style="color:rgb(51,51,51);font-size:14px;font-family:Helvetica, Tahoma, Arial, sans-serif;line-height:25.1875px;"> 
    <p style="margin-left:auto;">hibernate3.0中lazy有三个值。true，false，proxy,默认的是lazy="proxy".<br> 详细设置成什么要看你的需求，并非说哪个设置就是最好的。<br> 假如在student对象中包括一个head对象<br> 假设你确定在用student对象的时候就要用到head对象里的属性。那你就设置马上载入，由于设置马上载入那么在查询student的同一时候就会查询 student的head。hibernate就会在查询的时候关联两张表从而生成的sql就可能仅仅有一条。</p> 
    <p>而假设你设置的是延迟载入。那么肯定会要生成 1+N条sql语句：当中“1”是查询student的语句。“N”是依据N个student的id去查询head的N条语句。并且，延迟载入是要用到的 时候才去运行查询，这样系统推断那里须要载入，那里不须要载入也须要时间，性能上肯定就不如马上载入了！<br> 假设。你是有的地方须要用到student的时候才用到head属性，那么你就设置成延迟载入，由于查询2张表的数据肯定要比查询1张表的数据消耗大。<br> 到低要如何设置就要看你的实际需求了</p> 
    <p style="margin-left:auto;">延迟载入机制是为了避免一些无谓的性能开销而提出来的。所谓延迟载入就是当在真正须要数据的时候，才真正运行数据载入操作。在Hibernate中提供了对实体对象的延迟载入以及对集合的延迟载入，另外在Hibernate3中还提供了对属性的延迟载入。</p> 
    <p><br><strong><span style="line-height:1.8;color:rgb(255,102,0);">A、实体对象的延迟载入&nbsp;<br></span></strong>假设想对实体对象使用延迟载入，必需要在实体的映射配置文件里进行对应的配置。例如以下所看到的：<br> &lt;hibernate-mapping&gt;<br> &lt;class name=”com.neusoft.entity.User” table=”user” lazy=”true”&gt;<br> &nbsp;&nbsp; 　……<br> &lt;/class&gt;<br> &lt;/hibernate-mapping&gt;<br> &nbsp;&nbsp;&nbsp; 　通过将class的lazy属性设置为true。来开启实体的延迟载入特性。</p> 
    <p>假设我们执行以下的代码：<br> User user=(User)session.load(User.class,”1”);（1）<br> System.out.println(user.getName());（2）<br> 当执行到(1)处时，Hibernate并没有发起对数据的查询。假设此时通过一些调试工具。观察此时user对象的内存快照，会惊奇的发现，此时返 回的可能是User$EnhancerByCGLIB$$bede8986类型的对象。并且其属性为null,这是怎么回 事？session.load()方法会返回实体对象的代理类对象，这里所返回的对象类型就是User对象的代理类对象。在Hibernate中通过使用 CGLIB,来实现动态构造一个目标对象的代理类对象。并且在代理类对象中包括目标对象的全部属性和方法，并且全部属性均被赋值为null。通过调试器显 示的内存快照，能够看出此时真正的User对象，是包括在代理对象的CGLIB$CALBACK_0.target属性中。当代码执行到（2）处时。此时 调用user.getName()方法。这时通过CGLIB赋予的回调机制，实际上调用CGLIB$CALBACK_0.getName()方法，当调用 该方法时，Hibernate会首先检查CGLIB$CALBACK_0.target属性是否为null。假设不为空，则调用目标对象的getName 方法。假设为空。则会发起数据库查询，生成类似这种SQL语句：select * from user where id=’1’;来查询数据，并构造目标对象，而且将它赋值到CGLIB$CALBACK_0.target属性中。</p> 
    <p><br> 这样。通过一个中间代理对象，Hibernate实现了实体的延迟载入，仅仅有当用户真正发起获得实体对象属性的动作时。才真正会发起数据库查询操作。 所以实体的延迟载入是用通过中间代理类完毕的。所以仅仅有session.load()方法才会利用实体延迟载入。由于仅仅有session.load()方 法才会返回实体类的代理类对象。</p> 
    <p></p> 
    <p style="margin-left:auto;"><br></p> 
    <p style="margin-left:auto;"><br></p> 
    <p style="margin-left:auto;"><br></p> 
    <p style="margin-left:auto;"><span style="line-height:26px;font-family:Arial;">两种处理方法：</span><br style="font-family:Arial;line-height:26px;"><span style="line-height:26px;font-family:Arial;">一、这是延时载入的问题，把有关联的全部pojo类，在hibernate.cfg.xml文件里。</span></p> 
    <p>一般在many-to-one中。set标签内中设lazy="false" 。<br style="font-family:Arial;line-height:26px;"><br style="font-family:Arial;line-height:26px;"><span style="line-height:26px;font-family:Arial;">二、用OpenSessionInViewFilter过滤器。注意hibernateFilter过滤器和struts2过滤器在映射时的先后顺序。</span></p> 
    <p>同一时候要配置事物处理，否则会导致session处于仅仅读状态而不能做改动、删除的动作。</p> 
    <p></p> 
    <p style="margin-left:auto;"><span style="line-height:26px;font-family:Arial;"><span style="line-height:1.8;"><span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">在web.xml文件里增加一个filter例如以下:注意要载入 struts过滤器前面。</span></span></span></p> 
    <p style="margin-left:auto;"><span style="line-height:26px;font-family:Arial;"><span style="line-height:1.8;"></span></span></p> 
    <pre><code class="language-html">&lt;!-- 配置opensessionInViewFilter 用于解决懒载入问题--&gt;
	&lt;filter&gt;
	   &lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt;
	   &lt;filter-class&gt;org.springframework.orm.hibernate3.support.OpenSessionInViewFilter&lt;/filter-class&gt;
	&lt;/filter&gt;
&lt;filter-mapping&gt;
		&lt;filter-name&gt;OpenSessionInViewFilter&lt;/filter-name&gt;
		&lt;url-pattern&gt;*.action&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre> 
    <br>
    <br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">
    <p></p> 
    <pre><span style="line-height:1.8;color:rgb(255,0,0);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;">分析原理:</span></pre> 
    <span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">作用是拦截".action“结尾的请求，OpensessionInViewFilter的作用是将session延时关闭。</span>
    <br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">
    <div style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">
     <img alt="Hibernate中懒载入错误的解决方法 - 九鬼 - 朝阳起又落" src="http://img128.ph.126.net/nc2JO9BfWKv5DFpldxfALQ==/2104869875844064398.png" style="border:0px;">
    </div> 
    <span style="line-height:1.8;"><span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">&nbsp;</span><br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;"><span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">在action类中会调用service层的方法,然后调用session.一般当session訪问结束之后就会将session关闭.</span><br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;"><span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">比方我们要得到user的列表,默认情况下是不会将当中的roles的所有信息所有查出来的,最多仅仅给出一个id,或者是name.</span><br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;"><span style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">可是我们这个时候假设要打印roles的类容,就会报懒载入异常了.由于hibernate根本就没有将role的数据查出来.</span></span>
    <br style="line-height:28px;color:rgb(76,76,76);font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:16px;">
    <p></p> 
    <p style="margin-left:auto;"><span style="line-height:26px;font-family:Arial;"><br></span></p> 
   </div> 
   <div> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;">版权声明：本文博客原创文章，博客，未经同意，不得转载。</p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p><font color="#333333"><span style="font-size:12px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/4632826.html，如需转载请自行联系原作者</span></font></p> 
    <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
