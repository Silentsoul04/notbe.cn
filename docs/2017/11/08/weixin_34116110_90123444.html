<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ZOJ 3229 Shoot the Bullet 无源汇上下界最大流 « NotBeCN</title>
  <meta name="description" content="             Shoot the Bullet       Time Limit:&nbsp;2 Seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Memory Limit:&nbsp;32768 KB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/weixin_34116110_90123444.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">ZOJ 3229 Shoot the Bullet 无源汇上下界最大流</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <span class="bigProblemTitle" style="line-height:1.8;font-size:24px;color:#0000FF;">Shoot the Bullet</span> 
   <hr style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">
   <span style="line-height:1.8;color:#008000;">Time Limit:&nbsp;</span>2 Seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
   <span style="line-height:1.8;color:#008000;">Memory Limit:&nbsp;</span>32768 KB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
   <span style="line-height:1.8;color:#0000FF;">Special Judge</span> 
   <hr style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><em>Gensokyo</em>&nbsp;is a world which exists quietly beside ours, separated by a mystical border. It is a utopia where humans and other beings such as fairies,&nbsp;<em>youkai</em>(phantoms), and gods live peacefully together. Shameimaru Aya is a crow tengu with the ability to manipulate wind who has been in&nbsp;<em>Gensokyo</em>&nbsp;for over 1000 years. She runs the Bunbunmaru News - a newspaper chock-full of rumors, and owns the&nbsp;<em>Bunkachou</em>&nbsp;- her record of interesting observations for Bunbunmaru News articles and pictures of beautiful&nbsp;<em>danmaku</em>(barrange) or cute girls living in<em>Gensokyo</em>. She is the biggest connoisseur of rumors about the girls of&nbsp;<em>Gensokyo</em>&nbsp;among the tengu. Her intelligence gathering abilities are the best in&nbsp;<em>Gensokyo</em>!</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"></p> 
   <img src="http://acm.zju.edu.cn/onlinejudge/showImage.do?%3C/p%3E%3Cp%3Ename=shoot_the_bullet_0.jpg" alt="" style="border:0px;">
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"></p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">During the coming&nbsp;<em>n</em>&nbsp;days, Aya is planning to take many photos of&nbsp;<em>m</em>&nbsp;cute girls living in&nbsp;<em>Gensokyo</em>&nbsp;to write Bunbunmaru News daily and record at least&nbsp;<em>G<sub>x</sub></em>&nbsp;photos of girl&nbsp;<em>x</em>&nbsp;in total in the<em>Bunkachou</em>. At the&nbsp;<em>k</em>-th day, there are&nbsp;<em>C<sub>k</sub></em>&nbsp;targets,&nbsp;<em>T<sub>k1</sub></em>,&nbsp;<em>T<sub>k2</sub></em>, ...,&nbsp;<em>T<sub>kC<sub>k</sub></sub></em>. The number of photos of target&nbsp;<em>T<sub>ki</sub></em>&nbsp;that Aya takes should be in range [<em>L<sub>ki</sub></em>,&nbsp;<em>R<sub>ki</sub></em>], if less, Aya cannot write an interesting article, if more, the girl will become angry and use her&nbsp;<em>last spell card</em>&nbsp;to attack Aya. What's more, Aya cannot take more than&nbsp;<em>D<sub>k</sub></em>&nbsp;photos at the&nbsp;<em>k</em>-th day.&nbsp;<strong>Under these constraints, the more photos, the better</strong>.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">Aya is not good at solving this complex problem. So she comes to you, an earthling, for help.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><strong>Input</strong></p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">There are about 40 cases. Process to the end of file.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">Each case begins with two integers 1 &lt;=&nbsp;<em>n</em>&nbsp;&lt;= 365, 1 &lt;=&nbsp;<em>m</em>&nbsp;&lt;= 1000. Then&nbsp;<em>m</em>&nbsp;integers,&nbsp;<em>G<sub>1</sub></em>,&nbsp;<em>G<sub>2</sub></em>, ...,&nbsp;<em>G<sub>m</sub></em>&nbsp;in range [0, 10000]. Then&nbsp;<em>n</em>&nbsp;days. Each day begins with two integer 1 &lt;=&nbsp;<em>C</em>&nbsp;&lt;= 100, 0 &lt;=&nbsp;<em>D</em>&nbsp;&lt;= 30000. Then&nbsp;<em>C</em>&nbsp;<strong>different</strong>&nbsp;targets. Each target is described by three integers, 0 &lt;=&nbsp;<em>T</em>&nbsp;&lt;&nbsp;<em>m</em>, 0 &lt;=&nbsp;<em>L</em>&nbsp;&lt;=&nbsp;<em>R</em>&nbsp;&lt;= 100.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><strong>Output</strong></p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">For each case, first output the number of photos Aya can take,&nbsp;<strong>-1 if it's impossible to satisfy her needing</strong>. If there is a best strategy, output the number of photos of each girl Aya should take at each day on separate lines. The output must be in the same order as the input. If there are more than one best strategy, any one will be OK.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;">Output a blank line after each case.</p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><strong>Sample Input</strong></p> 
   <pre>2 3
12 12 12
3 18
0 3 9
1 3 9
2 3 9
3 18
0 3 9
1 3 9
2 3 9

2 3
12 12 12
3 18
0 3 9
1 3 9
2 3 9
3 18
0 0 3
1 3 6
2 6 9

2 3
12 12 12
3 15
0 3 9
1 3 9
2 3 9
3 21
0 0 3
1 3 6
2 6 12

</pre> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><strong>Sample Output</strong></p> 
   <pre>36
6
6
6
6
6
6

36
9
6
3
3
6
9

-1

</pre> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><strong>External Links</strong></p> 
   <p style="color:rgb(51,51,51);font-size:14px;font-family:Arial, Helvetica, Verdana, sans-serif;"><a href="http://www16.big.or.jp/~zun/" rel="nofollow" style="color:#0000FF;border-bottom:1px dotted rgb(51,51,51);"><img alt="TeamShanghaiAlice(banner)" src="http://www16.big.or.jp/~zun/image/banner.gif" style="border:0px;">&nbsp;</a><br><a href="http://en.wikipedia.org/wiki/Shoot_the_Bullet" rel="nofollow" style="color:#0000FF;border-bottom:1px dotted rgb(51,51,51);">Wikipedia</a><br><a href="http://touhou.wikia.com/wiki/Shoot_the_Bullet" rel="nofollow" style="color:#0000FF;border-bottom:1px dotted rgb(51,51,51);">Touhou Wiki</a><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:26px;color:rgb(54,46,43);font-family:Arial;">把每一天看成一个点，每一个女孩也看成一个点，添加源和汇，源向每一天连上[0,d]的边。每一天与每一个女孩假设有拍照任务的话连上[l,c]的边，每一个女孩与汇连上[g,oo]的边，于是构成一个有上下界的图，直接用上下界最大流来搞即可了</span><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:26px;color:rgb(54,46,43);font-family:Arial;"></span></p> 
   <pre><code class="language-cpp">#include &lt;cstdlib&gt;
#include &lt;cctype&gt;
#include &lt;cstring&gt;
#include &lt;cstdio&gt;
#include &lt;cmath&gt;
#include &lt;algorithm&gt;
#include &lt;vector&gt;
#include &lt;string&gt;
#include &lt;iostream&gt;
#include &lt;map&gt;
#include &lt;set&gt;
#include &lt;queue&gt;
#include &lt;stack&gt;
#include &lt;bitset&gt;

using namespace std;

#define PB push_back
#define MP make_pair
#define REP(i,n) for(int i=0;i&lt;(n);++i)
#define FOR(i,l,h) for(int i=(l);i&lt;=(h);++i)
#define DWN(i,h,l) for(int i=(h);i&gt;=(l);--i)
#define CLR(vis,pos) memset(vis,pos,sizeof(vis))
#define PI acos(-1.0)
#define INF 0x3f3f3f3f
#define LINF 1000000000000000000LL
#define eps 1e-8

typedef long long ll;

const int MAXN=2222;

struct Edge{
    int from,to,cap,flow;
};
bool cmp(const Edge&amp; a,const Edge&amp; b){
    return a.from &lt; b.from || (a.from == b.from &amp;&amp; a.to &lt; b.to);
}
struct Dinic{
    int n,m,s,t;
    vector&lt;Edge&gt; edges;
    vector&lt;int&gt; G[MAXN];
    bool vis[MAXN];
    int d[MAXN];
    int cur[MAXN];
    void init(int n){
        this-&gt;n=n;
        for(int i=0;i&lt;=n;i++)G[i].clear();
        edges.clear();
    }
    void AddEdge(int from,int to,int cap){
        edges.push_back((Edge){from,to,cap,0});
        edges.push_back((Edge){to,from,0,0});//当是无向图时，反向边容量也是cap,有向边时，反向边容量是0
        m=edges.size();
        G[from].push_back(m-2);
        G[to].push_back(m-1);
    }
    bool BFS(){
        CLR(vis,0);
        queue&lt;int&gt; Q;
        Q.push(s);
        d[s]=0;
        vis[s]=1;
        while(!Q.empty()){
            int x=Q.front();
            Q.pop();
            for(int i=0;i&lt;G[x].size();i++){
                Edge&amp; e=edges[G[x][i]];
                if(!vis[e.to]&amp;&amp;e.cap&gt;e.flow){
                    vis[e.to]=1;
                    d[e.to]=d[x]+1;
                    Q.push(e.to);
                }
            }
        }
        return vis[t];
    }
    int DFS(int x,int a){
        if(x==t||a==0)return a;
        int flow=0,f;
        for(int&amp; i=cur[x];i&lt;G[x].size();i++){
            Edge&amp; e=edges[G[x][i]];
            if(d[x]+1==d[e.to]&amp;&amp;(f=DFS(e.to,min(a,e.cap-e.flow)))&gt;0){
                e.flow+=f;
                edges[G[x][i]^1].flow-=f;
                flow+=f;
                a-=f;
                if(a==0)break;
            }
        }
        return flow;
    }
    //当所求流量大于need时就退出。减少时间
    int Maxflow(int s,int t,int need){
        this-&gt;s=s;this-&gt;t=t;
        int flow=0;
        while(BFS()){
            CLR(cur,0);
            flow+=DFS(s,INF);
            if(flow&gt;need)return flow;
        }
        return flow;
    }
    //最小割割边
    vector&lt;int&gt; Mincut(){
        BFS();
        vector&lt;int&gt; ans;
        for(int i=0;i&lt;edges.size();i++){
            Edge&amp; e=edges[i];
            if(vis[e.from]&amp;&amp;!vis[e.to]&amp;&amp;e.cap&gt;0)ans.push_back(i);
        }
        return ans;
    }
    void Reduce(){
        for(int i = 0; i &lt; edges.size(); i++) edges[i].cap -= edges[i].flow;
    }
    void ClearFlow(){
        for(int i = 0; i &lt; edges.size(); i++) edges[i].flow = 0;
    }
};

int w[MAXN],d[MAXN],low[100010];

Dinic solver;

int main()
{
    int n,m;
    while(~scanf("%d%d",&amp;n,&amp;m)){
        solver.init(n+m+3);
        int tmp;
        CLR(w,0),CLR(d,0),CLR(low,0);
        FOR(i,1,m){
            scanf("%d",&amp;tmp);
            w[n+i]-=tmp;
            w[n+m+1]+=tmp;
        }
        int c;
        int g=0;
        FOR(i,1,n){
            scanf("%d%d",&amp;c,&amp;d[i]);
            int t;
            REP(j,c){
                scanf("%d%d%d",&amp;t,&amp;low[++g],&amp;tmp);
                t++;
                solver.AddEdge(i,t+n,tmp-low[g]);
                w[i]-=low[g];
                w[t+n]+=low[g];
            }
        }
        FOR(i,1,n) solver.AddEdge(0,i,d[i]);
        FOR(i,1,m) solver.AddEdge(n+i,n+m+1,INF);
        solver.AddEdge(n+m+1,0,INF);
        int sum=0;
        FOR(i,0,n+m+1){
            if(w[i]&gt;0){
                solver.AddEdge(n+m+2,i,w[i]);
                sum+=w[i];
            }
            if(w[i]&lt;0)
                solver.AddEdge(i,n+m+3,-w[i]);
        }
        int ans=solver.Maxflow(n+m+2,n+m+3,2*INF);
        //cout&lt;&lt;sum&lt;&lt;" "&lt;&lt;ans&lt;&lt;endl;
        if(ans!=sum){
            printf("-1\n");
        }
        else{
            tmp=solver.Maxflow(0,n+m+1,INF);
            cout&lt;&lt;tmp&lt;&lt;endl;
            FOR(i,1,g)
             printf("%d\n",solver.edges[2*i-2].flow+low[i]);
        }
        printf("\n");
    }
    return 0;
}
</code></pre> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div> 
    <div>
     <br>
    </div> 
    <div>
     本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/5153858.html，如需转载请自行联系原作者
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
