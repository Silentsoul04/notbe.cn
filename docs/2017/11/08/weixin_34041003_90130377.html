<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>使用Solr索引MySQL数据 « NotBeCN</title>
  <meta name="description" content="             环境搭建    1、到apache下载solr，地址：http://mirrors.hust.edu.cn/apache/lucene/solr/    2、解压到某个目录    3、cd into D:\Solr\solr-4.10.3\example    4、Execute the...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/weixin_34041003_90130377.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">使用Solr索引MySQL数据</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>环境搭建</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">1、到apache下载solr，地址：<a href="http://mirrors.hust.edu.cn/apache/lucene/solr/" rel="nofollow" style="color:rgb(0,0,0);">http://mirrors.hust.edu.cn/apache/lucene/solr/</a></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">2、解压到某个目录</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">3、cd into D:\Solr\solr-4.10.3\example</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">4、Execute the server by “java -jar startup.jar”Solr会自动运行在自带的Jetty上</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">5、访问<a href="http://localhost:8983/solr/#/" rel="nofollow" style="color:rgb(0,0,0);">http://localhost:8983/solr/#/</a></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">PS：solr-5.0 以上默认对schema的管理是使用managed-schema，不能手动修改，需要使用Schema Restful的API操作。如果要想手动修改配置，把managed-schema拷贝一份修改为schema.xml，在solrconfig.xml中修改如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> &lt;schemaFactory class="ManagedIndexSchemaFactory"&gt;
    &lt;bool name="mutable"&gt;true&lt;/bool&gt;
    &lt;str name="managedSchemaResourceName"&gt;managed-schema&lt;/str&gt;
  &lt;/schemaFactory&gt; </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">--&gt;</span>
  
<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> &lt;processor class="solr.AddSchemaFieldsUpdateProcessorFactory"&gt;
      &lt;str name="defaultFieldType"&gt;strings&lt;/str&gt;
      &lt;lst name="typeMapping"&gt;
        &lt;str name="valueClass"&gt;java.lang.Boolean&lt;/str&gt;
        &lt;str name="fieldType"&gt;booleans&lt;/str&gt;
      &lt;/lst&gt;
      &lt;lst name="typeMapping"&gt;
        &lt;str name="valueClass"&gt;java.util.Date&lt;/str&gt;
        &lt;str name="fieldType"&gt;tdates&lt;/str&gt;
      &lt;/lst&gt;
      &lt;lst name="typeMapping"&gt;
        &lt;str name="valueClass"&gt;java.lang.Long&lt;/str&gt;
        &lt;str name="valueClass"&gt;java.lang.Integer&lt;/str&gt;
        &lt;str name="fieldType"&gt;tlongs&lt;/str&gt;
      &lt;/lst&gt;
      &lt;lst name="typeMapping"&gt;
        &lt;str name="valueClass"&gt;java.lang.Number&lt;/str&gt;
        &lt;str name="fieldType"&gt;tdoubles&lt;/str&gt;
      &lt;/lst&gt;
    &lt;/processor&gt; </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">--&gt;</span>
    
  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">schemaFactory </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">class</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="ClassicIndexSchemaFactory"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>创建<span>MySQL数据</span></strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>DataBase Name: mybatis</span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>Table Name: user</span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>Db.sql</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:none;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>使用<span>DataImportHandler导入并索引数据</span></strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>1）&nbsp;配置<span>D:\Solr\solr-4.10.3\example\solr\collection1\conf\solrconfig.xml</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在<span>&lt;requestHandler name="/select" class="solr.SearchHandler"&gt;前面上加上一个<span>dataimport的处理的<span>Handler</span></span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">requestHandler </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="/dataimport"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> class</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="org.apache.solr.handler.dataimport.DataImportHandler"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">lst </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="defaults"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">str </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="config"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>data-config.xml<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">str</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　     <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">lst</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">requestHandler</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>2）&nbsp;在同目录下添加<span>data-config.xml</span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);font-size:12px;line-height:1.5;">xml version="1.0" encoding="UTF-8"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataConfig</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataSource </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="JdbcDataSource"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> driver</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="com.mysql.jdbc.Driver"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> url</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="jdbc:mysql://127.0.0.1:3306/mybatis"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> user</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="root"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> password</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="luxx"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> batchSize</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="-1"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">document </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="testDoc"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">entity </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="user" </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">pk</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">
                query</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="select * from user"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　　         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　　        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userName"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userName"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
            <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAge"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAge"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
            <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAddress"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAddress"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　　  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">entity</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">document</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataConfig</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">说明：</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>dataSource是数据库数据源。</span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>Entity就是一张表对应的实体，<span>pk是主键，<span>query是查询语句。</span></span></span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>Field对应一个字段，<span>column是数据库里的<span>column名，后面的<span>name属性对应着<span>Solr的<span>Filed的名字。</span></span></span></span></span></span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><span>3）&nbsp;修改同目录下的<span>schema.xml，这是<span>Solr对数据库里的数据进行索引的模式</span></span></span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">（<span>1）保留<span>_version_ 这个<span>field</span></span></span></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">（<span>2）添加索引字段：这里每个<span>field的<span>name要和<span>data-config.xml里的<span>entity的<span>field的<span>name一样，一一对应。</span></span></span></span></span></span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="int"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> required</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> multiValued</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="false"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>

<span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">&lt;field name="id" type="int" indexed="true" stored="true" required="true" multiValued="false"/&gt; </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">--&gt;</span>

<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userName"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="text_general"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>

<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAge"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="int"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>

<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAddress"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="text_general"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">（<span>3）删除多余的<span>field，删除<span>copyField里的设置，这些用不上。注意：<span>text这个<span>field不能删除，否则<span>Solr启动失败。</span></span></span></span></span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="text"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="text_general"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="false"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> multiValued</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">（4）设置唯一主键：&lt;uniqueKey&gt;id&lt;/uniqueKey&gt;，注意：Solr中索引的主键默认是只支持type="string"字符串类型的，而我的数据库中id是int型的，会有问题，解决方法：修改同目录下的elevate.xml，注释掉下面2行，这貌似是Solr的Bug，原因不明。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">doc </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">id</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="MA147LL/A"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">doc </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">id</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="IW-02"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> exclude</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">4）拷贝mysql-connector-java-5.1.22-bin.jar和solr-dataimporthandler-4.10.3.jar到D:\Solr\solr-4.10.3\example\solr-webapp\webapp\WEB-INF\lib。一个是mysql的java驱动，另一个在D:\Solr\solr-4.10.3\dist目录里，是org.apache.solr.handler.dataimport.DataImportHandler所在的jar。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">重启Solr。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果配置正确就可以启动成功。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">solrconfig.xml是solr的基础文件，里面配置了各种web请求处理器、请求响应处理器、日志、缓存等。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">schema.xml配置映射了各种数据类型的索引方案。分词器的配置、索引文档中包含的字段也在此配置。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>索引测试</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">进入Solr主页，在Core Selector中选择collection1：<a href="http://localhost:8983/solr/#/collection1" rel="nofollow" style="color:rgb(0,0,0);">http://localhost:8983/solr/#/collection1</a></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">点击Dataimport，Command选择full-import（默认），点击“Execute”，Refresh Status就可以看到结果：</p> 
   <p align="left" style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>Indexing completed. Added/Updated: 7 documents.Deleted 0 documents.</strong></p> 
   <p align="left" style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">Requests: 1, Fetched: 7, Skipped: 0, Processed: 7</p> 
   <p align="left" style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">Started: 8 minutes ago</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">Query测试：在q中输入userName:test1进行检索就可以看到结果。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这里使用full-import索引了配置数据库中的全部数据，使用Solr可以查询对应的数据。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>使用Solrj索引并检索数据</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面是使用Solr Admin页面上的功能测试索引和检索，也可以使用代码来操作Solr，下面的代码测试了在Solr索引中添加了一个User类实体，并通过查找所有的index来返回结果。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">User实体类：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.mybatis.test.model;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.beans.Field;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> User {

    @Field
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> id;
    
    @Field
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span><span style="font-size:12px;line-height:1.5;"> String userName;
    
    @Field
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> userAge;
    
    @Field
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span><span style="font-size:12px;line-height:1.5;"> String userAddress;

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> getId() {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> id;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setId(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> id) {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.id =<span style="font-size:12px;line-height:1.5;"> id;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> String getUserName() {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> userName;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> setUserName(String userName) {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.userName =<span style="font-size:12px;line-height:1.5;"> userName;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> getUserAge() {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> userAge;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span> setUserAge(<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span><span style="font-size:12px;line-height:1.5;"> userAge) {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.userAge =<span style="font-size:12px;line-height:1.5;"> userAge;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> String getUserAddress() {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span><span style="font-size:12px;line-height:1.5;"> userAddress;
    }

    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> setUserAddress(String userAddress) {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.userAddress =<span style="font-size:12px;line-height:1.5;"> userAddress;
    }

    @Override
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span><span style="font-size:12px;line-height:1.5;"> String toString() {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">return</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.userName + " " + <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span>.userAge + " " + <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">this</span><span style="font-size:12px;line-height:1.5;">.userAddress;
    }

}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">使用@Field注解的属性要和Solr配置的Field对应。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">测试代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">package</span><span style="font-size:12px;line-height:1.5;"> com.solr.test;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> java.io.IOException;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.SolrQuery;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.SolrServer;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.SolrServerException;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.impl.HttpSolrServer;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.response.QueryResponse;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.client.solrj.response.UpdateResponse;
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> org.apache.solr.common.SolrDocumentList;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">import</span><span style="font-size:12px;line-height:1.5;"> com.mybatis.test.model.User;

</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> SolrTest {
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span><span style="font-size:12px;line-height:1.5;"> SolrServer server;
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">private</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">final</span> String DEFAULT_URL = "http://localhost:8983/solr/collection1"<span style="font-size:12px;line-height:1.5;">;
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> init() {
        server </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> HttpSolrServer(DEFAULT_URL);
    }
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> indexUser(User user){
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">try</span><span style="font-size:12px;line-height:1.5;"> {
            </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">添加user bean到索引库</span>
            <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">try</span><span style="font-size:12px;line-height:1.5;"> {
                UpdateResponse response </span>=<span style="font-size:12px;line-height:1.5;"> server.addBean(user);
                server.commit();
                System.out.println(response.getStatus());
            } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">catch</span><span style="font-size:12px;line-height:1.5;"> (IOException e) {
                e.printStackTrace();
            }
        } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">catch</span><span style="font-size:12px;line-height:1.5;"> (SolrServerException e) {
            e.printStackTrace();
        } 
    }
    
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">测试添加一个新的bean实例到索引</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> testIndexUser(){
        User user </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> User();
        user.setId(</span>8<span style="font-size:12px;line-height:1.5;">);
        user.setUserAddress(</span>"place"<span style="font-size:12px;line-height:1.5;">);
        user.setUserName(</span>"cdebcdccga"<span style="font-size:12px;line-height:1.5;">);
        user.setUserAge(</span>83<span style="font-size:12px;line-height:1.5;">);
        
        indexUser(user);
    }
    
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> testQueryAll() {
        SolrQuery params </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> SolrQuery();
        
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 查询关键词，*:*代表所有属性、所有值，即所有index</span>
        params.set("q", "*:*"<span style="font-size:12px;line-height:1.5;">);
        
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 分页，start=0就是从0开始，rows=5当前返回5条记录，第二页就是变化start这个值为5就可以了。</span>
        params.set("start", 0<span style="font-size:12px;line-height:1.5;">);
        params.set(</span>"rows"<span style="font-size:12px;line-height:1.5;">, Integer.MAX_VALUE);
            
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 排序，如果按照id排序，那么将score desc 改成 id desc(or asc)
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> params.set("sort", "score desc");</span>
        params.set("sort", "id asc"<span style="font-size:12px;line-height:1.5;">);
        
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 返回信息*为全部，这里是全部加上score，如果不加下面就不能使用score</span>
        params.set("fl", "*,score"<span style="font-size:12px;line-height:1.5;">);
        
        QueryResponse response </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">try</span><span style="font-size:12px;line-height:1.5;"> {
            response </span>=<span style="font-size:12px;line-height:1.5;"> server.query(params);
        } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">catch</span><span style="font-size:12px;line-height:1.5;"> (SolrServerException e) {
            e.printStackTrace();
        }
        
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span>(response!=<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">null</span><span style="font-size:12px;line-height:1.5;">){
            System.out.println(</span>"Search Results: "<span style="font-size:12px;line-height:1.5;">);
            SolrDocumentList list </span>=<span style="font-size:12px;line-height:1.5;"> response.getResults();
            </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">int</span> i = 0; i &lt; list.size(); i++<span style="font-size:12px;line-height:1.5;">) {
                System.out.println(list.get(i));
            }
        }
    }
     
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">public</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">static</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">void</span><span style="font-size:12px;line-height:1.5;"> main(String[] args) {
        init();
        </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">testIndexUser();</span>
<span style="font-size:12px;line-height:1.5;">        testQueryAll();
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果在数据库中添加一条数据，但是Solr索引中没有index这条数据，就查不到，所以一般在使用Solr检索数据库里的内容时，都是先插入数据库，再在Solr中index这条数据，使用Solr的模糊查询或是分词功能来检索数据库里的内容。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>DIH</strong><strong>增量从MYSQL数据库导入数据</strong><br> 已经学会了如何全量导入MySQL的数据，全量导入在数据量大的时候代价非常大，一般来说都会适用增量的方式来导入数据，下面介绍如何增量导入MYSQL数据库中的数据，以及如何设置定时来做。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>1）</strong><strong>数据库表的更改</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">前面已经创建好了一个User的表，这里为了能够进行增量导入，需要新增一个字段updateTime，类型为timestamp，默认值为CURRENT_TIMESTAMP。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">有了这样一个字段，Solr才能判断增量导入的时候，哪些数据是新的。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">因为Solr本身有一个默认值last_index_time，记录最后一次做full import或者是delta import(增量导入）的时间，这个值存储在文件conf目录的dataimport.properties文件中。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>2）</strong><strong>data-config.xml</strong><strong>中必要属性的设置</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">transformer 格式转化：HTMLStripTransformer 索引中忽略HTML标签</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">query：查询数据库表符合记录数据</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">deltaQuery：增量索引查询主键ID&nbsp; 注意这个只能返回ID字段 &nbsp;&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">deltaImportQuery：增量索引查询导入的数据&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">deletedPkQuery：增量索引删除主键ID查询&nbsp;注意这个只能返回ID字段 &nbsp;&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">有关“query”，“deltaImportQuery”， “deltaQuery”的解释，引用官网说明，如下所示：<br> The query gives the data needed to populate fields of the Solr document in full-import<br> The deltaImportQuery gives the data needed to populate fields when running a delta-import<br> The deltaQuery gives the primary keys of the current entity which have changes since the last index time</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果需要关联子表查询，可能需要用到parentDeltaQuery</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">The parentDeltaQuery uses the changed rows of the current table (fetched with deltaQuery) to give the changed rows in theparent table. This is necessary because whenever a row in the child table changes, we need to re-generate the document which&nbsp;has that field.</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">更多说明看DeltaImportHandler的说明文档。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">针对User表，data-config.xml文件的配置内容如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);font-size:12px;line-height:1.5;">xml version="1.0" encoding="UTF-8"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataConfig</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataSource </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="JdbcDataSource"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> driver</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="com.mysql.jdbc.Driver"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> url</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="jdbc:mysql://127.0.0.1:3306/mybatis"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> user</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="root"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> password</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="luxx"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> batchSize</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="-1"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">document </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="testDoc"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">entity </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="user"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> pk</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">
                query</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="select * from user"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">
                deltaImportQuery</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="select * from user where id='${dih.delta.id}'"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">
                deltaQuery</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="select id from user where updateTime&gt; '${dataimporter.last_index_time}'"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　　         <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="id"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　　        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userName"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userName"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
            <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAge"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAge"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
            <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAddress"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="userAddress"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">column</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="updateTime"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="updateTime"</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span>
　　　  <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">entity</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
　　<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">document</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">dataConfig</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">增量索引的原理是从数据库中根据deltaQuery指定的SQL语句查询出所有需要增量导入的数据的ID号。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">然后根据deltaImportQuery指定的SQL语句返回所有这些ID的数据，即为这次增量导入所要处理的数据。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">核心思想是：通过内置变量“${dih.delta.id}”和 “${dataimporter.last_index_time}”来记录本次要索引的id和最近一次索引的时间。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">注意：刚新加上的updateTime字段也要在field属性中配置，同时也要在schema.xml文件中配置：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">field </span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;">name</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="updateTime"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> type</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="date"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> indexed</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span><span style="color:rgb(255,0,0);font-size:12px;line-height:1.5;"> stored</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">="true"</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">/&gt;</span></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果业务中还有删除操作，可以在数据库中加一个isDeleted字段来表明该条数据是否已经被删除，这时候Solr在更新index的时候，可以根据这个字段来更新哪些已经删除了的记录的索引。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这时候需要在dataConfig.xml中添加：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="font-size:12px;line-height:1.5;">query="select * from user where isDeleted=0"
deltaImportQuery="select * from user where id='${dih.delta.id}'"
deltaQuery="select id from user where updateTime&gt; '${dataimporter.last_index_time}' and isDeleted=0"
deletedPkQuery="select id from user where isDeleted=1"</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这时候Solr进行增量索引的时候，就会删除数据库中isDeleted=1的数据的索引。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>测试</strong><strong>增量导入</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果User表里有数据，可以先清空以前的测试数据（因为加的updateTime没有值），用我的Mybatis测试程序添加一个User，数据库会以当前时间赋值给该字段。在Solr中使用Query查询所有没有查询到该值，使用dataimport?command=delta-import增量导入，再次查询所有就可以查询到刚刚插入到MySQL的值。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><strong>设置增量导入为定时执行的任务</strong></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">可以用Windows计划任务，或者Linux的Cron来定期访问增量导入的连接来完成定时增量导入的功能，这其实也是可以的，而且应该没什么问题。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">但是更方便，更加与Solr本身集成度高的是利用其自身的定时增量导入功能。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">1、下载apache-solr-dataimportscheduler-1.0.jar放到\solr-webapp\webapp\WEB-INF\lib目录下：<br> 下载地址：<a href="http://code.google.com/p/solr-dataimport-scheduler/downloads/list" rel="nofollow" style="color:rgb(0,0,0);">http://code.google.com/p/solr-dataimport-scheduler/downloads/list</a><br> 也可以到百度云盘下载：<a href="http://pan.baidu.com/s/1dDw0MRn" rel="nofollow" style="color:rgb(0,0,0);">http://pan.baidu.com/s/1dDw0MRn</a></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">注意：apache-solr-dataimportscheduler-1.0.jar有bug，参考：http://www.denghuafeng.com/post-242.html</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">2、修改solr的WEB-INF目录下面的web.xml文件：<br> 为&lt;web-app&gt;元素添加一个子元素</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">listener</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">listener-class</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span><span style="font-size:12px;line-height:1.5;">
    org.apache.solr.handler.dataimport.scheduler.ApplicationListener
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">listener-class</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">listener</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">3、新建配置文件dataimport.properties：</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在SOLR_HOME\solr目录下面新建一个目录conf（注意不是SOLR_HOME\solr\collection1下面的conf），然后用解压文件打开apache-solr-dataimportscheduler-1.0.jar文件，将里面的dataimport.properties文件拷贝过来，进行修改，下面是最终我的自动定时更新配置文件内容：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>#################################################
#                                               #
#       dataimport scheduler properties         #
#                                               #
#################################################

#  to sync or not to sync
#  1 - active; anything else - inactive
syncEnabled=1

#  which cores to schedule
#  in a multi-core environment you can decide which cores you want syncronized
#  leave empty or comment it out if using single-core deployment
#  syncCores=game,resource
syncCores=collection1

#  solr server name or IP address
#  [defaults to localhost if empty]
server=localhost

#  solr server port
#  [defaults to 80 if empty]
port=8983

#  application name/context
#  [defaults to current ServletContextListener's context (app) name]
webapp=solr

#  URLparams [mandatory]
#  remainder of URL
#http://localhost:8983/solr/collection1/dataimport?command=delta-import&amp;clean=false&amp;commit=true
params=/dataimport?command=delta-import&amp;clean=false&amp;commit=true

#  schedule interval
#  number of minutes between two runs
#  [defaults to 30 if empty]
interval=1

#  重做索引的时间间隔，单位分钟，默认7200，即1天; 
#  为空,为0,或者注释掉:表示永不重做索引
# reBuildIndexInterval=2

#  重做索引的参数
reBuildIndexParams=/dataimport?command=full-import&amp;clean=true&amp;commit=true

#  重做索引时间间隔的计时开始时间，第一次真正执行的时间=reBuildIndexBeginTime+reBuildIndexInterval*60*1000；
#  两种格式：2012-04-11 03:10:00 或者  03:10:00，后一种会自动补全日期部分为服务启动时的日期
reBuildIndexBeginTime=03:10:00</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这里为了做测试每1分钟就进行一次增量索引，同时disable了full-import全量索引。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">4、测试</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在数据库中插入一条数据，在Solr Query中查询，刚开始查不到，Solr进行一次增量索引后就可以查询到了。</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">一般来说要在你的项目中引入Solr需要考虑以下几点：<br> 1、数据更新频率：每天数据增量有多大，及时更新还是定时更新<br> 2、数据总量：数据要保存多长时间<br> 3、一致性要求：期望多长时间内看到更新的数据，最长允许多长时间延迟<br> 4、数据特点：数据源包括哪些，平均单条记录大小<br> 5、业务特点：有哪些排序要求，检索条件<br> 6、资源复用：已有的硬件配置是怎样的，是否有升级计划</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">代码托管在GitHub上：<a href="https://github.com/luxiaoxun/Code4Java" rel="nofollow" style="color:rgb(0,0,0);">https://github.com/luxiaoxun/Code4Java</a></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">参考：</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">http://wiki.apache.org/solr/DataImportHandler</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">http://wiki.apache.org/solr/Solrj</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">http://www.denghuafeng.com/post-242.html</p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p><font color="#333333"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自阿凡卢博客园博客，原文链接：http://www.cnblogs.com/luxiaoxun/p/4442770.html</span></font><span style="font-size:15px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
