<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>理解Docker（7）：Docker 存储 - AUFS « NotBeCN</title>
  <meta name="description" content="             （1）Docker 安装及基本用法    （2）Docker 镜像    （3）Docker 容器的隔离性 - 使用 Linux namespace 隔离容器的运行环境    （4）Docker 容器的隔离性 - 使用 cgroups 限制容器使用的资源    （5）Docker 网络 ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/weixin_34185512_90128515.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">理解Docker（7）：Docker 存储 - AUFS</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）<a href="http://www.cnblogs.com/sammyliu/p/5875470.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 安装及基本用法</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）<a href="http://www.cnblogs.com/sammyliu/p/5877964.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 镜像</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）<a href="http://www.cnblogs.com/sammyliu/p/5878973.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 容器的隔离性 - 使用 Linux namespace 隔离容器的运行环境</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）<a href="http://www.cnblogs.com/sammyliu/p/5886833.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 容器的隔离性 - 使用 cgroups 限制容器使用的资源</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）<a href="http://www.cnblogs.com/sammyliu/p/5894191.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 网络</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（6）<a href="http://www.cnblogs.com/sammyliu/p/5926343.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">若干企业生产环境中的容器网络方案</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（7）<a href="http://www.cnblogs.com/sammyliu/p/5931383.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker 存储&nbsp;- AUFS</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; Docker 存储可以分为分层文件系统和卷，本文将介绍 AUFS 分层文件系统。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1. 基础知识</h2> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1.1 Linux 的 rootfs 和 bootfs</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;&nbsp;一个典型的 Linux 系统要能运行的话，它至少需要两个文件系统：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">boot file system （bootfs）：包含 boot loader 和 kernel。用户不会修改这个文件系统。实际上，在启动（boot）过程完成后，整个内核都会被加载进内存，此时 bootfs 会被卸载掉从而释放出所占用的内存。同时也可以看出，对于同样内核版本的不同的 Linux 发行版的&nbsp;bootfs&nbsp;都是一致的。</li> 
    <li style="list-style-type:disc;">root file system （rootfs）：包含典型的目录结构，包括&nbsp;/dev, /proc, /bin, /etc, /lib, /usr, and /tmp 等再加上要运行用户应用所需要的所有配置文件，二进制文件和库文件。这个文件系统在不同的Linux 发行版中是不同的。而且用户可以对这个文件进行修改。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161005105818129-587679739.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Linux 系统在启动时，roofs 首先会被挂载为只读模式，然后在启动完成后被修改为读写模式，随后它们就可以被修改了。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">1.2 AUFS</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;AUFS 是一种 Union File System（联合文件系统），又叫 Another UnionFS，后来叫Alternative UnionFS，再后来叫成高大上的 Advance UnionFS。所谓 UnionFS，就是把不同物理位置的目录合并mount到同一个目录中。UnionFS的一个最主要的应用是，把一张CD/DVD和一个硬盘目录给联合 mount在一起，然后，你就可以对这个只读的CD/DVD上的文件进行修改（当然，修改的文件存于硬盘上的目录里）。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 举个例子，在 Ubuntu 14.04 系统上现有如下目录结构：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">$ tree
.
├── fruits
│   ├── apple
│   └── tomato
└── vegetables
    ├── carrots
    └── tomato</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">输入以下几个命令：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;"># 创建一个mount目录
$ mkdir mnt
 
# 把水果目录和蔬菜目录union mount到 .</span>/<span style="line-height:1.5;">mnt目录中
$ sudo mount </span>-t aufs -o dirs=./fruits:./vegetables none ./<span style="line-height:1.5;">mnt
 
#  查看.</span>/<span style="line-height:1.5;">mnt目录
$ tree .</span>/<span style="line-height:1.5;">mnt
.</span>/<span style="line-height:1.5;">mnt
├── apple
├── carrots
└── tomato</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">我们可以看到在./mnt目录下有三个文件，苹果apple、胡萝卜carrots和蕃茄tomato。水果和蔬菜的目录被union到了./mnt目录下了。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">我们来修改一下其中的文件内容：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>$ echo mnt &gt; ./mnt/<span style="line-height:1.5;">apple
$ cat .</span>/mnt/<span style="line-height:1.5;">apple
mnt
$ cat .</span>/fruits/<span style="line-height:1.5;">apple
mnt</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">上面的示例，我们可以看到./mnt/apple的内容改了，./fruits/apple的内容也改了。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>$ echo mnt_carrots &gt; ./mnt/<span style="line-height:1.5;">carrots
$ cat .</span>/vegetables/<span style="line-height:1.5;">carrots
 
$ cat .</span>/fruits/<span style="line-height:1.5;">carrots
mnt_carrots</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">关于 AUFS 的几个特点：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">AUFS 是一种联合文件系统，它把若干目录按照顺序和权限 mount 为一个目录并呈现出来</li> 
    <li style="list-style-type:disc;">默认情况下，只有第一层（第一个目录）是可写的，其余层是只读的。</li> 
    <li style="list-style-type:disc;">增加文件：默认情况下，新增的文件都会被放在最上面的可写层中。</li> 
    <li style="list-style-type:disc;">删除文件：因为底下各层都是只读的，当需要删除这些层中的文件时，AUFS&nbsp;使用 whiteout 机制，它的实现是通过在上层的可写的目录下建立对应的whiteout隐藏文件来实现的。</li> 
    <li style="list-style-type:disc;">修改文件：AUFS 利用其 CoW （copy-on-write）特性来修改只读层中的文件。AUFS 工作在文件层面，因此，只要有对只读层中的文件做修改，不管修改数据的量的多少，在第一次修改时，文件都会被拷贝到可写层然后再被修改。</li> 
    <li style="list-style-type:disc;">节省空间：AUFS 的 CoW 特性能够允许在多个容器之间共享分层，从而减少物理空间占用。</li> 
    <li style="list-style-type:disc;">查找文件：AUFS 的查找性能在层数非常多时会出现下降，层数越多，查找性能越低，因此，在制作 Docker 镜像时要注意层数不要太多。</li> 
    <li style="list-style-type:disc;">性能：AUFS 的 CoW 特性在写入大型文件时第一次会出现延迟。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本部分内容主要应用自&nbsp;<a href="http://coolshell.cn/articles/17061.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker基础技术：AUFS</a>。&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">2. Docker 文件系统</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.1 Docker 镜像的 rootfs</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 前面基础知识部分谈到过，同一个内核版本的所有 Linux 系统的 bootfs 是相同的，而 rootfs 则是不同的。在 Docker 中，基础镜像中的 roofs 会一直保持只读模式，Docker 会利用 union mount 来在这个 rootfs 上增加更多的只读文件系统，最后它们看起来就像一个文件系统即容器的 rootfs。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161005103720598-1488807343.jpg" alt="" style="border:0px;">&nbsp;（<a href="http://crishantha.com/wp/?p=1549" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">图片来源</a>）</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">可见在一个Linux 系统之中，</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">所有 Docker 容器都共享主机系统的 bootfs 即 Linux 内核</li> 
    <li style="list-style-type:disc;">每个容器有自己的 rootfs，它来自不同的 Linux 发行版的基础镜像，包括 Ubuntu，Debian 和 SUSE 等</li> 
    <li style="list-style-type:disc;">所有基于一种基础镜像的容器都共享这种 rootfs</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">以&nbsp;training/webapp 镜像为例，</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa# docker history training/<span style="line-height:1.5;">webapp
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
6fae60ef3446        </span><span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) CMD [<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">python</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">app.py</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>]       <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) EXPOSE <span style="color:rgb(128,0,128);line-height:1.5;">5000</span>/tcp               <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) WORKDIR /opt/webapp           <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) ADD dir:9b2a69f6f30d18b02b5   <span style="color:rgb(128,0,128);line-height:1.5;">703</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c pip install -qr /tmp/requirements.   <span style="color:rgb(128,0,128);line-height:1.5;">4.363</span><span style="line-height:1.5;"> MB
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) ADD file:c59059439864153904   <span style="color:rgb(128,0,128);line-height:1.5;">41</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c DEBIAN_FRONTEND=noninteractive apt   <span style="color:rgb(128,0,128);line-height:1.5;">135.3</span><span style="line-height:1.5;"> MB
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c apt-<span style="color:rgb(0,0,255);line-height:1.5;">get</span> update                       <span style="color:rgb(128,0,128);line-height:1.5;">20.8</span><span style="line-height:1.5;"> MB
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">16</span> months ago       /bin/sh -c #(nop) MAINTAINER Docker Education   <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">17</span> months ago       /bin/sh -c #(nop) CMD [<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/bin/bash</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>]             <span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;"> B
</span>&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">17</span> months ago       /bin/sh -c sed -i <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">s/^#\s*\(deb.*universe\)$/   1.895 kB</span>
&lt;missing&gt;           <span style="color:rgb(128,0,128);line-height:1.5;">17</span> months ago       /bin/sh -c echo <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">#!/bin/sh</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> &gt; /usr/sbin/polic   <span style="color:rgb(128,0,128);line-height:1.5;">194.5</span><span style="line-height:1.5;"> kB
</span><span style="color:rgb(0,0,255);line-height:1.5;">&lt;missing&gt;           17 months ago       /bin/sh -c #(nop) ADD file:f4d7b4b3402b5c53f2   188.1 MB</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">它是基于 Ubuntu Docker 基础镜像。在基础镜像层中，我们能看到完整的 Ubuntu rootfs：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa# ls -<span style="line-height:1.5;">l
total </span><span style="color:rgb(128,0,128);line-height:1.5;">76</span><span style="line-height:1.5;">
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> bin
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">11</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2014</span><span style="line-height:1.5;"> boot
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">3</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> dev
drwxr</span>-xr-x <span style="color:rgb(128,0,128);line-height:1.5;">61</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> etc
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">11</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2014</span><span style="line-height:1.5;"> home
drwxr</span>-xr-x <span style="color:rgb(128,0,128);line-height:1.5;">12</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> lib
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> lib64
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> media
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">11</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2014</span><span style="line-height:1.5;"> mnt
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> opt
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">11</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2014</span><span style="line-height:1.5;"> proc
drwx</span>------  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> root
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">7</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> run
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> sbin
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> srv
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Mar <span style="color:rgb(128,0,128);line-height:1.5;">13</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2014</span><span style="line-height:1.5;"> sys
drwxrwxrwt  </span><span style="color:rgb(128,0,128);line-height:1.5;">2</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> tmp
drwxr</span>-xr-x <span style="color:rgb(128,0,128);line-height:1.5;">10</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span><span style="line-height:1.5;"> usr
drwxr</span>-xr-x <span style="color:rgb(128,0,128);line-height:1.5;">11</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Apr <span style="color:rgb(128,0,128);line-height:1.5;">27</span>  <span style="color:rgb(128,0,128);line-height:1.5;">2015</span> var</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">我们来看两种典型的文件：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）bin 目录中的文件会被直接使用</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@docker1:/<span style="color:rgb(128,0,0);line-height:1.5;">var</span>/lib/docker/aufs/diff# find -<span style="line-height:1.5;">iname mountpoint
.</span>/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa/bin/mountpoint</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）在基础镜像层中 proc 目录为空，也就是说容器中看到的 proc 目录中的文件是后来生成的。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.2 Docker 使用的 AUFS 文件系统</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 关于 Docker的分层镜像，除了 aufs，docker还支持btrfs, devicemapper和vfs，你可以使用 -s 或 –storage-driver= 选项来指定相关的镜像存储。在Ubuntu 14.04下，Docker 默认 Ubuntu的 AUFS。因为 AUFS 还没有进入Linux 内核主干的原因，RedHat 上使用的是 devicemapper。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 我们可以在 docker info 命令的输出中查看所使用的存储驱动：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="line-height:1.5;">Storage Driver: aufs
 Root Dir: </span>/<span style="color:rgb(136,136,136);line-height:1.5;">var</span>/lib/docker/<span style="line-height:1.5;">aufs
 Backing Filesystem: extfs
 Dirs: </span><span style="color:rgb(128,0,128);line-height:1.5;">19</span><span style="line-height:1.5;">
 Dirperm1 Supported: </span><span style="color:rgb(136,136,136);line-height:1.5;">false</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">以一个正在运行着的 Docker 容器为例，其镜像有13层：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">RootFS</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: {
            </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Type</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>: <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">layers</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
            </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Layers</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">: [
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:1154ba695078d29ea6c4e1adb55c463959cd77509adf09710e2315827d66271a</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:528c8710fd95f61d40b8bb8a549fa8dfa737d9b9c7c7b2ae55f745c972dddacd</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:37ee47034d9b78f10f0c5ce3a25e6b6e58997fcadaf5f896c603a10c5f35fb31</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:b75c0703b86b8ccbdc1f1b28b4982774768861ac250f83bdb940b1e90291f302</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5c121779bb29172c628a21087ea8ced766959da2f223c8b6bd4ffe943ace43d8</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:3ee91c5cb95b01496b4afdc721ba7fd3c22e0e5e2f3e9e70d3f8579b5082d4f3</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:6bbb1d0f845289217e20b66697fa7d651394d89983b0f5a89b88f037194476fe</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:b44b0832d4c6bf33122ce3aa896b133df88275e6d20663a9bf2d941f764ac1fd</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">
            ]
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">从 AUFS 的角度，可以看到有一个可写的容器层和14个只读的镜像层：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/sys/fs/aufs/si_ab487e40195df24f# cat *
/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab=<span style="line-height:1.5;">rw           #可写的容器层
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab-init=ro+<span style="line-height:1.5;">wh   #本层及以下是只读的镜像层
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/5472f8388f9a61f6bd84498201a5ad71a2ec88cda16c42a3a1da7c30da45f102=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/61dcf0881e790bf52ec555727b58641791adeefadcc7abc2a77fd228bde1371a=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/f68672aaf17dd158aabc635b2d8d459d79db1cd5ff38bf3834fe8f9c7a05235e=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/45818d286499870412357d66eb6af951699f89db785c7c6a242d2e1ac99734f9=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/85cb840562788e1b458e68265e62fd2da9d0d7e737256500e8a276bcb237183c=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/c18ba8efcb455e97f6aabe3985b147f6a37b8f5ad090373e88ddd326b4f90896=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/25de7dcc3a06f0caa3c701d4ed6c62f03e0757f6d477cc822db6e884bb366441=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/ad9e831217594cdfecd5e824690b0e52f2e16d6e2bb39b7143e66d467150cfe8=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/56d37c8eecd8be9ba13e07e1486e7a6ac2f0aa01f8e865ee6136137369d8d8a0=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/31bc6290457af4e560a3103020c85fbb5dfcfb201b0662a33165260529f87c07=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/e104672666119006648d0b82988c49527e52c64629750c5c9adde88acc790682=ro+<span style="line-height:1.5;">wh
</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff/7a085e415855435121fb7837c26a5e951f622bc69364d9228d409a4929b627e1=ro+wh</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">根据上面 AUFS 的定义，容器的文件系统是从 14 个只读镜像层和1个可写容器层通过 AUFS mount 出来的。示意图如下：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161005084258645-258019561.jpg" alt="" width="615" height="328" style="border:0px;">（<a href="https://docs.docker.com/engine/userguide/storagedriver/images/aufs_layers.jpg" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">图片来源</a>）</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这种分层文件系统可以通过官网的图来清晰的展示出来：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201610/697113-20161005083916504-222178094.jpg" alt="" width="228" height="178" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">做一些实验：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）在容器中创建一个文件，该文件会被创建在可写的容器层中</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff# find -<span style="line-height:1.5;">iname createdbysammy
.</span>/2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab/opt/webapp/<span style="line-height:1.5;">createdbysammy
root@docker1:</span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff# ls -<span style="line-height:1.5;">lt
total </span><span style="color:rgb(128,0,128);line-height:1.5;">60</span><span style="line-height:1.5;">
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">9</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Oct  <span style="color:rgb(128,0,128);line-height:1.5;">4</span> <span style="color:rgb(128,0,128);line-height:1.5;">22</span>:<span style="color:rgb(128,0,128);line-height:1.5;">37</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;"> 2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab</span>
drwxr</span>-xr-x  <span style="color:rgb(128,0,128);line-height:1.5;">6</span> root root <span style="color:rgb(128,0,128);line-height:1.5;">4096</span> Oct  <span style="color:rgb(128,0,128);line-height:1.5;">1</span> <span style="color:rgb(128,0,128);line-height:1.5;">11</span>:<span style="color:rgb(128,0,128);line-height:1.5;">56</span> 2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab-init</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）修改一个镜像层中的文件</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">修改前，文件&nbsp;/etc/apt/sources.list&nbsp;出现在两个层中：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff# find -<span style="line-height:1.5;">iname sources.list
.</span>/f68672aaf17dd158aabc635b2d8d459d79db1cd5ff38bf3834fe8f9c7a05235e/etc/apt/<span style="line-height:1.5;">sources.list
.</span>/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa/etc/apt/<span style="line-height:1.5;">sources.list<br></span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在容器中对它进行修改后，它被拷贝到了容器层然后被修改了：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff# find -<span style="line-height:1.5;">iname sources.list
.</span>/f68672aaf17dd158aabc635b2d8d459d79db1cd5ff38bf3834fe8f9c7a05235e/etc/apt/<span style="line-height:1.5;">sources.list
<span style="color:rgb(0,0,255);line-height:1.5;">.</span></span><span style="color:rgb(0,0,255);line-height:1.5;">/2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab/etc/apt/</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">sources.list</span>
.</span>/b2188d5c09cfe24acd6da5ce67720f81138f0c605a25efc592f1f55b3fd3dffa/etc/apt/sources.list</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">而另外两个层中的文件保持了不变。这说明了 AUFS 的 CoW 特性。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）删除容器层中的文件</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">容器中的文件&nbsp;./usr/local/lib/python2.7/dist-packages/itsdangerous.py 位于&nbsp;56d37c8eecd8be9ba13e07e1486e7a6ac2f0aa01f8e865ee6136137369d8d8a0 层中，这是一个只读层。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在容器内删除它：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@fa385836d5b9:/# find -<span style="line-height:1.5;">iname itsdangerous.py
.</span>/usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/<span style="line-height:1.5;">itsdangerous.py
root@fa385836d5b9:</span>/# rm ./usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/<span style="line-height:1.5;">itsdangerous.py
root@fa385836d5b9:</span>/# find -iname itsdangerous.py</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">然后，容器层中出现了一个 .wh 文件，而镜像层中的文件保持不变：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@docker1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/docker/aufs/diff# find -iname *<span style="line-height:1.5;">itsdangerous.py
.</span>/56d37c8eecd8be9ba13e07e1486e7a6ac2f0aa01f8e865ee6136137369d8d8a0/usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/<span style="line-height:1.5;">itsdangerous.py
.</span>/2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab/usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/<span style="color:rgb(0,0,255);line-height:1.5;">.wh.itsdangerous.py</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在手工将 .wh 文件删除后，文件就会再次回到容器中。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre> rm ./2ee58d81e4ac6811bbc78beb4b46bf213c79c9e2dc7e441741afc8c4349c6bab/usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/.wh.itsdangerous.py</pre>
   </div> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@fa385836d5b9:/# find -<span style="line-height:1.5;">iname itsdangerous.py
.</span>/usr/local/lib/python2.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>/dist-packages/itsdangerous.py</pre>
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;font-size:14px;">&nbsp;</span></h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">参考链接：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><a href="http://coolshell.cn/articles/17061.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Docker基础技术：AUFS</a></li> 
    <li style="list-style-type:disc;"><a href="http://crishantha.com/wp/?p=1549" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://crishantha.com/wp/?p=1549</a></li> 
   </ul>
   <div>
    <font color="#4b4b4b"><span style="font-size:15px;"><br></span></font>
   </div> 
   <div>
    <font color="#4b4b4b"><span style="font-size:15px;"><br></span></font>
   </div> 
   <div>
    <font color="#4b4b4b"><span style="font-size:15px;"><br></span></font>
   </div> 
   <div> 
    <font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/5931383.html</span></font>
    <span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
