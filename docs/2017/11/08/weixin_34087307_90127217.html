<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux signal 那些事儿（4）信号的deliver顺序【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://blog.chinaunix.net/uid-24774106-id-4084864.html    上一篇博文提到了，如果同时有多个不同的信号处于挂起状态，kernel如何选择deliver那个信号。&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/weixin_34087307_90127217.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux signal 那些事儿（4）信号的deliver顺序【转】</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">转自：<a href="http://blog.chinaunix.net/uid-24774106-id-4084864.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://blog.chinaunix.net/uid-24774106-id-4084864.html</a></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;">上一篇博文提到了，如果同时有多个不同的信号处于挂起状态，kernel如何选择deliver那个信号。<br><span style="line-height:2;">&nbsp; &nbsp;&nbsp;<img src="http://blog.chinaunix.net/attachment/201401/14/24774106_1389707600M8Jn.png" alt="" width="700" height="143" style="border:none;"><br><span style="line-height:2;">&nbsp; &nbsp; next_signal 负责从挂起信号中选择deliver的signo：当然，有线程显存私有的penging，有线程组共有的pending，对于线程而言，先从自己私有的pending中选，处理完毕私有的才会去处理线程组共有的pending，这个逻辑的代码在：<br></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(255,0,0);">int dequeue_signal<span style="color:rgb(0,0,204);">(struct task_struct&nbsp;<span>*tsk<span>, sigset_t&nbsp;<span>*mask<span>, siginfo_t&nbsp;<span>*info<span>)<br></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int signr<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* We only dequeue&nbsp;<span style="color:rgb(0,0,255);">private signals from ourselves<span style="color:rgb(0,0,204);">, we don<span>'t&nbsp;<span style="color:rgb(0,0,255);">let<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* signalfd steal them<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;signr&nbsp;<span style="color:rgb(0,0,204);">= __dequeue_signal<span>(<span>&amp;tsk<span>-<span>&gt;pending<span>, mask<span>, info<span>)<span>; &nbsp;//线程私有的penging优先<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!signr<span>)&nbsp;<span>{<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signr&nbsp;<span style="color:rgb(0,0,204);">= __dequeue_signal<span>(<span>&amp;tsk<span>-<span>&gt;signal<span>-<span>&gt;shared_pending<span>,<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask<span style="color:rgb(0,0,204);">, info<span>)<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;。。。。<br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 换句话说，如果存在挂起队列中，我们用tkill/tgkill发送的信号会先于用kill发送的信号被deliver，这个我们按下不提，我们看在同一个penging队列中如何挑选下个deliver的signal：<br></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol style="line-height:2;">
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(255,0,0);">int next_signal<span style="color:rgb(0,0,204);">(struct sigpending&nbsp;<span>*pending<span>, sigset_t&nbsp;<span>*mask<span>)<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;unsigned long i<span style="color:rgb(0,0,204);">,&nbsp;<span>*s<span>,&nbsp;<span>*m<span>, x<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int sig&nbsp;<span style="color:rgb(0,0,204);">= 0<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;<span style="color:rgb(0,0,204);">= pending<span>-<span>&gt;signal<span>.sig<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;<span style="color:rgb(0,0,204);">= mask<span>-<span>&gt;sig<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>*<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* Handle the first word specially<span>: it contains the<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* synchronous signals that need&nbsp;<span style="color:rgb(0,0,255);">to be dequeued first<span style="color:rgb(0,0,204);">.<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>*s&nbsp;<span>&amp;<span>~&nbsp;<span>*m<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(x<span>)&nbsp;<span>{<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(x&nbsp;<span>&amp; SYNCHRONOUS_MASK<span>)<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span style="color:rgb(0,0,204);">&amp;<span>= SYNCHRONOUS_MASK<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig&nbsp;<span style="color:rgb(0,0,204);">= ffz<span>(<span>~x<span>)&nbsp;<span>+ 1<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return sig<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span style="color:rgb(0,0,204);">(_NSIG_WORDS<span>)&nbsp;<span>{<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;default<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for&nbsp;<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 1<span>; i&nbsp;<span>&lt; _NSIG_WORDS<span>;&nbsp;<span>+<span>+i<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>*<span>+<span>+s&nbsp;<span>&amp;<span>~&nbsp;<span>*<span>+<span>+m<span>;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!x<span>)<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig&nbsp;<span style="color:rgb(0,0,204);">= ffz<span>(<span>~x<span>)&nbsp;<span>+ i<span>*_NSIG_BPW&nbsp;<span>+ 1<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case 2<span style="color:rgb(0,0,204);">:<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<span style="color:rgb(0,0,204);">= s<span>[1<span>]&nbsp;<span>&amp;<span>~ m<span>[1<span>]<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!x<span>)<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig&nbsp;<span style="color:rgb(0,0,204);">= ffz<span>(<span>~x<span>)&nbsp;<span>+ _NSIG_BPW&nbsp;<span>+ 1<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case 1<span style="color:rgb(0,0,204);">:<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>*&nbsp;<span style="color:rgb(0,0,255);">Nothing&nbsp;<span>to&nbsp;<span>do&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return sig<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
    <div> 
     <span style="color:rgb(0,0,204);"><span><span style="line-height:12px;"><br></span></span></span> 
     <ol style="list-style:none outside;color:rgb(92,92,92);line-height:1.3;font-family:Consolas, monospace;letter-spacing:.1px;">
      <li style="list-style:none outside;"><span style="color:rgb(0,0,0);">#define SYNCHRONOUS_MASK&nbsp;<span style="color:rgb(0,0,204);">\<br></span></span></li> 
      <li style="list-style:none outside;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(sigmask<span>(SIGSEGV<span>)&nbsp;<span>|&nbsp;sigmask<span>(SIGBUS<span>)&nbsp;<span>|&nbsp;sigmask<span>(SIGILL<span>)&nbsp;<span>|&nbsp;<span>\<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:none outside;">&nbsp;&nbsp;&nbsp;&nbsp; sigmask<span style="color:rgb(0,0,204);">(SIGTRAP<span>)&nbsp;<span>|&nbsp;sigmask<span>(SIGFPE<span>)&nbsp;<span>|&nbsp;sigmask<span>(SIGSYS<span>)<span>)</span></span></span></span></span></span></span></span></span> </li> 
     </ol>
     <span style="color:rgb(0,0,204);"><span style="line-height:12px;"><br></span></span> 
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 上一篇博客讲了处于<span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;">SYNCHRONOUS_MASK<span style="line-height:2;">里面的信号是优先处理的信号，他们都是一些硬件相关<span style="line-height:2;">的信号，多是由于异常出错引起。其次是传统信号，[32,64<span style="line-height:2;">]之间的实时信号，优先级最低。<br><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 换句话说所有信号分成三个等级，{SIGILL(<span style="line-height:2;">4),SIGTRAP(<span style="line-height:2;">5),SIGBUS(7),SIGFPE(8),SIGSEGV(11),SIGSYS(31)<span style="line-height:2;">},这是第一等级，传统信号中排除第一等级的信号，就是第二等级的信号，[34,64<span style="line-height:2;">]之间的信号属于第三等级。如果同一等级内，存在多个信号，按照小信号优先的顺序去deliver。<br><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 举个例子:<span style="line-height:2;">&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">kill&nbsp;<span style="color:rgb(0,0,204);">-10 $signal_pid<br></span></span></li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-3 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-12 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-11 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-39 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-2 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-5 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-4 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-36 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-24 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-38 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-37 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-31 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-8 $signal_pid<br></span> </li> 
     <li style="list-style:decimal;">kill&nbsp;<span style="color:rgb(0,0,204);">-7 $signal_pid</span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们可以看到，我们向同一进程发送多个信号，加入进程阻塞了所有信号（当然SIGKILL/SIGSTOP 不考虑<span style="line-height:2;">）。这时候，这些个信号，都会位于挂起信号之中，一旦进程解除阻塞，那么考验deliver顺序的时候到了。<br><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们按照kernel的规则，顺序应该是{4,5,7,8,11,31, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="line-height:2;">2,3，10,12,24, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="line-height:2;">36,37,38<span style="line-height:2;">}这么个顺序。<br><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 写个测试程序：<span style="line-height:2;">&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/Dropbox<span>/Note<span>/signal# cat signal_delivery_order<span>.c&nbsp;<br></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdio<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdlib<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;unistd<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;signal<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;<span style="color:rgb(255,0,0);">string<span style="color:rgb(0,0,204);">.h<span>&gt;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;errno<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">static&nbsp;<span style="color:rgb(255,0,0);">int sig_cnt<span style="color:rgb(0,0,204);">[NSIG<span>]<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">static number<span style="color:rgb(0,0,204);">= 0&nbsp;<span>;<br></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(255,0,0);">int sigorder<span style="color:rgb(0,0,204);">[128<span>]<span>=&nbsp;<span>{0<span>}<span>;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">#define MSG&nbsp;<span style="color:rgb(255,0,255);">"#%d:receiver signal %d\n"<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">void handler<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">int signo<span style="color:rgb(0,0,204);">)<br></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigorder<span style="color:rgb(0,0,204);">[number<span>+<span>+<span>]&nbsp;<span>= signo<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(255,0,0);">int main<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">int argc<span style="color:rgb(0,0,204);">,char<span>* argv<span>[<span>]<span>)<br></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int i&nbsp;<span style="color:rgb(0,0,204);">= 0<span>;&nbsp;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int k&nbsp;<span style="color:rgb(0,0,204);">= 0<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigset_t blockall_mask&nbsp;<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigset_t pending_mask&nbsp;<span style="color:rgb(0,0,204);">;&nbsp;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigset_t empty_mask&nbsp;<span style="color:rgb(0,0,204);">;&nbsp;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct sigaction sa&nbsp;<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigfillset<span style="color:rgb(0,0,204);">(<span>&amp;blockall_mask<span>)<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">#ifdef&nbsp;<span>USE_SIGACTION<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sa<span style="color:rgb(0,0,204);">.sa_handler&nbsp;<span>= handler<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sa<span style="color:rgb(0,0,204);">.sa_mask&nbsp;<span>= blockall_mask&nbsp;<span>;&nbsp;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp; &nbsp; sa.sa_flags = SA_RESTART;</li> 
     <li style="list-style:decimal;">#endif<br></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"%s:PID is %ld\n"<span style="color:rgb(0,0,204);">,argv<span>[0<span>]<span>,getpid<span>(<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 1<span>; i&nbsp;<span>&lt; NSIG<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(i&nbsp;<span>=<span>= SIGKILL&nbsp;<span>|<span>| i&nbsp;<span>=<span>= SIGSTOP<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">#ifdef USE_SIGACTION&nbsp;<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigaction<span>(i<span>,<span>&amp;sa<span>,&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<span>!<span>=0<span>)<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">#<span style="color:rgb(0,0,255);">else&nbsp;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(signal<span>(i<span>,handler<span>)<span>=<span>= SIG_ERR<span>)<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">#endif&nbsp;<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"sigaction for signo(%d) failed (%s)\n"<span style="color:rgb(0,0,204);">,i<span>,strerror<span>(errno<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span>-1<span>;<br></span></span></span></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(argc&nbsp;<span>&gt; 1<span>)<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int sleep_time&nbsp;<span style="color:rgb(0,0,204);">= atoi<span>(argv<span>[1<span>]<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigprocmask<span>(SIG_SETMASK<span>,<span>&amp;blockall_mask<span>,<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)&nbsp;<span>=<span>=&nbsp;<span>-1<span>)<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"setprocmask to block all signal failed(%s)\n"<span style="color:rgb(0,0,204);">,strerror<span>(errno<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,204);">-2<span>;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"I will sleep %d second\n"<span style="color:rgb(0,0,204);">,sleep_time<span>)<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep<span style="color:rgb(0,0,204);">(sleep_time<span>)<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigpending<span>(<span>&amp;pending_mask<span>)&nbsp;<span>=<span>=&nbsp;<span>-1<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"sigpending failed(%s)\n"<span style="color:rgb(0,0,204);">,strerror<span>(errno<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,204);">-2<span>;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 1&nbsp;<span>; i&nbsp;<span>&lt; NSIG&nbsp;<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigismember<span>(<span>&amp;pending_mask<span>,i<span>)<span>)<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"signo(%d) :%s\n"<span style="color:rgb(0,0,204);">,i<span>,strsignal<span>(i<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigemptyset<span style="color:rgb(0,0,204);">(<span>&amp;empty_mask<span>)<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigprocmask<span>(SIG_SETMASK<span>,<span>&amp;empty_mask<span>,<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)&nbsp;<span>=<span>=&nbsp;<span>-1<span>)<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"setprocmask to release all signal failed(%s)\n"<span style="color:rgb(0,0,204);">,strerror<span>(errno<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,204);">-3<span>;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">( i&nbsp;<span>= 0&nbsp;<span>; i&nbsp;<span>&lt; 1000000&nbsp;<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;<span style="color:rgb(0,0,204);">= random<span>(<span>)<span>%1234567<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 0&nbsp;<span>; i<span>&lt; number&nbsp;<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(sigorder<span>[i<span>]&nbsp;<span>!<span>= 0<span>)<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"#%d: signo=%d\n"<span style="color:rgb(0,0,204);">,i<span>,sigorder<span>[i<span>]<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return 0<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 注意这个USE_SIGACTION宏包裹的部分是我后来想到的，在我开始的版本中用的是signal（i,handler）来注册函数。handler函数很有意思，是我精心设计的：&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">void handler<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">int signo<span style="color:rgb(0,0,204);">)<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigorder<span style="color:rgb(0,0,204);">[number<span>+<span>+<span>]&nbsp;<span>= signo<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp;按照执行的顺序，我会讲signo的值记录在全局数组中，等到进程退出前，我打印数组的值，就能得到信号deliver的顺序。<br><span style="font-size:14.4px;line-height:2;">&nbsp; &nbsp; 这个进程会阻塞<span style="font-size:14.4px;line-height:2;">所有信号一段时间，在这段时间内，我会向该进程发送一坨信号，待阻塞解除后，打印数组的值，从而获得deliver的顺序。<br><span style="line-height:2;">&nbsp; &nbsp; 看下测试程序：&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;">root@manu-hacks:~/code/c/self/signal_deliver# cat test_order.sh&nbsp;<br> #!/bin/bash&nbsp;<br><br><br> if [&nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:.219em;line-height:normal;"><span class="noError" style="border:1px solid;vertical-align:0px;line-height:normal;font-size:12.6px;color:#000000;">1&nbsp;-eq&nbsp;0&nbsp;]&nbsp;<br> then&nbsp;<br> ./sigaction_delivery_order&nbsp;&nbsp;30&nbsp;&nbsp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;#正确的程序&nbsp;<br> else&nbsp;<br> ./signal_delivery_order&nbsp;&nbsp;30&nbsp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#我最初的程序，信号处理函数执行期间，没有屏蔽其他信号。&nbsp;<br> fi&nbsp;<br> signal_pid=</span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">1&nbsp;-eq&nbsp;0&nbsp;]&nbsp;then&nbsp;./sigaction_delivery_order&nbsp;&nbsp;30&nbsp;&nbsp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;#正确的程序&nbsp;else&nbsp;./signal_delivery_order&nbsp;&nbsp;30&nbsp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#我最初的程序，信号处理函数执行期间，没有屏蔽其他信号。&nbsp;fi&nbsp;signal_pid=</span></span>!<br><br><br> sleep 2<br> kill -10 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">3</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−3</span></span>signal_pid<br> kill -12 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">11</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−11</span></span>signal_pid<br> kill -39 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">2</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−2</span></span>signal_pid<br> kill -5 &nbsp;&nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">4</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−4</span></span>signal_pid<br> kill -36 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">24</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−24</span></span>signal_pid<br> kill -38 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">37</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−37</span></span>signal_pid<br> kill -31 &nbsp;<span class="MathJax" style="line-height:normal;word-spacing:normal;border:0px;"><span class="math" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;font-size:18.48px;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mrow" style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">s</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">g<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">n</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">a</span><span class="msubsup" style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span><span style="border:0px;vertical-align:0px;line-height:normal;"><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-size:13.0654px;font-family:'MathJax_Math-italic';">p</span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">d<span style="border:0px;vertical-align:0px;line-height:normal;"></span></span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">k</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">i</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mi" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Math-italic';">l</span><span class="mo" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">−</span><span class="mn" style="border:0px;vertical-align:0px;line-height:normal;font-family:'MathJax_Main';">8</span></span><span style="border:0px;vertical-align:0px;line-height:normal;width:0px;"></span></span></span><span style="border-width:0px;border-left-style:solid;vertical-align:-.425em;line-height:normal;width:0px;"></span></span><span class="MJX_Assistive_MathML" style="border:0px;vertical-align:0px;line-height:normal;width:1px;">signalpidkill−8</span></span>signal_pid<br> kill -7 &nbsp; $signal_pid<br>
      <div>
       <br>
      </div> <br></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 设计很精巧，设计出这个程序后，我很得意，认为验证deliver传递顺序是水到渠成的事情。<br> &nbsp; &nbsp; 梦想很丰满，无奈现实很骨感，我看了执行结果，那是当头一棒啊：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/Dropbox/Note/signal#&nbsp;<br></span></span></span></span></span></li> 
     <li style="list-style:decimal;">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/Dropbox/Note/signal#&nbsp;<span>.<span>/test_order<span>.sh 1&nbsp;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">.<span>/signal_delivery_order<span>:PID is 31403<br></span></span></span></li> 
     <li style="list-style:decimal;">sigaction&nbsp;<span style="color:rgb(0,0,255);">for signo<span style="color:rgb(0,0,204);">(32<span>) failed&nbsp;<span>(Invalid argument<span>)<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">sigaction&nbsp;<span style="color:rgb(0,0,255);">for signo<span style="color:rgb(0,0,204);">(33<span>) failed&nbsp;<span>(Invalid argument<span>)<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">I will&nbsp;<span style="color:rgb(255,0,0);">sleep 30 second<br></span> </li> 
     <li style="list-style:decimal;">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/Dropbox/Note/signal# signo<span>(2<span>)&nbsp;<span>:Interrupt<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(3<span>)&nbsp;<span>:Quit<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(4<span>)&nbsp;<span>:Illegal instruction<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(5<span>)&nbsp;<span>:Trace/breakpoint trap<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(7<span>)&nbsp;<span>:Bus error<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(8<span>)&nbsp;<span>:Floating point exception<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(10<span>)&nbsp;<span>:User defined signal 1<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(11<span>)&nbsp;<span>:Segmentation fault<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(12<span>)&nbsp;<span>:User defined signal 2<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(24<span>)&nbsp;<span>:CPU time limit exceeded<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(31<span>)&nbsp;<span>:Bad system&nbsp;<span style="color:rgb(0,0,255);">call<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(36<span>)&nbsp;<span>:Real<span>-time signal 2<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(37<span>)&nbsp;<span>:Real<span>-time signal 3<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(38<span>)&nbsp;<span>:Real<span>-time signal 4<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(39<span>)&nbsp;<span>:Real<span>-time signal 5<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">#0<span style="color:rgb(0,0,204);">: signo<span>=39<br></span></span> </li> 
     <li style="list-style:decimal;">#1<span style="color:rgb(0,0,204);">: signo<span>=38<br></span></span> </li> 
     <li style="list-style:decimal;">#2<span style="color:rgb(0,0,204);">: signo<span>=37<br></span></span> </li> 
     <li style="list-style:decimal;">#3<span style="color:rgb(0,0,204);">: signo<span>=36<br></span></span> </li> 
     <li style="list-style:decimal;">#4<span style="color:rgb(0,0,204);">: signo<span>=24<br></span></span> </li> 
     <li style="list-style:decimal;">#5<span style="color:rgb(0,0,204);">: signo<span>=12<br></span></span> </li> 
     <li style="list-style:decimal;">#6<span style="color:rgb(0,0,204);">: signo<span>=10<br></span></span> </li> 
     <li style="list-style:decimal;">#7<span style="color:rgb(0,0,204);">: signo<span>=3<br></span></span> </li> 
     <li style="list-style:decimal;">#8<span style="color:rgb(0,0,204);">: signo<span>=2<br></span></span> </li> 
     <li style="list-style:decimal;">#9<span style="color:rgb(0,0,204);">: signo<span>=31<br></span></span> </li> 
     <li style="list-style:decimal;">#10<span style="color:rgb(0,0,204);">: signo<span>=11<br></span></span> </li> 
     <li style="list-style:decimal;">#11<span style="color:rgb(0,0,204);">: signo<span>=8<br></span></span> </li> 
     <li style="list-style:decimal;">#12<span style="color:rgb(0,0,204);">: signo<span>=7<br></span></span> </li> 
     <li style="list-style:decimal;">#13<span style="color:rgb(0,0,204);">: signo<span>=5<br></span></span> </li> 
     <li style="list-style:decimal;">#14<span style="color:rgb(0,0,204);">: signo<span>=4</span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><strong><span style="font-size:18px;"><span style="color:rgb(100,69,29);">&nbsp; &nbsp; 顺序恰恰相反！！！！<span><br><span style="font-size:14px;"><span>&nbsp; &nbsp;</span></span></span></span></span></strong><span>&nbsp;我最初完全解释不通，我google了类似的topic，我发现，我不是第一个发现这个问题的人，绚丽也尘埃在一篇博客中提到：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="line-height:2;">在网上找到这样一段话：<br></span></span></li> 
     <li style="list-style:decimal;"><span style="line-height:2;"><strong>信号的优先级：信号实质上是软中断，中断有优先级，信号也有优先级。如果一个进程有多个未决信号，则对于同一个未决的实时信号，内核将按照发送的顺序来递送信号。如果存 在多个未决的实时信号，则值（或者说编号）越小的越先被递送。如果既存在不可靠信号，又存在可靠信号（实时信号），虽然POSIX对这一情况没有明确规 定，但Linux系统和大多数遵循POSIX标准的操作系统一样，将优先递送不可靠信号。</strong><br></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="line-height:2;">经过我反反复复地试验，我发现实验结果和上面描述的刚好相反，信号的编号越大越先被递送，一个进程如果处理SIGQUIT<span style="color:rgb(0,0,204);line-height:2;">(<span style="line-height:2;">3<span style="line-height:2;">)<span style="line-height:2;">,<span style="line-height:2;">SIGINT<span style="line-height:2;">(<span style="line-height:2;">2<span style="line-height:2;">)<span style="line-height:2;">,<span style="line-height:2;">SIGHUP<span style="line-height:2;">(<span style="line-height:2;">1<span style="line-height:2;">)<span style="line-height:2;">（通过”kill&nbsp;<span style="line-height:2;">-<span style="line-height:2;">l”可以查看信号的编号），那么先后给该进程发送SIGINT<span style="line-height:2;">,<span style="line-height:2;">SIGHUP<span style="line-height:2;">,<span style="line-height:2;">SIGQUIT，处理的顺序会是SIGQUIT<span style="line-height:2;">,<span style="line-height:2;">SIGINT<span style="line-height:2;">,<span style="line-height:2;">SIGHUP，不论改变这个三个信号的发送顺序，处理的顺序都是一样的。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><span><span style="line-height:2;">&nbsp; &nbsp; 看到了，这位前辈遇到了和我一样的困惑，测试的结果和kernel完全相反。内核不会错，glibc也肯定不会瞎掺合，一定是我的测试程序存在问题：<br><span style="line-height:2;">&nbsp; &nbsp; 今天我坐公交车上，突然意识到问题的所在，我的信号处理函数没有屏蔽信号！！！<br><span style="line-height:2;">&nbsp; &nbsp; 换句话说，4号信号是先被deliver的，但是还没能handler执行，被5号信号中断掉了，5号信号还没开始执行，被7号信号中断掉了，依次类推，所以我们测试的结果和deliver的结果正好相反。<br><span style="line-height:2;">&nbsp; &nbsp; 意识到这一点，我就改进了我的程序，信号执行期间，屏蔽所有信号，这样，就能测试信号deliver的顺序了。对于我的程序而言就是加上-DUSE_SIGACTION选项，让sigaction安装信号时，指明信号处理函数执行期间，屏蔽所有信号。<br><span style="line-height:2;">&nbsp; &nbsp; &nbsp;在我的64位Ubuntu上执行，结果和kernel代码以及手册上的一样。也就是说，并不是手册描述错了，而是我们的老的测试程序，在signal处理期间，没有屏蔽其他信号导致混乱。那么按照正确的方法测试：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code<span>/c<span>/self<span>/signal_deliver#&nbsp;<span>.<span>/test_order<span>.sh 0&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">.<span>/sigaction_delivery_order<span>:PID&nbsp;<span style="color:rgb(0,0,255);">is 3652<br></span></span></span></span></li> 
     <li style="list-style:decimal;">sigaction&nbsp;<span style="color:rgb(0,0,255);">for signo<span style="color:rgb(0,0,204);">(32<span>) failed&nbsp;<span>(Invalid argument<span>)<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">sigaction&nbsp;<span style="color:rgb(0,0,255);">for signo<span style="color:rgb(0,0,204);">(33<span>) failed&nbsp;<span>(Invalid argument<span>)<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">I will sleep 30&nbsp;<span style="color:rgb(255,0,0);">second<br></span> </li> 
     <li style="list-style:decimal;">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code<span>/c<span>/self<span>/signal_deliver# signo<span>(2<span>)&nbsp;<span>:Interrupt<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(3<span>)&nbsp;<span>:Quit<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(4<span>)&nbsp;<span>:Illegal instruction<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(5<span>)&nbsp;<span>:Trace<span>/breakpoint trap<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(7<span>)&nbsp;<span>:Bus&nbsp;<span style="color:rgb(0,0,255);">error<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(8<span>)&nbsp;<span>:Floating point exception<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(10<span>)&nbsp;<span>:User defined signal 1<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(11<span>)&nbsp;<span>:Segmentation fault<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(12<span>)&nbsp;<span>:User defined signal 2<br></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(24<span>)&nbsp;<span>:CPU&nbsp;<span style="color:rgb(255,0,0);">time limit exceeded<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(31<span>)&nbsp;<span>:Bad system&nbsp;<span style="color:rgb(0,0,255);">call<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(36<span>)&nbsp;<span>:Real<span>-<span style="color:rgb(255,0,0);">time signal 2<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(37<span>)&nbsp;<span>:Real<span>-<span style="color:rgb(255,0,0);">time signal 3<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(38<span>)&nbsp;<span>:Real<span>-<span style="color:rgb(255,0,0);">time signal 4<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">signo<span style="color:rgb(0,0,204);">(39<span>)&nbsp;<span>:Real<span>-<span style="color:rgb(255,0,0);">time signal 5<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">#0<span style="color:rgb(0,0,204);">: signo<span>=4<br></span></span> </li> 
     <li style="list-style:decimal;">#1<span style="color:rgb(0,0,204);">: signo<span>=5<br></span></span> </li> 
     <li style="list-style:decimal;">#2<span style="color:rgb(0,0,204);">: signo<span>=7<br></span></span> </li> 
     <li style="list-style:decimal;">#3<span style="color:rgb(0,0,204);">: signo<span>=8<br></span></span> </li> 
     <li style="list-style:decimal;">#4<span style="color:rgb(0,0,204);">: signo<span>=11<br></span></span> </li> 
     <li style="list-style:decimal;">#5<span style="color:rgb(0,0,204);">: signo<span>=31<br></span></span> </li> 
     <li style="list-style:decimal;">#6<span style="color:rgb(0,0,204);">: signo<span>=2<br></span></span> </li> 
     <li style="list-style:decimal;">#7<span style="color:rgb(0,0,204);">: signo<span>=3<br></span></span> </li> 
     <li style="list-style:decimal;">#8<span style="color:rgb(0,0,204);">: signo<span>=10<br></span></span> </li> 
     <li style="list-style:decimal;">#9<span style="color:rgb(0,0,204);">: signo<span>=12<br></span></span> </li> 
     <li style="list-style:decimal;">#10<span style="color:rgb(0,0,204);">: signo<span>=24<br></span></span> </li> 
     <li style="list-style:decimal;">#11<span style="color:rgb(0,0,204);">: signo<span>=36<br></span></span> </li> 
     <li style="list-style:decimal;">#12<span style="color:rgb(0,0,204);">: signo<span>=37<br></span></span> </li> 
     <li style="list-style:decimal;">#13<span style="color:rgb(0,0,204);">: signo<span>=38<br></span></span> </li> 
     <li style="list-style:decimal;">#14<span style="color:rgb(0,0,204);">: signo<span>=39</span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp;&nbsp; &nbsp; 和我们预想的完全符合，和内核代码已经手册完全一样。那么这个问题完美解决。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">{4<span style="color:rgb(0,0,204);">,5<span>,7<span>,8<span>,11<span>,31<span>, 2<span>,3，10<span>,12<span>,24<span>, 36<span>,37<span>,38}</span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp;&nbsp; &nbsp; 多个挂起信号时，delivery的策略如下：&nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp;&nbsp;1 &nbsp;<span style="font-size:14.4px;line-height:2;">{SIGILL(<span style="font-size:14.4px;line-height:2;">4),SIGTRAP(<span style="font-size:14.4px;line-height:2;">5),SIGBUS(7),SIGFPE(8),SIGSEGV(11),SIGSYS(31)<span style="font-size:14.4px;line-height:2;">}第一等级<br> &nbsp; &nbsp; 2 &nbsp;非实时信号中其他信号是第二等级（SIGKILL SIGSTOP除外）<br> &nbsp; &nbsp; 3 &nbsp;实时信号是第三等级。<br> &nbsp; &nbsp; 存在第一等级的信号挂起，那么优先选择第一等级，<br> &nbsp; &nbsp; &nbsp;没有第一等级，那么如果存在第二等级的信号，优先选择第二等级内信号。&nbsp;<br> &nbsp; &nbsp; 既没有第一等级，又没有第二等级，那么选择第三等级的信号。<br> &nbsp; &nbsp; 如果同一个等级内都存在多个挂起信号，则小信号优先。<br><br> &nbsp; &nbsp; 这只是我们用程序测试的结果，其实systemtap提供了signal_deliver这个event让我们monitor，我们可以直观的看到信号传递的顺序:&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">root@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal_deliver# cat signal_deliver<span>.stp&nbsp;<br></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">probe kernel<span style="color:rgb(0,0,204);">.trace<span>(<span style="color:rgb(255,0,255);">"signal_deliver"<span style="color:rgb(0,0,204);">)<span>{<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(pid<span>(<span>)&nbsp;<span>=<span>= target<span>(<span>)<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;{<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp; printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"signo(%2d) is delivered to PID %8d\n"<span style="color:rgb(0,0,204);">,<span>$sig<span>,pid<span>(<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;}<br></li> 
     <li style="list-style:decimal;">}</li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;">&nbsp;&nbsp; &nbsp; 我们可以用test_order.sh 1 ,故意用signal那个给我带来困扰的程序测试，我们会看到，传递的顺序依然是对的，这证明了我前面的推测，4是最先deliver的，只不过是因为没有屏蔽其他信号，被5号信号中断了，5又被7号信号中断了，依次类推，导致了我们看到了相反的执行顺序，给我们带来了困扰。&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;">root@manu-hacks:~/code/c/self/signal_deliver# ./test_order.sh 1<br> ./signal_delivery_order:PID is 4051<br> sigaction for signo(32) failed (Invalid argument)<br> sigaction for signo(33) failed (Invalid argument)<br> I will sleep 30 second<br> root@manu-hacks:~/code/c/self/signal_deliver# stap -x 4051 signal_deliver.stp&nbsp;<br> signo(2) :Interrupt<br> signo(3) :Quit<br> signo(4) :Illegal instruction<br> signo(5) :Trace/breakpoint trap<br> signo(7) :Bus error<br> signo(8) :Floating point exception<br> signo(10) :User defined signal 1<br> signo(11) :Segmentation fault<br> signo(12) :User defined signal 2<br> signo(24) :CPU time limit exceeded<br> signo(31) :Bad system call<br> signo(36) :Real-time signal 2<br> signo(37) :Real-time signal 3<br> signo(38) :Real-time signal 4<br> signo(39) :Real-time signal 5<br> #0: signo=39<br> #1: signo=38<br> #2: signo=37<br> #3: signo=36<br> #4: signo=24<br> #5: signo=12<br> #6: signo=10<br> #7: signo=3<br> #8: signo=2<br> #9: signo=31<br> #10: signo=11<br> #11: signo=8<br> #12: signo=7<br> #13: signo=5<br> #14: signo=4<br> signo( 4) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo( 5) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo( 7) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo( 8) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(11) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(31) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo( 2) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo( 3) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(10) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(12) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(24) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(36) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(37) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(38) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br> signo(39) &nbsp;is delivered to PID &nbsp; &nbsp; 4051<br><br><br> ^Croot@manu-hacks:~/code/c/self/signal_deliver#&nbsp;<br>
      <div>
       <br>
      </div> <br></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="line-height:2;"><span style="font-size:14px;"><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;"><span style="font-size:14.4px;line-height:2;">&nbsp;&nbsp; &nbsp; 话说systemtap提供了很多signal相关的example脚本，非常好用，如下图，收集signal的发送情况：<br> &nbsp; &nbsp;&nbsp;<img src="http://blog.chinaunix.net/attachment/201401/18/24774106_1390025454c5Zr.png" alt="" width="700" height="378" style="border:none;"><br><br> 参考文献<br> 1&nbsp;<span style="color:rgb(85,85,85);font-family:'Microsoft YaHei', Verdana, 'BitStream vera Sans';font-size:16px;letter-spacing:-.05em;line-height:normal;"><a href="http://www.fuzhijie.me/?p=85" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">Linux实时信号排队<br></a>2 &nbsp;LKML：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"></p> 
   <p> </p> 
   <table style="border-collapse:collapse;border-spacing:0px;border:1px solid #C0C0C0;font-size:14px;font-family:'Times New Roman';">
    <tbody>
     <tr>
      <td class="lp" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:courier, monospace;font-weight:bold;">&nbsp; &nbsp; Subject</td> 
      <td class="rp" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:courier, monospace;"> <p>[PATCH -tip v4 2/3] tracepoint: Add signal deliver even</p> </td> 
     </tr>
    </tbody>
   </table>
   <font><span style="font-size:14px;"><br></span></font> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p><font><span style="font-size:14px;"><br></span></font></p> 
   <p></p> 
   <p><font><span style="font-size:14px;">本文转自张昺华-sky博客园博客，原文链接：http://www.cnblogs.com/sky-heaven/p/6844611.html</span></font><span style="font-size:14px;font-family:'Times New Roman';">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
