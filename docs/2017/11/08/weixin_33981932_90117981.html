<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HTML5本地存储——IndexedDB（一：基本使用） « NotBeCN</title>
  <meta name="description" content="             在HTML5本地存储——Web SQL Database提到过Web SQL Database实际上已经被废弃，而HTML5的支持的本地存储实际上变成了    Web Storage（Local Storage和Session Storage）与IndexedDB。Web Storage...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/weixin_33981932_90117981.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">HTML5本地存储——IndexedDB（一：基本使用）</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">在<a href="http://www.cnblogs.com/dolphinX/p/3405335.html" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);">HTML5本地存储——Web SQL Database</a>提到过Web SQL Database实际上已经被废弃，而HTML5的支持的本地存储实际上变成了</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://www.cnblogs.com/dolphinX/p/3348469.html" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);">Web Storage</a>（Local Storage和Session Storage）与IndexedDB。Web Storage使用简单字符串键值对在本地存储数据，方便灵活，但是对于大量结构化数据存储力不从心，IndexedDB是为了能够在客户端存储大量的结构化数据，并且使用索引高效检索的API。</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">异步API</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">在IndexedDB大部分操作并不是我们常用的调用方法，返回结果的模式，而是请求——响应的模式，比如打开数据库的操作</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=window.indexedDB.open('testDB');</pre>
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">这条指令并不会返回一个DB对象的句柄，我们得到的是一个IDBOpenDBRequest对象，而我们希望得到的DB对象在其result属性中，</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://images0.cnblogs.com/blog/349217/201311/10131539-526fb7bed23e468b8a88beffd99f2020.png" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);"><img title="image" src="https://images0.cnblogs.com/blog/349217/201311/10131539-077ebb85a9c24aa7adb799a9ae3bdd40.png" alt="image" width="251" height="165" style="border:0px;"></a></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">这条指令请求的响应是一个 IDBDatabase对象，这就是IndexedDB对象，</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://images0.cnblogs.com/blog/349217/201311/10131541-5309e86fb7eb45d687ca94a0eed326b3.png" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);"><img title="image" src="https://images0.cnblogs.com/blog/349217/201311/10131542-5a74401a0e304d57b7079b798823fba1.png" alt="image" width="381" height="158" style="border:0px;"></a></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">除了result，IDBOpenDBRequest接口定义了几个重要属性</p> 
   <ul style="list-style:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style:disc inside;">onerror: 请求失败的回调函数句柄</li> 
    <li style="list-style:disc inside;">onsuccess:请求成功的回调函数句柄</li> 
    <li style="list-style:disc inside;">onupgradeneeded:请求数据库版本变化句柄</li> 
   </ul>
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">所谓异步API是指并不是这条指令执行完毕，我们就可以使用request.result来获取indexedDB对象了，就像使用ajax一样，语句执行完并不代表已经获取到了对象，所以我们一般在其回调函数中处理。</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">创建数据库</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">刚才的语句已经展示了如何打开一个indexedDB数据库，调用indexedDB.open方法就可以创建或者打开一个indexedDB。看一个完整的处理</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> openDB (name) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">window.indexedDB.open(name);
            request.onerror</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                console.log(</span>'OPen Error!'<span style="line-height:1.5;">);
            };
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                myDB.db</span>=<span style="line-height:1.5;">e.target.result;
            };
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> myDB=<span style="line-height:1.5;">{
            name:</span>'test'<span style="line-height:1.5;">,
            version:</span>1<span style="line-height:1.5;">,
            db:</span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">
        };
        openDB(myDB.name);</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">代码中定义了一个myDB对象，在创建indexedDB request的成功毁掉函数中，把request获取的DB对象赋值给了myDB的db属性，这样就可以使用myDB.db来访问创建的indexedDB了。</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">version</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">我们注意到除了onerror和onsuccess，IDBOpenDBRequest还有一个类似回调函数句柄——onupgradeneeded。这个句柄在我们请求打开的数据库的版本号和已经存在的数据库版本号不一致的时候调用。</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">indexedDB.open()方法还有第二个可选参数，数据库版本号，数据库创建的时候默认版本号为1，当我们传入的版本号和数据库当前版本号不一致的时候onupgradeneeded就会被调用，当然我们不能试图打开比当前数据库版本低的version，否则调用的就是onerror了，修改一下刚才例子</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> openDB (name,version) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> version=version || 1<span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">window.indexedDB.open(name,version);
            request.onerror</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                console.log(e.currentTarget.error.message);
            };
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                myDB.db</span>=<span style="line-height:1.5;">e.target.result;
            };
            request.onupgradeneeded</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                console.log(</span>'DB version changed to '+<span style="line-height:1.5;">version);
            };
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> myDB=<span style="line-height:1.5;">{
            name:</span>'test'<span style="line-height:1.5;">,
            version:</span>3<span style="line-height:1.5;">,
            db:</span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">
        };
        openDB(myDB.name,myDB.version);</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">由于刚才已经创建了版本为1的数据库，打开版本为3的时候，会在控制台输出：DB version changed to 3</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">关闭与删除数据库</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">关闭数据库可以直接调用数据库对象的close方法</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> closeDB(db){
            db.close();
        }</span></pre>
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">删除数据库使用indexedDB对象的deleteDatabase方法</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> deleteDB(name){
            indexedDB.deleteDatabase(name);
        }</span></pre>
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">简单调用</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> myDB=<span style="line-height:1.5;">{
            name:</span>'test'<span style="line-height:1.5;">,
            version:</span>3<span style="line-height:1.5;">,
            db:</span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">
        };
        openDB(myDB.name,myDB.version);
        setTimeout(</span><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(){
            closeDB(myDB.db);
            deleteDB(myDB.name);
        },</span>500);</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">由于异步API愿意，不能保证能够在closeDB方法调用前获取db对象（实际上获取db对象也比执行一条语句慢得多），所以用了setTimeout延迟了一下。当然我们注意到每个indexedDB实例都有onclose回调函数句柄，用以数据库关闭的时候处理，有兴趣同学可以试试，原理很简单，不演示了。</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">object store</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">有了数据库后我们自然希望创建一个表用来存储数据，但indexedDB中没有表的概念，而是objectStore，一个数据库中可以包含多个objectStore，objectStore是一个灵活的数据结构，可以存放多种类型数据。也就是说一个objectStore相当于一张表，里面存储的每条数据和一个键相关联。</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">我们可以使用每条记录中的某个指定字段作为键值（keyPath），也可以使用自动生成的递增数字作为键值（keyGenerator），也可以不指定。选择键的类型不同，objectStore可以存储的数据结构也有差异</p> 
   <table border="1" style="border-collapse:collapse;border-spacing:0px;border:1px solid #C0C0C0;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">
    <tbody>
     <tr>
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">键类型</td> 
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">存储数据</td> 
     </tr>
     <tr>
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">不使用</td> 
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">任意值，但是没添加一条数据的时候需要指定键参数</td> 
     </tr>
     <tr>
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">keyPath</td> 
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">Javascript对象，对象必须有一属性作为键值</td> 
     </tr>
     <tr>
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">keyGenerator</td> 
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">任意值</td> 
     </tr>
     <tr>
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">都使用</td> 
      <td valign="top" style="list-style-type:none;list-style-image:none;border:1px solid #C0C0C0;border-collapse:collapse;">Javascript对象，如果对象中有keyPath指定的属性则不生成新的键值，如果没有自动生成递增键值，填充keyPath指定属性</td> 
     </tr>
    </tbody>
   </table>
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">事务</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">在对新数据库做任何事情之前，需要开始一个事务。事务中需要指定该事务跨越哪些object store。</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">事务具有三种模式</p> 
   <ol style="list-style:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;list-style-image:none;">只读：read，不能修改数据库数据，可以并发执行</li> 
    <li style="list-style-type:decimal;list-style-image:none;">读写：readwrite，可以进行读写操作</li> 
    <li style="list-style-type:decimal;list-style-image:none;">版本变更：verionchange</li> 
   </ol>
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction([students','taecher'<span style="line-height:1.5;">]);  //打开一个事务，使用students 和teacher object store
var objectStore=transaction.objectStore(</span>'students'); //获取students object store</pre>
   </div> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">给object store添加数据</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">调用数据库实例的createObjectStore方法可以创建object store，方法有两个参数：store name和键类型。调用store的add方法添加数据。有了上面知识，我们可以向object store内添加数据了</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><strong>keyPath</strong></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">因为对新数据的操作都需要在transaction中进行，而transaction又要求指定object store，所以我们只能在创建数据库的时候初始化object store以供后面使用，这正是onupgradeneeded的一个重要作用，修改一下之前代码</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> openDB (name,version) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> version=version || 1<span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">window.indexedDB.open(name,version);
            request.onerror</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                console.log(e.currentTarget.error.message);
            };
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                myDB.db</span>=<span style="line-height:1.5;">e.target.result;
            };
            request.onupgradeneeded</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> db=<span style="line-height:1.5;">e.target.result;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span>(!db.objectStoreNames.contains('students'<span style="line-height:1.5;">)){
                    db.createObjectStore(</span>'students',{keyPath:"id"<span style="line-height:1.5;">});
                }
                console.log(</span>'DB version changed to '+<span style="line-height:1.5;">version);
            };
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">这样在创建数据库的时候我们就为其添加了一个名为students的object store，准备一些数据以供添加</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> students=<span style="line-height:1.5;">[{ 
            id:</span>1001<span style="line-height:1.5;">, 
            name:</span>"Byron"<span style="line-height:1.5;">, 
            age:</span>24<span style="line-height:1.5;"> 
        },{ 
            id:</span>1002<span style="line-height:1.5;">, 
            name:</span>"Frank"<span style="line-height:1.5;">, 
            age:</span>30<span style="line-height:1.5;"> 
        },{ 
            id:</span>1003<span style="line-height:1.5;">, 
            name:</span>"Aaron"<span style="line-height:1.5;">, 
            age:</span>26<span style="line-height:1.5;"> 
        }];</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> addData(db,storeName){
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction(storeName,'readwrite'<span style="line-height:1.5;">); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> store=<span style="line-height:1.5;">transaction.objectStore(storeName); 

            </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span>(<span style="color:rgb(0,0,255);line-height:1.5;">var</span> i=0;i&lt;students.length;i++<span style="line-height:1.5;">){
                store.add(students[i]);
            }
        }


openDB(myDB.name,myDB.version);
        setTimeout(</span><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(){
            addData(myDB.db,</span>'students'<span style="line-height:1.5;">);
        },</span>1000);</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">这样我们就在students object store里添加了三条记录，以id为键，在chrome控制台看看效果</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://images0.cnblogs.com/blog/349217/201311/10131542-89767b068ae946aea7f5aafb0955106b.png" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);"><img title="image" src="https://images0.cnblogs.com/blog/349217/201311/10131543-e023f428b82e421ab19332d050494537.png" alt="image" width="839" height="254" style="border:0px;"></a></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><strong>keyGenerate</strong></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> openDB (name,version) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> version=version || 1<span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">window.indexedDB.open(name,version);
            request.onerror</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                console.log(e.currentTarget.error.message);
            };
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                myDB.db</span>=<span style="line-height:1.5;">e.target.result;
            };
            request.onupgradeneeded</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){
                </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> db=<span style="line-height:1.5;">e.target.result;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span>(!db.objectStoreNames.contains('students'<span style="line-height:1.5;">)){
                    db.createObjectStore(</span>'students',{autoIncrement: <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">});
                }
                console.log(</span>'DB version changed to '+<span style="line-height:1.5;">version);
            };
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://images0.cnblogs.com/blog/349217/201311/10131543-9f65220f975041bb91083a7207c3877a.png" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);"><img title="image" src="https://images0.cnblogs.com/blog/349217/201311/10131544-6d7b21f0d6934d25a199f3946cf1d8d2.png" alt="image" width="780" height="253" style="border:0px;"></a></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">剩下的两种方式有兴趣同学可以自己摸索一下了</p> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">查找数据</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">可以调用object store的get方法通过键获取数据，以使用keyPath做键为例</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> getDataByKey(db,storeName,value){
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction(storeName,'readwrite'<span style="line-height:1.5;">); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> store=<span style="line-height:1.5;">transaction.objectStore(storeName); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">store.get(value); 
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){ 
                </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> student=<span style="line-height:1.5;">e.target.result; 
                console.log(student.name); 
            };
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">更新数据</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">可以调用object store的put方法更新数据，会自动替换键值相同的记录，达到更新目的，没有相同的则添加，以使用keyPath做键为例</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> updateDataByKey(db,storeName,value){
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction(storeName,'readwrite'<span style="line-height:1.5;">); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> store=<span style="line-height:1.5;">transaction.objectStore(storeName); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> request=<span style="line-height:1.5;">store.get(value); 
            request.onsuccess</span>=<span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;">(e){ 
                </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> student=<span style="line-height:1.5;">e.target.result; 
                student.age</span>=35<span style="line-height:1.5;">;
                store.put(student); 
            };
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">删除数据及object store</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">调用object store的delete方法根据键值删除记录</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> deleteDataByKey(db,storeName,value){
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction(storeName,'readwrite'<span style="line-height:1.5;">); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> store=<span style="line-height:1.5;">transaction.objectStore(storeName); 
            store.</span><span style="color:rgb(0,0,255);line-height:1.5;">delete</span><span style="line-height:1.5;">(value); 
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">调用object store的clear方法可以清空object store</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">function</span><span style="line-height:1.5;"> clearObjectStore(db,storeName){
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> transaction=db.transaction(storeName,'readwrite'<span style="line-height:1.5;">); 
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> store=<span style="line-height:1.5;">transaction.objectStore(storeName); 
            store.clear();
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(51,153,255);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">调用数据库实例的deleteObjectStore方法可以删除一个object store，这个就得在onupgradeneeded里面调用了</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">if</span>(db.objectStoreNames.contains('students'<span style="line-height:1.5;">)){ 
                    db.deleteObjectStore(</span>'students'<span style="line-height:1.5;">); 
}</span></pre>
   </div> 
   <h3 style="list-style-type:none;list-style-image:none;font-size:16px;line-height:1.5;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">最后</h3> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;">这就是关于indexedDB的基本使用方式，很多同学看了会觉得很鸡肋，和我们正常自己定义个对象使用没什么区别，也就是能保存在本地罢了，这是因为我们还没有介绍indexedDB之所以称为indexed的杀器——索引，这个才是让indexedDB大显神通的东西，<a title="下篇" href="http://www.cnblogs.com/dolphinX/p/3416889.html" rel="nofollow" style="text-decoration:none;color:rgb(51,153,255);">下篇</a>我们就来看看这个杀器</p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="list-style-type:none;list-style-image:none;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="list-style-type:none;list-style-image:none;"><font color="#444444"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自魏琼东博客园博客，原文链接：http://www.cnblogs.com/dolphinX/p/3415761.html</span></font><span style="font-size:15px;color:rgb(68,68,68);font-family:Tahoma, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
