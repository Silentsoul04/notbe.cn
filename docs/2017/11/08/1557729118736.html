<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>【Curl (libcurl) 开发 之一】Cocos2dx之libcurl（curl_easy）的编程教程（帮助手册）！... « NotBeCN</title>
  <meta name="description" content="                        注意：如果你的服务器是Java的，那么要注意数据之间的大端小端的处理；否则无法正常获取正确的数据！          本篇介绍使用libcurl编程的一般原则和一些基本方法。本文主要是介绍&nbsp;c&nbsp;语言的调用接口，同时也可能很好的适用于其他类&nbs...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/08/1557729118736.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">【Curl (libcurl) 开发 之一】Cocos2dx之libcurl（curl_easy）的编程教程（帮助手册）！...</h1>
    <p class="post-meta">Nov 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div> 
    <blockquote style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"> 
     <p style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"><strong><span style="color:rgb(255,0,0);">注意：如果你的服务器是Java的，那么要注意数据之间的大端小端的处理；否则无法正常获取正确的数据！</span></strong></p> 
    </blockquote> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">本篇介绍使用libcurl编程的一般原则和一些基本方法。本文主要是介绍&nbsp;c&nbsp;语言的调用接口，同时也可能很好的适用于其他类&nbsp;c&nbsp;语言的接口。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%8F%AF%E7%A7%BB%E6%A4%8D%E4%BB%A3%E7%A0%81" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>跨<span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>平台的可移植代码</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl库背后的开发人员投入了相当大的努力确保libcurl可以在很多不同的系统和环境里工作。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="%E5%85%A8%E5%B1%80%E7%9A%84%E5%87%86%E5%A4%87" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><strong style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"><span style="color:rgb(255,0,0);">全局的准备</span></strong></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">程序必须初始化一些libcurl的全局函数。这意味着不管你准备使用libcurl多少次，你都应该，且只初始化一次。当你的程序开始的时候，使用</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">curl_global_init()</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">这个函数需要一个参数来告诉它如何来初始化。使用CURL_GLOBAL_ALL&nbsp;,它将用通常是比较好的默认参数来初始化所有已知的内部子模块。还有两个可选值：</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">CURL_GLOBAL_WIN32</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">这个参数只被用在windows&nbsp;操作系统上。它让libcurl初始化win32套接字的的东西。没有正确的初始化，你的程序将不能正确的使用套接字。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让libcurl这样做。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">CURL_GLOBAL_SSL</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">这个参数会使libcurl具有SSL的能力。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让libcurl这样做。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl有个默认的保护机制，检测如果curl_global_init没有在curl_easy_perform之前被调用，那么libcurl会猜测该使用的初始化模式来执行程序。请注意，依靠默认的保护机制来这么做一点都不好。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当程序不再使用libcurl，请调用curl_global_cleanup函数来对应初始化函数所做的工作，它会做逆向的工作来清理curl_global_init所初始化的资源。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">请避免重复的调用curl_global_init和&nbsp;curl_global_cleanup。他们每个仅被调用一次。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="libcurl%E6%89%80%E6%94%AF%E6%8C%81%E7%9A%84%E5%8A%9F%E8%83%BD" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>libcurl所支持的功能</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">确定libcurl所提供功能的最佳办法是在运行的时候而不是在编译的时候。通过调用curl_version_info函数，然后查看返回信息的结构体，你知道当前的libcurl版本所支持的功能了。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="%E4%BD%BF%E7%94%A8libcurl%E7%9A%84%E7%AE%80%E5%8D%95%E6%8E%A5%E5%8F%A3" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>使用libcurl的简单接口</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">首先介绍libcurl的简单接口(easy&nbsp;interface)，这些接口都有curl_easy的前缀。&nbsp;libcurl的最近版本还提供了复杂接口(multi&nbsp;interface)。更多关系该接口的信息将另作讨论，为了更好的理解复杂接口，你仍然需要先了解简单接口。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">为了使用简单接口，你先需要创建一个简单接口的句柄。每一个简单接口的数据通信都需要这个句柄。一般来说，你需要为每个准备传输数据的线程使用一个句柄。但你绝不能在多线程里共享相同的句柄。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">获取简单句柄</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">easyhandle&nbsp;=&nbsp;curl_easy_init();</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">这个函数返回一个简单接口句柄。接下来的操作力，可以在这个`easyhandle设置各种选项。在随后的一个或者多次数据传输中，句柄只是一个逻辑实体。&nbsp;通过&nbsp;curl_easy_setopt设置句柄的属性和选项，它们控制随后的数据传输。这些属性和选项的设置一个保存在句柄里直到它再次被设置为其他值。多次网络请求使用相同的句柄，它们的句柄选择和属性也是相同的。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">很多用于设置libcurl属性都是字符串，一个指向一段以0结尾数据。当你用字符串设置&nbsp;curl_easy_setopt(），libcurl会复制这个字符串的一个副本，所以你在设置后不用再保存那个字符串的内存。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">在句柄上最经常设置的属性是URL。你可以这样设置它</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">curl_easy_setopt(handle,&nbsp;CURLOPT_URL,&nbsp;"http://domain.com/");</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">假如你希望得到指定URL上的远程主机的数据资源到本地。如果你想自己处理得到的数据而不是直接显示在标准输出里，你可以写一个符合下面原型的函数</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">size_t&nbsp;write_data(void&nbsp;*buffer,&nbsp;size_t&nbsp;size,&nbsp;size_t&nbsp;nmemb,&nbsp;void&nbsp;*userp);</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">你可以用类似下面这样的代码来控制libcurl将得到的数据传递到你写的函数里</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_WRITEFUNCTION,&nbsp;write_data);</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">你还可以控制你的回调函数第四个参数得到的数据，用这样的函数原型</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_WRITEDATA,&nbsp;&amp;internal_struct);</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">使用这种原型，你可以很容易在你程序和被libcurl调用函数之间传递本地数据。使用&nbsp;CURLOPT_WRITEDATA,libcurl不会处理你所传递的数据。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">假如你没用使用CURLOPT_WRITEFUNCTION设置回调函数，libcurl会有默认的处理。它只是把接收到的数据输出到标准输出里。你可以使用传递一个FILE&nbsp;*的打开文件参数，设置默认处理函数CURLOPT_WRITEDATA&nbsp;,它把得到的数据存放在一个文件里。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">这里有一个与平台有关的缺陷。有时候libcurl不能操作一个呗程序所打开的文件。如果你用CURLOPT_WRITEDATA给默认的回调函数传递一个打开的文件，程序可能崩溃。(CURLOPT_WRITEDATA&nbsp;原来的名称为CURLOPT_FILE,它们是同样的工作机理)。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你以&nbsp;win32&nbsp;dll的方式使用libcurl，如果你设置了，CURLOPT_WRITEDATA&nbsp;，也必须用CURLOPT_WRITEFUNCTION&nbsp;，否则你会遇到程序崩溃。&nbsp;还有其他很多的选项可以设置，我们放在后面再详细讨论，接着往下看</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);">success&nbsp;=&nbsp;curl_easy_perform(easyhandle);</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_perform函数将会连接远程的站点，发送必要的命令和接受传输的数据。当它收到了数据，它就会调用我们先前设置的回调函数。这个函数可能一次得到一个字节或者几千个字节。libcurl会尽可能多的，尽可能快的传回数据。我们回调函数返回它所得到数据的大小。如果返回的数据大小与传递给它数据大小不一致，libcurl将会终止操作，并返回一个错误代码。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当数据传输完成，curl_easy_perform返回一个代码来告诉你是否成功。如果你仅返回一个代码还不够，你可以使用CURLOPT_ERRORBUFFER&nbsp;,让libcurl缓存许多可读的错误信息</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你还想传输其他数据，已有的句柄可以多次使用。记住，鼓励你使用现有的句柄来传输其他数据，libcurl会尝试已经先前已经建立好的连接。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">对于某些协议，下载文件可能涉及到很多复杂的协议用来记录信息，设置传输模式，更改当前的目录并最终传递数据。传递一个文件的URL，libcurl会为你掌管所有细节，把文件从一台机器移动到两一台机器。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%97%AE%E9%A2%98" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>多线程问题</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">最基本的原则是绝对不要同时在多个线程之间共享一个libcurl的句柄。确保任何时候一个句柄只是在一个线程里使用。你可以在多个线程之间传递句柄，但是你不能使用。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl是线程安全的，除了以下两种情况：信号量和SSL/TLS句柄。信号量用于超时失效名字解析(在域名解析的时候)。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你通过多线程方式来访问HTTPS&nbsp;或者&nbsp;FTPS&nbsp;网址，你可以使用底层的SSL库，多线程库。这些库可能有它们独有的要求，你要多加注意详细参考</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">OpenSSL<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> http://www.openssl.org/docs/crypto/threads.html#DESCRIPTION<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> GnuTLS<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> http://www.gnu.org/software/gnutls/manual/html_node/Multi_002dthreaded-applications.html</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">NSS&nbsp;它宣称是线程安全，没有任何特殊的要求。&nbsp;PolarSSL&nbsp;未知。yassl&nbsp;未知。axTLS&nbsp;未知。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当你使用多线程的时候，你应当为所有的句柄设置CURLOPT_NOSIGNAL&nbsp;选项。所有的时候都可以工作正常除了DNS查询超时的时候。&nbsp;同样，CURLOPT_DNS_USE_GLOBAL_CACHE&nbsp;也不是线程安全的。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="%E5%BD%93libcurl%E5%AE%9E%E9%99%85%E6%97%A0%E6%B3%95%E5%B7%A5%E4%BD%9C" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>当libcurl实际无法工作</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">总是有各种原因导致网络传输失败。你可能设置错误的libcurl选项，误解了libcurl某些选项的实际作用，或者远程服务器返回libcurl一个非标准的应答。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当发生错误的时候，这里有一个黄金法:设置CURLOPT_VERBOSE&nbsp;选项为1。这将导致libcurl显示出所有发送的实体协议的细节，或者还有一些内部的信息和一些收到协议的数据(尤其是&nbsp;FTP)。如果你使用HTTP&nbsp;,CURLOPT_HEADER设为1,请求头/响应头也会被输出,这些头信息将出现在消息的内容中。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果CURLOPT_VERBOSE&nbsp;还不够，你设置CURLOPT_DEBUGFUNCTION来调试你的数据。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E5%88%B0%E8%BF%9C%E7%A8%8B%E7%AB%99%E7%82%B9" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>上传数据到远程站点</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl尽量保持与协议无关性，就是上传文件到远程的FTP跟用PUT方式上传数据到HTTP服务器和非常类似的。&nbsp;我们写一个程序，很可能想libcurl按照我们的要求上传数据。我需要设置如下函数原型的读数据的回调函数</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">size_t&nbsp;function(char&nbsp;*bufptr,&nbsp;size_t&nbsp;size,&nbsp;size_t&nbsp;nitems,&nbsp;void&nbsp;*userp);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">bufptr&nbsp;参数指向一段准备上传数据的缓冲区，nitem是这段缓冲区的大小，userp是一个用户自定义指针，libcurl不对该指针作任何操作，它只是简单的传递该指针。可以使用该指针在应用程序与libcurl之间传递信息。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_READFUNCTION,&nbsp;read_function);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_READDATA,&nbsp;&amp;filedata);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> Tell&nbsp;libcurl&nbsp;that&nbsp;we&nbsp;want&nbsp;to&nbsp;upload:<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_UPLOAD,&nbsp;1L);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">有几个协议将不能正常工作当上传的时候没有告诉上传文件的大小。所以设置上传文件的大小请使用CURLOPT_INFILESIZE_LARGE</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;in&nbsp;this&nbsp;example,&nbsp;file_size&nbsp;must&nbsp;be&nbsp;an&nbsp;curl_off_t&nbsp;variable&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_INFILESIZE_LARGE,&nbsp;file_size);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当你调用curl_easy_perform()的时候，libcurl会执行所有的必要动作，当开始上传的时候，它会调用我的回调函数。程序会尽可能多，尽可能快的的上传数据。回调函数返回写入缓冲区的数据的大小。返回0的时候就表示上传结束了。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E5%AF%86%E7%A0%81" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>密码</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">许多协议要求用户名和密码才能下载或者上传你所选择的数据。libcurl提供了指定的几种方法。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">许多协议都支持用户名和密码包含在指定的URL里。libcurl会检测并相应的使用它们。可以按照这样的格式写</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">protocol://user:password@example.com/path/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你的用户名和密码需要一些奇特的字符，你应该使用URLd编码，像%XX，其中ＸＸ是两位十六进制的数字。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl同事也提供了一个设置各种类型密码的选项。设置CURLOPT_USERPWD&nbsp;选项如下</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_USERPWD,&nbsp;"myname:thesecret");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">在某些情况下可能会多次用到用户名和密码，可以使用代码来验证身份。libcurl提供一个CURLOPT_PROXYUSERPWD选项来实现这种功能,跟CURLOPT_USERPWD&nbsp;选项很类似</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_PROXYUSERPWD,&nbsp;"myname:thesecret");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="HTTP_%E8%AE%A4%E8%AF%81" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>HTTP&nbsp;认证</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">先前的章节我们显示了如何为需要验证的URL设置用户和密码。当我们使用HTTP协议的时候，客户端有许多不同的向服务器发送身份验证。最基本的HTTP认证为Basic认证，它发送base64编码的明文用户和密码，这不安全。&nbsp;如今，libcrul支持使用Basic,&nbsp;Digest,&nbsp;NTLM,&nbsp;Negotiate,&nbsp;GSS-Negotiate&nbsp;and&nbsp;SPNEGO等方式的认证，你可以设置CURLOPT_HTTPAUTH&nbsp;告诉libcurl使用那种认证。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_HTTPAUTH,&nbsp;CURLAUTH_DIGEST);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当你想代理服务器认证的时候，你可以使用</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">CURLOPT_PROXYAUTH:</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_PROXYAUTH,&nbsp;CURLAUTH_NTLM);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">你可以组合多种认证方式，libcurl会以合理的方式处理&nbsp;curl_easy_setopt(easyhandle,&nbsp;CURLOPT_HTTPAUTH,&nbsp;CURLAUTH_DIGEST|CURLAUTH_BASIC);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">为了方便起见，你还可以使用CURLAUTH_ANY，它允许libcurl使用任何想要的方法。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="HTTP_POSTing" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>HTTP&nbsp;POST</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">HTML最简单的也是最常见的POST是使用&lt;form&gt;这个标签来实现的。我们提供了一个指向数据段&nbsp;指针，然后告诉licurl把它发送到远程站点：</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">char&nbsp;*data="name=daniel&amp;project=curl";<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_POSTFIELDS,&nbsp;data);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_URL,&nbsp;"http://posthere.com/");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_perform(easyhandle);&nbsp;/*&nbsp;post&nbsp;away!&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">是不是很简单。当你设置了CURLOPT_POSTFIELDS选项，它会自动切换句柄来POST接下的请求。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你想发送二进制的数据，需要设置一下数据头，用来知名数据的类型和数据的大小。如下</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">struct&nbsp;curl_slist&nbsp;*headers=NULL;<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> headers&nbsp;=&nbsp;curl_slist_append(headers,&nbsp;"Content-Type:&nbsp;text/xml");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;post&nbsp;binary&nbsp;data&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_POSTFIELDS,&nbsp;binaryptr);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;set&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;postfields&nbsp;data&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_POSTFIELDSIZE,&nbsp;23L);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;pass&nbsp;our&nbsp;list&nbsp;of&nbsp;custom&nbsp;made&nbsp;headers&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_HTTPHEADER,&nbsp;headers);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_perform(easyhandle);&nbsp;/*&nbsp;post&nbsp;away!&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_slist_free_all(headers);&nbsp;/*&nbsp;free&nbsp;the&nbsp;header&nbsp;list&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">还有一种是multi-part&nbsp;表单提交,这被认为是一种更好的方法提交二进制的数据。libcrul同样也支持这种方法。下面是例子:</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">struct&nbsp;curl_httppost&nbsp;*post=NULL;<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> struct&nbsp;curl_httppost&nbsp;*last=NULL;<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_formadd(&amp;post,&nbsp;&amp;last,&nbsp;&nbsp;&nbsp;CURLFORM_COPYNAME,&nbsp;"name",&nbsp;&nbsp;&nbsp;CURLFORM_COPYCONTENTS,&nbsp;"daniel",&nbsp;CURLFORM_END);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_formadd(&amp;post,&nbsp;&amp;last,&nbsp;&nbsp;&nbsp;CURLFORM_COPYNAME,&nbsp;"project",&nbsp;&nbsp;&nbsp;CURLFORM_COPYCONTENTS,&nbsp;"curl",&nbsp;CURLFORM_END);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_formadd(&amp;post,&nbsp;&amp;last,&nbsp;&nbsp;&nbsp;CURLFORM_COPYNAME,&nbsp;"logotype-image",&nbsp;&nbsp;&nbsp;CURLFORM_FILECONTENT,&nbsp;"curl.png",<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> CURLFORM_END);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;Set&nbsp;the&nbsp;form&nbsp;info&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_easy_setopt(easyhandle,&nbsp;CURLOPT_HTTPPOST,&nbsp;post);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_perform(easyhandle);&nbsp;/*&nbsp;post&nbsp;away!&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*&nbsp;free&nbsp;the&nbsp;post&nbsp;data&nbsp;again&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_formfree(post);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl还允许你在每个定义的部分设置头。下面就是例子</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">struct&nbsp;curl_slist&nbsp;*headers=NULL;<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> headers&nbsp;=&nbsp;curl_slist_append(headers,&nbsp;"Content-Type:&nbsp;text/xml");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_formadd(&amp;post,&nbsp;&amp;last,&nbsp;&nbsp;&nbsp;CURLFORM_COPYNAME,&nbsp;"logotype-image",&nbsp;&nbsp;&nbsp;CURLFORM_FILECONTENT,&nbsp;"curl.xml",<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> CURLFORM_CONTENTHEADER,&nbsp;headers,&nbsp;&nbsp;&nbsp;CURLFORM_END);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_perform(easyhandle);&nbsp;/*&nbsp;post&nbsp;away!&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_formfree(post);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> /*&nbsp;free&nbsp;post&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> curl_slist_free_all(headers);<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> /*&nbsp;free&nbsp;custom&nbsp;header&nbsp;list&nbsp;*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">所有对简单接口句柄都是"粘的"，这些属性会一直保持不变除非你在调用&nbsp;curl_easy_perform之前改过。通过将CURLOPT_HTTPGET设为1可以使简单接口句柄回到最原始的状态：</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_HTTPGET,&nbsp;1L);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">只设置CURLOPT_POSTFIELDS&nbsp;的只为""或者NULL是不会停止libcurl做POST请求的，这只会做提交空数据的POST。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E6%98%BE%E7%A4%BA%E8%BF%9B%E5%BA%A6" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>显示进度</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">通过将CURLOPT_NOPROCESS设置为0开启进度支持。该选项默认值为1。对大多数应用程序，我们需要提供一个进度显示回调。libcurl会不定期的将当前传输的进度通过回调函数告诉你的程序。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">//回调函数原型<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> int&nbsp;progress_callback(void&nbsp;*clientp,&nbsp;&nbsp;&nbsp;double&nbsp;dltotal,<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> double&nbsp;dlnow,&nbsp;&nbsp;&nbsp;double&nbsp;ultotal,&nbsp;&nbsp;&nbsp;double&nbsp;ulnow);</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">/*通过CURLOPT_PROGRESSFUNCTION注册该回调函数。<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> 参数clientp是一个用户自定义指针，应用程序通过CURLOPT_PROCESSDATA<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> 属性将该自定义指定传递给libcurl。libcurl对该参数不作任何处理，<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> 只是简单将其传递给回调函数。*/</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><a name="libcurl%E5%92%8Cc++" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>libcurl和c++</span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">只有一件需要特别注意的是回调函数不能使类的非静态成员函数。如</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">class&nbsp;AClass<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> {<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> static&nbsp;size_t&nbsp;write_data(void&nbsp;*ptr,&nbsp;size_t&nbsp;size,&nbsp;size_t&nbsp;nmemb,<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> void&nbsp;*ourpointer)<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> {<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> /*&nbsp;do&nbsp;what&nbsp;you&nbsp;want&nbsp;with&nbsp;the&nbsp;data&nbsp;*/<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> }<br style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;"> }</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E4%BB%A3%E7%90%86" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>代理</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">略过，有兴趣请参考原文。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E5%A5%BD%E5%A4%84" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>持久化的好处</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当需要发送多次请求时，应该重复使用easy&nbsp;handle。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">每次执行完curl_easy_perform，licurl会继续保持与服务器的连接。接下来的请求可以使用这个连接而不必创建新的连接（如果目标主机是同一个的话）。这样可以减少网络开销。&nbsp;即使连接被释放了，libcurl也会缓存这些连接的会话信息，这样下次再连接到目标主机上时，就可以使用这些信息，从而减少重新连接所需的时间。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">FTP连接可能会被保存较长的时间。因为客户端要与FTP服务器进行频繁的命令交互。对于有访问人数上限的FTP服务器，保持一个长连接，可以使你不需要排除等待，就直接可以与FTP服务器通信。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">libcurl会缓存DNS的解析结果。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">在今后的libcurl版本中，还会添加一些特性来提高数据通信的效率。&nbsp;每个简单接口句柄都会保存最近使用的几个连接，以备重用。默认是5个。可以通过CURLOPT_MAXCONNECTS属性来设置保存连接的数量。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">如果你不想重用连接，将CURLOPT_FRESH_CONNECT属性设置为1。这样每次提交请求时，libcurl都会先关闭以前创建的连接，然后重新创建一个新的连接。也可以将CURLOPT_FORBID_REUSE设置为1，这样每次执行完请求，连接就会马上关闭。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="libcurl%E4%BD%BF%E7%94%A8HTTP%E6%B6%88%E6%81%AF%E5%A4%B4" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>libcurl使用HTTP消息头</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当使用libcurl发送http请求时，它会自动添加一些http头。我们可以通过CURLOPT_HTTPHEADER属性手动替换、添加或删除相应的HTTP消息头。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">例外：以POST的方式向HTTP服务器提交请求时，libcurl会设置该消息头为"100-continue"，它要求服务器在正式处理该请求之前，返回一个"OK"消息。如果POST的数据很小，libcurl可能不会设置该消息头。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong><a name="%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%93%8D%E4%BD%9C" class="mceItemAnchor" style="color:rgb(66,133,244);width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a>自定义的操作</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">当前越来越多的协议都构建在HTTP协议之上（如：soap），这主要归功于HTTP的可靠性，以及被广泛使用的代理支持（可以穿透大部分防火墙）。&nbsp;这些协议的使用方式与传统HTTP可能有很大的不同。对此，libcurl作了很好的支持。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;"><a name="cookies" class="mceItemAnchor" style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;color:rgb(66,133,244);font-size:16px;width:11px;background-image:url(&quot;http://www.himigame.com/wp-includes/js/tinymce/themes/advanced/skins/default/img/items.gif&quot;);"></a><span style="font-family:'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;font-size:16px;color:rgb(255,0,0);"><strong>cookies</strong></span></p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">cookie是一个键值对的集合，HTTP服务器发给客户端的cookie，客户端提交请求的时候，也会将cookie发送到服务器。服务器可以根据cookie来跟踪用户的会话信息。cookie有过期时间，超时后cookie就会失效。cookie有域名和路径限制，cookie只能发给指定域名和路径的HTTP服务器。</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">在libcurl中，可以通过CURLOPT_COOKIE属性来设置发往服务器的cookie：</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">curl_easy_setopt(easyhandle,&nbsp;CURLOPT_COOKIE,&nbsp;"name1=var1;&nbsp;name2=var2;");</p> 
    <p style="font-family:Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif;font-size:13px;color:rgb(51,51,51);line-height:19px;">在实在的应用场景中，你可能需要保存服务器发送给你的cookie，并在接下来的请求中，把这些cookie一并发往服务器。所以，可以把上次从服务器收到的所有响应头信息保存到文本文件中，当下次需要向服务器发送请求时，通过CURLOPT_COOKIEFILE属性告诉libcurl从该文件中读取cookie信息。&nbsp;设置CURLOPT_COOKIEFILE属性意味着激活libcurl的cookie&nbsp;parser。在cookie&nbsp;parser被激活之前，libcurl忽略所以之前接收到的cookie信息。cookie&nbsp;parser被激活之后，cookie信息将被保存内存中，在接下来的请求中，libcurl会自动将这些cookie信息添加到消息头里，你的应用程序不需要做任何事件。大多数情况下，这已经足够了。需要注意的是，通过CURLOPT_COOKIEFILE属性来激活cookie&nbsp;parser，给CURLOPT_COOKIEFILE属性设置的一个保存cookie信息的文本文件路径，可能并不需要在磁盘上物理存在。&nbsp;如果你需要使用NetScape或者FireFox浏览器的cookie文件，你只要用这些浏览器的cookie文件的路径来初始化CURLOPT_COOKIEFILE属性，libcurl会自动分析cookie文件，并在接下来的请求过程中使用这些cookie信息。&nbsp;libcurl甚至能够把接收到的cookie信息保存成能被Netscape/Mozilla的浏览器所识别的cookie文件。通过把这些称为cookie-jar。通过设置CURLOPT_COOKIEJAR选项，在调用curl_easy_cleanup释放easy&nbsp;handle的时候，所有的这些cookie信息都会保存到cookie-jar文件中。这就使得cookie信息能在不同的easy&nbsp;handle甚至在浏览器之间实现共享。</p> 
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    <br>
   </div> 
   <div>
    本文转自 xiaominghimi 51CTO博客，原文链接：http://blog.51cto.com/xiaominghimi/969800，如需转载请自行联系原作者
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
