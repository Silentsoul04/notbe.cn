<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HashMap源码分析 « NotBeCN</title>
  <meta name="description" content="             前言    以下内容基于jdk1.7.0_79源码；                     什么是HashMap    基于哈希表的一个Map接口实现，存储的对象是一个键值对对象(Entry&lt;K,V&gt;)；                     HashMap补充说明   ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/22/weixin_34228617_90134392.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">HashMap源码分析</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">前言</h1> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;">以下内容基于jdk1.7.0_79源码；</p> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label1"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">什么是HashMap</h1> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;">基于哈希表的一个Map接口实现，存储的对象是一个键值对对象(Entry&lt;K,V&gt;)；</p> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label2"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">HashMap补充说明</h1> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;">基于数组和链表实现，内部维护着一个数组table，该数组保存着每个链表的表头结点；查找时，先通过hash函数计算key的hash值，再根据key的hash值计算数组索引（取余法），然后根据索引找到链表表头结点，然后遍历查找该链表；</p> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label3"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">HashMap数据结构</h1> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;">画了个示意图，如下，左边的数组索引是根据key的hash值计算得到，不同hash值有可能产生一样的索引，即哈希冲突，此时采用链地址法处理哈希冲突，即将所有索引一致的节点构成一个单链表；</p> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/879896/201603/879896-20160315234750818-961430571.jpg" alt="" style="border:0px;"></p> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label4"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">HashMap继承的类与实现的接口</h1> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/879896/201603/879896-20160315235543303-128441096.jpg" alt="" style="border:0px;"></p> 
   <h2 style="font-size:16px;line-height:1.5;color:rgb(0,66,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">Map接口，方法的含义很简单，基本上看个方法名就知道了，后面会在HashMap源码分析里详细说明</h2> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/879896/201603/879896-20160315235943553-1983301051.jpg" alt="" style="border:0px;"></p> 
   <h2 style="font-size:16px;line-height:1.5;color:rgb(0,66,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">AbstractMap抽象类中定义的方法</h2> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;"><img src="https://images2015.cnblogs.com/blog/879896/201603/879896-20160316000108834-1639215975.jpg" alt="" style="border:0px;"></p> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label5"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">HashMap源码分析，大部分都加了注释</h1> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">package</span><span style="line-height:1.5;"> java.util;
</span><span style="color:rgb(0,0,255);line-height:1.5;">import</span> java.io.*<span style="line-height:1.5;">;

</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> HashMap&lt;K,V&gt;
    <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> AbstractMap&lt;K,V&gt;
    <span style="color:rgb(0,0,255);line-height:1.5;">implements</span> Map&lt;K,V&gt;<span style="line-height:1.5;">, Cloneable, Serializable
{

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 默认初始容量，默认为2的4次方 = 16，<span style="line-height:1.5;">2的</span>n次方是为了加快hash计算速度，；；减少hash冲突，，，h &amp; (length-1<span style="color:rgb(0,0,0);line-height:1.5;">)</span>，，1111111
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> aka 16</span>

    <span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 最大容量，默认为2的30次方，
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> MAXIMUM_CAPACITY = 1 &lt;&lt; 30<span style="line-height:1.5;">;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 默认负载因子，默认为0.75
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">float</span> DEFAULT_LOAD_FACTOR = 0.75f<span style="line-height:1.5;">;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     *当数组表还没扩容的时候，一个共享的空表对象
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> Entry&lt;?,?&gt;[] EMPTY_TABLE =<span style="line-height:1.5;"> {};

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 数组表，大小可以改变，且大小必须为2的幂
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">transient</span> Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;<span style="line-height:1.5;">[]) EMPTY_TABLE;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 当前Map中key-value映射的个数
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">transient</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> size;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 下次扩容阈值，当size &gt; capacity * load factor时，开始扩容
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> threshold;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 负载因子
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">float</span><span style="line-height:1.5;"> loadFactor;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * Hash表结构性修改次数，用于实现迭代器快速失败行为
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">transient</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> modCount;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 容量阈值，默认大小为Integer.MAX_VALUE
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> ALTERNATIVE_HASHING_THRESHOLD_DEFAULT =<span style="line-height:1.5;"> Integer.MAX_VALUE;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 静态内部类Holder，存放一些只能在虚拟机启动后才能初始化的值
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Holder {

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * 容量阈值，初始化hashSeed的时候会用到该值
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> ALTERNATIVE_HASHING_THRESHOLD;

        </span><span style="color:rgb(0,0,255);line-height:1.5;">static</span><span style="line-height:1.5;"> {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">获取系统变量jdk.map.althashing.threshold</span>
            String altThreshold =<span style="line-height:1.5;"> java.security.AccessController.doPrivileged(
                </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> sun.security.action.GetPropertyAction(
                    </span>"jdk.map.althashing.threshold"<span style="line-height:1.5;">));

            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> threshold;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
                threshold </span>= (<span style="color:rgb(0,0,255);line-height:1.5;">null</span> !=<span style="line-height:1.5;"> altThreshold)
                        </span>?<span style="line-height:1.5;"> Integer.parseInt(altThreshold)
                        : ALTERNATIVE_HASHING_THRESHOLD_DEFAULT;

                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> jdk.map.althashing.threshold系统变量默认为-1，如果为-1，则将阈值设为Integer.MAX_VALUE</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (threshold == -1<span style="line-height:1.5;">) {
                    threshold </span>=<span style="line-height:1.5;"> Integer.MAX_VALUE;
                }
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">阈值需要为正数</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (threshold &lt; 0<span style="line-height:1.5;">) {
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> IllegalArgumentException("value must be positive integer."<span style="line-height:1.5;">);
                }
            } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;">(IllegalArgumentException failed) {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> Error("Illegal value for 'jdk.map.althashing.threshold'"<span style="line-height:1.5;">, failed);
            }

            ALTERNATIVE_HASHING_THRESHOLD </span>=<span style="line-height:1.5;"> threshold;
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 计算hash值的时候需要用到
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">transient</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> hashSeed = 0<span style="line-height:1.5;">;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 生成一个空的HashMap,并指定其容量大小和负载因子
     *
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> HashMap(<span style="color:rgb(0,0,255);line-height:1.5;">int</span> initialCapacity, <span style="color:rgb(0,0,255);line-height:1.5;">float</span><span style="line-height:1.5;"> loadFactor) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">保证初始容量大于等于0</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (initialCapacity &lt; 0<span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> IllegalArgumentException("Illegal initial capacity: " +<span style="line-height:1.5;">
                                               initialCapacity);
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">保证初始容量不大于最大容量MAXIMUM_CAPACITY</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (initialCapacity &gt;<span style="line-height:1.5;"> MAXIMUM_CAPACITY)
            initialCapacity </span>=<span style="line-height:1.5;"> MAXIMUM_CAPACITY;
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">loadFactor小于0或为无效数字</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (loadFactor &lt;= 0 ||<span style="line-height:1.5;"> Float.isNaN(loadFactor))
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> IllegalArgumentException("Illegal load factor: " +<span style="line-height:1.5;">
                                               loadFactor);
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">负载因子</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">this</span>.loadFactor =<span style="line-height:1.5;"> loadFactor;
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">下次扩容大小</span>
        threshold =<span style="line-height:1.5;"> initialCapacity;
        init();
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 生成一个空的HashMap,并指定其容量大小，负载因子使用默认的0.75
     *
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> HashMap(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> initialCapacity) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">(initialCapacity, DEFAULT_LOAD_FACTOR);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 生成一个空的HashMap,容量大小使用默认值16，负载因子使用默认值0.75
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> HashMap() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 根据指定的map生成一个新的HashMap,负载因子使用默认值，初始容量大小为Math.max((int) (m.size() / DEFAULT_LOAD_FACTOR) + 1,DEFAULT_INITIAL_CAPACITY)
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> HashMap(Map&lt;? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> K, ? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> V&gt;<span style="line-height:1.5;"> m) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span>(Math.max((<span style="color:rgb(0,0,255);line-height:1.5;">int</span>) (m.size() / DEFAULT_LOAD_FACTOR) + 1<span style="line-height:1.5;">,
                      DEFAULT_INITIAL_CAPACITY), DEFAULT_LOAD_FACTOR);
        inflateTable(threshold);

        putAllForCreate(m);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">返回&gt;=number的最小2的n次方值，如number=5，则返回8</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> roundUpToPowerOf2(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> number) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> assert number &gt;= 0 : "number must be non-negative";</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">return</span> number &gt;=<span style="line-height:1.5;"> MAXIMUM_CAPACITY
                </span>?<span style="line-height:1.5;"> MAXIMUM_CAPACITY
                : (number </span>&gt; 1) ? Integer.highestOneBit((number - 1) &lt;&lt; 1) : 1<span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 对table扩容
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> inflateTable(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> toSize) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Find a power of 2 &gt;= toSize
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">找一个值（2的n次方，且&gt;=toSize）</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> capacity =<span style="line-height:1.5;"> roundUpToPowerOf2(toSize);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">下次扩容阈值</span>
        threshold = (<span style="color:rgb(0,0,255);line-height:1.5;">int</span>) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1<span style="line-height:1.5;">);
        
        table </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Entry[capacity];
        initHashSeedAsNeeded(capacity);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> internal utilities</span>

    <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> init() {
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 初始化hashSeed
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span> initHashSeedAsNeeded(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> capacity) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">boolean</span> currentAltHashing = hashSeed != 0<span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">boolean</span> useAltHashing = sun.misc.VM.isBooted() &amp;&amp;<span style="line-height:1.5;">
                (capacity </span>&gt;=<span style="line-height:1.5;"> Holder.ALTERNATIVE_HASHING_THRESHOLD);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">boolean</span> switching = currentAltHashing ^<span style="line-height:1.5;"> useAltHashing;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span><span style="line-height:1.5;"> (switching) {
            hashSeed </span>=<span style="line-height:1.5;"> useAltHashing
                </span>? sun.misc.Hashing.randomHashSeed(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">)
                : </span>0<span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> switching;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 生成hash值
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> hash(Object k) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> h =<span style="line-height:1.5;"> hashSeed;
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">如果key是字符串，调用un.misc.Hashing.stringHash32生成hash值
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">Oracle表示能生成更好的hash分布，不过这在jdk8中已删除</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (0 != h &amp;&amp; k <span style="color:rgb(0,0,255);line-height:1.5;">instanceof</span><span style="line-height:1.5;"> String) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> sun.misc.Hashing.stringHash32((String) k);
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">一次散列，调用k的hashCode方法，与hashSeed做异或操作</span>
        h ^=<span style="line-height:1.5;"> k.hashCode();

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> This function ensures that hashCodes that differ only by
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> constant multiples at each bit position have a bounded
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> number of collisions (approximately 8 at default load factor).
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">二次散列，</span>
        h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12<span style="line-height:1.5;">);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4<span style="line-height:1.5;">);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回hash值的索引，采用除模取余法，h &amp; (length-1<span style="color:rgb(0,0,0);line-height:1.5;">)</span>操作 等价于 hash % length操作， 但<span style="line-height:1.5;">&amp;</span>操作性能更优
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> indexFor(<span style="color:rgb(0,0,255);line-height:1.5;">int</span> h, <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> length) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> assert Integer.bitCount(length) == 1 : "length must be a non-zero power of 2";</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">return</span> h &amp; (length-1<span style="line-height:1.5;">);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回key-value映射个数
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> size() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> size;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 判断map是否为空
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> isEmpty() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> size == 0<span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回指定key对应的value
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> V get(Object key) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">key为null情况</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> getForNullKey();
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">根据key查找节点</span>
        Entry&lt;K,V&gt; entry =<span style="line-height:1.5;"> getEntry(key);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">返回key对应的值</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span> == entry ? <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;"> : entry.getValue();
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 查找key为null的value，注意如果key为null，则其hash值为0，默认是放在table[0]里的
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> V getForNullKey() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size == 0<span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">在table[0]的链表上查找key为null的键值对，因为null默认是存在table[0]的桶里</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[0]; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span>; e =<span style="line-height:1.5;"> e.next) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e.value;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     *判断是否包含指定的key
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> containsKey(Object key) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> getEntry(key) != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 根据key查找键值对，找不到返回null
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> Entry&lt;K,V&gt;<span style="line-height:1.5;"> getEntry(Object key) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size == 0<span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">如果key为null，hash值为0，否则调用hash方法，对key生成hash值</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash = (key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span>) ? 0<span style="line-height:1.5;"> : hash(key);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">调用indexFor方法生成hash值的索引，遍历该索引下的链表，查找key“相等”的键值对</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt; e =<span style="line-height:1.5;"> table[indexFor(hash, table.length)];
             e </span>!= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
             e </span>=<span style="line-height:1.5;"> e.next) {
            Object k;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.hash == hash &amp;&amp;<span style="line-height:1.5;">
                ((k </span>= e.key) == key || (key != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> key.equals(k))))
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 向map存入一个键值对，如果key已存在，则覆盖
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> V put(K key, V value) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">数组为空，对数组扩容</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (table ==<span style="line-height:1.5;"> EMPTY_TABLE) {
            inflateTable(threshold);
        }
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">对key为null的键值对调用putForNullKey处理</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> putForNullKey(value);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">生成hash值</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash =<span style="line-height:1.5;"> hash(key);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">生成hash值索引</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> i =<span style="line-height:1.5;"> indexFor(hash, table.length);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">查找是否有key“相等”的键值对，有的话覆盖</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span>; e =<span style="line-height:1.5;"> e.next) {
            Object k;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key ||<span style="line-height:1.5;"> key.equals(k))) {
                V oldValue </span>=<span style="line-height:1.5;"> e.value;
                e.value </span>=<span style="line-height:1.5;"> value;
                e.recordAccess(</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> oldValue;
            }
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">操作次数加一，用于迭代器快速失败行为</span>
        modCount++<span style="line-height:1.5;">;
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">在指定hash值索引处的链表上增加该键值对</span>
<span style="line-height:1.5;">        addEntry(hash, key, value, i);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 存放key为null的键值对，存放在索引为0的链表上，已存在的话，替换
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> V putForNullKey(V value) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[0]; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span>; e =<span style="line-height:1.5;"> e.next) {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">已存在key为null，则替换</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
                V oldValue </span>=<span style="line-height:1.5;"> e.value;
                e.value </span>=<span style="line-height:1.5;"> value;
                e.recordAccess(</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> oldValue;
            }
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">操作次数加一，用于迭代器快速失败行为</span>
        modCount++<span style="line-height:1.5;">;
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">在指定hash值索引处的链表上增加该键值对</span>
        addEntry(0, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, value, 0<span style="line-height:1.5;">);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 添加键值对
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> putForCreate(K key, V value) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">生成hash值</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash = <span style="color:rgb(0,0,255);line-height:1.5;">null</span> == key ? 0<span style="line-height:1.5;"> : hash(key);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">生成hash值索引，</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> i =<span style="line-height:1.5;"> indexFor(hash, table.length);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * key“相等”，则替换
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span>; e =<span style="line-height:1.5;"> e.next) {
            Object k;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.hash == hash &amp;&amp;<span style="line-height:1.5;">
                ((k </span>= e.key) == key || (key != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> key.equals(k)))) {
                e.value </span>=<span style="line-height:1.5;"> value;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;">;
            }
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">在指定索引处的链表上创建该键值对</span>
<span style="line-height:1.5;">        createEntry(hash, key, value, i);
    }
    
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">将制定map的键值对添加到map中</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> putAllForCreate(Map&lt;? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> K, ? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> V&gt;<span style="line-height:1.5;"> m) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Map.Entry&lt;? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> K, ? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> V&gt;<span style="line-height:1.5;"> e : m.entrySet())
            putForCreate(e.getKey(), e.getValue());
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 对数组扩容
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">void</span> resize(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> newCapacity) {
        Entry[] oldTable </span>=<span style="line-height:1.5;"> table;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> oldCapacity =<span style="line-height:1.5;"> oldTable.length;
        
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (oldCapacity ==<span style="line-height:1.5;"> MAXIMUM_CAPACITY) {
            threshold </span>=<span style="line-height:1.5;"> Integer.MAX_VALUE;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;">;
        }
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">创建一个指定大小的数组</span>
        Entry[] newTable = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Entry[newCapacity];
        
        transfer(newTable, initHashSeedAsNeeded(newCapacity));
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">table索引替换成新数组</span>
        table =<span style="line-height:1.5;"> newTable;
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">重新计算阈值</span>
        threshold = (<span style="color:rgb(0,0,255);line-height:1.5;">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1<span style="line-height:1.5;">);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 拷贝旧的键值对到新的哈希表中
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">void</span> transfer(Entry[] newTable, <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> rehash) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> newCapacity =<span style="line-height:1.5;"> newTable.length;
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">遍历旧的数组</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry&lt;K,V&gt;<span style="line-height:1.5;"> e : table) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">while</span>(<span style="color:rgb(0,0,255);line-height:1.5;">null</span> !=<span style="line-height:1.5;"> e) {
                Entry</span>&lt;K,V&gt; next =<span style="line-height:1.5;"> e.next;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span><span style="line-height:1.5;"> (rehash) {
                    e.hash </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span> == e.key ? 0<span style="line-height:1.5;"> : hash(e.key);
                }
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">根据新的数组长度，重新计算索引，</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">int</span> i =<span style="line-height:1.5;"> indexFor(e.hash, newCapacity);
                
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">插入到链表表头</span>
                e.next =<span style="line-height:1.5;"> newTable[i];
                
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">将e放到索引为i处</span>
                newTable[i] =<span style="line-height:1.5;"> e;
                
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">将e设置成下个节点</span>
                e =<span style="line-height:1.5;"> next;
            }
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 将制定map的键值对put到本map，key“相等”的直接覆盖
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> putAll(Map&lt;? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> K, ? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> V&gt;<span style="line-height:1.5;"> m) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> numKeysToBeAdded =<span style="line-height:1.5;"> m.size();
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (numKeysToBeAdded == 0<span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;">;

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">空map，扩容</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (table ==<span style="line-height:1.5;"> EMPTY_TABLE) {
            inflateTable((</span><span style="color:rgb(0,0,255);line-height:1.5;">int</span>) Math.max(numKeysToBeAdded *<span style="line-height:1.5;"> loadFactor, threshold));
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/*</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * 判断是否需要扩容
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (numKeysToBeAdded &gt;<span style="line-height:1.5;"> threshold) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> targetCapacity = (<span style="color:rgb(0,0,255);line-height:1.5;">int</span>)(numKeysToBeAdded / loadFactor + 1<span style="line-height:1.5;">);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (targetCapacity &gt;<span style="line-height:1.5;"> MAXIMUM_CAPACITY)
                targetCapacity </span>=<span style="line-height:1.5;"> MAXIMUM_CAPACITY;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> newCapacity =<span style="line-height:1.5;"> table.length;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">while</span> (newCapacity &lt;<span style="line-height:1.5;"> targetCapacity)
                newCapacity </span>&lt;&lt;= 1<span style="line-height:1.5;">;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (newCapacity &gt;<span style="line-height:1.5;"> table.length)
                resize(newCapacity);
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">依次遍历键值对，并put</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Map.Entry&lt;? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> K, ? <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> V&gt;<span style="line-height:1.5;"> e : m.entrySet())
            put(e.getKey(), e.getValue());
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 移除指定key的键值对
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> V remove(Object key) {
        Entry</span>&lt;K,V&gt; e =<span style="line-height:1.5;"> removeEntryForKey(key);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> (e == <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ? <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;"> : e.value);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 移除指定key的键值对
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> Entry&lt;K,V&gt;<span style="line-height:1.5;"> removeEntryForKey(Object key) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size == 0<span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">计算hash值及索引</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash = (key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span>) ? 0<span style="line-height:1.5;"> : hash(key);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> i =<span style="line-height:1.5;"> indexFor(hash, table.length);
        
        Entry</span>&lt;K,V&gt; prev =<span style="line-height:1.5;"> table[i];
        Entry</span>&lt;K,V&gt; e =<span style="line-height:1.5;"> prev;

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">头节点为table[i]的单链表上执行删除节点操作</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">while</span> (e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            Entry</span>&lt;K,V&gt; next =<span style="line-height:1.5;"> e.next;
            Object k;
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">找到要删除的节点</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.hash == hash &amp;&amp;<span style="line-height:1.5;">
                ((k </span>= e.key) == key || (key != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> key.equals(k)))) {
                modCount</span>++<span style="line-height:1.5;">;
                size</span>--<span style="line-height:1.5;">;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (prev ==<span style="line-height:1.5;"> e)
                    table[i] </span>=<span style="line-height:1.5;"> next;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">else</span><span style="line-height:1.5;">
                    prev.next </span>=<span style="line-height:1.5;"> next;
                e.recordRemoval(</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
            }
            prev </span>=<span style="line-height:1.5;"> e;
            e </span>=<span style="line-height:1.5;"> next;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 删除指定键值对对象(Entry对象)
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">final</span> Entry&lt;K,V&gt;<span style="line-height:1.5;"> removeMapping(Object o) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size == 0 || !(o <span style="color:rgb(0,0,255);line-height:1.5;">instanceof</span><span style="line-height:1.5;"> Map.Entry))
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;

        Map.Entry</span>&lt;K,V&gt; entry = (Map.Entry&lt;K,V&gt;<span style="line-height:1.5;">) o;
        Object key </span>=<span style="line-height:1.5;"> entry.getKey();
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash = (key == <span style="color:rgb(0,0,255);line-height:1.5;">null</span>) ? 0<span style="line-height:1.5;"> : hash(key);
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">得到数组索引</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> i =<span style="line-height:1.5;"> indexFor(hash, table.length);
        Entry</span>&lt;K,V&gt; prev =<span style="line-height:1.5;"> table[i];
        Entry</span>&lt;K,V&gt; e =<span style="line-height:1.5;"> prev;
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">开始遍历该单链表</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">while</span> (e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            Entry</span>&lt;K,V&gt; next =<span style="line-height:1.5;"> e.next;
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">找到节点</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.hash == hash &amp;&amp;<span style="line-height:1.5;"> e.equals(entry)) {
                modCount</span>++<span style="line-height:1.5;">;
                size</span>--<span style="line-height:1.5;">;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (prev ==<span style="line-height:1.5;"> e)
                    table[i] </span>=<span style="line-height:1.5;"> next;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">else</span><span style="line-height:1.5;">
                    prev.next </span>=<span style="line-height:1.5;"> next;
                e.recordRemoval(</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
            }
            prev </span>=<span style="line-height:1.5;"> e;
            e </span>=<span style="line-height:1.5;"> next;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 清空map，将table数组所有元素设为null
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> clear() {
        modCount</span>++<span style="line-height:1.5;">;
        Arrays.fill(table, </span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">);
        size </span>= 0<span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 判断是否含有指定value的键值对
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> containsValue(Object value) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (value == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> containsNullValue();

        Entry[] tab </span>=<span style="line-height:1.5;"> table;
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">遍历table数组</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (<span style="color:rgb(0,0,255);line-height:1.5;">int</span> i = 0; i &lt; tab.length ; i++<span style="line-height:1.5;">)
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">遍历每条单链表</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry e = tab[i] ; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ; e =<span style="line-height:1.5;"> e.next)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span><span style="line-height:1.5;"> (value.equals(e.value))
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 判断是否含有value为null的键值对
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> containsNullValue() {
        Entry[] tab </span>=<span style="line-height:1.5;"> table;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span> (<span style="color:rgb(0,0,255);line-height:1.5;">int</span> i = 0; i &lt; tab.length ; i++<span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span> (Entry e = tab[i] ; e != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ; e =<span style="line-height:1.5;"> e.next)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e.value == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 浅拷贝，键值对不复制
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Object clone() {
        HashMap</span>&lt;K,V&gt; result = <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            result </span>= (HashMap&lt;K,V&gt;)<span style="color:rgb(0,0,255);line-height:1.5;">super</span><span style="line-height:1.5;">.clone();
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (CloneNotSupportedException e) {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> assert false;</span>
<span style="line-height:1.5;">        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (result.table !=<span style="line-height:1.5;"> EMPTY_TABLE) {
            result.inflateTable(Math.min(
                (</span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;">) Math.min(
                    size </span>* Math.min(1 / loadFactor, 4.0f<span style="line-height:1.5;">),
                    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> we have limits...</span>
<span style="line-height:1.5;">                    HashMap.MAXIMUM_CAPACITY),
               table.length));
        }
        result.entrySet </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        result.modCount </span>= 0<span style="line-height:1.5;">;
        result.size </span>= 0<span style="line-height:1.5;">;
        result.init();
        result.putAllForCreate(</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> result;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">内部类，节点对象，每个节点包含下个节点的引用</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> Entry&lt;K,V&gt; <span style="color:rgb(0,0,255);line-height:1.5;">implements</span> Map.Entry&lt;K,V&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> K key;
        V value;
        Entry</span>&lt;K,V&gt;<span style="line-height:1.5;"> next;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> hash;

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * 创建节点
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span><span style="line-height:1.5;">
        Entry(</span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> h, K k, V v, Entry&lt;K,V&gt;<span style="line-height:1.5;"> n) {
            value </span>=<span style="line-height:1.5;"> v;
            next </span>=<span style="line-height:1.5;"> n;
            key </span>=<span style="line-height:1.5;"> k;
            hash </span>=<span style="line-height:1.5;"> h;
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">获取节点的key</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> K getKey() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> key;
        }
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">获取节点的value</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> V getValue() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> value;
        }
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">设置新value，并返回旧的value</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> V setValue(V newValue) {
            V oldValue </span>=<span style="line-height:1.5;"> value;
            value </span>=<span style="line-height:1.5;"> newValue;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> oldValue;
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">判断key和value是否相同,两个都“相等”，返回true</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> equals(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (!(o <span style="color:rgb(0,0,255);line-height:1.5;">instanceof</span><span style="line-height:1.5;"> Map.Entry))
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
            Map.Entry e </span>=<span style="line-height:1.5;"> (Map.Entry)o;
            Object k1 </span>=<span style="line-height:1.5;"> getKey();
            Object k2 </span>=<span style="line-height:1.5;"> e.getKey();
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (k1 == k2 || (k1 != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> k1.equals(k2))) {
                Object v1 </span>=<span style="line-height:1.5;"> getValue();
                Object v2 </span>=<span style="line-height:1.5;"> e.getValue();
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (v1 == v2 || (v1 != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> v1.equals(v2)))
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
            }
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> hashCode() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> Objects.hashCode(getKey()) ^<span style="line-height:1.5;"> Objects.hashCode(getValue());
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> String toString() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> getKey() + "=" +<span style="line-height:1.5;"> getValue();
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * This method is invoked whenever the value in an entry is
         * overwritten by an invocation of put(k,v) for a key k that's already
         * in the HashMap.
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">void</span> recordAccess(HashMap&lt;K,V&gt;<span style="line-height:1.5;"> m) {
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
         * This method is invoked whenever the entry is
         * removed from the table.
         </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">void</span> recordRemoval(HashMap&lt;K,V&gt;<span style="line-height:1.5;"> m) {
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 添加新节点，如有必要，执行扩容操作
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">void</span> addEntry(<span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash, K key, V value, <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> bucketIndex) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> ((size &gt;= threshold) &amp;&amp; (<span style="color:rgb(0,0,255);line-height:1.5;">null</span> !=<span style="line-height:1.5;"> table[bucketIndex])) {
            resize(</span>2 *<span style="line-height:1.5;"> table.length);
            hash </span>= (<span style="color:rgb(0,0,255);line-height:1.5;">null</span> != key) ? hash(key) : 0<span style="line-height:1.5;">;
            bucketIndex </span>=<span style="line-height:1.5;"> indexFor(hash, table.length);
        }

        createEntry(hash, key, value, bucketIndex);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 插入单链表表头
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">void</span> createEntry(<span style="color:rgb(0,0,255);line-height:1.5;">int</span> hash, K key, V value, <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> bucketIndex) {
        Entry</span>&lt;K,V&gt; e =<span style="line-height:1.5;"> table[bucketIndex];
        table[bucketIndex] </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> Entry&lt;&gt;<span style="line-height:1.5;">(hash, key, value, e);
        size</span>++<span style="line-height:1.5;">;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">hashmap迭代器</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> HashIterator&lt;E&gt; <span style="color:rgb(0,0,255);line-height:1.5;">implements</span> Iterator&lt;E&gt;<span style="line-height:1.5;"> {
        Entry</span>&lt;K,V&gt; next;        <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 下个键值对索引</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> expectedModCount;   <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 用于判断快速失败行为</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> index;              <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> current slot</span>
        Entry&lt;K,V&gt; current;     <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> current entry</span>
<span style="line-height:1.5;">
        HashIterator() {
            expectedModCount </span>=<span style="line-height:1.5;"> modCount;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size &gt; 0) { <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> advance to first entry</span>
                Entry[] t =<span style="line-height:1.5;"> table;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                    ;
            }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> hasNext() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> next != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">final</span> Entry&lt;K,V&gt;<span style="line-height:1.5;"> nextEntry() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (modCount !=<span style="line-height:1.5;"> expectedModCount)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ConcurrentModificationException();
            Entry</span>&lt;K,V&gt; e =<span style="line-height:1.5;"> next;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (e == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NoSuchElementException();

            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> ((next = e.next) == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
                Entry[] t </span>=<span style="line-height:1.5;"> table;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                    ;
            }
            current </span>=<span style="line-height:1.5;"> e;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> e;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> remove() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (current == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> IllegalStateException();
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (modCount !=<span style="line-height:1.5;"> expectedModCount)
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ConcurrentModificationException();
            Object k </span>=<span style="line-height:1.5;"> current.key;
            current </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
            HashMap.</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.removeEntryForKey(k);
            expectedModCount </span>=<span style="line-height:1.5;"> modCount;
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">ValueIterator迭代器</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> ValueIterator <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> HashIterator&lt;V&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> V next() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> nextEntry().value;
        }
    }
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">KeyIterator迭代器</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> KeyIterator <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> HashIterator&lt;K&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> K next() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> nextEntry().getKey();
        }
    }
    </span><span style="color:rgb(0,128,0);line-height:1.5;">////</span><span style="color:rgb(0,128,0);line-height:1.5;">KeyIterator迭代器</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> EntryIterator <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> HashIterator&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Map.Entry&lt;K,V&gt;<span style="line-height:1.5;"> next() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> nextEntry();
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回迭代器方法</span>
    Iterator&lt;K&gt;<span style="line-height:1.5;"> newKeyIterator()   {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> KeyIterator();
    }
    Iterator</span>&lt;V&gt;<span style="line-height:1.5;"> newValueIterator()   {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ValueIterator();
    }
    Iterator</span>&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> newEntryIterator()   {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> EntryIterator();
    }


    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Views</span>

    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet = <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回一个set集合，包含key
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Set&lt;K&gt;<span style="line-height:1.5;"> keySet() {
        Set</span>&lt;K&gt; ks =<span style="line-height:1.5;"> keySet;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> (ks != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ? ks : (keySet = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> KeySet()));
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> KeySet <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> AbstractSet&lt;K&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Iterator&lt;K&gt;<span style="line-height:1.5;"> iterator() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> newKeyIterator();
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> size() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> size;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> contains(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> containsKey(o);
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> remove(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> HashMap.<span style="color:rgb(0,0,255);line-height:1.5;">this</span>.removeEntryForKey(o) != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> clear() {
            HashMap.</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.clear();
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回一个value集合，包含value
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Collection&lt;V&gt;<span style="line-height:1.5;"> values() {
        Collection</span>&lt;V&gt; vs =<span style="line-height:1.5;"> values;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> (vs != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ? vs : (values = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Values()));
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> Values <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> AbstractCollection&lt;V&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Iterator&lt;V&gt;<span style="line-height:1.5;"> iterator() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> newValueIterator();
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> size() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> size;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> contains(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> containsValue(o);
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> clear() {
            HashMap.</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.clear();
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 返回一个键值对集合
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> entrySet() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> entrySet0();
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> Set&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> entrySet0() {
        Set</span>&lt;Map.Entry&lt;K,V&gt;&gt; es =<span style="line-height:1.5;"> entrySet;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> es != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ? es : (entrySet = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> EntrySet());
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> EntrySet <span style="color:rgb(0,0,255);line-height:1.5;">extends</span> AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt;<span style="line-height:1.5;"> iterator() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> newEntryIterator();
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> contains(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (!(o <span style="color:rgb(0,0,255);line-height:1.5;">instanceof</span><span style="line-height:1.5;"> Map.Entry))
                </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
            Map.Entry</span>&lt;K,V&gt; e = (Map.Entry&lt;K,V&gt;<span style="line-height:1.5;">) o;
            Entry</span>&lt;K,V&gt; candidate =<span style="line-height:1.5;"> getEntry(e.getKey());
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> candidate != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp;<span style="line-height:1.5;"> candidate.equals(e);
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> remove(Object o) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> removeMapping(o) != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> size() {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> size;
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> clear() {
            HashMap.</span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">.clear();
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * map序列化,可实现深拷贝
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> writeObject(java.io.ObjectOutputStream s)
        </span><span style="color:rgb(0,0,255);line-height:1.5;">throws</span><span style="line-height:1.5;"> IOException
    {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Write out the threshold, loadfactor, and any hidden stuff</span>
<span style="line-height:1.5;">        s.defaultWriteObject();

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Write out number of buckets</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (table==<span style="line-height:1.5;">EMPTY_TABLE) {
            s.writeInt(roundUpToPowerOf2(threshold));
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">else</span><span style="line-height:1.5;"> {
           s.writeInt(table.length);
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Write out size (number of Mappings)</span>
<span style="line-height:1.5;">        s.writeInt(size);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Write out keys and values (alternating)</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (size &gt; 0<span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span>(Map.Entry&lt;K,V&gt;<span style="line-height:1.5;"> e : entrySet0()) {
                s.writeObject(e.getKey());
                s.writeObject(e.getValue());
            }
        }
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">long</span> serialVersionUID = 362498820763181265L<span style="line-height:1.5;">;

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * 反序列化，读取字节码转为对象
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> readObject(java.io.ObjectInputStream s)
         </span><span style="color:rgb(0,0,255);line-height:1.5;">throws</span><span style="line-height:1.5;"> IOException, ClassNotFoundException
    {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Read in the threshold (ignored), loadfactor, and any hidden stuff</span>
<span style="line-height:1.5;">        s.defaultReadObject();
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (loadFactor &lt;= 0 ||<span style="line-height:1.5;"> Float.isNaN(loadFactor)) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> InvalidObjectException("Illegal load factor: " +<span style="line-height:1.5;">
                                               loadFactor);
        }

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> set other fields that need values</span>
        table = (Entry&lt;K,V&gt;<span style="line-height:1.5;">[]) EMPTY_TABLE;

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Read in number of buckets</span>
        s.readInt(); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> ignored.

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Read number of mappings</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> mappings =<span style="line-height:1.5;"> s.readInt();
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (mappings &lt; 0<span style="line-height:1.5;">)
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> InvalidObjectException("Illegal mappings count: " +<span style="line-height:1.5;">
                                               mappings);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> capacity chosen by number of mappings and desired load (if &gt;= 0.25)</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">int</span> capacity = (<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;">) Math.min(
                    mappings </span>* Math.min(1 / loadFactor, 4.0f<span style="line-height:1.5;">),
                    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> we have limits...</span>
<span style="line-height:1.5;">                    HashMap.MAXIMUM_CAPACITY);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> allocate the bucket array;</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (mappings &gt; 0<span style="line-height:1.5;">) {
            inflateTable(capacity);
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">else</span><span style="line-height:1.5;"> {
            threshold </span>=<span style="line-height:1.5;"> capacity;
        }

        init();  </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Give subclass a chance to do its thing.

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Read the keys and values, and put the mappings in the HashMap</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span> (<span style="color:rgb(0,0,255);line-height:1.5;">int</span> i = 0; i &lt; mappings; i++<span style="line-height:1.5;">) {
            K key </span>=<span style="line-height:1.5;"> (K) s.readObject();
            V value </span>=<span style="line-height:1.5;"> (V) s.readObject();
            putForCreate(key, value);
        }
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> These methods are used when serializing HashSets</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">int</span>   capacity()     { <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> table.length; }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">float</span> loadFactor()   { <span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> loadFactor;   }
}
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <div style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;text-align:right;"> 
    <a href="http://www.cnblogs.com/chenpi/p/5280304.html#_labelTop" rel="nofollow" style="color:#000000;"></a>
    <a name="_label6"></a> 
   </div> 
   <h1 style="font-size:18px;line-height:1.5;background:rgb(19,131,213) none repeat scroll 0% 0%;color:rgb(255,255,255);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;">简单使用示例</h1> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">package</span><span style="line-height:1.5;"> com.pichen.collection;

</span><span style="color:rgb(0,0,255);line-height:1.5;">import</span><span style="line-height:1.5;"> java.util.HashMap;
</span><span style="color:rgb(0,0,255);line-height:1.5;">import</span><span style="line-height:1.5;"> java.util.Map;

</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Main {

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> main(String[] args) {
        Map</span>&lt;String, Integer&gt; map = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> HashMap&lt;String, Integer&gt;<span style="line-height:1.5;">();

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">put方法</span>
        map.put("A", 5<span style="line-height:1.5;">);
        map.put(</span>"B", 6<span style="line-height:1.5;">);
        map.put(</span>"C", 7<span style="line-height:1.5;">);
        map.put(</span>"D", 8<span style="line-height:1.5;">);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">重写了toString方法</span>
<span style="line-height:1.5;">        System.out.println(map);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">size方法</span>
<span style="line-height:1.5;">        System.out.println(map.size());
        
        System.out.println(map.containsKey(</span>"A"<span style="line-height:1.5;">));
        System.out.println(map.containsValue(</span>6<span style="line-height:1.5;">));
        System.out.println(map.get(</span>"B"<span style="line-height:1.5;">));
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">remove</span>
        map.remove("C"<span style="line-height:1.5;">);
        System.out.println(map);
        
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">key集合</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span><span style="line-height:1.5;">(String str:map.keySet()){
            System.out.print(str </span>+ " "<span style="line-height:1.5;">);
        }
        
        System.out.println();
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">value集合</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span><span style="line-height:1.5;">(Integer obj:map.values()){
            System.out.print(obj </span>+ " "<span style="line-height:1.5;">);
        }
        
        System.out.println();
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">key-value集合</span>
        <span style="color:rgb(0,0,255);line-height:1.5;">for</span>(Map.Entry&lt;String, Integer&gt;<span style="line-height:1.5;"> entry:map.entrySet()){
            System.out.print(entry.getKey() </span>+ ": " + entry.getValue() + ", "<span style="line-height:1.5;">);
        }

    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', SimSun, sans-serif;font-size:14px;">&nbsp;本文转自风一样的码农博客园博客，原文链接：http://www.cnblogs.com/chenpi/p/5280304.html，如需转载请自行联系原作者</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
