<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux signal那些事儿【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://blog.chinaunix.net/uid-24774106-id-4061386.html    Linux编程，信号是一个让人爱恨交加又不得不提的一个领域。最近我集中学习了Linux的signal相关的内容，分享出来，也为防止自己忘记。&nbsp; &nbsp;...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/22/weixin_33912453_90125784.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux signal那些事儿【转】</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">转自：<a href="http://blog.chinaunix.net/uid-24774106-id-4061386.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://blog.chinaunix.net/uid-24774106-id-4061386.html</a></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;">Linux编程，信号是一个让人爱恨交加又不得不提的一个领域。最近我集中学习了Linux的signal相关的内容，分享出来，也为防止自己忘记。<br><span style="line-height:2;">&nbsp; &nbsp; 信号的本质是异步。异步一这个词，听着高端大气上档次，又让人云山雾绕，其则不然。其实我们想想，我们这个世界是异步的，每个人干事儿，并不总是A-&gt;B-&gt;C-&gt;D这种。比如我在网上买了东西，我其实并不知道快递几时能到。我可能在公司里面，在喝水，在回邮件，在查bug，在写代码，突然收到了快递小哥的电话，注意这就是信号的delivery。由于快递的到来，我不得不停下我手头的活儿，去签收快递。这就是传说中的典型的异步。我不知道快递小哥几时给我电话，但是我收到电话就去签收，这是我的信号处理函数。更高级一点，如果我在参加重要的会议，我可能需要屏蔽快递小哥的电话（假如我知道其电话），这已经是linux下信号的高级应用(sigprocmask)了。<br><span style="line-height:2;">&nbsp; &nbsp; 信号是一种机制，是在软件层次对中断机制的一种模拟，内核让某进程意识到某特殊事情发生了。强迫进程去执行相应的信号处理函数。至于信号的来源可能来自硬件如按下键盘或者硬件故障（如ctrl+c发送SIGINT），可能来自其他进程（kill，sigqueue），可能来自自己进程（raise）。&nbsp;<br><span style="line-height:2;">&nbsp; &nbsp; 信号的本质是一种进程间的通信，一个进程可以向另一个进程发送信号，至少传递了signo这个int值。实际上，通信的内容，可以远不止是signo，可以通过SA_SIGINFO标志位通知进程去取额外的信息。<br><span style="line-height:2;">&nbsp; &nbsp; 我痛恨片汤话儿，可是上面一大坨片汤话儿，却真真的道出了信号的本质。<br><span style="line-height:2;">&nbsp; &nbsp; 前面也提到了，signal是个让人爱恨交加的feature，原因在于沉重的历史包袱。下面我将一一道来。<br><span style="line-height:2;">&nbsp; &nbsp; 在上古时期，UNIX就已经有了signal这个feature，但是当时的signal存在几个问题：<br><span style="line-height:2;">&nbsp;&nbsp;<strong style="line-height:2;">&nbsp;1 传统的信号处理函数是一次性的，而非永久性的。</strong><br><span style="line-height:2;">&nbsp; &nbsp; linux为了向下兼容，依然实现了这个有缺陷的signal系统调用。你可看到signal系统调用的内核代码中有SA_ONESHOT这个标志位。<br></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#ifdef __ARCH_WANT_SYS_SIGNAL<br></span></li> 
     <li style="list-style:decimal;">/<span style="color:rgb(0,0,204);">*<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">For backwards compatibility<span style="color:rgb(0,0,204);">. Functionality superseded by sigaction<span>.<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
     <li style="list-style:decimal;">SYSCALL_DEFINE2<span style="color:rgb(0,0,204);">(signal<span>,&nbsp;<span style="color:rgb(0,0,255);">int<span style="color:rgb(0,0,204);">, sig<span>, __sighandler_t<span>, handler<span>)<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">{<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">struct k_sigaction new_sa<span style="color:rgb(0,0,204);">, old_sa<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">int&nbsp;<span>ret<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:rgb(0,0,204);">.sa<span>.sa_handler&nbsp;<span>= handler<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:rgb(0,0,204);">.sa<span>.sa_flags&nbsp;<span>= SA_ONESHOT&nbsp;<span>| SA_NOMASK<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigemptyset<span style="color:rgb(0,0,204);">(<span>&amp;new_sa<span>.sa<span>.sa_mask<span>)<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">= do_sigaction<span>(sig<span>, &amp;new_sa<span>, &amp;old_sa<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">?&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">:&nbsp;<span>(unsigned long<span>)old_sa<span>.sa<span>.sa_handler<span>;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">}<br></li> 
     <li style="list-style:decimal;">#<span style="color:rgb(0,0,255);">endif /<span style="color:rgb(0,0,204);">* __ARCH_WANT_SYS_SIGNAL&nbsp;<span>*<span>/</span></span></span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 这个SA_ONESHOT标志位，等同于SA_RESETHAND标志：在arch/x86/include/uapi/asm/signal.h中有：<br></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#define SA_ONESHOT&nbsp;&nbsp;&nbsp;&nbsp;SA_RESETHAND</span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 信号产生，到信号处理函数开始执行，中间肯定是有时间差的。内核开始开始强迫进程对信号作出响应，这叫作信号的传递。也就是说信号产生，内核只是在进程描述符记录了一笔，该进程收到信号X一枚，并没有马上强迫进程对信号作出响应。已经产生但尚未传递的信号叫挂起信号。对于非实时而言，信号不排队，位图占个位即可。对于实时信号，则排队，同一信号可能有多个挂起信号。这个不多说，后面自然提到。<br><span style="line-height:2;">&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://blog.chinaunix.net/attachment/201401/1/24774106_1388566535RBIr.png" alt="" width="600" height="331" style="border:none;"><br><span style="line-height:2;">&nbsp; &nbsp; 上图反映了内核如何传递信号。基本就是选择一个挂起信号，然后处理一个信号。get_signal_to_deliver 是在进程中选择一个信号来handle。代码在kernel/signal.c，其中有如下code：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(0,0,255);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;<span style="color:rgb(0,0,204);">(ka<span>-<span>&gt;sa<span>.sa_handler&nbsp;<span>=<span>= SIG_IGN<span>)&nbsp;<span>/<span>*&nbsp;<span style="color:rgb(0,0,255);">Do&nbsp;<span>nothing<span style="color:rgb(0,0,204);">.&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(ka<span>-<span>&gt;sa<span>.sa_handler&nbsp;<span>!<span>= SIG_DFL<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* Run the handler<span>.&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*return_ka&nbsp;<span>=&nbsp;<span>*ka<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>ka<span>-<span>&gt;<span>sa<span>.<span>sa_flags&nbsp;<span>&amp;<span>&nbsp;SA_ONESHOT<span>)<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ka<span style="color:rgb(0,0,204);">-<span>&gt;<span>sa<span>.<span>sa_handler&nbsp;<span>=<span>&nbsp;SIG_DFL<span>;<br></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;&nbsp;<span>/<span>* will return non<span>-zero&nbsp;<span style="color:rgb(255,0,255);">"signr" value&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}</span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们看到了linux也实现了signal这个有缺陷的系统调用。传统的signal系统调用，他的信号处理函数是一次性的，执行过后，该信号的信号处理函数就变成了SIG_DFL。<br><span style="line-height:2;">&nbsp; &nbsp; 值得一提的是，glibc的signal函数，调用的已经不是传统的signal系统调用，而是rt_sigaction系统调用，这种一次性的缺陷早已经解决了。怎么证明：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code<span>/c<span>/self<span>/signal$ cat signal_fault_1<span>.c&nbsp;<br></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdio<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdlib<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;signal<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;<span style="color:rgb(255,0,0);">string<span style="color:rgb(0,0,204);">.h<span>&gt;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;errno<span>.h<span>&gt;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">#define MSG&nbsp;<span style="color:rgb(255,0,255);">"OMG , I catch the signal SIGINT\n"<br></span> </li> 
     <li style="list-style:decimal;">#define MSG_END&nbsp;<span style="color:rgb(255,0,255);">"OK,finished process signal SIGINT\n"<br></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(255,0,0);">int do_heavy_work<span style="color:rgb(0,0,204);">(<span>)<br></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int i&nbsp;<span style="color:rgb(0,0,204);">;&nbsp;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int k<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;srand<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">time<span style="color:rgb(0,0,204);">(<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 0&nbsp;<span>; i&nbsp;<span>&lt; 100000000<span>;i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;<span style="color:rgb(0,0,204);">= rand<span>(<span>)<span>%1234589<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">void signal_handler<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">int signo<span style="color:rgb(0,0,204);">)<br></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;write<span style="color:rgb(0,0,204);">(2<span>,MSG<span>,strlen<span>(MSG<span>)<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;do_heavy_work<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;write<span style="color:rgb(0,0,204);">(2<span>,MSG_END<span>,strlen<span>(MSG_END<span>)<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(255,0,0);">int main<span style="color:rgb(0,0,204);">(<span>)<br></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;char input<span style="color:rgb(0,0,204);">[1024<span>]&nbsp;<span>=&nbsp;<span>{0<span>}<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);"><br></span></li> 
     <li style="list-style:decimal;"><span>#if defined TRADITIONAL_SIGNAL_API<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(syscall(SYS_signal ,SIGINT,signal_handler) == -1)<br><span>#elif defined SYSTEMV_SIGNAL_API<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(sysv_signal(SIGINT,signal_handler) == -1)<br><span>#else<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(signal(SIGINT,signal_handler) == SIG_ERR)<br><span>#endif<br></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"signal failed\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,204);">-1<span>;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"input a string:\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(fgets<span>(input<span>,sizeof<span>(input<span>)<span>,stdin<span>)<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:rgb(0,0,204);">(stderr<span>,<span style="color:rgb(255,0,255);">"fgets failed(%s)\n"<span style="color:rgb(0,0,204);">,strerror<span>(errno<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,204);">-2<span>;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"you entered:%s"<span style="color:rgb(0,0,204);">,input<span>)<span>;<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return 0<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 编译的时候，我没有定义SYSTEMV_SIGNAL_API,就是标准的glibc的signal函数，我用strace跟踪glibc的signal函数调用的系统调用是：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">rt_sigaction<span style="color:rgb(0,0,204);">(SIGINT<span>, {0x8048736<span>,&nbsp;<span>[<span style="color:rgb(0,0,255);">INT<span style="color:rgb(0,0,204);">]<span>, SA_RESTART}<span>, {SIG_DFL<span>,&nbsp;<span>[<span>]<span>, 0}<span>, 8<span>)&nbsp;<span>= 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 测试结果如下：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$ gcc&nbsp;<span>-o signal_glibc signal_fault_1<span>.c&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_glibc&nbsp;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">input^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^COK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^Z<br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">[1<span>]<span>+ Stopped&nbsp;<span>.<span>/signal_glibc</span></span></span></span></span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们安装的信号处理函数并不是一次性的，原因就是glibc的signal函数调用的函数并非是signal系统调用，并没有SA_ONESHOT标志位。<br><span style="line-height:2;">&nbsp; &nbsp; 我们如何体验下老古董的signal，glibc提供了一个sysv_signal接口，manual中这样描述：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;However sysv_signal<span style="color:rgb(0,0,204);">(<span>) provides the System V unreliable signal semantics<span>, that is<span>: a<span>) the disposition&nbsp;<span style="color:rgb(255,0,0);">of the sig‐<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">&nbsp; &nbsp;nal is reset to the default when the handler is invoked<span style="color:rgb(0,0,204);">; b<span>) delivery&nbsp;<span style="color:rgb(255,0,0);">of further instances&nbsp;<span>of the signal is&nbsp;<span style="color:rgb(0,0,255);">not<br></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp; &nbsp;blocked&nbsp;<span style="color:rgb(0,0,255);">while the signal handler is executing<span style="color:rgb(0,0,204);">;&nbsp;<span style="color:rgb(0,0,255);">and c<span style="color:rgb(0,0,204);">)&nbsp;<span style="color:rgb(0,0,255);">if the handler interrupts&nbsp;<span style="color:rgb(0,0,204);">(certain<span>) blocking system calls<span>,<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp; &nbsp;then the system&nbsp;<span style="color:rgb(0,0,255);">call is&nbsp;<span>not automatically restarted<span style="color:rgb(0,0,204);">.</span></span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 对于我们的例子只需要：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">gcc&nbsp;<span style="color:rgb(0,0,204);">-DSYSTEMV_SIGNAL_API&nbsp;<span>-o signal_sysv signal_fault_1<span>.c</span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们看下：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_sysv&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^C<br></li> 
     <li style="list-style:decimal;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$ man sysv_signal</span></span></span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 第二个ctrl+C导致了进程的推出，原因是sysv_signal这种传统的signal的安装函数是一次性的。strace也证明了这一点：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">rt_sigaction<span style="color:rgb(0,0,204);">(SIGINT<span>, {0x8048756<span>,&nbsp;<span>[<span>]<span>, SA_INTERRUPT<span>|SA_NODEFER<span>|<span>SA_RESETHAND}<span>, {SIG_DFL<span>,&nbsp;<span>[<span>]<span>, 0}<span>, 8<span>)&nbsp;<span>= 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 还记得么：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#define SA_ONESHOT&nbsp;<span>SA_RESETHAND</span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们发现sysv调用的不是signal系统调用，而是rt_sigaction系统调用。如果你非要品尝传统的signal系统调用，这也不难。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;">gcc -DTRADITIONAL_SIGNAL_API &nbsp;-o signal_traditional signal_fault_1.c&nbsp;<br></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们发现第二个SIGINT信号的信号处理函数已经SIG_DFL,使进程退出了。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_traditional&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^C</li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们通过strace可以证明，的确调用了signal系统调用：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">signal<span style="color:rgb(0,0,204);">(SIGINT<span>, 0x8048736<span>)&nbsp;<span>= 0&nbsp;<span>(SIG_DFL<span>)<span style="line-height:2;font-family:'sans serif', tahoma, verdana, helvetica;">&nbsp;</span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp;&nbsp;&nbsp;&nbsp;<strong style="line-height:2;">2早期的信号，没有屏蔽正在处理的信号。<br> &nbsp; &nbsp;&nbsp;</strong><span style="line-height:2;">如何证明这一点呢？我上面的例子中故意在信号处理函数中做了很heavy很耗时的操作，从而容易造出处理信号A的时候，另一信号A又被deliver的场景。<br><span style="line-height:2;">&nbsp; &nbsp; 因为do_heavy_work是个很耗费时间的操作，信号处理完成我们会在标准错误上输出处理完成的语句，这就表征了信号处理结束了没有。<br><span style="line-height:2;">&nbsp; &nbsp; 我们看下传统signal的，收到一个SIGINT的信号的情况：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_traditional&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">^C<span>OMG&nbsp;<span style="color:rgb(0,0,204);">,<span>&nbsp;I catch the signal SIGINT<br></span></span></span> </li> 
     <li style="list-style:decimal;"><span>OK<span style="color:rgb(0,0,204);">,<span>finished process signal SIGINT<br></span></span></span></li> 
     <li style="list-style:decimal;">fgets failed<span style="color:rgb(0,0,204);">(Interrupted system&nbsp;<span style="color:rgb(0,0,255);">call<span style="color:rgb(0,0,204);">)<br></span></span></span> </li> 
     <li style="list-style:decimal;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$</span></span></span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 如果我在进程处理信号处理函数的时候，再次发送一个SIGINT，这个SIGINT也可能被内核deliver。那么信号处理函数就被中断掉，<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_traditional&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">,&nbsp;<span>I catch the signal SIGINT<br></span></span> </li> 
     <li style="list-style:decimal;">^C<br></li> 
     <li style="list-style:decimal;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$</span></span></span></span> </li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们看到我们收到了I catch the signal SIGINT的打印，但是，并没有收到OK,I finished process signal SIGINT，这表明传统的signal并没有屏蔽正在处理的信号。<br><span style="line-height:2;">&nbsp; &nbsp; 那么我们现在的glibc的signal函数如何？<br><span style="line-height:2;">&nbsp; &nbsp; strace又来帮忙了?<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">rt_sigaction<span style="color:rgb(0,0,204);">(SIGINT<span>,&nbsp;<span>{0x8048736<span>,&nbsp;<span>[<span style="color:rgb(0,0,255);">INT<span style="color:rgb(0,0,204);">]<span>,<span>&nbsp;SA_RESTART}<span>, {SIG_DFL<span>,&nbsp;<span>[<span>]<span>, 0}<span>, 8<span>)&nbsp;<span>= 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; glibc的signal函数，调用的是rt_sigaction 系统调用：<br><span style="line-height:2;">&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">SYSCALL_DEFINE4<span style="color:rgb(0,0,204);">(rt_sigaction<span>,&nbsp;<span style="color:rgb(0,0,255);">int<span style="color:rgb(0,0,204);">, sig<span>,<br></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;<span style="color:rgb(0,0,255);">struct sigaction __user&nbsp;<span style="color:rgb(0,0,204);">*<span>, act<span>,<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">struct sigaction __user&nbsp;<span style="color:rgb(0,0,204);">*<span>, oact<span>,<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t<span style="color:rgb(0,0,204);">, sigsetsize<span>)<br></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,255);">struct sigaction {<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">union {<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp; __sighandler_t _sa_handler<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp; void&nbsp;<span style="color:rgb(0,0,204);">(<span>*_sa_sigaction<span>)<span>(<span style="color:rgb(0,0,255);">int<span style="color:rgb(0,0,204);">,&nbsp;<span style="color:rgb(0,0,255);">struct siginfo&nbsp;<span style="color:rgb(0,0,204);">*<span>, void&nbsp;<span>*<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;} _u<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigset_t sa_mask<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;unsigned long sa_flags<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">(<span>*sa_restorer<span>)<span>(void<span>)<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">}</li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 我们把strace中的信息，和sigaction数据对比，发现，[INT],就是传说中的sa_mask,当处理SIGINT的时候，看起来是在处理SIGINT信号处理函数的时候，SIGINT会被被屏蔽，防止重入。实际如何呢？&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_glibc&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">input a string<span style="color:rgb(0,0,204);">:<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^C^C^C^COK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^C^COK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span> </li> 
     <li style="list-style:decimal;">^Z<br></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">[2<span>]<span>+ Stopped&nbsp;<span>.<span>/signal_glibc</span></span></span></span></span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 从未出现OMG，I catch the SIGINT连续出现。这是偶然还是必然呢？答案是必然，内核是如何做到的呢？<br><span style="line-height:2;">&nbsp; &nbsp; 在上图的handle_signal函数的末尾，调用了signal_delivered函数：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(0,0,204);">/<span>*<span>*<br></span></span></span></span></li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* signal_delivered&nbsp;<span>-&nbsp;<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* @sig<span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number of signal being delivered<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* @info<span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;siginfo_t of signal being delivered<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* @ka<span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigaction setting that chose the handler<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* @regs<span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user register state<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* @stepping<span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nonzero&nbsp;<span style="color:rgb(0,0,255);">if debugger single<span style="color:rgb(0,0,204);">-<span style="color:rgb(0,0,255);">step&nbsp;<span>or block<span style="color:rgb(0,0,204);">-<span style="color:rgb(0,0,255);">step&nbsp;<span>in use<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<br></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function should be called when a signal has succesfully been<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* delivered<span>. It updates the blocked signals accordingly&nbsp;<span>(<span>@ka<span>-<span>&gt;sa<span>.sa_mask<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is always blocked<span style="color:rgb(0,0,204);">,&nbsp;<span style="color:rgb(0,0,255);">and the signal itself&nbsp;<span>is blocked unless&nbsp;<span style="color:rgb(0,0,204);">%SA_NODEFER<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is&nbsp;<span>set&nbsp;<span>in @ka<span style="color:rgb(0,0,204);">-<span>&gt;sa<span>.sa_flags<span>. Tracing&nbsp;<span style="color:rgb(0,0,255);">is notified<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
     <li style="list-style:decimal;">void signal_delivered<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,0);">int sig<span style="color:rgb(0,0,204);">, siginfo_t&nbsp;<span>*info<span>, struct k_sigaction&nbsp;<span>*ka<span>,<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct pt_regs&nbsp;<span style="color:rgb(0,0,204);">*regs<span>,&nbsp;<span style="color:rgb(255,0,0);">int stepping<span style="color:rgb(0,0,204);">)<br></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigset_t blocked<span style="color:rgb(0,0,204);">;<br></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* A signal was successfully delivered<span>,&nbsp;<span style="color:rgb(0,0,255);">and the<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp; saved sigmask was stored&nbsp;<span style="color:rgb(0,0,255);">on the signal frame<span style="color:rgb(0,0,204);">,<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">and will be restored by sigreturn<span style="color:rgb(0,0,204);">. So we can<br></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp; simply clear the restore sigmask flag<span style="color:rgb(0,0,204);">.&nbsp;<span>*<span>/<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;clear_restore_sigmask<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigorsets<span style="color:rgb(0,0,204);">(<span>&amp;blocked<span>,&nbsp;<span>&amp;current<span>-<span>&gt;blocked<span>,&nbsp;<span>&amp;ka<span>-<span>&gt;sa<span>.sa_mask<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!<span>(<span>ka<span>-<span>&gt;<span>sa<span>.<span>sa_flags&nbsp;<span>&amp;<span>&nbsp;SA_NODEFER<span>)<span>)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>sigaddset<span style="color:rgb(0,0,204);">(<span>&amp;<span>blocked<span>,<span>&nbsp;sig<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;set_current_blocked<span style="color:rgb(0,0,204);">(<span>&amp;blocked<span>)<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;tracehook_signal_handler<span style="color:rgb(0,0,204);">(sig<span>, info<span>, ka<span>, regs<span>, stepping<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 这个函数很有意思，只要用户没有指定SA_NODEFER标志位，当前处理的信号总是加入到屏蔽信号之中。深入理解Linux内核在也提到了这一点。经典教材是这么说的：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;line-height:2;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><em>当进程执行一个信号处理程序的函数时，通常屏蔽相应的信号，即自动阻塞这个信号，直到处理程序结束。因此，所处理的信号的另一次出现，并不能中断信号处理程序，所以信号处理函数不必是可以重入的。</em></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 这个结论很震惊吧。是的你用glibc的signal函数，不必担心信号处理函数的嵌套问题。至于重入问题我们后文讨论。<br><span style="line-height:2;">&nbsp; &nbsp; 那么传统的signal系统调用和sysv_signal又如何？为何他们存在信号的可重入问题？&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol style="line-height:2;">
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">SYSCALL_DEFINE2<span style="color:rgb(0,0,204);">(signal<span>,&nbsp;<span style="color:rgb(0,0,255);">int<span style="color:rgb(0,0,204);">, sig<span>, __sighandler_t<span>, handler<span>)<br></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;">{<br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">struct k_sigaction new_sa<span style="color:rgb(0,0,204);">, old_sa<span>;<br></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">int&nbsp;<span>ret<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:rgb(0,0,204);">.sa<span>.sa_handler&nbsp;<span>= handler<span>;<br></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:rgb(0,0,204);">.sa<span>.sa_flags&nbsp;<span>= SA_ONESHOT&nbsp;<span>|&nbsp;<span>SA_NOMASK<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;sigemptyset<span style="color:rgb(0,0,204);">(<span>&amp;new_sa<span>.sa<span>.sa_mask<span>)<span>;<br></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">= do_sigaction<span>(sig<span>, &amp;new_sa<span>, &amp;old_sa<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">?&nbsp;<span style="color:rgb(0,0,255);">ret&nbsp;<span style="color:rgb(0,0,204);">:&nbsp;<span>(unsigned long<span>)old_sa<span>.sa<span>.sa_handler<span>;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li style="list-style:decimal;">}</li> 
    </ol>
    <div>
     <span style="color:rgb(92,92,92);"><span style="line-height:12px;"><br> #define&nbsp;<span>SA_NOMASK&nbsp;<span>SA_NODEFER<br><br></span></span></span></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 至于sysv_signal<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">rt_sigaction<span style="color:rgb(0,0,204);">(SIGINT<span>, {0x8048756<span>,&nbsp;<span>[<span>]<span>, SA_INTERRUPT<span>|<span>SA_NODEFER<span>|SA_RESETHAND}<span>, {SIG_DFL<span>,&nbsp;<span>[<span>]<span>, 0}<span>, 8<span>)&nbsp;<span>= 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;">&nbsp; &nbsp; 不多说了，不作死就不会死，signal系统调用和sysv_signal都作死：sa_mask是空，更要命的是都有<span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;">SA_NODEFER<span>&nbsp;。自作孽，不可活。之所以如此自作孽，就是为了向下兼容，向传统的signal致敬。<br> &nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;<span style="font-size:15px;"><strong>&nbsp;&nbsp; 3 早期的signal，会中断系统调用。&nbsp;&nbsp;</strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span><br><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;何意？<strong>&nbsp;&nbsp;</strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span><br><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;某些系统调用可能会被信号中断，此时系统调用返回错误EINTR，表示被信号中断了。非常多的系统调用都会被中断，我前面有篇博文<a href="http://blog.chinaunix.net/uid-24774106-id-3065234.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">重启系统调用探究</a>，就详细介绍了系统被信号中断的问题，传统的signal会出现这个问题。那么glibc的signal函数有没有这个问题？答案是没有这个问题，glibc的signal函数很不错。</span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);font-size:15px;">rt_sigaction<span style="color:rgb(0,0,204);">(SIGINT<span>, {0x8048736<span>,&nbsp;<span>[<span style="color:rgb(0,0,255);">INT<span style="color:rgb(0,0,204);">]<span>, SA_RESTART}<span>, {SIG_DFL<span>,&nbsp;<span>[<span>]<span>, 0}<span>, 8<span>)&nbsp;<span>= 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;">&nbsp; &nbsp; signal系统调用和sysv_signal都有这个弊端：请看：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);font-size:15px;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_traditional&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">input a string<span style="color:rgb(0,0,204);">:<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">fgets failed<span style="color:rgb(0,0,204);">(Interrupted system&nbsp;<span style="color:rgb(0,0,255);">call<span style="color:rgb(0,0,204);">)<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$&nbsp;<span>.<span>/signal_sysv&nbsp;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">input a string<span style="color:rgb(0,0,204);">:<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">^COMG&nbsp;<span style="color:rgb(0,0,204);">, I catch the signal SIGINT<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">OK<span style="color:rgb(0,0,204);">,finished process signal SIGINT<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">fgets failed<span style="color:rgb(0,0,204);">(Interrupted system&nbsp;<span style="color:rgb(0,0,255);">call<span style="color:rgb(0,0,204);">)<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">manu@manu<span style="color:rgb(0,0,204);">-hacks<span>:<span>~<span>/code/c/self/signal$</span></span></span></span></span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;">&nbsp; &nbsp; 原因就是没有SA_RESTART标志位。内核代码如何体现：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <ol>
     <li style="list-style:decimal;"><span style="color:rgb(0,0,0);font-size:15px;">static void<br></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">handle_signal<span style="color:rgb(0,0,204);">(unsigned long sig<span>, siginfo_t&nbsp;<span>*info<span>, struct k_sigaction&nbsp;<span>*ka<span>,<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct pt_regs&nbsp;<span style="color:rgb(0,0,204);">*regs<span>)<br></span></span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);font-size:15px;">{<br></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* Are we from a system&nbsp;<span style="color:rgb(0,0,255);">call<span style="color:rgb(0,0,204);">?&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(syscall_get_nr<span>(current<span>, regs<span>)&nbsp;<span>&gt;<span>= 0<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>*&nbsp;<span style="color:rgb(0,0,255);">If so<span style="color:rgb(0,0,204);">, check system&nbsp;<span style="color:rgb(0,0,255);">call restarting<span style="color:rgb(0,0,204);">.<span>.&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;<span style="color:rgb(0,0,204);">(syscall_get_error<span>(current<span>, regs<span>)<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case&nbsp;<span style="color:rgb(0,0,204);">-ERESTART_RESTARTBLOCK<span>:<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case&nbsp;<span style="color:rgb(0,0,204);">-ERESTARTNOHAND<span>:<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:rgb(0,0,204);">-<span>&gt;ax&nbsp;<span>=&nbsp;<span>-EINTR<span>;<br></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span></span></li> 
     <li style="list-style:decimal;"><br></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case&nbsp;<span style="color:rgb(0,0,204);">-ERESTARTSYS<span>:<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!<span>(ka<span>-<span>&gt;sa<span>.sa_flags&nbsp;<span>&amp; SA_RESTART<span>)<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:rgb(0,0,204);">-<span>&gt;ax&nbsp;<span>=&nbsp;<span>-EINTR<span>;<br></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* fallthrough&nbsp;<span>*<span>/<br></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">case&nbsp;<span style="color:rgb(0,0,204);">-ERESTARTNOINTR<span>:<br></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:rgb(0,0,204);">-<span>&gt;ax&nbsp;<span>= regs<span>-<span>&gt;orig_ax<span>;<br></span></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:rgb(0,0,204);">-<span>&gt;ip&nbsp;<span>-<span>= 2<span>;<br></span></span></span></span></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span></span></li> 
     <li style="list-style:decimal;"><span style="font-size:15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}</span></span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);font-size:15px;">&nbsp; &nbsp; 。。。</span></li> 
     <li style="list-style:decimal;"><span style="color:rgb(0,0,204);font-size:15px;">}</span></li> 
    </ol>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;">&nbsp; &nbsp; 很多文章都都将signal函数描述的多么不堪，其实glibc的signal函数非常靠谱，传统的signal的几个弊端都不存在，在日常的工作中，signal完全可以满足需要。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 但是存在一个问题，就会可移植性。由于不同的平台可能不同。单就linux平台而言，glibc的signal函数还不错。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> &nbsp; &nbsp; 那么signal还有什么问题呢？为啥有引入了实时信号？那是下一篇内容。<br><br> 参考文献</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 1 深入理解linunx内核</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 2&nbsp;<span style="line-height:1.5;">&nbsp;linux内核源代码情景分析<br> 3 signal ppt&nbsp;&nbsp;蘇維農<br> 4 linux系统编程</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><span style="line-height:1.5;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><font color="#666666"><span style="font-size:15px;letter-spacing:.1px;"><br></span></font></p> 
   <p><span><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:12px;"><font color="#666666"><span style="line-height:1.5;font-size:15px;letter-spacing:.1px;"></span></font></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><font color="#666666"><span style="font-size:15px;letter-spacing:.1px;">本文转自张昺华-sky博客园博客，原文链接：http://www.cnblogs.com/sky-heaven/p/6844566.html</span></font><span style="font-size:15px;letter-spacing:.1px;color:rgb(102,102,102);font-family:Consolas, monospace;">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
