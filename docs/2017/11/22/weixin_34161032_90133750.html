<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ListView的操作模式的选择的更详细的解释CHOICE_MODE_MULTIPLE与CHOICE_MODE_MULTIPLE_MODAL... « NotBeCN</title>
  <meta name="description" content="             本文介绍了我们将如何取得具体ListView多选择操作。本文将正确使用ListViewCHOICE_MODE_MULTIPLE要么CHOICE_MODE_MULTIPLE_MODAL时间easy误区。以及    CHOICE_MODE_MULTIPLE与CHOICE_MODE_MULTI...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/22/weixin_34161032_90133750.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">ListView的操作模式的选择的更详细的解释CHOICE_MODE_MULTIPLE与CHOICE_MODE_MULTIPLE_MODAL...</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">本文介绍了我们将如何取得具体ListView多选择操作。本文将正确使用ListViewCHOICE_MODE_MULTIPLE要么CHOICE_MODE_MULTIPLE_MODAL时间easy误区。以及</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">CHOICE_MODE_MULTIPLE与CHOICE_MODE_MULTIPLE_MODAL的差别。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">最后我们将给出一个demo来演示两种多选操作的实现。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"><span style="line-height:1.8;"></span></span></p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"> <br><span style="line-height:1.8;font-family:'宋体';font-size:21px;"></span> </h3> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.8;font-family:'宋体';font-size:21px;">一、在不使用<span style="line-height:1.8;font-family:'times new roman';">ListView</span><span style="line-height:1.8;">多选模式的情况下</span></span></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;color:rgb(0,112,192);">注：我觉得这一节能够不看，由于我觉得不使用ListView的多选模式有点愚蠢。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">假设我们不知道ListView自带多选模式，那么我们通常是通过维护一个保存被选择position集合来实现多选的。通常情况下这个集合类型我们选择HashSet。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">实现的大致框架例如以下：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Adapter中：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">保存被选择的position</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <pre><code class="language-html">public HashSet&lt;Long&gt; selectedItems = new HashSet&lt;Long&gt;();</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">getView中推断当前Position是否在集合中。从而显示不同的外观</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <pre><code class="language-html">    public View getView(int position, View convertView, ViewGroup par) {
......
            if(selectedItems.contains((long)position)){
                holder.cBox.setChecked(true);
            }else{
                holder.cBox.setChecked(false);
            }
            if(selectedMode==AppContext.MULTI_SELECTED){
                holder.cBox.setVisibility(View.VISIBLE);
                holder.check_box_wraper.setVisibility(View.VISIBLE);
            }else{
                holder.cBox.setVisibility(View.GONE);
                holder.check_box_wraper.setVisibility(View.GONE);
            }
.....
｝</code></pre> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Activity中：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">主要是处理onItemClick事件，在不同模式下。做不同的处理。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <pre><code class="language-html">@Override
public void onItemClick(AdapterView&lt;?
</code></pre> 
   <p></p> 
   <p>&gt; a, View v, int position, long id) { //普通模式 ：直接打开一个activity if(itemClickActionMode==AppContext.VIEW_NOTE){ Long mId=Long.parseLong(idText.getText().toString()); Uri uri = ContentUris.withAppendedId(getIntent().getData(), mId); startActivity(new Intent(Intent.ACTION_VIEW, uri)); } //多选模式：更新adapter中selectedItems 集合的值，同一时候 让adapter在getView中改变item的外观。 else{ ViewHolder vHollder = (ViewHolder) v.getTag(); if(mAdapter.selectedItems.contains((long)position)){ mAdapter.selectedItems.remove((long)position); }else{ mAdapter.selectedItems.add((long)position); } mAdapter.notifyDataSetChanged(); onItemSelected(getSelectedCount()); } }</p> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">上面的做法其有用的非常普遍。可是我们不提倡。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"> <span style="line-height:1.8;font-family:'宋体';font-size:21px;">二、使用<span style="line-height:1.8;font-family:'times new roman';">ListViiew</span><span style="line-height:1.8;">的</span></span><span style="line-height:1.8;font-family:'宋体';font-size:21px;">CHOICE_MODE_MULTIPLE</span><span style="line-height:1.8;font-family:'宋体';font-size:21px;">模式</span> </h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">ListView有四种模式：</p> 
   <pre><code class="language-html">/**
 * Normal list that does not indicate choices
 */
public static final int CHOICE_MODE_NONE = 0;
/**
 * The list allows up to one choice
 */
public static final int CHOICE_MODE_SINGLE = 1;
/**
 * The list allows multiple choices
 */
public static final int CHOICE_MODE_MULTIPLE = 2;
/**
 * The list allows multiple choices in a modal selection mode
 */
public static final int CHOICE_MODE_MULTIPLE_MODAL = 3;</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">当中<code class="js plain">CHOICE_MODE_NONE</code>是普通模式，<code class="js plain">CHOICE_MODE_SINGLE</code>是单选模式，不经常使用，<code class="js plain">CHOICE_MODE_MULTIPLE</code>和<code class="js plain">CHOICE_MODE_MULTIPLE_MODAL</code>都是多选模式，他们的差别稍后我们会讲到。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">所以ListView在设计的时候事实上是考虑了多选操作的。我们没有必要自己再像第一节描写叙述的那样专门维护一个HashSet来保存被选择的position。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">实现ListView的多选操作的代码在ListView直接父类AbsListView中，AbsListView已经有一个mCheckStates变量来做了保存被选择的position这个事情。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">mCheckStates的定义例如以下：</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <div class="line number1 index0 alt2">
        1
       </div> </td> 
      <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <div> 
        <div class="line number1 index0 alt2">
         <code class="js plain">SparseBooleanArray mCheckStates;</code>
        </div> 
       </div> </td> 
     </tr>
    </tbody>
   </table>
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span><span style="line-height:1.8;font-family:'宋体';">AbsListView<span style="line-height:1.8;">还定义了例如以下公共方法：</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">//<span style="line-height:1.8;">推断一个</span><span style="line-height:1.8;font-family:'times new roman';">item</span><span style="line-height:1.8;">是否被选中</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span></p> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <div class="syntaxhighlighter js" style="font-size:1em;"> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
      <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
       <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
        <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;color:rgb(175,175,175);"> 
         <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;">
          1
         </div> </td> 
        <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;"> 
         <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
          <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;">
           <code class="js plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;color:rgb(0,0,0);">public boolean isItemChecked(int position);</code>
          </div> 
         </div> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span><span style="line-height:1.8;font-family:'宋体';">//<span style="line-height:1.8;">获得被选中</span><span style="line-height:1.8;font-family:'times new roman';">item</span><span style="line-height:1.8;">的总数</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span></p> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <div class="syntaxhighlighter js" style="font-size:1em;"> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
      <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
       <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
        <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;color:rgb(175,175,175);"> 
         <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;">
          1
         </div> </td> 
        <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;"> 
         <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
          <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;">
           <code class="js plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;color:rgb(0,0,0);">public int getCheckedItemCount();</code>
          </div> 
         </div> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span><span style="line-height:1.8;font-family:'宋体';">//<span style="line-height:1.8;">选中一个</span><span style="line-height:1.8;font-family:'times new roman';">item</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span></p> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <div class="syntaxhighlighter js" style="font-size:1em;"> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
      <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
       <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
        <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;color:rgb(175,175,175);"> 
         <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;">
          1
         </div> </td> 
        <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;"> 
         <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
          <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;">
           <code class="js plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;color:rgb(0,0,0);">public void setItemChecked(int position, boolean value);</code>
          </div> 
         </div> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"></span><span style="line-height:1.8;font-family:'宋体';">//<span style="line-height:1.8;">清除选中的</span><span style="line-height:1.8;font-family:'times new roman';">item</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';"><span style="line-height:1.8;font-family:'times new roman';"></span></span></p> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <div class="syntaxhighlighter js" style="font-size:1em;"> 
     <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:12px;">
      <tbody style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
       <tr style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;">
        <td class="gutter" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;width:35px;color:rgb(175,175,175);"> 
         <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border-width:0px 2px 0px 0px;border-right-style:solid;border-right-color:rgb(108,226,108);line-height:1.8em;text-align:right;vertical-align:baseline;">
          1
         </div> </td> 
        <td class="code" style="border:1px solid #C0C0C0;border-collapse:collapse;background:none;line-height:1.1em;vertical-align:baseline;"> 
         <div style="background:none;border:0px;line-height:1.1em;vertical-align:baseline;"> 
          <div class="line number1 index0 alt2" style="background:rgb(244,244,244) none;border:0px;line-height:1.8em;vertical-align:baseline;">
           <code class="js plain" style="background:none;border:0px;line-height:1.8em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;color:rgb(0,0,0);">public void clearChoices();</code>
          </div> 
         </div> </td> 
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <span style="line-height:1.8;color:rgb(51,51,51);font-size:14px;font-family:'宋体';"><span style="line-height:1.8;font-family:'times new roman';"></span></span>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">当点击一个item的时候absListView中会调用performItemClick，假设是CHOICE_MODE_MULTIPLE。则该item点击一次。mCheckStates中对应位置的状态变更一次。然后我们就能够通过listView的getCheckedItemCount()方法获取选择了多少个；isItemChecked(int position)方法推断一个item是不是被选中。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">有了这些原生sdk的支持，难道还有什么多选操作是不能实现的吗？所以是不是应该考虑放弃第一节中描写叙述的那种方法了呢？遗憾的是非常多android开发人员即使是用了CHOICE_MODE_MULTIPLE，仍然没有去利用这些ListView自带的功能。预计是根本不知道该CHOICE_MODE_MULTIPLE的 特性吧，这事实上也是android程序猿与ios程序猿真正存在差距的地方。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">CHOICE_MODE_MULTIPLE<strong>实战</strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><br></strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">先看看效果图</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20141106142536921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmdoZWppZTEyMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:0px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <pre><code class="language-html">package com.example.listmultichoise;
import android.os.Bundle;
import android.app.ActionBar;
import android.app.Activity;
import android.util.Log;
import android.view.ActionMode;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.Window;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
public class ChoiceModeMultipleActivity extends Activity {
    ListView mListView = null;
    MyListAdapter mAdapter;
    private View mMultiSelectActionBarView;
    private TextView mSelectedCount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        getWindow().requestFeature(Window.FEATURE_ACTION_BAR);
        setContentView(R.layout.activity_list);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        mListView = (ListView)findViewById(R.id.list);
        mAdapter = new MyListAdapter(this,mListView);
        mListView.setAdapter(mAdapter);
        mListView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE);
        mListView.setOnItemClickListener(new OnItemClickListener() {
            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position,
                    long id) {
                mAdapter.notifyDataSetChanged();
                updateSeletedCount();
            }
        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        if (mMultiSelectActionBarView == null) {
            mMultiSelectActionBarView = LayoutInflater.from(ChoiceModeMultipleActivity.this)
                .inflate(R.layout.list_multi_select_actionbar, null);
            mSelectedCount =
                (TextView)mMultiSelectActionBarView.findViewById(R.id.selected_conv_count);
        }
        getActionBar().setDisplayOptions(ActionBar.DISPLAY_SHOW_CUSTOM,
                ActionBar.DISPLAY_SHOW_CUSTOM | ActionBar.DISPLAY_SHOW_HOME |
                ActionBar.DISPLAY_SHOW_TITLE);
        getActionBar().setCustomView(mMultiSelectActionBarView);
        ((TextView)mMultiSelectActionBarView.findViewById(R.id.title)).setText(R.string.select_item);
    }
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        getMenuInflater().inflate(R.menu.multi_select_menu, menu);
        return true;
    }
    @Override
    public boolean onPrepareOptionsMenu(Menu menu) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        MenuItem mItem = menu.findItem(R.id.action_slelect);
        if(mListView.getCheckedItemCount() == mAdapter.getCount()){
            mItem.setTitle(R.string.action_deselect_all);
        }else{
            mItem.setTitle(R.string.action_select_all);
        } 
        return super.onPrepareOptionsMenu(menu);
    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        switch (item.getItemId()) {
        case R.id.action_slelect:
            if(mListView.getCheckedItemCount() == mAdapter.getCount()){
                unSelectedAll();
            }else{
                selectedAll();
            }
            mAdapter.notifyDataSetChanged();
            break;
        default:
            break;
        }
        return super.onOptionsItemSelected(item);
    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    public void selectedAll(){
        for(int i= 0; i&lt; mAdapter.getCount(); i++){
            mListView.setItemChecked(i, true);
        }
        updateSeletedCount();
    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    public void unSelectedAll(){
        mListView.clearChoices();
        updateSeletedCount();
    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    public void updateSeletedCount(){
        mSelectedCount.setText(Integer.toString(mListView.getCheckedItemCount()));
    }
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>代码解释：</strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><br></strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">首先设置ListView模式：</p> 
   <pre><code class="language-html">mListView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE);</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">定义一个adapter，当ListView的某个item被选中之后，将该Item的背景设置为蓝色，以标记为选中。不然尽管ListView知道该item被选中，可是界面上没表现出来。</span>
   <pre><code class="language-html">......
    public View getView(int position, View convertView, ViewGroup parent) {
        TextView tv;
        if (convertView == null) {
            tv = (TextView) LayoutInflater.from(mContext).inflate(
                    android.R.layout.simple_expandable_list_item_1, parent,
                    false);
        } else {
            tv = (TextView) convertView;
        }
        tv.setText(mStrings[position]);
        updateBackground(position , tv);
        return tv;
    }
    @SuppressLint("NewApi")
    public void updateBackground(int position, View view) {
        int backgroundId;
        if (mListView.isItemChecked(position)) {
            backgroundId = R.drawable.list_selected_holo_light;
        } else {
            backgroundId = R.drawable.conversation_item_background_read;
        }
        Drawable background = mContext.getResources().getDrawable(backgroundId);
        view.setBackground(background);
    }
......</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">在item每被点击一次中通知adapter，这样做的目的是为了让更新Ui以显示最新的选中状态。</span>
   <pre><code class="language-html">mListView.setOnItemClickListener(new OnItemClickListener() {
    public void onItemClick(AdapterView&lt;?
</code></pre> 
   <p></p> 
   <p>&gt; parent, View view, int position, long id) { mAdapter.notifyDataSetChanged(); updateSeletedCount(); } });</p> 
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">当中mSelectedCount()作用是在actionbar中更新选中的数目。</span>
   <pre><code class="language-html">public void updateSeletedCount(){
       mSelectedCount.setText(Integer.toString(mListView.getCheckedItemCount()));
   }</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">上面的代码实现了多选操作，可是在我选中一个item的时候，listView的onItemClick也同一时候触发。而一个ListView点击item的兴许操作通常是切换到另外一个界面，所以实际应用中，我们还须要设置一个标志位，用来差别当前是多选状态还是普通状态 。假设是多选状态，调用ListView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE); &nbsp;假设是普通状态调用mListView.setChoiceMode(ListView.CHOICE_MODE_NONE);<span style="line-height:1.8;color:rgb(255,0,0);">CHOICE_MODE_MULTIPLE模式的特点在于他本身没有排斥性，在能选择item的情况下，也能够响应普通点击事件</span>。为了解决问题 ，在android3.0之后添加了CHOICE_MODE_MULTIPLE_MODAL模式。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"> <span style="line-height:1.8;font-family:'宋体';font-size:21px;">二、使用<span style="line-height:1.8;font-family:'times new roman';">ListViiew</span><span style="line-height:1.8;">的</span></span><span style="line-height:1.8;font-family:'宋体';font-size:21px;">CHOICE_MODE_MULTIPLE</span><span style="line-height:1.8;font-family:'宋体';font-size:21px;">模式</span> </h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;color:rgb(255,0,0);">CHOICE_MODE_MULTIPLE_MODAL和CHOICE_MODE_MULTIPLE恰恰相反。他是对普通点击操作和多选操作是排斥的，<strong>一旦有一个item被选中。即进入到多选状态</strong>，item的onclick事件被屏蔽。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">这样的排斥性也是他比CHOICE_MODE_MULTIPLE多了个MODAL的原因。此外CHOICE_MODE_MULTIPLE_MODAL还结合了android3.0的actionmode，当进入多选状态，actionbar的位置会显示新的菜单。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">我们来看看CHOICE_MODE_MULTIPLE_MODAL模式的实现原理：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>怎样实现两种状态的相互排斥：</strong>当点击一个item的时候absListView中会调用performItemClick，假设是CHOICE_MODE_MULTIPLE。则该item点击一次，mCheckStates中对应位置的状态变更一次。可是CHOICE_MODE_MULTIPLE_MODAL模式不同，必需要mChoiceActionMode!= null</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">的情况下，才会去变更mCheckStates中对应位置的状态。不光如此。假设mChoiceActionMode!= null</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">。他还会阻挡ItemClick事件的继续传播，从而屏蔽了ListView OnItemClickListener的onItemClick方法。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>怎样启用actionmode：</strong>一般我们使用actionmode都是在activity中调用startActionMode，可是假设你要使用ListView的CHOICE_MODE_MULTIPLE_MODAL，请不要这么做。 在absListView中有一个变量mChoiceActionMode。定义例如以下：</p> 
   <pre><code class="language-html">ActionMode mChoiceActionMode;</code></pre> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">当长按item 或者是调用主动调用setItemChecked方法mChoiceActionMode将被实例化，而假设你是在activity中调用startActionMode，那么尽管actionbar上的菜单变化了，ListView 中的mChoiceActionMode却没有实例化。刚刚我们谈到mChoiceActionMode==null 表示未进入到多选状态，所以这时你点击一个item事实上还是普通的点击行为。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">因此在CHOICE_MODE_MULTIPLE_MODAL模式下要启用多选操作。仅仅有两种办法：</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">（1）长按当长按item 。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">(2)主动调用ListView的setItemChecked(int position, boolean value)方法选中一个item。</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">可是这两种进入多选状态的方法都有一个弊端，那就是进入多选状态之后，总是有一个item是被选中的， 方法（1）中长按item。被按的item被选中，这样的结果是合理的能够接受的，可是假设你想主动进入多选状态（比方我在点击actionbar的某个菜单的时候想进入多选状态），就必须採用方法（2）：调用setItemChecked，这就出现个问题。你该让哪个item被选中呢？貌似最合理的该是一个都不选中吧，我仅仅是进入到这个状态，还没有開始选呢。幸运的是，我们能够使用一些技巧，实现能主动进入多选状态。且没有一个item被选中。</p> 
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">思路是我们先让第一个item被选中。这样Listview就进入多选状态。然后我们再清除被选中item的状态，代码例如以下：</span>
   <pre><code class="language-html">if(item.getItemId() == R.id.action_choice){
     mListView.setItemChecked(0,true);
     mListView.clearChoices();
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">有些人可能会问。依照上面的思路。为什么不这样实现呢：</span>
   <pre><code class="language-html">if(item.getItemId() == R.id.action_choice){
                                                                                                                                                                                                                                                                                                                                                                  
     mListView.setItemChecked(0,true);
     mListView.setItemChecked(0,false);
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">嘿嘿，刚刚我们提到ListView CHOICE_MODE_MULTIPLE_MODAL模式中，</span>
   <span style="line-height:1.8;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;color:rgb(255,0,0);"><strong>一旦有一个item被选中，即进入到多选状态</strong></span>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">，而他还有个相反的特性，一旦全部的Item被主动的设置为未选中，则退出多选状态,mChoiceActionMode会调用自己的finish()方法。为什么呢？在MultiChoiceModeWrapper类中：</span>
   <pre><code class="language-html">@Override
public void onItemCheckedStateChanged(ActionMode mode,
        int position, long id, boolean checked) {
    mWrapped.onItemCheckedStateChanged(mode, position, id, checked);
    // If there are no items selected we no longer need the selection mode.
    if (getCheckedItemCount() == 0) {
        mode.finish();
    }
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">好了我们来实现一个CHOICE_MODE_MULTIPLE_MODAL模式下的多选操作：</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <img src="https://uzshare.com/_p?https://img-blog.csdn.net/20141106143014218?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamlhbmdoZWppZTEyMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:0px;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">代码：</p> 
   <pre><code class="language-html">package com.example.listmultichoise;
import android.os.Bundle;
import android.app.Activity;
import android.util.Log;
import android.view.ActionMode;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
public class ChoiceModeMultipleModalActivity extends Activity {
    ListView mListView = null;
    MyListAdapter mAdapter;
    ModeCallback mCallback;
                                                                                                                 
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_list);
                                                                                                                     
        mListView = (ListView)findViewById(R.id.list);
        mAdapter = new MyListAdapter(this,mListView);
        mListView.setAdapter(mAdapter);
                                                                                                                     
        mCallback = new ModeCallback();
        mListView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL); 
        mListView.setMultiChoiceModeListener(mCallback);
        mListView.setOnItemClickListener(new OnItemClickListener() {
            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position,
                    long id) {
                   Toast.makeText(ChoiceModeMultipleModalActivity.this, "选择了一个item", 300).show();
            }
        });
    }
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main, menu);
        return true;
    }
    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        if(item.getItemId() == R.id.action_choice){
            //这里使用了一点技巧来实现处于选中状态 可是0个item 被选择
            mListView.setItemChecked(0,true);
            mListView.clearChoices();
            mCallback.updateSeletedCount();
        }
        return super.onOptionsItemSelected(item);
    }
                                                                                                                 
    private class ModeCallback implements ListView.MultiChoiceModeListener {
        private View mMultiSelectActionBarView;
        private TextView mSelectedCount;
        @Override
        public boolean onCreateActionMode(ActionMode mode, Menu menu) {
            // actionmode的菜单处理
            MenuInflater inflater = getMenuInflater();
            inflater.inflate(R.menu.multi_select_menu, menu);
            if (mMultiSelectActionBarView == null) {
                mMultiSelectActionBarView = LayoutInflater.from(ChoiceModeMultipleModalActivity.this)
                    .inflate(R.layout.list_multi_select_actionbar, null);
                mSelectedCount =
                    (TextView)mMultiSelectActionBarView.findViewById(R.id.selected_conv_count);
            }
            mode.setCustomView(mMultiSelectActionBarView);
            ((TextView)mMultiSelectActionBarView.findViewById(R.id.title)).setText(R.string.select_item);
            return true;
        }
        @Override
        public boolean onPrepareActionMode(ActionMode mode, Menu menu) {
            if (mMultiSelectActionBarView == null) {
                ViewGroup v = (ViewGroup)LayoutInflater.from(ChoiceModeMultipleModalActivity.this)
                    .inflate(R.layout.list_multi_select_actionbar, null);
                mode.setCustomView(v);
                mSelectedCount = (TextView)v.findViewById(R.id.selected_conv_count);
            }          
            //更新菜单的状态
            MenuItem mItem = menu.findItem(R.id.action_slelect);
            if(mListView.getCheckedItemCount() == mAdapter.getCount()){
                mItem.setTitle(R.string.action_deselect_all);
            }else{
                mItem.setTitle(R.string.action_select_all);
            }
            return true;
        }
        @Override
        public boolean onActionItemClicked(ActionMode mode, MenuItem item) {
            switch (item.getItemId()) {
                case R.id.action_slelect:
                    if(mListView.getCheckedItemCount() == mAdapter.getCount()){
                        unSelectedAll();
                    }else{
                        selectedAll();
                    }
                    mAdapter.notifyDataSetChanged();
                    break;
                default:
                    break;
            }
            return true;
        }
        @Override
        public void onDestroyActionMode(ActionMode mode) {
            mListView.clearChoices();
        }
        @Override
        public void onItemCheckedStateChanged(ActionMode mode,
                int position, long id, boolean checked) {
            updateSeletedCount();
            mode.invalidate();
            mAdapter.notifyDataSetChanged();
        }
                                                                                                                     
        public void updateSeletedCount(){
            mSelectedCount.setText(Integer.toString(mListView.getCheckedItemCount()));
        }
    }
    public void selectedAll(){
        for(int i= 0; i&lt; mAdapter.getCount(); i++){
            mListView.setItemChecked(i, true);
        }
        mCallback.updateSeletedCount();
    }
                                                                                                                 
    public void unSelectedAll(){
        mListView.clearChoices();
        mListView.setItemChecked(0,false);
        mCallback.updateSeletedCount();
    }
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">这里须要提醒的是尽管ListView的mActionMode我们不能直接操作，可是actionmode的回调方法是能够在activity中设置的：</span>
   <pre><code class="language-html">mListView.setMultiChoiceModeListener(mCallback);</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">并且这个回调方法比一般的actionmode回调方法多了个onItemCheckedStateChanged</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <pre><code class="language-html">@Override
public void onItemCheckedStateChanged(ActionMode mode,
        int position, long id, boolean checked) {
    ....
}</code></pre> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">demo我已经上传到了csdn：</span>
   <a href="http://download.csdn.net/detail/jianghejie123/8126071" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">http://download.csdn.net/detail/jianghejie123/8126071</a>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;">版权声明：本文博客原创文章。博客，未经同意，不得转载。</p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p><font color="#333333"><span style="font-size:12px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/4747628.html，如需转载请自行联系原作者</span></font></p> 
    <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
