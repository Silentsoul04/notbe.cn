<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Oracle 数据库日常巡检 « NotBeCN</title>
  <meta name="description" content="                  1. 检查数据库基本状况     包含：检查Oracle实例状态，检查Oracle服务进程，检查Oracle监听进程，共三个部分。     1.1. 检查Oracle实例状态          select instance_name,host_name,startup_tim...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/22/weixin_34015860_90126654.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Oracle 数据库日常巡检</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">1. 检查数据库基本状况</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">包含：检查Oracle实例状态，检查Oracle服务进程，检查Oracle监听进程，共三个部分。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">1.1. 检查Oracle实例状态</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> instance_name,<span style="line-height:1.8;color:rgb(255,0,255);">host_name</span>,startup_time,status,database_status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$instance;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">其中“STATUS”表示Oracle当前的实例状态，必须为“OPEN”；“DATABASE_STATUS”表示Oracle当前数据库的状态，必须为“ACTIVE”。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">1.2. 检查Oracle在线日志状态</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(0,0,255);">group</span>#,status,type,member <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$logfile;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">输出结果应该有3条以上（包含3条）记录，“STATUS”应该为非“INVALID”，非“DELETED”。注：“STATUS”显示为空表示正常。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">1.3. 检查Oracle表空间的状态</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name,status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> dba_tablespaces;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">输出结果中STATUS应该都为ONLINE。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">1.4. 检查Oracle所有数据文件状态</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> name,status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$datafile;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">输出结果中“STATUS”应该都为“ONLINE”。或者：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(255,0,255);">file_name</span>,status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> dba_data_files;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">输出结果中“STATUS”应该都为“AVAILABLE”。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">1.5. 检查无效对象</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> owner,<span style="line-height:1.8;color:rgb(255,0,255);">object_name</span>,object_type <span style="line-height:1.8;color:rgb(0,0,255);">from</span> dba_objects <span style="line-height:1.8;color:rgb(0,0,255);">where</span> status<span style="line-height:1.8;color:rgb(128,128,128);">!=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">VALID</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span> <span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner<span style="line-height:1.8;color:rgb(128,128,128);">!=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYS</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span> <span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner<span style="line-height:1.8;color:rgb(128,128,128);">!=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果有记录返回，则说明存在无效对象。若这些对象与应用相关，那么需要重新编译生成这个对象，或者：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> owner, <span style="line-height:1.8;color:rgb(255,0,255);">object_name</span>, object_type <span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> dba_objects <span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> status<span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">INVALID</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">1.6. 检查所有回滚段状态</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> segment_name,status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> dba_rollback_segs;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">输出结果中所有回滚段的“STATUS”应该为“ONLINE”。</span></p> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label1" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">2. 检查Oracle相关资源的使用情况</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">包含：</span><br><span style="line-height:1.8;font-size:15px;">a.检查Oracle初始化文件中相关的参数值</span><br><span style="line-height:1.8;font-size:15px;">b.检查数据库连接情况，检查系统磁盘空间</span><br><span style="line-height:1.8;font-size:15px;">c.检查Oracle各个表空间使用情况，检查一些扩展异常的对象，</span><br><span style="line-height:1.8;font-size:15px;">d.检查system表空间内的内容，检查对象的下一扩展与表空间的最大扩展值，总共七个部分。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.1. 检查Oracle初始化文件中相关参数值</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> resource_name,
max_utilization,
initial_allocation, 
limit_value
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$resource_limit;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">若LIMIT_VALU-MAX_UTILIZATION&lt;=5，则表明与RESOURCE_NAME相关的Oracle初始化参数需要调整。可以通过修改Oracle初始化参数文件$ORACLE_BASE/admin/CKDB/pfile/initORCL.ora来修改。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.2. 检查数据库连接情况</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">查看当前会话连接数，是否属于正常范围。</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(255,0,255);">count</span>(<span style="line-height:1.8;color:rgb(128,128,128);">*</span>) <span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> v$session;

</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span> sid,serial#,username,program,machine,status <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$session;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">其中：SID 会话(session)的ID号；</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">SERIAL# 会话的序列号，和SID一起用来唯一标识一个会话；</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">USERNAME 建立该会话的用户名；</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">PROGRAM 这个会话是用什么工具连接到数据库的；</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">STATUS 当前这个会话的状态，ACTIVE表示会话正在执行某些任务，INACTIVE表示当前会话没有执行任何操作；</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">如果建立了过多的连接，会消耗数据库的资源，同时，对一些“挂死”的连接可能需要手工进行清理。如果DBA要手工断开某个会话，则执行：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">（一般不建议使用这种方式去杀掉数据库的连接，这样有时候session不会断开。容易引起死连接。建议通过sid查到操作系统的spid,使用ps –ef|grep spidno的方式确认spid不是ORACLE的后台进程。使用操作系统的kill -9命令杀掉连接）</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">alter system kill session 'SID,SERIAL#';</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">注意：上例中SID为1到10(USERNAME列为空)的会话，是Oracle的后台进程，不要对这些会话进行任何操作。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.3. 检查系统磁盘空间</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">如果文件系统的剩余空间过小或增长较快，需对其进行确认并删除不用的文件以释放空间。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">[oracle@AS14 ~]$ df -h</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Filesystem Size Used Avail Use% Mounted on</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">/dev/sda5 9.7G 3.9G 5.4G 42% /</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">/dev/sda1 479M 16M 438M 4% /boot</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">/dev/sda2 49G 19G 28G 41% /data</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">none 1014M 0 1014M 0% /dev/shm</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.4. 检查表空间使用情况</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> f.tablespace_name,
a.total,
f.free,
</span><span style="line-height:1.8;color:rgb(255,0,255);">round</span>((f.free <span style="line-height:1.8;color:rgb(128,128,128);">/</span> a.total) <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span>) "<span style="line-height:1.8;color:rgb(128,128,128);">%</span><span style="line-height:1.8;"> Free"
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span> (<span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">sum</span>(bytes <span style="line-height:1.8;color:rgb(128,128,128);">/</span> (<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1024</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1024</span><span style="line-height:1.8;">)) total
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_data_files
</span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) a, 
(</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">round</span>(<span style="line-height:1.8;color:rgb(255,0,255);">sum</span>(bytes <span style="line-height:1.8;color:rgb(128,128,128);">/</span> (<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1024</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1024</span><span style="line-height:1.8;">))) free
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_free_space
</span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) f
</span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> a.tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> f.tablespace_name(<span style="line-height:1.8;color:rgb(128,128,128);">+</span><span style="line-height:1.8;">)
</span><span style="line-height:1.8;color:rgb(0,0,255);">order</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span> "<span style="line-height:1.8;color:rgb(128,128,128);">%</span> Free";</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果空闲率%Free小于10%以上（包含10%），则注意要增加数据文件来扩展表空间而不要是用数据文件的自动扩展功能。请不要对表空间增加过多的数据文件，增加数据文件的原则是每个数据文件大小为2G或者4G，自动扩展的最大限制在8G。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.5. 检查一些扩展异常的对象</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> Segment_Name,
Segment_Type,
TableSpace_Name, 
(Extents </span><span style="line-height:1.8;color:rgb(128,128,128);">/</span> Max_extents) <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span> <span style="line-height:1.8;color:rgb(0,0,255);">Percent</span>
<span style="line-height:1.8;color:rgb(0,0,255);">From</span><span style="line-height:1.8;"> sys.DBA_Segments
</span><span style="line-height:1.8;color:rgb(0,0,255);">Where</span> Max_Extents <span style="line-height:1.8;color:rgb(128,128,128);">!=</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">0</span>
<span style="line-height:1.8;color:rgb(128,128,128);">and</span> (Extents <span style="line-height:1.8;color:rgb(128,128,128);">/</span> Max_extents) <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span> <span style="line-height:1.8;color:rgb(128,128,128);">&gt;=</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">95</span>
<span style="line-height:1.8;color:rgb(0,0,255);">order</span> <span style="line-height:1.8;color:rgb(0,0,255);">By</span> <span style="line-height:1.8;color:rgb(0,0,255);">Percent</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果有记录返回，则这些对象的扩展已经快达到它定义时的最大扩展值。对于这些对象要修改它的存储结构参数。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.6. 检查system表空间内的内容</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(0,0,255);">distinct</span><span style="line-height:1.8;"> (owner)
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_tables
</span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">!=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYS</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">!=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(0,0,255);">union</span>
<span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(0,0,255);">distinct</span><span style="line-height:1.8;"> (owner)
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_indexes
</span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">!=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYS</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(128,128,128);">and</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">!=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果记录返回，则表明system表空间内存在一些非system和sys用户的对象。应该进一步检查这些对象是否与我们应用相关。如果相关请把这些对象移到非System表空间，同时应该检查这些对象属主的缺省表空间值。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">2.7. 检查对象的下一扩展与表空间的最大扩展值</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> a.table_name, a.next_extent, a.tablespace_name
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> all_tables a, 
(</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">max</span>(bytes) <span style="line-height:1.8;color:rgb(0,0,255);">as</span><span style="line-height:1.8;"> big_chunk 
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_free_space 
</span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) f
</span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> f.tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;"> a.tablespace_name 
</span><span style="line-height:1.8;color:rgb(128,128,128);">and</span> a.next_extent <span style="line-height:1.8;color:rgb(128,128,128);">&gt;</span><span style="line-height:1.8;"> f.big_chunk
</span><span style="line-height:1.8;color:rgb(0,0,255);">union</span>
<span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> a.index_name, a.next_extent, a.tablespace_name
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> all_indexes a, 
(</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">max</span>(bytes) <span style="line-height:1.8;color:rgb(0,0,255);">as</span><span style="line-height:1.8;"> big_chunk 
</span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_free_space 
</span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) f
</span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> f.tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;"> a.tablespace_name 
</span><span style="line-height:1.8;color:rgb(128,128,128);">and</span> a.next_extent <span style="line-height:1.8;color:rgb(128,128,128);">&gt;</span> f.big_chunk;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果有记录返回，则表明这些对象的下一个扩展大于该对象所属表空间的最大扩展值，需调整相应表空间的存储参数。</span></p> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label2" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">3. 检查Oracle数据库备份结果</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">包含：</span><br><span style="line-height:1.8;font-size:15px;">a.检查数据库备份日志信息;</span><br><span style="line-height:1.8;font-size:15px;">b.检查backup卷中文件产生的时间;</span><br><span style="line-height:1.8;font-size:15px;">c.检查oracle用户的email</span><br><span style="line-height:1.8;font-size:15px;">3.1. 检查数据库备份日志信息</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">假设：备份的临时目录为/backup/hotbakup，我们需要检查2009年7月22日的备份结果，则用下面的命令来检查：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">cat /backup/hotbackup/hotbackup-09-7-22.log|grep –i error</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">备份脚本的日志文件为hotbackup-月份-日期-年份.log，在备份的临时目录下面。如果文件中存在“ERROR:”，则表明备份没有成功，存在问题需要检查。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">3.2. 检查backup卷中文件产生的时间</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">#ls –lt /backup/hotbackup</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">backup卷是备份的临时目录，查看输出结果中文件的日期，都应当是在当天凌晨由热备份脚本产生的。如果时间不对则表明热备份脚本没执行成功。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">3.3. 检查oracle用户的email</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">#tail –n 300 /var/mail/oracle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">热备份脚本是通过Oracle用户的cron去执行的。cron执行完后操作系统就会发一条Email通知Oracle用户任务已经完成。查看Oracle email中今天凌晨部分有无ORA-，Error，Failed等出错信息，如果有则表明备份不正常。</span></p> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label3" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">4. 检查Oracle数据库性能</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">在本节主要检查Oracle数据库性能情况，包含：检查数据库的等待事件，检查死锁及处理，检查cpu、I/O、内存性能，查看是否有僵死进程，检查行链接/迁移，定期做统计分析，检查缓冲区命中率，检查共享池命中率，检查排序区，检查日志缓冲区，总共十个部分。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">4.1. 检查数据库的等待事件</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">set</span> pages <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">80</span>

<span style="line-height:1.8;color:rgb(0,0,255);">set</span> lines <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">120</span><span style="line-height:1.8;">

col event </span><span style="line-height:1.8;color:rgb(0,0,255);">for</span><span style="line-height:1.8;"> a40

</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> sid, event, p1, p2, p3, WAIT_TIME, SECONDS_IN_WAIT
  </span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> v$session_wait
 </span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> event <span style="line-height:1.8;color:rgb(128,128,128);">not</span> <span style="line-height:1.8;color:rgb(128,128,128);">like</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SQL%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">and</span> event <span style="line-height:1.8;color:rgb(128,128,128);">not</span> <span style="line-height:1.8;color:rgb(128,128,128);">like</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">rdbms%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果数据库长时间持续出现大量像latch free，enqueue，buffer busy waits，db file sequential read，db file scattered read等等待事件时，需要对其进行分析，可能存在问题的语句。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">4.2. Disk Read最高的SQL语句的获取</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> SQL_TEXT
</span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> (<span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> V$SQLAREA <span style="line-height:1.8;color:rgb(0,0,255);">ORDER</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span><span style="line-height:1.8;"> DISK_READS)
</span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> ROWNUM <span style="line-height:1.8;color:rgb(128,128,128);">&lt;=</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">5</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.3. 查找前十条性能差的sql</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span>
<span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> (<span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> PARSING_USER_ID 
EXECUTIONS,
SORTS,
COMMAND_TYPE,
DISK_READS, 
SQL_TEXT
</span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> V$SQLAREA
</span><span style="line-height:1.8;color:rgb(0,0,255);">ORDER</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span> DISK_READS <span style="line-height:1.8;color:rgb(0,0,255);">DESC</span><span style="line-height:1.8;">)
</span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> ROWNUM <span style="line-height:1.8;color:rgb(128,128,128);">&lt;</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">10</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.4. 等待时间最多的5个系统等待事件的获取</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span>
  <span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> (<span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span>
          <span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> V$SYSTEM_EVENT
         </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> EVENT <span style="line-height:1.8;color:rgb(128,128,128);">NOT</span> <span style="line-height:1.8;color:rgb(128,128,128);">LIKE</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SQL%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
         <span style="line-height:1.8;color:rgb(0,0,255);">ORDER</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span> TOTAL_WAITS <span style="line-height:1.8;color:rgb(0,0,255);">DESC</span><span style="line-height:1.8;">)
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> ROWNUM <span style="line-height:1.8;color:rgb(128,128,128);">&lt;=</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">5</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.5. 检查运行很久的SQL</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span><span style="line-height:1.8;"> USERNAME FORMAT A12

</span><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span><span style="line-height:1.8;"> OPNAME FORMAT A16

</span><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span><span style="line-height:1.8;"> PROGRESS FORMAT A8

</span><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> USERNAME,
       SID,
       OPNAME,
       </span><span style="line-height:1.8;color:rgb(255,0,255);">ROUND</span>(SOFAR <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span> <span style="line-height:1.8;color:rgb(128,128,128);">/</span> TOTALWORK, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">0</span>) <span style="line-height:1.8;color:rgb(128,128,128);">||</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span> <span style="line-height:1.8;color:rgb(0,0,255);">AS</span><span style="line-height:1.8;"> PROGRESS,
       TIME_REMAINING,
       SQL_TEXT
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> V$SESSION_LONGOPS, V$SQL
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> TIME_REMAINING <span style="line-height:1.8;color:rgb(128,128,128);">&lt;&gt;</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">0</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">AND</span> SQL_ADDRESS <span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;"> ADDRESS
   </span><span style="line-height:1.8;color:rgb(128,128,128);">AND</span> SQL_HASH_VALUE <span style="line-height:1.8;color:rgb(128,128,128);">=</span> HASH_VALUE;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.6. 检查消耗CPU最高的进程</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SET</span> LINE <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">240</span>

<span style="line-height:1.8;color:rgb(0,0,255);">SET</span> VERIFY <span style="line-height:1.8;color:rgb(0,0,255);">OFF</span>

<span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span> SID FORMAT <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">999</span>

<span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span> PID FORMAT <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">999</span>

<span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span> S_# FORMAT <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">999</span>

<span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span> USERNAME FORMAT A9 HEADING "ORA <span style="line-height:1.8;color:rgb(255,0,255);">USER</span><span style="line-height:1.8;">"

</span><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span><span style="line-height:1.8;"> PROGRAM FORMAT A29

</span><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span><span style="line-height:1.8;"> SQL FORMAT A60

</span><span style="line-height:1.8;color:rgb(0,0,255);">COLUMN</span> OSNAME FORMAT A9 HEADING "OS <span style="line-height:1.8;color:rgb(255,0,255);">USER</span><span style="line-height:1.8;">"

</span><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> P.PID PID,
       S.SID SID,
       P.SPID SPID,
       S.USERNAME USERNAME,
       S.OSUSER OSNAME,
       P.SERIAL# S_#,
       P.TERMINAL,
       P.PROGRAM PROGRAM,
       P.BACKGROUND,
       S.STATUS,
       </span><span style="line-height:1.8;color:rgb(255,0,255);">RTRIM</span>(SUBSTR(A.SQL_TEXT, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span>, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">80</span><span style="line-height:1.8;">)) SQLFROM V$PROCESS P,
       V$SESSION S,
       V$SQLAREA A </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> P.ADDR <span style="line-height:1.8;color:rgb(128,128,128);">=</span> S.PADDR <span style="line-height:1.8;color:rgb(128,128,128);">AND</span> S.SQL_ADDRESS <span style="line-height:1.8;color:rgb(128,128,128);">=</span> A.ADDRESS(<span style="line-height:1.8;color:rgb(128,128,128);">+</span>) <span style="line-height:1.8;color:rgb(128,128,128);">AND</span> P.SPID <span style="line-height:1.8;color:rgb(128,128,128);">LIKE</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">%&amp;1%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.7. 检查碎片程度高的表</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> segment_name table_name, <span style="line-height:1.8;color:rgb(255,0,255);">COUNT</span>(<span style="line-height:1.8;color:rgb(128,128,128);">*</span><span style="line-height:1.8;">) extents
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> dba_segments
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">NOT</span> <span style="line-height:1.8;color:rgb(128,128,128);">IN</span> (<span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYS</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>, <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSTEM</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;">)
 </span><span style="line-height:1.8;color:rgb(0,0,255);">GROUP</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span><span style="line-height:1.8;"> segment_name
</span><span style="line-height:1.8;color:rgb(0,0,255);">HAVING</span> <span style="line-height:1.8;color:rgb(255,0,255);">COUNT</span>(<span style="line-height:1.8;color:rgb(128,128,128);">*</span>) <span style="line-height:1.8;color:rgb(128,128,128);">=</span> (<span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> <span style="line-height:1.8;color:rgb(255,0,255);">MAX</span>(<span style="line-height:1.8;color:rgb(255,0,255);">COUNT</span>(<span style="line-height:1.8;color:rgb(128,128,128);">*</span><span style="line-height:1.8;">))
                     </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> dba_segments
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">GROUP</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span> segment_name);</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.8. 检查表空间的I/O比例</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> DF.TABLESPACE_NAME NAME,
       DF.</span><span style="line-height:1.8;color:rgb(255,0,255);">FILE_NAME</span>       "<span style="line-height:1.8;color:rgb(0,0,255);">FILE</span><span style="line-height:1.8;">",
       F.PHYRDS           PYR,
       F.PHYBLKRD         PBR,
       F.PHYWRTS          PYW,
       F.PHYBLKWRT        PBW
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> V$FILESTAT F, DBA_DATA_FILES DF
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> F.<span style="line-height:1.8;color:rgb(0,0,255);">FILE</span># <span style="line-height:1.8;color:rgb(128,128,128);">=</span> DF.<span style="line-height:1.8;color:rgb(255,0,255);">FILE_ID</span>
 <span style="line-height:1.8;color:rgb(0,0,255);">ORDER</span> <span style="line-height:1.8;color:rgb(0,0,255);">BY</span> DF.TABLESPACE_NAME;<span style="font-size:15px;line-height:1.8;">&nbsp;</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.9. 检查文件系统的I/O比例</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> SUBSTR(A.<span style="line-height:1.8;color:rgb(0,0,255);">FILE</span>#, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span>, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">2</span><span style="line-height:1.8;">) "#",
       SUBSTR(A.NAME, </span><span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span>, <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">30</span><span style="line-height:1.8;">) "NAME",
       A.STATUS,
       A.BYTES,
       B.PHYRDS,
       B.PHYWRTS
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> V$DATAFILE A, V$FILESTAT B
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> A.<span style="line-height:1.8;color:rgb(0,0,255);">FILE</span># <span style="line-height:1.8;color:rgb(128,128,128);">=</span> B.<span style="line-height:1.8;color:rgb(0,0,255);">FILE</span>#;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">4.10.检查死锁及处理</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">查询目前锁对象信息：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> sid,
       serial#,
       username,
       SCHEMANAME,
       osuser,
       MACHINE,     
       terminal,
       PROGRAM,
       owner,
       </span><span style="line-height:1.8;color:rgb(255,0,255);">object_name</span><span style="line-height:1.8;">,
       object_type,
       o.</span><span style="line-height:1.8;color:rgb(255,0,255);">object_id</span>
  <span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_objects o, v$locked_object l, v$session s
 </span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> o.<span style="line-height:1.8;color:rgb(255,0,255);">object_id</span> <span style="line-height:1.8;color:rgb(128,128,128);">=</span> l.<span style="line-height:1.8;color:rgb(255,0,255);">object_id</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">and</span> s.sid <span style="line-height:1.8;color:rgb(128,128,128);">=</span> l.session_id;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">oracle级kill掉该session：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> system <span style="line-height:1.8;color:rgb(0,0,255);">kill</span> session <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">&amp;sid,&amp;serial#</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">操作系统级kill掉session：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">#&gt;kill -9 pid</span></p> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label4" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">5. 检查数据库cpu、I/O、内存性能</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">记录数据库的cpu使用、IO、内存等使用情况，使用vmstat,iostat,sar,top等命令进行信息收集并检查这些信息，判断资源使用情况。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.1 CPU使用情况：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">[root@sale8 ~]# top</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">top - 10:29:35 up 73 days, 19:54, 1 user, load average: 0.37, 0.38, 0.29</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Tasks: 353 total, 2 running, 351 sleeping, 0 stopped, 0 zombie</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Cpu(s): 1.2% us, 0.1% sy, 0.0% ni,98.8% id, 0.0% wa, 0.0% hi, 0.0% si</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Mem: 16404472k total, 12887428k used, 3517044k free, 60796k buffers</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Swap: 8385920k total, 665576k used, 7720344k free, 10358384k cached</span></p> 
    <p><br><span style="line-height:1.8;font-size:15px;">PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">30495 oracle 15 0 8329m 866m 861m R 10 5.4 7:53.90 oracle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">32501 oracle 15 0 8328m 1.7g 1.7g S 2 10.6 1:58.38 oracle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">32503 oracle 15 0 8329m 1.6g 1.6g S 2 10.2 2:06.62 oracle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">注意上面的蓝色字体部分，此部分内容表示系统剩余的cpu，当其平均值下降至10%以下的时视为CPU使用率异常，需记录下该数值，并将状态记为异常。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.2 内存使用情况：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;"># free -m</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">total used free shared buffers cached</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Mem: 2026 1958 67 0 76 1556</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">-/+ buffers/cache: 326 1700</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Swap: 5992 92 5900</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">如上所示，蓝色部分表示系统总内存，红色部分表示系统使用的内存，黄色部分表示系统剩余内存，当剩余内存低于总内存的10%时视为异常。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.3 系统I/O情况：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;"># iostat -k 1 3</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Linux 2.6.9-22.ELsmp (AS14) 07/29/2009</span></p> 
    <p><br><span style="line-height:1.8;font-size:15px;">avg-cpu: %user %nice %sys%iowait %idle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">0.16 0.00 0.05 0.36 99.43</span></p> 
    <p><br><span style="line-height:1.8;font-size:15px;">Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">sda 3.33 13.16 50.25 94483478 360665804</span></p> 
    <p><br><span style="line-height:1.8;font-size:15px;">avg-cpu: %user %nice %sys%iowait %idle</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">0.00 0.00 0.00 0.00 100.00</span></p> 
    <p><br><span style="line-height:1.8;font-size:15px;">Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">sda 0.00 0.00 0.00 0 0</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">如上所示，蓝色字体部分表示磁盘读写情况，红色字体部分为cpu IO等待情况。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.4 系统负载情况：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">#uptime</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">12:08:37 up 162 days, 23:33, 15 users, load average: 0.01, 0.15, 0.10</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">如上所示，蓝体字部分表示系统负载，后面的3个数值如果有高于2.5的时候就表明系统在超负荷运转了，并将此值记录到巡检表，视为异常。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.5.查看是否有僵死进程</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> spid <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$process <span style="line-height:1.8;color:rgb(0,0,255);">where</span> addr <span style="line-height:1.8;color:rgb(128,128,128);">not</span> <span style="line-height:1.8;color:rgb(128,128,128);">in</span> (<span style="line-height:1.8;color:rgb(0,0,255);">select</span> paddr <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$session);<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">有些僵尸进程有阻塞其他业务的正常运行，定期杀掉僵尸进程。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.6.检查行链接/迁移</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> table_name, num_rows, chain_cnt
  </span><span style="line-height:1.8;color:rgb(0,0,255);">From</span><span style="line-height:1.8;"> dba_tables
 </span><span style="line-height:1.8;color:rgb(0,0,255);">Where</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">CTAIS2</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">And</span> chain_cnt <span style="line-height:1.8;color:rgb(128,128,128);">&lt;&gt;</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">0</span>;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">注：含有long raw列的表有行链接是正常的,找到迁移行保存到chained_rows表中,如没有该表执行../rdbms/admin/utlchain.sql</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre>analyze <span style="line-height:1.8;color:rgb(0,0,255);">table</span> tablename list chained rows;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">可通过表chained_rows中table_name,head_rowid看出哪些行是迁移行</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">create</span> <span style="line-height:1.8;color:rgb(0,0,255);">table</span> aa <span style="line-height:1.8;color:rgb(0,0,255);">as</span> <span style="line-height:1.8;color:rgb(0,0,255);">select</span> a.<span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(0,0,255);">from</span> sb_zsxx a,chained_rows b <span style="line-height:1.8;color:rgb(0,0,255);">where</span> a.rowid<span style="line-height:1.8;color:rgb(128,128,128);">=</span>b.head_rowid <span style="line-height:1.8;color:rgb(128,128,128);">and</span> b.table_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SB_ZSXX</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,0,255);">delete</span> <span style="line-height:1.8;color:rgb(0,0,255);">from</span> sb_zsxx <span style="line-height:1.8;color:rgb(0,0,255);">where</span> rowid <span style="line-height:1.8;color:rgb(128,128,128);">in</span> (<span style="line-height:1.8;color:rgb(0,0,255);">select</span> head_rowid <span style="line-height:1.8;color:rgb(0,0,255);">from</span> chained_rows <span style="line-height:1.8;color:rgb(0,0,255);">where</span> table_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SB_ZSXX</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,0,255);">insert</span> <span style="line-height:1.8;color:rgb(0,0,255);">into</span> sb_zsxx <span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(0,0,255);">from</span> chained_row <span style="line-height:1.8;color:rgb(0,0,255);">where</span> table_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SB_ZSXX</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">5.7 定期做统计分析</span><br><span style="line-height:1.8;font-size:15px;">对于采用Oracle Cost-Based-Optimizer的系统，需要定期对数据对象的统计信息进行采集更新，使优化器可以根据准备的信息作出正确的explain plan。在以下情况更需要进行统计信息的更新：</span><br><span style="line-height:1.8;font-size:15px;">a. 应用发生变化</span><br><span style="line-height:1.8;font-size:15px;">b. 大规模数据迁移、历史数据迁出、其他数据的导入等</span><br><span style="line-height:1.8;font-size:15px;">c .数据量发生变化</span><br><span style="line-height:1.8;font-size:15px;">查看表或索引的统计信息是否需更新，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">Select</span> table_name,num_rows,last_analyzed <span style="line-height:1.8;color:rgb(0,0,255);">From</span> user_tables <span style="line-height:1.8;color:rgb(0,0,255);">where</span> table_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">DJ_NSRXX</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
<span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(255,0,255);">count</span>(<span style="line-height:1.8;color:rgb(128,128,128);">*</span>) <span style="line-height:1.8;color:rgb(0,0,255);">from</span> DJ_NSRXX如num_rows和count(<span style="line-height:1.8;color:rgb(128,128,128);">*</span>)</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果行数相差很多,则该表需要更新统计信息，建议一周做一次统计信息收集，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">exec</span> sys.dbms_stats.gather_schema_stats(ownname<span style="line-height:1.8;color:rgb(128,128,128);">=&gt;</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">CTAIS2</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>,<span style="line-height:1.8;color:rgb(0,0,255);">cascade</span> <span style="line-height:1.8;color:rgb(128,128,128);">=&gt;</span> TRUE,degree <span style="line-height:1.8;color:rgb(128,128,128);">=&gt;</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">4</span>);</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">5.8 检查缓冲区命中率</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> a.VALUE <span style="line-height:1.8;color:rgb(128,128,128);">+</span><span style="line-height:1.8;"> b.VALUE logical_reads,
       c.VALUE phys_reads,
       </span><span style="line-height:1.8;color:rgb(255,0,255);">round</span>(<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span> <span style="line-height:1.8;color:rgb(128,128,128);">*</span> (<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span> <span style="line-height:1.8;color:rgb(128,128,128);">-</span> c.value <span style="line-height:1.8;color:rgb(128,128,128);">/</span> (a.value <span style="line-height:1.8;color:rgb(128,128,128);">+</span> b.value)), <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">4</span><span style="line-height:1.8;">) hit_ratio
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> v$sysstat a, v$sysstat b, v$sysstat c
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> a.NAME <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">db block gets</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">AND</span> b.NAME <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">consistent gets</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">AND</span> c.NAME <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">physical reads</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果命中率低于90%则需加大数据库参数db_cache_size。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.9 检查共享池命中率</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> <span style="line-height:1.8;color:rgb(255,0,255);">sum</span>(pinhits) <span style="line-height:1.8;color:rgb(128,128,128);">/</span> <span style="line-height:1.8;color:rgb(255,0,255);">sum</span>(pins) <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span> <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$librarycache;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如低于95%，则需要调整应用程序使用绑定变量，或者调整数据库参数shared pool的大小。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.10 检查排序区</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre> <span style="line-height:1.8;color:rgb(0,0,255);">select</span> name,value <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$sysstat <span style="line-height:1.8;color:rgb(0,0,255);">where</span> name <span style="line-height:1.8;color:rgb(128,128,128);">like</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">%sort%</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果disk/(memoty+row)的比例过高，则需要调整sort_area_size(workarea_size_policy=false)或pga_aggregate_target(workarea_size_policy=true)。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">5.11 检查日志缓冲区</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> name,value <span style="line-height:1.8;color:rgb(0,0,255);">from</span> v$sysstat <span style="line-height:1.8;color:rgb(0,0,255);">where</span> name <span style="line-height:1.8;color:rgb(128,128,128);">in</span> (<span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">redo entries</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>,<span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">redo buffer allocation retries</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>);</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如果redo buffer allocation retries/redo entries超过1%，则需要增大log_buffer。</span></p> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label5" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">6. 检查数据库安全性</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">在本节主要检查Oracle数据库的安全性，包含：检查系统安全信息，定期修改密码，总共两个部分。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">6.1. 检查系统安全日志信息</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">系统安全日志文件的目录在/var/log下，主要检查登录成功或失败的用户日志信息。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">检查登录成功的日志：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">[root@rac2 ~]# grep -i accepted /var/log/secure</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Jan 8 08:44:43 rac2 sshd[29559]: Accepted password for root from ::ffff:10.10.10.6 port 1119 ssh2……</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">检查登录失败的日志：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">[root@rac2 ~]# grep -i inval /var/log/secure &amp;&amp;grep -i failed /var/log/secure</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Jan 9 10:30:44 rac2 sshd[3071]: Invalid user ydbuser from ::ffff:192.168.3.5</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Jan 9 10:30:56 rac2 sshd[3071]: Failed password for invalid user ydbuser from ::ffff:192.168.3.5 port 36005 ssh2</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Jan 9 10:30:56 rac2 sshd[3071]: Failed password for invalid user ydbuser from ::ffff:192.168.3.5 port 36005 ssh2</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">Jan 10 22:44:38 rac2 sshd[21611]: Failed password for root from ::ffff:10.10.10.6 port 1723 ssh2</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">在出现的日志信息中没有错误(Invalid、refused)提示，如果没有(Invalid、refused)视为系统正常，出现错误提示，应作出系统告警通知。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">6.2. 检查用户修改密码</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">在数据库系统上往往存在很多的用户，如：第三方数据库监控系统，初始安装数据库时的演示用户，管理员用户等等，这些用户的密码往往是写定的，被很多人知道，会被别有用心的人利用来攻击系统甚至进行修改数据。需要修改密码的用户包括：</span><br><span style="line-height:1.8;font-size:15px;">数据库管理员用户SYS，SYSTEM；其他用户。</span><br><span style="line-height:1.8;font-size:15px;">登陆系统后，提示符下输入cat /etc/passwd，在列出来的用户中查看是否存在已经不再使用的或是陌生的帐号。若存在，则记录为异常。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">修改密码方法：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(255,0,255);">user</span> <span style="line-height:1.8;color:rgb(255,0,255);">USER_NAME</span> identified <span style="line-height:1.8;color:rgb(0,0,255);">by</span> PASSWORD;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p>&nbsp;</p> 
    <div style="text-align:right;"> 
     <a href="http://www.cnblogs.com/java-class/p/4979798.html#_labelTop" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">回到顶部</a>
     <a name="_label6" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"></a> 
    </div> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;"><span style="line-height:1.8;font-size:15px;">7. 其他检查</span></h3> 
    <p><span style="line-height:1.8;font-size:15px;">在本节主要检查当前crontab任务是否正常，检查Oracle Job是否有失败等共六个部分。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">7.1 检查当前crontab任务是否正常</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">[oracle@AS14 ~]$ crontab -l</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">7.2 Oracle Job是否有失败</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> job,what,last_date,next_date,failures,broken <span style="line-height:1.8;color:rgb(0,0,255);">from</span> dba_jobs <span style="line-height:1.8;color:rgb(0,0,255);">Where</span> schema_user<span style="line-height:1.8;color:rgb(128,128,128);">=</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">CAIKE</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如有问题建议重建job，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">exec</span> sys.dbms_job.remove(<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,0,255);">commit</span><span style="line-height:1.8;">;
</span><span style="line-height:1.8;color:rgb(0,0,255);">exec</span> sys.dbms_job.isubmit(<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span>,<span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">REFRESH_ALL_SNAPSHOT;</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>,SYSDATE<span style="line-height:1.8;color:rgb(128,128,128);">+</span><span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span><span style="line-height:1.8;color:rgb(128,128,128);">/</span><span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1440</span>,<span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">SYSDATE+4/1440</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;">);
</span><span style="line-height:1.8;color:rgb(0,0,255);">commit</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">7.3. 监控数据量的增长情况</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span> A.tablespace_name, (<span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">1</span> <span style="line-height:1.8;color:rgb(128,128,128);">-</span> (A.total) <span style="line-height:1.8;color:rgb(128,128,128);">/</span> B.total) <span style="line-height:1.8;color:rgb(128,128,128);">*</span> <span style="line-height:1.8;color:rgb(128,0,0);font-weight:bold;">100</span><span style="line-height:1.8;"> used_percent
  </span><span style="line-height:1.8;color:rgb(0,0,255);">from</span> (<span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">sum</span><span style="line-height:1.8;">(bytes) total
          </span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_free_space
         </span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) A,
       (</span><span style="line-height:1.8;color:rgb(0,0,255);">select</span> tablespace_name, <span style="line-height:1.8;color:rgb(255,0,255);">sum</span><span style="line-height:1.8;">(bytes) total
          </span><span style="line-height:1.8;color:rgb(0,0,255);">from</span><span style="line-height:1.8;"> dba_data_files
         </span><span style="line-height:1.8;color:rgb(0,0,255);">group</span> <span style="line-height:1.8;color:rgb(0,0,255);">by</span><span style="line-height:1.8;"> tablespace_name) B
 </span><span style="line-height:1.8;color:rgb(0,0,255);">where</span> A.tablespace_name <span style="line-height:1.8;color:rgb(128,128,128);">=</span> B.tablespace_name;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">根据本周每天的检查情况找到空间扩展很快的数据库对象,并采取相应的措施：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">--删除历史数据</span><br><span style="line-height:1.8;font-size:15px;">移动规定数据库中至少保留6个月的历史数据，所以以前的历史数据可以考虑备份然后进行清除以便释放其所占的资源空间。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">---扩表空间</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> tablespace <span style="line-height:1.8;color:rgb(128,128,128);">&lt;</span>tablespace_name<span style="line-height:1.8;color:rgb(128,128,128);">&gt;</span> <span style="line-height:1.8;color:rgb(0,0,255);">add</span> datafile ‘<span style="line-height:1.8;color:rgb(128,128,128);">&lt;</span><span style="line-height:1.8;color:rgb(0,0,255);">file</span><span style="line-height:1.8;color:rgb(128,128,128);">&gt;</span>’ size <span style="line-height:1.8;color:rgb(128,128,128);">&lt;</span>size<span style="line-height:1.8;color:rgb(128,128,128);">&gt;</span> autoextend <span style="line-height:1.8;color:rgb(0,0,255);">off</span>;</pre>
    </div> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-size:15px;">注意：在数据库结构发生变化时，如增加了表空间，增加了数据文件或重做日志文件这些操作，都会造成Oracle数据库控制文件的变化，DBA应及进行控制文件的备份，备份方法是：</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">执行SQL语句：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(0,0,255);">database</span> <span style="line-height:1.8;color:rgb(0,0,255);">backup</span> controlfile <span style="line-height:1.8;color:rgb(0,0,255);">to</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">/home/backup/control.bak</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">或：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(0,0,255);">database</span> <span style="line-height:1.8;color:rgb(0,0,255);">backup</span> controlfile <span style="line-height:1.8;color:rgb(0,0,255);">to</span> trace;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">这样，会在USER_DUMP_DEST(初始化参数文件中指定)目录下生成创建控制文件的SQL命令。</span></p> 
    <p><span style="line-height:1.8;font-size:15px;">7.4. 检查失效的索引</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">select</span><span style="line-height:1.8;"> index_name, table_name, tablespace_name, status
  </span><span style="line-height:1.8;color:rgb(0,0,255);">From</span><span style="line-height:1.8;"> dba_indexes
 </span><span style="line-height:1.8;color:rgb(0,0,255);">Where</span> owner <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">CTAIS2</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">And</span> status <span style="line-height:1.8;color:rgb(128,128,128);">&lt;&gt;</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">VALID</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">注：分区表上的索引status为N/A是正常的，如有失效索引则对该索引做rebuild，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(0,0,255);">index</span> INDEX_NAME rebuild tablespace TABLESPACE_NAME;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">7.5. 检查不起作用的约束</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span><span style="line-height:1.8;"> owner, constraint_name, table_name, constraint_type, status
  </span><span style="line-height:1.8;color:rgb(0,0,255);">FROM</span><span style="line-height:1.8;"> dba_constraints
 </span><span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> status <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">DISABLE</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>
   <span style="line-height:1.8;color:rgb(128,128,128);">and</span> constraint_type <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">P</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如有失效约束则启用，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(0,0,255);">Table</span> TABLE_NAME Enable Constraints CONSTRAINT_NAME;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">7.6. 检查无效的trigger</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">SELECT</span> owner, trigger_name, table_name, status <span style="line-height:1.8;color:rgb(0,0,255);">FROM</span> dba_triggers <span style="line-height:1.8;color:rgb(0,0,255);">WHERE</span> status <span style="line-height:1.8;color:rgb(128,128,128);">=</span> <span style="line-height:1.8;color:rgb(255,0,0);">'</span><span style="line-height:1.8;color:rgb(255,0,0);">DISABLED</span><span style="line-height:1.8;color:rgb(255,0,0);">'</span>;</pre>
    </div> 
    <p><span style="line-height:1.8;font-size:15px;">如有失效触发器则启用，如：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">alter</span> <span style="line-height:1.8;color:rgb(0,0,255);">Trigger</span> TRIGGER_NAME Enable;<span style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:15px;line-height:1.5;">&nbsp;</span></pre>
    </div> 
   </div> 
   <div class="clear" style="clear:both;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></div> 
   <div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;">本文转自Orson博客园博客，原文链接：http://www.cnblogs.com/java-class/p/4979798.html，如需转载请自行联系原作者</span></font>
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
