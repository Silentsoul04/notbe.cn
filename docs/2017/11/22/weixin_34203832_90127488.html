<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>GDI+绘制自定义行距的文本的三种方法。 « NotBeCN</title>
  <meta name="description" content="             　在.NET中，绘制图形和文本用的是GDI+。    　　在实际的应用中，绘制多行文本是比较常见的，而且有时还要求在绘制多行文本时能指定文本的行间距。如下图：    　　    　　注：由于图太大，只截了左边部分的图，右边有一小部分没有截图。    　　上面这个示意图。一共18行文字，每...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/22/weixin_34203832_90127488.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">GDI+绘制自定义行距的文本的三种方法。</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　在.NET中，绘制图形和文本用的是GDI+。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　在实际的应用中，绘制多行文本是比较常见的，而且有时还要求在绘制多行文本时能指定文本的行间距。如下图：</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<img src="https://pic002.cnblogs.com/img/grenet/201004/2010042110422865.jpg" style="border:0px;" alt="2010042110422865.jpg"></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　注：由于图太大，只截了左边部分的图，右边有一小部分没有截图。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　上面这个示意图。一共18行文字，每行52个文字，行间距为1.5字符。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　有关的GDI+的知识这里不再详细的介绍了。下面讲的是如何实现上面这个图的效果，给出三种实现方法。并比较他们的实现效率。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　由于GDI+中没有文本行间距的概念，所以，本文的三种方法都是自己实现行间距。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　准备工作：自定义一个类clsDraw</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　有这几个方法：</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　New(P as Control)　　　　　　　　　　　　构造函数，根据P来构造文本绘制环境</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　Clear()　　　　　　　　　　　　　　　　　　用背景色清楚画布</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　DrawText(Text as String,P as Point)　　　在指定位置P，绘制文本Text，这个文本一般是单行文本</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　DrawText1(Text as String,P as Point)　　 在指定位置P，绘制文本Text，这个文本是带有换行符的多行文本</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　Draw1(Text as String)　　　　　　　　　　用方法一绘制文本在默认位置。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　Draw2(Text as String)　　　　　　　　　　用方法二绘制文本在默认位置。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　Draw3(Text as String)　　　　　　　　　　用方法三绘制文本在默认位置。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　Refresh(G as Graphics)　　　　　　　　　 刷新本画布的内容到指定的控件上</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　有这几个属性</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mG　　　　　　Graphics　　　　本画布的Graphics对象。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mFont　　 　　Font　　　　　　本画布的Font对象</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mForeColor　　Color　　　　　 本画布的前景色</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mBackColor　　Color　　　　　 本画布的背景色</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mBmp　　　　 Bitmap　　　　　本画布对应的Bitmap对象</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mCP　　　　　 Point　　　　　　画布当前的绘制点</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mTextHeight 　Integer　　　　　Font对应的文字高度</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　mLineHeight　 Integer　　　　　行高，在本文中，是文本高度的1.5倍</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　下面详细介绍三种方法的实现：</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　方法一：将文本截断成多个文本，然后依次调用DrawText方法，将文本绘制到画布。模拟出自定义行间距的效果。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Public Sub</span>&nbsp;Draw1(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　Clear()</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;i&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, j&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, tS()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　j = Int(Text.Length / 52)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ReDim</span>&nbsp;tS(j - 1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">For</span>&nbsp;i = 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">To</span>&nbsp;j - 1</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　tS(i) = Text.Substring(i * 52, 52)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Next</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;Text.Length - j * 52 &lt;&gt; 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ReDim Preserve</span>&nbsp;tS(j+1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　tS(j+1) = Text.Substring(j * 52)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End If</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">For</span>&nbsp;i = 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">To</span>&nbsp;tS.GetUpperBound(0)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　DrawText(tS(i),&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">New</span>&nbsp;Point(3, 3 + i * mLineHeight))</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Next</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);">　　　　End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Public Sub</span>&nbsp;DrawText(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;P&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Point</span>)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　mCP = P</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　RenderText(Text)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Private Sub</span>&nbsp;RenderText(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　TextRenderer.DrawText(mG, Text, mFont, mCP, mForeColor, TextFormatFlags.NoPadding)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);">　　　　<span style="line-height:1.5;color:rgb(0,0,0);">几点说明：</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　1、绘制文本采用TextRender类，这个类对GDI进行了封装。在绘制文本的时候效率比Graphics的DrawString的效率高。</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　2、这个方法也是大家都能想到的。不过效率不敢恭维。原因有二，一是在绘制文本前，要拆分文本，会产生大量的临时字符串。二是，每调用一次DrawText，CLR其实做了大量的PInvoke的工作，而这些工作很多是重复的。去看看它的Reflector后的代码，每次调用，都要将mG、mFont、mForeColor对象转化为GDI，绘制文本，然后销毁GDI对象。而多次绘制，其实这三个对象是不变的，而多次的生成和销毁自然影响了效率。</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">&nbsp;</span></span>&nbsp;</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　方法二：既然方法一的瓶颈在多次调用DrawText而产生的。那如果只调用一次该方法，是不是就能提升效率呢？答案是肯定的。本方法就是将文本拆分成多个字符串后，再用换行符（VbNewLine）串联起来。这样，调用一次DrawText就能绘制多行文本，不过这个多行文本是没有行间距效果的，下一行文本紧挨着上一行文本。采用的办法是将绘制好的文本再逐行下移到指定位置，产生行间距的效果。本方法过程分两步，先在备用的画布上一次绘制所有文本，将备用画布上的文本再依次绘到画布上的指定位置。产生行间距的效果。</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Public Sub</span>&nbsp;Draw2(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　Clear()</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;i&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, j&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, tS()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>, tS1&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span></span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　j = Int(Text.Length / 52)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ReDim</span>&nbsp;tS(j - 1)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">For</span>&nbsp;i = 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">To</span>&nbsp;j - 1</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　　　tS(i) = Text.Substring(i * 52, 52)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Next</span></span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;Text.Length - j * 52 &lt;&gt; 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then</span></span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ReDim Preserve</span>&nbsp;tS(j+1)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　　　tS(j+1) = Text.Substring(j * 52)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End If</span></span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　tS1 = Join(tS, vbNewLine)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　DrawText1(tS1,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">New</span>&nbsp;Point(3, 3))</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">&nbsp;</span></span><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Public Sub</span>&nbsp;DrawText1(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;P&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Point</span>)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　mCP = P</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　　　RenderText1(Text)</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub<br></span></span></span>　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Private Sub</span>&nbsp;RenderText1(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;i&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, tR&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Rectangle, tR1&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Rectangle</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　TextRenderer.DrawText(mG1, Text, mFont, mCP, mForeColor, TextFormatFlags.NoPadding)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR.X = 3</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR.Height = mTextHeight</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR.Width = mBmp1.Width</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR1.X = 3</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR1.Height = mTextHeight</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tR1.Width = mBmp1.Width</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">For</span>&nbsp;i = 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">To</span>&nbsp;MaxLines - 1</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　tR.Y = 3 + i * mLineHeight</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　tR1.Y = 3 + i * mTextHeight</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　mG.DrawImage(mBmp1, tR, tR1, GraphicsUnit.Pixel)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Next</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Public ReadOnly Property</span>&nbsp;MaxLines()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Get</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Return</span>&nbsp;Int((mBmp.Height + mLineHeight - mTextHeight) / mLineHeight)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End Get</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);">　　　　End Property</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　几点说明：</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　1、本方法比方法一效率有所提高，约有20%的提高。</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　2、不过还是存在两个问题。一是要拆分字符串，会产生大量的临时字符串。二是将原来的多次调用DrawText的方法改为多次调用DrawImage的方法，效率有一定的提高，但还是多次PInvoke，大量的对象生成和销毁，效率还是有问题。</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;"></span>&nbsp;</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　方法三：利用GdipDrawDriverString函数。我们所有的GDI+对象其实都是封装了Gdiplus.dll中的函数，只不过有的函数没有封装而已。GdipDrawDriverString就是其中一个。它的VB2005声明为</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　&lt;DllImport("<span style="line-height:1.5;color:rgb(153,51,0);">Gdiplus.dll</span>", CharSet:=CharSet.Unicode)&gt;&nbsp; _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　<span style="line-height:1.5;color:rgb(0,0,255);">Friend Shared Function&nbsp;</span>GdipDrawDriverString(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;graphics&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr, _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>, _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;length&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>,&nbsp; _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;font&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr,&nbsp; _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;brush&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr, _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;positions()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;PointF, _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;flags&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, _</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;matrix&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span><br><span style="line-height:1.5;color:rgb(0,0,255);">End Function</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　由于这个函数不能直接调用Graphics、Font、SolidBrush等对象。因此，在调用前还得自己先封装一下：</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;">　　</span><span style="line-height:1.5;color:rgb(0,0,255);">Private Shared Sub</span>&nbsp;DrawDriverString(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;graphics&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Graphics,&nbsp;_</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;font&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Font,&nbsp; _</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;brush&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Brush,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;positions()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;PointF)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　DrawDriverString(graphics, text, font, brush, positions, Nothing)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">Private Shared Sub</span>&nbsp;DrawDriverString(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal&nbsp;</span>G&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Graphics, _</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal&nbsp;</span>T&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;F&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As&nbsp;</span>Font, _</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;B&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Brush,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;P()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;PointF,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;M&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;Matrix)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(G&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then Throw New</span>&nbsp;ArgumentNullException("graphics")</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(T&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then Throw New</span>&nbsp;ArgumentNullException("text")</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(F&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then Throw New</span>&nbsp;ArgumentNullException("font")</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(B&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then Throw New</span>&nbsp;ArgumentNullException("brush")</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(P&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then Throw New</span>&nbsp;ArgumentNullException("positions")</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;Field&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;FieldInfo</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Field =&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">GetType</span>(Graphics).GetField("nativeGraphics", BindingFlags.Instance&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Or&nbsp;</span>BindingFlags.NonPublic)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;hGraphics&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr = Field.GetValue(G)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Field =&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">GetType</span>(Font).GetField("nativeFont", BindingFlags.Instance&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Or</span>&nbsp;BindingFlags.NonPublic)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;hFont&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr = Field.GetValue(F)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Field =&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">GetType</span>(Brush).GetField("nativeBrush", BindingFlags.Instance&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Or</span>&nbsp;BindingFlags.NonPublic)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;hBrush&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr = Field.GetValue(B)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;hMatrix&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;IntPtr = IntPtr.Zero</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">If</span>&nbsp;(<span style="line-height:1.5;color:rgb(0,0,255);">Not</span>&nbsp;M&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Is Nothing</span>)&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Then</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　Field =&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">GetType</span>(Matrix).GetField("nativeMatrix", BindingFlags.Instance&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">Or</span>&nbsp;BindingFlags.NonPublic)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　hMatrix = Field.GetValue(M)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">End If</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;result&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>&nbsp;= GdipDrawDriverString(hGraphics, T, T.Length, hFont, hBrush, P, DriverStringOptions.CmapLookup, hMatrix)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">Private Enum</span>&nbsp;DriverStringOptions</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　CmapLookup = 1</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Vertical = 2</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Advance = 4</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　LimitSubpixel = 8</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　<span style="line-height:1.5;color:rgb(0,0,255);">　End Enum</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　上面这段代码是我移植网上的一段C#的代码。期间也碰到过陷阱，看看“<a href="http://www.chinaitpower.com/A/2004-02-21/72181.html" rel="nofollow" style="color:rgb(7,93,179);">使用GDI+绘制有间距的文本</a>”“<a href="http://www.cnblogs.com/grenet/archive/2010/04/19/1715588.html" rel="nofollow" id="ctl04_TitleUrl" class="postTitle2" style="color:rgb(7,93,179);">充满魅惑的GetType（VB2005）</a>”这两篇文章就知道我指陷阱是什么了。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　这个函数在调用的时候要传递一个PointF的数组，指明每个字符的绘制位置。而且这个位置是指的是字符的左下角位置。那么我在调用的时候就不需要拆分字符串，而是计算每个字符的位置就可以了。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">Public Sub</span>&nbsp;Draw3(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal&nbsp;</span>Text&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Clear()</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;i&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span>, tP()&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;PointF</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">ReDim</span>&nbsp;tP(Text.Length - 1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">For</span>&nbsp;i = 0&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">To</span>&nbsp;Text.Length - 1</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tP(i).X = (i Mod 52) * 16 + 3</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　　　tP(i).Y = 3 + Int(i / 52) * mLineHeight + 12</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Next</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　DrawDriverString(mG, Text, mFont, New SolidBrush(mForeColor), tP)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);">　　</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);">　　<span style="line-height:1.5;color:rgb(0,0,0);">写了一段测试代码，分别测试三个方法的效率。代码如下：</span></span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;color:rgb(0,0,255);"><span style="line-height:1.5;color:rgb(0,0,0);"></span></span>　　<span style="line-height:1.5;color:rgb(0,0,255);">Private Sub</span>&nbsp;Button1_Click(<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;sender&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;System.Object,&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">ByVal</span>&nbsp;e&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As</span>&nbsp;System.EventArgs)<span style="line-height:1.5;color:rgb(0,0,255);">&nbsp;Handles</span>&nbsp;Button1.Click</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;mGDI&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As New</span>&nbsp;clsDraw(Panel1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;tS1&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As String</span>&nbsp;= My.Computer.FileSystem.ReadAllText("t1.txt", System.Text.Encoding.Default)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　<span style="line-height:1.5;color:rgb(0,0,255);">Dim</span>&nbsp;t1<span style="line-height:1.5;color:rgb(0,0,255);">&nbsp;As Integer</span>, t2&nbsp;<span style="line-height:1.5;color:rgb(0,0,255);">As Integer</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　t1 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　mGDI.Draw1(tS1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　t2 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Debug.Print(t2 - t1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><br> t1 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　mGDI.Draw2(tS1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　t2 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Debug.Print(t2 - t1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　t1 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　mGDI.Draw3(tS1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　t2 = Environment.TickCount</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Debug.Print(t2 - t1)</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　　　Panel1.Invalidate()</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　<span style="line-height:1.5;color:rgb(0,0,255);">End Sub</span></p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　在绘制象示意图中的文本的效果，测试了十次，三种方法的耗费的时间如下（单位是毫秒）：</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　第一次：方法一：125；方法二：94；方法三：15<br> 第二次：方法一：125；方法二：78；方法三：16<br> 第三次：方法一：125；方法二：79；方法三：15<br> 第四次：方法一：110；方法二：93；方法三：16<br> 第五次：方法一：125；方法二：78；方法三：16<br> 第六次：方法一：125；方法二：78：方法三：16<br> 第七次：方法一：125；方法二：78；方法三：15<br> 第八次：方法一：125；方法二：78；方法三：16<br> 第九次：方法一：110；方法二：94；方法三：15<br> 第十次：方法一：109；方法二：94；方法三：15</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　可以看出，方法一和方法二由于要拆分字符串和反复调用GDI+的方法，所以效率有点低下，方法二由于采用DrawImage的方法，效率略有提升。而方法三不拆分字符串和只调用一次GDI+的方法，效率高得惊人。把前两种方法远远甩在后面。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">　　如果各位网友还有什么好的方法，欢迎交流，大家互相学习。</p> 
   <p style="line-height:1.5;font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;"><br></p> 
   <p style="line-height:1.5;"><font><span style="font-size:15px;">&nbsp; &nbsp; 本文转自万仓一黍博客园博客，原文链接：http://www.cnblogs.com/grenet/archive/2010/04/21/1717135.html</span></font><span style="font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
