<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>“一切都是消息”--MSF（消息服务框架）之【请求-响应】模式（点对点） « NotBeCN</title>
  <meta name="description" content="             在前一篇，&nbsp;“一切都是消息”--MSF（消息服务框架）入门简介， 我们介绍了MSF基于异步通信，支持请求-响应通信模式和发布-订阅通信模式，并且介绍了如何获取MSF。今天，我们来看看如何使用MSF来做一个请求-响应通信模式的例子。    MSF封装了WCF，所以使用MSF不能像...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/18/weixin_34370347_90134805.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">“一切都是消息”--MSF（消息服务框架）之【请求-响应】模式（点对点）</h1>
    <p class="post-meta">Nov 18, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在前一篇，&nbsp;<a id="cb_post_title_url" href="http://www.cnblogs.com/bluedoctor/p/7605737.html" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">“一切都是消息”--MSF（消息服务框架）入门简介</a>， 我们介绍了MSF基于异步通信，支持请求-响应通信模式和发布-订阅通信模式，并且介绍了如何获取MSF。今天，我们来看看如何使用MSF来做一个请求-响应通信模式的例子。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">MSF封装了WCF，所以使用MSF不能像使用WCF那样直接在客户端添加服务引用，你需要手工编写客户端代理类，这样有一个好处就是代理类写的更简单，使用更灵活。我们可以看看网友写的这篇文章《<a href="http://blog.csdn.net/u011854789/article/details/51878898" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">不引用服务而使用WCF，手动编写客户端代理类&nbsp;</a>》，看看直接使用WCF是如何手动编写客户端代理类的。我对作者文中有一句话很认同：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>--我们应当把WCF理解为一种通信技术，而不只是服务。</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这正是MSF的设计理念！</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">回到MSF，我们来看看实现请求-响应通信模式的步骤。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;一，编写MSF服务类</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在上一篇文中搭建好的MSF解决方案中，我们创建了一个名字为 TestService的项目，首先，添加Nuget 的MSF服务端引用，</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>Install-Package PDF.Net.MSF.Service</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">现在添加一个类 Service1，让它继承MSF的IService 接口。具体代码如下：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> PWMIS.EnterpriseFramework.Service.Runtime;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Collections.Generic;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Linq;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Text;

</span><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestService
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Service1:IService
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> CompleteRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException();
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> IsUnSubscribe
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException(); }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> ProcessRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException();
        }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;然后，将上面方法中的异常信息注释掉，并且添加一个 SayHello 方法，具体修改如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Service1:IService
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> SayHello(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> who)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hello {0} ,I am  MSF Server.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, who);
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> CompleteRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">throw new NotImplementedException();</span>
<span style="line-height:1.5;">        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> IsUnSubscribe
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">get { throw new NotImplementedException(); }</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;"> 
            { 
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">返回True ，表示当前服务不执行系统后续的服务方法的订阅处理过程，而是由用户自己输出结果数据</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">; 
            }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> ProcessRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">throw new NotImplementedException();</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">可以看到，实现MSF服务类，不需要先定义一个WCF服务契约接口，也没用其它WCF的代码影子，不过有点类似 ASP.NET 的HTTP处理过程：</p> 
   <ol style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">首先，每个MSF服务类都会执行&nbsp;ProcessRequest 方法，它有一个IServiceContext 对象，通过它可以知道请求相关的上下文信息；</li> 
    <li style="list-style-type:decimal;">然后，会有一个&nbsp;IsUnSubscribe 属性，表示本次请求是否是一个自定义的服务订阅而不再继续执行系统的服务订阅，虽然本次的示例是演示“请求-响应”的通信模式的，但是MSF本质上对此种通信模式还是通过“发布-订阅”通信模式实现的，也就是说，MSF的消息通信，始终是面向长连接的；</li> 
    <li style="list-style-type:decimal;">如果IsUnSubscribe 属性返回为False，紧接着，MSF会调用您真正的服务方法，比如这里的 SayHello 方法；</li> 
    <li style="list-style-type:decimal;">最后，你可以在 CompleteRequest 中执行一些本次服务处理的收尾工作。</li> 
   </ol>
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;二，编写MSF客户端</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">我们在上一篇文中说的TestClient 项目中，来编写今天的MSF客户端代码，在原有代码基础上，做适当的修改。<br> MSF客户端调用可以分为多种方式：</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.1，使用服务请求的URI模式：</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br> 本质上，MSF的客户端请求服务端的时候，是将请求的服务信息转换成MSF固有的URI地址参数信息的，类似RESTfull WebAPI 的URI一样，本次请求的URI地址如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>Service://Service1/SayHello/System.String=bluedoctor1</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">它表示我们请求的服务类名称是 Service1,请求的服务方法名称是 SayHello,有一个String类型的参数并且给它赋值为 bluedoctor 。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">MSF请求服务的时候，服务方法的参数是不用区分参数名的，只跟参数的顺序，参数的类型和参数的数量有关系，这根我们使用委托方法调用一个实际的方法一样的方式。<br> 相关调用代码如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  client.RequestService&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service://Service1/SayHello/System.String=bluedoctor1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
               PWMIS.EnterpriseFramework.Common.DataType.Text,
               s </span>=&gt;<span style="line-height:1.5;">
               {
                   Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">1,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, s);
               });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果调用服务成功，将输出结果：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>1，Server Response:【Hello bluedoctor1 ,I am <span style="color:rgb(0,0,255);line-height:1.5;">is</span> MSF Server.】</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.2，使用ServiceRequest 对象来封装服务请求信息</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">前面通过服务请求的URI模式虽然比较直观简洁，但使用对象来封装请求信息可能更可靠，对前面例子改写成 ServiceRequest 对象的代码如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>            ServiceRequest request = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ServiceRequest();
            request.ServiceName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request.MethodName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SayHello</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request.Parameters </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> <span style="color:rgb(0,0,255);line-height:1.5;">object</span>[] { <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">bluedoctor23</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;"> };
            client.RequestService</span>&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;<span style="line-height:1.5;">(request,
                PWMIS.EnterpriseFramework.Common.DataType.Text,
                s </span>=&gt;<span style="line-height:1.5;">
                {
                    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">2,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, s);
                });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.3，使用异步调用方法</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br> 前面两个调用示例，其实都是传入一个委托方法给RequestService 方法，然后服务端回调此委托方法的，而此委托方法的回调时机是不确定的，相对于调用线程它是异步执行的，所以我们称呼前面2种调用方式为“异步委托方法”。这种方式的一大缺点就是我们的代码中会有大量的难以阅读和调试的异步回调代码。.NET 4.0之后提供了Task对象它可以简化这种调用过程，使得代码写起来就跟同步调用代码一样。这种异步调用方式，MSF也提供了支持，使用服务请求的Async后缀的方法即可：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> serverMsg= client.RequestServiceAsync&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;<span style="line-height:1.5;">(request).Result;
 Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">3,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, serverMsg);</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">调用&nbsp;RequestServiceAsync 方法返回结果的 Result方法，能够同步阻塞调用结果，使得后续代码按照我们预期的顺序执行。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">三、注册MSF服务类</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;运行上面编写的服务端和客户端，调用并不成功，在服务端出现了下面的异常：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2017.cnblogs.com/blog/114517/201710/114517-20171009150112574-1085310308.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面截图中显示的错误信息是 ：“从注册的所有容器中没有找到符合当前类型的提供程序。”</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个错误信息会返回到客户端：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>处理服务时错误：从注册的所有容器中没有找到符 合当前类型的提供程序。</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个错误提示我们没有注册我们的MSF服务类，因为MSF会通过IOC容器去寻找我们调用的服务类，所以需要注册下。<br> MSF采用了一个简单的IOC工具，它支持通过XML配置文件类注册我们自定义的MSF服务类。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在解决方案中，看到引用了MSF Host的主项目 MSFTest，nuget添加MSF Host的时候，已经添加了一个IOC配置文件：IOCConfig.xml</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个文件的使用，在MSF Host的配置文件&nbsp;PdfNetEF.MessageServiceHost.exe.config 中做了配置：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);line-height:1.5;">xml version="1.0" encoding="utf-8"</span><span style="color:rgb(0,0,255);line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">configuration</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">appSettings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="IOCConfigFile"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">=".\IOCConfig.xml"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServerIP"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">="127.0.0.1"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServerPort"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">="8888"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
 <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">appSettings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span><span style="line-height:1.5;">
 ... 其它配置内容略</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">IOCConfig.xml 文件已经配置了MSF必要的内容和一些示例的测试配置，具体内容为：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);line-height:1.5;">xml version="1.0" encoding="utf-8" </span><span style="color:rgb(0,0,255);line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOCConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,128,0);line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);line-height:1.5;">
  IOC 依赖注入容器配置 
  ver 1.0 
  
  注：PDF.NET MSF Servic Host 使用
  PWMIS 消息服务框架,2011.12.7 创建
  </span><span style="color:rgb(0,128,0);line-height:1.5;">--&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRuntime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>分布式服务运行时<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="2"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceModel"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>服务模型<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="3"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>示例服务<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">SystemInterface</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Interface</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span><span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">SystemInterface</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupSet</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRuntime"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="CacheServer"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime.CacheService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="RegService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Group.RegService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Group"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ManageService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="TranstarAuction.Service.Runtime.ManageService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="TranstarAuctionServiceRuntime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="Calculator"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.TestCalculatorService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestTimeService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.TestTimeService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="AlarmClockService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.AlarmClockService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="Service1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService.Service1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceModel"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="TimeCount"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="Model.TimeCount"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="Model"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,128,0);line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);line-height:1.5;"> 下面4个是消息服务框架必须的ServiceModel </span><span style="color:rgb(0,128,0);line-height:1.5;">--&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceIdentity"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime.Principal.ServiceIdentity"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="CacheItemPolicy"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="System.Runtime.Caching.CacheItemPolicy"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="System.Runtime.Caching, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRegModel"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client.Model.ServiceRegModel"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceHostInfo"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client.Model.ServiceHostInfo"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupSet</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOCConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">其中，Key=“<span style="color:rgb(0,0,255);">Service1</span>” 配置节，便是我们今天需要配置的Service1 服务类的内容。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;四、返回复杂类型的服务方法</h1> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.1，编写MSF服务类</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在前面的示中，服务类 Service1 的服务方法&nbsp;SayHello 返回的是String 类型这样的简单类型，很多时候，我们需要服务方法返回结构复杂的自定义业务类型。在本次示例中，我们定义一个邮件消息类，我们新建一个C# 类库项目 TestDto，然后如下定义它：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Collections.Generic;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Linq;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Text;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Threading.Tasks;

</span><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestDto
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> MailMessage
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Sender { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Reply { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Message { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime RevoveryTime { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">然后，回到TestService项目的Service1服务类，增加一个GetMailMessage 方法：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> <span style="color:rgb(0,0,255);line-height:1.5;">public</span> MailMessage GetMailMessage(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> who)
        {
            MailMessage mail </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> MailMessage();
            mail.Reply </span>=<span style="line-height:1.5;"> who;
            mail.Sender </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">MSF Server</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            mail.Message </span>= <span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hello {0} ,I am  MSF Server.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, who);
            mail.RevoveryTime </span>=<span style="line-height:1.5;"> DateTime.Now;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mail;
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.2，编写MSF客户端代码</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">最后，我们在TestClient中添加调用此服务的客户端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> client.RequestService&lt;MailMessage&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service://Service1/GetMailMessage/System.String=bluedoctor4</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
               PWMIS.EnterpriseFramework.Common.DataType.Json,
               mail </span>=&gt;<span style="line-height:1.5;">
               {
                   Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">4,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message,mail.RevoveryTime);
               });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">调用结果将输出：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>4，Server Response:【Hello bluedoctor4 ,I am is MSF Server.】</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;同样，我们也可以使用ServiceRequest 对象来调用这个服务：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> ServiceRequest request2 = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ServiceRequest();
            request2.ServiceName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request2.MethodName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">GetMailMessage</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request2.Parameters </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> <span style="color:rgb(0,0,255);line-height:1.5;">object</span>[] { <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">bluedoctor567</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;"> };

            client.RequestService</span>&lt;MailMessage&gt;<span style="line-height:1.5;">(request2,
              PWMIS.EnterpriseFramework.Common.DataType.Json,
              mail </span>=&gt;<span style="line-height:1.5;">
              {
                  Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">5,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message, mail.RevoveryTime);
              });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.3，使用客户端自定义结果类型</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">我们调用服务方法的时候，客户端调用服务方法返回值的对象类型，可以跟服务方法定义的返回类型名字不一样，比如GetMailMessage 方法调用，我们可以在本地定义一个结构相同的不同的类：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestClient
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> MailMessage2
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Sender { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Reply { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Message { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime RevoveryTime { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">然后在客户端调用，使用这个新的在客户端定义的类型作为服务方法调用的返回值：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> client.RequestService&lt;<span style="color:rgb(0,0,255);line-height:1.5;">MailMessage</span>2&gt;<span style="line-height:1.5;">(request2,
             PWMIS.EnterpriseFramework.Common.DataType.Json,
             mail </span>=&gt;<span style="line-height:1.5;">
             {
                 Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">6,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message, mail.RevoveryTime);
             });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">输出结果跟上面是一样的。这是因为服务端和客户端使用的都是JSON序列化，它是不关心类型的名字的只关心内部数据结构是否一致。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;五、小结</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面的过程演示了MSF编写服务端和客户端代码的简单过程，对MSF而言，服务是本质上都是异步调用和返回的，服务方法返回结果不仅支持简单类型，还支持复杂类型；客户端支持多种调用代码书写方式。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">虽然MSF是基于WCF构建的，但是从本文的示例过程看，<span style="color:rgb(255,0,0);">仅使用MSF，无需掌握任何WCF的知识。</span></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是完整的MSF服务端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是完整的客户端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是运行客户端输出的结果示例：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>******** PDF.NET MSF 客户端测试程序 *********

请输入服务器的主机名或者IP地址(默认 127.0.0.1)：
服务地址：127.0.0.1
请输入服务的端口号(默认 8888)：
服务端口号：8888
当前客户端代理的服务基础地址是：net.tcp://127.0.0.1:8888

MSF 请求-响应 模式调用示例：
1,Server Response:【Hello bluedoctor1 ,I am  MSF Server.】
3,Server Response:【Hello bluedoctor23 ,I am  MSF Server.】
2,Server Response:【Hello bluedoctor23 ,I am  MSF Server.】
7,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
按回车键继续
4,Server Response:【Hello bluedoctor4 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
5,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
6,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在下一篇，我们将演示MSF的“发布-订阅”通信模式。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">本篇测试程序全部源码，已经上传到GitHub:</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://github.com/bluedoctor/MSFTest" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">https://github.com/bluedoctor/MSFTest</a></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">欢迎加入我们的QQ群讨论MSF框架的使用，群号：敏思（PWMIS） .NET 18215717，加群请注明：PDF.NET技术交流，否则可能被拒。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在前一篇，&nbsp;<a href="http://www.cnblogs.com/bluedoctor/p/7605737.html" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">“一切都是消息”--MSF（消息服务框架）入门简介</a>， 我们介绍了MSF基于异步通信，支持请求-响应通信模式和发布-订阅通信模式，并且介绍了如何获取MSF。今天，我们来看看如何使用MSF来做一个请求-响应通信模式的例子。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">MSF封装了WCF，所以使用MSF不能像使用WCF那样直接在客户端添加服务引用，你需要手工编写客户端代理类，这样有一个好处就是代理类写的更简单，使用更灵活。我们可以看看网友写的这篇文章《<a href="http://blog.csdn.net/u011854789/article/details/51878898" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">不引用服务而使用WCF，手动编写客户端代理类&nbsp;</a>》，看看直接使用WCF是如何手动编写客户端代理类的。我对作者文中有一句话很认同：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>--我们应当把WCF理解为一种通信技术，而不只是服务。</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这正是MSF的设计理念！</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">回到MSF，我们来看看实现请求-响应通信模式的步骤。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;一，编写MSF服务类</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在上一篇文中搭建好的MSF解决方案中，我们创建了一个名字为 TestService的项目，首先，添加Nuget 的MSF服务端引用，</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>Install-Package PDF.Net.MSF.Service</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">现在添加一个类 Service1，让它继承MSF的IService 接口。具体代码如下：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> PWMIS.EnterpriseFramework.Service.Runtime;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Collections.Generic;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Linq;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Text;

</span><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestService
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Service1:IService
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> CompleteRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException();
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> IsUnSubscribe
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span> { <span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException(); }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> ProcessRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> NotImplementedException();
        }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;然后，将上面方法中的异常信息注释掉，并且添加一个 SayHello 方法，具体修改如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Service1:IService
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> SayHello(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> who)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hello {0} ,I am  MSF Server.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, who);
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> CompleteRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">throw new NotImplementedException();</span>
<span style="line-height:1.5;">        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> IsUnSubscribe
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">get { throw new NotImplementedException(); }</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">get</span><span style="line-height:1.5;"> 
            { 
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">返回True ，表示当前服务不执行系统后续的服务方法的订阅处理过程，而是由用户自己输出结果数据</span>
                <span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">; 
            }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">bool</span><span style="line-height:1.5;"> ProcessRequest(IServiceContext context)
        {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">throw new NotImplementedException();</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(0,0,255);line-height:1.5;">true</span><span style="line-height:1.5;">;
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">可以看到，实现MSF服务类，不需要先定义一个WCF服务契约接口，也没用其它WCF的代码影子，不过有点类似 ASP.NET 的HTTP处理过程：</p> 
   <ol style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">首先，每个MSF服务类都会执行&nbsp;ProcessRequest 方法，它有一个IServiceContext 对象，通过它可以知道请求相关的上下文信息；</li> 
    <li style="list-style-type:decimal;">然后，会有一个&nbsp;IsUnSubscribe 属性，表示本次请求是否是一个自定义的服务订阅而不再继续执行系统的服务订阅，虽然本次的示例是演示“请求-响应”的通信模式的，但是MSF本质上对此种通信模式还是通过“发布-订阅”通信模式实现的，也就是说，MSF的消息通信，始终是面向长连接的；</li> 
    <li style="list-style-type:decimal;">如果IsUnSubscribe 属性返回为False，紧接着，MSF会调用您真正的服务方法，比如这里的 SayHello 方法；</li> 
    <li style="list-style-type:decimal;">最后，你可以在 CompleteRequest 中执行一些本次服务处理的收尾工作。</li> 
   </ol>
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;二，编写MSF客户端</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">我们在上一篇文中说的TestClient 项目中，来编写今天的MSF客户端代码，在原有代码基础上，做适当的修改。<br> MSF客户端调用可以分为多种方式：</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.1，使用服务请求的URI模式：</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br> 本质上，MSF的客户端请求服务端的时候，是将请求的服务信息转换成MSF固有的URI地址参数信息的，类似RESTfull WebAPI 的URI一样，本次请求的URI地址如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>Service://Service1/SayHello/System.String=bluedoctor1</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">它表示我们请求的服务类名称是 Service1,请求的服务方法名称是 SayHello,有一个String类型的参数并且给它赋值为 bluedoctor 。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">MSF请求服务的时候，服务方法的参数是不用区分参数名的，只跟参数的顺序，参数的类型和参数的数量有关系，这根我们使用委托方法调用一个实际的方法一样的方式。<br> 相关调用代码如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  client.RequestService&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service://Service1/SayHello/System.String=bluedoctor1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
               PWMIS.EnterpriseFramework.Common.DataType.Text,
               s </span>=&gt;<span style="line-height:1.5;">
               {
                   Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">1,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, s);
               });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">如果调用服务成功，将输出结果：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>1，Server Response:【Hello bluedoctor1 ,I am <span style="color:rgb(0,0,255);line-height:1.5;">is</span> MSF Server.】</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.2，使用ServiceRequest 对象来封装服务请求信息</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">前面通过服务请求的URI模式虽然比较直观简洁，但使用对象来封装请求信息可能更可靠，对前面例子改写成 ServiceRequest 对象的代码如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>            ServiceRequest request = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ServiceRequest();
            request.ServiceName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request.MethodName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">SayHello</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request.Parameters </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> <span style="color:rgb(0,0,255);line-height:1.5;">object</span>[] { <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">bluedoctor23</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;"> };
            client.RequestService</span>&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;<span style="line-height:1.5;">(request,
                PWMIS.EnterpriseFramework.Common.DataType.Text,
                s </span>=&gt;<span style="line-height:1.5;">
                {
                    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">2,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, s);
                });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.3，使用异步调用方法</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><br> 前面两个调用示例，其实都是传入一个委托方法给RequestService 方法，然后服务端回调此委托方法的，而此委托方法的回调时机是不确定的，相对于调用线程它是异步执行的，所以我们称呼前面2种调用方式为“异步委托方法”。这种方式的一大缺点就是我们的代码中会有大量的难以阅读和调试的异步回调代码。.NET 4.0之后提供了Task对象它可以简化这种调用过程，使得代码写起来就跟同步调用代码一样。这种异步调用方式，MSF也提供了支持，使用服务请求的Async后缀的方法即可：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> serverMsg= client.RequestServiceAsync&lt;<span style="color:rgb(0,0,255);line-height:1.5;">string</span>&gt;<span style="line-height:1.5;">(request).Result;
 Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">3,Server Response:【{0}】</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, serverMsg);</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">调用&nbsp;RequestServiceAsync 方法返回结果的 Result方法，能够同步阻塞调用结果，使得后续代码按照我们预期的顺序执行。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">三、注册MSF服务类</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;运行上面编写的服务端和客户端，调用并不成功，在服务端出现了下面的异常：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2017.cnblogs.com/blog/114517/201710/114517-20171009150112574-1085310308.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面截图中显示的错误信息是 ：“从注册的所有容器中没有找到符合当前类型的提供程序。”</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个错误信息会返回到客户端：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>处理服务时错误：从注册的所有容器中没有找到符 合当前类型的提供程序。</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个错误提示我们没有注册我们的MSF服务类，因为MSF会通过IOC容器去寻找我们调用的服务类，所以需要注册下。<br> MSF采用了一个简单的IOC工具，它支持通过XML配置文件类注册我们自定义的MSF服务类。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在解决方案中，看到引用了MSF Host的主项目 MSFTest，nuget添加MSF Host的时候，已经添加了一个IOC配置文件：IOCConfig.xml</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">这个文件的使用，在MSF Host的配置文件&nbsp;PdfNetEF.MessageServiceHost.exe.config 中做了配置：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);line-height:1.5;">xml version="1.0" encoding="utf-8"</span><span style="color:rgb(0,0,255);line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">configuration</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">appSettings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="IOCConfigFile"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">=".\IOCConfig.xml"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServerIP"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">="127.0.0.1"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">add </span><span style="color:rgb(255,0,0);line-height:1.5;">key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServerPort"</span><span style="color:rgb(255,0,0);line-height:1.5;"> value</span><span style="color:rgb(0,0,255);line-height:1.5;">="8888"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
 <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">appSettings</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span><span style="line-height:1.5;">
 ... 其它配置内容略</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">IOCConfig.xml 文件已经配置了MSF必要的内容和一些示例的测试配置，具体内容为：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">&lt;?</span><span style="color:rgb(255,0,255);line-height:1.5;">xml version="1.0" encoding="utf-8" </span><span style="color:rgb(0,0,255);line-height:1.5;">?&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOCConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,128,0);line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);line-height:1.5;">
  IOC 依赖注入容器配置 
  ver 1.0 
  
  注：PDF.NET MSF Servic Host 使用
  PWMIS 消息服务框架,2011.12.7 创建
  </span><span style="color:rgb(0,128,0);line-height:1.5;">--&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRuntime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>分布式服务运行时<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="2"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceModel"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>服务模型<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Group </span><span style="color:rgb(255,0,0);line-height:1.5;">ID</span><span style="color:rgb(0,0,255);line-height:1.5;">="3"</span><span style="color:rgb(255,0,0);line-height:1.5;"> ParentID</span><span style="color:rgb(0,0,255);line-height:1.5;">="0"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span> <span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>示例服务<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">Group</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">SystemInterface</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Interface</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span><span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">SystemInterface</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupSet</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRuntime"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="CacheServer"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime.CacheService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="RegService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Group.RegService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Group"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ManageService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="TranstarAuction.Service.Runtime.ManageService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="TranstarAuctionServiceRuntime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="Calculator"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.TestCalculatorService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestTimeService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.TestTimeService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="AlarmClockService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample.AlarmClockService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceSample"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="Service1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">="IService"</span><span style="color:rgb(255,0,0);line-height:1.5;"> FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService.Service1"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="TestService"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC </span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceModel"</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="TimeCount"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="Model.TimeCount"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="Model"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,128,0);line-height:1.5;">&lt;!--</span><span style="color:rgb(0,128,0);line-height:1.5;"> 下面4个是消息服务框架必须的ServiceModel </span><span style="color:rgb(0,128,0);line-height:1.5;">--&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceIdentity"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime.Principal.ServiceIdentity"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Runtime"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="CacheItemPolicy"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="System.Runtime.Caching.CacheItemPolicy"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="System.Runtime.Caching, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceRegModel"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client.Model.ServiceRegModel"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
      <span style="color:rgb(0,0,255);line-height:1.5;">&lt;</span><span style="color:rgb(128,0,0);line-height:1.5;">Add </span><span style="color:rgb(255,0,0);line-height:1.5;">Key</span><span style="color:rgb(0,0,255);line-height:1.5;">="ServiceHostInfo"</span><span style="color:rgb(255,0,0);line-height:1.5;">  InterfaceName</span><span style="color:rgb(0,0,255);line-height:1.5;">=""</span><span style="color:rgb(255,0,0);line-height:1.5;">  FullClassName</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client.Model.ServiceHostInfo"</span><span style="color:rgb(255,0,0);line-height:1.5;"> Assembly</span><span style="color:rgb(0,0,255);line-height:1.5;">="PWMIS.EnterpriseFramework.Service.Client"</span> <span style="color:rgb(0,0,255);line-height:1.5;">/&gt;</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOC</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
  <span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">GroupSet</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span>
<span style="color:rgb(0,0,255);line-height:1.5;">&lt;/</span><span style="color:rgb(128,0,0);line-height:1.5;">IOCConfig</span><span style="color:rgb(0,0,255);line-height:1.5;">&gt;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">其中，Key=“<span style="color:rgb(0,0,255);">Service1</span>” 配置节，便是我们今天需要配置的Service1 服务类的内容。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;四、返回复杂类型的服务方法</h1> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.1，编写MSF服务类</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在前面的示中，服务类 Service1 的服务方法&nbsp;SayHello 返回的是String 类型这样的简单类型，很多时候，我们需要服务方法返回结构复杂的自定义业务类型。在本次示例中，我们定义一个邮件消息类，我们新建一个C# 类库项目 TestDto，然后如下定义它：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Collections.Generic;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Linq;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Text;
</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span><span style="line-height:1.5;"> System.Threading.Tasks;

</span><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestDto
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> MailMessage
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Sender { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Reply { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Message { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime RevoveryTime { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">然后，回到TestService项目的Service1服务类，增加一个GetMailMessage 方法：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> <span style="color:rgb(0,0,255);line-height:1.5;">public</span> MailMessage GetMailMessage(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> who)
        {
            MailMessage mail </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> MailMessage();
            mail.Reply </span>=<span style="line-height:1.5;"> who;
            mail.Sender </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">MSF Server</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            mail.Message </span>= <span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hello {0} ,I am  MSF Server.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, who);
            mail.RevoveryTime </span>=<span style="line-height:1.5;"> DateTime.Now;
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mail;
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.2，编写MSF客户端代码</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">最后，我们在TestClient中添加调用此服务的客户端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> client.RequestService&lt;MailMessage&gt;(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service://Service1/GetMailMessage/System.String=bluedoctor4</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
               PWMIS.EnterpriseFramework.Common.DataType.Json,
               mail </span>=&gt;<span style="line-height:1.5;">
               {
                   Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">4,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message,mail.RevoveryTime);
               });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">调用结果将输出：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>4，Server Response:【Hello bluedoctor4 ,I am is MSF Server.】</pre>
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;同样，我们也可以使用ServiceRequest 对象来调用这个服务：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> ServiceRequest request2 = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> ServiceRequest();
            request2.ServiceName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Service1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request2.MethodName </span>= <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">GetMailMessage</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
            request2.Parameters </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> <span style="color:rgb(0,0,255);line-height:1.5;">object</span>[] { <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">bluedoctor567</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;"> };

            client.RequestService</span>&lt;MailMessage&gt;<span style="line-height:1.5;">(request2,
              PWMIS.EnterpriseFramework.Common.DataType.Json,
              mail </span>=&gt;<span style="line-height:1.5;">
              {
                  Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">5,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message, mail.RevoveryTime);
              });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">4.3，使用客户端自定义结果类型</h2> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">我们调用服务方法的时候，客户端调用服务方法返回值的对象类型，可以跟服务方法定义的返回类型名字不一样，比如GetMailMessage 方法调用，我们可以在本地定义一个结构相同的不同的类：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">namespace</span><span style="line-height:1.5;"> TestClient
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> MailMessage2
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Sender { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Reply { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Message { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> DateTime RevoveryTime { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">然后在客户端调用，使用这个新的在客户端定义的类型作为服务方法调用的返回值：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> client.RequestService&lt;<span style="color:rgb(0,0,255);line-height:1.5;">MailMessage</span>2&gt;<span style="line-height:1.5;">(request2,
             PWMIS.EnterpriseFramework.Common.DataType.Json,
             mail </span>=&gt;<span style="line-height:1.5;">
             {
                 Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">6,Server Response:【{0}】，\r\n Revovery Time：{1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, mail.Message, mail.RevoveryTime);
             });</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">输出结果跟上面是一样的。这是因为服务端和客户端使用的都是JSON序列化，它是不关心类型的名字的只关心内部数据结构是否一致。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">&nbsp;五、小结</h1> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">上面的过程演示了MSF编写服务端和客户端代码的简单过程，对MSF而言，服务是本质上都是异步调用和返回的，服务方法返回结果不仅支持简单类型，还支持复杂类型；客户端支持多种调用代码书写方式。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">虽然MSF是基于WCF构建的，但是从本文的示例过程看，<span style="color:rgb(255,0,0);">仅使用MSF，无需掌握任何WCF的知识。</span></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是完整的MSF服务端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是完整的客户端代码：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;font-size:12px;line-height:1.5;">View Code</span> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">下面是运行客户端输出的结果示例：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>******** PDF.NET MSF 客户端测试程序 *********

请输入服务器的主机名或者IP地址(默认 127.0.0.1)：
服务地址：127.0.0.1
请输入服务的端口号(默认 8888)：
服务端口号：8888
当前客户端代理的服务基础地址是：net.tcp://127.0.0.1:8888

MSF 请求-响应 模式调用示例：
1,Server Response:【Hello bluedoctor1 ,I am  MSF Server.】
3,Server Response:【Hello bluedoctor23 ,I am  MSF Server.】
2,Server Response:【Hello bluedoctor23 ,I am  MSF Server.】
7,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
按回车键继续
4,Server Response:【Hello bluedoctor4 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
5,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33
6,Server Response:【Hello bluedoctor567 ,I am  MSF Server.】，
 Revovery Time：2017-10-9 15:50:33</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(29,88,209);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">在下一篇，我们将演示MSF的“发布-订阅”通信模式。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">本篇测试程序全部源码，已经上传到GitHub:</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://github.com/bluedoctor/MSFTest" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">https://github.com/bluedoctor/MSFTest</a></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p><font><span style="font-size:15px;">&nbsp; &nbsp; 本文转自深蓝医生博客园博客，原文链接：http://www.cnblogs.com/bluedoctor/p/7632887.html</span></font><span style="font-size:15px;font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
