<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>探索 OpenStack 之（14）：OpenStack 中 RabbitMQ 的使用 « NotBeCN</title>
  <meta name="description" content="             本文是 OpenStack 中的 RabbitMQ 使用研究 两部分中的第一部分，将介绍 RabbitMQ 的基本概念，即&nbsp;RabbitMQ 是什么。第二部分将介绍其在 OpenStack 中的使用。    &nbsp;    1 RabbitMQ 的基本概念    Rabbi...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/18/weixin_33704234_90125668.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">探索 OpenStack 之（14）：OpenStack 中 RabbitMQ 的使用</h1>
    <p class="post-meta">Nov 18, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本文是 OpenStack 中的 RabbitMQ 使用研究 两部分中的第一部分，将介绍 RabbitMQ 的基本概念，即&nbsp;RabbitMQ 是什么。<a href="http://www.cnblogs.com/sammyliu/p/4335339.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">第二部分</a>将介绍其在 OpenStack 中的使用。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1 RabbitMQ 的基本概念</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">RabbitMQ 是实现了高级消息队列协议（AMQP）的开源消息代理软件（亦称面向消息的中间件）。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://www.amqp.org/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">AMQP&nbsp;</a>是一个定义了在应用或者组织之间传送消息的协议的开放标准 （an open standard for passing business messages between applications or organizations），它最新的版本是 1.0。AMQP 目标在于解决在两个应用之间传送消息存在的下列问题：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">网络是不可靠的 =&gt;消息需要保存后再转发并有出错处理机制</li> 
    <li style="list-style-type:disc;">与本地调用相比，网络速度慢 =&gt;得异步调用</li> 
    <li style="list-style-type:disc;">应用之间是不同的（比如不同语言实现、不同操作系统等） =&gt;得与应用无关</li> 
    <li style="list-style-type:disc;">应用会经常变化 =&gt;同上</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">AMQP 使用异步的、应用对应用的、二进制数据通信来解决这些问题。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://www.rabbitmq.com/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">RabbitMQ&nbsp;</a>是 AMQP 的一种实现，它包括Server （服务器端）、Client （客户端） 和 Plugins （插件）。RabbitMQ 服务器是用 Erlang 语言编写的，其最新版本是刚刚（2015/02/11）发布的&nbsp;<a href="https://www.rabbitmq.com/releases/rabbitmq-server/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">3.4.4</a>，而 OpenStack Juno 中使用的 Server 是 2014年3月发布的 3.2.4 版本。现在 RabbitMQ 支持的 AMQP 版本依然是0.9.1。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span style="line-height:1.5;font-size:14px;">1.1 RabbitMQ 的概念非常清晰、简洁</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">其基本概念参见下图：</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog/697113/201502/160955370968420.jpg" alt="" style="border:0px;line-height:1.5;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">RabbitMQ&nbsp;<a href="https://www.rabbitmq.com/amqp-0-9-1-reference.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">官网</a>&nbsp;和其它网站上有很多文章来描述其基本概念。简单说明如下：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"> <strong>Message （消息）</strong>：RabbitMQ 转发的二进制对象，包括Headers（头）、Properties （属性）和 Data （数据），其中数据部分不是必要的。具体见 1.2 部分的描述。</li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;"><strong>Producer（生产者）</strong>： 消息的生产者，负责产生消息并把消息发到交换机 Exhange的应用。</span></li> 
    <li style="list-style-type:disc;"> <strong>Consumer （消费者）</strong>：使用队列 Queue 从 Exchange 中获取消息的应用。</li> 
    <li style="list-style-type:disc;"> <strong>Exchange （交换机）</strong>：负责接收生产者的消息并把它转到到合适的队列 Queue 。下面有 1.3 部分描述。</li> 
    <li style="list-style-type:disc;"> <p style="line-height:1.5;"><span style="line-height:1.5;"><strong>Queue （队列）</strong>：一个存储Exchange 发来的消息的缓冲，并将消息主动发送给Consumer，或者 Consumer 主动来获取消息。见 1.4 部分的描述。</span></p> </li> 
    <li style="list-style-type:disc;"> <strong>Binding （绑定）</strong>：队列 和 交换机 之间的关系。Exchange 根据消息的属性和 Binding 的属性来转发消息。绑定的一个重要属性是 binding_key。</li> 
    <li style="list-style-type:disc;"> <strong>Connection （连接）和 Channel （通道）</strong>：生产者和消费者需要和 RabbitMQ 建立 TCP 连接。一些应用需要多个connection，为了节省TCP 连接，可以使用 Channel，它可以被认为是一种轻型的共享 TCP 连接的连接。连接需要用户认证，并且支持 TLS (SSL)。连接需要显式关闭。</li> 
    <li style="list-style-type:disc;"><img src="https://images0.cnblogs.com/blog/697113/201502/151659179171057.jpg" alt="" style="border:0px;"></li> 
    <li style="list-style-type:disc;"> <strong>Virtual Host （虚拟主机）</strong>&nbsp;：RabbitMQ 用来进行资源隔离的机制。一个虚机主机会隔离用户、exchange、queue 等。默认的虚拟主机为 "/"。</li> 
   </ul>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><strong>1.2 关于消息 message</strong></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong>消息结构：</strong></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog/697113/201502/151703080897171.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong>消息的几个重要属性：</strong></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">routing_key：Direct 和 Topic 类型的 exchange 会根据本属性来转发消息。</li> 
    <li style="list-style-type:disc;"> <p style="line-height:1.5;">delivery_mode: 将其值设置为 2 将用于消息的持久化，持久化的消息会被保存到磁盘上来防止其丢失。下面章节 3 有描述。</p> </li> 
    <li style="list-style-type:disc;">reply_to：一般用来表示RPC实现中客户端的回调队列的名字。下面章节 4 有描述。</li> 
    <li style="list-style-type:disc;">correlation_id：用于使用 RabbitMQ 来实现 RPC的情形。下面章节 4 有描述。</li> 
    <li style="list-style-type:disc;">content_type：表示消息data的编码格式名称。实际上RabbitMQ只负责原样传送消息因此不会使用该属性，该属性只被 Publisher 和 Consumer 使用。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong>消息的确认/删除机制：</strong></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Consumer 处理消息可能会失败，那么 RabbitMQ 怎么知道什么时候来删除 queue 中的消息呢？它使用两种机制：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">当 RabbitMQ 主动将消息发给 Consumer 以后，它会删除消息</li> 
    <li style="list-style-type:disc;">当 Consumer 发回一个确认后，RabbitMQ 会删除消息。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">第二种情况下，如果 RabbitMQ 没收到确认，它会把消息重新放进队列（re-queued）并添加标识 '<span class="code" style="line-height:1.5;">redelivered' 表明该消息之前已经发送过&nbsp;</span>，如果没有Consumer的话，消息将保持到有下一个 Consumer 为止。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Consumer 可以主动告诉 RabbitMQ 消息处理失败了（拒绝消息），并告知RabbitMQ 是删除消息还是重新放进队列。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><strong style="font-size:1.17em;line-height:1.5;">1.3 exchange 交换机</strong></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong style="font-size:1.17em;line-height:1.5;">exchange 有几个重要的属性：</strong></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">Name 名字：交换机名字。空字符串名字的exchange为默认的exchange。</li> 
    <li style="list-style-type:disc;">Type 类型：Direct, Fanout, Topic, Headers。类型决定 exchange 的消息转发能力。下面 章节2 有描述。</li> 
    <li style="list-style-type:disc;">durable：值为 True/False。值为 true 的 exchange 在 rabbitmq 重启后会被自动创建。OpenStack 使用的exchange的该值都为false。</li> 
    <li style="list-style-type:disc;">auto_delete：值为 True/False。设置为 true 的话，当所有消费者的连接都关闭后，该 exchange 会被自动删除。OpenStack 使用的exchange的该值都为false。</li> 
    <li style="list-style-type:disc;">exclusive：值为 True/False。设置为 true 的话，该 exchange 只允许被创建的connection使用，并且在该 connection 关闭后它会被自动删除。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><strong>RabbitMQ 默认会为每一种类型生成一个或者两个的默认的 exchange：</strong></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">Fanout 类型：名字为 amq.fanout</li> 
    <li style="list-style-type:disc;">Topic 类型: 名字为 amq.topic</li> 
    <li style="list-style-type:disc;">Headers 类型：名字为&nbsp;amq.match 和&nbsp;amq.headers</li> 
    <li style="list-style-type:disc;">Direct 类型：名字为空字符串的exchange 以及 amq.direct。其中名字为空的exchange比较特殊。在一个 Queue 被创建后，RabbitMQ 会自动建立它和该 exchange 之间的binding，并且设置其 binding_key 为该queue 的名字。这样，该语句&nbsp;<span class="n" style="line-height:1.5;">channel<span class="o" style="line-height:1.5;">.<span class="n" style="line-height:1.5;">basic_publish<span class="p" style="line-height:1.5;">(<span class="n" style="line-height:1.5;">exchange<span class="o" style="line-height:1.5;">=<span class="s" style="line-height:1.5;">''<span class="p" style="line-height:1.5;">,&nbsp;<span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;">routing_key<span class="o" style="line-height:1.5;">=<span class="s" style="line-height:1.5;">'hello'<span class="p" style="line-height:1.5;">,<span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="n" style="line-height:1.5;">body<span class="o" style="line-height:1.5;">=<span class="n" style="line-height:1.5;">message<span class="p" style="line-height:1.5;">) 会让该默认的 exchange 将该 message 转发到名字为 'hello' 的队列中。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
   </ul>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span class="n" style="line-height:1.5;">1.4 队列 Queue</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">队列同样有类似于 exchange 的 name、durable、auto_delete 和 exclusive 等属性，并且含义相同。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">Exchange 会将消息分发（copy）到符合要求的所有队列中。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">Consumer 可以主动获取或者被动接受Queue里面的消息：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"> <span class="n" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">被动接收消息（订阅消息 "push API"）：使用&nbsp;<span style="line-height:1.5;font-size:1em;">basic.</span><span class="method-name" style="line-height:1.5;font-size:1em;">consume(<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.reserved-1" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">short&nbsp;<span class="param-name" style="line-height:1.5;">reserved-1</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.queue" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">queue-name&nbsp;<span class="param-name" style="line-height:1.5;">queue</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.consumer-tag" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">consumer-tag&nbsp;<span class="param-name" style="line-height:1.5;">consumer-tag</span></span></span></a>,<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.no-local" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">no-local&nbsp;<span class="param-name" style="line-height:1.5;">no-local</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.no-ack" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">no-ack&nbsp;<span class="param-name" style="line-height:1.5;">no-ack</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">bit&nbsp;<span class="param-name" style="line-height:1.5;">exclusive</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.no-wait" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">no-wait&nbsp;<span class="param-name" style="line-height:1.5;">no-wait</span></span></span></a>,<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.arguments" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">table&nbsp;<span class="param-name" style="line-height:1.5;">arguments</span></span></span></a>)</span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">&nbsp;方法。见 5.1 示例代码。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    <li style="list-style-type:disc;"> <span class="n" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">主动获取消息 （"pull API"）: 使用&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="line-height:1.5;font-size:1em;">basic.</span><span class="method-name" style="line-height:1.5;font-size:1em;">get(<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.get.reserved-1" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">short&nbsp;<span class="param-name" style="line-height:1.5;">reserved-1</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.get.queue" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">queue-name&nbsp;<span class="param-name" style="line-height:1.5;">queue</span></span></span></a>,&nbsp;<a href="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.get.no-ack" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><span class="parameter" style="line-height:1.5;"><span class="data-type" style="line-height:1.5;">no-ack&nbsp;<span class="param-name" style="line-height:1.5;">no-ack</span></span></span></a>) 方法。</span> </li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">一个 Queue 允许有多个 Consumer，比如利用 RabbitMQ 来实现一个简单的 load balancer。这时候，消息会在这些 Consumer 之间根据 channel 的 prefetch level 做分发（请参见AQMP：&nbsp;QoS or message prefetching），如果该值一样的话，消息会被平均分发给这些Consumer。</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"> <span style="line-height:1.5;font-size:1.17em;">1.5&nbsp;</span><strong style="font-size:1.17em;line-height:1.5;">rabbitmqctl</strong><span style="line-height:1.5;font-size:1.17em;">&nbsp; Cli</span> </h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">RabbitMQ 提供Cli &nbsp;<strong>rabbitmqctl</strong>&nbsp;[-n &lt;node&gt;] [-q] &lt;command&gt; [&lt;command options&gt;] 来进行管理和配置。常用到的命令有：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">stop/start_app</li> 
    <li style="list-style-type:disc;">add/delete/list_vhosts</li> 
    <li style="list-style-type:disc;">list_queues/exchanges/<span style="line-height:1.5;">bindings/</span><span style="line-height:1.5;">connections/</span><span style="line-height:1.5;">channels</span> </li> 
    <li style="list-style-type:disc;"><span style="line-height:1.5;">trace_on/off</span></li> 
   </ul>
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">2 消息转发机制</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Exchange 根据它自身的类型 type、消息的属性 routing_key 或者 headers，以及 Binding 的属性 binding_key 来转发消息。</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <tbody>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Exchange 的类型 Type</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">使用的消息属性</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">使用的Binding 属性</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">转发模式</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Fanout</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">- (忽略消息的转发属性）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">- （忽略binding的转发属性）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">Exchange 将消息转发到所有与它有 binding 关系的队列中。</p> <p style="line-height:1.5;">这种方法转发效率较高。OpenStack 大量使用这种类型的 exchange。</p> </td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Direct</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">routing_key （任意的字符串，比如 "abc"）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">binding_key （任意的字符串，比如 "abc"）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Exchange 只将消息转到 binding 的 binding_key 等于消息的 routing_key 的队列中。</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Topic</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">routing_key （以 "." 分割的多单词字符串，比如 abc.efg.hij）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">binding_key （包含 "#" 和 "*" 的以 “.” 分割的多单词字符串，比如 *.efg.*）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">Exchange&nbsp;只将消息转到消息的 routing_key 和 binding 的 binding_key 匹配的队列中。匹配规则如下：</p> <p style="line-height:1.5;">（1）两者以"."分割的单词数目相同</p> <p style="line-height:1.5;">（2）"*"可代表一个单词</p> <p style="line-height:1.5;">（3）"#“可代表零个或多个单词</p> </td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">Headers</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">headers （消息头）</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">binding_key</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">Exchange&nbsp;只将消息转到消息的 headers 和 binding 的 binding_key 匹配的队列中。匹配规则待研究。</p> <p style="line-height:1.5;">OpenStack不使用该类型的exchange。</p> </td> 
     </tr>
    </tbody>
   </table>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">参考文档：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://www.rabbitmq.com/getstarted.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://www.rabbitmq.com/getstarted.html</a>&nbsp;这里有详细的阐述和示例源代码。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://www.cnblogs.com/starof/p/4173413.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://www.cnblogs.com/starof/p/4173413.html</a>&nbsp;这里有官网文档的中文版。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3 持久化</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">消息的持久化意味着在 RabbitMQ 被重启后，消息依然还在。要实现持久化，得实现几个相关组件的持久化：</p> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"> 
    <p align="left" style="line-height:1.5;"><span style="line-height:1.5;">（1）. 交换机的持久化，需要将其&nbsp;<span style="line-height:1.5;">durable 属性设为 true。chan.exchange_declare(exchange="sorting_room", type="direct",&nbsp;<strong>durable=True</strong>, auto_delete=False,)</span></span></p> 
    <p align="left" style="line-height:1.5;"><span style="line-height:1.5;">（2）. 队列的持久化，需要将其<span style="line-height:1.5;">&nbsp;durable 属性设置为 true。chan.queue_declare(queue="po_box",&nbsp;<strong>durable=True</strong>, exclusive=False, auto_delete=False)</span></span></p> 
    <div>
     <span style="line-height:1.5;">（3）. 消息的持久化，需要将其<span style="line-height:1.5;">&nbsp;Delivery Mode 属性设置成<span style="line-height:1.5;">2&nbsp;。msg.properties["<strong>delivery_mode</strong>"] = 2</span></span></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4 RPC</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">可以使用 RabbitMQ 来实现 RPC 机制，这里说说其实现原理：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog/697113/201502/151536557764975.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">过程：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）. 客户端 Client 设置消息的 routing key 为 Service 的队列 op_q；设置消息的 reply-to 属性为返回的 response 的目标队列 reponse_q，设置其 correlation_id 为以随机UUID，然后将消息发到 exchange。比如&nbsp;channel.basic_publish(exchange='', routing_key='op_q', properties=pika.BasicProperties(reply_to = reponse_q, correlation_id = self.corr_id),body=request)</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）. Exchange 将消息转发到 Service 的&nbsp;op_q</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）. Service 收到该消息后进行处理，然后将response 发到 exchange，并设置消息的 routing_key 为原消息的 reply_to 属性，以及设置其 correlation_id 为原消息的&nbsp;correlation_id&nbsp;。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">ch.basic_publish(exchange='', routing_key=props.reply_to, properties=pika.BasicProperties(correlation_id = props.correlation_id), body=str(response))</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）. Exchange 将消息转发到&nbsp;reponse_q</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）. Client 逐一接受 response_q 中的消息，检查消息的&nbsp;<span class="code" style="line-height:1.5;">correlation_id 是否为等于它发出的消息的<span class="code" style="line-height:1.5;">correlation_id，是的话表明该消息为它需要的response。</span></span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">&nbsp;<a href="https://www.rabbitmq.com/tutorials/tutorial-six-python.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">这里</a>有详细的阐述。</span></p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;font-size:1.17em;">5 Python AMQP SDK</span></h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">常用的Python AMQP SDK包括：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">py-amqplib （支持 AMQP 0.8）：&nbsp;<a href="http://barryp.org/software/py-amqplib/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://barryp.org/software/py-amqplib/</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
    <li style="list-style-type:disc;"> <span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">pika （支持 AMQP 0.9.1，Python 2.6 和 2.7）：<a href="https://github.com/pika/pika" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://github.com/pika/pika</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="line-height:1.5;">&nbsp;</span> </li> 
    <li style="list-style-type:disc;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="s" style="line-height:1.5;"><span class="p" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="p" style="line-height:1.5;">txamqp:&nbsp;<a href="https://launchpad.net/txamqp" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://launchpad.net/txamqp</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
   </ul>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span class="n" style="line-height:1.5;">5.1 一个简单的使用 py-amqplib 的&nbsp;Consumer 实现</span></h3> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">#创建Connection和Channel连接到 RabbitMQ 服务器</span>
conn = amqp.Connection(host=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">localhost:5672</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, userid=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">guest</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, password=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">1111</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, virtual_host=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, insist=<span style="line-height:1.5;">False)
chan </span>=<span style="line-height:1.5;"> conn.channel()

</span><span style="color:rgb(0,0,255);line-height:1.5;">#创建 queue</span>
result = chan.queue_declare(queue=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">debug</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, durable=True, exclusive=False, auto_delete=<span style="line-height:1.5;">False)

</span><span style="color:rgb(0,0,255);line-height:1.5;">#创建 exchange</span>
result = chan.exchange_declare(exchange=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sorting_room2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">topic</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, durable=True, auto_delete=<span style="line-height:1.5;">False,)

</span><span style="color:rgb(0,0,255);line-height:1.5;">#创建 binding</span>
result = chan.queue_bind(queue=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">debug</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, exchange=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sorting_room2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, routing_key=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">*.debug</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)

</span><span style="color:rgb(0,0,255);line-height:1.5;">#回调函数，当有 message 到达 queue 后，该函数会被调用</span>
<span style="color:rgb(0,0,255);line-height:1.5;">def</span><span style="line-height:1.5;"> recv_callback(msg):
    </span><span style="color:rgb(0,0,255);line-height:1.5;">print</span> <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">Received: </span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> + msg.body + <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;"> from channel #</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> +<span style="line-height:1.5;"> str(msg.channel.channel_id)<br>
# </span><span class="n" style="line-height:1.5;">lChannel<span class="o" style="line-height:1.5;">.<span class="n" style="line-height:1.5;">basic_ack<span class="p" style="line-height:1.5;">(<span class="n" style="line-height:1.5;">msg<span class="o" style="line-height:1.5;">.<span class="n" style="line-height:1.5;">delivery_tag<span class="p" style="line-height:1.5;">) <span style="color:rgb(0,0,255);line-height:1.5;">#如果no_ack=False的话，可以需要发回一个确认</span></span></span></span></span></span></span></span></span></pre> 
    <pre><span style="line-height:1.5;"><br><span style="color:rgb(0,0,255);line-height:1.5;">#启动一个 consumer，consumer_tag 是该 consumer 的一个唯一标识符<br></span><span style="color:rgb(0,0,255);line-height:1.5;">#</span></span><span style="color:rgb(0,0,255);line-height:1.5;">no_ack = True 表示该 consumer 不会发回确认</span><br><span style="line-height:1.5;">chan.basic_consume(queue</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">debug</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, no_ack=True, callback=recv_callback, consumer_tag=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">debugtag</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">) </span></pre> 
    <pre><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">#等待有消息发到 queue </span></span><em><span style="color:rgb(0,0,255);line-height:1.5;">while</span><span style="line-height:1.5;"> True: chan.wait()<br><br></span></em><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">#终止该 consumer</span></span><em><span style="line-height:1.5;"> chan.basic_cancel(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">testtag</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">) </span></em><span style="color:rgb(0,0,255);line-height:1.5;">#关闭 connection 和 channel</span><em>
<span style="line-height:1.5;">chan.close() conn.close()</span></em></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">5.2 一个简单的<span class="n" style="line-height:1.5;">使用&nbsp;py-amqplib 的&nbsp;</span><span style="line-height:1.5;font-size:1.17em;">Producer 实现代码</span> </h3> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">from</span> amqplib <span style="color:rgb(0,0,255);line-height:1.5;">import</span><span style="line-height:1.5;"> client_0_8 as amqp
</span><span style="color:rgb(0,0,255);line-height:1.5;">import</span><span style="line-height:1.5;"> sys
<br><span style="color:rgb(0,0,255);line-height:1.5;">#创建 connection 和 channel</span>
conn </span>= amqp.Connection(host=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">localhost:5672</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, userid=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">guest</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, password=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">1111</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, virtual_host=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, insist=<span style="line-height:1.5;">False)
chan </span>=<span style="line-height:1.5;"> conn.channel()
<br><span style="color:rgb(0,0,255);line-height:1.5;">#创建 message</span>
msg </span>= amqp.Message(sys.argv[1<span style="line-height:1.5;">])
msg.properties[</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">delivery_mode</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>] = 2<br><br><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">#发送 message</span>
chan.basic_publish(msg,exchange</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sorting_room2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,routing_key=(sys.argv[2<span style="line-height:1.5;">]))
<br><span style="color:rgb(0,0,255);line-height:1.5;">#关闭 connection 和 channel</span></span>
<span style="line-height:1.5;">chan.close()
conn.close()</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span style="line-height:1.5;font-size:1.17em;">5.3 使用 pika</span></h3> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;font-size:1.17em;">5.3.1 安装 pika</span></h4> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>wget https:<span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">pypi.python.org/packages/source/p/pika/pika-0.9.14.tar.gz #md5=b99aad4b88961d3c7e4876b8327fc97c  </span>
tar zxvf pika-<span style="color:rgb(128,0,128);line-height:1.5;">0.9</span>.<span style="color:rgb(128,0,128);line-height:1.5;">14</span><span style="line-height:1.5;">.tar.gz  
cd pika</span>-<span style="color:rgb(128,0,128);line-height:1.5;">0.9</span>.<span style="color:rgb(128,0,128);line-height:1.5;">14</span><span style="line-height:1.5;">
python setup.py install</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">5.3.2 使用 pika 编程（<a href="https://github.com/smallfish/rabbitmq-trace/blob/master/rabbitmqtrace.py" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">来源</a>）</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>#!/usr/bin/<span style="line-height:1.5;">env python
</span><span style="color:rgb(128,0,0);line-height:1.5;">'''
</span><span style="line-height:1.5;">rabbitmq trace scripts.
require (rabbitmq_tracing):
    $ sudo rabbitmq</span>-<span style="line-height:1.5;">plugins enable rabbitmq_tracing
usage:
    $ sudo rabbitmqctl trace_on
    $ .</span>/<span style="line-height:1.5;">rabbitmqtrace.py
    </span>&lt;&lt; output &gt;&gt;
<span style="color:rgb(128,0,0);line-height:1.5;">'''
</span><span style="line-height:1.5;">import sys
import time
</span><span style="color:rgb(0,0,255);line-height:1.5;">from</span><span style="line-height:1.5;"> optparse import OptionParser
import pika

__AUTHOR__  </span>= <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">smallfish</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">
__VERSION__ </span>= <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">0.0.1</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">

def _out(args):
    print time.strftime(</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">%Y-%m-%d %H:%M:%S</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">), args

def _run(host, port, vhost, user, password):
    conn </span>= pika.BlockingConnection(pika.ConnectionParameters(host=host, port=port, virtual_host=<span style="line-height:1.5;">vhost,
        credentials</span>=<span style="line-height:1.5;">pika.PlainCredentials(user, password)))
    chan </span>=<span style="line-height:1.5;"> conn.channel()
    def _on_message(ch, method, properties, body):
        ret </span>=<span style="line-height:1.5;"> {}
        ret[</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">routing_key</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>] =<span style="line-height:1.5;"> method.routing_key
        ret[</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">headers</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>] =<span style="line-height:1.5;"> properties.headers
        ret[</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">body</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>] =<span style="line-height:1.5;"> body
        _out(ret)
    _out(</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">start subscribe amq.rabbitmq.trace</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    ret </span>= chan.queue_declare(exclusive=False, auto_delete=<span style="line-height:1.5;">True)
    queue </span>=<span style="line-height:1.5;"> ret.method.queue
    chan.queue_bind(exchange</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">amq.rabbitmq.trace</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, queue=queue, routing_key=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">#</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    chan.queue_bind(exchange</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">amq.rabbitmq.log</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, queue=queue, routing_key=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">#</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    chan.basic_consume(_on_message, queue</span>=queue, no_ack=<span style="line-height:1.5;">True)
    chan.start_consuming()

def main():
    parser </span>= OptionParser(<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">usage: %prog</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    parser.add_option(</span><span style="color:rgb(128,0,0);line-height:1.5;">''</span>, <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">--host</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, metavar=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">host</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">localhost</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, help=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rabbitmq host address, default: %default</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    parser.add_option(</span><span style="color:rgb(128,0,0);line-height:1.5;">''</span>, <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">--port</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, metavar=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">port</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span>=<span style="color:rgb(128,0,128);line-height:1.5;">5672</span>, type=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">int</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, help=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rabbitmq port, default: %default</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    parser.add_option(</span><span style="color:rgb(128,0,0);line-height:1.5;">''</span>, <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">--vhost</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, metavar=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">vhost</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">/</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, help=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rabbitmq vhost, default: %default</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    parser.add_option(</span><span style="color:rgb(128,0,0);line-height:1.5;">''</span>, <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">--user</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, metavar=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">user</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">guest</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, help=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rabbitmq user, default: %default</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    parser.add_option(</span><span style="color:rgb(128,0,0);line-height:1.5;">''</span>, <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">--password</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, metavar=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">password</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span>=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">guest</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>, help=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rabbitmq password, default: %default</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">)
    (options, args) </span>=<span style="line-height:1.5;"> parser.parse_args()
    _run(options.host, options.port, options.vhost, options.user, options.password)

</span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> __name__ == <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">__main__</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">:
    main()</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="line-height:1.5;font-size:1.17em;">6 插件和消息追踪</span></h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">RabbitMQ 支持使用插件来支持&nbsp;Management， Federation， Shovel &nbsp;和 STOMP。所有的插件都在<a href="https://www.rabbitmq.com/plugins.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">这里</a>。</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span class="n" style="line-height:1.5;">6.1&nbsp;<a href="https://www.rabbitmq.com/management.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">rabbitmq-management</a>&nbsp;插件</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;">它提供&nbsp;HTTP-based API 和&nbsp;browser-based UI 以及 CLI 来管理 RabbitMQ。它的GUI的访问地址是&nbsp;<span style="line-height:1.5;text-decoration:underline;">http://&lt;rabbitmq server ip&gt;:15672/#/traces</span>。它的GUI上，提供了一个 overview，还可以通过它来管理connection、channel、exchange 和 queue，以及 virtual host，tracing 和 policy等。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span class="n" style="line-height:1.5;"><img src="https://images0.cnblogs.com/blog/697113/201502/151654335586997.jpg" alt="" style="border:0px;"></span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span style="line-height:1.5;">6.2 RabbitMQ 的 firehose 机制</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">该机制提供了一个查看被转发的消息的途径。当打开 firehose 的时候，RabbitMQ 会自动建立 amq.rabbitmq.trace 和 amq.rabbitmq.log 两个exchange。你可以编程创建queue 从这两个 exchange 里面获取 trace 和 log，从而观察每一个被处理的消息。这里有一个<a href="https://github.com/smallfish/rabbitmq-trace/blob/master/rabbitmqtrace.py" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">开源代码实现</a>。</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">6.3&nbsp;rabbitmq_tracing 插件</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">rabbitmq_tracing 插件在 management 插件增加了消息追踪的方法，它是从 firehose 中获取数据。在激活了&nbsp;<a href="https://www.rabbitmq.com/management.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">rabbitmq-management</a>，firehose 和&nbsp;rabbitmq_tracing，你可以在 management GUI &nbsp;中追踪消息：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog/697113/201502/151516354646055.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">自此，RabbitMQ 基本上算熟悉了，接下来可以开始分析 OpenStack 中是如何使用 RabbitMQ 了。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><code>&nbsp;</code></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;"><font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/4293011.html</span></font><span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
