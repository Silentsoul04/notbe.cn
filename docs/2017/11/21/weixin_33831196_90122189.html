<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>hdu 4035 Maze(期待更多经典的树DP) « NotBeCN</title>
  <meta name="description" content="             Maze    Time Limit: 2000/1000 MS (Java/Others)&nbsp;&nbsp;&nbsp;&nbsp;Memory Limit: 65768/65768 K (Java/Others) Total Submission(s): 1677&nbsp;&...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/21/weixin_33831196_90122189.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">hdu 4035 Maze(期待更多经典的树DP)</h1>
    <p class="post-meta">Nov 21, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="color:rgb(26,92,200);line-height:1.5;font-size:28px;font-family:verdana, Arial, Helvetica, sans-serif;">Maze</h1> 
   <span style="line-height:1.8;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-size:12px;font-family:Arial;color:#008000;">Time Limit: 2000/1000 MS (Java/Others)&nbsp;&nbsp;&nbsp;&nbsp;Memory Limit: 65768/65768 K (Java/Others)<br> Total Submission(s): 1677&nbsp;&nbsp;&nbsp;&nbsp;Accepted Submission(s): 638<br><span style="line-height:1.8;color:#FF0000;">Special Judge</span></span></strong></span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Problem Description
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    When wake up, lxhgww find himself in a huge maze.
    <br>
    <br> The maze consisted by N rooms and tunnels connecting these rooms. Each pair of rooms is connected by one and only one path. Initially, lxhgww is in room 1. Each room has a dangerous trap. When lxhgww step into a room, he has a possibility to be killed and restart from room 1. Every room also has a hidden exit. Each time lxhgww comes to a room, he has chance to find the exit and escape from this maze.
    <br>
    <br> Unfortunately, lxhgww has no idea about the structure of the whole maze. Therefore, he just chooses a tunnel randomly each time. When he is in a room, he has the same possibility to choose any tunnel connecting that room (including the tunnel he used to come to that room).
    <br> What is the expect number of tunnels he go through before he find the exit? 
    <p></p> 
    <p><br></p> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Input
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    First line is an integer T (T ≤ 30), the number of test cases.
    <br>
    <br> At the beginning of each case is an integer N (2 ≤ N ≤ 10000), indicates the number of rooms in this case.
    <br>
    <br> Then N-1 pairs of integers X, Y (1 ≤ X, Y ≤ N, X ≠ Y) are given, indicate there is a tunnel between room X and room Y.
    <br>
    <br> Finally, N pairs of integers Ki and Ei (0 ≤ Ki, Ei ≤ 100, Ki + Ei ≤ 100, K1 = E1 = 0) are given, indicate the percent of the possibility of been killed and exit in the ith room.
    <br>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Output
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    For each test case, output one line “Case k: ”. k is the case id, then the expect number of tunnels lxhgww go through before he exit. The answer with relative error less than 0.0001 will get accepted. If it is not possible to escape from the maze, output “impossible”.
    <br>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Sample Input
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <pre>
</pre> 
    <div style="font-family:'Courier New', Courier, monospace;">
     3 3 1 2 1 3 0 0 100 0 0 100 3 1 2 2 3 0 0 100 0 0 100 6 1 2 2 3 1 4 4 5 4 6 0 0 20 30 40 30 50 50 70 10 20 60
    </div> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Sample Output
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <pre>
</pre> 
    <div style="font-family:'Courier New', Courier, monospace;">
     Case 1: 2.000000 Case 2: impossible Case 3: 2.895522
    </div> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Source
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <a href="http://acm.hdu.edu.cn/search.php?field=problem&amp;key=The+36th+ACM%2FICPC+Asia+Regional+Chengdu+Site+%A1%AA%A1%AA+Online+Contest&amp;source=1&amp;searchmode=source" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">The 36th ACM/ICPC Asia Regional Chengdu Site —— Online Contest</a>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <div class="panel_title" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Recommend
   </div> 
   <div class="panel_content" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    lcy&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;We have carefully selected several similar problems for you:&nbsp;&nbsp;
    <a href="http://acm.hdu.edu.cn/showproblem.php?pid=4037" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">4037</a>&nbsp;
    <a href="http://acm.hdu.edu.cn/showproblem.php?%3C/p%3E%3Cp%3Epid=4036" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">4036</a>&nbsp;
    <a href="http://acm.hdu.edu.cn/showproblem.php?pid=4033" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">4033</a>&nbsp;
    <a href="http://acm.hdu.edu.cn/showproblem.php?pid=4038" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">4038</a>&nbsp;
    <a href="http://acm.hdu.edu.cn/showproblem.php?pid=4039" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">4039</a>&nbsp;
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
    <span style="line-height:1.8;font-size:18px;">题意：</span> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <span style="line-height:1.8;font-size:18px;">一些房间构成一个树形的迷宫。 </span>
    <p></p> 
    <p>你開始在以后房间。</p> 
    <p>你每一个房间你有ki的概率被杀掉。</p> 
    <p>ei的概率逃出迷宫。假设既没被杀掉又没逃出去。你就会随机选一条能走的边走，最后问你走出这个迷宫须要走的边数的期望。</p> 
    <p></p> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">思路：</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <span style="line-height:1.8;font-size:18px;">对于期望DP。非常easy想到状态E[i]表示眼下在i这个点。逃出迷宫须要走的边数的期望。 </span>
    <p></p> 
    <p>然后也能够写出状态转移方程</p> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">E[i]=ki*E[1]+0*ei+(1-ei-ki)*Σ(E[j]+1)/eds[i].</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <span style="line-height:1.8;font-size:18px;">j为i所连的点。eds[i]为i的边数。可是发现这个方程全然就不可解。由于方程有环。可是数据量太大高斯消元的话时间复杂明显太高。 </span>
    <p></p> 
    <p>所以最后还是没做出来。然后就仅仅有看题解咯。</p> 
    <p>还是做题太少啊。这题被我忽略了非常重要的一点那就是这是一颗树而不是一张图。</p> 
    <p>而我的方程全然没体现它是树的特点。</p> 
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">假设依照树来写的话，方程应该是这种。</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;"><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20140918152942406" alt="" style="border:0px;"><br></span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">j为i的儿子。fa为i的父亲。</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">通过观察。能够设E[i]=A[i]*E[1]+B[i]*E[fa]+C[i]。</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">然后</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;"><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20140918153515979" alt="" style="border:0px;"></span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;"><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20140918153719765" alt="" style="border:0px;"><br></span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <span style="line-height:1.8;font-size:18px;">然后就上代码了：</span>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <span style="line-height:1.8;font-size:18px;"></span>
    <pre><code class="language-cpp">#include&lt;algorithm&gt;
#include&lt;iostream&gt;
#include&lt;string.h&gt;
#include&lt;stdio.h&gt;
#include&lt;math.h&gt;
using namespace std;
const int INF=0x3f3f3f3f;
const int maxn=10010;
const double eps=1e-10;//開始-6wa了。精度要高点才行。
typedef long long ll;
struct node
{
    int v;
    node *next;
} ed[maxn&lt;&lt;1],*head[maxn];
int cnt,eds[maxn];
double A[maxn],B[maxn],C[maxn],ki[maxn],ei[maxn];
void adde(int u,int v)
{
    ed[cnt].v=v;
    ed[cnt].next=head[u];
    head[u]=&amp;ed[cnt++];
}
void dfs(int fa,int u)
{
    double sa,sb,sc,mi;
    sa=sb=sc=0;
    for(node *p=head[u];p!=NULL;p=p-&gt;next)
    {
        if(p-&gt;v==fa)
            continue;
        dfs(u,p-&gt;v);
        sa+=A[p-&gt;v];
        sb+=B[p-&gt;v];
        sc+=C[p-&gt;v];
    }
    mi=(1-ki[u]-ei[u])/eds[u];
    A[u]=(ki[u]+mi*sa)/(1-mi*sb);
    B[u]=mi/(1-mi*sb);
    C[u]=(1+mi*sc-ki[u]-ei[u])/(1-mi*sb);
}
int main()
{
    int t,cas=1,n,i,u,v;

    scanf("%d",&amp;t);
    while(t--)
    {
        scanf("%d",&amp;n);
        cnt=0;
        memset(head,0,sizeof head);
        memset(eds,0,sizeof eds);
        for(i=1;i&lt;n;i++)
        {
            scanf("%d%d",&amp;u,&amp;v);
            eds[u]++,eds[v]++;
            adde(u,v);
            adde(v,u);
        }
        for(i=1;i&lt;=n;i++)
        {
            scanf("%lf%lf",&amp;ki[i],&amp;ei[i]);
            ki[i]/=100,ei[i]/=100;
        }
        dfs(-1,1);
        printf("Case %d: ",cas++);
        if(fabs(1-A[1])&lt;eps)
            printf("impossible\n");
        else
            printf("%f\n",C[1]/(1-A[1]));
    }
    return 0;
}
</code></pre> 
    <br>
    <br>
   </div> 
   <div class="panel_bottom" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;">版权声明：本文博客原创文章，博客，未经同意，不得转载。</p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:12px;"><br></p> 
    <p><font color="#333333"><span style="font-size:12px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/4655446.html，如需转载请自行联系原作者</span></font></p> 
    <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
