<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>使用Lua脚本语言开发出高扩展性的系统，AgileEAS.NET SOA中间件Lua脚本引擎介绍 « NotBeCN</title>
  <meta name="description" content="                  一、前言     &nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA 中间件平台是一款基于基于敏捷并行开发思想和Microsoft .Net构件(组件)开发技术而构建的一个快速开发应用平台。用于帮助中小型软件企业建立一条适合市场快速变化的开发团队...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/21/weixin_34407348_90119716.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">使用Lua脚本语言开发出高扩展性的系统，AgileEAS.NET SOA中间件Lua脚本引擎介绍</h1>
    <p class="post-meta">Nov 21, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:15px;"> 
    <h1 style="font-size:28px;line-height:1.5;">一、前言</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA 中间件平台是一款基于基于敏捷并行开发思想和Microsoft .Net构件(组件)开发技术而构建的一个快速开发应用平台。用于帮助中小型软件企业建立一条适合市场快速变化的开发团队，以达到节省开发成本、缩短开发时间，快速适应市场变化的目的。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA中间件平台提供了敏捷快速开发软件工程的最佳实践，通过提供大量的基础支撑功能如IOC、ORM、SOA、分布式体系及敏捷并发开发方法所支撑的插件开发体系，以及提供了大量的实体、数据模型设计生成工具、代码生成工具，用于帮助中小软件开发商快速成长。</p> 
    <p><img src="https://images.cnblogs.com/cnblogs_com/eastjade/AgileEAS.NET.png" alt="" style="border:0px;"></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET平台充分把握目前软件行业快速发展的新趋势，基于敏捷并行开发、快速适应市场这样淳朴的软件工程实践，采用业界广泛使用的Microsoft .Net构件(组件)开发技术实践了这种开发思想，帮助软件企业实现“敏捷变化、快速适合”的目标，从而帮助软件企业在激烈的市场竞争中赢得先机并获得更高的回报。</p> 
    <h1 style="font-size:28px;line-height:1.5;">二、关于Lua语言</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; Lua 是一个小巧的<a href="http://baike.baidu.com/view/76320.htm" rel="nofollow" style="color:#008000;text-decoration:none;">脚本语言</a>。是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组，由Roberto Ierusalimschy、Waldemar Celes 和 Luiz Henrique de Figueiredo所组成并于1993年开发。 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; Lua语言目前应用最广泛的领域是游戏编程领域，最早接触和认识Lua也是因为在2008年玩金山的剑网3，通过解包读过其中的一些游戏脚本，慢慢也看过一些其他游戏的Lua脚本，在我们开发自己的电子病历系统的过程之中，引入了Lua脚本语言实现那些可变性非常高的场景。</p> 
    <p>&nbsp;&nbsp;&nbsp; .NET通过<a href="http://www.baidu.com/link?url=lazmpEBwr7CzVtf_ZONmrTWGX9k8h0MUE9JpXwk6zElfvP2qQv6GrCZ7ZgXF9A4nkIvm9n-NuhiZnjxxfYg4C_" rel="nofollow" style="color:#008000;text-decoration:none;"><em>LuaInterface</em></a>开源项目类库实现对Lua的脚本调用以及Lua与C#的相互绑定，有关于这此方面的内容请大家搜索相关文章以获得帮助。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 在AgileEAS.NET SOA5.0版本之中，我们决定把在开发过程之中形成的Lua脚本引擎一并集成入AgileEAS.NET SOA中间件平台,目前Lua脚本语言被我们广泛的应用电子病历系统这中的病案自动评分、短信系统之中的交互式应答、和一些计划任系统之中的计划任务定义。</p> 
    <h1 style="font-size:28px;line-height:1.5;">三、AgileEAS.NET SOA平台Lua引擎</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA5.0平台目前使用的是Lua5.1版本，使用<a href="http://www.baidu.com/link?url=lazmpEBwr7CzVtf_ZONmrTWGX9k8h0MUE9JpXwk6zElfvP2qQv6GrCZ7ZgXF9A4nkIvm9n-NuhiZnjxxfYg4C_" rel="nofollow" style="color:#008000;text-decoration:none;"><em>LuaInterface</em></a>实现C#与Lua的相互绑定处理，平台已经对其进行了二次封装以提供统一的API支持，目前由EAS.LuaScript.dll程序集承载所有业务。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA平台Lua引擎提供了以下接口或类型的API：</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color:rgb(255,0,0);font-size:large;">ILuaEngine</span></strong>，定义为一个Lua脚本引擎：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">namespace</span> EAS.LuaScript</pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span>     <span style="color:rgb(0,128,0);">/// Lua脚本解析引擎。  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;remarks&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// 用于完成程序之中嵌入的动态Lua脚本，Lua脚本在AgileEAS.NET SOA 中间件之中主要用于环境的各种参数的动态解析处理之中。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/remarks&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">interface</span> ILuaEngine:IDisposable</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>         <span style="color:rgb(0,128,0);">/// 脚本路径。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">string</span> ScriptDirectory</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>             get;</pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>             set;</pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,128,0);">/// 输出重定向方法/用于调试。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>         Action&lt;<span style="color:rgb(0,0,255);">object</span>&gt; OutAction</pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>             get;</pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>             set;</pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  32:</span>         <span style="color:rgb(0,128,0);">/// 注册lua函数，实现Lua绑定。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  33:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  34:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="luaAPIClass"&gt;lua函数类&lt;/param&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  35:</span>         <span style="color:rgb(0,0,255);">void</span> BindLuaFunctions(<span style="color:rgb(0,0,255);">object</span> luaAPIClass);</pre> 
      <pre><span style="color:rgb(96,96,96);">  36:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  37:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  38:</span>         <span style="color:rgb(0,128,0);">/// 执行lua脚本文件。 </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  39:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  40:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="luaFileName"&gt;脚本文件名。&lt;/param&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  41:</span>         <span style="color:rgb(0,128,0);">/// &lt;returns&gt;lua脚本执行结果。&lt;/returns&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  42:</span>         <span style="color:rgb(0,0,255);">object</span>[] DoFile(<span style="color:rgb(0,0,255);">string</span> luaFileName);</pre> 
      <pre><span style="color:rgb(96,96,96);">  43:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  44:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  45:</span>         <span style="color:rgb(0,128,0);">/// 执行lua脚本文本。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  46:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  47:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="chunk"&gt;lua指令。&lt;/param&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  48:</span>         <span style="color:rgb(0,128,0);">/// &lt;returns&gt;lua脚本执行结果。&lt;/returns&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  49:</span>         <span style="color:rgb(0,0,255);">object</span>[] DoString(<span style="color:rgb(0,0,255);">string</span> chunk);</pre> 
      <pre><span style="color:rgb(96,96,96);">  50:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  51:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  52:</span>         <span style="color:rgb(0,128,0);">/// 调用Lua函数。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  53:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  54:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="luaFunction"&gt;函数名称。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  55:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="args"&gt;调用参数。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  56:</span>         <span style="color:rgb(0,128,0);">/// &lt;returns&gt;lua脚本执行结果。&lt;/returns&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  57:</span>         <span style="color:rgb(0,0,255);">object</span>[] Invoke(<span style="color:rgb(0,0,255);">string</span> luaFunction, <span style="color:rgb(0,0,255);">params</span> <span style="color:rgb(0,0,255);">object</span>[] args);</pre> 
      <pre><span style="color:rgb(96,96,96);">  58:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  59:</span> }</pre> 
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 其中脚本路径ScriptDirectory指示Lua脚本文件的存储位置，在DoFile执行脚本文过程之中如果传入为相关路径则可以自动在ScriptDirectory之中寻址，ScriptDirectory默认为当前程序目录。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; DoFile：执行脚本文件并且返回执行结果。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; DoString：执行脚本代码并且返回执行结果。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; Invoke：执行指定的脚本函数。</p> 
    <p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">LuaFunctionAttribute</span></strong>，Lua脚本函数特性：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> EAS.LuaScript</pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// Lua函数描述特性。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;  </span></pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,128,0);">/// &lt;remarks&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     <span style="color:rgb(0,128,0);">/// 用于标记Lua接口方法。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>     <span style="color:rgb(0,128,0);">/// &lt;/remarks&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>     [AttributeUsage(AttributeTargets.Method,</pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>                     Inherited = <span style="color:rgb(0,0,255);">false</span>, AllowMultiple = <span style="color:rgb(0,0,255);">false</span>)]</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>     [Serializable]</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>     <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">class</span> LuaFunctionAttribute : Attribute</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">/// 初始化LuaFunctionAttribute对象实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="name"&gt;函数名称。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,0,255);">public</span> LuaFunctionAttribute(<span style="color:rgb(0,0,255);">string</span> name)</pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>             : <span style="color:rgb(0,0,255);">this</span>(name, <span style="color:rgb(0,0,255);">string</span>.Empty)</pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>         <span style="color:rgb(0,128,0);">/// 初始化LuaFunctionAttribute对象实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  32:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="name"&gt;函数名称。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  33:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="description"&gt;函数描述。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  34:</span>         <span style="color:rgb(0,0,255);">public</span> LuaFunctionAttribute(<span style="color:rgb(0,0,255);">string</span> name, <span style="color:rgb(0,0,255);">string</span> description)</pre> 
      <pre><span style="color:rgb(96,96,96);">  35:</span>             : <span style="color:rgb(0,0,255);">this</span>(name, description,<span style="color:rgb(0,0,255);">null</span>)</pre> 
      <pre><span style="color:rgb(96,96,96);">  36:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  37:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  38:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  39:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  40:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  41:</span>         <span style="color:rgb(0,128,0);">/// 初始化LuaFunctionAttribute对象实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  42:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  43:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="name"&gt;函数名称。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  44:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="description"&gt;函数描述。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  45:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="funcParams"&gt;参数说明。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  46:</span>         <span style="color:rgb(0,0,255);">public</span> LuaFunctionAttribute(<span style="color:rgb(0,0,255);">string</span> name, <span style="color:rgb(0,0,255);">string</span> description, <span style="color:rgb(0,0,255);">params</span> <span style="color:rgb(0,0,255);">string</span>[] funcParams)</pre> 
      <pre><span style="color:rgb(96,96,96);">  47:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  48:</span>             <span style="color:rgb(0,0,255);">this</span>.Name = name;</pre> 
      <pre><span style="color:rgb(96,96,96);">  49:</span>             <span style="color:rgb(0,0,255);">this</span>.Description = description;</pre> 
      <pre><span style="color:rgb(96,96,96);">  50:</span>             <span style="color:rgb(0,0,255);">this</span>.Params = funcParams;</pre> 
      <pre><span style="color:rgb(96,96,96);">  51:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  52:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  53:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  54:</span>         <span style="color:rgb(0,128,0);">/// 函数名称。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  55:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  56:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">string</span> Name</pre> 
      <pre><span style="color:rgb(96,96,96);">  57:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  58:</span>             get;</pre> 
      <pre><span style="color:rgb(96,96,96);">  59:</span>             <span style="color:rgb(0,0,255);">internal</span> set;</pre> 
      <pre><span style="color:rgb(96,96,96);">  60:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  61:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  62:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  63:</span>         <span style="color:rgb(0,128,0);">/// 函数描述。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  64:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  65:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">string</span> Description</pre> 
      <pre><span style="color:rgb(96,96,96);">  66:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  67:</span>             get;</pre> 
      <pre><span style="color:rgb(96,96,96);">  68:</span>             <span style="color:rgb(0,0,255);">internal</span> set;</pre> 
      <pre><span style="color:rgb(96,96,96);">  69:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  70:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  71:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  72:</span>         <span style="color:rgb(0,128,0);">/// 参数说明。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  73:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  74:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">string</span>[] Params</pre> 
      <pre><span style="color:rgb(96,96,96);">  75:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  76:</span>             get;</pre> 
      <pre><span style="color:rgb(96,96,96);">  77:</span>             <span style="color:rgb(0,0,255);">internal</span> set;</pre> 
      <pre><span style="color:rgb(96,96,96);">  78:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  79:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  80:</span> }</pre> 
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 用于C#向Lua暴露函数接口，实现C#方法与Lua脚本函数的绑定，也可以实现为把C#的方法暴露给Lua脚本调用，如以下代码：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,128,0);">/// 执行指定的非查询命令。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,128,0);">/// &lt;param name="commandText"&gt;要执行的命令语句。该语句必须是标准的数据库语句。&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,128,0);">/// &lt;returns&gt;返回命令影响的行数。&lt;/returns&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> [LuaFunction(<span style="color:rgb(0,96,128);">"ExecuteSql"</span>, <span style="color:rgb(0,96,128);">"执行指定的非查询命令，返回执行所影响的行数。"</span>, <span style="color:rgb(0,96,128);">"要执行的SQL语句"</span>)]</pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">int</span> Execute(<span style="color:rgb(0,0,255);">string</span> commandText)</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     IDataAccessor da = <span style="color:rgb(0,0,255);">this</span>.GetComponent();</pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,0,255);">if</span> (da != <span style="color:rgb(0,0,255);">null</span>)</pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">return</span> da.Execute(commandText);</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>     <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">return</span> -1;</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span> }</pre> 
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 其目标早实现C#方法Execute与Lua脚本函数ExecuteSql之间的绑定，当在Lua教本之中调用ExecuteSql，即会执行Execute方法。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);font-size:large;"><strong>LuaFramework</strong></span>，Lua框架，为Lua脚本引用最重要的API：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(204,102,51);">#region</span> 程序集 EAS.LuaScript.dll, v4.0.30319</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,128,0);">// G:\Health.Work\AgileEMR4.0\Publish\EAS.LuaScript.dll</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(204,102,51);">#endregion</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> <span style="color:rgb(0,0,255);">namespace</span> EAS.LuaScript</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">//     Lua脚本执行框架/上下文。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     <span style="color:rgb(0,128,0);">// 备注:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>     <span style="color:rgb(0,128,0);">//     应用系统之中调用Lua脚本的入口。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>     <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> LuaFramework</pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,128,0);">//     LuaFramework对象的唯一实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> LuaFramework Instance { get; }</pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,128,0);">//     注册lua函数，实现Lua绑定。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,128,0);">// 参数:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>         <span style="color:rgb(0,128,0);">//   luaAPIClass:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>         <span style="color:rgb(0,128,0);">//     lua函数类</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">void</span> BindLuaFunctions(<span style="color:rgb(0,0,255);">object</span> luaAPIClass);</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>         <span style="color:rgb(0,128,0);">//     从应用程序上下文环境之中获取指定名称的对象实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span>         <span style="color:rgb(0,128,0);">// 参数:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  32:</span>         <span style="color:rgb(0,128,0);">//   componentKey:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  33:</span>         <span style="color:rgb(0,128,0);">//     组件名称。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  34:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  35:</span>         <span style="color:rgb(0,128,0);">// 返回结果:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  36:</span>         <span style="color:rgb(0,128,0);">//     对象实例。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  37:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">object</span> GetComponent(<span style="color:rgb(0,0,255);">string</span> componentKey);</pre> 
      <pre><span style="color:rgb(96,96,96);">  38:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  39:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  40:</span>         <span style="color:rgb(0,128,0);">//     Lua脚本引擎。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  41:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> ILuaEngine GetLuaEngine();</pre> 
      <pre><span style="color:rgb(96,96,96);">  42:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  43:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  44:</span>         <span style="color:rgb(0,128,0);">//     Lua脚本引擎。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  45:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> ILuaEngine GetLuaEngine(<span style="color:rgb(0,0,255);">string</span> scriptDirectory);</pre> 
      <pre><span style="color:rgb(96,96,96);">  46:</span>         <span style="color:rgb(0,128,0);">//</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  47:</span>         <span style="color:rgb(0,128,0);">// 摘要:</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  48:</span>         <span style="color:rgb(0,128,0);">//     取系统时间。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  49:</span>         [LuaFunction(<span style="color:rgb(0,96,128);">"GetTime"</span>, <span style="color:rgb(0,96,128);">"取系统时间"</span>)]</pre> 
      <pre><span style="color:rgb(96,96,96);">  50:</span>         <span style="color:rgb(0,0,255);">public</span> DateTime GetTime();</pre> 
      <pre><span style="color:rgb(96,96,96);">  51:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  52:</span> }</pre> 
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 其中BindLuaFunctions方法实现C#方法与Lua函数的绑定注册，调用时传入需要注册方法所在的C#类对象实例即可。&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp; GetLuaEngine获取一个<strong><span style="color:rgb(255,0,0);font-size:large;">ILuaEngine</span></strong>，为之后的执行脚本作准备，调用GetLuaEngine可选传入scriptDirectory参数，scriptDirectory为Lua脚本存储目录。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA中间件已经为大家提供了少数的几个预定义API绑定：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> helpcmd(cmdName) - Show help <span style="color:rgb(0,0,255);">for</span> a given command or package</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> help() - List available commands.</pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> Include(luaFileName) - 预加载指定的脚本文件</pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> echo(message) - 显示Lua调试信息，用于Lua的动态调试。</pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span> Echo(message) - 显示Lua调试信息，用于Lua的动态调试。</pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> WriteLog(message) - 写日志记录，用于Lua脚本的动态调试。</pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> GetTime() - 取系统时间</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span> GetComponent(componentKey) - 从应用程序上下文环境之中获取指定名称的对象实例</pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span> GetAccount() - 求当前账户信息</pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span> ExecuteSql(commandText) - 执行指定的非查询命令，返回执行所影响的行数。</pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span> QuerySql(commandText, resultType) - 执行给定的数据库查询命令，返回执行结果，返回结果由resultType参数决定。</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span> QuerySqlScalar(commandText) - 执行给定的数据库查询命令，仅返回第一行第一列结果</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span> QuerySqlMatrix(commandText) - 执行给定的数据库查询命令，返回第一个查询结果Matrix</pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span> QuerySqlDictionary(commandText) - 执行给定的数据库查询命令，返回第一行的Key-Value</pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span> QuerySqlList(commandText) - 执行给定的数据库查询命令，返回第一行的Key-Value</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span> QuerySqlDataSet(commandText) - 执行给定的数据库查询命令，返回查询结果集</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span> QuerySqlDataTable(commandText) - 执行给定的数据库查询命令，返回查询结果集的第一个DataTable</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span> GetDataSet() - 求当前系统的帐套信息</pre> 
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 大家也可以基于AgileEAS.NET SOA 平台Lua引擎扩展自己的LuaAPI。</p> 
    <h1 style="font-size:28px;line-height:1.5;">四、AgileEAS.NET SOA平台Lua引擎应用案例</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 在我12年的医疗行业开发之中，做过多年的电子病历，开发、指导开发过多套电子病历系统，在电子病历系统之中，有以下几个问题一直得不到好的解决方案：</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 在电子病历质控之中有一个自动质控评分，其由程序自动的预先为某个病案打出一个得分：</p> 
    <p><a href="https://images0.cnblogs.com/blog/19020/201312/19112003-d76e3f170273483c91d22ebe3eecdf86.jpg" rel="nofollow" style="color:#008000;text-decoration:none;"><img title="]3L0{AR35LX4WKWXUAU}(2S" src="https://images0.cnblogs.com/blog/19020/201312/19112005-5eab2f9fc51d4fcf89cfa72ca1cc8d29.jpg" alt="]3L0{AR35LX4WKWXUAU}(2S" width="865" height="673" style="border:0px;background-image:none;"></a></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 在没有使用Lua教本之前呢，也是能实现这种自动评分，但是为了实现这样的功能，系统设计之中就会要增加一些辅助的表和大量的辅助设计以帮助完成这样的功能，因为毕竟不存在统一的评分规则，所以这个设计会极其的复杂，以致于很难把这样的功能做好，或者说在成本和效益估量之中，得不偿失。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 另外还有比较简单的例子就是电子病历之间的宏替换问题，在书写电子病历的过程之中需要动态的插入如病人基本信息、医院名称这样的东西进入病历，但是因为其数据源并不是唯一确定的，如果不使用动态脚本设计，那么其程序这中就会存在大量的硬编码，并且如果想要在后期实施阶段增加宏，那么则必须要修改程序才能完成。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 下面我们就以自动评分案例向大家讲解一下是如何实现功能的呢：</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 首先，系统之中必须管理和维护用于自动评分的所有评分规则：</p> 
    <p><a href="https://images0.cnblogs.com/blog/19020/201312/19112007-c274ee8d33c94aee97be487e879945c4.jpg" rel="nofollow" style="color:#008000;text-decoration:none;"><img title="BF$CE1XPYCZES13DJ%Z4XP5" src="https://images0.cnblogs.com/blog/19020/201312/19112009-b51593298ad949b5a5136628a469c6b8.jpg" alt="BF$CE1XPYCZES13DJ%Z4XP5" width="999" height="509" style="border:0px;background-image:none;"></a></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 这里与其他很多开发者的做法不一样的是，对于每个缺陷项目，我们都为其提供了一个评分规则的脚本的设计,例如对于缺陷“*缺入院记录”的评分脚本如下:</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> ---------------------------------------------------------------------------------------------<span style="color:rgb(0,128,0);">--</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,128,0);">-- 创建人   :  魏琼东</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,128,0);">-- 创建时间    : 2013-09-05</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,128,0);">-- 效果备注    : *缺入院记录评分脚本。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,128,0);">--               GetErrorNumber,求缺陷数量，由脚本计算出本缺陷数量</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> --------------------------------------------------------------------------------------------<span style="color:rgb(0,128,0);">--</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> ------------------------不怎么华丽的分割线------------------------------------<span style="color:rgb(0,128,0);">--</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span> function GetErrorNumber(patient,errorItem)</pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     --调用C#，求监控项目</pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">local</span> monitorItem = GetMonitorItem("B01")    </pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     --监控表达式,无表达式返回0</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>     <span style="color:rgb(0,0,255);">local</span> script = monitorItem.Expression</pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>     if script == nil <span style="color:rgb(0,0,255);">then</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>         return 0</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>     elseif script == "" <span style="color:rgb(0,0,255);">then</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>         return 0</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>     <span style="color:rgb(0,0,255);">end</span>    </pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>     </pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>     --加载监控脚本</pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>     ExecuteScript(script)</pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>     --执行监控函数NeedWrite，如果需要写则预标存在此缺陷</pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>     <span style="color:rgb(0,0,255);">local</span> need = NeedWrite(patient,monitorItem)</pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>     </pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>     if need == 1 <span style="color:rgb(0,0,255);">then</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>         return 1</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>     <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>         return 0</pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>     <span style="color:rgb(0,0,255);">end</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span> end</pre> 
     </div> 
    </div> 
    <p>这样的设计的目标是将缺陷的评分动作都由Lua脚本实现，而在应用程序之中并不存在针对缺陷制定不同的评分规则的情况，只有调用脚本进行评分的代码：</p> 
    <div style="font-size:8pt;font-family:'Courier New', courier, monospace;line-height:12pt;border:1px solid #C0C0C0;"> 
     <div style="font-size:8pt;line-height:12pt;border-style:none;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,128,0);">/// 求指定患者、指定缺陷的缺陷数。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,128,0);">/// &lt;param name="pRoot"&gt;&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,128,0);">/// &lt;param name="errorItem"&gt;&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,128,0);">/// &lt;returns&gt;&lt;/returns&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> <span style="color:rgb(0,0,255);">public</span> static <span style="color:rgb(0,0,255);">int</span> GetErrorNumber(ILuaEngine m_Lua, PatientRoot pRoot, ErrorDict errorItem)</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     if (string.IsNullOrEmpty(errorItem.Expression))  <span style="color:rgb(0,128,0);">//无评分脚本</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>         return 0;</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>     string m_file = <span style="color:rgb(0,0,255);">System</span>.IO.Path.Combine(LuaEx.ScriptDirectory, string.Format("emr\\error\\{0}.lua", errorItem.ErrorCode));</pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>     if (!<span style="color:rgb(0,0,255);">System</span>.IO.File.<span style="color:rgb(0,0,255);">Exists</span>(m_file))</pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>         return 0;</pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>     try</pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>         m_Lua.DoFile(m_file);  <span style="color:rgb(0,128,0);">//加载脚本</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>         object[] vs = m_Lua.Invoke("GetErrorNumber", pRoot, errorItem);  <span style="color:rgb(0,128,0);">//执行函数。</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>         if (vs != <span style="color:rgb(0,0,255);">null</span> &amp;&amp; vs.Length &gt; 0)</pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>             return <span style="color:rgb(0,0,255);">int</span>.Parse(vs[0].ToString());</pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>         <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span>             return 0;</pre> 
      <pre><span style="color:rgb(96,96,96);">  32:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  33:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  34:</span>     catch</pre> 
      <pre><span style="color:rgb(96,96,96);">  35:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  36:</span>         return 0;</pre> 
      <pre><span style="color:rgb(96,96,96);">  37:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  38:</span> }</pre> 
     </div> 
    </div> 
    <p>这样的好处在于，主体程序变的极其的简单一致，不需要各种判断和各种规则，并且灵活自动，可以做到政策变化或者客户需求变化导到的各种评分规则的修改，则会灵活自如。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 实践证明，使用动态脚本语言扩展现在系统的系统是一种低投入高产出的工作，对于应对这种高扩展性和高定制性的项目是一个非常好的选择，这个可以解释游戏编程之中大量使用Lua语言的事实，针对NPC、剧情书写相关的处理脚本，让游戏的后期变更，调整变得简单可行。</p> 
    <h1 style="font-size:28px;line-height:1.5;">四、联系我们</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 为完善、改进和推广AgileEAS.NET而成立了敏捷软件工程实验室，是一家研究、推广和发展新技术，并致力于提供具有自主知识产权的业务基础平台软件，以及基于业务基础平台开发的管理软件的专业软件提供商。主要业务是为客户提供软件企业研发管理解决方案、企业管理软件开发，以及相关的技术支持，管理及技术咨询与培训业务。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; AgileEAS.NET SOA中间件平台自2004年秋呱呱落地一来，我就一直在逐步完善和改进，也被应用于保险、医疗、电子商务、房地产、铁路、教育等多个应用，但一直都是以我个人在推广，2010年因为我辞职休息，我就想到把AgileEAS.NET推向市场，让更多的人使用。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 我的技术团队成员都是合作多年的老朋友，因为这个平台是免费的，所以也没有什么收入，都是由程序员的那种理想与信念坚持，在此我感谢一起奋斗的朋友。</p> 
    <p>团队网站：<a href="http://eastjade.cnblogs.com/" rel="nofollow" style="color:#008000;text-decoration:none;">http://www.agilelab.cn</a>，</p> 
    <p>AgileEAS.NET网站：<a href="http://www.smarteas.net/" rel="nofollow" style="color:#008000;text-decoration:none;">http://www.smarteas.net</a></p> 
    <p>官方博客:<a href="http://eastjade.cnblogs.com/" rel="nofollow" style="color:#008000;text-decoration:none;">http://eastjade.cnblogs.com</a></p> 
    <p>QQ:47920381,AgileEAS.NET</p> 
    <p>QQ群：113723486（AgileEAS SOA 平台）/上限1000人</p> 
    <p>199463175（AgileEAS SOA 交流）/上限1000人</p> 
    <p>212867943（AgileEAS.NET研究）/上限500人</p> 
    <p>147168308（AgileEAS.NET应用）/上限500人</p> 
    <p>172060626（深度AgileEAS.NET平台）/上限500人</p> 
    <p>116773358（AgileEAS.NET 平台）/上限500人</p> 
    <p>125643764（AgileEAS.NET探讨）/上限500人</p> 
    <p>193486983（AgileEAS.NET 平台）/上限500人</p> 
    <p>邮件:james@agilelab.cn,mail.james@qq.com,</p> 
    <p>电话：18629261335。</p> 
   </div> 
   <div style="border:1px solid rgb(232,231,208);"> 
    <font color="#808080"><span style="font-size:10pt;"></span></font> 
    <div> 
     <div> 
      <p style="color:#808080;font-family:'微软雅黑';font-size:12px;background:url(&quot;http://pic.cnblogs.com/face/u19020.jpg&quot;) no-repeat 1% 50%;border:1px dashed rgb(224,224,224);"><br><span style="font-size:10pt;">作者：</span><strong><span style="color:#FF0000;"><a href="http://www.cnblogs.com/eastjade" rel="nofollow" style="color:#008000;text-decoration:none;"><font color="#3d81ee"><span style="font-size:10pt;">魏琼东</span></font></a></span></strong>&nbsp;<br><span style="font-size:10pt;">出处：</span><a href="http://www.cnblogs.com/eastjade" rel="nofollow" style="color:#008000;text-decoration:none;"></a><a href="http://www.cnblogs.com/eastjade" rel="nofollow" style="color:#008000;text-decoration:none;"><span style="font-size:10pt;">http://www.cnblogs.com/eastjade</span><br></a><span style="font-size:10pt;">关于作者：有13年的软件从业经历，专注于中小软件企业软件开发过程研究，通过在技术与管理帮助中小软件企业实现技术层面开源节流的目的。熟悉需求分析、企业架构、项目管理。现主要从事基于</span><a href="http://www.smarteas.net/" rel="nofollow" style="color:#008000;text-decoration:none;"><span style="font-size:10pt;">AgileEAS.NET</span></a><span style="font-size:10pt;">平台的技术咨询工作，主要服务于医疗卫生、铁路、电信、物流、物联网、制造、零售等行业。如有问题或建议，请多多赐教！&nbsp;</span><br><span style="font-size:10pt;">本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，如有问题，可以通过</span><a href="mailto:mail.james@qq.com" rel="nofollow" style="color:#008000;text-decoration:none;"><span style="font-size:10pt;">mail.james@qq.com</span></a><span style="font-size:10pt;">&nbsp;联系我，也可以加入QQ群:113723486、199463175、116773358、116773358、212867943、147168308、59827496、193486983、15118502和大家共同讨论，非常</span><span style="font-size:12pt;">感谢。</span></p> 
      <p style="color:#808080;font-family:'微软雅黑';font-size:12px;background:url(&quot;http://pic.cnblogs.com/face/u19020.jpg&quot;) no-repeat 1% 50%;border:1px dashed rgb(224,224,224);"><span style="font-size:12pt;"><br></span></p> 
      <p style="background:url(&quot;http://pic.cnblogs.com/face/u19020.jpg&quot;) no-repeat 1% 50%;border:1px dashed rgb(224,224,224);"><span><font color="#808080">&nbsp; &nbsp; 本文转自魏琼东博客园博客，原文链接：</font></span><font color="#808080">http://www.cnblogs.com/eastjade/p/3481784.html</font><span style="color:rgb(128,128,128);font-family:'微软雅黑';">，如需转载请自行联系原作者</span></p> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
