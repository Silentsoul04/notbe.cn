<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>11gR2(11.2) RAC TAF Configuration for Admin and Policy Managed Databases (文档 ID 1312749.1) « NotBeCN</title>
  <meta name="description" content="             In this Document                   &nbsp;       Purpose                               &nbsp;       Scope                               &nbsp;   ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/16/weixin_33863087_90123065.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">11gR2(11.2) RAC TAF Configuration for Admin and Policy Managed Databases (文档 ID 1312749.1)</h1>
    <p class="post-meta">Nov 16, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>In this Document</strong><br></p> 
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#PURPOSE" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">Purpose</a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?%3C/p%3E%3Cp%3E_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#SCOPE" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">Scope</a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#BODYTEXT" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">Details</a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?%3C/p%3E%3Cp%3E_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section31" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Concepts &amp; Overview<br></strong></a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?%3C/p%3E%3Cp%3E_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section32" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Administrator-managed Database</strong></a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section33" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Basic Method</strong></a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section34" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Preconnect Method</strong></a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section35" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Policy-managed Database</strong></a></td> 
     </tr>
    </tbody>
   </table>
   <table style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><a href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1459323732561579&amp;id=1312749.1&amp;displayIndex=10&amp;_afrWindowMode=0&amp;_adf.ctrl-state=foyvm6hmv_144#aref_section36" rel="nofollow" style="color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><strong>Basic Method</strong></a></td> 
     </tr>
    </tbody>
   </table>
   <hr style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></p> 
   <h2 style="line-height:1.5;font-size:21px;font-family:verdana, Arial, Helvetica, sans-serif;">Applies to:</h2> 
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Oracle Database - Enterprise Edition - Version 11.2.0.1 to 11.2.0.3 [Release 11.2]</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Oracle Net Services - Version 11.2.0.1 to 11.2.0.3 [Release 11.2]</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Information in this document applies to any platform.</span>
   <br style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
   <h2 style="line-height:1.5;font-size:21px;font-family:verdana, Arial, Helvetica, sans-serif;"> <a name="PURPOSE" style="border-bottom:1px dotted rgb(51,51,51);"></a>Purpose</h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> This article describes Transparent Application Failover (TAF) and provides configuration details for 11gR2(11.2) cluster database.</p> 
   <h2 style="line-height:1.5;font-size:21px;font-family:verdana, Arial, Helvetica, sans-serif;"> <a name="SCOPE" style="border-bottom:1px dotted rgb(51,51,51);"></a>Scope</h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> This article is intended for Oracle Cluster Administrators who would like more details about TAF. Basic understanding of Oracle Clusterware Database is assumed.</p> 
   <h2 style="line-height:1.5;font-size:21px;font-family:verdana, Arial, Helvetica, sans-serif;"> <a name="BODYTEXT" style="border-bottom:1px dotted rgb(51,51,51);"></a>Details</h2> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <a name="aref_section31" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><strong><span style="line-height:1.8;">Concepts &amp; Overview</span><br></strong></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> TAF allows Oracle clients to reconnect to a surviving instance in the event of a failure of the instance to which it is connected. There are two types of TAF available, SESSION and SELECT.&nbsp;<br><br><strong>SESSION:</strong>&nbsp;Session Failover re-creates the connections and sessions to the surviving instance.<br><strong>SELECT:&nbsp;</strong>&nbsp;In addition to recreating the session, Select Failover also replays the queries that were in progress.&nbsp;<br><br><br> There are two methods in which TAF estabilishes the failover connection, BASIC and PRECONNECT.&nbsp;<br><br><strong>BASIC:</strong>&nbsp;The second connection is re-established only after the first connection to the instance failed.<br><strong>PRECONNECT:</strong>&nbsp;Two connections are established when the client logs in to the database. A login to database will create two connection at the same time. For this to work, clusterware actually starts two services. One main service and another shadow service.&nbsp;<br><br><br> TAF can be configured at the Oracle Client side in tnsnames.ora or at the Database Server side using the SRVCTL utility.&nbsp; Configuring it at the server is preferred as it is convenient to put the configuration in one place i.e. on the server. This article covers the configuration at the server using SRVCTL.&nbsp; TAF configuration is associated with the database service.&nbsp;<br><br><strong>1.</strong>&nbsp;Create the service with SRVCTL<br><em></em>SRVCTL defines services in OCR which is accessible across nodes. The service configuration details can be viewed with the SRVCTL config service command.<br><br><strong>2.</strong>&nbsp;Start the Service with SRVCTL<br> When the service is started with SRVCTL, it actually creates a service in the database. The service name and the configuration details of the service created at the database can be viewed with DBA_SERVICES view. Then the SERVICE_NAMES database parameter is set, which allows PMON to register this service with the listener.&nbsp; Once the new service is registered, remote client connections can established through the listener.<br><br></p> 
   <div class="kmnotebox" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    NOTE:
    <br> The clusterware automatically starts/stops and manages the services in the database according to the configuration of the service. Manually setting the SERVICE_NAMES parameter in RAC is not allowed as clusterware manages setting this parameter.
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br> Let's have a look at the&nbsp;<em>srvctl</em>&nbsp;syntax for creating service. Databases in 11gR2 can be Administrator-managed or Policy-managed. Certain options can be used only with certain type of database.&nbsp;<br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    srvctl add service -d &lt;db_unique_name&gt; -s &lt;service_name&gt;&nbsp;
    <br> -r "&lt;preferred_list&gt;" [-a "&lt;available_list&gt;"] [-P {BASIC | NONE | PRECONNECT}]&nbsp;
    <br> -g &lt;server_pool&gt; [-c {UNIFORM | SINGLETON}]&nbsp;
    <br> [-k &lt;net_num&gt;]&nbsp;
    <br> [-l [PRIMARY][,PHYSICAL_STANDBY][,LOGICAL_STANDBY][,SNAPSHOT_STANDBY]]&nbsp;
    <br> [-y {AUTOMATIC | MANUAL}]&nbsp;
    <br> [-q {TRUE|FALSE}]&nbsp;
    <br> [-x {TRUE|FALSE}]&nbsp;
    <br> [-j {SHORT|LONG}]&nbsp;
    <br> [-B {NONE|SERVICE_TIME|THROUGHPUT}]&nbsp;
    <br> [-e {NONE|SESSION|SELECT}]&nbsp;
    <br> [-m {NONE|BASIC}]&nbsp;
    <br> [-z &lt;failover_retries&gt;]&nbsp;
    <br> [-w &lt;failover_delay&gt;]
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> Here is the description of the options that we are going to use in configuring TAF.&nbsp;<br><br><strong>-r "&lt;preferred_list&gt;" [-a "&lt;available_list&gt;"] [-P {BASIC | NONE | PRECONNECT}]</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This clause is valid&nbsp;<strong>only for Administrator-managed database</strong>&nbsp;which support PRECONNECT method.&nbsp;<br><strong>-g &lt;server_pool&gt; [-c {UNIFORM | SINGLETON}]</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This clause is valid&nbsp;<strong>only for Policy-managed database</strong>&nbsp;where in PRECONNECT method is not available.<br><br> The above two options instruct clusterware on how to handle this service.&nbsp;<br><br><strong>[-e {NONE|SESSION|SELECT}]&nbsp;</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This defines the type of TAF whether SESSION or SELECT.&nbsp;<br><strong>[-m {NONE|BASIC}]&nbsp;</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This defines the method of TAF.<br><strong>[-z &lt;failover_retries&gt;]&nbsp;</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This defines the the number of times to attempt to connect after a failover.&nbsp;<br><strong>[-w &lt;failover_delay&gt;]</strong><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This defines the amount of time in seconds to wait between connect attempts.&nbsp;<br><br> Above four options are passed to database while starting up the service and is viewable in DBA_SERVICES view.<br><br><br></p> 
   <a name="aref_section32" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.8;"><strong>Administrator-managed Database</strong></span></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <a name="aref_section33" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h4 style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;"><strong>Basic Method</strong></h4> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><strong>1.&nbsp;</strong>Create Service<br><br> Syntax:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; srvctl add service -d &lt;db_unique_name&gt; -s &lt;service_name&gt;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -r "&lt;preferred_list&gt;" [-a "&lt;available_list&gt;"] [-P {BASIC | NONE | PRECONNECT}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-e {NONE|SESSION|SELECT}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-m {NONE|BASIC}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-z &lt;failover_retries&gt;]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-w &lt;failover_delay&gt;]<br><br><br> Example:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $&nbsp;<strong>srvctl add service -d</strong>&nbsp;db112&nbsp;<strong>-s</strong>&nbsp;mysrvb&nbsp;<strong>-r</strong>&nbsp;db1121,db1122&nbsp;<strong>-P</strong>&nbsp;basic&nbsp;<strong>-e</strong>&nbsp;select<strong>&nbsp;-m&nbsp;</strong>basic&nbsp;<strong>-z</strong>&nbsp;10&nbsp;<strong>-w</strong>&nbsp;2<br><br></p> 
   <div class="kmnotebox" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Though this example only uses -r option, you can use both -r and -a option.
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><strong>2.</strong>&nbsp;Start the service<br> $&nbsp;<strong>srvctl start service -d</strong>&nbsp;db112&nbsp;<strong>-s</strong>&nbsp;mysrvb<br><br> Check if the service is registered with the listener.</p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    $lsnrctl status LISTENER_SCAN1
    <br> . . .
    <br> . . .
    <br> Service "mysrvb" has 2 instance(s).
    <br> &nbsp; Instance "db1121", status READY, has 1 handler(s) for this service...
    <br> &nbsp; Instance "db1122", status READY, has 1 handler(s) for this service...
    <br> . . .
    <br> . . .
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><br><strong>3.</strong>&nbsp;Make a connection.&nbsp;<br><br> The client connect string does not require any special TAF parameters. A simple tnsnames.ora entry as shown below will do.</p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    mysrvb =&nbsp;
    <br> &nbsp; (description =
    <br> &nbsp;&nbsp; (address = (protocol=tcp)(host=secrac-scan)(port=1521))
    <br> &nbsp;&nbsp; (connect_data=
    <br> &nbsp;&nbsp;&nbsp; (service_name=mysrvb)
    <br> &nbsp;&nbsp; )&nbsp;
    <br> &nbsp; )
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <div class="kmnotebox" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    Note:&nbsp; Please be aware that&nbsp;
    <strong>pre-11gR2</strong>&nbsp;clients are not fully compatible with SCAN and require a special TNS connect string.&nbsp; See the following Oracle Documentation:&nbsp; http://www.oracle.com/technetwork/database/clustering/overview/scan-129069.pdf
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br> $&nbsp;<strong>sqlplus</strong>&nbsp;scott/tiger<strong>@mysrvb</strong><br><br> Once connected GV$SESSION view will reflect the connection made is TAF enabled. The FAILOVER_METHOD and FAILOVER_TYPE column reflects it and this confirms the TAF configuration is correct.<br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    SQL&gt; select inst_id,username,service_name,failover_type,failover_method,failed_over from gv$session where username='SCOTT';
    <br>
    <br> INST_ID USERNAME SERVICE_NAME FAILOVER_TYPE FAILOVER_M FAI
    <br> ------- -------- ------------ ------------- ---------- ---
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; SCOTT &nbsp; &nbsp; &nbsp; mysrvb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BASIC&nbsp; NO
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> Note that this client has connected to the instance 1 with BASIC method and SELECT type.&nbsp;<br><br><br></p> 
   <a name="aref_section34" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h4 style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;"><strong>Preconnect Method</strong></h4> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><strong>1.</strong>&nbsp;Create service<br><br> Syntax:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; srvctl add service -d &lt;db_unique_name&gt; -s &lt;service_name&gt;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -r "&lt;preferred_list&gt;" [-a "&lt;available_list&gt;"] [-P {BASIC | NONE | PRECONNECT}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-e {NONE|SESSION|SELECT}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-m {NONE|BASIC}]&nbsp;<br><br><br> Example:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $&nbsp;<strong>srvctl add service -d</strong>&nbsp;db112&nbsp;<strong>-s</strong>&nbsp;mysrv&nbsp;<strong>-r</strong>&nbsp;db1121&nbsp;<strong>-a</strong>&nbsp;db1122&nbsp;<strong>-P&nbsp;</strong>preconnect<br><br></p> 
   <div class="kmnotebox" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    NOTE:
    <br> * The -e, -m option should be set to none. Omitting this option actually sets it to none.
    <br> * Use both -r and -a option for preconnect so that a shadow service will be started.
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><strong>2.</strong>&nbsp;Start the service.&nbsp;<br><br> $&nbsp;<strong>srvctl start service -d</strong>&nbsp;db112&nbsp;<strong>-s</strong>&nbsp;mysrv<br><br> Preconnect creates an additional shadow service.&nbsp;<br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    $&nbsp;
    <strong>crsctl stat res -t</strong>
    <br> . . .
    <br> . . .
    <br> ora.db112.mysrv.svc
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 ONLINE ONLINE secrac1
    <br> ora.db112.mysrv_preconnect.svc
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 ONLINE ONLINE secrac3
    <br> . . .
    <br> . . .
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br> Note that the service&nbsp;<em>'mysrv'</em>&nbsp;is started on the preferred instance. And the shadow service&nbsp;<em>'mysrv_preconnect'</em>&nbsp;is started on the available instance. The shadow service is always defined as&nbsp;<em>&lt;servicename&gt;_preconnect.&nbsp;</em><br><br><br> Check if the service is correctly registered with the listener.</p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    $ lsnrctl status listener_scan1
    <br> . . .
    <br> . . .
    <br> Service "mysrv" has 1 instance(s).
    <br> &nbsp; Instance "db1121", status READY, has 1 handler(s) for this service...
    <br> Service "mysrv_preconnect" has 1 instance(s).
    <br> &nbsp; Instance "db1122", status READY, has 1 handler(s) for this service...
    <br> . . .
    <br> . . .
    <br>
    <br>
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><br><br><strong>3.&nbsp;</strong>Define TNS entry.&nbsp;<br><br> Preconnect requires special parameters at the client side tnsnames.ora file. The TAF Type and the TAF method is actually specified at the client end.&nbsp;<br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    mysrv =&nbsp;
    <br> &nbsp; (description =
    <br> &nbsp;&nbsp; (address = (protocol=tcp)(host=secrac-scan)(port=1521))
    <br> &nbsp;&nbsp; (connect_data=
    <br> &nbsp;&nbsp;&nbsp;&nbsp; (service_name=mysrv)
    <br> &nbsp;&nbsp;&nbsp;&nbsp; (failover_mode=
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (backup=mysrv_preconnect)
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (type=select)
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (method=preconnect)
    <br> &nbsp;&nbsp;&nbsp;&nbsp; )
    <br> &nbsp;&nbsp; )&nbsp;
    <br> &nbsp; )
    <br>
    <br> mysrv_preconnect =
    <br> &nbsp; (description =
    <br> &nbsp;&nbsp; (address = (protocol=tcp)(host=secrac-scan)(port=1521))
    <br> &nbsp;&nbsp; (connect_data=(service_name=mysrv_preconnect))
    <br> &nbsp; )
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br> Connect to the database with this tns entry<br><br> $<strong>sqlplus</strong>&nbsp;scott/tiger<strong>@mysrv</strong><br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    SQL&gt; select inst_id,username,service_name,failover_type,failover_method,failed_over from gv$session where username='SCOTT';
    <br>
    <br> INST_ID USERNAME&nbsp;&nbsp;&nbsp;&nbsp; SERVICE_NAME FAILOVER_TYPE FAILOVER_M FAI
    <br> ------- -------- ---------------- ------------- ---------- ---
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; SCOTT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; mysrv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT PRECONNECT&nbsp; NO
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; SCOTT mysrv_preconnect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NONE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NONE&nbsp; NO
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> Note that the client has made two connections. The first one is the active main connection with PRECONNECT method and SELECT type. The second one is the shadow connection that will be used if the connection to the first instance fails.&nbsp;<br><br><br></p> 
   <a name="aref_section35" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h3 style="font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.8;"><strong>Policy-managed Database</strong></span></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <a name="aref_section36" style="border-bottom:1px dotted rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></a>
   <span style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"></span> 
   <h4 style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;"><strong>Basic Method</strong></h4> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><strong>1.</strong>&nbsp;Create the service<br><br> Syntax:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; srvctl add service -d &lt;db_unique_name&gt; -s &lt;service_name&gt;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -g &lt;server_pool&gt; [-c {UNIFORM | SINGLETON}]<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-e {NONE|SESSION|SELECT}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-m {NONE|BASIC}]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-z &lt;failover_retries&gt;]&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [-w &lt;failover_delay&gt;]<br><br><br> Example:<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $&nbsp;<strong>srvctl add service -d&nbsp;</strong>db1&nbsp;<strong>-s</strong>&nbsp;mysrvp&nbsp;<strong>-g</strong>&nbsp;mysrvpool&nbsp;<strong>-c</strong>&nbsp;uniform&nbsp;<strong>-e</strong>&nbsp;select<strong>&nbsp;-m</strong>&nbsp;basic&nbsp;<strong>-z&nbsp;</strong>10&nbsp;<strong>-w</strong>&nbsp;2<br><br><strong><br> 2.</strong>&nbsp;Start the service<br><br> $&nbsp;<strong>srvctl start service -d</strong>&nbsp;db1&nbsp;<strong>-s</strong>&nbsp;mysrvp<br><br><br> Check if the service is correctly registered with the listener</p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    $ lsnrctl status listener_scan1
    <br> . . .
    <br> . . .
    <br> Service "mysrvp" has 2 instance(s).
    <br> &nbsp; Instance "db1_1", status READY, has 1 handler(s) for this service...
    <br> &nbsp; Instance "db1_2", status READY, has 1 handler(s) for this service...
    <br> . . .
    <br> . . .
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><br><strong>3.</strong>&nbsp;Make a connection.<br><br> The client connect string does not require any special TAF parameters. A simple tnsnames.ora entry as shown below will do.&nbsp;<br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    mysrvp =&nbsp;
    <br> &nbsp; (description =
    <br> &nbsp;&nbsp; (address = (protocol=tcp)(host=secrac-scan)(port=1521))
    <br> &nbsp;&nbsp; (connect_data=
    <br> &nbsp;&nbsp;&nbsp;&nbsp; (service_name=mysrvp)
    <br> &nbsp;&nbsp; )&nbsp;
    <br> &nbsp; )
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> $&nbsp;<strong>sqlplus</strong>&nbsp;scott/tiger<strong>@mysrvp</strong><br><br></p> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    SQL&gt; select inst_id,username,service_name,failover_type,failover_method,failed_over from gv$session where username='SCOTT';
    <br>
    <br> INST_ID USERNAME SERVICE_NAME FAILOVER_TYPE FAILOVER_M FAI
    <br> ------- -------- ------------ ------------- ---------- ---
    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; SCOTT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mysrvp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BASIC&nbsp; NO
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <br>
   </div> 
   <div class="kmcodeblock"> 
    <font color="#333333"><span style="font-size:14px;">本文转自mfrbuaa博客园博客，原文链接：http://www.cnblogs.com/mfrbuaa/p/5134373.html，如需转载请自行联系原作者</span></font>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
