<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>理解 OpenStack + Ceph （1）：Ceph + OpenStack 集群部署和配置 « NotBeCN</title>
  <meta name="description" content="             本系列文章会深入研究 Ceph 以及 Ceph 和 OpenStack 的集成：    （1）安装和部署    （2）Ceph RBD 接口和工具    （3）Ceph 物理和逻辑结构    （4）Ceph 的基础数据结构    （5）Ceph 与 OpenStack 集成的实现    ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/13/weixin_34308389_90124601.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">理解 OpenStack + Ceph （1）：Ceph + OpenStack 集群部署和配置</h1>
    <p class="post-meta">Nov 13, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本系列文章会深入研究 Ceph 以及 Ceph 和 OpenStack 的集成：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）<a href="http://www.cnblogs.com/sammyliu/p/4804037.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">安装和部署</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）<a href="http://www.cnblogs.com/sammyliu/p/4838139.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Ceph RBD 接口和工具</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）<a href="http://www.cnblogs.com/sammyliu/p/4836014.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Ceph 物理和逻辑结构</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）<a href="http://www.cnblogs.com/sammyliu/p/4843812.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Ceph 的基础数据结构</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）<a href="http://www.cnblogs.com/sammyliu/p/4838138.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Ceph 与 OpenStack 集成的实现</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（6）<a href="http://www.cnblogs.com/sammyliu/p/5066895.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">QEMU-KVM 和 Ceph RBD 的 缓存机制总结</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（7）<a href="http://www.cnblogs.com/sammyliu/p/5555218.html%20" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Ceph 的基本操作和常见故障排除方法</a></p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1. 测试环境</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">为了深入学习 Ceph 以及 Ceph 和 OpenStack 的集成，搭建了如下的测试环境：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201509/697113-20150922100641865-158810012.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">硬件环境：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">System X 服务器一台，CPU、内存和磁盘空间足够</li> 
    <li style="list-style-type:disc;">服务器只有一个物理网卡</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">软件环境：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">服务器安装 RedHat 6.5 操作系统</li> 
    <li style="list-style-type:disc;">OpenStack 使用 Ubuntu 镜像库中的 Kilo master 版本</li> 
    <li style="list-style-type:disc;">每个节点操作系统采用 Ubuntu 14.04 服务器版</li> 
   </ul>
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">2. Ceph 集群部署</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 从上图可见，该环境使用三个虚机作为Ceph节点，每个节点上增加两个虚拟磁盘 vda 和 vdb 作为 OSD 存储磁盘，每个节点上安装 MON，前两个节点上安装 MDS。三个节点使用物理网络进行通信。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（0）准备好三个节点 ceph{1,2,3}：安装操作系统、设置 NTP、配置 ceph1 可以通过 ssh 无密码访问其余节点（依次运行 ssh-keygen，ssh-copy-id ceph2，ssh-copy-id ceph3，修改 /etc/ssh/sshd_config&nbsp;文件中的 PermitRootLogin yes 来使得&nbsp;ssh 支持 root 用户）</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;width:625px;">
    <tbody>
     <tr>
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">节点名称</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">IP 地址</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">部署进程</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">数据盘</td> 
     </tr>
     <tr>
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">ceph1</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">192.168.1.194</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">1MON+1MDS+2OSD</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">/dev/vda,&nbsp;/dev/vdb</td> 
     </tr>
     <tr>
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">ceph2</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">192.168.1.195</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">1MON+1MDS+2OSD</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">/dev/vda, /dev/vdb</td> 
     </tr>
     <tr>
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">ceph3</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">192.168.1.218</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">1MON+1OSD</td> 
      <td valign="top" style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">/dev/vda, /dev/vdb</td> 
     </tr>
    </tbody>
   </table>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）在 ceph1 上安装 ceph-deploy，接下来会使用这个工具来部署 ceph 集群</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）在ceph 上，运行&nbsp;ceph-deploy install ceph{1,2,3} 命令在各节点上安装 ceph 软件。安装好后可以查看 ceph 版本：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@ceph1:~# ceph -<span style="line-height:1.5;">v
ceph version </span><span style="color:rgb(128,0,128);line-height:1.5;">0.80</span>.<span style="color:rgb(128,0,128);line-height:1.5;">10</span> (ea6c958c38df1216bf95c927f143d8b13c4a9e70)</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）在 ceph1 上执行以下命令创建 MON 集群</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph-deploy <span style="color:rgb(136,136,136);line-height:1.5;">new </span>ceph{<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">}
ceph</span>-deploy mon create ceph{<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">}
ceph</span>-deploy mon create-initial</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">完成后查看 MON 集群状态：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@ceph1:~<span style="line-height:1.5;"># ceph mon_status
{</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ceph1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">rank</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">0</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">state</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">leader</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">election_epoch</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">16</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">quorum</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:[<span style="color:rgb(128,0,128);line-height:1.5;">0</span>,<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span>],<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">outside_quorum</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:[],<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">extra_probe_peers</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:[],<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">sync_provider</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:[],<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">monmap</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:{<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">epoch</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">fsid</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">4387471a-ae2b-47c4-b67e-9004860d0fd0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">modified</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">0.000000</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">created</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">0.000000</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">mons</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:[{<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">rank</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">0</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ceph1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">addr</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">192.168.1.194:6789\/0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>},{<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">rank</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ceph2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">addr</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">192.168.1.195:6789\/0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>},{<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">rank</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,128);line-height:1.5;">2</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">name</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ceph3</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>,<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">addr</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>:<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">192.168.1.218:6789\/0</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>}]}}</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）在各节点上准备数据盘，只需要在 fdisk -l 命令输出中能看到数据盘即可，不需要做任何别的操作，然后在 ceph1 上执行如下命令添加 OSD</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph-deploy --overwrite-conf osd prepare ceph1:/data/osd:/dev/vda ceph2:/data/osd:/dev/vda ceph3:/data/osd:/dev/<span style="line-height:1.5;">vda
ceph</span>-deploy --overwrite-conf osd activate ceph1:/data/osd:/dev/vda ceph2:/data/osd:/dev/vda ceph3:/data/osd:/dev/<span style="line-height:1.5;">vda

ceph</span>-deploy --overwrite-conf osd prepare ceph1:/data/osd2:/dev/vdb ceph2:/data/osd2:/dev/vdb ceph3:/data/osd2:/dev/<span style="line-height:1.5;">vdb
ceph</span>-deploy --overwrite-conf osd activate ceph1:/data/osd2:/dev/vdb ceph2:/data/osd2:/dev/vdb ceph3:/data/osd2:/dev/vdb</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">该命令详细信息：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">格式：&nbsp;ceph-deploy osd prepare {node-name}:{data-disk}[:{journal-disk}]</li> 
    <li style="list-style-type:disc;">其中，node-name&nbsp;表示待创建 OSD 的目标 Ceph 节点；data-disk&nbsp;表示 OSD 的数据盘；journal-disk&nbsp;表示日志盘，它可以是一个单独的磁盘，后者 OSD 数据盘上的一个分区，或者一个 SSD 磁盘上的分区。</li> 
    <li style="list-style-type:disc;">比如：ceph-deploy osd prepare osdserver1:sdb:/dev/ssd&nbsp;表示在 osdserver1&nbsp;上使用 sdb 磁盘做数据盘和 /dev/ssd&nbsp;分区做日志分区来创建一个 OSD 守护进程。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">要使得多个OSD数据盘共享一个单独的 SSD 磁盘，首先要使用 fdisk 对该磁盘进行分区，比如下面的命令将 /dev/sdd 分为两个区：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>Command (m <span style="color:rgb(0,0,255);line-height:1.5;">for</span><span style="line-height:1.5;"> help): n
Partition type:
   p   primary (</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span> primary, <span style="color:rgb(128,0,128);line-height:1.5;">0</span> extended, <span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;"> free)
   e   extended
Select (</span><span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;"> p):
Using </span><span style="color:rgb(0,0,255);line-height:1.5;">default</span><span style="line-height:1.5;"> response p
Partition number (</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>-<span style="color:rgb(128,0,128);line-height:1.5;">4</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span> <span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">):
Using </span><span style="color:rgb(0,0,255);line-height:1.5;">default</span> value <span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">
First sector (</span><span style="color:rgb(128,0,128);line-height:1.5;">1026048</span>-<span style="color:rgb(128,0,128);line-height:1.5;">2097151</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span> <span style="color:rgb(128,0,128);line-height:1.5;">1026048</span><span style="line-height:1.5;">):
Using </span><span style="color:rgb(0,0,255);line-height:1.5;">default</span> value <span style="color:rgb(128,0,128);line-height:1.5;">1026048</span><span style="line-height:1.5;">
Last sector, </span>+sectors or +size{K,M,G} (<span style="color:rgb(128,0,128);line-height:1.5;">1026048</span>-<span style="color:rgb(128,0,128);line-height:1.5;">2097151</span>, <span style="color:rgb(0,0,255);line-height:1.5;">default</span> <span style="color:rgb(128,0,128);line-height:1.5;">2097151</span><span style="line-height:1.5;">):
Using </span><span style="color:rgb(0,0,255);line-height:1.5;">default</span> value <span style="color:rgb(128,0,128);line-height:1.5;">2097151</span><span style="line-height:1.5;">

Command (m </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span><span style="line-height:1.5;"> help): w
The partition table has been altered</span>!</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">结果是：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>Disk /dev/sdd: <span style="color:rgb(128,0,128);line-height:1.5;">1073</span> MB, <span style="color:rgb(128,0,128);line-height:1.5;">1073741824</span><span style="line-height:1.5;"> bytes
</span><span style="color:rgb(128,0,128);line-height:1.5;">255</span> heads, <span style="color:rgb(128,0,128);line-height:1.5;">63</span> sectors/track, <span style="color:rgb(128,0,128);line-height:1.5;">130</span> cylinders, total <span style="color:rgb(128,0,128);line-height:1.5;">2097152</span><span style="line-height:1.5;"> sectors
Units </span>= sectors of <span style="color:rgb(128,0,128);line-height:1.5;">1</span> * <span style="color:rgb(128,0,128);line-height:1.5;">512</span> = <span style="color:rgb(128,0,128);line-height:1.5;">512</span><span style="line-height:1.5;"> bytes
Sector size (logical</span>/physical): <span style="color:rgb(128,0,128);line-height:1.5;">512</span> bytes / <span style="color:rgb(128,0,128);line-height:1.5;">512</span><span style="line-height:1.5;"> bytes
I</span>/O size (minimum/optimal): <span style="color:rgb(128,0,128);line-height:1.5;">512</span> bytes / <span style="color:rgb(128,0,128);line-height:1.5;">512</span><span style="line-height:1.5;"> bytes
Disk identifier: </span><span style="color:rgb(128,0,128);line-height:1.5;">0x6767c86e</span><span style="line-height:1.5;">

   Device Boot      Start         End      Blocks   Id  System
</span>/dev/sdd1            <span style="color:rgb(128,0,128);line-height:1.5;">2048</span>     <span style="color:rgb(128,0,128);line-height:1.5;">1026047</span>      <span style="color:rgb(128,0,128);line-height:1.5;">512000</span>   <span style="color:rgb(128,0,128);line-height:1.5;">83</span><span style="line-height:1.5;">  Linux
</span>/dev/sdd2         <span style="color:rgb(128,0,128);line-height:1.5;">1026048</span>     <span style="color:rgb(128,0,128);line-height:1.5;">2097151</span>      <span style="color:rgb(128,0,128);line-height:1.5;">535552</span>   <span style="color:rgb(128,0,128);line-height:1.5;">83</span>  Linux</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">此时，执行下面的命令来创建并激活 OSD：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph-deploy --overwrite-conf osd prepare ceph1:sdb:/dev/sdd1 ceph2:sdb:/dev/<span style="line-height:1.5;">sdd1 
ceph</span>-deploy --overwrite-conf osd activate ceph1:sdb1:/dev/sdd1 ceph2:sdb1:/dev/sdd1  </pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">注意prepare 和 activate 两个命令参数的区别，前者是使用磁盘，后者是使用分区。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">备注：看起来最上面的命令有误，需要修改，TBD。它其实是使用了 /data/osd 目录存放数据，而磁盘 /dev/vda 作为日志盘。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">另外，如果是第二次安装的话，需要删除已经存在的 /dev/sdd1 这样的分区，然后再使用命令&nbsp;ceph-deploy disk zap&nbsp;/dev/sdd 来将其数据全部删除。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">完成之后，会将 osd 盘挂载到 /var/lib/ceph/osd 下面的两个目录，目录名为 ceph-&lt;osd id&gt;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>/dev/sdc1 on /<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/ceph/osd/ceph-<span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;"> type xfs (rw,noatime,inode64)
</span>/dev/sdb1 on /<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/ceph/osd/ceph-<span style="color:rgb(128,0,128);line-height:1.5;">0</span> type xfs (rw,noatime,inode64)</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">而日志盘则会在各自的 osd 目录下创建一个 link，比如 /var/lib/ceph/osd/ceph-2/journal：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>lrwxrwxrwx  <span style="color:rgb(128,0,128);line-height:1.5;">1</span> root root          <span style="color:rgb(128,0,128);line-height:1.5;">9</span> Jun  <span style="color:rgb(128,0,128);line-height:1.5;">1</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">07</span> journal -&gt; /dev/sdd2</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">&nbsp;</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">完成后查看 OSD 状态：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>  root@ceph1:~<span style="line-height:1.5;"># ceph osd tree
# id    weight  type name       up</span>/<span style="line-height:1.5;">down reweight
</span>-<span style="color:rgb(128,0,128);line-height:1.5;">1</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.1399</span>  root <span style="color:rgb(136,136,136);line-height:1.5;">default</span>
-<span style="color:rgb(128,0,128);line-height:1.5;">2</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.03998</span><span style="line-height:1.5;">         host ceph1
</span><span style="color:rgb(128,0,128);line-height:1.5;">3</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">3</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span>
<span style="color:rgb(128,0,128);line-height:1.5;">6</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">6</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span>
-<span style="color:rgb(128,0,128);line-height:1.5;">3</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.05997</span><span style="line-height:1.5;">         host ceph2
</span><span style="color:rgb(128,0,128);line-height:1.5;">4</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">4</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span>
<span style="color:rgb(128,0,128);line-height:1.5;">7</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">7</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span>
-<span style="color:rgb(128,0,128);line-height:1.5;">4</span>      <span style="color:rgb(128,0,128);line-height:1.5;">0.03998</span><span style="line-height:1.5;">         host ceph3
</span><span style="color:rgb(128,0,128);line-height:1.5;">5</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">5</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span>
<span style="color:rgb(128,0,128);line-height:1.5;">8</span>       <span style="color:rgb(128,0,128);line-height:1.5;">0.01999</span>                 osd.<span style="color:rgb(128,0,128);line-height:1.5;">8</span>   up      <span style="color:rgb(128,0,128);line-height:1.5;">1</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）将 Admin key 复制到其余各个节点，然后安装 MDS 集群</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph-<span style="line-height:1.5;">deploy admin ceph1 ceph2 ceph3
ceph</span>-deploy mds  create ceph1 ceph2</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">完成后可以使用 “ceph mds” 命令来操作 MDS 集群，比如查看状态：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@ceph1:~<span style="line-height:1.5;"># ceph mds stat
e13: </span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span> up {<span style="color:rgb(128,0,128);line-height:1.5;">0</span>=ceph1=up:active}, <span style="color:rgb(128,0,128);line-height:1.5;">1</span> up:standby</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">看起来 MDS 集群是个 active/standby 模式的集群。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">至此，Ceph 集群部署完成，可以使用 ceph 命令查看集群状态：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@ceph1:~<span style="line-height:1.5;"># ceph mds stat
e13: </span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span> up {<span style="color:rgb(128,0,128);line-height:1.5;">0</span>=ceph1=up:active}, <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;"> up:standby
root@ceph1:</span>~# ceph -<span style="line-height:1.5;">s
    cluster 4387471a</span>-ae2b-47c4-b67e-<span style="line-height:1.5;">9004860d0fd0
     health HEALTH_OK
     monmap e1: </span><span style="color:rgb(128,0,128);line-height:1.5;">3</span> mons at {ceph1=192.168.1<span style="color:rgb(128,0,128);line-height:1.5;">.194</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6789</span>/<span style="color:rgb(128,0,128);line-height:1.5;">0</span>,ceph2=192.168.1<span style="color:rgb(128,0,128);line-height:1.5;">.195</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6789</span>/<span style="color:rgb(128,0,128);line-height:1.5;">0</span>,ceph3=192.168.1<span style="color:rgb(128,0,128);line-height:1.5;">.218</span>:<span style="color:rgb(128,0,128);line-height:1.5;">6789</span>/<span style="color:rgb(128,0,128);line-height:1.5;">0</span>}, election epoch <span style="color:rgb(128,0,128);line-height:1.5;">16</span>, quorum <span style="color:rgb(128,0,128);line-height:1.5;">0</span>,<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;"> ceph1,ceph2,ceph3
     mdsmap e13: </span><span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>/<span style="color:rgb(128,0,128);line-height:1.5;">1</span> up {<span style="color:rgb(128,0,128);line-height:1.5;">0</span>=ceph1=up:active}, <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;"> up:standby
     osdmap e76: </span><span style="color:rgb(128,0,128);line-height:1.5;">10</span> osds: <span style="color:rgb(128,0,128);line-height:1.5;">7</span> up, <span style="color:rgb(128,0,128);line-height:1.5;">7</span> <span style="color:rgb(0,0,255);line-height:1.5;">in</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在这过程中，失败和反复是难免的，在任何时候，可以使用如下的命令将已有的配置擦除然后从头安装：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph-deploy purge ceph{<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">}
ceph</span>-deploy purgedata ceph{<span style="color:rgb(128,0,128);line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);line-height:1.5;">3</span><span style="line-height:1.5;">}
ceph</span>-deploy forgetkeys</pre>
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">&nbsp;3. OpenStack 集群部署</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">&nbsp;3.1 网络准备</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">为方便起见，管理网络直接连接物理网卡；租户网络就比较麻烦一点，因为机器上只有一个物理网卡，幸亏所有的计算节点都在同一个物理服务器上，因此可以：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">1. 在物理服务器上，创建一个虚拟网卡 tap0,再创建一个 linux bridge ‘mgtbr0’</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>tunctl -t tap0 -<span style="line-height:1.5;">u root
chmod </span><span style="color:rgb(128,0,128);line-height:1.5;">666</span> /dev/net/<span style="line-height:1.5;">tun
ifconfig tap0 </span><span style="color:rgb(128,0,128);line-height:1.5;">0.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.0</span><span style="line-height:1.5;"> promisc
brctl addbr mgtbr0
brctl addif mgtbr0 tap0 </span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">2. 这是 mgtbr0 的配置脚本：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>[root@rh65 ~]# cat /etc/sysconfig/network-scripts/ifcfg-<span style="line-height:1.5;">mgtbr0
DEVICE</span>=<span style="line-height:1.5;">mgtbr0
TYPE</span>=<span style="line-height:1.5;">Ethernet
ONBOOT</span>=<span style="line-height:1.5;">yes
NM_CONTROLLED</span>=<span style="line-height:1.5;">no
BOOTPROTO</span>=<span style="color:rgb(136,136,136);line-height:1.5;">static</span><span style="line-height:1.5;">
IPADDR</span>=<span style="color:rgb(128,0,128);line-height:1.5;">10.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.100</span><span style="line-height:1.5;">
PREFIX</span>=<span style="color:rgb(128,0,128);line-height:1.5;">24</span><span style="line-height:1.5;">
GATEWAY</span>=<span style="color:rgb(128,0,128);line-height:1.5;">10.0</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0.1</span><span style="line-height:1.5;">
DEFROUTE</span>=<span style="line-height:1.5;">yes
IPV4_FAILURE_FATAL</span>=<span style="line-height:1.5;">yes
IPV6INIT</span>=<span style="line-height:1.5;">no
TYPE</span>=Bridge</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">3. 在网络和各计算节点上，增加一块网卡，连接到物理服务器上的 bridge。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201509/697113-20150922112728537-1652649810.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">把所有的节点连接到管理和租户网络后，在物理服务器上看到的 linux bridge 是这样子：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">bridge name     bridge id               STP enabled     interfaces
br0             </span><span style="color:rgb(128,0,128);line-height:1.5;">8000</span><span style="line-height:1.5;">.3440b5d905ee       no              eth1                 #物理网卡
                                                        vnet0                #controller 节点 
                                                        vnet1                #network 节点
                                                        vnet2                #compute1 节点
                                                        vnet3                #compute2 节点
                                                        vnet4                #ceph1 节点 
                                                        vnet5                #ceph2 节点
                                                        vnet8                #ceph3 节点
br1             </span><span style="color:rgb(128,0,128);line-height:1.5;">8000.000000000000</span><span style="line-height:1.5;">       no
mgtbr0          </span><span style="color:rgb(128,0,128);line-height:1.5;">8000</span><span style="line-height:1.5;">.f29e2c075ca6       no              tap0                 #虚拟网卡
                                                        vnet6                #network 节点
                                                        vnet7                #compute1 节点
                                                        vnet9                #compute2 节点</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">3.2 OpenStack 安装和配置</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 参考&nbsp;<a href="http://docs.openstack.org/kilo/install-guide/install/apt/content/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Installation Guide for Ubuntu 14.04 (LTS)</a>&nbsp;完成配置，没感觉到 Kilo 版本和 Juno 版本太大的不同，除了 keystone 使用 Apache web server 替代了 Keystone WSGI Server 以外（注意不能同时启动 apache2 和 keystone 服务，两者有冲突，感觉 Kilo 版本中 Identity 部分改动很大，还是存在不少问题）。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4. OpenStack 和 Ceph 整合配置</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">本例中，OpenStack Cinder、Glance 和 Nova 分别会将卷、镜像和虚机镜像保存到 Ceph &nbsp;分布式块设备（RBD）中。</p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">4.1 Ceph 中的配置</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）在 ceph 中创建三个 pool 分别给 Cinder，Glance 和 nova 使用</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ceph osd pool create volumes <span style="color:rgb(128,0,128);line-height:1.5;">64</span><span style="line-height:1.5;">
ceph osd pool create images </span><span style="color:rgb(128,0,128);line-height:1.5;">64</span><span style="line-height:1.5;">
ceph osd pool create vms </span><span style="color:rgb(128,0,128);line-height:1.5;">64</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）将 ceph 的配置文件传到 ceph client 节点 （glance-api, cinder-volume, nova-compute andcinder-backup）上：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>ssh controller sudo tee /etc/ceph/ceph.conf &lt;/etc/ceph/<span style="line-height:1.5;">ceph.conf
ssh compute1 sudo tee </span>/etc/ceph/ceph.conf &lt;/etc/ceph/<span style="line-height:1.5;">ceph.conf
ssh compute2 sudo tee </span>/etc/ceph/ceph.conf &lt;/etc/ceph/ceph.conf</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）在各节点上安装ceph 客户端</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>在 glance-<span style="line-height:1.5;">api 节点，安装 librbd
sudo apt</span>-<span style="color:rgb(0,0,255);line-height:1.5;">get</span> install python-<span style="line-height:1.5;">rbd

在 nova</span>-compute 和 cinder-volume 节点安装 ceph-<span style="line-height:1.5;">common：
sudo apt</span>-<span style="color:rgb(0,0,255);line-height:1.5;">get</span> install ceph-common</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（4）配置 cinder 和 glance 用户访问 ceph 的权限</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre># cinder 用户会被 cinder 和 nova 使用，需要访问三个pool<br>
ceph auth <span style="color:rgb(0,0,255);line-height:1.5;">get</span>-or-create client.cinder mon <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">allow r</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> osd <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rwx pool=vms, allow rx pool=images</span><span style="color:rgb(128,0,0);line-height:1.5;">'<br><br></span><span style="line-height:1.5;"># glance 用户只会被 Glance 使用，只需要访问 images 这个 pool
ceph auth </span><span style="color:rgb(0,0,255);line-height:1.5;">get</span>-or-create client.glance mon <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">allow r</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> osd <span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">allow class-read object_prefix rbd_children, allow rwx pool=images</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（5）将&nbsp;client.cinder 和&nbsp;client.glance 的 keystring 文件拷贝到各节点并设置访问权限</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">ceph auth get-or-create client.glance | ssh controller sudo tee /etc/ceph/ceph.client.glance.keyring
ssh controller  sudo chown glance:glance /etc/ceph/ceph.client.glance.keyring

ceph auth get-or-create client.cinder | ssh controller  sudo tee /etc/ceph/ceph.client.cinder.keyring
ssh controller  sudo chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring

ceph auth get-or-create client.cinder | ssh compute1 sudo tee /etc/ceph/ceph.client.cinder.keyring
ceph auth get-or-create client.cinder | ssh compute2 sudo tee /etc/ceph/ceph.client.cinder.keyring<br></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（6）在 compute1 和 compute2 节点上做 libvirt 配置</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>ceph auth get-key client.cinder | ssh compute1 tee client.cinder.key</pre> 
    <pre><span style="line-height:1.5;">cat &gt; secret.xml &lt;&lt;EOF
&lt;secret ephemeral='no' private='no'&gt;
  &lt;uuid&gt;e21a123a-31f8-425a-86db-7204c33a6161&lt;/uuid&gt;
  &lt;usage type='ceph'&gt;
    &lt;name&gt;client.cinder secret&lt;/name&gt;
  &lt;/usage&gt;
&lt;/secret&gt;
EOF
sudo virsh secret-define --file secret.xml
sudo virsh secret-set-value --secret e21a123a-31f8-425a-86db-7204c33a6161 --base64 $(cat client.cinder.key) &amp;&amp; rm client.cinder.key secret.xml</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">4.2 OpenStack 中的配置</h3> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4.2.1 Glance 中的配置</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>在 /etc/glance/glance-<span style="line-height:1.5;">api.conf 文件中做如下修改：

[DEFAULT]
...
show_image_direct_url </span>=<span style="line-height:1.5;"> True
...
[glance_store]
stores</span>=<span style="line-height:1.5;">glance.store.rbd.Store （设置为 rbd 也可以？）
default_store </span>=<span style="line-height:1.5;"> rbd
rbd_store_pool </span>=<span style="line-height:1.5;"> images
rbd_store_user </span>=<span style="line-height:1.5;"> glance
rbd_store_ceph_conf </span>= /etc/ceph/<span style="line-height:1.5;">ceph.conf
rbd_store_chunk_size </span>= <span style="color:rgb(128,0,128);line-height:1.5;">8</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">注意：如果在创建 image 时候出现 AttributeError: 'NoneType' object has no attribute 'Rados' 错误，则需要安装&nbsp;python-rados</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4.2.2 配置 Cinder</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>修改 /etc/cinder/<span style="line-height:1.5;">cinder.conf：

[DEFAULT]
...
#volume_group </span>= cinder-<span style="line-height:1.5;">volumes
volume_driver </span>=<span style="line-height:1.5;"> cinder.volume.drivers.rbd.RBDDriver
rbd_pool </span>=<span style="line-height:1.5;"> volumes
rbd_ceph_conf </span>= /etc/ceph/<span style="line-height:1.5;">ceph.conf
rbd_flatten_volume_from_snapshot </span>= <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">
rbd_max_clone_depth </span>= <span style="color:rgb(128,0,128);line-height:1.5;">5</span><span style="line-height:1.5;">
rbd_store_chunk_size </span>= <span style="color:rgb(128,0,128);line-height:1.5;">4</span><span style="line-height:1.5;">
rados_connect_timeout </span>= -<span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">
glance_api_version </span>= <span style="color:rgb(128,0,128);line-height:1.5;">2</span><span style="line-height:1.5;">
rbd_user </span>=<span style="line-height:1.5;"> cinder
rbd_secret_uuid </span>= e21a123a-31f8-425a-86db-<span style="line-height:1.5;">7204c33a6161
...</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">注意：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）cinder-volume 节点上的 ceph 配置文件是必须存在的，因为 cinder-volume 需要使用它来建立和 Ceph 集群的连接，不存在的话则会报错误。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">cinder/volume/drivers/rbd.py 文件：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>client = self.rados.Rados(rados_id=<span style="line-height:1.5;">self.configuration.rbd_user, conffile</span>=self.configuration.rbd_ceph_conf)</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">缺失 ceph 配置文件时 cinder-volume 报错：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(128,0,128);line-height:1.5;">2016</span>-<span style="color:rgb(128,0,128);line-height:1.5;">01</span>-<span style="color:rgb(128,0,128);line-height:1.5;">02</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">23</span>:<span style="color:rgb(128,0,128);line-height:1.5;">54.127</span> <span style="color:rgb(128,0,128);line-height:1.5;">25433</span> INFO cinder.volume.manager [req-d921feed-db0b-<span style="color:rgb(128,0,128);line-height:1.5;">4643</span>-b01b-13dde3da6285 - - - - -] Starting volume driver RBDDriver (<span style="color:rgb(128,0,128);line-height:1.5;">1.1</span>.<span style="color:rgb(128,0,128);line-height:1.5;">0</span><span style="line-height:1.5;">)
</span><span style="color:rgb(128,0,128);line-height:1.5;">2016</span>-<span style="color:rgb(128,0,128);line-height:1.5;">01</span>-<span style="color:rgb(128,0,128);line-height:1.5;">02</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">23</span>:<span style="color:rgb(128,0,128);line-height:1.5;">54.162</span> <span style="color:rgb(128,0,128);line-height:1.5;">25433</span> ERROR cinder.volume.manager [req-d921feed-db0b-<span style="color:rgb(128,0,128);line-height:1.5;">4643</span>-b01b-13dde3da6285 - - - - -<span style="line-height:1.5;">] Error encountered during initialization of driver: RBDDriver
</span><span style="color:rgb(128,0,128);line-height:1.5;">2016</span>-<span style="color:rgb(128,0,128);line-height:1.5;">01</span>-<span style="color:rgb(128,0,128);line-height:1.5;">02</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">23</span>:<span style="color:rgb(128,0,128);line-height:1.5;">54.163</span> <span style="color:rgb(128,0,128);line-height:1.5;">25433</span> ERROR cinder.volume.manager [req-d921feed-db0b-<span style="color:rgb(128,0,128);line-height:1.5;">4643</span>-b01b-13dde3da6285 - - - - -] error calling conf_read_file: errno EINVAL</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">对 cinder-volume 来说，它所需要的 ceph.conf 中的信息主要是 MON 服务器的地址，以及cinder 所使用的用户的验证方式，因此需要将keystring 文件&nbsp;ceph.client.cinder.keyring 放在同一个目录下面。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>mon_initial_members =<span style="line-height:1.5;"> ceph1, ceph2, ceph3
mon_host </span>= <span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.194</span>,<span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.195</span>,<span style="color:rgb(128,0,128);line-height:1.5;">9.115</span>.<span style="color:rgb(128,0,128);line-height:1.5;">251.218</span><span style="line-height:1.5;">
auth_cluster_required </span>=<span style="line-height:1.5;"> cephx
auth_service_required </span>=<span style="line-height:1.5;"> cephx
auth_client_required </span>=<span style="line-height:1.5;"> cephx
filestore_xattr_use_omap </span>= <span style="color:rgb(0,0,255);line-height:1.5;">true</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）可以支持 multi-backend 配置，在每个 backend 中使用不同的 Ceph pool，甚至使用不同的&nbsp;rbd_ceph_conf 来支持多个 Ceph 集群。</p> 
   <h4 style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">4.3.3 配置 Nova</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>在每个计算节点上的 /etc/nova/<span style="line-height:1.5;">nova.conf 文件中做如下修改：

[libvirt]
images_type </span>=<span style="line-height:1.5;"> rbd <span style="color:rgb(0,0,255);line-height:1.5;">#只有在 boot disk 放在 ceph 中才需要配置这个，否则，设置为 qcow2</span>
images_rbd_pool </span>=<span style="line-height:1.5;"> vms
images_rbd_ceph_conf </span>= /etc/ceph/<span style="line-height:1.5;">ceph.conf
rbd_user </span>=<span style="line-height:1.5;"> cinder
rbd_secret_uuid </span>= e21a123a-31f8-425a-86db-<span style="line-height:1.5;">7204c33a6161<br>
disk_cachemodes</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">network=writeback</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">
hw_disk_discard </span>= unmap<br><span class="n" style="line-height:1.5;">inject_password <span class="o" style="line-height:1.5;">= <span class="n" style="line-height:1.5;">false<br></span></span></span><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="n" style="line-height:1.5;">inject_key <span class="o" style="line-height:1.5;">= <span class="n" style="line-height:1.5;">false<br></span></span></span></span></span></span><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="o" style="line-height:1.5;"><span class="n" style="line-height:1.5;"><span class="n" style="line-height:1.5;">inject_partition <span class="o" style="line-height:1.5;">= <span class="o" style="line-height:1.5;">-<span class="mi" style="line-height:1.5;">2<br></span></span></span></span></span></span></span></span></span></span><span class="n" style="line-height:1.5;">live_migration_flag<span class="o" style="line-height:1.5;">=<span class="s" style="line-height:1.5;">"VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_PERSIST_DEST,VIR_MIGRATE_TUNNELLED"</span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">注意：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（1）如果只是将 ceph volume 挂接到 Nova 虚机的话，nova-compute 是不需要从 ceph 配置文件中读取 MON 服务器的信息的，因此，在计算节点上，缺失 ceph 配置文件其实是不影响将 ceph 卷挂接到 nova 虚机的。&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 这是因为 cinder 会将 ceph MON 地址传给nova-compute，因此，nova-compute 不需要读取 ceph 配置文件。注意这是 Havana 以后的行为，对于之前的版本，nova-compute 从 ceph 配置文件中读取 MON 信息，因此需要 ceph 配置文件。详见 ticket：<a href="https://bugs.launchpad.net/nova/+bug/1077817" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">Nova failed to mount a RBD volume without extra ceph.conf</a>。做了这个改动以后，另一个好处是，向 nova 支持多个 ceph 集群提供了可能，因为使用 ceph 配置文件的话只能使用一个文件，而 cinder 中可以&nbsp;使用 multi-backend 技术来支持多个 ceph 集群。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>&lt;disk type=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">network</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> device=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">disk</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>&gt;
      &lt;driver name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">qemu</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">raw</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> cache=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">writeback</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
      &lt;auth username=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">cinder</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>&gt;
        &lt;secret type=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">ceph</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> uuid=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">e21a123a-31f8-425a-86db-7204c33a6161</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
      &lt;/auth&gt;
      &lt;source protocol=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">rbd</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">volumes/volume-b4e9a905-d59e-46e4-aa6d-e57c90000013</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>&gt;
        &lt;host name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">9.115.251.194</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> port=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">6789</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
        &lt;host name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">9.115.251.195</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> port=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">6789</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
        &lt;host name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">9.115.251.218</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> port=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">6789</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
      &lt;/source&gt;
      &lt;backingStore/&gt;
      &lt;target dev=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">vdb</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> bus=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">virtio</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
      &lt;serial&gt;b4e9a905-d59e-46e4-aa6d-e57c90000013&lt;/serial&gt;
      &lt;alias name=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">virtio-disk1</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
      &lt;address type=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">pci</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> domain=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">0x0000</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> bus=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">0x00</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> slot=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">0x06</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span> function=<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">0x0</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>/&gt;
    &lt;/disk&gt;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp; 因此，如果只是需要支持将 Ceph 卷挂接到 nova 虚机的话，可以在计算节点上的 ceph 配置文件中，可以只保留 client 部分的配置信息，包括 RBD Cache 的配置以及日志配置等，这样就可以避免和具体哪一个 Ceph 集群的硬绑定。比如：&nbsp;&nbsp;</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">[client]
rbd cache = true<span style="line-height:1.5;"> #rbd cache = false<span style="line-height:1.5;"> #rbd cache writethrough until flush = true<span style="line-height:1.5;"> #admin socket = /var/run/ceph/$cluster-<span style="line-height:1.5;">$type.$id.$pid.$cctid.asok log file = /var/log/ceph/qemu-<span style="line-height:1.5;">guest.$pid.log #log file = /var/lib/libvirt/qemu/qemu-<span style="line-height:1.5;">guest.$pid.log admin socket=/var/log/ceph/rbd-<span style="line-height:1.5;">$pid.asok debug rbd = 20<span style="line-height:1.5;"> debug rbd = 20<span style="line-height:1.5;">, debug objectcacher=20<span style="line-height:1.5;"> debug objecter=20<span style="line-height:1.5;"> debug ms = 1</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（2）如果用户选择将 boot disk 放在 Ceph 中的话，需要在 nova.conf 中配置&nbsp;images_rbd_ceph_conf ，这是因为就像 cinder-volume 一样，nova-compute 需要使用 ceph.conf 和其它参数创建和 Ceph 的连接，然后使用 ”rbd import --pool “命令来创建 image。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 这种情况下，如果没有 ceph.conf 文件的话，启动 nova-compute 服务时就会报错：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre><span style="color:rgb(128,0,128);line-height:1.5;">2016</span>-<span style="color:rgb(128,0,128);line-height:1.5;">01</span>-<span style="color:rgb(128,0,128);line-height:1.5;">02</span> <span style="color:rgb(128,0,128);line-height:1.5;">22</span>:<span style="color:rgb(128,0,128);line-height:1.5;">27</span>:<span style="color:rgb(128,0,128);line-height:1.5;">30.920</span> <span style="color:rgb(128,0,128);line-height:1.5;">25407</span> ERROR nova.openstack.common.threadgroup [req-9a61379c-52e9-48b7-9f7c-91c928fdaf2b - - - - -] error calling conf_read_file: errno EINVAL</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; &nbsp;因此，此时的 nova-compute 和 glance 以及 cinder-volume 的角色没什么不同，它们也需要使用相同的 ceph 配置文件。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 如果你要在一个 hypervisor 上使用不同的 ceph pool 甚至不同的 ceph cluster 的话，可以在该 hypervisor 上启动多个 nova-compute 进程，具体可以参考&nbsp;<a href="http://bbs.ceph.org.cn/article/14" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">&nbsp;OpenStack Nova: 在一个hypervisor中配置多个Ceph后端</a>。其主要的步骤是：</p> 
   <ol style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">创建两个 ceph pool</li> 
    <li style="list-style-type:decimal;">配置并启动两个 &nbsp;nova-compute进程（<em style="font-family:'Courier New';font-size:12px;line-height:1.5;">这需要配置DNS解析或者在/etc/hosts定义你的主机名在你的openstack控制节点</em><em style="line-height:1.5;">）</em> </li> 
   </ol>
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.5;">
第一个nova</span>-compute 进程使用的是nova-<span style="line-height:1.5;">ceph1配置文件：

[DEFAULT]
host </span>= compute-<span style="line-height:1.5;">ceph1

[libvirt]
images_rbd_ceph_conf </span>= /etc/ceph/<span style="line-height:1.5;">ceph.conf
images_rbd_pool </span>=<span style="line-height:1.5;"> vms
images_type </span>=<span style="line-height:1.5;"> rbd

第二个nova</span>-compute 进程使用的是nova-<span style="line-height:1.5;">ceph2配置文件：

[DEFAULT]
host </span>= compute-<span style="line-height:1.5;">ceph2

[libvirt]
images_rbd_ceph_conf </span>= /etc/ceph/<span style="line-height:1.5;">ceph.conf
images_rbd_pool </span>=<span style="line-height:1.5;"> vms2
images_type </span>=<span style="line-height:1.5;"> rbd

现在你需要执行如下命令启动你的nova进程：

nova</span>-compute --config-file /etc/nova/nova-ceph1.conf --config-file /etc/nova/nova-ceph2.conf</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <ol style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <li style="list-style-type:decimal;">创建两个逻辑上独立的Host aggregates，并且将compute-ceph1和compute-ceph2分别加入</li> 
    <li style="list-style-type:decimal;">使用 scheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter,AggregateInstanceExtraSpecsFilter，确保新的flavor选择逻辑的aggregates,其实就是选择nova实例运行在哪个ceph存储池</li> 
   </ol>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp; 最后的实现效果是：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images2015.cnblogs.com/blog/697113/201601/697113-20160103081231276-1428731956.jpg" alt="" width="388" height="332" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">（3）nova-compute 节点上，另一个会用到 ceph 配置文件的是 qemu。它需要读取其中的 cache 配置。关于 qemu/KVM 和 RBD cache，可以阅读我的另一篇 blog：<a href="http://www.cnblogs.com/sammyliu/p/5066895.html" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">QEMU-KVM 和 Ceph RBD 的 缓存机制总结</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;&nbsp;<span style="line-height:1.5;">至此，环境安装和配置完成，通过 cinder，glance 和 nova 命令创建的卷、镜像和虚机的镜像都会被保存在 Ceph 的 RBD 中。接下来的文章会深入分析其中的原理和实现。</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;参考文档：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://docs.ceph.com/docs/master/rbd/rbd-openstack/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://docs.ceph.com/docs/master/rbd/rbd-openstack/</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">Ceph 官方的一个测试环境：（来源：<a href="http://ceph.com/category/performance-2/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://ceph.com/category/performance-2/</a>）</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;<img src="https://images2015.cnblogs.com/blog/697113/201510/697113-20151015175509835-1164576555.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="line-height:1.5;"><font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/4804037.html</span></font><span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
