<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Web APi入门之Self-Host寄宿及路由原理（二） « NotBeCN</title>
  <meta name="description" content="             前言    刚开始表面上感觉Web API内容似乎没什么，也就是返回JSON数据，事实上远非我所想，不去研究不知道，其中的水还是比较深，那又如何，一步一个脚印来学习都将迎刃而解。    Self-Host    我们知道Web API它可以快速为HTTP客户端提供API来创建Web服务，...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/13/weixin_34224941_90129073.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Web APi入门之Self-Host寄宿及路由原理（二）</h1>
    <p class="post-meta">Nov 13, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="font-size:28px;line-height:1.5;font-family:'Helvetica Neue', Arial;">前言</h1> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">刚开始表面上感觉Web API内容似乎没什么，也就是返回JSON数据，事实上远非我所想，不去研究不知道，其中的水还是比较深，那又如何，一步一个脚印来学习都将迎刃而解。</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:'Helvetica Neue', Arial;"><span style="font-family:'微软雅黑';line-height:23.4px;">Self-Host</span></h1> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;"><span style="font-family:'微软雅黑';line-height:23.4px;">我们知道Web API它可以快速为HTTP客户端提供API来创建Web服务，为何如此这样说呢？因为我们可以将其作为主机也就是一个服务器来用完全不需要IIS，这就是我们下面要讲的第一个内容Self-Host，实现对Web API寄宿的方式有多种并且都是独立于ASP.NET框架之外，如下Self-Host寄宿是存在于Web API 1中的，而在Web API 2中实现寄宿是采用Web-Host来进行寄宿（通过程序包packages中的Web-Host以及Web Client可得知），因为Web API本身是无法提供【请求-响应】的机制，所以需要寄宿来实现，即通过具体的应用程序来为Web API运行提供一个环境。下面且听我娓娓道来。既然是进行交互必然有服务器和客户端，下面我们将从建立控制台应用程序开始来进行了解。</span></h4> 
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);"><span style="font-family:'微软雅黑';line-height:23.4px;">Web API服务器</span></h2> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">第一步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">建立一个SelfHost的控制台应用程序，添加【Microsoft.AspNet.WebApi.SelfHost】程序包，搜索时会出现多个包注意不是【AspNetWebApi.SelfHost.】如下：</h4> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;"><img src="https://images2015.cnblogs.com/blog/589642/201509/589642-20150916204948023-684563307.png" alt="" style="border:0px;"></p> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">&nbsp;第二步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">添加类，如下：</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Product
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> Id { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Name { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Category { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">decimal</span> Price { <span style="color:rgb(0,0,255);line-height:1.5;">get</span>; <span style="color:rgb(0,0,255);line-height:1.5;">set</span><span style="line-height:1.5;">; }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">&nbsp;第三步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">添加派生自APiController控制的类以及要演示的数据，如下：</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">    public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> ProductsController : ApiController
    {
        Product[] products </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Product[]  
        {  
            </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> Product { Id = <span style="color:rgb(128,0,128);line-height:1.5;">1</span>, Name = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Tomato Soup</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Category = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Groceries</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Price = <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;"> },  
            </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> Product { Id = <span style="color:rgb(128,0,128);line-height:1.5;">2</span>, Name = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Yo-yo</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Category = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Toys</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Price = <span style="color:rgb(128,0,128);line-height:1.5;">3.75M</span><span style="line-height:1.5;"> },  
            </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> Product { Id = <span style="color:rgb(128,0,128);line-height:1.5;">3</span>, Name = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hammer</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Category = <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Hardware</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, Price = <span style="color:rgb(128,0,128);line-height:1.5;">16.99M</span><span style="line-height:1.5;"> }  
        };

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> IEnumerable&lt;Product&gt;<span style="line-height:1.5;"> GetAllProducts()
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> products;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product GetProductById(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> product = products.FirstOrDefault((p) =&gt; p.Id ==<span style="line-height:1.5;"> id);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (product == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> HttpResponseException(HttpStatusCode.NotFound); <span style="color:rgb(128,128,0);line-height:1.5;">//如果未找到数据并返回状态码404</span>
            }
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> product;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> IEnumerable&lt;Product&gt; GetProductsByCategory(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> category)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> products.Where(p =&gt; <span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;">.Equals(p.Category, category,
                    StringComparison.OrdinalIgnoreCase));
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">第四步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">在控制台主程序中配置服务器以及添加路由</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">var</span> config = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> HttpSelfHostConfiguration(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">http://localhost:8080</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">); <span style="color:rgb(128,128,0);line-height:1.5;">//配置主机</span>

config.Routes.MapHttpRoute(    <span style="color:rgb(128,128,0);line-height:1.5;">//配置路由 </span></span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">API Default</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/{controller}/{id}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, 
    </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> { id =<span style="line-height:1.5;"> RouteParameter.Optional });

</span><span style="color:rgb(0,0,255);line-height:1.5;">using</span> (HttpSelfHostServer server = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> HttpSelfHostServer(config)) <span style="color:rgb(0,128,0);line-height:1.5;">//监听HTTP</span>
{
    server.OpenAsync().Wait(); <span style="color:rgb(0,128,0);line-height:1.5;">//开启来自客户端的请求</span>
    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Press Enter to quit.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
    Console.ReadLine();
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">以上就是关于Web API关于主机的设置，接下来就是建立一个客户端来访问此服务器上的资源。</p> 
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">Web API客户端&nbsp;</h2> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">第一步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">同理建立一个ClientApp的控制台应用程序，同时添加Web API客户端程序包【Microsoft.AspNet.WebApi.Client】如下：</h4> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;"><img src="https://images2015.cnblogs.com/blog/589642/201509/589642-20150916210707711-1210646218.png" alt="" style="border:0px;"></p> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">第二步</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">既然是要访问服务器上的资源，自然要添加对Web API服务器（SelfHost）的引用了。&nbsp;</h4> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;"><span style="font-family:'微软雅黑';line-height:23.4px;">第三步</span></h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;"><span style="font-family:'微软雅黑';line-height:23.4px;">接下来就是建立客户端并读取服务器上的资源</span></h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> HttpClient client = <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> HttpClient(); <span style="color:rgb(128,128,0);line-height:1.5;">//利用此对象进行对Web API的调用 </span></span><span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> ListAllProducts()
{
    HttpResponseMessage resp </span>= client.GetAsync(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/products</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">).Result;
    resp.EnsureSuccessStatusCode();

    </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> products = resp.Content.ReadAsAsync&lt;IEnumerable&lt;SelfHost.Product&gt;&gt;<span style="line-height:1.5;">().Result;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">foreach</span> (<span style="color:rgb(0,0,255);line-height:1.5;">var</span> p <span style="color:rgb(0,0,255);line-height:1.5;">in</span><span style="line-height:1.5;"> products)
    {
        Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">{0} {1} {2} ({3})</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, p.Id, p.Name, p.Price, p.Category);
    }
}

</span><span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> ListProduct(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> resp = client.GetAsync(<span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/products/{0}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, id)).Result;
    resp.EnsureSuccessStatusCode();

    </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> product = resp.Content.ReadAsAsync&lt;SelfHost.Product&gt;<span style="line-height:1.5;">().Result;
    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ID {0}: {1}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, id, product.Name);
}

</span><span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> ListProducts(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> category)
{
    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Products in '{0}':</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, category);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">string</span> query = <span style="color:rgb(0,0,255);line-height:1.5;">string</span>.Format(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/products?category={0}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">, category);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> resp =<span style="line-height:1.5;"> client.GetAsync(query).Result;
    resp.EnsureSuccessStatusCode();

    </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> products = resp.Content.ReadAsAsync&lt;IEnumerable&lt;SelfHost.Product&gt;&gt;<span style="line-height:1.5;">().Result;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">foreach</span> (<span style="color:rgb(0,0,255);line-height:1.5;">var</span> product <span style="color:rgb(0,0,255);line-height:1.5;">in</span><span style="line-height:1.5;"> products)
    {
        Console.WriteLine(product.Name);
    }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <ul style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">通过调用HttpClient.GetAsync来发出一个Get请求来请求服务器上的Uri资源。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">通过调用HttpResponseMessage.EnsureSuccessStatusCode方法来确定请求是否成功，若失败即返回错误状态码则抛出一个异常。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">通过调用ReadAsAsync&lt;T&gt;将HTTP中响应的数据类型进行反序列化，该方法为一个扩展方法。</h4> </li> 
   </ul>
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">GetAsync和ReadAsync为异步方法，直到获得结果值即Result属性的值操作完成，否则将一直阻塞线程。</p> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">第四步&nbsp;</h3> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">最后在客户端控制台主程序中建立客户端与服务器端的通信服务即可&nbsp;</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>    client.BaseAddress = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> Uri(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">http://localhost:8080</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);

    ListAllProducts();
    ListProduct(</span><span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">);
    ListProducts(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">toys</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);

    Console.WriteLine(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Press Enter to quit.</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
    Console.ReadLine();</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">接下来就是启动Web API服务器程序，通过Web API客户端来访问服务器并获得其请求的资源。【注意】windows 8系统启动服务器必须以管理员身份运行，否则报错。</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">访问资源成功，如下：</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;"><img src="https://images2015.cnblogs.com/blog/589642/201509/589642-20150916215237820-39666415.png" alt="" style="border:0px;"></p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:'Helvetica Neue', Arial;">路由原理</h1> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">&nbsp;如果对MVC框架中路由熟悉的话，Web API的路由原理和其相似，但是不同的是Web API是使用的HTTP方法来选择Action方法而不是通过URI路径来选择Action方法。</p> 
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">路由表</h2> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;"><span style="font-family:'微软雅黑';line-height:23.4px;">在Web API中处理HTTP请求的是一个控制器类，控制器中的公有方法叫做Action方法，当Web API框架获得一个请求时，会根据请求路由到一个Action方法上。为了决定调用哪个Action方法，Web API框架利用路由表来决定，当创建项目模板时将在App_Start文件下的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">WebApiConfig</span>&nbsp;创建一个默认的路由，如下：</span></h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="line-height:1.5;">           config.Routes.MapHttpRoute(
                name: </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">DefaultApi</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                routeTemplate: </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/{controller}/{id}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
                defaults: </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> { id =<span style="line-height:1.5;"> RouteParameter.Optional }
            );</span></pre>
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">当我们需要将Web API作为服务器时此时必须直接在HttpSelfHostConfiguration上设置路由表【上述关于SelfHost已经演示】&nbsp;</p> 
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">注册路由</h2> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">在Web API路由配置文件中有一个&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">Register</span>&nbsp;方法，该方法中有一个&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpConfiguration</span>&nbsp;<span style="color:rgb(0,0,0);">实例参数，该HttpConfiguration是消息管道中的全局对象，我们可以通过其对管道某一个行为作出相关操作，从而达到我们所需。通过HttpConfiguration上的属性_routes即&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpRouteCollection</span>&nbsp;对象中的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">CreateRoute</span>&nbsp;方法再依据默认的路由模板、默认值以及相关约束来创建实现了&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">IHttpRoute</span>&nbsp;接口的路由对象即&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpRoute</span>&nbsp;，并通过HttpConfiguration中的Routes对象中的扩展方法MapHttpRoute方法来达到注册路由映射的目的，当然我们也可以直接通过调用路由集合HttpRouteCollection中的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">Add</span>&nbsp;方法来注册路由到路由表中。</span><span style="color:rgb(0,0,0);"><br></span></p> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">路由表中每一条都包含一个对应的路由模板，Web API默认的路由模板是api/{controller}/{id} ，在此模板下，api是一个路径段，而{controller}和{id}是占位符。当Web API收到HTTP请求时，它尝试去匹配路由表中的路由模板之一的URI，若没匹配上，则返回404。</h4> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">例如，用下面的URI来匹配默认的路由</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>/api/<span style="line-height:1.5;">contacts

</span>/api/contacts/<span style="color:rgb(128,0,128);line-height:1.5;">1</span>

/api/products/gizmo1</pre>
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">【注意】为何在Web API的控制器中以API开头的原因是避免和MVC框架中的路由冲突，如/contacts会进入到MVC路由中，而/api/contacts会进入到Web API框架中，当然我们可以通过改变默认的路由表来改变约定，但是不建议这么做。&nbsp;</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">一旦一个匹配的路由被找到，Web API根据默认约定来选择Controller和Action：</p> 
   <ul style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">Web API会用Controller替代占位符{controller}的值中来找到控制器。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">Web API着眼根据HTTP方法来找到Action方法，然后找到一个以一个HTTP方法的名称开始的Action方法，例如，对于一个Get请求，Web API会找到一以Get开头的Action方法，如：GetContact或者GetAllContact的Action方法。这种约定同样也适用于GET、POST、PUT以及DELETE方法。我们通过在控制器上使用特性来启用其他的方法。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">&nbsp;在路由模板中的其他的占位符，如{id}被映射到action方法参数上。</h4> </li> 
   </ul>
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">查找控制器</h2> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">当一个URI资源请求过来时Web API框架会查找已经注册的路由表中的路由并进行匹配，如果匹配通过，此时将创建一个包含每个占位符的值的字典，字典的键为占位符的名称，当然不包括大括号，字典的值为请求过来的URI中的值或者是路由模板中的默认值，然后这个字典将会保存在&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">IHttpRouteData</span>&nbsp;对象中的字典中。该对象还存在一个路由对象IHttpRoute。当请求的URI过来时，此时会通过请求信息即&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:12px;"><span style="font-size:16px;line-height:1.5;">HttpRequestMessage</span>&nbsp;</span>&nbsp;对象中的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">RquestUri</span>&nbsp;属性来获得其URI，接下来HttpRoute会接受到HttpRequestMessage中的URI并进行解析，然后将通过调用&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">GetRouteData</span>&nbsp;等方法来封装路由数据给实现了IHttpRouteData接口的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpRouteData</span>&nbsp;，通过HttpRouteData中的构造函数中的路由对象来获取传递过来的路由对象HttpRoute（该路由对象也根据请求过来的路由变量来绑定到路由模板中最终生成一个完整的URL），同时因为实现了IHttpRouteData接口则此时该接口的字典将传递给HttpRouteData构造函数中的路由字典即&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpRouteValueDictionary</span>&nbsp;。【注意】GetRouteData方法中的参数有一个为virtualPathRoot即虚拟根路径，当执行此方法时得到的是相对路径，也就是说通过路由模板进行匹配是根据相对路径来进行匹配的。</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;"><span style="color:rgb(0,0,0);">查找控制器是通过&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">IHttpControllerSelector</span>&nbsp;接口上的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">SelectController</span>&nbsp;&nbsp;，此方法参数为HttpRequestMessage的实例并返回一个&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpControllerDescriptor</span>&nbsp;，此接口的默认实现是通过&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">DefaultHttpControllerSelector</span>&nbsp;&nbsp;类实现，此类实现的算法有如下三点：</span></p> 
   <ul style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span>在上述路由字典即HttpRouteValueDictionary中查找controller的键。</span></h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span>获取键的值并将字符串Controller作为控制器的类型名。</span></h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span>用此类型名来查找一个Web API控制器。</span></h4> </li> 
   </ul>
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">查找Action</h2> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">在查找到控制器之后，框架将会通过&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">IHttpActionSelector</span>&nbsp;接口中的&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">SelectAction</span>&nbsp;方法来查找Action方法，该方法参数要获取一个控制器上下文即&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpControllerContext</span>&nbsp;<span style="color:rgb(255,0,0);"><span style="color:rgb(0,0,0);">返回一个&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">HttpActionDescriptor</span>&nbsp;对象实例。其默认实现是通过&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">APiControllerActionSelector</span>&nbsp;来提供的，要查找到Action要经过如下三点：</span></span></p> 
   <ul style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span style="line-height:1.5;">请求的HTTP方法。</span></h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span style="line-height:1.5;">在路由模板中占位符{action}对应的值。</span></h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;"><span style="line-height:1.5;">在控制器上Action方法的参数。&nbsp;</span></h4> </li> 
   </ul>
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;"><span style="line-height:1.5;">【注意】如何确定在控制上的方法是Action方法呢？当查找Action方法时，仅仅只着眼于控制上的公有的实例方法（不包括从APiController上继承的特殊名称的方法，如：重载、事件、构造等等）并且是从APiController类上继承的方法。</span></p> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">总结</h3> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">综上所述，对于Web API上的一个路由系统总共有三个阶段</p> 
   <ul style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">匹配一个URI到一个路由模板。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">选择一个控制器。</h4> </li> 
    <li style="list-style:disc inside;"> <h4 style="color:rgb(0,0,0);font-size:14px;">选择一个Action方法。</h4> </li> 
   </ul>
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">当然你可以对路由模板进行自定义以及相关参数利用正则表达式进行约束等，这就不再详细描述。</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">接下来我们就上述叙述来进行相关例子</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> ProductsController : ApiController
{
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> GetAllProducts() { }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> IEnumerable&lt;Product&gt; GetProductById(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id) { }
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> HttpResponseMessage DeleteProduct(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id){ }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">对于以下可能的HTTP请求，会对于每个请求对应应该被调用的Action方法。</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">HTTP Method</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">URI PATH</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">Action</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">Parameter</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GET</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">api/products</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GetAllProducts</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">(none)</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GET</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">api/products/4</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">GetProductById</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">4</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">DELETE</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">api/products/4</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">DeleteProduct</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">4</td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">POST</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">api/products</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">(no match)</td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
    </tbody>
   </table>
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">&nbsp;</p> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">【注意】在上述中的URI的{id}，如果存在则会被映射到Action方法中的id参数中，如上述中两种Get方法，一个有id参数一个没有没有id参数。同时也应注意POST请求将会失败，因为在控制器中没有定义一个POST....方法。</p> 
   <h3 style="color:rgb(111,168,51);font-size:16px;line-height:1.5;border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Helvetica Neue', Arial;">根据约定来进行映射Action方法注意</h3> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">假设Web API控制器名称ProductController并继承APiController，在该控制器下有如下两个方法：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product GetProductById(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> product = products.FirstOrDefault((p) =&gt; p.Id ==<span style="line-height:1.5;"> id);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (product == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)
            {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> HttpResponseException(HttpStatusCode.NotFound);
            }
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> product;
        }


        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Get(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">value</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">;
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">当发出Get（如：/api/product/1）请求时将会出错，出错原因为匹配到多个路由，默认能够匹配到GetProductById方法就不用说了，此时同样能匹配到Get方法，所以此时需要将Get标记为【NonAction】或者采用其他方法来区别这两个路由。</h4> 
   <h2 style="color:rgb(255,255,255);line-height:1.5;font-size:21px;font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">HTTP方法&nbsp;</h2> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">除了使用约定的HTTP方法之外，我们也可以使用特性HttpGet、HttpPost、HttpPut以及HttpDelete来修饰Action方法来显式指定一个Action的HTTP方法。</p> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">在下面的例子中，FindProduct方法会被映射到GET请求。</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> ProductsController : ApiController
{
    [HttpGet]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Product FindProduct(id) {}
}</span></pre>
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">我们可以使用&nbsp;<span class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(255,0,0);font-family:'Courier New';font-size:16px;">AcceptVerbs</span>&nbsp;<span style="color:rgb(0,0,0);">特性对一个Action使用多个HTTP方法或者说是使用HTTP方法而不是POST、DELETE、GET以及PUT，如下：</span></p> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;"><span>多个请求到同一Action</span></h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>        [AcceptVerbs(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">GET</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Post</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product FindProduct(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {
           
        }

或者
        [AcceptVerbs(HttpVerbs.Get </span>|<span style="line-height:1.5;"> HttpVerbs.Post)]
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product FindProduct(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {
          
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">根据请求不同来响应相同Action，如下：</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>        <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product FindProduct(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id)
        {

        }

        [AcceptVerbs(HttpVerbs.Post]
        </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> Product FindProduct(<span style="color:rgb(0,0,255);line-height:1.5;">string</span> guid) { }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">&nbsp;通过Action名称配置路由</h4> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">由于默认的路由模板，Web API使用HTTP方法来选择Action，但是我们可以创建一个包括在URI中的Action名称的路由。如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="line-height:1.5;">routes.MapHttpRoute(
    name: </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ActionApi</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
    routeTemplate: </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">api/{controller}/{action}/{id}</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">,
    defaults: </span><span style="color:rgb(0,0,255);line-height:1.5;">new</span> { id =<span style="line-height:1.5;"> RouteParameter.Optional }
);</span></pre>
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">在上述路由模板中，{action} 参数名称命名了在控制器上的Action方法，在此种路由下，可以使用特性来指定HTTP方法，例如，允许控制器有如下方法：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> ProductsController : ApiController
{
    [HttpGet]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> Details(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id);
}</span></pre>
   </div> 
   <p style="color:rgb(17,17,17);font-family:'Helvetica Neue', Arial;font-size:13px;line-height:23.4px;">在此种情况下，对于api/products/details的GET请求会映射到Details方法，这种路由风格和MVC相似。</p> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">通过使用ActionName特性来覆盖Action的名称，例如下列例子，有两种映射到如api/products/thumbnail/id的方法，一种支持GET请求，一种支持POST请求</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> ProductsController : ApiController
{
    [HttpGet]
    [ActionName(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Thumbnail</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> HttpResponseMessage GetThumbnailImage(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id);

    [HttpPost]
    [ActionName(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Thumbnail</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">)]
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> AddThumbnailImage(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> id);
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(45,161,45);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">Non-Actions</h4> 
   <h4 style="font-size:14px;font-family:'Helvetica Neue', Arial;">为了阻止一个方法作为Action方法被调用，通过使用Non-Actions特性来将其标记为不是一个Action方法，即使这个方法匹配到了路由规则</h4> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);"> 
    <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Not an action method.</span>
<span style="line-height:1.5;">[NonAction]  
</span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">string</span> GetPrivateData() { ... }</pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre><br></pre> 
    <pre></pre> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
