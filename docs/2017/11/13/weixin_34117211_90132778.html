<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Nova: 虚机的块设备总结 [Nova Instance Block Device] « NotBeCN</title>
  <meta name="description" content="             和物理机一样，虚拟机包括几个重要的部分：CPU、内存、磁盘设备、网络设备等。本文将简要总结虚机磁盘设备有关知识。    1. Nova boot CLI 中有关虚机块设备的几个参数    nova boot CLI 的完整参数如下：                       usage...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/13/weixin_34117211_90132778.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Nova: 虚机的块设备总结 [Nova Instance Block Device]</h1>
    <p class="post-meta">Nov 13, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">和物理机一样，虚拟机包括几个重要的部分：CPU、内存、磁盘设备、网络设备等。本文将简要总结虚机磁盘设备有关知识。</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">1. Nova boot CLI 中有关虚机块设备的几个参数</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">nova boot CLI 的完整参数如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>usage: nova boot [--flavor &lt;flavor&gt;<span style="line-height:1.5;">] 
</span><span style="color:rgb(0,0,255);line-height:1.5;">                 [</span><span style="color:rgb(0,0,255);line-height:1.5;"><span style="color:rgb(0,0,0);line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">--image &lt;image&gt;] //boot from image with id</span> [--image-with &lt;key=value&gt;] //image metadata properties</span>
                 [--boot-volume &lt;volume_id&gt;]
                 [--snapshot &lt;snapshot_id&gt;] 
                 [--block-device-mapping &lt;dev-name=mapping&gt;]
                 [--block-device key1=value1[,key2=value2...]]
                 [--swap &lt;swap_size&gt;</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">]</span>
                 <span style="color:rgb(0,0,255);line-height:1.5;">[</span></span><span style="color:rgb(0,0,255);line-height:1.5;">--ephemeral size=&lt;size&gt;[,format=&lt;format&gt;</span><span style="line-height:1.5;"><span style="color:rgb(0,0,255);line-height:1.5;">]]</span>
                 [</span>--min-count &lt;number&gt;] [--max-count &lt;number&gt;<span style="line-height:1.5;">] 
                 [</span>--meta &lt;key=value&gt;] [--key-name &lt;key-name&gt;<span style="line-height:1.5;">]
                 [</span>--file &lt;dst-path=src-path&gt;<span style="line-height:1.5;">] <span style="color:rgb(0,0,255);line-height:1.5;">//文件注入</span>
                 [</span>--user-data &lt;user-data&gt;<span style="line-height:1.5;">]
                 [</span>--availability-zone &lt;availability-zone&gt;<span style="line-height:1.5;">]
                 [</span>--security-groups &lt;security-groups&gt;<span style="line-height:1.5;">]                 
                 [</span>--hint &lt;key=value&gt;<span style="line-height:1.5;">]
                 [</span>--nic &lt;net-id=net-uuid,v4-<span style="color:rgb(0,0,255);line-height:1.5;">fixed</span>-ip=ip-addr,v6-<span style="color:rgb(0,0,255);line-height:1.5;">fixed</span>-ip=ip-addr,port-id=port-uuid&gt;<span style="line-height:1.5;">]
                 [</span>--config-drive &lt;value&gt;] [--<span style="line-height:1.5;">poll]
                 </span>&lt;name&gt;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">这里面，--boot-volume，--snapshot，--block-device-mapping，--block-device，&nbsp;--swap，--ephemeral 这几个参数都相似的功能。</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">1.1 --block-device 参数</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">该参数可以使用下面这些值：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">source=image|snapshot|volume|blank</li> 
    <li style="list-style-type:disc;">dest=volume|local</li> 
    <li style="list-style-type:disc;">id=XXXXXX (a volume|image|snapshot UUID if using source=volume|snapshot|image)</li> 
    <li style="list-style-type:disc;">format=swap|ext4|...|none (to format the image/volume/ephemeral file; defaults to 'none' if omitted)</li> 
    <li style="list-style-type:disc;">bus=ide|usb|virtio|scsi (hypervisor driver chooses a suitable default if omitted)</li> 
    <li style="list-style-type:disc;">device=the desired device name (e.g. /dev/vda, /dev/xda, ...)</li> 
    <li style="list-style-type:disc;">type=disk|cdrom|floppy|mmc (defaults to 'disk' if omitted)</li> 
    <li style="list-style-type:disc;">bootindex=N (where N is any number &gt;= 0, controls the order in which disks are looked at for booting)</li> 
    <li style="list-style-type:disc;">size=NN (where NN is number of GB to create type=emphemeral image, or the size to re-size to for type=glance|cinder)</li> 
    <li style="list-style-type:disc;">shutdown=preserve|remove</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这里面只有&nbsp;source 和 id 是必须的，别的都有默认值。比如：</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">--block-device source=image,dest=volume,id=XXXXXXX,bus=ide,bootindex=2</li> 
    <li style="list-style-type:disc;">--block-device source=volume,dest=volume,id=XXXXXXX,bus=ide,type=cdrom,bootdex=1</li> 
    <li style="list-style-type:disc;">--block-device source=blank,dest=local,format=swap,size=50,bus=ide,type=floppy</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">dest 会指定source 的 destination，包括本地的（local）和 Cinder 卷 （volume）。</p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">
    <tbody>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">dest</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">source</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">说明</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">shortcut</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">volume</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">volume</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">直接挂载到 compute 节点</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">当 boot_index = 0 时相当于&nbsp;--boot-volume &lt;volume_id&gt;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">snapshot</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">调用 cinder 依据快照创建新卷，挂载到compute节点</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">当 boot_index = 0 时相当于&nbsp;--snapshot &lt;snapshot_id&gt;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">image</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">调用cinder依据镜像创建新卷，挂载到compute节点</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">当 boot_index = 0 时相当于&nbsp;<span style="line-height:1.5;font-family:'Courier New';">--image &lt;image&gt; （Boot from image (creates a new volume)）</span> </td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">blank</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">通知cinder依大小创建空卷并挂载到compute节点</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;</td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">local</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">image</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">在 Hypervisor 上创建&nbsp;ephemeral 分区，将 image 拷贝到里面并启动虚机</p> </td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">相当于普通的&nbsp;Boot from image</p> </td> 
     </tr>
     <tr>
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">local</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;">blank</td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">format=swap 时，创建 swap 分区</p> <p style="line-height:1.5;">默认创建&nbsp;ephemeral &nbsp;分区</p> </td> 
      <td style="font-size:12px;color:rgb(69,69,69);border:1px solid #C0C0C0;border-collapse:collapse;"> <p style="line-height:1.5;">当&nbsp;boot_index=-1, shutdown=remove, format=swap&nbsp;时相当于&nbsp;--swap &lt;swap size in MB&gt;</p> <p style="line-height:1.5;">当&nbsp;boot_index=-1, shutdown=remove 时相当于&nbsp;--ephemeral</p> </td> 
     </tr>
    </tbody>
   </table>
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span style="line-height:1.5;">1.2. 几个 shortcut</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">2.1 &nbsp;--boot-volume &lt;volume_id&gt;</span></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">从 volume Boot 虚机。相当于&nbsp;--block-device&nbsp;<strong>source=volume, dest=volume</strong>, boot_index=0, shutdown=preserve。一次只能使用一个 volume。不能和&nbsp;--image and --snapshot 一起使用。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">2.2&nbsp;--snapshot &lt;snapshot_id&gt;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">从 snapshot boot 虚机。相当于&nbsp;--block-device&nbsp;<strong>source=snapshot, dest=volume</strong>, boot_index=0, shutdown=preserve。一次只能使用一个 snapshot。不能和&nbsp;--volumeand --snapshot 一起使用。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">2.3&nbsp;--swap &lt;swap size in MB&gt;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 boot 虚机的时候增加 swap 块设备。相当于&nbsp;--block-device&nbsp;<strong>source=blank, dest=local</strong>, boot_index=-1, shutdown=remove, format=swap。一次只能使用一次。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">2.4&nbsp;--ephemeral size=&lt;size in GB&gt;,format=&lt;ext3, ext4, ...&gt;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 boot 虚机的时候增加&nbsp;ephemeral 块设备。相当于&nbsp;--block-device&nbsp;<strong>source=blank, dest=local</strong>, boot_index=-1, shutdown=remove。一次可以使用多次该参数。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">比如&nbsp;--ephemeral size=&lt;size in GB&gt;,format=&lt;ext3, ext4, ...&gt;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">2.5&nbsp;--block-device-mapping &lt;dev-name=mapping&gt; 用于增加多个额外的块设备</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;">mapping 的格式是&nbsp;&lt;dev-name&gt;=&lt;id&gt;:&lt;type&gt;:&lt;size(GB)&gt;:&lt;delete-on-terminate&gt;：</span></p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">dev-name： 当 volume 被挂载后在&nbsp;/dev/dev_name 中的设备名称</li> 
    <li style="list-style-type:disc;">id： volume ID</li> 
    <li style="list-style-type:disc;">type：snap 则volume 是从 snapshot 上创建的；空白</li> 
    <li style="list-style-type:disc;">size (GB)： volume 的 size；可以留空白使得Nova自己判断</li> 
    <li style="list-style-type:disc;">delete-on-terminate： True/1 或者 False/0， 标识在 VM 被terminated 后 volume是否被删除</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">比如从 image boot VM 的同时挂载一个block volume</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">nova boot --image 4042220e-4f5e-4398-9054-39fbd75a5dd7&nbsp;--flavor 2 --key-name mykey --block-device-mapping vdc=13:::0&nbsp;boot-with-vol-test&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">&nbsp;2. 虚机的本地磁盘空间</h2> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.1 虚机本地磁盘空间大小设置</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">在 OpenStack 中， 一个虚机涉及到的存储空间， 主要是 根分区 (/ ,root分区)， swap分区， ephemeral disk， 还有就是 Block storage (块存储，OpenStack &nbsp;中的 Cinder 项目就是用于管理块存储的)。前面三种都是 ephemeral 的 (Nova 中专门定义的 ephemeral disk 指的是除了 root disk 和 swap disk之外的 ephemeral 空间)， ephemeral &nbsp;空间会随着 instance 的生命周期创建和消亡。&nbsp;</p> 
   <ul style="list-style:none;font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">
    <li style="list-style-type:disc;">root disk： 根分区，提供boot loader</li> 
    <li style="list-style-type:disc;">swap disk：交换分区。Linux 系统除了必须的 root 分区， 还是用 swap 分区是用于内存耗尽时将物理内存中一部分空间挪到 swap分区中，这样就释放了 一些物理内存空间。&nbsp;</li> 
    <li style="list-style-type:disc;">ephemeral disk：这里说的 ephemeral disk 是狭义的，指除 root 分区和 swap 分区之外， 根据提供的资源状况提供的额外的临时存储。广义的 ephemeral disk 可包括 root 分区和 swap 分区。</li> 
   </ul>
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">Nova flavor 可以定义一个虚机的各分区的大小。以下面的 tiny2 flavor 为例，其 root disk 为 1G 大小，Ephemeral disk 为 1G 大小，Swap disk 为 30M 大小。</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>s1@controller:~$ nova flavor-<span style="line-height:1.5;">list
</span>+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| ID                                   | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
+--------------------------------------+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| <span style="color:rgb(128,0,128);line-height:1.5;">1</span>                                    | m1.tiny   | <span style="color:rgb(128,0,128);line-height:1.5;">512</span>       | <span style="color:rgb(128,0,128);line-height:1.5;">1</span>    | <span style="color:rgb(128,0,128);line-height:1.5;">0</span>         |      | <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     | <span style="color:rgb(128,0,128);line-height:1.5;">1.0</span>         | True      |
| 129f237e-<span style="color:rgb(128,0,128);line-height:1.5;">8825</span>-49fa-b489-0e41fb06b70e | tiny2     | <span style="color:rgb(128,0,128);line-height:1.5;">50</span>        | <span style="color:rgb(128,0,128);line-height:1.5;">1</span>    | <span style="color:rgb(128,0,128);line-height:1.5;">1</span>         | <span style="color:rgb(128,0,128);line-height:1.5;">30</span>   | <span style="color:rgb(128,0,128);line-height:1.5;">1</span>     | <span style="color:rgb(128,0,128);line-height:1.5;">1.0</span>         | True      |</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">除了可以在 flavor 中设置各磁盘大小以外， 还使用 nova boot 命令时也可以设置 swap 和 ephemeral 分区的大小和文件系统，只是这里设置的空间大小需要比使用的 flavor 中相应值要小，也可以不设置这两项，不设置的时候会按照flavor的默认值创建， 不然 novaclient 会提示错误。</span></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;"><span style="line-height:1.5;font-size:1.17em;">2.2 虚机中的磁盘</span></h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">使用 tiny2 flavor 启动虚机后，登录到虚机，使用 “fdisk -l” 命令可以看到其磁盘的情况：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">root disk：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog2015/697113/201506/131927068011247.jpg" alt="" style="border:0px;"></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">ephemeral 和 swap disk：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><img src="https://images0.cnblogs.com/blog2015/697113/201506/131927450518161.jpg" alt="" style="border:0px;"></p> 
   <h3 style="font-size:16px;color:rgb(102,102,102);background-image:none;background-repeat:no-repeat;font-family:Verdana;line-height:1.5;">2.3 Nova compute 节点上的磁盘镜像文件</h3> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">对于 libvirt 虚机来说，当虚机是基于镜像启动的时候，虚机的每个磁盘在 nova compute 节点上都有一个磁盘镜像文件，默认是在&nbsp;/var/lib/nova/instances/&lt;instance_id&gt; 目录中：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@compute1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b# ls -<span style="line-height:1.5;">l
total </span><span style="color:rgb(128,0,128);line-height:1.5;">2476</span>
-rw-r--r-- <span style="color:rgb(128,0,128);line-height:1.5;">1</span> libvirt-qemu kvm  <span style="color:rgb(128,0,128);line-height:1.5;">2031616</span> Jun <span style="color:rgb(128,0,128);line-height:1.5;">10</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">19</span><span style="line-height:1.5;"> disk
</span>-rw-r--r-- <span style="color:rgb(128,0,128);line-height:1.5;">1</span> libvirt-qemu kvm   <span style="color:rgb(128,0,128);line-height:1.5;">393216</span> Jun <span style="color:rgb(128,0,128);line-height:1.5;">10</span> <span style="color:rgb(128,0,128);line-height:1.5;">18</span>:<span style="color:rgb(128,0,128);line-height:1.5;">12</span><span style="line-height:1.5;"> disk.local
</span>-rw-r--r-- <span style="color:rgb(128,0,128);line-height:1.5;">1</span> libvirt-qemu kvm   <span style="color:rgb(128,0,128);line-height:1.5;">197120</span> Jun <span style="color:rgb(128,0,128);line-height:1.5;">10</span> <span style="color:rgb(128,0,128);line-height:1.5;">07</span>:<span style="color:rgb(128,0,128);line-height:1.5;">42</span> disk.swap</pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">每个文件默认都是 qcow2 格式，都使用 backing 文件。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">disk 文件对应的是虚机的 root 分区：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@compute1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b# qemu-<span style="line-height:1.5;">img info disk
image: disk
file format: qcow2
</span><span style="color:rgb(0,0,255);line-height:1.5;">virtual</span> size: <span style="color:rgb(128,0,128);line-height:1.5;">1</span>.0G (<span style="color:rgb(128,0,128);line-height:1.5;">1073741824</span><span style="line-height:1.5;"> bytes) <span style="color:rgb(0,0,255);line-height:1.5;">#受 flavor 指定的大小</span>
disk size: </span><span style="color:rgb(128,0,128);line-height:1.5;">1.9M</span><span style="line-height:1.5;">
cluster_size: </span><span style="color:rgb(128,0,128);line-height:1.5;">65536</span><span style="line-height:1.5;">
backing file: </span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/_base/<span style="line-height:1.5;">fbad3d96a1727069346073e51d5bbb1824e76e34
Format specific information:
    compat: </span><span style="color:rgb(128,0,128);line-height:1.5;">1.1</span><span style="line-height:1.5;">
    lazy refcounts: </span><span style="color:rgb(0,0,255);line-height:1.5;">false</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">而其 backing file 是个 raw 类型的镜像文件：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';">
    <pre>root@compute1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b# qemu-img info /<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/_base/<span style="line-height:1.5;">fbad3d96a1727069346073e51d5bbb1824e76e34
image: </span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/_base/<span style="line-height:1.5;">fbad3d96a1727069346073e51d5bbb1824e76e34
file format: raw
</span><span style="color:rgb(0,0,255);line-height:1.5;">virtual</span> size: 39M (<span style="color:rgb(128,0,128);line-height:1.5;">41126400</span><span style="line-height:1.5;"> bytes)
disk size: 17M</span></pre>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">disk.local 是虚机的&nbsp;ephemeral 分区的镜像文件，默认的时候它同样是 qcow2 类型：</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@compute1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b# qemu-<span style="line-height:1.5;">img info disk.local
image: disk.local
file format: qcow2
</span><span style="color:rgb(0,0,255);line-height:1.5;">virtual</span> size: <span style="color:rgb(128,0,128);line-height:1.5;">1</span>.0G (<span style="color:rgb(128,0,128);line-height:1.5;">1073741824</span><span style="line-height:1.5;"> bytes)
disk size: 324K
cluster_size: </span><span style="color:rgb(128,0,128);line-height:1.5;">65536</span><span style="line-height:1.5;">
backing file: </span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/_base/<span style="line-height:1.5;">ephemeral_1_default
Format specific information:
    compat: </span><span style="color:rgb(128,0,128);line-height:1.5;">1.1</span><span style="line-height:1.5;">
    lazy refcounts: </span><span style="color:rgb(0,0,255);line-height:1.5;">false</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">disk.swap 是虚机的 swap 分区的镜像文件：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>root@compute1:/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b# qemu-<span style="line-height:1.5;">img info disk.swap
image: disk.swap
file format: qcow2
</span><span style="color:rgb(0,0,255);line-height:1.5;">virtual</span> size: 30M (<span style="color:rgb(128,0,128);line-height:1.5;">31457280</span><span style="line-height:1.5;"> bytes)
disk size: 196K
cluster_size: </span><span style="color:rgb(128,0,128);line-height:1.5;">65536</span><span style="line-height:1.5;">
backing file: </span>/<span style="color:rgb(0,0,255);line-height:1.5;">var</span>/lib/nova/instances/_base/<span style="line-height:1.5;">swap_30
Format specific information:
    compat: </span><span style="color:rgb(128,0,128);line-height:1.5;">1.1</span><span style="line-height:1.5;">
    lazy refcounts: </span><span style="color:rgb(0,0,255);line-height:1.5;">false</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">这些磁盘镜像文件是由 Nova 在启动虚机的过程中创建的。镜像文件的目录由 nova.config 的配置项 instances_path 指定，其默认值为 “/var/lib/nova/instances”；镜像文件的 backing 文件的目录由 image_cache_subdirectory_name 配置项指定，其默认值为 “ _base”&nbsp;，其主要过程可以参考&nbsp;<a href="http://www.pixelbeat.org/docs/openstack_libvirt_images/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">这篇文章</a>。</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">libvirt.xml 文件定义了磁盘的镜像文件和磁盘的对应关系：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>&lt;disk type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">file</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> device=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">disk</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
      &lt;driver name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qemu</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qcow2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> cache=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">none</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;source file=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/var/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b/disk</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;target bus=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">virtio</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> dev=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">vda</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
    &lt;/disk&gt;
    &lt;disk type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">file</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> device=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">disk</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
      &lt;driver name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qemu</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qcow2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> cache=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">none</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;source file=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/var/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b/disk.local</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;target bus=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">virtio</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> dev=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">vdb</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
    &lt;/disk&gt;
    &lt;disk type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">file</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> device=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">disk</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
      &lt;driver name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qemu</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">qcow2</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> cache=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">none</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;source file=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">/var/lib/nova/instances/eddc46a8-e026-4b2c-af51-dfaa436fcc7b/disk.swap</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
      &lt;target bus=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">virtio</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> dev=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">vdc</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>/&gt;
    &lt;/disk&gt;<span style="line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">3. Nova 虚机的&nbsp;block_device_info 数据结构</h2> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><span style="line-height:1.5;font-size:14px;">该数据结构是 Nova 中一个重要的数据结构，它的内容包括虚机的所有磁盘和被附加的所有卷。一个示例如下：</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>block_device_info =<span style="line-height:1.5;"> { 
            'root_device_name': "/dev/sda"<span style="line-height:1.5;">, <span style="color:rgb(0,0,255);line-height:1.5;">//root分区</span> 'swap'<span style="line-height:1.5;">: { // swap 分区 'device_name': "/dev/sdb"<span style="line-height:1.5;">, 'swap_size': 5<span style="line-height:1.5;">, } 'ephemerals'<span style="line-height:1.5;">: [ <span style="color:rgb(0,0,255);line-height:1.5;">//ephemerals 分区，可以有多个</span> {'num': 0<span style="line-height:1.5;">, 'virtual_name': 'eph0'<span style="line-height:1.5;">, 'device_name': "/dev/sdc"<span style="line-height:1.5;">, 'size': 5<span style="line-height:1.5;"> }, {'num': 1<span style="line-height:1.5;">, 'virtual_name': 'eph1'<span style="line-height:1.5;">, 'device_name': "/dev/sdd"<span style="line-height:1.5;">, 'size': 5<span style="line-height:1.5;"> }, {'num': 2<span style="line-height:1.5;">, 'virtual_name': 'eph2'<span style="line-height:1.5;">, 'device_name': "/dev/sde"<span style="line-height:1.5;">, 'size': 5<span style="line-height:1.5;"> }, ... ], 'block_device_mapping'<span style="line-height:1.5;">: [ <span style="color:rgb(0,0,255);line-height:1.5;">//block devices mapping，可以有多个</span> {'cinfo'<span style="line-height:1.5;">: {....some cinder volume data....}, 'mount_device': "/dev/sdf"<span style="line-height:1.5;">, 'delete_on_termination'<span style="line-height:1.5;">: True }, {'cinfo'<span style="line-height:1.5;">: {....some cinder volume data....}, 'mount_device': "/dev/sdg"<span style="line-height:1.5;">, 'delete_on_termination'<span style="line-height:1.5;">: True }, {'cinfo'<span style="line-height:1.5;">: {....some cinder volume data....}, 'mount_device': "/dev/sdh"<span style="line-height:1.5;">, 'delete_on_termination'<span style="line-height:1.5;">: True }, ... ], } </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;block_device_mapping 的信息是由 Nova 在数据库中维护的，数据表是&nbsp;block_device_mapping，它维护着一个虚机曾经有过但是现在被删除的和现有的卷信息：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <p style="line-height:1.5;">MariaDB [nova]&gt; select * from block_device_mapping where instance_uuid='02699155-940f-4401-bc01-36220db80639';<br><br> | created_at | updated_at | deleted_at | id | device_name | delete_on_termination | snapshot_id | volume_id | volume_size | no_device | connection_info | instance_uuid | deleted | source_type | destination_type | guest_format | device_type | disk_bus | boot_index | image_id |<br> +---------------------+---------------------+---------------------+----+-------------+-----------------------+-------------+---------------------------<br> | 2015-06-10 02:01:56 | 2015-06-10 02:44:31 | NULL | 46 | /dev/vda | 0 | NULL | 26446902-5a56-4c79-b839-a8e13a66dc7a | NULL | NULL | {"driver_volume_type": "iscsi", "serial": "26446902-5a56-4c79-b839-a8e13a66dc7a", "data": {"device_path": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-26446902-5a56-4c79-b839-a8e13a66dc7a-lun-1", "host_device": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-26446902-5a56-4c79-b839-a8e13a66dc7a-lun-1", "target_discovered": false, "encrypted": false, "qos_specs": null, "target_iqn": "iqn.2010-10.org.openstack:volume-26446902-5a56-4c79-b839-a8e13a66dc7a", "target_portal": "10.0.2.41:3260", "volume_id": "26446902-5a56-4c79-b839-a8e13a66dc7a", "auth_password": "Yeb2Sjit2ESPvkKV7YSs", "target_lun": 1, "access_mode": "rw", "auth_username": "HhADUkXT858xD3AEBhzv", "auth_method": "CHAP"}} | 02699155-940f-4401-bc01-36220db80639 | 0 | volume | volume | NULL | disk | virtio | 0 | NULL |<br> | 2015-06-10 02:27:06 | NULL | 2015-06-10 02:27:14 | 47 | /dev/vdd | 0 | NULL | 31367039-0da5-4dac-bf9a-40303b869126 | NULL | NULL | NULL | 02699155-940f-4401-bc01-36220db80639 | 47 | volume | volume | NULL | NULL | NULL | NULL | NULL |<br> | 2015-06-10 02:28:59 | NULL | 2015-06-10 02:29:08 | 48 | /dev/vdd | 0 | NULL | 31367039-0da5-4dac-bf9a-40303b869126 | NULL | NULL | NULL | 02699155-940f-4401-bc01-36220db80639 | 48 | volume | volume | NULL | NULL | NULL | NULL | NULL |<br> | 2015-06-10 02:30:07 | 2015-06-10 02:44:32 | 2015-06-10 03:58:26 | 49 | /dev/vdd | 0 | NULL | 31367039-0da5-4dac-bf9a-40303b869126 | NULL | NULL | {"driver_volume_type": "iscsi", "serial": "31367039-0da5-4dac-bf9a-40303b869126", "data": {"device_path": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-31367039-0da5-4dac-bf9a-40303b869126-lun-1", "host_device": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-31367039-0da5-4dac-bf9a-40303b869126-lun-1", "target_discovered": false, "encrypted": false, "qos_specs": null, "target_iqn": "iqn.2010-10.org.openstack:volume-31367039-0da5-4dac-bf9a-40303b869126", "target_portal": "10.0.2.41:3260", "volume_id": "31367039-0da5-4dac-bf9a-40303b869126", "auth_password": "2bUgBWHDTr8HyPBSX7wr", "target_lun": 1, "access_mode": "rw", "auth_username": "FaoWrhsw6CFThDtcUvSf", "auth_method": "CHAP"}} | 02699155-940f-4401-bc01-36220db80639 | 49 | volume | volume | NULL | NULL | NULL | NULL | NULL |<br> | 2015-06-10 05:51:50 | 2015-06-10 05:51:55 | NULL | 52 | /dev/vdd | 0 | NULL | de127d46-ed92-471d-b18b-e89953c305fd | NULL | NULL | {"driver_volume_type": "iscsi", "serial": "de127d46-ed92-471d-b18b-e89953c305fd", "data": {"access_mode": "rw", "host_device": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-de127d46-ed92-471d-b18b-e89953c305fd-lun-1", "target_discovered": false, "encrypted": false, "qos_specs": null, "target_iqn": "iqn.2010-10.org.openstack:volume-de127d46-ed92-471d-b18b-e89953c305fd", "target_portal": "10.0.2.41:3260", "volume_id": "de127d46-ed92-471d-b18b-e89953c305fd", "target_lun": 1, "device_path": "/dev/disk/by-path/ip-10.0.2.41:3260-iscsi-iqn.2010-10.org.openstack:volume-de127d46-ed92-471d-b18b-e89953c305fd-lun-1", "auth_password": "eb6BYxF4oJYLFxDt3woc", "auth_username": "nJPF9yMdy2b9ioobRFMw", "auth_method": "CHAP"}} | 02699155-940f-4401-bc01-36220db80639 | 0 | volume | volume | NULL | NULL | NULL | NULL | NULL |<br> +---------------------+---------------------+---------------------+----+-------------+-----------------------+-------------+----------------------------+</p> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;font-size:12px;"><a title="复制代码" style="color:rgb(26,139,200);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">参考链接：</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="https://wiki.openstack.org/wiki/BlockDeviceConfig" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">https://wiki.openstack.org/wiki/BlockDeviceConfig</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><a href="http://adaishu.blog.163.com/blog/static/175831286201262811249332/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://adaishu.blog.163.com/blog/static/175831286201262811249332/</a></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;">&nbsp;</p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="line-height:1.5;"><font color="#4b4b4b"><span style="font-size:15px;">&nbsp; &nbsp; 本文转自SammyLiu博客园博客，原文链接：http://www.cnblogs.com/sammyliu/p/4462718.html</span></font><span style="font-size:15px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
   <p style="line-height:1.5;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:15px;"><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
