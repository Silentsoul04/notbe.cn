<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Spark生态之Spark Graphx介绍、实现分析和实例 « NotBeCN</title>
  <meta name="description" content="             Spark GraphX介绍         GraphX介绍             GraphX应用背景         GraphX的框架         发展历程             GraphX实现分析             存储模式                 　图...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/11/06/weixin_33772645_90134469.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Spark生态之Spark Graphx介绍、实现分析和实例</h1>
    <p class="post-meta">Nov 6, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><span>Spark GraphX介绍</span></h1> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"> <h1 style="font-size:28px;line-height:1.5;"><span>GraphX介绍</span></h1> 
     <ul>
      <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;"><span>GraphX应用背景</span></h3> </li> 
      <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;"><span>GraphX的框架</span></h3> </li> 
      <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">发展历程</h3> </li> 
     </ul></li> 
    <li style="list-style:disc;"> <h1 style="font-size:28px;line-height:1.5;"><span>GraphX实现分析</span></h1> 
     <ul>
      <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">存储模式</h3> 
       <ul>
        <li style="list-style:disc;"> <h4 style="color:rgb(51,51,51);">　图存储模式</h4> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;"><span>&nbsp;<span>GraphX存储模式</span></span></h3> </li> 
       </ul></li> 
      <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">计算模式</h3> 
       <ul>
        <li style="list-style:disc;"> <h4 style="color:rgb(51,51,51);">　图计算模式</h4> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;"><span>GraphX计算模式</span></h3> 
         <ul>
          <li style="list-style:disc;">图的缓存</li> 
          <li style="list-style:disc;"> <h4 style="color:rgb(51,51,51);">邻边聚合</h4> </li> 
          <li style="list-style:disc;"> <h4 style="color:rgb(51,51,51);">进化的<span>Pregel模式</span> </h4> </li> 
          <li style="list-style:disc;"> <h4 style="color:rgb(51,51,51);">图算法工具包</h4> </li> 
         </ul></li> 
       </ul></li> 
     </ul></li> 
    <li style="list-style:disc;"> <h1 style="font-size:28px;line-height:1.5;"><span>GraphX实例</span></h1> 
     <ul>
      <li style="list-style:disc;"> <h2 style="font-size:21px;line-height:1.5;">图例演示</h2> 
       <ul>
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">例子介绍</h3> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">程序代码</h3> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">运行结果</h3> </li> 
       </ul></li> 
      <li style="list-style:disc;"> <h2 style="font-size:21px;line-height:1.5;"><span>PageRank&nbsp;演示</span></h2> 
       <ul>
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">例子介绍</h3> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;"><span>测试数据</span></h3> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">程序代码</h3> </li> 
        <li style="list-style:disc;"> <h3 style="font-size:16px;line-height:1.5;">运行结果</h3> </li> 
       </ul></li> 
     </ul></li> 
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">1、GraphX介绍</h1> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">1.1&nbsp;GraphX应用背景</h2> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　Spark GraphX是一个分布式图处理框架，它是基于Spark平台提供对图计算和图挖掘简洁易用的而丰富的接口，极大的方便了对分布式图处理的需求。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　众所周知·，社交网络中人与人之间有很多关系链，例如Twitter、Facebook、微博和微信等，这些都是大数据产生的地方都需要图计算，现在的图处理基本都是分布式的图处理，而并非单机处理。Spark GraphX由于底层是基于Spark来处理的，所以天然就是一个分布式的图处理系统。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">图的分布式或者并行处理其实是把图拆分成很多的子图，然后分别对这些子图进行计算，计算的时候可以分别迭代进行分阶段的计算，即对图进行并行计算。下面我们看一下图计算的简单示例：　　</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429202737506-1005231754.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　从图中我们可以看出：拿到<span>Wikipedia的文档以后，可以变成<span>Link Table形式的视图，然后基于<span>Link Table形式的视图可以分析成<span>Hyperlinks超链接，最后我们可以使用<span>PageRank去分析得出<span>Top Communities。在下面路径中的<span>Editor Graph到<span>Community，这个过程可以称之为<span>Triangle Computation，这是计算三角形的一个算法，基于此会发现一个社区。从上面的分析中我们可以发现图计算有很多的做法和算法，同时也发现图和表格可以做互相的转换。</span></span></span></span></span></span></span></span></span></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">1.2&nbsp;&nbsp;GraphX的框架</h2> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　设计GraphX时，点分割和GAS都已成熟，在设计和编码中针对它们进行了优化，并在功能和性能之间寻找最佳的平衡点。如同Spark本身，每个子模块都有一个核心抽象。GraphX的核心抽象是Resilient Distributed Property Graph，一种点和边都带属性的有向多重图。它扩展了Spark RDD的抽象，有Table和Graph两种视图，而只需要一份物理存储。两种视图都有自己独有的操作符，从而获得了灵活操作和执行效率。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429202809912-450662875.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　如同<span>Spark，<span>GraphX的代码非常简洁。<span>GraphX的核心代码只有<span>3千多行，而在此之上实现的<span>Pregel模式，只要短短的<span>20多行。<span>GraphX的代码结构整体下图所示，其中大部分的实现，都是围绕<span>Partition的优化进行的。这在某种程度上说明了点分割的存储和相应的计算优化，的确是图计算框架的重点和难点。</span></span></span></span></span></span></span></span></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">1.3&nbsp;发展历程</h2> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;">早在0.5版本，Spark就带了一个小型的Bagel模块，提供了类似Pregel的功能。当然，这个版本还非常原始，性能和功能都比较弱，属于实验型产品。</li> 
    <li style="list-style:disc;">到0.8版本时，鉴于业界对分布式图计算的需求日益见涨，Spark开始独立一个分支Graphx-Branch，作为独立的图计算模块，借鉴GraphLab，开始设计开发GraphX。</li> 
    <li style="list-style:disc;">在0.9版本中，这个模块被正式集成到主干，虽然是Alpha版本，但已可以试用，小面包圈Bagel告别舞台。1.0版本，GraphX正式投入生产使用。</li> 
   </ul>
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429202855475-570244783.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　值得注意的是，<span>GraphX目前依然处于快速发展中，从<span>0.8的分支到<span>0.9和<span>1.0，每个版本代码都有不少的改进和重构。根据观察，在没有改任何代码逻辑和运行环境，只是升级版本、切换接口和重新编译的情况下，每个版本有<span>10%~20%的性能提升。虽然和<span>GraphLab的性能还有一定差距，但凭借<span>Spark整体上的一体化流水线处理，社区热烈的活跃度及快速改进速度，<span>GraphX具有强大的竞争力。</span></span></span></span></span></span></span></span></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2、GraphX实现分析</h1> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　如同Spark本身，每个子模块都有一个核心抽象。GraphX的核心抽象是Resilient Distributed Property Graph，一种点和边都带属性的有向多重图。它扩展了Spark RDD的抽象，有Table和Graph两种视图，而只需要一份物理存储。两种视图都有自己独有的操作符，从而获得了灵活操作和执行效率。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429202918069-892290199.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">GraphX的底层设计有以下几个关键点。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　对Graph视图的所有操作，最终都会转换成其关联的Table视图的RDD操作来完成。这样对一个图的计算，最终在逻辑上，等价于一系列RDD的转换过程。因此，Graph最终具备了RDD的3个关键特性：Immutable、Distributed和Fault-Tolerant，其中最关键的是Immutable（不变性）。逻辑上，所有图的转换和操作都产生了一个新图；物理上，GraphX会有一定程度的不变顶点和边的复用优化，对用户透明。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　两种视图底层共用的物理数据，由RDD[Vertex-Partition]和RDD[EdgePartition]这两个RDD组成。点和边实际都不是以表Collection[tuple]的形式存储的，而是由VertexPartition/EdgePartition在内部存储一个带索引结构的分片数据块，以加速不同视图下的遍历速度。不变的索引结构在RDD转换过程中是共用的，降低了计算和存储开销。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429202935709-817757812.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　&nbsp;图的分布式存储采用点分割模式，而且使用<span>partitionBy方法，由用户指定不同的划分策略（<span>PartitionStrategy）。划分策略会将边分配到各个<span>EdgePartition，顶点<span>Master分配到各个<span>VertexPartition，<span>EdgePartition也会缓存本地边关联点的<span>Ghost副本。划分策略的不同会影响到所需要缓存的<span>Ghost副本数量，以及每个<span>EdgePartition分配的边的均衡程度，需要根据图的结构特征选取最佳策略。目前有<span>EdgePartition2d、<span>EdgePartition1d、<span>RandomVertexCut和<span>CanonicalRandomVertexCut这四种策略。</span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.1&nbsp;存储模式</h2> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.1.1&nbsp;图存储模式</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　巨型图的存储总体上有边分割和点分割两种存储方式。2013年，GraphLab2.0将其存储方式由边分割变为点分割，在性能上取得重大提升，目前基本上被业界广泛接受并使用。</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"> <strong>边分割（Edge-Cut）</strong>：每个顶点都存储一次，但有的边会被打断分到两台机器上。这样做的好处是节省存储空间；坏处是对图进行基于边的计算时，对于一条两个顶点被分到不同机器上的边来说，要跨机器通信传输数据，内网通信流量大。</li> 
    <li style="list-style:disc;"> <strong>点分割（Vertex-Cut）</strong>：每条边只存储一次，都只会出现在一台机器上。邻居多的点会被复制到多台机器上，增加了存储开销，同时会引发数据同步问题。好处是可以大幅减少内网通信量。</li> 
   </ul>
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203011834-542833461.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　虽然两种方法互有利弊，但现在是点分割占上风，各种分布式图计算框架都将自己底层的存储形式变成了点分割。主要原因有以下两个。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　1.磁盘价格下降，存储空间不再是问题，而内网的通信资源没有突破性进展，集群计算时内网带宽是宝贵的，时间比磁盘更珍贵。这点就类似于常见的空间换时间的策略。　　</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　2.在当前的应用场景中，绝大多数网络都是“无尺度网络”，遵循幂律分布，不同点的邻居数量相差非常悬殊。而边分割会使那些多邻居的点所相连的边大多数被分到不同的机器上，这样的数据分布会使得内网带宽更加捉襟见肘，于是边分割存储方式被渐渐抛弃了。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.1.2&nbsp;GraphX存储模式</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　Graphx借鉴PowerGraph，使用的是Vertex-Cut(点分割)方式存储图，用三个RDD存储图数据信息：</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"> <strong>VertexTable(id, data)</strong>：id为Vertex id，data为Edge data</li> 
    <li style="list-style:disc;"> <strong>EdgeTable(pid, src, dst, data)</strong>：pid为Partion id，src为原定点id，dst为目的顶点id</li> 
    <li style="list-style:disc;"> <strong>RoutingTable(id, pid)</strong>：id为Vertex id，pid为Partion id</li> 
   </ul>
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">点分割存储实现如下图所示：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203054834-1695730425.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.2&nbsp;计算模式</h2> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">　　2.2.1&nbsp;图计算模式</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　目前基于图的并行计算框架已经有很多，比如来自Google的Pregel、来自Apache开源的图计算框架Giraph/HAMA以及最为著名的GraphLab，其中Pregel、HAMA和Giraph都是非常类似的，都是基于BSP（Bulk Synchronous Parallell）模式。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　Bulk Synchronous Parallell，即整体同步并行，它将计算分成一系列的超步（superstep）的迭代（iteration）。从纵向上看，它是一个串行模式，而从横向上看，它是一个并行的模式，每两个superstep之间设置一个栅栏（barrier），即整体同步点，确定所有并行的计算都完成后再启动下一轮superstep。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　　　　　　　&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203111459-830173590.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　每一个超步（superstep）包含三部分内容：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　1.<strong>计算compute</strong>：每一个processor利用上一个superstep传过来的消息和本地的数据进行本地计算；</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　2.<strong>消息传递</strong>：每一个processor计算完毕后，将消息传递个与之关联的其它processors</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　3.<strong>整体同步点</strong>：用于整体同步，确定所有的计算和消息传递都进行完毕后，进入下一个superstep。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">2.2.2GraphX计算模式</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　如同Spark一样，GraphX的Graph类提供了丰富的图运算符，大致结构如下图所示。可以在官方<a href="http://spark.apache.org/docs/latest/graphx-programming-guide.html" rel="nofollow" style="color:#000000;">GraphX Programming Guide</a>中找到每个函数的详细说明，本文仅讲述几个需要注意的方法。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203141990-813424628.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">2.2.2.1&nbsp;图的缓存</h4> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　每个图是由3个RDD组成，所以会占用更多的内存。相应图的cache、unpersist和checkpoint，更需要注意使用技巧。出于最大限度复用边的理念，GraphX的默认接口只提供了unpersistVertices方法。如果要释放边，调用g.edges.unpersist()方法才行，这给用户带来了一定的不便，但为GraphX的优化提供了便利和空间。参考GraphX的Pregel代码，对一个大图，目前最佳的实践是：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203159397-1626404007.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　大体之意是根据<span>GraphX中<span>Graph的不变性，对<span>g做操作并赋回给<span>g之后，<span>g已不是原来的<span>g了，而且会在下一轮迭代使用，所以必须<span>cache。另外，必须先用<span>prevG保留住对原来图的引用，并在新图产生后，快速将旧图彻底释放掉。否则，十几轮迭代后，会有内存泄漏问题，很快耗光作业缓存空间。</span></span></span></span></span></span></span></span></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">2.2.2.2&nbsp;邻边聚合</h4> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　mrTriplets（mapReduceTriplets）是GraphX中最核心的一个接口。Pregel也基于它而来，所以对它的优化能很大程度上影响整个GraphX的性能。mrTriplets运算符的简化定义是：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203227006-2091335657.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　它的计算过程为：map，应用于每一个Triplet上，生成一个或者多个消息，消息以Triplet关联的两个顶点中的任意一个或两个为目标顶点；reduce，应用于每一个Vertex上，将发送给每一个顶点的消息合并起来。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　mrTriplets最后返回的是一个VertexRDD[A]，包含每一个顶点聚合之后的消息（类型为A），没有接收到消息的顶点不会包含在返回的VertexRDD中。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在最近的版本中，GraphX针对它进行了一些优化，对于Pregel以及所有上层算法工具包的性能都有重大影响。主要包括以下几点。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　1.&nbsp;<strong>Caching for Iterative mrTriplets &amp; Incremental Updates for Iterative mrTriplets</strong>：在很多图分析算法中，不同点的收敛速度变化很大。在迭代后期，只有很少的点会有更新。因此，对于没有更新的点，下一次mrTriplets计算时EdgeRDD无需更新相应点值的本地缓存，大幅降低了通信开销。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　2.<strong>Indexing Active Edges</strong>：没有更新的顶点在下一轮迭代时不需要向邻居重新发送消息。因此，mrTriplets遍历边时，如果一条边的邻居点值在上一轮迭代时没有更新，则直接跳过，避免了大量无用的计算和通信。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　3.<strong>Join Elimination</strong>：Triplet是由一条边和其两个邻居点组成的三元组，操作Triplet的map函数常常只需访问其两个邻居点值中的一个。例如，在PageRank计算中，一个点值的更新只与其源顶点的值有关，而与其所指向的目的顶点的值无关。那么在mrTriplets计算中，就不需要VertexRDD和EdgeRDD的3-way join，而只需要2-way join。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　所有这些优化使GraphX的性能逐渐逼近GraphLab。虽然还有一定差距，但一体化的流水线服务和丰富的编程接口，可以弥补性能的微小差距。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">2.2.2.3&nbsp;进化的Pregel模式</h4> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　GraphX中的Pregel接口，并不严格遵循Pregel模式，它是一个参考GAS改进的Pregel模式。定义如下：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203315834-1155531499.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　这种基于mrTrilets方法的Pregel模式，与标准Pregel的最大区别是，它的第2段参数体接收的是3个函数参数，而不接收messageList。它不会在单个顶点上进行消息遍历，而是将顶点的多个Ghost副本收到的消息聚合后，发送给Master副本，再使用vprog函数来更新点值。消息的接收和发送都被自动并行化处理，无需担心超级节点的问题。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　常见的代码模板如下所示：</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203346553-1978077457.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　可以看到，<span>GraphX设计这个模式的用意。它综合了<span>Pregel和<span>GAS两者的优点，即接口相对简单，又保证性能，可以应对点分割的图存储模式，胜任符合幂律分布的自然图的大型计算。另外，值得注意的是，官方的<span>Pregel版本是最简单的一个版本。对于复杂的业务场景，根据这个版本扩展一个定制的<span>Pregel是很常见的做法。</span></span></span></span></span></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">2.2.2.4&nbsp;图算法工具包</h4> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　GraphX也提供了一套图算法工具包，方便用户对图进行分析。目前最新版本已支持PageRank、数三角形、最大连通图和最短路径等6种经典的图算法。这些算法的代码实现，目的和重点在于通用性。如果要获得最佳性能，可以参考其实现进行修改和扩展满足业务需求。另外，研读这些代码，也是理解GraphX编程最佳实践的好方法。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h1 style="font-size:28px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">3、GraphX实例</h1> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">3.1&nbsp;&nbsp;图例演示</h2> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">　　3.1.1&nbsp;例子介绍</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　下图中有6个人，每个人有名字和年龄，这些人根据社会关系形成8条边，每条边有其属性。在以下例子演示中将构建顶点、边和图，打印图的属性、转换操作、结构操作、连接操作、聚合操作，并结合实际要求进行演示。</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　&nbsp;<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203423319-830817926.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><span>3.1.2&nbsp;程序代码</span></h3> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="font-size:12px;line-height:1.5;">import org.apache.log4j.{Level, Logger}
import org.apache.spark.{SparkContext, SparkConf}
import org.apache.spark.graphx._
import org.apache.spark.rdd.RDD
 
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">object</span><span style="font-size:12px;line-height:1.5;"> GraphXExample {
  def main(args: Array[String]) {
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">屏蔽日志</span>
    Logger.getLogger(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">org.apache.spark</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">).setLevel(Level.WARN)
    Logger.getLogger(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">org.eclipse.jetty.server</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">).setLevel(Level.OFF)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设置运行环境</span>
    val conf = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkConf().setAppName(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">SimpleGraphX</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>).setMaster(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">local</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val sc </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> SparkContext(conf)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设置顶点和边，注意顶点和边都是用元组定义的Array
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">顶点的数据类型是VD:(String,Int)</span>
    val vertexArray =<span style="font-size:12px;line-height:1.5;"> Array(
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">Alice</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">28</span><span style="font-size:12px;line-height:1.5;">)),
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">Bob</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">27</span><span style="font-size:12px;line-height:1.5;">)),
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">Charlie</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">65</span><span style="font-size:12px;line-height:1.5;">)),
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">David</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">42</span><span style="font-size:12px;line-height:1.5;">)),
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">Ed</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">55</span><span style="font-size:12px;line-height:1.5;">)),
      (</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6L</span>, (<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">Fran</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">50</span><span style="font-size:12px;line-height:1.5;">))
    )
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">边的数据类型ED:Int</span>
    val edgeArray =<span style="font-size:12px;line-height:1.5;"> Array(
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">7</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8</span><span style="font-size:12px;line-height:1.5;">),
      Edge(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6L</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span><span style="font-size:12px;line-height:1.5;">)
    )
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">构造vertexRDD和edgeRDD</span>
    val vertexRDD: RDD[(Long, (String, Int))] =<span style="font-size:12px;line-height:1.5;"> sc.parallelize(vertexArray)
    val edgeRDD: RDD[Edge[Int]] </span>=<span style="font-size:12px;line-height:1.5;"> sc.parallelize(edgeArray)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">构造图Graph[VD,ED]</span>
    val graph: Graph[(String, Int), Int] =<span style="font-size:12px;line-height:1.5;"> Graph(vertexRDD, edgeRDD)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  图的属性    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************         println("***********************************************")</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">属性演示</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">找出图中年龄大于30的顶点：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    graph.vertices.filter { </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, (name, age)) =&gt; age &gt; <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">30</span>}.collect.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span><span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, (name, age)) =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">$name is $age</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    }
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">边操作：找出图中属性大于5的边</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">找出图中属性大于5的边：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
graph.edges.filter(e </span>=&gt; e.attr &gt; <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span>).collect.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(e =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${e.srcId} to ${e.dstId} att ${e.attr}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">triplets操作，((srcId, srcAttr), (dstId, dstAttr), attr)</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">列出边属性&gt;5的tripltes：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">for</span> (triplet &lt;- graph.triplets.filter(t =&gt; t.attr &gt; <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span><span style="font-size:12px;line-height:1.5;">).collect) {
      println(s</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${triplet.srcAttr._1} likes ${triplet.dstAttr._1}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    }
    println
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">Degrees操作</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">找出图中最大的出度、入度、度数：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    def max(a: (VertexId, Int), b: (VertexId, Int)): (VertexId, Int) </span>=<span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (a._2 &gt; b._2) a <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> b
    }
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">max of outDegrees:</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> + graph.outDegrees.reduce(max) + <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;"> max of inDegrees:</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> + graph.inDegrees.reduce(max) + <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;"> max of Degrees:</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> +<span style="font-size:12px;line-height:1.5;"> graph.degrees.reduce(max))
    println
   
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  转换操作    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************  </span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">转换操作</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">顶点的转换操作，顶点age + 10：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    graph.mapVertices{ </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, (name, age)) =&gt; (id, (name, age+<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">10</span>))}.vertices.collect.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(v =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${v._2._1} is ${v._2._2}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">边的转换操作，边的属性*2：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    graph.mapEdges(e</span>=&gt;e.attr*<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>).edges.collect.<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(e =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${e.srcId} to ${e.dstId} att ${e.attr}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
  
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  结构操作    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************  </span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">结构操作</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">顶点年纪&gt;30的子图：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val subGraph </span>= graph.subgraph(vpred = (id, vd) =&gt; vd._2 &gt;= <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">30</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">子图所有顶点：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    subGraph.vertices.collect.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(v =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${v._2._1} is ${v._2._2}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">子图所有边：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    subGraph.edges.collect.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(e =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${e.srcId} to ${e.dstId} att ${e.attr}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
 
   
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  连接操作    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************  </span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">连接操作</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val inDegrees: VertexRDD[Int] </span>=<span style="font-size:12px;line-height:1.5;"> graph.inDegrees
    </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">class</span><span style="font-size:12px;line-height:1.5;"> User(name: String, age: Int, inDeg: Int, outDeg: Int)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">创建一个新图，顶点VD的数据类型为User，并从graph做类型转换</span>
    val initialUserGraph: Graph[User, Int] = graph.mapVertices { <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, (name, age)) =&gt; User(name, age, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)}
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">initialUserGraph与inDegrees、outDegrees（RDD）进行连接，并修改initialUserGraph中inDeg值、outDeg值</span>
    val userGraph =<span style="font-size:12px;line-height:1.5;"> initialUserGraph.outerJoinVertices(initialUserGraph.inDegrees) {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, u, inDegOpt) =&gt; User(u.name, u.age, inDegOpt.getOrElse(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">), u.outDeg)
    }.outerJoinVertices(initialUserGraph.outDegrees) {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, u, outDegOpt) =&gt; User(u.name, u.age, u.inDeg,outDegOpt.getOrElse(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">))
    }
 
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">连接图的属性：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
userGraph.vertices.collect.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(v =&gt; println(s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${v._2.name} inDeg: ${v._2.inDeg}  outDeg: ${v._2.outDeg}</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
    println
 
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">出度和入读相同的人员：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    userGraph.vertices.filter {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, u) =&gt; u.inDeg ==<span style="font-size:12px;line-height:1.5;"> u.outDeg
    }.collect.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span><span style="font-size:12px;line-height:1.5;"> {
      </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, property) =&gt;<span style="font-size:12px;line-height:1.5;"> println(property.name)
    }
    println
 
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  聚合操作    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************  </span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">聚合操作</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">找出年纪最大的追求者：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val oldestFollower: VertexRDD[(String, Int)] </span>=<span style="font-size:12px;line-height:1.5;"> userGraph.mapReduceTriplets[(String, Int)](
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 将源顶点的属性发送给目标顶点，map过程</span>
      edge =&gt;<span style="font-size:12px;line-height:1.5;"> Iterator((edge.dstId, (edge.srcAttr.name, edge.srcAttr.age))),
      </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 得到最大追求者，reduce过程</span>
      (a, b) =&gt; <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (a._2 &gt; b._2) a <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> b
    )
 
    userGraph.vertices.leftJoin(oldestFollower) { (id, user, optOldestFollower) </span>=&gt;<span style="font-size:12px;line-height:1.5;">
      optOldestFollower match {
        </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> None =&gt; s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${user.name} does not have any followers.</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> Some((name, age)) =&gt; s<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">${name} is the oldest follower of ${user.name}.</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">
      }
    }.collect.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span> { <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">case</span> (id, str) =&gt;<span style="font-size:12px;line-height:1.5;"> println(str)}
    println
 
     </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***********************************************************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">***************************  实用操作    ****************************************
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">**********************************************************************************</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">聚合操作</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">找出5到各顶点的最短：</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val sourceId: VertexId </span>= <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5L</span> <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 定义源点</span>
    val initialGraph = graph.mapVertices((id, _) =&gt; <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (id == sourceId) <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0.0</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> Double.PositiveInfinity)
    val sssp </span>=<span style="font-size:12px;line-height:1.5;"> initialGraph.pregel(Double.PositiveInfinity)(
      (id, dist, newDist) </span>=&gt;<span style="font-size:12px;line-height:1.5;"> math.min(dist, newDist),
      triplet </span>=&gt; {  <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 计算权重</span>
        <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">if</span> (triplet.srcAttr + triplet.attr &lt;<span style="font-size:12px;line-height:1.5;"> triplet.dstAttr) {
          Iterator((triplet.dstId, triplet.srcAttr </span>+<span style="font-size:12px;line-height:1.5;"> triplet.attr))
        } </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">else</span><span style="font-size:12px;line-height:1.5;"> {
          Iterator.empty
        }
      },
      (a,b) </span>=&gt; math.min(a,b) <span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;"> 最短距离</span>
<span style="font-size:12px;line-height:1.5;">    )
    println(sssp.vertices.collect.mkString(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\n</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">))
 
    sc.stop()
  }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">　　3.1.3&nbsp;运行结果</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在IDEA中首先对GraphXExample.scala代码进行编译，编译通过后进行执行，执行结果如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>**********************************************************<span style="font-size:12px;line-height:1.5;">
属性演示
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
找出图中年龄大于30的顶点：
David </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">42</span><span style="font-size:12px;line-height:1.5;">
Fran </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">50</span><span style="font-size:12px;line-height:1.5;">
Charlie </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">65</span><span style="font-size:12px;line-height:1.5;">
Ed </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">55</span><span style="font-size:12px;line-height:1.5;">
找出图中属性大于5的边：
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">7</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8</span><span style="font-size:12px;line-height:1.5;">
 
列出边属性</span>&gt;<span style="font-size:12px;line-height:1.5;">5的tripltes：
Bob likes Alice
Ed likes Charlie
 
找出图中最大的出度、入度、度数：
max of outDegrees:(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span>) max of inDegrees:(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>) max of Degrees:(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span><span style="font-size:12px;line-height:1.5;">)
 
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
转换操作
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
顶点的转换操作，顶点age </span>+ <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">10</span><span style="font-size:12px;line-height:1.5;">：
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (David,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">52</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (Alice,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">38</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (Fran,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">60</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (Charlie,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">75</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (Ed,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">65</span><span style="font-size:12px;line-height:1.5;">)
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> (Bob,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">37</span><span style="font-size:12px;line-height:1.5;">)
 
边的转换操作，边的属性</span>*<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span><span style="font-size:12px;line-height:1.5;">：
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">14</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">16</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span>
 
**********************************************************<span style="font-size:12px;line-height:1.5;">
结构操作
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
顶点年纪</span>&gt;<span style="font-size:12px;line-height:1.5;">30的子图：
子图所有顶点：
David </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">42</span><span style="font-size:12px;line-height:1.5;">
Fran </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">50</span><span style="font-size:12px;line-height:1.5;">
Charlie </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">65</span><span style="font-size:12px;line-height:1.5;">
Ed </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span> <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">55</span><span style="font-size:12px;line-height:1.5;">
 
子图所有边：
</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8</span>
<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span> to <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span> att <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span>
 
**********************************************************<span style="font-size:12px;line-height:1.5;">
连接操作
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
连接图的属性：
David inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span><span style="font-size:12px;line-height:1.5;">
Alice inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">
Fran inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">
Charlie inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span><span style="font-size:12px;line-height:1.5;">
Ed inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span><span style="font-size:12px;line-height:1.5;">
Bob inDeg: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>  outDeg: <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span><span style="font-size:12px;line-height:1.5;">
 
出度和入读相同的人员：
David
Bob
 
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
聚合操作
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
找出年纪最大的追求者：
Bob </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span><span style="font-size:12px;line-height:1.5;"> the oldest follower of David.
David </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span><span style="font-size:12px;line-height:1.5;"> the oldest follower of Alice.
Charlie </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span><span style="font-size:12px;line-height:1.5;"> the oldest follower of Fran.
Ed </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span><span style="font-size:12px;line-height:1.5;"> the oldest follower of Charlie.
Ed does not have any followers.
Charlie </span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">is</span><span style="font-size:12px;line-height:1.5;"> the oldest follower of Bob.
 
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
实用操作
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
找出5到各顶点的最短：
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">4.0</span><span style="font-size:12px;line-height:1.5;">)
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5.0</span><span style="font-size:12px;line-height:1.5;">)
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">6</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3.0</span><span style="font-size:12px;line-height:1.5;">)
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">3</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8.0</span><span style="font-size:12px;line-height:1.5;">)
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0.0</span><span style="font-size:12px;line-height:1.5;">)
(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2</span>,<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">2.0</span>)</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203536209-1986646367.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h2 style="font-size:21px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">3.2&nbsp;PageRank&nbsp;演示</h2> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">　　3.2.1&nbsp;例子介绍</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">PageRank,&nbsp;即网页排名，又称网页级别、Google&nbsp;左侧排名或佩奇排名。它是Google&nbsp;创始人拉里· 佩奇和谢尔盖· 布林于1997&nbsp;年构建早期的搜索系统原型时提出的链接分析算法。目前很多重要的链接分析算法都是在PageRank&nbsp;算法基础上衍生出来的。PageRank&nbsp;是Google&nbsp;用于用来标识网页的等级/&nbsp;重要性的一种方法，是Google&nbsp;用来衡量一个网站的好坏的唯一标准。在揉合了诸如Title&nbsp;标识和Keywords&nbsp;标识等所有其它因素之后，Google&nbsp;通过PageRank&nbsp;来调整结果，使那些更具“等级/&nbsp;重要性”的网页在搜索结果中令网站排名获得提升，从而提高搜索结果的相关性和质量。　　</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203554912-2013306150.png" alt="" style="border:0px;"></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">　　3.2.2&nbsp;测试数据</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在这里测试数据为顶点数据graphx-wiki-vertices.txt和边数据graphx-wiki-edges.txt，可以在本系列附带资源/data/class9/目录中找到这两个数据文件，其中格式为：</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;">顶点为顶点编号和网页标题</li>
   </ul>
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203621272-126840575.png" alt="" style="border:0px;"></p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span>边数据由两个顶点构成</span></li>
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span>　　　　　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203642162-457976036.png" alt="" style="border:0px;"></span></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;"><span>3.2.3&nbsp;程序代码</span></h3> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="font-size:12px;line-height:1.5;">import org.apache.log4j.{Level, Logger}
import org.apache.spark.{SparkContext, SparkConf}
import org.apache.spark.graphx._
import org.apache.spark.rdd.RDD
 
</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">object</span><span style="font-size:12px;line-height:1.5;"> PageRank {
  def main(args: Array[String]) {
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">屏蔽日志</span>
    Logger.getLogger(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">org.apache.spark</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">).setLevel(Level.WARN)
    Logger.getLogger(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">org.eclipse.jetty.server</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">).setLevel(Level.OFF)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">设置运行环境</span>
    val conf = <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span> SparkConf().setAppName(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">PageRank</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span>).setMaster(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">local</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val sc </span>= <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">new</span><span style="font-size:12px;line-height:1.5;"> SparkContext(conf)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">读入数据文件</span>
    val articles: RDD[String] = sc.textFile(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/home/hadoop/IdeaProjects/data/graphx/graphx-wiki-vertices.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val links: RDD[String] </span>= sc.textFile(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">/home/hadoop/IdeaProjects/data/graphx/graphx-wiki-edges.txt</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">装载顶点和边</span>
    val vertices = articles.map { line =&gt;<span style="font-size:12px;line-height:1.5;">
      val fields </span>= line.split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">'</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">'</span><span style="font-size:12px;line-height:1.5;">)
      (fields(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>).toLong, fields(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span><span style="font-size:12px;line-height:1.5;">))
    }
 
    val edges </span>= links.map { line =&gt;<span style="font-size:12px;line-height:1.5;">
      val fields </span>= line.split(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">'</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">\t</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">'</span><span style="font-size:12px;line-height:1.5;">)
      Edge(fields(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span>).toLong, fields(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1</span>).toLong, <span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
    }
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">cache操作
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">val graph = Graph(vertices, edges, "").persist(StorageLevel.MEMORY_ONLY_SER)</span>
    val graph = Graph(vertices, edges, <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">""</span><span style="font-size:12px;line-height:1.5;">).persist()
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">graph.unpersistVertices(false)
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">测试</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">获取5个triplet信息</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    graph.triplets.take(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">5</span>).<span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span><span style="font-size:12px;line-height:1.5;">(println(_))
 
    </span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">//</span><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">pageRank算法里面的时候使用了cache()，故前面persist的时候只能使用MEMORY_ONLY</span>
    println(<span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">PageRank计算，获取最有价值的数据</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    println(</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">**********************************************************</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="font-size:12px;line-height:1.5;">)
    val prGraph </span>= graph.pageRank(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0.001</span><span style="font-size:12px;line-height:1.5;">).cache()
 
    val titleAndPrGraph </span>=<span style="font-size:12px;line-height:1.5;"> graph.outerJoinVertices(prGraph.vertices) {
      (v, title, rank) </span>=&gt; (rank.getOrElse(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0.0</span><span style="font-size:12px;line-height:1.5;">), title)
    }
 
    titleAndPrGraph.vertices.top(</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">10</span><span style="font-size:12px;line-height:1.5;">) {
      Ordering.by((entry: (VertexId, (Double, String))) </span>=&gt;<span style="font-size:12px;line-height:1.5;"> entry._2._1)
    }.</span><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">foreach</span>(t =&gt; println(t._2._2 + <span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">: </span><span style="color:rgb(128,0,0);font-size:12px;line-height:1.5;">"</span> +<span style="font-size:12px;line-height:1.5;"> t._2._1))
 
    sc.stop()
  }
}</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, Arial, Helvetica, sans-serif;">3.2.4&nbsp;运行结果</h3> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　在IDEA中首先对PageRank.scala代码进行编译，编译通过后进行执行，执行结果如下：</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>**********************************************************<span style="font-size:12px;line-height:1.5;">
获取5个triplet信息
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
((</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">146271392968588</span>,Computer Consoles Inc.),(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">7097126743572404313</span>,Berkeley Software Distribution),<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
((</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">146271392968588</span>,Computer Consoles Inc.),(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8830299306937918434</span>,University of California, Berkeley),<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
((</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">625290464179456</span>,List of Penguin Classics),(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1735121673437871410</span>,George Berkeley),<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
((</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1342848262636510</span>,List of college swimming and diving teams),(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8830299306937918434</span>,University of California, Berkeley),<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
((</span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1889887370673623</span>,Anthony Pawson),(<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">8830299306937918434</span>,University of California, Berkeley),<span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">0</span><span style="font-size:12px;line-height:1.5;">)
 
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
PageRank计算，获取最有价值的数据
</span>**********************************************************<span style="font-size:12px;line-height:1.5;">
University of California, Berkeley: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">1321.111754312097</span><span style="font-size:12px;line-height:1.5;">
Berkeley, California: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">664.8841977233583</span><span style="font-size:12px;line-height:1.5;">
Uc berkeley: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">162.50132743397873</span><span style="font-size:12px;line-height:1.5;">
Berkeley Software Distribution: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">90.4786038848606</span><span style="font-size:12px;line-height:1.5;">
Lawrence Berkeley National Laboratory: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">81.90404939641944</span><span style="font-size:12px;line-height:1.5;">
George Berkeley: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">81.85226118457985</span><span style="font-size:12px;line-height:1.5;">
Busby Berkeley: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">47.871998218019655</span><span style="font-size:12px;line-height:1.5;">
Berkeley Hills: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">44.76406979519754</span><span style="font-size:12px;line-height:1.5;">
Xander Berkeley: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">30.324075347288037</span><span style="font-size:12px;line-height:1.5;">
Berkeley County, South Carolina: </span><span style="color:rgb(128,0,128);font-size:12px;line-height:1.5;">28.908336483710308</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　　　　　　　<img src="https://images2015.cnblogs.com/blog/855959/201704/855959-20170429203737584-2057806152.png" alt="" style="border:0px;"></p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p align="justify" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p align="justify"><font><span style="font-size:14px;">本文转自大数据躺过的坑博客园博客，原文链接：http://www.cnblogs.com/zlslch/p/5728630.html，如需转载请自行联系原作者</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
