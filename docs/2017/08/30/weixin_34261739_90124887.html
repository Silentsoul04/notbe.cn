<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Eclipse 插件开发 -- 深入理解菜单（Menu）功能及其扩展点( FROM IBM) « NotBeCN</title>
  <meta name="description" content="             Eclipse 插件开发 -- 深入理解菜单（Menu）功能及其扩展点    菜单是各种软件及开发平台会提供的必备功能，Eclipse 也不例外，提供了丰富的菜单，包括主菜单（Main Menu），视图 / 编辑器菜单（ViewPart/Editor Menu）和上下文菜单（Contex...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/08/30/weixin_34261739_90124887.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Eclipse 插件开发 -- 深入理解菜单（Menu）功能及其扩展点( FROM IBM)</h1>
    <p class="post-meta">Aug 30, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">Eclipse 插件开发 -- 深入理解菜单（Menu）功能及其扩展点</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">菜单是各种软件及开发平台会提供的必备功能，Eclipse 也不例外，提供了丰富的菜单，包括主菜单（Main Menu），视图 / 编辑器菜单（ViewPart/Editor Menu）和上下文菜单（Context Menu）。在 Eclipse 中，几乎所有的 Workbench Part 提供了人性化的菜单，大大方便了用户的操作。因此，如何扩展 Eclipse 的菜单功能，并实现特定于我们自己插件的菜单，是插件开发者必须掌握的重要技能，同时，Eclipse 提供了丰富的扩展点供开发人员使用。本文将首先介绍 Eclipse 中的菜单，然后详细说明如何进行扩展，最后以一个实例的形式引导读者深入理解 Eclipse 的菜单功能。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">1<img alt="" src="http://dw1.s81c.com/developerworks/i/v17/dw-cmts-arrow.png" width="7" height="7" style="border:0px;">&nbsp;<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#icomments" rel="nofollow" style="color:rgb(0,0,0);">评论：</a></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#authorN1001B" rel="nofollow" style="color:rgb(0,0,0);">敖 建旺</a>, 软件工程师, EMC</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">2010 年 4 月 08 日</p> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">
    <li style="list-style:disc;"> <a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#toggle" rel="nofollow" style="color:rgb(0,0,0);"><img alt="+" src="http://www.ibm.com/i/c.gif" style="border:0px;"></a>内容</li>
   </ul>
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><a></a></p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">引言</h4> 
   <a style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"></a>
   <span style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"></span> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">Eclipse 具有丰富的菜单功能，给开发人员提供了很好的用户体验。总体而言，Eclipse 菜单种类包括视图 / 编辑器菜单，主菜单（Main Menu），视图 / 编辑器菜单（ViewPart/EditorPart Menu）和上下文菜单（Context Menu）。插件开发人员通过灵活应用这些菜单，可以给用户提供很好的体验。由于视图和编辑器菜单功能类似，因此本文重点讲述视图菜单（视图下拉菜单及其工具栏菜单），除此之外，还将讲述主菜单和上下文菜单。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如图 1 所示为 Project Explorer 视图的菜单，包括视图下拉菜单和工具栏菜单（折叠树节点）。通常而言，出现在视图工具栏的菜单都会出现在视图的下拉菜单，也就是说，比较常用的视图菜单放在视图的工具栏。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">图 1. Project Explorer 视图的菜单</h6> 
   <img alt="图 1. Project Explorer 视图的菜单" src="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/image001.jpg" width="469" style="border:0px;font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">
   <span style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"></span> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如图 2 所示为 Project Explorer 视图中的上下文菜单，只有当我们右键点击时才会出现。通常而言，出现频率较高的菜单项才会出现在菜单中。上下文菜单具有很强的灵活项，它可以随着我们点击的对象不同，弹出的菜单也会有相应的变化。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">图 2. Project Explorer 视图中的上下文菜单</h6> 
   <img alt="图 2. Project Explorer 视图中的上下文菜单" src="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/image002.jpg" width="349" style="border:0px;font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">
   <span style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"></span> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如图 3 所示为 Eclipse 的主菜单，包括最上面的主菜单项（不可移动）及其下面的工具栏菜单（可以移动，并且 Eclipse 提供了显示 / 不显示这些菜单的功能），Eclipse 并不建议我们为每一个插件都添加新的主菜单，这样容易造成冗余，而且不方便用户操作。通常，我们可以把菜单项添加到 Eclipse 已有的菜单，如插件的查找功能可以添加一个查找菜单项到 Eclipse 的 Search 主菜单上。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">图 3. Eclipse 的主菜单</h6> 
   <img alt="图 3. Eclipse 的主菜单" src="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/image003.jpg" width="363" style="border:0px;font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">
   <span style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"></span> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">前面讲到 Eclipse 的各种菜单，那么，如何在开发插件或 RCP 应用程序的时候添加这些菜单？本文下面的篇幅将详细介绍如何扩展 Eclipse 的菜单功能，使读者深入了解 Eclipse 的菜单功能，并能够开发具有这些菜单的应用程序。因此，必须掌握三方面的内容：菜单种类，菜单的扩展点，菜单控制（显示 / 隐藏或启用 / 禁用菜单项）。下面从概念上介绍这三方面内容，下一小节将会进行详细介绍。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>菜单种类</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">正如前面所讲到的，Eclipse 的菜单包括视图菜单，主菜单及上下文菜单三个种类。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>菜单项的扩展点</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">Eclipse 提供了两种扩展点供用户添加菜单项到相应的位置。这两种扩展点为 org.eclipse.ui.commands（本文简称为 Commands 方式）和 org.eclipse.ui.actionSets（本文简称为 Actions 方式）。Actions 方式为界面上不同区域的表现方式提供了相应的扩展点，并且没有分离其界面表现和内在实现。恰恰相反，Commands 方式通过三步有效的达到界面表现和内部实现的分离：首先，通过 org.eclipse.ui.commands 扩展点创建命令和类别（Category），并且可以把某些命令放在一个类别（Category）中；然后，通过 org.eclipse.ui.menus 指定命令出现在界面的哪个区域（视图菜单 / 主菜单 / 上下文菜单）；最后通过 org.eclipse.ui.handlers 指定命令的实现。因此，Eclipse 推荐新开发的插件使用 Commands 来创建您的界面菜单。当然，由于 Actions 在现有的插件中用得比较多，如果我们需要扩展或基于之前的插件开发，也需要对其进行了解。除此之外，针对上下文菜单，虽然 Commands 和 Actions 方式均可以创建上下文菜单，但是 Eclipse 还提供了另外一种创建上下文菜单的扩展点 org.eclipse.ui.popupMenus（本文简称为 popupMenus 方式），本文将就这三种扩展点做详细的介绍。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>菜单控制</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">菜单控制是一个非常常见的功能，例如，随着选定的内容或当前窗口的不同，菜单中的菜单项会有相应的变化（显示 / 隐藏或启用 / 禁用菜单项），因此，如何控制菜单是插件开发人员必须掌握的知识。Eclipse 为菜单控制提供了两种方法，一种是通过扩展点；另一种是通过 API 的方式编写程序控制。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#ibm-pcon" rel="nofollow" style="color:rgb(0,0,0);">回页首</a></p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">Eclipse 菜单功能及其扩展点</h4> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">至此，我们对 Eclipse 菜单有了感观的认识。由上一节我们可知，要深入理解 Eclipse 菜单功能，我们需要从三个方面去掌握：菜单种类，菜单的扩展点和菜单控制。下面将进行详细讲述。</p> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">菜单种类</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">针对各种菜单，Eclipse 提供了相应的扩展点，因此，开发人员可以通过这些扩展点把菜单放到界面的不同区域，详细内容请参考 2.2 小节。</p> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">菜单的扩展点</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>视图菜单的扩展点</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">采用 Commands 方式创建视图菜单，需要引入 org.eclipse.ui.menus 扩展点；而 Actions 方式需要引入 org.eclipse.ui.actionSets.</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">1、视图菜单（Commands 方式）：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">MenuContribution locationURI = “[Scheme]:[id]?[argument-list]”</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">其中，Scheme 为该菜单项出现的区域，menu 为视图的下拉菜单，toolbar 为视图的工具栏菜单；id 为菜单区域 ID；argument-list 为该菜单项出现在指定菜单的位置。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如：在 ProbelmView 的下拉菜单加一个菜单项，其 MenuContribution 的 locationURI 应为：menu:org.eclipse.ui.views.ProblemView?after=additions；在 ProblemView 的工具栏菜单中加入一个菜单项，其 locationURI 应为：toolbar:org.eclipse.ui.views.ProblemView?after=additions。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">2、视图菜单（Actions 方式）：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">采用 Actions 方式创建菜单，需要引入 org.eclipse.ui.actionSets 扩展点，并通过设定 action 的 menubarPath 指定下拉菜单 / 菜单项出现的位置；通过设定 action 的 toolbarPath 设定工具栏菜单 / 菜单项出现的位置。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如，添加一个下拉菜单项到 Problems 视图中，其 menubarPath 应为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">org.eclipse.ui.views.ProblemView/additions</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>主菜单的扩展点</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">1、主菜单（Commands 方式）</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 Commands 方式把菜单项添加到主菜单及其工具栏上，和视图菜单一样，也是通过扩展点 org.eclipse.ui.menus 实现，需要设定其 menuContribution 的 locationURI。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如，添加一个菜单（菜单可以包含若干个菜单项）到主菜单一栏中，其 locationURI 为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">menu:org.eclipse.ui.main.menu?after=additions</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">添加一个菜单到工具栏之中，其 locationURI 为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">toolbar:org.eclipse.ui.main.toolbar?after=additions</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">当然，我们也可以把菜单项添加到已经存在的菜单当中，例如添加一个菜单项到 Eclipse 的 Search 主菜单当中，其 locationURI 为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">menu:org.eclipse.search.menu?dialogGroup</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">2、主菜单（Actions 方式）</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 Actions 方式把菜单项添加到主菜单及其工具栏上，和视图菜单一样，也是通过扩展点 org.eclipse.ui.actionSets 实现，需要设定 action 的 menubarPath 和 toolbarPath 实现。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如，添加一个菜单项到 Eclipse 的 Search 主菜单中，其 menubarPath 应为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">org.eclipse.search.menu/dialogGroup</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">注意：如果采用上述方式添加一个菜单项到 Search 主菜单，当我们运行时并没有出现添加的菜单项，这时候需要换一个 workspace，其原因是 Eclipse 缓存了与其相关的某些信息在 workspace 当中。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>上下文菜单的扩展点</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">上下文菜单除了通过 Commands 和 Actions 方式添加，还可以使用扩展点 org.eclipse.ui.popupMenus 方式添加，下面分别进行介绍。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">1、上下文菜单（Commands 方式）</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">Commands 方式与添加视图菜单和主菜单的方式一样，通过设定其 menuContribution 的 locationURI 来实现。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如，添加一个上下文菜单到 Problems 视图中，其 locationURI 为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">popup:org.eclipse.ui.views.ProblemView?after=additions。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如果我们想让某个上下文菜单项出现在任何区域，则可以使用下面的 locationURI：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">popup:org.eclipse.ui.popup.any?after=additions</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">2、上下文菜单（Actions 方式）</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">Actions 方式没有直接提供扩展点添加上下文菜单，但是我们可以通过编程的方式实现，如下代码清单 1 为 TreeViewer 添加上下文菜单，通过 IMenuManager 的 add 方法添加 actions。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 1. 通过 Actions 方式编程实现添加上下文菜单</h6> 
   <pre> private void hookContextMenu() { 
    IMenuManager fMenuMgr = new MenuManager(“#PopupMenu”); 
    fMenuMgr.setRemoveAllWhenShown(true); 
    // 添加 Actions 
    fMenuMgr.add(action … ) 
    fMenuMgr.createContextMenu(treeViewer.getControl()); 
    treeViewer.getControl().setMenu(fMenu); 
    getSite().registerContextMenu(fMenuMgr, treeViewer); 
 }</pre> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">3、上下文菜单（popupMenus 方式）</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 popupMenus 扩展点实现上下文菜单，需要设定 objectContribution 的 objectClass 属性把上下文菜单添加到相应的区域。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">例如，如果我们想当用户点击 Eclipse 中的资源时，弹出的上下文菜单包括某个菜单项，我们可以设定 objectClass 属性为：</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">org.eclipse.core.resources.IResource</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>通过 Commands 方式创建菜单项</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 Commands 方式创建菜单项，首先需要创建 Command，通过扩展点 org.eclipse.ui.commands，然后我们可以把这个 Command 放到任何区域，上一小节已经讲到，通过 org.eclipse.ui.menus 扩展点确定菜单创建的区域，最后通过扩展点 org.eclipse.ui.handlers 定义这个 command 的具体行为。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">在创建 Command 时，我们可以先创建一个 Category，并把相关的一些命令放到这个 Category 中，这样有利于管理。代码清单 2 创建一个 Command(“Show in Glossary Explorer”)，并放到一个 Category 中，然后把该 Command 放到 BGSearchResultView 视图的上下文菜单中，最后通过扩展 org.eclipse.ui.handlers 定义该 Command 的实现类。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 2. 通过 Commands 方式添加菜单项</h6> 
   <pre> &lt;!-- 添加 command --&gt; 
 &lt;extension 
      point="org.eclipse.ui.commands"&gt; 
   &lt;category 
      description="Business Glossary"
      id="com.ibm.bg.ui.commands.category"
      name="%category.BusinessGlossary.name"&gt; 
   &lt;/category&gt; 
   &lt;command 
      categoryId="com.ibm.bg.ui.commands.category"
      description="Show in Glossary Explorer"
      id="com.ibm.bg.ui.commands.BGShowInBrowser"
      name="%command.ShowInGE.name"&gt; 
    &lt;/command&gt; 
 &lt;/extension&gt; 
 &lt;!-- 把 Command 放到界面的对应区域 --&gt; 
 &lt;extension 
       point="org.eclipse.ui.menus"&gt; 
   &lt;menuContribution locationURI= 
   "popup:com.ibm.bg.internal.ui.search.BGSearchResultView?after=additions"&gt; 
      &lt;command 
            commandId="com.ibm.bg.ui.commands.BGShowInBrowser"
            style="push"
            tooltip="%command.ShowInGE.tooltip"&gt; 
      &lt;/command&gt; 
   &lt;/menuContribution&gt; 
 &lt;/extension&gt; 
 &lt;!-- 定义 command 的实现类 --&gt; 
 &lt;extension 
      point="org.eclipse.ui.handlers"&gt; 
   &lt;handler 
         class="com.ibm.bg.internal.ui.handlers.BGShowInBrowser"
         commandId="com.ibm.bg.ui.commands.BGShowInBrowser"&gt; 
   &lt;/handler&gt; 
 &lt;/extension&gt;</pre> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>通过 Actions 方式创建菜单项</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">正如前面讲到，Actions 方式没有分离界面的表现和内部实现，因此，所有这些均通过 action 来完成。如下代码清单 3 为添加一个 Search 菜单项到 Eclipse 的 Search 主菜单（通过 action 的 menubarPath 指定）中，其中 class 对应的值为该 Action 的实现类，该类需要实现接口 IWorkbenchWindowActionDelegate。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 3. 通过 Actions 方式添加菜单项</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.actionSets"&gt; 
   &lt;actionSet 
         id="com.ibm.bg.ui.workbenchActionSet"
         label="%category.name.0"
         visible="true"&gt; 
      &lt;action 
            class="com.ibm.bg.internal.ui.handlers.BGSearchHandler"
            definitionId="com.ibm.bg.ui.commands.BGSearch"
            icon="icons/search.png"
            id="com.ibm.bg.ui.commands.BGSearch"
            label="%action.searchGlossayInMainMenu.label"
            menubarPath="org.eclipse.search.menu/dialogGroup"
            style="push"&gt; 
      &lt;/action&gt; 
   &lt;/actionSet&gt; 
 &lt;/extension&gt;</pre> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><strong>通过 popupMenus 方式创建菜单项</strong></p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">popupMenus 方式创建上下文菜单项也是通过 action 来实现，下面例子为添加一个菜单项到用户右击 IGraphicalEditPart 对象时弹出的上下文菜单，通过 menubarPath 指定该 Action 出现的区域，通过 class 指定该 action 的实现类，该类需要实现接口 IObjectActionDelegate。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 4. 通过 popupMenus 方式添加菜单项</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.popupMenus"&gt; 
   &lt;objectContribution 
         adaptable="false"
         id="com.ibm.bg.uml.objectContributions.BGAssignToGlossary"
         objectClass="org.eclipse.gmf.runtime.diagram.ui.editparts.IGraphicalEditPart"&gt; 
      &lt;action 
            class="com.ibm.bg.internal.uml.actions.BGAssignToGlossary"
            enablesFor="+"
            icon="icons/assign.png"
            id="com.ibm.bg.internal.uml.actions.BGAssignToGlossary"
            label="%BGAssignToGlossary.item"
            menubarPath="com.ibm.bg.uml.popupMenuGroup"&gt; 
      &lt;/action&gt; 
   &lt;/objectContribution&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">菜单控制</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">视图菜单的控制主要包括启用 / 禁用，显示 / 隐藏菜单。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 Command 方式创建的菜单，可以通过 org.eclipse.ui.commands 的 visibleWhen 属性控制菜单的隐藏和显示，通过 org.eclipse.ui.handlers 的 activewhen 或 enabledWhen 控制菜单的启用或禁用。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 Actions 方式创建的菜单，可以通过 action 的 enablement 属性控制菜单的启用 / 禁用。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">通过 popupMenus 方式创建的菜单，可以通过 objectContribution 的 visibility 和 enablement 来设置该 objectContribution 下的 action 的显示 / 隐藏和启用 / 禁用，我们也可以设置 action 的 enablement 来控制该菜单的启用 / 禁用。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">这里不详细讲述 enablement，visibleWhen 和 enabledWhen 的参数及如何设置，读者可以参考第三节的例子和本文的参考文献。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#ibm-pcon" rel="nofollow" style="color:rgb(0,0,0);">回页首</a></p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">编程实践</h4> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">本文将结合前两节讲到的知识，以例子的形式说明如何创建并且控制菜单。首先创建一个视图（Menu Example），然后分别通过 Commands，Actions 和 popupMenus 方式创建若干个菜单，并添加相应的菜单控制点。</p> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">创建 Menu Example 视图</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">扩展 org.eclipse.views 创建“Menu Example”视图，如下代码清单 5 为创建视图的 xml 代码。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 5. 扩展 org.eclipse.ui.views 创建视图</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.views"&gt; 
   &lt;category 
         id="com.free.menu.category"
         name="Menu Example View"&gt; 
   &lt;/category&gt; 
   &lt;view 
         category="com.free.menu.category"
         class="com.free.menu.view.MenuExplorer"
         id="com.free.menu.view.MenuExplorer"
         name="Menu Explorer"
         restorable="true"&gt; 
   &lt;/view&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">创建 Commands</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">采用 Command 方式创建“Menu Example”主菜单（包含 AngryCommand 和 JokeCommand 两个菜单项），并且基于这两个菜单项创建了 Menu Example 视图的下拉菜单和工具栏菜单，及其 TreeViewer 的上下文菜单。</p> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 6 为扩展 org.eclipse.ui.commands 创建 Menu Example 命令和类别，并且包含两个命令：Joke Command 和 Angry Command。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 6. 扩展 org.eclipse.ui.commands 创建命令</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.commands"&gt; 
   &lt;category 
         id="com.free.menu.category"
         name="Menu Example"&gt; 
   &lt;/category&gt; 
   &lt;command 
         categoryId="com.free.menu.category"
         id="com.free.menu.commands.jokeCommand"
         name="Joke Command"&gt; 
   &lt;/command&gt; 
   &lt;command 
         categoryId="com.free.menu.category"
         id="com.free.menu.commands.angryCommand"
         name="Angry Command"&gt; 
   &lt;/command&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">关联 Commands 到主菜单</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 7 为扩展 org.eclipse.ui.menus，并基于前面创建的 Comands，添加一个主菜单 Menu Example，并且包含 Joke Command 和 Angry Command 菜单项。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 7. 创建 Menu Example 主菜单</h6> 
   <pre> &lt;menuContribution 
      locationURI="menu:org.eclipse.ui.main.menu?after=additions"&gt; 
   &lt;menu 
     id="com.free.menu.MenuExample"
          label="Menu Example"&gt; 
      &lt;command 
            commandId="com.free.menu.commands.jokeCommand"
            style="push"&gt; 
      &lt;/command&gt; 
      &lt;command 
            commandId="com.free.menu.commands.angryCommand"
            style="push"&gt; 
      &lt;/command&gt; 
   &lt;/menu&gt; 
 &lt;/menuContribution&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">关联 Commands 到视图菜单</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 8 为扩展 org.eclipse.ui.menus，并基于 Commands 方式创建 Menu Example 视图的下拉菜单，工具栏菜单和上下文菜单，通过 locationURI 来设定。Joke Command 即为下拉菜单也是工具栏菜单，只有当我们选择了 TreeViewer 中的节点时该菜单项才是可见的，参考下面的 visibleWhen-&gt;with-&gt;iterate-&gt;or-&gt;instanceof。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 8. 通过 Commands 方式创建视图菜单</h6> 
   <pre> &lt;extension 
       point="org.eclipse.ui.menus"&gt; 
    &lt;menuContribution 
          locationURI="menu:com.free.menu.view.MenuExplorer?after=additions"&gt; 
       &lt;command 
             commandId="com.free.menu.commands.jokeCommand"
             icon="icons/searchres.gif"
             style="push"&gt; 
             &lt;visibleWhen 
                   checkEnabled="false"&gt; 
                &lt;with 
                     variable="selection"&gt; 
                   &lt;iterate 
                        ifEmpty="true"
                        operator="or"&gt; 
                    &lt;or&gt; 
                        &lt;instanceof 
                                value="com.free.menu.model.Person"&gt; 
                        &lt;/instanceof&gt;                                             
                    &lt;/or&gt; 
                  &lt;/iterate&gt; 
                  &lt;/with&gt; 
               &lt;/visibleWhen&gt;                 
         &lt;/command&gt; 
      &lt;/menuContribution&gt; 
      &lt;menuContribution 
            locationURI="toolbar:com.free.menu.view.MenuExplorer?after=additions"&gt; 
         &lt;command 
               commandId="com.free.menu.commands.jokeCommand"
               icon="icons/searchres.gif"
               style="push"&gt; 
               &lt;visibleWhen 
                     checkEnabled="false"&gt; 
                  &lt;with 
                        variable="selection"&gt; 
                     &lt;iterate 
                           ifEmpty="true"
                           operator="or"&gt; 
                        &lt;or&gt; 
                              &lt;instanceof 
                                    value="com.free.menu.model.Person"&gt; 
                              &lt;/instanceof&gt;                                             
                        &lt;/or&gt; 
                     &lt;/iterate&gt; 
                  &lt;/with&gt; 
               &lt;/visibleWhen&gt;  
         &lt;/command&gt; 
      &lt;/menuContribution&gt; 
      &lt;menuContribution 
            locationURI="popup:com.free.menu.view.MenuExplorer?after=additions"&gt; 
         &lt;command 
               commandId="com.free.menu.commands.jokeCommand"
               icon="icons/searchres.gif"
               style="push"&gt; 
         &lt;/command&gt; 
         &lt;command 
               commandId="com.free.menu.commands.angryCommand"
               style="push"&gt; 
         &lt;/command&gt;      
      &lt;/menuContribution&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">Commands 的实现类</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 9 所示扩展 org.eclipse.ui.handlers 为 Joke Command 和 Angry Command 创建事件处理类，其中 Joke Command 通过 enabledWhen 属性控制该菜单项是否启用，当我们同时选择了两个对象时 Joke Command 处于启用状态，否则为禁用。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 9. 扩展 org.eclipse.ui.handlers 为 Commands 创建实现类</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.handlers"&gt; 
   &lt;handler 
         class="com.free.menu.actions.JokeCommand"
         commandId="com.free.menu.commands.jokeCommand"&gt; 
      &lt;enabledWhen&gt; 
         &lt;count 
               value="2"&gt; 
         &lt;/count&gt; 
      &lt;/enabledWhen&gt; 
   &lt;/handler&gt; 
   &lt;handler 
         class="com.free.menu.actions.AngryCommand"
         commandId="com.free.menu.commands.angryCommand"&gt; 
   &lt;/handler&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">创建 Action 并关联到 Eclipse 的 Search 主菜单</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">采用 Actions 方式在 Eclipse 的主菜单 Search 中添加创建菜单项 SmileAction。扩展 org.eclipse.ui.actionSets 在 Eclipse 的主菜单 Search 中添加一个菜单项 Smile Action。如下代码清单 10 所示创建该 action 并添加到 search 主菜单，只有当我们选择至少一个对象时（设置 enablesFor 属性为“+”），该菜单项才处于启用状态。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 10. 通过 Actions 方式创建菜单项</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.actionSets"&gt; 
   &lt;actionSet 
         id="com.free.menu.actionSet.MenuExample"
         label="Menu Example"
         visible="true"&gt; 
      &lt;action 
            class="com.free.menu.actions.SmileAction"
            enablesFor="+"
            icon="icons/searchres.gif"
            id="com.free.menu.actions.smileAction"
            label="Smile Action"
            menubarPath="org.eclipse.search.menu/dialogGroup"
            style="push"&gt; 
      &lt;/action&gt; 
   &lt;/actionSet&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">pupupMenus 方式创建 Action 并关联到 IResource 资源的上下文菜单</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">扩展 org.eclipse.ui.popupMenus 创建菜单“Menu Example”，该菜单包含一个菜单项 HelloAction。当我们在 Eclipse 任何区域右击 org.eclipse.core.resources.IResource 资源时弹出的上下文菜单中会出现“Menu Example”菜单。如下代码清单 11 为创建该上下文菜单的 xml 代码。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 11. popupMenus 方式创建上下文菜单</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.popupMenus"&gt; 
   &lt;objectContribution 
         adaptable="true"
         id="com.free.menu.popupMenu"
         objectClass="org.eclipse.core.resources.IResource"&gt; 
      &lt;menu 
            label="Menu Example"
            path="additions"
            id="com.free.menu.popupSubMenu"&gt; 
         &lt;separator 
               name="additions"&gt; 
         &lt;/separator&gt; 
      &lt;/menu&gt; 
      &lt;action 
            label="Hello Action"
            class="com.free.menu.popup.actions.HelloAction"
            menubarPath="com.free.menu.popupSubMenu/additions"
            enablesFor="1"
            id="com.free.menu.newAction"&gt; 
      &lt;/action&gt; 
   &lt;/objectContribution&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">pupupMenus 方式创建 Action 并关联到 IResource 资源的上下文菜单</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">扩展 org.eclipse.ui.popupMenus 创建菜单项 GreetAction 和 CryAction，当我们右击 Menu Example 视图中的 TreeViewer 节点时弹出。如下代码清单 12 所示扩展 org.eclipse.ui.popupMenus 为 Menu Example 视图创建 GreetAction 和 CryAction 上下文菜单项。使用 visiblity 的 objectState 属性控制菜单项的可见状态，使用该属性要求其选择的对象实现了 org.eclipse.ui.IActionFilter 接口，具体可参见 Person 类的实现。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 12. 扩展 org.eclipse.ui.popupMenus 创建菜单</h6> 
   <pre> &lt;extension 
      point="org.eclipse.ui.popupMenus"&gt; 
   &lt;objectContribution 
         adaptable="false"
         id="com.free.menu.views.popupMenu"
         objectClass="com.free.menu.model.Person"&gt; 
      &lt;action 
            class="com.free.menu.actions.GreetAction"
            enablesFor="+"
            id="com.free.menu.actions.greetAction"
            label="Greet Action"
            menubarPath="additions"&gt; 
      &lt;/action&gt; 
      &lt;visibility&gt; 
         &lt;objectState 
               name="firstName"
               value="Dan"&gt; 
         &lt;/objectState&gt; 
      &lt;/visibility&gt; 
   &lt;/objectContribution&gt; 
 &lt;/extension&gt; 
 &lt;extension 
      point="org.eclipse.ui.popupMenus"&gt; 
   &lt;objectContribution 
         adaptable="false"
         id="com.free.menu.views.popupMenu2"
         objectClass="com.free.menu.model.Person"&gt; 
      &lt;action 
            class="com.free.menu.actions.CryAction"
            enablesFor="+"
            id="com.free.menu.actions.cryAction"
            label="Cry Action"
            menubarPath="additions"&gt; 
         &lt;enablement&gt; 
            &lt;objectState 
                  name="firstName"
                  value="David"&gt; 
            &lt;/objectState&gt; 
         &lt;/enablement&gt; 
      &lt;/action&gt; 
      &lt;visibility&gt; 
         &lt;objectState 
               name="lastName"
               value="Rubel"&gt; 
        &lt;/objectState&gt; 
      &lt;/visibility&gt; 
   &lt;/objectContribution&gt; 
 &lt;/extension&gt;</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">Menu Example 视图的代码实现类</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 13 所示为 Menu Example 视图的代码，该视图中有一个 TreeViewer，并通过函数 hookContextMenu 把上下文菜单关联到 TreeViewer。其中函数 viewMenuAction 用于更新菜单的状态，它首先获取视图菜单，然后调用 IMenuManager 的 update 方法更新对应菜单项的状态，从而达到控制菜单的目的。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 13. Menu Example 视图代码</h6> 
   <pre> public class MenuExplorer extends ViewPart { 
    private TreeViewer treeViewer; 
    private MenuManager fMenuMgr; 
    private Menu fMenu; 
    private static MenuExplorer fInstance = null; 
    public MenuExplorer() { 
        fInstance = this; 
    } 
    public static MenuExplorer getInstance(){ 
        return fInstance; 
    } 
    public void createPartControl(Composite parent) { 
        treeViewer = new TreeViewer (parent, SWT.MULTI); 
        treeViewer.setLabelProvider(new PersonListLabelProvider()); 
        treeViewer.setContentProvider(new PersonTreeContentProvider()); 
        treeViewer.setInput(Person.example()); 
        this.getSite().setSelectionProvider(treeViewer); 
        hookContextMenu(); 
        fInstance = this; 
        
    } 
    public void setViewMenuActionState(boolean state){        
        JokeCommand.setState(state); 
        viewMenuAction(); 
    } 
    private  void viewMenuAction() { 
        IActionBars bars= getViewSite().getActionBars(); 
        final IMenuManager menu= bars.getMenuManager();    
        
        UIOperation.asyncExecCommand(new Runnable(){ 
            public void run() { 
                menu.update("com.free.menu.commands.jokeAction"); 
            }            
        });        
    } 
    private void hookContextMenu() { 
        fMenuMgr = new MenuManager("#PopupMenu"); 
        fMenuMgr.setRemoveAllWhenShown(true); 
        fMenuMgr.addMenuListener(new IMenuListener() { 
            public void menuAboutToShow(IMenuManager manager) {                
            } 
        }); 
        fMenu = fMenuMgr.createContextMenu(treeViewer.getControl()); 

        treeViewer.getControl().setMenu(fMenu); 
        getSite().registerContextMenu(fMenuMgr, treeViewer);              
    }    
    public void setFocus() { 
        treeViewer.getTree().setFocus(); 

    } 
 }</pre> 
   <h5 style="font-size:12px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">Person 类的实现</h5> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 14 为 Person 类的实现，用于表示 MenuExample 视图中 TreeViewer 的一个节点，它实现了 IActionFilter 接口，通过 testAttribute 来确定是否显示 / 隐藏菜单（其中 target 表示用户选择的对象，name/value 对应于 plugin.xml 文件中 objectState 的 name/value）.</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 14. Person 类实现</h6> 
   <pre> public class Person implements IActionFilter { 

    private String firstName = "John"; 
    private String lastName = "Doe"; 
    protected int age = 37; 
    public Person[] children = new Person[0]; 
    public Person parent = null; 
    public Person(String firstName, String lastName, int age) { 
        this.firstName = firstName; 
        this.lastName = lastName; 
        this.age = age; 
    } 
    public Person(String firstName, String lastName, int age, Person[] children) { 
        this(firstName, lastName, age); 
        this.children = children; 
        for (int i = 0; i &lt; children.length; i++) { 
            children[i].parent = this; 
        } 
    } 
    public String getFirstName() { 
        return this.firstName; 
    } 
    public String getLastName() { 
        return this.lastName; 
    } 
    public static Person[] example() { 
        return new Person[] { 
                new Person("Dan", "Rubel", 38, new Person[] { 
                        new Person("Beth", "Rubel", 8), 
                        new Person("David", "Rubel", 3) }), 
                new Person("Eric", "Clayberg", 39, new Person[] { 
                        new Person("Lauren", "Clayberg", 6), 
                        new Person("Lee", "Clayberg", 4) }), 
                new Person("Mike", "Taylor", 52) }; 
    } 
    public String toString() { 
        return firstName + " " + lastName; 
    } 
    public boolean testAttribute(Object target, String name, String value) { 

        if (target instanceof Person) { 
            Person person = (Person) target; 
            if (name.equals("firstName") &amp;&amp; value.equals(person.getFirstName())) { 
                return true; 
            } 

            if (name.equals("lastName") &amp;&amp; value.equals(person.getLastName())) { 
                return true; 
            } 
        } 
        return false; 
    } 
 }</pre> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;"><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-menuext/index.html#ibm-pcon" rel="nofollow" style="color:rgb(0,0,0);">回页首</a></p> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">总结</h4> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">至此为止，已经把 Eclipse 菜单功能及其扩展点涉及到的类 / 接口 /API 进行了详细的说明，相信读者已经有清晰的认识了。对于前面提到 popupMenus 方式创建上下文菜单，要求选择的对象实现 IActionFilter 接口，但是，如果开发人员正在使用 gmf 进行开发，那么我们可以不必要求选择的对象实现 IActionFilter，我们可以通过扩展 org.eclipse.gmf.runtime.common.ui.services.action.actionFilterProviders 对菜单项进行控制，如下代码清单 15 为扩展该 extension point 的 xml 代码，我们可以定义多个属性（&lt;Attribute&gt; … &lt;/Attribute），其中 Attribute 的 name 和 value 对应于 visibility 的 objectState 中的 name 和 value。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 15. 通过 actionFilterProviders 扩展点实现对菜单的控制</h6> 
   <pre> &lt;extension 
 point="org.eclipse.gmf.runtime.common.ui.services.action.actionFilterProviders"&gt; 
     &lt;ActionFilterProvider 
           class="com.free.menu.PopupActionFilterProvider"&gt; 
        &lt;Priority 
              name="Medium"&gt; 
        &lt;/Priority&gt; 
        &lt;Attribute 
              name="com.ibm.bg.uml.search.isSupportedType"
              value="supported"&gt; 
        &lt;/Attribute&gt; 
     &lt;/ActionFilterProvider&gt; 
 &lt;/extension&gt;</pre> 
   <p style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">如下代码清单 16 所示 PopupActionFilterProvider 的实现，它继承 AbstractActionFilterProvider，只需要实现其中的 testAttribute 和 provides 方法，当 testAttribute 返回 true 时，那么该菜单项被启用，否则禁用。其中 target 对应于我们选择的对象，name 和 value 参数对应于 visiblity 中 objectState 的 name 和 value 的指定值 ( 与前面提到的 Person 类中的 testAttribute 方法类似 )。</p> 
   <h6 style="font-size:11px;font-family:Verdana, Arial, Helvetica, sans-serif;">清单 16. actionFilterProviders 扩展点实现类</h6> 
   <pre> public class PopupActionFilterProvider extends AbstractActionFilterProvider { 


    public PopupActionFilterProvider() { 
    } 

    public boolean testAttribute(Object target, String name, String value) { 
            
    } 

    public boolean provides(IOperation operation) { 
        return false; 
    } 

 }</pre> 
   <h4 style="font-size:14px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;">参考资料</h4> 
   <ul style="font-family:Verdana, Arial, Helvetica, sans-serif;font-size:12px;">
    <li style="list-style:disc;">阅读&nbsp;<a href="http://wiki.eclipse.org/Command_Core_Expressions" rel="nofollow" style="color:rgb(0,0,0);">http://wiki.eclipse.org/Command_Core_Expressions</a>&nbsp;一文，理解 Eclipse Command 表达式的用途。</li> 
    <li style="list-style:disc;">研读&nbsp;<a href="http://wiki.eclipse.org/Menu_Contributions#menu" rel="nofollow" style="color:rgb(0,0,0);">http://wiki.eclipse.org/Menu_Contributions#menu</a>&nbsp;一文，从中获取如何使用 menuContribution。</li> 
    <li style="list-style:disc;">查看&nbsp;<a href="http://help.eclipse.org/help32/topic/org.eclipse.platform.doc.isv/reference/extension-points/org_eclipse_ui_commands.html" rel="nofollow" style="color:rgb(0,0,0);">Eclipse Commands 帮助</a>&nbsp;一文，理解 org.eclipse.ui.commands 扩展点。</li> 
    <li style="list-style:disc;">查看&nbsp;<a href="http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.gmf.doc/reference/extension-points/org_eclipse_gmf_runtime_common_ui_services_action_actionFilterProviders.html" rel="nofollow" style="color:rgb(0,0,0);">Action Filter Providers Extension Point</a>一文，理解 actionFilterProviders 扩展点。</li> 
    <li style="list-style:disc;">查看&nbsp;<a href="http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/viewers/IStructuredContentProvider.html" rel="nofollow" style="color:rgb(0,0,0);">Interface IStructuredContentProvider</a>一文，理解 org.eclipse.ui.popupMenus 扩展点。</li> 
    <li style="list-style:disc;">访问 developerWorks&nbsp;<a href="http://www.ibm.com/developerworks/cn/opensource/" rel="nofollow" style="color:rgb(0,0,0);">Open source 专区</a>获得丰富的 how-to 信息、工具和项目更新以及<a href="http://www.ibm.com/developerworks/cn/opensource/best2009/index.html" rel="nofollow" style="color:rgb(0,0,0);">最受欢迎的文章和教程</a>，帮助您用开放源码技术进行开发，并将它们与 IBM 产品结合使用。</li> 
   </ul>
   <div>
    <font><span style="font-size:12px;"><br></span></font>
   </div> 
   <div> 
    <font><span style="font-size:12px;">本文转自hcy's workbench博客园博客，原文链接：http://www.cnblogs.com/alterhu/p/4032583.html</span></font>
    <span style="font-size:12px;font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者。</span> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
