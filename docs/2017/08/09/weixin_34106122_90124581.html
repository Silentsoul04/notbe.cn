<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>iOS:iOS开发系列–打造自己的“美图秀秀”(中) « NotBeCN</title>
  <meta name="description" content="                  来源：&nbsp;KenshinCui &nbsp;&nbsp;     链接：http://www.cnblogs.com/kenshincui/p/3959951.html          其他状态设置     常用的图形上下文状态设置上面基本都用到了，我们不再一一解释，...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/08/09/weixin_34106122_90124581.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">iOS:iOS开发系列–打造自己的“美图秀秀”(中)</h1>
    <p class="post-meta">Aug 9, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">来源：&nbsp;KenshinCui &nbsp;&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">链接：<a href="http://www.cnblogs.com/kenshincui/p/3959951.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom-width:1px;border-bottom-style:dotted;border-bottom-color:rgb(51,51,51);">http://www.cnblogs.com/kenshincui/p/3959951.html</a></span></p> 
    <p><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318104901724-1549115296.png" alt="" style="border:0px;"></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>其他状态设置</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">常用的图形上下文状态设置上面基本都用到了，我们不再一一解释，这里着重说一下叠加模式和填充模式，初学者对于这两个状态设置往往容易产生疑惑。</span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>叠加模式</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">使用Quartz 2D绘图时后面绘制的图像会覆盖前面的，默认情况下如果前面的被覆盖后将看不到后面的内容，但是有时候这个结果并不是我们想要的，因此在Quartz 2D中提供了填充模式供开发者配置调整。由于填充模式类别特别多，因此下面以一个例子来说明：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawRectByUIKitWithContext2:(CGContextRef)context{
    CGRect rect</span>= CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">130.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span><span style="line-height:1.8;">);
    CGRect rect1</span>= CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">390.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span><span style="line-height:1.8;">);
 
    CGRect rect2</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">20</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect3</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">40.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect4</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">60.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect5</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">80.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect6</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">100.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect7</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">120.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect8</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">140.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect9</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">160.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect10</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">180.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect11</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">200.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect12</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">220.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect13</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">240.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect14</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">260.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect15</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">280.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
 
    CGRect rect16</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">30.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect17</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">50.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect18</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">70.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect19</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">90.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect20</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">110.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect21</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">130.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect22</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">150.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect23</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">170.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect24</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">190.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect25</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">210.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect26</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">230.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect27</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">250.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect28</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">270.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
    CGRect rect29</span>=CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">290.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">310.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">250.0</span><span style="line-height:1.8;">);
 
    [[UIColor yellowColor]</span><span style="line-height:1.8;color:rgb(0,0,255);">set</span><span style="line-height:1.8;">];
    UIRectFill(rect);
 
    [[UIColor greenColor]setFill];
    UIRectFill(rect1);
 
    [[UIColor redColor]setFill];
    UIRectFillUsingBlendMode(rect2, kCGBlendModeClear);
    UIRectFillUsingBlendMode(rect3, kCGBlendModeColor);
    UIRectFillUsingBlendMode(rect4, kCGBlendModeColorBurn);
    UIRectFillUsingBlendMode(rect5, kCGBlendModeColorDodge);
    UIRectFillUsingBlendMode(rect6, kCGBlendModeCopy);
    UIRectFillUsingBlendMode(rect7, kCGBlendModeDarken);
    UIRectFillUsingBlendMode(rect8, kCGBlendModeDestinationAtop);
    UIRectFillUsingBlendMode(rect9, kCGBlendModeDestinationIn);
    UIRectFillUsingBlendMode(rect10, kCGBlendModeDestinationOut);
    UIRectFillUsingBlendMode(rect11, kCGBlendModeDestinationOver);
    UIRectFillUsingBlendMode(rect12, kCGBlendModeDifference);
    UIRectFillUsingBlendMode(rect13, kCGBlendModeExclusion);
    UIRectFillUsingBlendMode(rect14, kCGBlendModeHardLight);
    UIRectFillUsingBlendMode(rect15, kCGBlendModeHue);
    UIRectFillUsingBlendMode(rect16, kCGBlendModeLighten);
 
    UIRectFillUsingBlendMode(rect17, kCGBlendModeLuminosity);
    UIRectFillUsingBlendMode(rect18, kCGBlendModeMultiply);
    UIRectFillUsingBlendMode(rect19, kCGBlendModeNormal);
    UIRectFillUsingBlendMode(rect20, kCGBlendModeOverlay);
    UIRectFillUsingBlendMode(rect21, kCGBlendModePlusDarker);
    UIRectFillUsingBlendMode(rect22, kCGBlendModePlusLighter);
    UIRectFillUsingBlendMode(rect23, kCGBlendModeSaturation);
    UIRectFillUsingBlendMode(rect24, kCGBlendModeScreen);
    UIRectFillUsingBlendMode(rect25, kCGBlendModeSoftLight);
    UIRectFillUsingBlendMode(rect26, kCGBlendModeSourceAtop);
    UIRectFillUsingBlendMode(rect27, kCGBlendModeSourceIn);
    UIRectFillUsingBlendMode(rect28, kCGBlendModeSourceOut);
    UIRectFillUsingBlendMode(rect29, kCGBlendModeXOR);
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;">运行效果</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;"><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318105207021-1049812146.png" alt="" style="border:0px;"></span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">相信大家对比代码和显示效果并不难发现每种叠加的效果。例子中只是使用UIKit的封装方法进行叠加模式设置，更一般的方法当然是使用CGContextSetBlendMode(CGContextRef context, CGBlendMode mode)方法进行设置。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>&nbsp;</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>填充模式</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;前面的示例中已经演示过纯色填充、渐变填充，而有时我们需要按一定的自定义样式进行填充，这种方式有点类似于贴瓷砖的方式。我们知道如果家里贴地板或瓷砖时，通常我们会先选择一种瓷砖样式，根据房间面积我们购买不同量的瓷砖。但是不管买多少，这些瓷砖的样式都是一模一样的。填充模式就是为了达到这种效果而产生的：我们只需要绘制一个瓷砖的样式，然后让程序自动调用这种样式填充指定大小的区域。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;Quartz 2D支持两种填充模式：有颜色填充和无颜色填充。两种模式使用起来区别很小，有颜色填充就是在绘制瓷砖时就指定颜色，在调用填充时就不用再指定瓷砖颜色；无颜色填充模式就是绘制瓷砖时不用指定任何颜色，在调用填充时再指定具体填充颜色。相比较无颜色填充模式而言，有颜色填充模式更加的灵活，推荐使用。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">下面我们具体看一下如何按指定模式进行图形填充：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;1.在使用填充模式时首先要构建一个符合CGPatternDrawPatternCallback签名的方法，这个方法专门用来创建“瓷砖”。注意：如果使用有颜色填充模式，需要设置填充色。例如我们定义一个方法drawTile绘制以下瓷砖（有颜色填充）：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318105355303-198660340.png" alt="" style="border:0px;"></span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">2.接着需要指定一个填充的颜色空间，这个颜色空间跟前面绘制渐变的颜色空间不太一样，前面创建渐变使用的颜色空间是设备无关的，我们需要基于这个颜色空间创建一个颜色空间专门用于填充（注意对于有颜色填充创建填充颜色空间参数为NULL，不用基于设备无关的颜色空间创建）。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">3.然后我们就可以使用CGPatternCreate方法创建一个填充模式，创建填充模式时需要注意其中的参数，在代码中已经做了一一解释（这里注意对于有颜色填充模式isColored设置为true，否则为false）。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">4.最后调用CGContextSetFillPattern方法给图形上下文指定填充模式（这个时候注意最后一个参数，如果是有颜色填充模式最后一个参数为透明度alpa的地址，对于无颜色填充模式最后一个参数是当前填充颜色空间的颜色数组）。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">5.绘制图形，这里我们绘制一个矩形。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">6.释放资源。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">下面是具体代码（包含两种填充模式代码，可以一一运行）</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#define</span> TILE_SIZE 20
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCView
 
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawRect:(CGRect)rect{
    CGContextRef context</span>=<span style="line-height:1.8;">UIGraphicsGetCurrentContext();
    [self drawBackgroundWithColoredPattern:context];
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    [self drawBackgroundWithPattern:context];</span>
<span style="line-height:1.8;"> 
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">#pragma</span> mark - 有颜色填充模式
<span style="line-height:1.8;color:rgb(0,0,255);">void</span> drawColoredTile(<span style="line-height:1.8;color:rgb(0,0,255);">void</span> *<span style="line-height:1.8;">info,CGContextRef context){
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">有颜色填充，这里设置填充色</span>
    CGContextSetRGBFillColor(context, <span style="line-height:1.8;color:rgb(128,0,128);">254.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">52.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">90.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">);
    CGContextFillRect(context, CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">, TILE_SIZE, TILE_SIZE));
    CGContextFillRect(context, CGRectMake(TILE_SIZE, TILE_SIZE, TILE_SIZE, TILE_SIZE));
}
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawBackgroundWithColoredPattern:(CGContextRef)context{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">设备无关的颜色空间
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    CGColorSpaceRef rgbSpace= CGColorSpaceCreateDeviceRGB();
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">模式填充颜色空间,注意对于有颜色填充模式，这里传NULL</span>
    CGColorSpaceRef colorSpace=<span style="line-height:1.8;">CGColorSpaceCreatePattern(NULL);
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">将填充色颜色空间设置为模式填充的颜色空间</span>
<span style="line-height:1.8;">    CGContextSetFillColorSpace(context, colorSpace);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">填充模式回调函数结构体</span>
    CGPatternCallbacks callback={<span style="line-height:1.8;color:rgb(128,0,128);">0</span>,&amp;<span style="line-height:1.8;">drawColoredTile,NULL};
    </span><span style="line-height:1.8;color:rgb(0,128,0);">/*</span><span style="line-height:1.8;color:rgb(0,128,0);">填充模式
     info://传递给callback的参数
     bounds:瓷砖大小
     matrix:形变
     xStep:瓷砖横向间距
     yStep:瓷砖纵向间距
     tiling:贴砖的方法
     isClored:绘制的瓷砖是否已经指定了颜色(对于有颜色瓷砖此处指定位true)
     callbacks:回调函数
     </span><span style="line-height:1.8;color:rgb(0,128,0);">*/</span><span style="line-height:1.8;">
    CGPatternRef pattern</span>=CGPatternCreate(NULL, CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE, <span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE), CGAffineTransformIdentity,<span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE+ <span style="line-height:1.8;color:rgb(128,0,128);">5</span>,<span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE+ <span style="line-height:1.8;color:rgb(128,0,128);">5</span>, kCGPatternTilingNoDistortion, <span style="line-height:1.8;color:rgb(0,0,255);">true</span>, &amp;<span style="line-height:1.8;">callback);
 
    CGFloat alpha</span>=<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">注意最后一个参数对于有颜色瓷砖指定为透明度的参数地址，对于无颜色瓷砖则指定当前颜色空间对应的颜色数组</span>
    CGContextSetFillPattern(context, pattern, &amp;<span style="line-height:1.8;">alpha);
 
    UIRectFill(CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">568</span><span style="line-height:1.8;">));
 
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    CGColorSpaceRelease(rgbSpace);</span>
<span style="line-height:1.8;">    CGColorSpaceRelease(colorSpace);
    CGPatternRelease(pattern);
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">#pragma</span> mark - 无颜色填充模式
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">填充瓷砖的回调函数（必须满足CGPatternCallbacks签名）</span>
<span style="line-height:1.8;color:rgb(0,0,255);">void</span> drawTile(<span style="line-height:1.8;color:rgb(0,0,255);">void</span> *<span style="line-height:1.8;">info,CGContextRef context){
    CGContextFillRect(context, CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">, TILE_SIZE, TILE_SIZE));
    CGContextFillRect(context, CGRectMake(TILE_SIZE, TILE_SIZE, TILE_SIZE, TILE_SIZE));
}
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawBackgroundWithPattern:(CGContextRef)context{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">设备无关的颜色空间</span>
    CGColorSpaceRef rgbSpace=<span style="line-height:1.8;"> CGColorSpaceCreateDeviceRGB();
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">模式填充颜色空间</span>
    CGColorSpaceRef colorSpace=<span style="line-height:1.8;">CGColorSpaceCreatePattern(rgbSpace);
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">将填充色颜色空间设置为模式填充的颜色空间</span>
<span style="line-height:1.8;">    CGContextSetFillColorSpace(context, colorSpace);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">填充模式回调函数结构体</span>
    CGPatternCallbacks callback={<span style="line-height:1.8;color:rgb(128,0,128);">0</span>,&amp;<span style="line-height:1.8;">drawTile,NULL};
    </span><span style="line-height:1.8;color:rgb(0,128,0);">/*</span><span style="line-height:1.8;color:rgb(0,128,0);">填充模式
     info://传递给callback的参数
     bounds:瓷砖大小
     matrix:形变
     xStep:瓷砖横向间距
     yStep:瓷砖纵向间距
     tiling:贴砖的方法（瓷砖摆放的方式）
     isClored:绘制的瓷砖是否已经指定了颜色（对于无颜色瓷砖此处指定位false）
     callbacks:回调函数
     </span><span style="line-height:1.8;color:rgb(0,128,0);">*/</span><span style="line-height:1.8;">
    CGPatternRef pattern</span>=CGPatternCreate(NULL, CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE, <span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE), CGAffineTransformIdentity,<span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE+ <span style="line-height:1.8;color:rgb(128,0,128);">5</span>,<span style="line-height:1.8;color:rgb(128,0,128);">2</span>*TILE_SIZE+ <span style="line-height:1.8;color:rgb(128,0,128);">5</span>, kCGPatternTilingNoDistortion, <span style="line-height:1.8;color:rgb(0,0,255);">false</span>, &amp;<span style="line-height:1.8;">callback);
 
    CGFloat components[]</span>={<span style="line-height:1.8;color:rgb(128,0,128);">254.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>,<span style="line-height:1.8;color:rgb(128,0,128);">52.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>,<span style="line-height:1.8;color:rgb(128,0,128);">90.0</span>/<span style="line-height:1.8;color:rgb(128,0,128);">255.0</span>,<span style="line-height:1.8;color:rgb(128,0,128);">1.0</span><span style="line-height:1.8;">};
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">注意最后一个参数对于无颜色填充模式指定为当前颜色空间颜色数据</span>
<span style="line-height:1.8;">    CGContextSetFillPattern(context, pattern, components);
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    CGContextSetStrokePattern(context, pattern, components);</span>
    UIRectFill(CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">568</span><span style="line-height:1.8;">));
 
    CGColorSpaceRelease(rgbSpace);
    CGColorSpaceRelease(colorSpace);
    CGPatternRelease(pattern);
}
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318105517006-1492778552.png" alt="" style="border:0px;"></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">这里强调一点，在drawTile回调方法中不要使用UIKit封装方法进行图形绘制（例如UIRectFill等），由于这个方法由Core Graphics内部调用，而Core Graphics考虑到跨平台问题，内部是不允许调用UIKit方法的。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>上下文变换</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">我们知道在UIKit开发中UIView有一个transform属性用于控件的形变，其实在绘图中我们也经常用到图形形变，这个时候可以借助图形上下文的形变方法来完成。在弄清形变之前我们要清楚图形上下文的坐标原点，因为无论是位移还是旋转都是相对于坐标原点进行的。其实Quartz 2D的坐标系同UIKit并不一样，它的坐标原点在屏幕左下方，但是为了统一编程方式，UIKit对其进行了转换，坐标原点统一在屏幕左上角。注意在设置图形上下文形变之前一定要注意保存上下文的初始状态，在使用完之后进行恢复。否则在处理多个图形形变的时候很容易弄不清楚到底是基于怎样的坐标系进行绘图，容易找不到原点（做过html5 canvas绘图的朋友对这一点应该很熟悉，在html5中绘图也经常进行状态保存和恢复）。下面通过一个图片的变换演示一下图形上下文的形变（其他图形也是一样的，就不再演示）：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView2.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCView2
 
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawRect:(CGRect)rect{
    CGContextRef context</span>=<span style="line-height:1.8;">UIGraphicsGetCurrentContext();
    [self drawImage:context];
}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 图形上下文形变</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawImage:(CGContextRef)context{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">保存初始状态</span>
<span style="line-height:1.8;">    CGContextSaveGState(context);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">形变第一步：图形上下文向右平移40</span>
    CGContextTranslateCTM(context, <span style="line-height:1.8;color:rgb(128,0,128);">100</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">形变第二步：缩放0.8</span>
    CGContextScaleCTM(context, <span style="line-height:1.8;color:rgb(128,0,128);">0.8</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0.8</span><span style="line-height:1.8;">);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">形变第三步：旋转</span>
    CGContextRotateCTM(context, M_PI_4/<span style="line-height:1.8;color:rgb(128,0,128);">4</span><span style="line-height:1.8;">);
 
    UIImage </span>*image=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">photo1.jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [image drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50</span>, <span style="line-height:1.8;color:rgb(128,0,128);">240</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span><span style="line-height:1.8;">)];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">恢复到初始状态</span>
<span style="line-height:1.8;">    CGContextRestoreGState(context);
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">最终运行效果见第四幅截图，下图描绘出了整个程序的运行过程（移动-&gt;缩放-&gt;旋转）：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318105658881-829130182.png" alt="" style="border:0px;"></span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>扩展–使用Core Graphics绘制图像</strong></span><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在前面基本绘图部分，绘制图像时使用了UIKit中封装的方法进行了图像绘制，我们不妨看一下使用Quartz 2D内置方法绘制是什么效果。</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawImage2:(CGContextRef)context{
    UIImage </span>*image=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">image2.jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">图像绘制</span>
    CGRect rect= CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">450</span><span style="line-height:1.8;">);
    CGContextDrawImage(context, rect, image.CGImage);
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;">运行效果：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;"><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318105807193-265813439.png" alt="" style="border:0px;"></span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">看起来整个图像是倒过来的，原因正是前面说的：在Core Graphics中坐标系的y轴正方向是向上的，坐标原点在屏幕左下角，y轴方向刚好和UIKit中y轴方向相反。而使用UIKit进行绘图之所以没有问题是因为UIKit中进行了处理，事实上对于其他图形即使使用Core Graphics绘制也没有问题，因为UIKit统一了编程方式。但是使用Core Graphics中内置方法绘制图像是存在这种问题的，如何解决呢？</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">其实图形上下文只要沿着x轴旋转180度，然后向上平移适当的高度即可（但是注意不要沿着z轴旋转，这样得不到想要的结果）。可是通过前面介绍的CGContextRotateCTM方法只能通过沿着z轴旋转，此时不妨使用另外一种方法，那就是在y轴方向缩放-1，同样可以达到想要的效果：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawImage2:(CGContextRef)context{
    UIImage </span>*image=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">image2.jpg</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    CGSize size</span>=<span style="line-height:1.8;">[UIScreen mainScreen].bounds.size;
    CGContextSaveGState(context);
    CGFloat height</span>=<span style="line-height:1.8;color:rgb(128,0,128);">450</span>,y=<span style="line-height:1.8;color:rgb(128,0,128);">50</span><span style="line-height:1.8;">;
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">上下文形变</span>
    CGContextScaleCTM(context, <span style="line-height:1.8;color:rgb(128,0,128);">1.0</span>, -<span style="line-height:1.8;color:rgb(128,0,128);">1.0</span>);<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">在y轴缩放-1相当于沿着x张旋转180</span>
    CGContextTranslateCTM(context, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, -(size.height-(size.height-<span style="line-height:1.8;color:rgb(128,0,128);">2</span>*y-height)));<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">向上平移
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">图像绘制</span>
    CGRect rect= CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">10</span>, y, <span style="line-height:1.8;color:rgb(128,0,128);">300</span><span style="line-height:1.8;">, height);
    CGContextDrawImage(context, rect, image.CGImage);
 
    CGContextRestoreGState(context);
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>视图刷新</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在UIView的drawRect:中绘制的图形会在控件显示的时候调用（而且显示时会重绘所有图形），有时候我们希望绘制内容的显示是实时的，此时我们就需要调用绘图方法重新绘制，但是在iOS开发中不允许开发者直接调用drawRect:方法，刷新绘制内容需要调用setNeedsDisplay方法。下面以一个调整字体大小的界面演示一下视图的刷新。</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre> 
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> &lt;UIKit/UIKit.h&gt;
 
<span style="line-height:1.8;color:rgb(0,0,255);">@interface</span><span style="line-height:1.8;"> KCView : UIView
 
@property (nonatomic,copy) NSString </span>*<span style="line-height:1.8;">title;
 
@property (nonatomic,assign) CGFloat fontSize;
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span><span style="line-height:1.8;">

KCView.m

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  KCView.m
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  RefreshView
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span>
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Created by Kenshin Cui on 14-3-17.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Copyright (c) 2014年 Kenshin Cui. All rights reserved.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//
</span> 
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCView
 
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawRect:(CGRect)rect{
 
    NSString </span>*str=<span style="line-height:1.8;">_title;
    UIFont </span>*font=[UIFont fontWithName:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Marker Felt</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> size:_fontSize];
    UIColor </span>*foreignColor=<span style="line-height:1.8;">[UIColor redColor];
    [str drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">100</span>, <span style="line-height:1.8;color:rgb(128,0,128);">120</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">200</span><span style="line-height:1.8;">) withAttributes:@{NSFontAttributeName:font,NSForegroundColorAttributeName:foreignColor}];
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span><span style="line-height:1.8;">

KCMainViewController.m

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  KCMainViewController.m
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  RefreshView
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span>
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Created by Kenshin Cui on 14-3-17.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Copyright (c) 2014年 Kenshin Cui. All rights reserved.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//
</span> 
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCMainViewController.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@interface</span><span style="line-height:1.8;"> KCMainViewController (){
    KCView </span>*<span style="line-height:1.8;">_contentView;
    NSArray </span>*<span style="line-height:1.8;">_fontSize;
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCMainViewController
 
</span>- (<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)viewDidLoad {
    [super viewDidLoad];
 
    [self initLayout];
 
    [self addPickerView];
}
 
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)initLayout{
    _fontSize</span>=@[@<span style="line-height:1.8;color:rgb(128,0,128);">15</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">18</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">20</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">22</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">25</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">28</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">30</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">32</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">35</span>,@<span style="line-height:1.8;color:rgb(128,0,128);">40</span><span style="line-height:1.8;">];
    _contentView</span>=[[KCView alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span><span style="line-height:1.8;">)];
    _contentView.backgroundColor</span>=<span style="line-height:1.8;">[UIColor whiteColor];
    _contentView.title</span>=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Hello world!</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    _contentView.fontSize</span>=[_fontSize[<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">] intValue];
    [self.view addSubview:_contentView];
}
 
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)addPickerView{
    UIPickerView </span>*picker=[[UIPickerView alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">268</span><span style="line-height:1.8;">)];
    picker.dataSource</span>=<span style="line-height:1.8;">self;
    picker.</span><span style="line-height:1.8;color:rgb(0,0,255);">delegate</span>=<span style="line-height:1.8;">self;
 
    [self.view addSubview:picker];
}
 
</span>-(NSInteger)numberOfComponentsInPickerView:(UIPickerView *<span style="line-height:1.8;">)pickerView{
    </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
}
</span>-(NSInteger)pickerView:(UIPickerView *<span style="line-height:1.8;">)pickerView numberOfRowsInComponent:(NSInteger)component{
    </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> _fontSize.count;
}
 
</span>-(NSString *)pickerView:(UIPickerView *<span style="line-height:1.8;">)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component{
    </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> [NSString stringWithFormat:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">%@号字体</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">,_fontSize[row] ];
}
</span>-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)pickerView:(UIPickerView *<span style="line-height:1.8;">)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component{
    _contentView.fontSize</span>=<span style="line-height:1.8;">[[_fontSize objectAtIndex:row] intValue];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">刷新视图</span>
<span style="line-height:1.8;">    [_contentView setNeedsDisplay];
}
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p>&nbsp;</p> 
   </div> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;">
    程序猿神奇的手，每时每刻，这双手都在改变着世界的交互方式！
   </div> 
   <div class="clear" style="clear:both;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"></div> 
   <div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;line-height:25.2px;">本文转自当天真遇到现实博客园博客，原文链接：http://www.cnblogs.com/XYQ-208910/p/5291233.html</span></font>
     <span style="font-size:14px;line-height:25.2px;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
