<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>理解.NET中的异常（二） « NotBeCN</title>
  <meta name="description" content="             上一篇中讨论了异常的优点、异常的本质、异常的机制 这里将讨论FCL中预定义的异常类，自定义异常类，正确的使用异常（抛出、捕获、封装），最后给出性能方面的建议。    4、System. Exception及其它FCL中的异常类    4.1 System.Exception&nbsp;类...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/08/31/weixin_33836223_90130772.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">理解.NET中的异常（二）</h1>
    <p class="post-meta">Aug 31, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><br><a title="理解.NET中的异常（一）" href="http://www.cnblogs.com/anderslly/archive/2007/03/14/understandingexception1.html" rel="nofollow" style="text-decoration:none;color:rgb(224,0,255);border-bottom-width:1px;border-bottom-style:dashed;">上一篇</a>中讨论了异常的优点、异常的本质、异常的机制<br><br> 这里将讨论FCL中预定义的异常类，自定义异常类，正确的使用异常（抛出、捕获、封装），最后给出性能方面的建议。<br></p> 
   <p style="line-height:1.8;font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;color:rgb(80,91,255);"><strong>4</strong><strong>、System. Exception</strong><strong>及其它FCL</strong><strong>中的异常类</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>4.1 System.Exception&nbsp;</strong><strong>类型</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">CLR允许我们将任何类型——Int32、String等——的一个实例作为异常抛出。但实际上，微软定义了System.Exception类型，并规定所有和CLS兼容的编程语言都必须能够抛出并捕获那些继承自System.Exception的异常类型。继承自System.Exception的异常类型被认为是与CLS兼容的。C#和其它许多语言都只允许代码抛出与CLR兼容的异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">System.Exception类型是一个很简单的类型，下表列出了它所包含的一些属性。</p> 
   <table class="MsoTableGrid" border="1" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;margin-left:5.4pt;">
    <tbody>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">属性</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">访问权限</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">类型</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">描述</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">Message</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">只读</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">String</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">包含一段辅助性的文本，描述异常发生的原因。在出现未处理异常时，这些信息通常会写入log。这些信息用户通常是看不见的，所以应尽量使用技术性的词汇以帮助其它开发人员修正代码。</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">Data</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">只读</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">IDictionary</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">一个指向key-value对集合的引用。通常应在抛出异常前，向该集合添加信息，而捕获异常的代码则使用这些信息进行异常恢复操作。</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">Source</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">读写</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">String</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">产生异常的程序集的名称</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">StackTrace</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">只读</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">String</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">包含了调用堆栈中抛出异常的方法的名称和签名。该属性对于调试极具价值。</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">TargetSite</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">只读</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">MethodBase</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">抛出异常的方法。</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">HelpLink</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">读写</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">String</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">获取或设置异常的关联帮助文件的链接。</p> </td> 
     </tr>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:101.1pt;"> <p style="line-height:1.8;">InnerExceptoin</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:78.9pt;"> <p style="line-height:1.8;">只读</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:72pt;"> <p style="line-height:1.8;">Exception</p> </td> 
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;width:162pt;"> <p style="line-height:1.8;">如果当前异常是在处理另一个异常时产生的，那么该属性表示前一个属性。该属性通常为null。Exception类型还提供了一个公有方法GetBaseException，用以遍历所以内部异常组成的链表，返回最开始那个异常。</p> </td> 
     </tr>
    </tbody>
   </table>
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>4.2 FCL</strong><strong>中的异常类结构</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">.NET框架类库（FCL）中定义了很多异常类型（而它们最终又都继承自Exception类）。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">微软的<strong>最初想法</strong>是这样的：System.Exception应是所有异常的基类型，另两个类型System.SystemException和System.ApplicationException则是仅有的直接继承自System.Exception的异常类型。此外，CLR抛出的异常都继承自SystemException，应用程序抛出的异常应当继承自ApplicationException。这样一来，开发人员就能够编写catch块来捕获所有CLR抛出的异常或所有应用程序抛出的异常。</p> 
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">但遗憾的是，FCL也没能很好地遵循这个原则。有些异常类直接继承自Exception（</span>
   <strong style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">IsolatedStorageException</strong>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">），有些CLR抛出的异常却继承自ApplicationException（如</span>
   <strong style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">TargetInvocationException</strong>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">），还有些应用程序抛出的异常则继承自SystemException（如</span>
   <strong style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">FormatException</strong>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">）。这显得有些混乱，而其结果便是SystemException和ApplicationException类型的存在没有多大价值了。&nbsp;</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong style="color:rgb(80,91,255);">5</strong><strong><span style="line-height:1.8;color:rgb(80,91,255);">、自定义异常类</span></strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果FCL没有为我们定义合适的异常类型，我们就要考虑定义创建自己的异常类了。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">一般情况下，自定义异常类应继承自Exception类型或其它与Exception相近的基类型，如果我们定义的类型不打算作为其它类型的基类型，应该将其标识为sealed。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">Exception基类型定义了4个构造函数：</p> 
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">公有的无参（默认）构造函数，创建一个异常类型的实例，并将所有字段和属性的值设置为默认值。</li>
   </ul>
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">公有的带一个String参数的构造函数，创建一个异常类型的实例，异常的消息将设置为参数指定的文本。</li>
   </ul>
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">公有的带String和Exception参数的构造函数，创建一个异常类型的实例，并设置其消息文本和内部异常。<strong>在对异常进行封装时，该构造函数会显示出其重要性</strong>。</li>
   </ul>
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;">受保护的带SerializationInfo和StreamingContext参数的构造函数，反序列化Exception对象的实例。记住，如果异常类型是密封的（sealed），该方法应声明为private的，确保该构造函数能够调用基类型的相同的构造函数，这样基类的字段能够得到正确的序列化。</li>
   </ul>
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">在定义自己的异常类型时，我们<span style="line-height:1.8;font-weight:bold;">应当实现这四个构造函数</span>，而且它们都要调用基类型中相应的构造函数。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">当然，我们定义的异常类型会继承Exception类型的所有字段和属性。此外，我们还可以为其添加自己的字段和属性。例如，System.ArgumentException中添加了一个虚拟的（virtual）String属性ParamName（其它的一切则继承自Exception类型）。ArgumentException也定义了两个新的构造函数（除了上述四个），来初始化ParamName属性。这里我们也应了解，<strong>如果为异常类型添加字段，要确保添加必要的构造函数来初始化这些字段，同时也要定义相应的属性或其它成员（如方法）返回这些字段的值</strong>。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>所有的异常类型（继承自Exception</strong><strong>类型）都应是可序列化的</strong>，只有这样异常对象才能在跨越应用程序域时得到封送处理（marshaled），同时还能持久化至日志或数据库。要使自定义的异常类型可序列化，首先为该类型应用<strong>Serializable</strong>特性（attribute）；如果类型定义了新的字段，我们还必须让其实现ISerilizable接口的<strong>GetObjectData</strong>方法和上面提及的受保护的构造函数。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">下面是的示例演示了如何正确地创建自定义异常类型：</p> 
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">要实现上面四个构造函数，建议使用VS 2005中的Code Snippet：</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <img alt="" src="https://images.cnblogs.com/cnblogs_com/anderslly/ExceptionCodeSnippet.JPG" height="454" width="717" style="border:0px;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">按两下Tab后，VS就会为你生成类的基本结构:)，我们在这个基础上编写代码。</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">下面是类的完整代码：&nbsp;</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;为类应用Serializable特性</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;[Serializable]<br> &nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">sealed</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">class</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException&nbsp;:&nbsp;Exception<br> &nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;添加的自定义字段</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">private</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">private</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">bool</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo;<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;实现三个公有的构造函数，这里只是简单地调用基类的构造函数</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException()&nbsp;{&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;message)&nbsp;:&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">(message)&nbsp;{&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;message,&nbsp;Exception&nbsp;inner)&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">(message,&nbsp;inner)&nbsp;{&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;实现ISerialization接口所需要的反序列化构造函数。<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;因为本类为sealed，该构造函数为private。</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">private</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(SerializationInfo&nbsp;info,&nbsp;StreamingContext&nbsp;context)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">(info,&nbsp;context)&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stringInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;info.GetString(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">StringInfo</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;booleanInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;info.GetBoolean(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">BooleanInfo</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;添加构造函数以确保自定义字段能得到正确的初始化</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;message,&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo,&nbsp;</span>
    <span style="color:rgb(0,0,255);">bool</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">(message)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">this</span>
    <span style="color:rgb(0,0,0);">.stringInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">this</span>
    <span style="color:rgb(0,0,0);">.booleanInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;message,&nbsp;Exception&nbsp;inner,&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo,&nbsp;</span>
    <span style="color:rgb(0,0,255);">bool</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">(message,&nbsp;inner)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">this</span>
    <span style="color:rgb(0,0,0);">.stringInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">this</span>
    <span style="color:rgb(0,0,0);">.booleanInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;通过属性或其它成员提供对自定义字段的访问</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;StringInfo<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">get</span>
    <span style="color:rgb(0,0,0);">&nbsp;{&nbsp;</span>
    <span style="color:rgb(0,0,255);">return</span>
    <span style="color:rgb(0,0,0);">&nbsp;stringInfo;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">bool</span>
    <span style="color:rgb(0,0,0);">&nbsp;BooleanInfo<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">get</span>
    <span style="color:rgb(0,0,0);">&nbsp;{&nbsp;</span>
    <span style="color:rgb(0,0,255);">return</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;重写GetObjectData方法。<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;如果添加了自定义字段，一定要重写基类GetObjectData方法的实现。</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">override</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">void</span>
    <span style="color:rgb(0,0,0);">&nbsp;GetObjectData(SerializationInfo&nbsp;info,&nbsp;StreamingContext&nbsp;context)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;序列化自定义数据成员</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.AddValue(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">StringInfo</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;stringInfo);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.AddValue(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">BooleanInfo</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;booleanInfo);<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;调用基类方法，序列化它的成员</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">.GetObjectData(info,&nbsp;context);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">override</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;Message<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">get</span>
    <span style="color:rgb(0,0,0);"><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;message&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">base</span>
    <span style="color:rgb(0,0,0);">.Message;<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">if</span>
    <span style="color:rgb(0,0,0);">&nbsp;(stringInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">!=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">null</span>
    <span style="color:rgb(0,0,0);">)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;</span>
    <span style="color:rgb(0,0,0);">+=</span>
    <span style="color:rgb(0,0,0);">&nbsp;Environment.NewLine&nbsp;</span>
    <span style="color:rgb(0,0,0);">+</span>
    <span style="color:rgb(0,0,0);"><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stringInfo&nbsp;</span>
    <span style="color:rgb(0,0,0);">+</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">&nbsp;=&nbsp;</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,0);">+</span>
    <span style="color:rgb(0,0,0);">&nbsp;booleanInfo;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">return</span>
    <span style="color:rgb(0,0,0);">&nbsp;message;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br> &nbsp;&nbsp;&nbsp;&nbsp;}</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">然后使用下面这样的代码测试异常的序列化：</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;创建一个CustomException对象，将其序列化</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;CustomException&nbsp;e&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">New&nbsp;Custom&nbsp;Exception</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">My&nbsp;String&nbsp;Info</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;</span>
    <span style="color:rgb(0,0,255);">true</span>
    <span style="color:rgb(0,0,0);">);<br> &nbsp;&nbsp;&nbsp;&nbsp;FileStream&nbsp;fs&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;FileStream(</span>
    <span style="color:rgb(0,0,0);">@"</span>
    <span style="color:rgb(0,0,0);">Test</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;FileMode.Create);<br> &nbsp;&nbsp;&nbsp;&nbsp;IFormatter&nbsp;f&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;SoapFormatter();<br> &nbsp;&nbsp;&nbsp;&nbsp;f.Serialize(fs,&nbsp;e);<br> &nbsp;&nbsp;&nbsp;&nbsp;fs.Close();<br><br> &nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;反序列化CustomException对象，查看它的字段</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;fs&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;FileStream(</span>
    <span style="color:rgb(0,0,0);">@"</span>
    <span style="color:rgb(0,0,0);">Test</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;FileMode.Open);<br> &nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;(f.Deserialize(fs))&nbsp;</span>
    <span style="color:rgb(0,0,255);">as</span>
    <span style="color:rgb(0,0,0);">&nbsp;CustomException;<br> &nbsp;&nbsp;&nbsp;&nbsp;fs.Close();<br><br> &nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(e.Message);</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">此处需要引用System.Runtime.Serialization.Formatters.Soap.dll。</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong style="color:rgb(80,91,255);">6</strong><strong><span style="line-height:1.8;color:rgb(80,91,255);">、正确地使用异常</span></strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">根据第2节的讨论，我们已经了解何种情况可以称之为异常。下面再给出一些异常使用相关的规范或建议。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">借鉴《.NET设计规范》一书的做法，本节的这些规范和建议通常由<strong>要、考虑、避免、不要</strong>这些词进行组织，每一条都描述了一种好的或是不好的做法。对于好的做法，标以√，相应的，对那些不好的做法则标以×。而不同的措辞也能够揭示该条规范的重要性。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">“<strong>要……</strong>”描述的是总要遵循的规范（但特殊情况下，可能需要违反）。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">“<strong>考虑……</strong>”描述的是一般情况下应该遵循的规范，但如果完全理解规范背后的道理，并有很好的理由不遵循它时，也不要畏惧打破常规。<br></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">“<strong>不要……</strong>”描述的是一些<strong>几乎绝对不该违反</strong>的规范。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">“<strong>避免……</strong>”则没有那么绝对，它描述的是那些通常并不好，但却存在一些已知的可以违反的情况。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>6.1&nbsp;</strong><strong>抛出异常</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">在设计我们自己的方法时，应考虑如何正确地抛出异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>返回错误码。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">前面第1节已经讨论了异常的种种好处，所以还是把异常作为报告错误的<strong>主要方法</strong>。记住每个异常都有两种信息：其一是异常信息（Message属性），其二是异常的类型，异常处理程序根据它来决定应该执行什么操作。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>通过抛出异常的方式来报告操作失败。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果一个方法未能完成它应该完成的任务，那么应该认为这是方法层面的操作失败，并抛出异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>通过调用</em><em>System.Environment.FailFast</em><em>（</em><em>New in .NET 2.0</em><em>）来终止进程，而不要抛出异常，如果代码遇到了严重问题，已经<strong>无法继续安全地执行</strong>。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>在正常的控制流中使用异常，如果能够避免的话。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>抛出异常可能会对性能造成的影响，详见第</em><em>7</em><em>节。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>为所有的异常撰写文档，</em><em>异常本质上是<strong>对程序接口隐含假设的一种违反</strong>。</em><em>我们显然需要对这些假设作详细的文档，以减少用户代码引发异常的机会。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>让公有成员根据某个选项来决定是否抛出异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">例如：</p> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,128,0);">//</span>
    <span style="color:rgb(0,128,0);">&nbsp;不好的设计</span>
    <span style="color:rgb(0,128,0);"><br></span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;Type&nbsp;GetType(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;path,&nbsp;</span>
    <span style="color:rgb(0,0,255);">bool</span>
    <span style="color:rgb(0,0,0);">&nbsp;throwOnError)&nbsp;<br></span> 
   </div> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">调用者要比方法设计者更难以决定是否抛出异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>把异常用作公有成员的返回值或输出参数。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">这样会丧失用异常来报告操作失败的诸多好处。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>避免</em></strong><em>显式地从</em><em>finally</em><em>代码块中抛出异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>优先使用</em><em>System</em><em>命名空间中已有的异常，而不是自己创建新的异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>使用自定义的异常类型，如果对错误的处理方式与其它已有异常类型有所不同。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">关于创建自定义异常类的的细节见第5节。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>仅仅为了拥有自己的异常而创建并使用新的异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>使用最合理、最具针对性的异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">抛出System.Exception总是错的，如果这么做了，那么就想一想自己是否真地了解抛出异常的原因。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在抛出异常时提供丰富而有意义的错误消息。</em><em></em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">要注意的是这些信息是提供给谁的，可能是其它开发人员，也可能是最终用户，所以<strong>这些信息应根据面向的对象设计</strong>。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>确保异常消息的语法正确无误（指自然语言，如汉语、英语等）。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>确保异常消息中的每个句子都有句号。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">这个看起来似乎过于追究细节了，那么想想这种情况：使用FCL预定义异常的Message信息时，我们有没有加过句号。如果我们提供的信息没有句号，其它开发人员使用时到底加不加句号呢？</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>避免</em></strong><em>在异常消息中使用问号和感叹号。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">或许我们习惯于使用感叹号来”警示”某些操作有问题，扪心自问，我们使用的代码返回一个感叹号，自己会有什么感觉。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>在没有得到许可的情况下在异常消息中泄漏安全信息。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>把组件抛出的异常信息本地化，如果希望组件为使用不用（自然）语言的开发人员使用。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>6.2&nbsp;</strong><strong>处理异常</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">根据6.1节的讨论，我们可以决定何时抛出异常，然后为之选择合适的类型，设计合理的信息，下一步就是如何处理异常了。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果用catch语句块捕获了某个特定类型的异常，并完全理解在catch块之后<strong>继续执行对应用程序意味着什么</strong>，那么我们说这种情况是对异常进行了处理。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果捕获的异常具体类型不确定（通常都是如此），并在不完全理解操作失败的原因或没有对操作失败作出反应的情况下让应用程序继续执行，那么我们说这种情况是<strong>把异常吞了</strong>。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>在框架（是指供开发人员使用的程序）的代码中，在捕获具体类型不确定的异常（如</em><em>System.Exception</em><em>、</em><em>System.SystemException</em><em>）时，把异常吞了。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>避免</em></strong><em>在应用程序的代码中，在捕获具体类型不确定的异常（如</em><em>System.Exception</em><em>、</em><em>System.SystemException</em><em>）时，把错误吞了。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>有时在应用程序中把异常吞了是可以接受的，但必须意识到其风险</strong>。发生异常通常会导致状态的不一致，如果贸然将异常吞掉，让程序继续执行下去，后果不堪设想。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>在为了转移异常而编写的</em><em>catch</em><em>代码块中把任何特殊的异常排除在外。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>捕获特定类型的异常，如果<strong>理解异常产生的原因</strong>，<strong>并能对错误做适当的反应</strong>。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">此时一定要能够确信，<strong>程序能够从异常中完全恢复</strong>。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>捕获不应该捕获的异常。通常应允许异常沿调用栈向上传递。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">这一点极为重要。如果捕获了不该捕获的异常，会让bug更难以发现。在开发、测试阶段应当把所有bug暴露出来。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在进行清理工作时使用</em><em>try-finally</em><em>，避免使用</em><em>try-catch</em><em>。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">对于精心编写的代码来说，try-finally的使用频率要比try-catch要高的多。这一点可能有违于直觉，因为有时可能会觉得：try不就是为了catch吗？要知道一方面我们要考虑程序状态的一致，另一方面我们还需要考虑资源的清理工作。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在捕获并重新抛出异常时使用空的</em><em>throw</em><em>语句。这是保持调用栈的最好方法。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果捕获异常后抛出新的异常，那么所报告的异常已不再是实际引发的异常，显然这会不利于程序的调试，因此应重新抛出原来的异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>用无参数的</em><em>catch</em><em>块来处理不与</em><em>CLS</em><em>兼容的异常（不是继承自</em><em>System.Exception</em><em>的异常）。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">有时候让底层代码抛出的异常传递到高层并没有什么意义，此时，可以考虑对底层的异常进行封装使之对高层的用户也有意义。还有一种情况，更重要的是要知道代码抛出了异常，而异常的类型则显得无关紧要，此时可以封装异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>对较低层次抛出的异常进行适当的封装，如果较低层次的异常在较高层次的运行环境中没有什么意义。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>避免</em></strong><em>捕获并封装具体类型不确定的异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在对异常进行封装时为其指定内部异常（</em><em>inner exception</em><em>）。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">这一点极为重要，对于代码的调试会很有帮助。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>6.3&nbsp;</strong><strong>标准异常类型的使用</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>抛出</em><em>Exception</em><em>或</em><em>SystemException</em><em>类型的异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>在框架（供其它开发人员使用）代码中捕获</em><em>Exception</em><em>或</em><em>SystemException</em><em>类型的异常，除非打算重新抛出。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>避免</em></strong><em>捕获</em><em>Exception</em><em>或</em><em>SystemException</em><em>类型的异常，除非是在顶层的异常处理器程序中。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>抛出</em><em>ApplicationException</em><em>类型的异常或者从它派生新类（参看</em><em>4.2</em><em>描述）。</em>&nbsp;<br></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>抛出</em>InvalidOperationException类型的异常，如果对象处于不正确的状态。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">一个例子是向只读的FileStream写入数据。&nbsp;<br></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>抛出ArgumentException</em><em>或其子类，如果传入的是无效参数。要注意尽量使用位于继承层次末尾的类型。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在抛出ArgumentException</em><em>或其子类时设置ParamName</em><em>属性。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">该属性表明了哪个参数引发了异常。<br></p> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">static</span>
    <span style="color:rgb(0,0,0);">&nbsp;FileAttributes&nbsp;GetAttributes(</span>
    <span style="color:rgb(0,0,255);">string</span>
    <span style="color:rgb(0,0,0);">&nbsp;path)<br> &nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">if</span>
    <span style="color:rgb(0,0,0);">&nbsp;(path&nbsp;</span>
    <span style="color:rgb(0,0,0);">==</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">null</span>
    <span style="color:rgb(0,0,0);">)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">throw</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;ArgumentNullException(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">path</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;<img src="https://www.cnblogs.com/Images/dot.gif" style="border:0px;" alt="dot.gif">);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;}</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>要</em></strong><em>在属性的设置方法中，以</em><em>value</em><em>作为隐式值参数的名字。</em></p> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">public</span>
    <span style="color:rgb(0,0,0);">&nbsp;FileAttributes&nbsp;Attributes<br> &nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">set</span>
    <span style="color:rgb(0,0,0);"><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">if</span>
    <span style="color:rgb(0,0,0);">&nbsp;(value&nbsp;</span>
    <span style="color:rgb(0,0,0);">==</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">null</span>
    <span style="color:rgb(0,0,0);">)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">throw</span>
    <span style="color:rgb(0,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">new</span>
    <span style="color:rgb(0,0,0);">&nbsp;ArgumentNullException(</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">value</span>
    <span style="color:rgb(0,0,0);">"</span>
    <span style="color:rgb(0,0,0);">,&nbsp;<img src="https://www.cnblogs.com/Images/dot.gif" style="border:0px;" alt="dot.gif">);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp;&nbsp;&nbsp;&nbsp;}</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">×&nbsp;<strong><em>不要</em></strong><em>让公用的</em><em>API</em><em>抛出这些异常。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">抛出这些异常会暴露实现细节，而细节可能会随时间变化。</p> 
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">另外，不要显式地抛出StackOverflowException、OutOfMemeryException、ComException、SEHException异常，应该只有CLR才能抛出这些异常。&nbsp;</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong style="color:rgb(80,91,255);">7</strong><strong><span style="line-height:1.8;color:rgb(80,91,255);">、性能方面的考虑</span></strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">我们在使用异常时常常会产生性能方面的顾虑，在调试的时候感觉尤其明显。这样的顾虑合情合理。当成员抛出异常时，对性能的影响将是指数级的。当遵循前面的规范，我们仍有可能获得良好的性能。本节推荐两种模式。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>7.1 Tester-Doer&nbsp;</strong><strong>模式</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">有时候，我们可以把抛出异常的成员分解为两个成员，这样就能提高该成员的性能。下面看看ICollection&lt;T&gt;接口的Add方法。</p> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">ICollection</span>
    <span style="color:rgb(0,0,0);">&lt;</span>
    <span style="color:rgb(0,0,255);">int</span>
    <span style="color:rgb(0,0,0);">&gt;</span>
    <span style="color:rgb(0,0,0);">&nbsp;numbers&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;…<br><br> numbers.Add(</span>
    <span style="color:rgb(0,0,0);">1</span>
    <span style="color:rgb(0,0,0);">);&nbsp;</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">如果集合是只读的，那么Add方法会抛出异常。在Add方法经常会失败的场景中，这可能会引起性能问题。缓解问题的方法之一是在调用Add方法前，检查集合是否可写。</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <span style="color:rgb(0,0,0);">ICollection</span>
    <span style="color:rgb(0,0,0);">&lt;</span>
    <span style="color:rgb(0,0,255);">int</span>
    <span style="color:rgb(0,0,0);">&gt;</span>
    <span style="color:rgb(0,0,0);">&nbsp;numbers&nbsp;</span>
    <span style="color:rgb(0,0,0);">=</span>
    <span style="color:rgb(0,0,0);">&nbsp;…<br> …<br></span>
    <span style="color:rgb(0,0,255);">if</span>
    <span style="color:rgb(0,0,0);">(</span>
    <span style="color:rgb(0,0,0);">!</span>
    <span style="color:rgb(0,0,0);">numbers.IsReadOnly)<br> {<br> numbers.Add(</span>
    <span style="color:rgb(0,0,0);">1</span>
    <span style="color:rgb(0,0,0);">);<br> }</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">用来对条件进行测试的成员成为tester，这里就是IsReadOnly属性；用来执行实际操作并可能抛出异常的成员成为doer，这里就是Add方法。</span> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>在方法中使用</em><em>Test-Doer</em><em>模式来避免因异常而引发的性能问题，如果该方法在普通的场景中都可能会抛出异常（引发异常的频率较高）。</em></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">前提是<strong>”test”</strong><strong>操作要远比”do”</strong><strong>操作快</strong>。另外要注意，在多线程访问一个对象时会有危险性。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>7.2 Try-Parse&nbsp;</strong><strong>模式</strong></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">与Tester-Doer 模式相比，Try-Parse 模式甚至更快，应在那些对性能要求极高的API中使用。该模式对成员的名字进行调整，使成员的语义包含一个预先定义号的测试。例如，DateTime定义了一个Parse方法，如果解析字符串失败，那么它会抛出异常，同时还提供了一个与之对应的TryParse方法，在解析失败时会返回false，成功时则通过一个输出参数来返回结果。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">使用这个模式时注意，如果因为try操作之外的原因导致（方法）操作失败，仍应抛出异常。</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">√&nbsp;<strong><em>考虑</em></strong><em>在方法中使用Try-Parse</em><em>模式</em><em>来避免因异常而引发的性能问题，如果该方法在普通的场景中都可能会抛出异常。<br></em></p> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><br></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">参考：<br> &nbsp;《.NET 框架程序设计》－Jeffery Richter<br> &nbsp;《.NET 设计规范》－Krzysztof Cwalina, Brad Abrams&nbsp;<br> &nbsp;《Visual C＃ 2005 Recipes》－Allen Jones, Matthew MacDonald</p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><br></p> 
   <p style="line-height:1.8;"><font color="#333333"><span style="font-size:14px;">本文转自一个程序员的自省博客园博客，原文链接：http://www.cnblogs.com/anderslly/archive/2007/03/15/understandingexception2.html，如需转载请自行联系原作者。</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
