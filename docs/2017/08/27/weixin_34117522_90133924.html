<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Android -- Context « NotBeCN</title>
  <meta name="description" content="                             Context基本概念&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/08/27/weixin_34117522_90133924.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Android -- Context</h1>
    <p class="post-meta">Aug 27, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div>
    <br>
   </div> 
   <div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:large;">Context基本概念&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><span style="color:rgb(255,255,255);font-size:medium;"><strong>Context是什么?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></span></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">1) Context是一个抽象类，其通用实现在ContextImpl类中。</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">2) Context：是一个访问application环境全局信息的接口，通过它可以访问application的资源和相关的类，其主要功能如下：</p> 
    <ul style="color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">
     <li style="list-style-type:disc;">启动Activity</li> 
     <li style="list-style-type:disc;">启动和停止Service</li> 
     <li style="list-style-type:disc;">发送广播消息(Intent)</li> 
     <li style="list-style-type:disc;">注册广播消息(Intent)接收者</li> 
     <li style="list-style-type:disc;">可以访问APK中各种资源(如Resources和AssetManager等)</li> 
     <li style="list-style-type:disc;">可以访问Package的相关信息</li> 
     <li style="list-style-type:disc;">APK的各种权限管理</li> 
    </ul>
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">从以上分析可以看出，Context就是一个对APK包无所不知的大管家，大家需要什么，直接问它就可以了。</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">Context与View的关系&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">View与Context(或Activity)的关系类似于明星与经纪人的关系，所以创建View时，必须明确指定其Context(即经纪人或大管家)，否则View就成不了明星。</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">Context家族关系&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><a href="https://images0.cnblogs.com/blog/587773/201408/021116030711285.jpg" rel="nofollow" style="color:rgb(153,153,153);text-decoration:none;"><img title="1" src="https://images0.cnblogs.com/blog/587773/201408/021116038218655.jpg" alt="1" width="580" height="430" style="border:0px;background-image:none;"></a></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">Context关键函数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span><span style="line-height:1.5;"> Context {

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 获取应用程序包的AssetManager实例</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> AssetManager getAssets();
 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 获取应用程序包的Resources实例</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Resources getResources();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 获取PackageManager实例，以查看全局package信息    </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> PackageManager getPackageManager();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 获取应用程序包的ContentResolver实例</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> ContentResolver getContentResolver();
    
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 它返回当前进程的主线程的Looper，此线程分发调用给应用组件(activities, services等)</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Looper getMainLooper();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回当前进程的单实例全局Application对象的Context     </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Context getApplicationContext();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 从string表中获取本地化的、格式化的字符序列</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> CharSequence getText(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> resId) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> getResources().getText(resId);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 从string表中获取本地化的字符串</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> String getString(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> resId) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> getResources().getString(resId);
    }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> String getString(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> resId, Object... formatArgs) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> getResources().getString(resId, formatArgs);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回一个可用于获取包中类信息的class loader</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> ClassLoader getClassLoader();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回应用程序包名</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> String getPackageName();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回应用程序信息</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> ApplicationInfo getApplicationInfo();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 根据文件名获取SharedPreferences</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> SharedPreferences getSharedPreferences(String name,
            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> mode);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 其根目录为: Environment.getExternalStorageDirectory()</span>
    <span style="color:rgb(0,128,0);line-height:1.5;">/*</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * @param type The type of files directory to return.  May be null for
     * the root of the files directory or one of
     * the following Environment constants for a subdirectory:
     * {@link android.os.Environment#DIRECTORY_MUSIC},
     * {@link android.os.Environment#DIRECTORY_PODCASTS},
     * {@link android.os.Environment#DIRECTORY_RINGTONES},
     * {@link android.os.Environment#DIRECTORY_ALARMS},
     * {@link android.os.Environment#DIRECTORY_NOTIFICATIONS},
     * {@link android.os.Environment#DIRECTORY_PICTURES}, or
     * {@link android.os.Environment#DIRECTORY_MOVIES}.    
    </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> File getExternalFilesDir(String type);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回应用程序obb文件路径</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> File getObbDir();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 启动一个新的activity </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivity(Intent intent);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 启动一个新的activity </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivityAsUser(Intent intent, UserHandle user) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> RuntimeException("Not implemented. Must override in a subclass."<span style="line-height:1.5;">);
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 启动一个新的activity 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> intent: 将被启动的activity的描述信息
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> options: 描述activity将如何被启动</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivity(Intent intent, Bundle options);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 启动多个新的activity</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivities(Intent[] intents);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 启动多个新的activity</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivities(Intent[] intents, Bundle options);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 广播一个intent给所有感兴趣的接收者，异步机制 </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendBroadcast(Intent intent);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 广播一个intent给所有感兴趣的接收者，异步机制 </span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendBroadcast(Intent intent,String receiverPermission);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendOrderedBroadcast(Intent intent,String receiverPermission);
 
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendOrderedBroadcast(Intent intent,
            String receiverPermission, BroadcastReceiver resultReceiver,
            Handler scheduler, </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> initialCode, String initialData,
            Bundle initialExtras);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendBroadcastAsUser(Intent intent, UserHandle user);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> sendBroadcastAsUser(Intent intent, UserHandle user,
            String receiverPermission);
  
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 注册一个BroadcastReceiver，且它将在主activity线程中运行</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Intent registerReceiver(BroadcastReceiver receiver,
                                            IntentFilter filter);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Intent registerReceiver(BroadcastReceiver receiver,
            IntentFilter filter, String broadcastPermission, Handler scheduler);

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> unregisterReceiver(BroadcastReceiver receiver);
 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 请求启动一个application service</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> ComponentName startService(Intent service);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 请求停止一个application service</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> stopService(Intent service);
 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 连接一个应用服务，它定义了application和service间的依赖关系</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> bindService(Intent service, ServiceConnection conn,
            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> flags);

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 断开一个应用服务，当服务重新开始时，将不再接收到调用， 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 且服务允许随时停止</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> unbindService(ServiceConnection conn);
 

    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回系统级service句柄</span>
    <span style="color:rgb(0,128,0);line-height:1.5;">/*</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * @see #WINDOW_SERVICE
     * @see android.view.WindowManager
     * @see #LAYOUT_INFLATER_SERVICE
     * @see android.view.LayoutInflater
     * @see #ACTIVITY_SERVICE
     * @see android.app.ActivityManager
     * @see #POWER_SERVICE
     * @see android.os.PowerManager
     * @see #ALARM_SERVICE
     * @see android.app.AlarmManager
     * @see #NOTIFICATION_SERVICE
     * @see android.app.NotificationManager
     * @see #KEYGUARD_SERVICE
     * @see android.app.KeyguardManager
     * @see #LOCATION_SERVICE
     * @see android.location.LocationManager
     * @see #SEARCH_SERVICE
     * @see android.app.SearchManager
     * @see #SENSOR_SERVICE
     * @see android.hardware.SensorManager
     * @see #STORAGE_SERVICE
     * @see android.os.storage.StorageManager
     * @see #VIBRATOR_SERVICE
     * @see android.os.Vibrator
     * @see #CONNECTIVITY_SERVICE
     * @see android.net.ConnectivityManager
     * @see #WIFI_SERVICE
     * @see android.net.wifi.WifiManager
     * @see #AUDIO_SERVICE
     * @see android.media.AudioManager
     * @see #MEDIA_ROUTER_SERVICE
     * @see android.media.MediaRouter
     * @see #TELEPHONY_SERVICE
     * @see android.telephony.TelephonyManager
     * @see #INPUT_METHOD_SERVICE
     * @see android.view.inputmethod.InputMethodManager
     * @see #UI_MODE_SERVICE
     * @see android.app.UiModeManager
     * @see #DOWNLOAD_SERVICE
     * @see android.app.DownloadManager
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Object getSystemService(String name);
 
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span> checkPermission(String permission, <span style="color:rgb(0,0,255);line-height:1.5;">int</span> pid, <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> uid);
 
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回一个新的与application name对应的Context对象</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Context createPackageContext(String packageName,
            </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> flags) <span style="color:rgb(0,0,255);line-height:1.5;">throws</span><span style="line-height:1.5;"> PackageManager.NameNotFoundException;
    
    </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 返回基于当前Context对象的新对象，其资源与display相匹配</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">abstract</span><span style="line-height:1.5;"> Context createDisplayContext(Display display);
 }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">ContextImpl关键成员和函数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
 * Common implementation of Context API, which provides the base
 * context object for Activity and other application components.
 </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);line-height:1.5;">class</span> ContextImpl <span style="color:rgb(0,0,255);line-height:1.5;">extends</span><span style="line-height:1.5;"> Context {
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> String TAG = "ContextImpl"<span style="line-height:1.5;">;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">boolean</span> DEBUG = <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">static</span> <span style="color:rgb(0,0,255);line-height:1.5;">final</span> HashMap&lt;String, SharedPreferencesImpl&gt; sSharedPrefs =
            <span style="color:rgb(0,0,255);line-height:1.5;">new</span> HashMap&lt;String, SharedPreferencesImpl&gt;<span style="line-height:1.5;">();

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/*</span><span style="color:rgb(0,128,0);line-height:1.5;">package</span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span> LoadedApk mPackageInfo; <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 关键数据成员</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> String mBasePackageName;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Resources mResources;
    </span><span style="color:rgb(0,128,0);line-height:1.5;">/*</span><span style="color:rgb(0,128,0);line-height:1.5;">package</span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span> ActivityThread mMainThread; <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 主线程</span>
<span style="line-height:1.5;">
    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> AssetManager getAssets() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> getResources().getAssets();
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Looper getMainLooper() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mMainThread.getLooper();
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Object getSystemService(String name) {
        ServiceFetcher fetcher </span>=<span style="line-height:1.5;"> SYSTEM_SERVICE_MAP.get(name);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> fetcher == <span style="color:rgb(0,0,255);line-height:1.5;">null</span> ? <span style="color:rgb(0,0,255);line-height:1.5;">null</span> : fetcher.getService(<span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivity(Intent intent, Bundle options) {
        warnIfCallingFromSystemProcess();
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == 0<span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> AndroidRuntimeException(
                    </span>"Calling startActivity() from outside of an Activity "
                    + " context requires the FLAG_ACTIVITY_NEW_TASK flag."
                    + " Is this really what you want?"<span style="line-height:1.5;">);
        }
        mMainThread.getInstrumentation().execStartActivity(
            getOuterContext(), mMainThread.getApplicationThread(), </span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">,
            (Activity)</span><span style="color:rgb(0,0,255);line-height:1.5;">null</span>, intent, -1<span style="line-height:1.5;">, options);
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">ContextWrapper&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">它只是对Context类的一种封装，它的构造函数包含了一个真正的Context引用，即ContextImpl对象。</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
 * Proxying implementation of Context that simply delegates all of its calls to
 * another Context.  Can be subclassed to modify behavior without changing
 * the original Context.
 </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> ContextWrapper <span style="color:rgb(0,0,255);line-height:1.5;">extends</span><span style="line-height:1.5;"> Context {
    Context mBase; </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">该属性指向一个ContextIml实例</span>

    <span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> ContextWrapper(Context base) {
        mBase </span>=<span style="line-height:1.5;"> base;
    }

    </span><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
     * Set the base context for this ContextWrapper.  All calls will then be
     * delegated to the base context.  Throws
     * IllegalStateException if a base context has already been set.
     * 
     * </span><span style="color:rgb(128,128,128);line-height:1.5;">@param</span><span style="color:rgb(0,128,0);line-height:1.5;"> base The new base context for this wrapper.
     * 创建Application、Service、Activity，会调用该方法给mBase属性赋值
     </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
    <span style="color:rgb(0,0,255);line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> attachBaseContext(Context base) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (mBase != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span> IllegalStateException("Base context already set"<span style="line-height:1.5;">);
        }
        mBase </span>=<span style="line-height:1.5;"> base;
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Looper getMainLooper() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mBase.getMainLooper();
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Object getSystemService(String name) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mBase.getSystemService(name);
    }

    @Override
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> startActivity(Intent intent) {
        mBase.startActivity(intent);
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">ContextThemeWrapper&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">该类内部包含了主题(Theme)相关的接口，即android:theme属性指定的。只有Activity需要主题，Service不需要主题，所以Service直接继承于ContextWrapper类。</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">/**</span><span style="color:rgb(0,128,0);line-height:1.5;">
 * A ContextWrapper that allows you to modify the theme from what is in the 
 * wrapped context. 
 </span><span style="color:rgb(0,128,0);line-height:1.5;">*/</span>
<span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span> ContextThemeWrapper <span style="color:rgb(0,0,255);line-height:1.5;">extends</span><span style="line-height:1.5;"> ContextWrapper {
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Context mBase;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> mThemeResource;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Resources.Theme mTheme;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> LayoutInflater mInflater;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Configuration mOverrideConfiguration;
    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Resources mResources;

    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> ContextThemeWrapper() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">super</span>(<span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">);
    }
    
    </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> ContextThemeWrapper(Context base, <span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> themeres) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">super</span><span style="line-height:1.5;">(base);
        mBase </span>=<span style="line-height:1.5;"> base;
        mThemeResource </span>=<span style="line-height:1.5;"> themeres;
    }

    @Override </span><span style="color:rgb(0,0,255);line-height:1.5;">protected</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> attachBaseContext(Context newBase) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">super</span><span style="line-height:1.5;">.attachBaseContext(newBase);
        mBase </span>=<span style="line-height:1.5;"> newBase;
    }

    @Override </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span> setTheme(<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> resid) {
        mThemeResource </span>=<span style="line-height:1.5;"> resid;
        initializeTheme();
    }

    @Override </span><span style="color:rgb(0,0,255);line-height:1.5;">public</span><span style="line-height:1.5;"> Resources.Theme getTheme() {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (mTheme != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mTheme;
        }

        mThemeResource </span>=<span style="line-height:1.5;"> Resources.selectDefaultTheme(mThemeResource,
                getApplicationInfo().targetSdkVersion);
        initializeTheme();

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mTheme;
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><span style="color:rgb(255,255,255);font-size:large;"><strong>何时创建Context&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></span></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">应用程序在以下几种情况下创建Context实例：</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">1) 创建Application 对象时， 而且整个App共一个Application对象</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">2) 创建Service对象时</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">3) 创建Activity对象时</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">因此应用程序App共有的Context数目公式为：</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">总Context实例个数 = Service个数 + Activity个数 + 1（Application对应的Context实例）</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">ActivityThread消息处理函数与本节相关的内容如下：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> handleMessage(Message msg) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (DEBUG_MESSAGES) Slog.v(TAG, "&gt;&gt;&gt; handling: " +<span style="line-height:1.5;"> codeToString(msg.what));
            </span><span style="color:rgb(0,0,255);line-height:1.5;">switch</span><span style="line-height:1.5;"> (msg.what) {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">case</span> LAUNCH_ACTIVITY: { <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建Activity对象</span>
                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "activityStart"<span style="line-height:1.5;">);
                    ActivityClientRecord r </span>=<span style="line-height:1.5;"> (ActivityClientRecord)msg.obj;

                    r.packageInfo </span>=<span style="line-height:1.5;"> getPackageInfoNoCheck(
                            r.activityInfo.applicationInfo, r.compatInfo);
                    handleLaunchActivity(r, </span><span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">);
                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
                } </span><span style="color:rgb(0,0,255);line-height:1.5;">break</span><span style="line-height:1.5;">;

                </span><span style="color:rgb(0,0,255);line-height:1.5;">case</span> BIND_APPLICATION: <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建Application对象</span>
                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "bindApplication"<span style="line-height:1.5;">);
                    AppBindData data </span>=<span style="line-height:1.5;"> (AppBindData)msg.obj;
                    handleBindApplication(data);
                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">break</span><span style="line-height:1.5;">;
        
                </span><span style="color:rgb(0,0,255);line-height:1.5;">case</span> CREATE_SERVICE: <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建Service对象</span>
                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "serviceCreate"<span style="line-height:1.5;">);
                    handleCreateService((CreateServiceData)msg.obj);
                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">break</span><span style="line-height:1.5;">;
                    
                </span><span style="color:rgb(0,0,255);line-height:1.5;">case</span> BIND_SERVICE:  <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> Bind Service对象</span>
                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "serviceBind"<span style="line-height:1.5;">);
                    handleBindService((BindServiceData)msg.obj);
                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">break</span><span style="line-height:1.5;">;
            }
        }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">创建Application对象时创建Context实例&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">每个应用程序在第一次启动时，都会首先创建一个Application对象。从startActivity流程可知，创建Application的时机在handleBindApplication()方法中，该函数位于 ActivityThread.java类中 ，相关代码如下：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> ActivityThread.java</span>
   <span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> handleBindApplication(AppBindData data) { 
      </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> If the app is being launched for full backup or restore, bring it up in
            </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> a restricted environment with the base application class.</span>
            Application app = data.info.makeApplication(data.restrictedBackupMode, <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">);
            mInitialApplication </span>=<span style="line-height:1.5;"> app;
            ...
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">finally</span><span style="line-height:1.5;"> {
            StrictMode.setThreadPolicy(savedPolicy);
        }
   }

   </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> LoadedApk.java</span>
   <span style="color:rgb(0,0,255);line-height:1.5;">public</span> Application makeApplication(<span style="color:rgb(0,0,255);line-height:1.5;">boolean</span><span style="line-height:1.5;"> forceDefaultAppClass,
            Instrumentation instrumentation) {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (mApplication != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> mApplication;
        }

        Application app </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;

        String appClass </span>=<span style="line-height:1.5;"> mApplicationInfo.className;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (forceDefaultAppClass || (appClass == <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">)) {
            appClass </span>= "android.app.Application"<span style="line-height:1.5;">;
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            java.lang.ClassLoader cl </span>=<span style="line-height:1.5;"> getClassLoader();
            ContextImpl appContext </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> ContextImpl(); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建ContextImpl实例</span>
            appContext.init(<span style="color:rgb(0,0,255);line-height:1.5;">this</span>, <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">, mActivityThread);
            app </span>=<span style="line-height:1.5;"> mActivityThread.mInstrumentation.newApplication(
                    cl, appClass, appContext);
            appContext.setOuterContext(app); </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 将Application实例传递给Context实例</span>
        } <span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (Exception e) {
            ...
        }
        mActivityThread.mAllApplications.add(app);
        mApplication </span>=<span style="line-height:1.5;"> app;

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> app;
    }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">创建Activity对象时创建Context实例&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">通过startActivity()或startActivityForResult()请求启动一个Activity时，如果系统检测需要新建一个Activity对象时，就会回调handleLaunchActivity()方法，该方法继而调用performLaunchActivity()方法，去创建一个Activity实例，并且回调onCreate()，onStart()方法等，函数都位于 ActivityThread.java类 ，相关代码如下：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> handleLaunchActivity(ActivityClientRecord r, Intent customIntent) {
        ...
        Activity a </span>= performLaunchActivity(r, customIntent); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 到下一步</span>

        <span style="color:rgb(0,0,255);line-height:1.5;">if</span> (a != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
            r.createdConfig </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Configuration(mConfiguration);
            Bundle oldState </span>=<span style="line-height:1.5;"> r.state;
            handleResumeActivity(r.token, </span><span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">, r.isForward,
                    </span>!r.activity.mFinished &amp;&amp; !<span style="line-height:1.5;">r.startsNotResumed);
            ...
        }
        ...
     }

    </span><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {
        ...    
        Activity activity </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            java.lang.ClassLoader cl </span>=<span style="line-height:1.5;"> r.packageInfo.getClassLoader();
            activity </span>=<span style="line-height:1.5;"> mInstrumentation.newActivity(
                    cl, component.getClassName(), r.intent);
            StrictMode.incrementExpectedActivityCount(activity.getClass());
            r.intent.setExtrasClassLoader(cl);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (r.state != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
                r.state.setClassLoader(cl);
            }
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (Exception e) {
            ...
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            Application app </span>= r.packageInfo.makeApplication(<span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">, mInstrumentation);

            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (activity != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
                Context appContext </span>= createBaseContextForActivity(r, activity); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建Context</span>
                CharSequence title =<span style="line-height:1.5;"> r.activityInfo.loadLabel(appContext.getPackageManager());
                Configuration config </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> Configuration(mCompatConfiguration);
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (DEBUG_CONFIGURATION) Slog.v(TAG, "Launching activity "
                        + r.activityInfo.name + " with config " +<span style="line-height:1.5;"> config);
                activity.attach(appContext, </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">, getInstrumentation(), r.token,
                        r.ident, app, r.intent, r.activityInfo, title, r.parent,
                        r.embeddedID, r.lastNonConfigurationInstances, config);

                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (customIntent != <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">) {
                    activity.mIntent </span>=<span style="line-height:1.5;"> customIntent;
                }
                r.lastNonConfigurationInstances </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
                activity.mStartedActivity </span>= <span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">;
                </span><span style="color:rgb(0,0,255);line-height:1.5;">int</span> theme =<span style="line-height:1.5;"> r.activityInfo.getThemeResource();
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (theme != 0<span style="line-height:1.5;">) {
                    activity.setTheme(theme);
                }


            mActivities.put(r.token, r);

        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (SuperNotCalledException e) {
            ...

        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (Exception e) {
            ...
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> activity;
    }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">private</span><span style="line-height:1.5;"> Context createBaseContextForActivity(ActivityClientRecord r,
            </span><span style="color:rgb(0,0,255);line-height:1.5;">final</span><span style="line-height:1.5;"> Activity activity) {
        ContextImpl appContext </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> ContextImpl();  <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建ContextImpl实例</span>
        appContext.init(r.packageInfo, r.token, <span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);
        appContext.setOuterContext(activity);

        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> For debugging purposes, if the activity's package name contains the value of
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> the "debug.use-second-display" system property as a substring, then show
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> its content on a secondary display if there is one.</span>
        Context baseContext =<span style="line-height:1.5;"> appContext;
        String pkgName </span>= SystemProperties.get("debug.second-display.pkg"<span style="line-height:1.5;">);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (pkgName != <span style="color:rgb(0,0,255);line-height:1.5;">null</span> &amp;&amp; !<span style="line-height:1.5;">pkgName.isEmpty()
                </span>&amp;&amp;<span style="line-height:1.5;"> r.packageInfo.mPackageName.contains(pkgName)) {
            DisplayManagerGlobal dm </span>=<span style="line-height:1.5;"> DisplayManagerGlobal.getInstance();
            </span><span style="color:rgb(0,0,255);line-height:1.5;">for</span> (<span style="color:rgb(0,0,255);line-height:1.5;">int</span><span style="line-height:1.5;"> displayId : dm.getDisplayIds()) {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (displayId !=<span style="line-height:1.5;"> Display.DEFAULT_DISPLAY) {
                    Display display </span>=<span style="line-height:1.5;"> dm.getRealDisplay(displayId);
                    baseContext </span>=<span style="line-height:1.5;"> appContext.createDisplayContext(display);
                    </span><span style="color:rgb(0,0,255);line-height:1.5;">break</span><span style="line-height:1.5;">;
                }
            }
        }
        </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span><span style="line-height:1.5;"> baseContext;
    }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:medium;">创建Service对象时创建Context实例&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">通过startService或者bindService时，如果系统检测到需要新创建一个Service实例，就会回调handleCreateService()方法，完成相关数据操作。handleCreateService()函数位于 ActivityThread.java类，如下：</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-size:15px;font-family:'Courier New';"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">private</span> <span style="color:rgb(0,0,255);line-height:1.5;">void</span><span style="line-height:1.5;"> handleCreateService(CreateServiceData data) {
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> If we are getting ready to gc after going to the background, well
        </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> we are back active so skip it.</span>
<span style="line-height:1.5;">        unscheduleGcIdler();

        LoadedApk packageInfo </span>=<span style="line-height:1.5;"> getPackageInfoNoCheck(
                data.info.applicationInfo, data.compatInfo);
        Service service </span>= <span style="color:rgb(0,0,255);line-height:1.5;">null</span><span style="line-height:1.5;">;
        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            java.lang.ClassLoader cl </span>=<span style="line-height:1.5;"> packageInfo.getClassLoader();
            service </span>=<span style="line-height:1.5;"> (Service) cl.loadClass(data.info.name).newInstance();
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (Exception e) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (!<span style="line-height:1.5;">mInstrumentation.onException(service, e)) {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> RuntimeException(
                    </span>"Unable to instantiate service " +<span style="line-height:1.5;"> data.info.name
                    </span>+ ": " +<span style="line-height:1.5;"> e.toString(), e);
            }
        }

        </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (localLOGV) Slog.v(TAG, "Creating service " +<span style="line-height:1.5;"> data.info.name);

            ContextImpl context </span>= <span style="color:rgb(0,0,255);line-height:1.5;">new</span> ContextImpl(); <span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> 创建ContextImpl实例</span>
            context.init(packageInfo, <span style="color:rgb(0,0,255);line-height:1.5;">null</span>, <span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">);

            Application app </span>= packageInfo.makeApplication(<span style="color:rgb(0,0,255);line-height:1.5;">false</span><span style="line-height:1.5;">, mInstrumentation);
            context.setOuterContext(service);
            service.attach(context, </span><span style="color:rgb(0,0,255);line-height:1.5;">this</span><span style="line-height:1.5;">, data.info.name, data.token, app,
                    ActivityManagerNative.getDefault());
            service.onCreate();
            mServices.put(data.token, service);
            </span><span style="color:rgb(0,0,255);line-height:1.5;">try</span><span style="line-height:1.5;"> {
                ActivityManagerNative.getDefault().serviceDoneExecuting(
                        data.token, </span>0, 0, 0<span style="line-height:1.5;">);
            } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (RemoteException e) {
                </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;"> nothing to do.</span>
<span style="line-height:1.5;">            }
        } </span><span style="color:rgb(0,0,255);line-height:1.5;">catch</span><span style="line-height:1.5;"> (Exception e) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (!<span style="line-height:1.5;">mInstrumentation.onException(service, e)) {
                </span><span style="color:rgb(0,0,255);line-height:1.5;">throw</span> <span style="color:rgb(0,0,255);line-height:1.5;">new</span><span style="line-height:1.5;"> RuntimeException(
                    </span>"Unable to create service " +<span style="line-height:1.5;"> data.info.name
                    </span>+ ": " +<span style="line-height:1.5;"> e.toString(), e);
            }
        }
    }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="font-size:12px;line-height:1.5;"><a title="复制代码" style="color:rgb(153,153,153);border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:large;">小结&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">通过对ContextImp的分析可知，其方法的大多数操作都是直接调用其属性mPackageInfo(该属性类型为PackageInfo)的相关方法而来。这说明ContextImp是一种轻量级类，而PackageInfo才是真正重量级的类。而一个App里的所有ContextImpl实例，都对应同一个packageInfo对象。</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;"><strong><span style="color:rgb(255,255,255);font-size:large;">我是天王盖地虎的分割线&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></strong></p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">&nbsp;</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">&nbsp;</p> 
    <p style="line-height:24px;color:rgb(153,153,153);font-family:'Comic Sans MS', '微软雅黑', '宋体', Arial;font-size:15px;">&nbsp;</p> 
    <p style="line-height:24px;"><font color="#999999"><span style="font-size:15px;"><br></span></font></p> 
    <p style="line-height:24px;"><font color="#999999"><span style="font-size:15px;"><br></span></font></p> 
    <p style="line-height:24px;"><font color="#999999"><span style="font-size:15px;"><br></span></font></p> 
    <p style="line-height:24px;"><font color="#999999"><span style="font-size:15px;">本文转自我爱物联网博客园博客，原文链接：http://www.cnblogs.com/yydcdut/p/3886648.html，如需转载请自行联系原作者</span></font></p> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
