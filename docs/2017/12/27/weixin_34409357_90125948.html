<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux下进程描述（1）—进程控制块【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://www.cnblogs.com/33debug/p/6705391.html    进程概念介绍    &nbsp; &nbsp;进程是操作系统对运行程序的一种抽象。    • 一个正在执行的程序；    • 一个正在计算机上执行的程序实例；    • 能分配给处理器...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/27/weixin_34409357_90125948.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux下进程描述（1）—进程控制块【转】</h1>
    <p class="post-meta">Dec 27, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">转自：<a href="http://www.cnblogs.com/33debug/p/6705391.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://www.cnblogs.com/33debug/p/6705391.html</a></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';font-size:18px;"><strong>进程概念介绍</strong></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">&nbsp; &nbsp;<span style="font-family:'Microsoft YaHei';">进程是操作系统对运行程序的一种抽象。</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">• 一个正在执行的程序；</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">• 一个正在计算机上执行的程序实例；</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">• 能分配给处理器并由处理器执行的实体；</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">• 一个具有普以下特征的活动单元：一组指令序列的执行、一个当前状态和相关的系统资源集。</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">内核观点：担当分配系统资源（CPU时间，内存）的实体。进程的两个基本元素：程序代码（可能被执行的其他进程共享）、数据集。进程是一种动态描述，但是并不代表所有的进程都在运行。（进程在内存中因策略或调度需求，会处于各种状态）&nbsp;进程是处于执行期的程序以及它所管理的资源（如打开的文件、挂起的信号、进程状态、地址空间等等）的总称。注意，程序并不是进程，实际上两个或多个进程不仅有可能执行同一程序，而且还有可能共享地址空间等资源。<br><span style="font-size:18px;"><strong>进程描述</strong></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><span>&nbsp; &nbsp;⼴义上，所有的进程信息被放在⼀个叫做进程控制块的数据结构中，可以理解为进程属性的集合，该控制块由操作系统创建和管理。<strong><br></strong><span style="font-size:16px;">进程控制块</span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">进程控制块是操作系统能够支持多线程和提供多重处理技术的关键工具。每个进程在内核中都有⼀个进程控制块(PCB)来维护进程相关的信息,Linux内核的 进程控制块是task_struct结构体。现在我们全⾯了解⼀下其中都有哪些信息。 在Linux中，这个结构叫做task_struct。task_struct是Linux内核的⼀种数据结构，它会被装载到RAM⾥并且包含着进程的信息。每个进程都把它的信息放在 task_struct 这个数据结构⾥，并且可以在 include/linux/sched.h ⾥找到它。所有运⾏在系统⾥的进程都以 task_struct 链表的形式存在内核⾥。task_struct 包含了这些内容<br> 1、进程标⽰符（PID）：描述本进程的唯⼀标⽰符，⽤来区别其他进程。⽗进程id（PPID）</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">1  pid_t pid;   <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">这个是进程号 <span style="color:rgb(0,128,128);line-height:1.5;">2 pid_t tgid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">这个是进程组号 <span style="color:rgb(0,128,128);line-height:1.5;">3 pid_t Uid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">用户标识符 <span style="color:rgb(0,128,128);line-height:1.5;">4 pid_t Euid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">有效用户标识符 <span style="color:rgb(0,128,128);line-height:1.5;">5 pid_t egid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">有效组标识符 <span style="color:rgb(0,128,128);line-height:1.5;">6 pid_t Suid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">备份用户标识符 <span style="color:rgb(0,128,128);line-height:1.5;">7 pid_t sgid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">备份组标识符 <span style="color:rgb(0,128,128);line-height:1.5;">8 pid_t Fsuid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">文件系统用户标识符 <span style="color:rgb(0,128,128);line-height:1.5;">9 pid_t fsgid; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">文件系统组标识符</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';line-height:1.5;">在CONFIG_BASE_SMALL配置为0的情况下，PID的取值范围是0到32767，即系统中的进程数最大为32768个。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/include/linux/threads.h <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">2 <span style="color:rgb(0,0,255);line-height:1.5;">#define PID_MAX_DEFAULT (CONFIG_BASE_SMALL ? 0x1000 :0x8000)</span></span></span></span></span></span></pre>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">&nbsp;&nbsp;<span style="font-family:'Microsoft YaHei';">&nbsp;<span>在Linux系统中，一个线程组中的所有线程使用和该线程组的领头线程（该组中的第一个轻量级进程）相同的PID，并被存放在tgid成员中。只有线程组的领头线程的pid成员才会被设置为与tgid相同的值。注意，getpid()系统调用返回的是当前进程的tgid值而不是pid值。</span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">2、进程状态 ： 任务状态，退出代码，退出信号等。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1   <span style="color:rgb(0,0,255);line-height:1.5;">volatile <span style="line-height:1.5;">long<span style="color:rgb(0,0,0);line-height:1.5;"> state; <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> exit_state; <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">state成员的可能取值如下：<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_RUNNING 0 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">TASK_RUNNING表示进程要么正在执行，要么正要准备执行。 <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_INTERRUPTIBLE 1 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">TASK_INTERRUPTIBLE表示进程被阻塞（睡眠），直到某个条件变为真。条件一旦达成，进程的状态就被设置为TASK_RUNNING。 <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_UNINTERRUPTIBLE 2 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">TASK_UNINTERRUPTIBLE的意义与TASK_INTERRUPTIBLE类似，除了不能通过接受一个信号来唤醒以外。 <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,255);line-height:1.5;">#define __TASK_STOPPED 4 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> __TASK_STOPPED表示进程被停止执行。 <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">#define __TASK_TRACED 8 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">__TASK_TRACED表示进程被debugger等进程监视。 <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> in tsk-&gt;exit_state <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">#define EXIT_ZOMBIE 16 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">EXIT_ZOMBIE表示进程的执行被终止，但是其父进程还没有使用wait()等系统调用来获知它的终止信息。 <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,255);line-height:1.5;">#define EXIT_DEAD 32 EXIT_DEAD表示进程的最终状态。 <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> in tsk-&gt;state again <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_DEAD 64 <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_WAKEKILL 128 <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">#define TASK_WAKING 256 <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">EXIT_ZOMBIE和EXIT_DEAD也可以存放在exit_state成员中。<span style="line-height:1.5;">*/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">&nbsp; &nbsp;&nbsp;<span style="font-family:'Microsoft YaHei';">volatile这个关键词是告诉编译器不要对其优化，编译器有一个缓存优化的习惯，比如说，第一次在内存取数，编译器发现后面还要用这个变量，于是把这个变量的值就放在寄存器中。这个关键词就是要求编译器不要优化，每次都让CPU去内存取数。以确保状态的变化能及时地反映上来。</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">3、进程调度（优先级 ： 相对于其他进程的优先级。）</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> prio;static_prio, normal_prio; <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">prio用于保存动态优先级。 <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;">static_prio用于保存静态优先级，可以通过nice系统调用来进行修改。<br> normal_prio的值取决于静态优先级和调度策略。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 4 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int rt_priority; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">表示此进程的运行优先级 <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,255);line-height:1.5;">const <span style="line-height:1.5;">struct sched_class *sched_class; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> sched_class结构体表示调度类 <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> sched_entity se; <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> sched_rt_entity rt; <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">se和rt都是调用实体，一个用于普通进程，一个用于实时进程，每个进程都有其中之一的实体。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int policy; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> policy表示进程的调度策略 <span style="color:rgb(0,128,128);line-height:1.5;">10 cpumask_t cpus_allowed;<span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> cpus_allowed用于控制进程可以在哪里处理器上运行。 <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> policy表示进程的调度策略，目前主要有以下五种： <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,255);line-height:1.5;">#define SCHED_NORMAL 0 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">SCHED_NORMAL用于普通进程，通过CFS调度器实现。 <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,255);line-height:1.5;">#define SCHED_FIFO 1 <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">#define SCHED_RR 2 <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> SCHED_FIFO（先入先出调度算法）和SCHED_RR（轮流调度算法）都是实时调度策略。 <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">#define SCHED_BATCH 3 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">SCHED_BATCH用于非交互的处理器消耗型进程。 <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> SCHED_ISO: reserved but not implemented yet <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">#define SCHED_IDLE 5 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">SCHED_IDLE是在系统负载很低时使用。 <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">sched_class结构体表示调度类，目前内核中有实现以下四种： <span style="color:rgb(0,128,128);line-height:1.5;">20 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/kernel/sched_fair.c <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">21 <span style="color:rgb(0,0,255);line-height:1.5;">static <span style="line-height:1.5;">const <span style="line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> sched_class fair_sched_class; <span style="color:rgb(0,128,128);line-height:1.5;">22 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/kernel/sched_rt.c <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">23 <span style="color:rgb(0,0,255);line-height:1.5;">static <span style="line-height:1.5;">const <span style="line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> sched_class rt_sched_class; <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/kernel/sched_idletask.c <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="color:rgb(0,0,255);line-height:1.5;">static <span style="line-height:1.5;">const <span style="line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> sched_class idle_sched_class; <span style="color:rgb(0,128,128);line-height:1.5;">26 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/kernel/sched_stoptask.c <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,255);line-height:1.5;">static <span style="line-height:1.5;">const <span style="line-height:1.5;">struct sched_class stop_sched_class; </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">&nbsp;实时优先级范围是0到MAX_RT_PRIO-1（即99），而普通进程的静态优先级范围是从MAX_RT_PRIO到MAX_PRIO-1（即100到139）。值越大静态优先级越低。</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">4、表示进程亲属关系的成员</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">&nbsp;在Linux系统中，所有进程之间都有着直接或间接地联系，每个进程都有其父进程，也可能有零个或多个子进程。拥有同一父进程的所有进程具有兄弟关系。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">1 <span style="color:rgb(0,0,255);line-height:1.5;">struct task_struct *real_parent; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> real parent process ，real_parent指向其父进程，如果创建它的父进程不再存在，则指向PID为1的init进程。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">2 <span style="color:rgb(0,0,255);line-height:1.5;">struct task_struct *parent; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> recipient of SIGCHLD, wait4() reports， parent指向其父进程，当它终止时，必须向它的父进程发送信号。它的值通常与real_parent相同。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">3 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head children; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> list of my children， children表示链表的头部，链表中的所有元素都是它的子进程。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">4 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head sibling; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linkage in my parent's children list， sibling用于把当前进程插入到兄弟链表中。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">5 <span style="color:rgb(0,0,255);line-height:1.5;">struct task_struct *group_leader; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> threadgroup leader ，group_leader指向其所在进程组的领头进程。<span style="line-height:1.5;">*/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">&nbsp;&nbsp;<span style="font-family:'Microsoft YaHei';">&nbsp;可以用下面这些通俗的关系来理解它们：real_parent是该进程的”亲生父亲“，不管其是否被“寄养”；parent是该进程现在的父进程，有可能是”继父“；这里children指的是该进程孩子的链表，可以得到所有孩子的进程描述符，但是需使用list_for_each和list_entry，list_entry其实直接使用了container_of，同理，sibling该进程兄弟的链表，也就是其父亲的所有孩子的链表。用法与children相似；struct task_struct *group_leader这个是主线程的进程描述符，也许你会奇怪，为什么线程用进程描述符表示，因为linux并没有单独实现线程的相关结构体，只是用一个进程来代替线程，然后对其做一些特殊的处理；struct list_head thread_group;这个是该进程所有线程的链表。</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">5、进程标记</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">&nbsp; &nbsp;反应进程状态的信息，但不是运行状态，用于内核识别进程当前的状态，以备下一步操作</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int flags; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> per process flags, defined below <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> flags成员的可能取值如下： <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_KSOFTIRQD 0x00000001 /* I am ksoftirqd */ <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_STARTING 0x00000002 /* being created */ <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_EXITING 0x00000004 /* getting shut down */ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_EXITPIDONE 0x00000008 /* pi exit done on shut down */ <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_VCPU 0x00000010 /* I'm a virtual CPU */ <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_WQ_WORKER 0x00000020 /* I'm a workqueue worker */ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FORKNOEXEC 0x00000040 /* forked but didn't exec */ <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_MCE_PROCESS 0x00000080 /* process policy on mce errors */ <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_SUPERPRIV 0x00000100 /* used super-user privileges */ <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_DUMPCORE 0x00000200 /* dumped core */ <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_SIGNALED 0x00000400 /* killed by a signal */ <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_MEMALLOC 0x00000800 /* Allocating memory */ <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_USED_MATH 0x00002000 /* if unset the fpu must be initialized before use */ <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FREEZING 0x00004000 /* freeze in progress. do not account to load */ <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_NOFREEZE 0x00008000 /* this thread should not be frozen */ <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FROZEN 0x00010000 /* frozen for system suspend */ <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FSTRANS 0x00020000 /* inside a filesystem transaction */ <span style="color:rgb(0,128,128);line-height:1.5;">20 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_KSWAPD 0x00040000 /* I am kswapd */ <span style="color:rgb(0,128,128);line-height:1.5;">21 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_OOM_ORIGIN 0x00080000 /* Allocating much memory to others */ <span style="color:rgb(0,128,128);line-height:1.5;">22 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_LESS_THROTTLE 0x00100000 /* Throttle me less: I clean memory */ <span style="color:rgb(0,128,128);line-height:1.5;">23 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_KTHREAD 0x00200000 /* I am a kernel thread */ <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_RANDOMIZE 0x00400000 /* randomize virtual address space */ <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_SWAPWRITE 0x00800000 /* Allowed to write to swap */ <span style="color:rgb(0,128,128);line-height:1.5;">26 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_SPREAD_PAGE 0x01000000 /* Spread page cache over cpuset */ <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_SPREAD_SLAB 0x02000000 /* Spread some slab caches over cpuset */ <span style="color:rgb(0,128,128);line-height:1.5;">28 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_THREAD_BOUND 0x04000000 /* Thread bound to specific cpu */ <span style="color:rgb(0,128,128);line-height:1.5;">29 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_MCE_EARLY 0x08000000 /* Early kill for mce process policy */ <span style="color:rgb(0,128,128);line-height:1.5;">30 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_MEMPOLICY 0x10000000 /* Non-default NUMA mempolicy */ <span style="color:rgb(0,128,128);line-height:1.5;">31 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_MUTEX_TESTER 0x20000000 /* Thread belongs to the rt mutex tester */ <span style="color:rgb(0,128,128);line-height:1.5;">32 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FREEZER_SKIP 0x40000000 /* Freezer should not count it as freezable */ <span style="color:rgb(0,128,128);line-height:1.5;">33 <span style="color:rgb(0,0,255);line-height:1.5;">#define PF_FREEZER_NOSIG 0x80000000 /* Freezer won't send signals to it */ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">6、进程内核栈</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">进程通过alloc_thread_info函数分配它的内核栈，通过free_thread_info函数释放所分配的内核栈。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 <span style="color:rgb(0,0,255);line-height:1.5;">void *<span style="color:rgb(0,0,0);line-height:1.5;">stack; <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;">// <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/kernel/fork.c <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">struct thread_info *alloc_thread_info(<span style="line-height:1.5;">struct task_struct *<span style="color:rgb(0,0,0);line-height:1.5;">tsk) <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_DEBUG_STACK_USAGE <span style="color:rgb(0,128,128);line-height:1.5;"> 7 gfp_t mask = GFP_KERNEL |<span style="color:rgb(0,0,0);line-height:1.5;"> __GFP_ZERO; <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,255);line-height:1.5;">#else <span style="color:rgb(0,128,128);line-height:1.5;"> 9 gfp_t mask =<span style="color:rgb(0,0,0);line-height:1.5;"> GFP_KERNEL; <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">return (<span style="line-height:1.5;">struct thread_info *<span style="color:rgb(0,0,0);line-height:1.5;">)__get_free_pages(mask, THREAD_SIZE_ORDER); <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void free_thread_info(<span style="line-height:1.5;">struct thread_info *<span style="color:rgb(0,0,0);line-height:1.5;">ti) <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">15 free_pages((unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long<span style="color:rgb(0,0,0);line-height:1.5;">)ti, THREAD_SIZE_ORDER); <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">其中，THREAD_SIZE_ORDER宏在linux-2.6.38.8/arch/arm/include/asm/thread_info.h文件中被定义为1，也就是说alloc_thread_info函数通过调用__get_free_pages函数分配2个页的内存（它的首地址是8192字节对齐的）。 <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="line-height:1.5;">19 <span style="color:rgb(0,128,0);line-height:1.5;"> Linux内核通过thread_union联合体来表示进程的内核栈，其中THREAD_SIZE宏的大小为8192。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">20 <span style="color:rgb(0,0,0);line-height:1.5;">union thread_union { <span style="color:rgb(0,128,128);line-height:1.5;">21 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> thread_info thread_info; <span style="color:rgb(0,128,128);line-height:1.5;">22 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long stack[THREAD_SIZE/<span style="line-height:1.5;">sizeof(<span style="line-height:1.5;">long<span style="color:rgb(0,0,0);line-height:1.5;">)]; <span style="color:rgb(0,128,128);line-height:1.5;">23 <span style="color:rgb(0,0,0);line-height:1.5;">}; <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">当进程从用户态切换到内核态时，进程的内核栈总是空的，所以ARM的sp寄存器指向这个栈的顶端。因此，内核能够轻易地通过sp寄存器获得当前正在CPU上运行的进程。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/arch/arm/include/asm/current.h <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">26 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">struct task_struct *get_current(<span style="line-height:1.5;">void<span style="color:rgb(0,0,0);line-height:1.5;">) <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">28 <span style="color:rgb(0,0,255);line-height:1.5;">return current_thread_info()-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">task; <span style="color:rgb(0,128,128);line-height:1.5;">29 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">30 <span style="line-height:1.5;">31 <span style="color:rgb(0,0,255);line-height:1.5;">#define current (get_current()) <span style="color:rgb(0,128,128);line-height:1.5;">32 <span style="line-height:1.5;">33 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/arch/arm/include/asm/thread_info.h <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">34 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">struct thread_info *current_thread_info(<span style="line-height:1.5;">void<span style="color:rgb(0,0,0);line-height:1.5;">) <span style="color:rgb(0,128,128);line-height:1.5;">35 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">36 register unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long sp asm (<span style="color:rgb(128,0,0);line-height:1.5;">"<span style="line-height:1.5;">sp<span style="line-height:1.5;">"<span style="color:rgb(0,0,0);line-height:1.5;">); <span style="color:rgb(0,128,128);line-height:1.5;">37 <span style="color:rgb(0,0,255);line-height:1.5;">return (<span style="line-height:1.5;">struct thread_info *)(sp &amp; ~(THREAD_SIZE - <span style="color:rgb(128,0,128);line-height:1.5;">1<span style="color:rgb(0,0,0);line-height:1.5;">)); <span style="color:rgb(0,128,128);line-height:1.5;">38 } </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">下图中显示了在物理内存中存放两种数据结构的方式。线程描述符驻留与这个内存区的开始，而栈顶末端向下增长。<img src="https://images2015.cnblogs.com/blog/1069650/201704/1069650-20170413204934501-1029527576.png" alt="" style="border:none;"><span>在这个图中，esp寄存器是CPU栈指针，用来存放栈顶单元的地址。在80x86系统中，栈起始于顶端，并朝着这个内存区开始的方向增长。从用户态刚切换到内核态以后，进程的内核栈总是空的。因此，esp寄存器指向这个栈的顶端。一旦数据写入堆栈，esp的值就递减。</span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">7、ptrace系统调用&nbsp;</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> ptrace; <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head ptraced; <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head ptrace_entry; <span style="color:rgb(0,128,128);line-height:1.5;"> 4 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long<span style="color:rgb(0,0,0);line-height:1.5;"> ptrace_message; <span style="color:rgb(0,128,128);line-height:1.5;"> 5 siginfo_t *last_siginfo; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> For ptrace use. <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,0);line-height:1.5;">ifdef CONFIG_HAVE_HW_BREAKPOINT <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,0);line-height:1.5;">atomic_t ptrace_bp_refcnt; <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,0);line-height:1.5;">endif <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">成员ptrace被设置为0时表示不需要被跟踪，它的可能取值如下：<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> linux-2.6.38.8/include/linux/ptrace.h <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_PTRACED 0x00000001 <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_DTRACE 0x00000002 /* delayed trace (used on m68k, i386) */ <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACESYSGOOD 0x00000004 <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_PTRACE_CAP 0x00000008 /* ptracer can follow suid-exec */ <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_FORK 0x00000010 <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_VFORK 0x00000020 <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_CLONE 0x00000040 <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_EXEC 0x00000080 <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_VFORK_DONE 0x00000100 <span style="color:rgb(0,128,128);line-height:1.5;">20 <span style="color:rgb(0,0,255);line-height:1.5;">#define PT_TRACE_EXIT 0x00000200 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><span style="line-height:1.5;">8、<span style="line-height:1.5;">Performance Event&nbsp;</span></span></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">Performance Event是一款随 Linux 内核代码一同发布和维护的性能诊断工具。这些成员用于帮助PerformanceEvent分析进程的性能问题。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">1 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_PERF_EVENTS <span style="color:rgb(0,128,128);line-height:1.5;">2 <span style="color:rgb(0,0,255);line-height:1.5;">struct perf_event_context *<span style="color:rgb(0,0,0);line-height:1.5;">perf_event_ctxp[perf_nr_task_contexts]; <span style="color:rgb(0,128,128);line-height:1.5;">3 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> mutex perf_event_mutex; <span style="color:rgb(0,128,128);line-height:1.5;">4 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head perf_event_list; <span style="color:rgb(0,128,128);line-height:1.5;">5 <span style="color:rgb(0,0,255);line-height:1.5;">#endif </span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">9、判断标志</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> exit_code, exit_signal; <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">exit_code用于设置进程的终止代号，这个值要么是_exit()或exit_group()系统调用参数（正常终止），要么是由内核提供的一个错误代号（异常终止）。 <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;">exit_signal被置为-1时表示是某个线程组中的一员。只有当线程组的最后一个成员终止时，才会产生一个信号，以通知线程组的领头进程的父进程。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,0,255);line-height:1.5;">int pdeath_signal; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> The signal sent when the parent dies <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> pdeath_signal用于判断父进程终止时发送信号。 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int personality; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> personality用于处理不同的ABI <span style="color:rgb(0,128,128);line-height:1.5;"> 7 unsigned did_exec:<span style="color:rgb(128,0,128);line-height:1.5;">1; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> did_exec用于记录进程代码是否被execve()函数所执行。 <span style="color:rgb(0,128,128);line-height:1.5;"> 8 unsigned in_execve:<span style="color:rgb(128,0,128);line-height:1.5;">1; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> Tell the LSMs that the process is doing an * execve <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> in_execve用于通知LSM是否被do_execve()函数所调用。 <span style="color:rgb(0,128,128);line-height:1.5;">10 unsigned in_iowait:<span style="color:rgb(128,0,128);line-height:1.5;">1; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> in_iowait用于判断是否进行iowait计数。 <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> Revert to default priority/policy when forking <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">12 unsigned sched_reset_on_fork:<span style="color:rgb(128,0,128);line-height:1.5;">1; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> sched_reset_on_fork用于判断是否恢复默认的优先级或调度策略。 <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> personality用于处理不同的ABI，它的可能取值如下： <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">enum<span style="color:rgb(0,0,0);line-height:1.5;"> { <span style="color:rgb(0,128,128);line-height:1.5;">15 PER_LINUX = <span style="color:rgb(128,0,128);line-height:1.5;">0x0000<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">16 PER_LINUX_32BIT = <span style="color:rgb(128,0,128);line-height:1.5;">0x0000 |<span style="color:rgb(0,0,0);line-height:1.5;"> ADDR_LIMIT_32BIT, <span style="color:rgb(0,128,128);line-height:1.5;">17 PER_LINUX_FDPIC = <span style="color:rgb(128,0,128);line-height:1.5;">0x0000 |<span style="color:rgb(0,0,0);line-height:1.5;"> FDPIC_FUNCPTRS, <span style="color:rgb(0,128,128);line-height:1.5;">18 PER_SVR4 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0001 | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> MMAP_PAGE_ZERO, <span style="color:rgb(0,128,128);line-height:1.5;">19 PER_SVR3 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0002 | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> SHORT_INODE, <span style="color:rgb(0,128,128);line-height:1.5;">20 PER_SCOSVR3 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0003 | STICKY_TIMEOUTS | <span style="color:rgb(0,128,128);line-height:1.5;">21 WHOLE_SECONDS |<span style="color:rgb(0,0,0);line-height:1.5;"> SHORT_INODE, <span style="color:rgb(0,128,128);line-height:1.5;">22 PER_OSR5 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0003 | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> WHOLE_SECONDS, <span style="color:rgb(0,128,128);line-height:1.5;">23 PER_WYSEV386 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0004 | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> SHORT_INODE, <span style="color:rgb(0,128,128);line-height:1.5;">24 PER_ISCR4 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0005 |<span style="color:rgb(0,0,0);line-height:1.5;"> STICKY_TIMEOUTS, <span style="color:rgb(0,128,128);line-height:1.5;">25 PER_BSD = <span style="color:rgb(128,0,128);line-height:1.5;">0x0006<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">26 PER_SUNOS = <span style="color:rgb(128,0,128);line-height:1.5;">0x0006 |<span style="color:rgb(0,0,0);line-height:1.5;"> STICKY_TIMEOUTS, <span style="color:rgb(0,128,128);line-height:1.5;">27 PER_XENIX = <span style="color:rgb(128,0,128);line-height:1.5;">0x0007 | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> SHORT_INODE, <span style="color:rgb(0,128,128);line-height:1.5;">28 PER_LINUX32 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0008<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">29 PER_LINUX32_3GB = <span style="color:rgb(128,0,128);line-height:1.5;">0x0008 |<span style="color:rgb(0,0,0);line-height:1.5;"> ADDR_LIMIT_3GB, <span style="color:rgb(0,128,128);line-height:1.5;">30 PER_IRIX32 = <span style="color:rgb(128,0,128);line-height:1.5;">0x0009 | STICKY_TIMEOUTS,<span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> IRIX5 32-bit <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">31 PER_IRIXN32 = <span style="color:rgb(128,0,128);line-height:1.5;">0x000a | STICKY_TIMEOUTS,<span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> IRIX6 new 32-bit <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">32 PER_IRIX64 = <span style="color:rgb(128,0,128);line-height:1.5;">0x000b | STICKY_TIMEOUTS,<span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> IRIX6 64-bit <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">33 PER_RISCOS = <span style="color:rgb(128,0,128);line-height:1.5;">0x000c<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">34 PER_SOLARIS = <span style="color:rgb(128,0,128);line-height:1.5;">0x000d |<span style="color:rgb(0,0,0);line-height:1.5;"> STICKY_TIMEOUTS, <span style="color:rgb(0,128,128);line-height:1.5;">35 PER_UW7 = <span style="color:rgb(128,0,128);line-height:1.5;">0x000e | STICKY_TIMEOUTS |<span style="color:rgb(0,0,0);line-height:1.5;"> MMAP_PAGE_ZERO, <span style="color:rgb(0,128,128);line-height:1.5;">36 PER_OSF4 = <span style="color:rgb(128,0,128);line-height:1.5;">0x000f, <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> OSF/1 v4 <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">37 PER_HPUX = <span style="color:rgb(128,0,128);line-height:1.5;">0x0010<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">38 PER_MASK = <span style="color:rgb(128,0,128);line-height:1.5;">0x00ff<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">39 }; </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <pre><span style="font-family:'Microsoft YaHei';">当一个进程通过exit()结束进程后，会变成一个僵尸进程，<br><span> 僵尸进程几乎释放了其他所有的资源，但PCB没有释放，其中PCB中的这个字段就是记录退出的退出码。<br><span>10、时间</span></span></span></pre> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 cputime_t utime, stime, utimescaled, stimescaled;  <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> utime/stime用于记录进程在用户态/内核态下所经过的节拍数（定时器）。 utimescaled/stimescaled也是用于记录进程在用户态/内核态的运行时间，但它们以处理器的频率为刻度。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 2 cputime_t gtime; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> gtime是以节拍计数的虚拟机运行时间（guest time）。 <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,0,0);line-height:1.5;">#ifndef CONFIG_VIRT_CPU_ACCOUNTING <span style="color:rgb(0,128,128);line-height:1.5;"> 4 cputime_t prev_utime, prev_stime; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">prev_utime/prev_stime是先前的运行时间 <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 6 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long nvcsw, nivcsw; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> context switch counts <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">nvcsw/nivcsw是自愿（voluntary）/非自愿（involuntary）上下文切换计数。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,255);line-height:1.5;">struct timespec start_time; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> monotonic time <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">struct timespec real_start_time; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> boot based time <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">start_time和real_start_time都是进程创建时间，real_start_time还包含了进程睡眠时间，常用于/proc/pid/stat<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">struct task_cputime cputime_expires; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">cputime_expires用来统计进程或进程组被跟踪的处理器时间，其中的三个成员对应着cpu_timers[3]的三个链表。 <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head cpu_timers[<span style="color:rgb(128,0,128);line-height:1.5;">3<span style="color:rgb(0,0,0);line-height:1.5;">]; <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_DETECT_HUNG_TASK <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> hung task detection <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">15 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long last_switch_count; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">last_switch_count是nvcsw和nivcsw的总和。 <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">#endif </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">11、进程地址空间</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">1  <span style="color:rgb(0,0,255);line-height:1.5;">struct mm_struct *mm, *<span style="color:rgb(0,0,0);line-height:1.5;">active_mm; <span style="color:rgb(0,128,128);line-height:1.5;">2 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> mm指向进程所拥有的内存描述符，而active_mm指向进程运行时所使用的内存描述符。对于普通进程而言，这两个指针变量的值相同。但是，内核线程不拥有任何内存描述符，所以它们的mm成员总是为NULL。当内核线程得以运行时，它的active_mm成员被初始化为前一个运行进程的active_mm值。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">3 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_COMPAT_BRK <span style="color:rgb(0,128,128);line-height:1.5;">4 unsigned brk_randomized:<span style="color:rgb(128,0,128);line-height:1.5;">1; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> brk_randomized 用来确定对随机堆内存的探测。 <span style="color:rgb(0,128,128);line-height:1.5;">5 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;">6 <span style="color:rgb(0,0,255);line-height:1.5;">#if defined(SPLIT_RSS_COUNTING) <span style="color:rgb(0,128,128);line-height:1.5;">7 <span style="color:rgb(0,0,255);line-height:1.5;">struct task_rss_stat rss_stat; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> rss_stat用来记录缓冲信息。 <span style="color:rgb(0,128,128);line-height:1.5;">8 <span style="color:rgb(0,0,255);line-height:1.5;">#endif </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">12、信号处理</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;"> 1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> signal handlers <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,0,255);line-height:1.5;">struct signal_struct *signal; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">signal指向进程的信号描述符。 <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,0,255);line-height:1.5;">struct sighand_struct *<span style="color:rgb(0,0,0);line-height:1.5;">sighand; sighand指向进程的信号处理程序描述符。 <span style="color:rgb(0,128,128);line-height:1.5;"> 4 sigset_t blocked, real_blocked; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">blocked表示被阻塞信号的掩码，real_blocked表示临时掩码。 <span style="color:rgb(0,128,128);line-height:1.5;"> 5 sigset_t saved_sigmask; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> restored if set_restore_sigmask() was used <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">struct sigpending pending; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">pending存放私有挂起信号的数据结构。 <span style="color:rgb(0,128,128);line-height:1.5;"> 7 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long sas_ss_sp; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">sas_ss_sp是信号处理程序备用堆栈的地址，sas_ss_size表示堆栈的大小。 <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,0);line-height:1.5;"> size_t sas_ss_size; <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">int (*notifier)(<span style="line-height:1.5;">void *<span style="color:rgb(0,0,0);line-height:1.5;">priv); <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,255);line-height:1.5;">void *<span style="color:rgb(0,0,0);line-height:1.5;">notifier_data; <span style="color:rgb(0,128,128);line-height:1.5;">11 sigset_t *<span style="color:rgb(0,0,0);line-height:1.5;">notifier_mask; <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">设备驱动程序常用notifier指向的函数来阻塞进程的某些信号（notifier_mask是这些信号的位掩码），notifier_data指的是notifier所指向的函数可能使用的数据。<span style="line-height:1.5;">*/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">13、其他</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="color:rgb(0,128,128);font-family:'Courier New';line-height:1.5;">  1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> Protection of (de-)allocation: mm, files, fs, tty, keyrings, mems_allowed, <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;"> * mempolicy <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 3 spinlock_t alloc_lock; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">用于保护资源分配或释放的自旋锁 <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="line-height:1.5;"> 5 atomic_t usage; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">进程描述符使用计数，被置为2时，表示进程描述符正在被使用而且其相应的进程处于活动状态。 <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">int lock_depth; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> BKL lock depth 用于表示获取大内核锁的次数，如果进程未获得过锁，则置为-1。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="line-height:1.5;"> 9 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_SMP <span style="color:rgb(0,128,128);line-height:1.5;"> 10 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef __ARCH_WANT_UNLOCKED_CTXSW <span style="color:rgb(0,128,128);line-height:1.5;"> 11 <span style="color:rgb(0,0,255);line-height:1.5;">int oncpu; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">在SMP上帮助实现无加锁的进程切换（unlocked context switches） <span style="color:rgb(0,128,128);line-height:1.5;"> 12 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 13 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 14 <span style="line-height:1.5;"> 15 <span style="color:rgb(0,0,0);line-height:1.5;"> #ifdef CONFIG_PREEMPT_NOTIFIERS <span style="color:rgb(0,128,128);line-height:1.5;"> 16 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> list of struct preempt_notifier: <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 17 <span style="color:rgb(0,0,255);line-height:1.5;">struct hlist_head preempt_notifiers; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">preempt_notifier结构体链表 <span style="color:rgb(0,128,128);line-height:1.5;"> 18 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 19 <span style="line-height:1.5;"> 20 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">char fpu_counter; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">FPU使用计数 <span style="color:rgb(0,128,128);line-height:1.5;"> 21 <span style="line-height:1.5;"> 22 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_BLK_DEV_IO_TRACE <span style="color:rgb(0,128,128);line-height:1.5;"> 23 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">int btrace_seq; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">blktrace是一个针对Linux内核中块设备I/O层的跟踪工具。 <span style="color:rgb(0,128,128);line-height:1.5;"> 24 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 25 <span style="line-height:1.5;"> 26 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_PREEMPT_RCU <span style="color:rgb(0,128,128);line-height:1.5;"> 27 <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> rcu_read_lock_nesting; <span style="color:rgb(0,128,128);line-height:1.5;"> 28 <span style="color:rgb(0,0,255);line-height:1.5;">char<span style="color:rgb(0,0,0);line-height:1.5;"> rcu_read_unlock_special; <span style="color:rgb(0,128,128);line-height:1.5;"> 29 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head rcu_node_entry; <span style="color:rgb(0,128,128);line-height:1.5;"> 30 <span style="color:rgb(0,0,255);line-height:1.5;">#endif /* #ifdef CONFIG_PREEMPT_RCU */ <span style="color:rgb(0,128,128);line-height:1.5;"> 31 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_TREE_PREEMPT_RCU <span style="color:rgb(0,128,128);line-height:1.5;"> 32 <span style="color:rgb(0,0,255);line-height:1.5;">struct rcu_node *<span style="color:rgb(0,0,0);line-height:1.5;">rcu_blocked_node; <span style="color:rgb(0,128,128);line-height:1.5;"> 33 <span style="color:rgb(0,0,255);line-height:1.5;">#endif /* #ifdef CONFIG_TREE_PREEMPT_RCU */ <span style="color:rgb(0,128,128);line-height:1.5;"> 34 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_RCU_BOOST <span style="color:rgb(0,128,128);line-height:1.5;"> 35 <span style="color:rgb(0,0,255);line-height:1.5;">struct rt_mutex *<span style="color:rgb(0,0,0);line-height:1.5;">rcu_boost_mutex; <span style="color:rgb(0,128,128);line-height:1.5;"> 36 <span style="color:rgb(0,0,255);line-height:1.5;">#endif /* #ifdef CONFIG_RCU_BOOST */ <span style="color:rgb(0,128,128);line-height:1.5;"> 37 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">RCU同步原语 <span style="color:rgb(0,128,128);line-height:1.5;"> 38 <span style="line-height:1.5;"> 39 <span style="color:rgb(0,0,255);line-height:1.5;">#if defined(CONFIG_SCHEDSTATS) || defined(CONFIG_TASK_DELAY_ACCT) <span style="color:rgb(0,128,128);line-height:1.5;"> 40 <span style="color:rgb(0,0,255);line-height:1.5;">struct sched_info sched_info; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">用于调度器统计进程的运行信息 <span style="color:rgb(0,128,128);line-height:1.5;"> 41 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 42 <span style="line-height:1.5;"> 43 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head tasks; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> 用于构建进程链表 <span style="color:rgb(0,128,128);line-height:1.5;"> 44 <span style="line-height:1.5;"> 45 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_SMP <span style="color:rgb(0,128,128);line-height:1.5;"> 46 <span style="color:rgb(0,0,255);line-height:1.5;">struct plist_node pushable_tasks; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">to limit pushing to one attempt <span style="color:rgb(0,128,128);line-height:1.5;"> 47 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 48 <span style="line-height:1.5;"> 49 <span style="color:rgb(0,0,0);line-height:1.5;">#ifdef CONFIG_CC_STACKPROTECTOR <span style="color:rgb(0,128,128);line-height:1.5;"> 50 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> Canary value for the -fstack-protector gcc feature <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 51 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long stack_canary; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;"> 在GCC编译内核时，需要加上-fstack-protector选项。 <span style="color:rgb(0,128,128);line-height:1.5;"> 52 <span style="color:rgb(0,0,255);line-height:1.5;">#endif <span style="color:rgb(0,128,128);line-height:1.5;"> 53 <span style="line-height:1.5;"> 54 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> PID/PID hash table linkage. <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 55 <span style="color:rgb(0,0,255);line-height:1.5;">struct pid_link pids[PIDTYPE_MAX]; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">PID散列表和链表 <span style="color:rgb(0,128,128);line-height:1.5;"> 56 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head thread_group; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">线程组中所有进程的链表 <span style="color:rgb(0,128,128);line-height:1.5;"> 57 <span style="line-height:1.5;"> 58 <span style="color:rgb(0,0,255);line-height:1.5;">struct completion *vfork_done; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> for vfork() <span style="line-height:1.5;">*/ <span style="line-height:1.5;">//<span style="line-height:1.5;">do_fork函数 <span style="color:rgb(0,128,128);line-height:1.5;"> 59 <span style="color:rgb(0,0,255);line-height:1.5;">int __user *set_child_tid; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> CLONE_CHILD_SETTID <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 60 <span style="color:rgb(0,0,255);line-height:1.5;">int __user *clear_child_tid; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> CLONE_CHILD_CLEARTID <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 61 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">在执行do_fork()时，如果给定特别标志，则vfork_done会指向一个特殊地址. 如果copy_process函数的clone_flags参数的值被置为CLONE_CHILD_SETTID或CLONE_CHILD_CLEARTID，则会把child_tidptr参数的值分别复制到set_child_tid和clear_child_tid成员。这些标志说明必须改变子进程用户态地址空间的child_tidptr所指向的变量的值。<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 62 <span style="line-height:1.5;"> 63 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> mm fault and swap info: this can arguably be seen as either mm-specific or thread-specific <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 64 unsigned <span style="color:rgb(0,0,255);line-height:1.5;">long min_flt, maj_flt;<span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">缺页统计 <span style="color:rgb(0,128,128);line-height:1.5;"> 65 <span style="line-height:1.5;"> 66 <span style="color:rgb(0,0,255);line-height:1.5;">const <span style="line-height:1.5;">struct cred __rcu *real_cred; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> objective and real subjective task <span style="color:rgb(0,128,128);line-height:1.5;"> 67 <span style="color:rgb(0,128,0);line-height:1.5;"> * credentials (COW) <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 68 <span style="color:rgb(0,0,255);line-height:1.5;">const <span style="line-height:1.5;">struct cred __rcu *cred; <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> effective (overridable) subjective task <span style="color:rgb(0,128,128);line-height:1.5;"> 69 <span style="color:rgb(0,128,0);line-height:1.5;"> * credentials (COW) <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 70 <span style="color:rgb(0,0,255);line-height:1.5;">struct cred *<span style="color:rgb(0,0,0);line-height:1.5;">replacement_session_keyring; <span style="color:rgb(0,128,128);line-height:1.5;"> 71 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;"> for KEYCTL_SESSION_TO_PARENT <span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 72 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">const struct cred __rcu *real_cred; /* objective and real subjective task <span style="color:rgb(0,128,128);line-height:1.5;"> 73 * credentials (COW) */ 74 const struct cred __rcu *cred; /* effective (overridable) subjective task 75 * credentials (COW) */ 76 struct cred *replacement_session_keyring; /* for KEYCTL_SESSION_TO_PARENT */ 77 const struct cred __rcu *real_cred; /* objective and real subjective task 78 * credentials (COW) */ 79 const struct cred __rcu *cred; /* effective (overridable) subjective task 80 * credentials (COW) */ 81 struct cred *replacement_session_keyring; /* for KEYCTL_SESSION_TO_PARENT */ 82 进程权能 83 84 char comm[TASK_COMM_LEN]; //相应的程序名 85 86 /* file system info */ 87 int link_count, total_link_count; 88 /* filesystem information */ 89 struct fs_struct *fs; //fs用来表示进程与文件系统的联系，包括当前目录和根目录。 90 /* open file information */ 91 struct files_struct *files; //files表示进程当前打开的文件。 92 //文件 93 94 #ifdef CONFIG_SYSVIPC 95 /* ipc stuff */ 96 struct sysv_sem sysvsem; 进程通信（SYSVIPC） 97 #endif 98 99 /* CPU-specific state of this task */ 100 struct thread_struct thread;//处理器特有数据 101 102 /* namespaces */ 103 struct nsproxy *nsproxy; //命名空间 104 105 /* namespaces */ 106 struct nsproxy *nsproxy; //命名空间 107 108 struct audit_context *audit_context; 109 #ifdef CONFIG_AUDITSYSCALL 110 uid_t loginuid; 111 unsigned int sessionid; 112 #endif 113 //进程审计 114 115 seccomp_t seccomp; //secure computing 116 117 /* Thread group tracking */ 118 u32 parent_exec_id; 119 u32 self_exec_id; 120 //用于copy_process函数使用CLONE_PARENT 标记时 121 122 //中断 123 #ifdef CONFIG_GENERIC_HARDIRQS 124 /* IRQ handler threads */ 125 struct irqaction *irqaction; 126 #endif 127 #ifdef CONFIG_TRACE_IRQFLAGS 128 unsigned int irq_events; 129 unsigned long hardirq_enable_ip; 130 unsigned long hardirq_disable_ip; 131 unsigned int hardirq_enable_event; 132 unsigned int hardirq_disable_event; 133 int hardirqs_enabled; 134 int hardirq_context; 135 unsigned long softirq_disable_ip; 136 unsigned long softirq_enable_ip; 137 unsigned int softirq_disable_event; 138 unsigned int softirq_enable_event; 139 int softirqs_enabled; 140 int softirq_context; 141 #endif 142 143 /* Protection of the PI data structures: */ 144 raw_spinlock_t pi_lock; //task_rq_lock函数所使用的锁 145 146 //基于PI协议的等待互斥锁，其中PI指的是priority inheritance（优先级继承） 147 #ifdef CONFIG_RT_MUTEXES 148 /* PI waiters blocked on a rt_mutex held by this task */ 149 struct plist_head pi_waiters; 150 /* Deadlock detection and priority inheritance handling */ 151 struct rt_mutex_waiter *pi_blocked_on; 152 #endif 153 154 #ifdef CONFIG_DEBUG_MUTEXES 155 /* mutex deadlock detection */ 156 struct mutex_waiter *blocked_on; //死锁检测 157 #endif 158 159 //lockdep，参见内核说明文档linux-2.6.38.8/Documentation/lockdep-design.txt 160 #ifdef CONFIG_LOCKDEP 161 # define MAX_LOCK_DEPTH 48UL 162 u64 curr_chain_key; 163 int lockdep_depth; 164 unsigned int lockdep_recursion; 165 struct held_lock held_locks[MAX_LOCK_DEPTH]; 166 gfp_t lockdep_reclaim_gfp; 167 #endif 168 169 /* journalling filesystem info */ 170 void *journal_info; //JFS文件系统 171 172 /* stacked block device info */ 173 struct bio_list *bio_list; //块设备链表 174 175 struct reclaim_state *reclaim_state; //内存回收 176 177 struct backing_dev_info *backing_dev_info; //存放块设备I/O数据流量信息 178 179 struct io_context *io_context; //I/O调度器所使用的信息 180 181 //记录进程的I/O计数 182 struct task_io_accounting ioac; 183 if defined(CONFIG_TASK_XACCT) 184 u64 acct_rss_mem1; /* accumulated rss usage */ 185 u64 acct_vm_mem1; /* accumulated virtual memory usage */ 186 cputime_t acct_timexpd; /* stime + utime since last update */ 187 endif 188 189 //CPUSET功能 190 #ifdef CONFIG_CPUSETS 191 nodemask_t mems_allowed; /* Protected by alloc_lock */ 192 int mems_allowed_change_disable; 193 int cpuset_mem_spread_rotor; 194 int cpuset_slab_spread_rotor; 195 #endif 196 197 //Control Groups 198 #ifdef CONFIG_CGROUPS 199 /* Control Group info protected by css_set_lock */ 200 struct css_set __rcu *cgroups; 201 /* cg_list protected by css_set_lock and tsk-&gt;alloc_lock */ 202 struct list_head cg_list; 203 #endif 204 #ifdef CONFIG_CGROUP_MEM_RES_CTLR /* memcg uses this to do batch job */ 205 struct memcg_batch_info { 206 int do_batch; /* incremented when batch uncharge started */ 207 struct mem_cgroup *memcg; /* target memcg of uncharge */ 208 unsigned long bytes; /* uncharged usage */ 209 unsigned long memsw_bytes; /* uncharged mem+swap usage */ 210 } memcg_batch; 211 #endif 212 213 //futex同步机制 214 #ifdef CONFIG_FUTEX 215 struct robust_list_head __user *robust_list; 216 #ifdef CONFIG_COMPAT 217 struct compat_robust_list_head __user *compat_robust_list; 218 #endif 219 struct list_head pi_state_list; 220 struct futex_pi_state *pi_state_cache; 221 #endif 222 223 //非一致内存访问（NUMA Non-Uniform Memory Access） 224 #ifdef CONFIG_NUMA 225 struct mempolicy *mempolicy; /* Protected by alloc_lock */ 226 short il_next; 227 #endif 228 229 atomic_t fs_excl; /* holding fs exclusive resources */ //文件系统互斥资源 230 231 struct rcu_head rcu; //RCU链表 232 233 struct pipe_inode_info *splice_pipe; //管道 234 235 #ifdef CONFIG_TASK_DELAY_ACCT 236 struct task_delay_info *delays; //延迟计数 237 #endif 238 239 #ifdef CONFIG_FAULT_INJECTION 240 int make_it_fail; //fault injection 241 #endif 242 243 struct prop_local_single dirties; //FLoating proportions 244 245 #ifdef CONFIG_LATENCYTOP 246 int latency_record_count; 247 struct latency_record latency_record[LT_SAVECOUNT]; 248 #endif //Infrastructure for displayinglatency 249 250 unsigned long timer_slack_ns; 251 unsigned long default_timer_slack_ns; 252 //time slack values，常用于poll和select函数 253 254 struct list_head *scm_work_list; //socket控制消息（control message） 255 256 //ftrace跟踪器 257 #ifdef CONFIG_FUNCTION_GRAPH_TRACER 258 /* Index of current stored address in ret_stack */ 259 int curr_ret_stack; 260 /* Stack of return addresses for return function tracing */ 261 struct ftrace_ret_stack *ret_stack; 262 /* time stamp for last schedule */ 263 unsigned long long ftrace_timestamp; 264 /* 265 * Number of functions that haven't been traced 266 * because of depth overrun. 267 */ 268 atomic_t trace_overrun; 269 /* Pause for the tracing */ 270 atomic_t tracing_graph_pause; 271 #endif 272 #ifdef CONFIG_TRACING 273 /* state flags for use by tracers */ 274 unsigned long trace; 275 /* bitmask of trace recursion */ 276 unsigned long trace_recursion; 277 #endif /* CONFIG_TRACING */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';">本文参考http://blog.csdn.net/npy_lp/article/details/7335187</span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><br></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><br></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><br></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><br></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"><br></span></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span style="font-family:'Microsoft YaHei';"></span></p> 
   <p><font color="#666666"><span style="font-size:14px;">本文转自张昺华-sky博客园博客，原文链接：http://www.cnblogs.com/sky-heaven/p/7111946.html</span></font><span style="font-size:14px;color:rgb(102,102,102);font-family:'Microsoft YaHei';">，如需转载请自行联系原作者</span></p> 
   <div>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
