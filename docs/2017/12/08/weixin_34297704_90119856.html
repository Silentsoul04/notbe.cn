<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ASP.NET Web API 应用教程（一） ——数据流使用 « NotBeCN</title>
  <meta name="description" content="                              &nbsp;      相信已经有很多文章来介绍ASP.Net Web API 技术，本系列文章主要介绍如何使用数据流，HTTPS，以及可扩展的Web API 方面的技术，系列文章主要有三篇内容。      主要内容如下：      I &nbsp;数据...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/08/weixin_34297704_90119856.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">ASP.NET Web API 应用教程（一） ——数据流使用</h1>
    <p class="post-meta">Dec 8, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="Blog_wz1"> 
    <div style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;line-height:24px;"> 
     <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/REST.png" alt="" style="border:0px;"></p> 
     <p>&nbsp;</p> 
     <p>相信已经有很多文章来介绍ASP.Net Web API 技术，本系列文章主要介绍如何使用数据流，HTTPS，以及可扩展的Web API 方面的技术，系列文章主要有三篇内容。</p> 
     <p>主要内容如下：</p> 
     <p>I &nbsp;数据流</p> 
     <p>II 使用HTTPS</p> 
     <p>III 可扩展的Web API 文档</p> 
     <p>&nbsp;</p> 
     <h2 style="font-size:21px;">项目环境要求</h2> 
     <ul style="list-style:none;">
      <li style="list-style:disc;">VS 2012（SP4）及以上，</li> 
      <li style="list-style:disc;">.Net 框架4.5.1</li> 
      <li style="list-style:disc;">Nuget包,可在packages.config 文件中查寻</li> 
     </ul>
     <h2 style="font-size:21px;"><strong>本文涉及的知识点</strong></h2> 
     <ol style="list-style:none;">
      <li style="list-style:decimal;">ActionFilter</li> 
      <li style="list-style:decimal;">AuthorizationFilter</li> 
      <li style="list-style:decimal;">DelegateHandler</li> 
      <li style="list-style:decimal;">Different Web API routing 属性</li> 
      <li style="list-style:decimal;">MediaTypeFormatter</li> 
      <li style="list-style:decimal;">OWIN</li> 
      <li style="list-style:decimal;">Self Hosting</li> 
      <li style="list-style:decimal;">Web API 文档及可扩展功能</li> 
     </ol>
     <p><strong>.Net 框架</strong></p> 
     <ol style="list-style:none;">
      <li style="list-style:decimal;">Async/Await</li> 
      <li style="list-style:decimal;">.NET reflection</li> 
      <li style="list-style:decimal;">Serialization</li> 
      <li style="list-style:decimal;">ASP.NET Web API/MVC Error handling</li> 
      <li style="list-style:decimal;">IIS ,HTTPS 及Certificate</li> 
      <li style="list-style:decimal;">设计准则及技术</li> 
     </ol>
     <p>前言</p> 
     <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Poster_Life_Cycle.png" alt="" style="border:0px;"></p> 
     <p>&nbsp;</p> 
     <p>自从ASP.NET MVC 4之后.Net 框架开始支持ASP.NET Web API ，ASP.NET Web API 基于HTTP 协议建立的，是构建 RESTful 服务和处理数据的理想平台，旨在使用HTTP 技术实现对多平台的支持。</p> 
     <p>ASP.NET Web API 以request-response 的消息转换模式为主，客户端向服务器发送请求，服务器端响应客户端请求。响应可同步或异步。</p> 
     <p>&nbsp;个人认为使用Web API创建应用需要注意的三个关键点：</p> 
     <ul style="list-style:none;">
      <li style="list-style:disc;">采用服务及方法满足的目标</li> 
      <li style="list-style:disc;">每个方法的输入，如请求</li> 
      <li style="list-style:disc;">每个方法的输出，如响应</li> 
     </ul>
     <p>通常情况下，Asp.Net Web API 定义method语法与HTTP方法一一对应的，如自定义方法名&nbsp;<span style="font-family:Calibri;">GetPysicians()，则与HTTP中Get 方法匹配。下图是常用匹配表。</span></p> 
     <p>&nbsp;</p> 
     <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Http1.png" alt="" style="border:0px;"></p> 
     <p><br> 但是此方法在很多情况下，并不实用，假如你想在单个API controller 类中定义多个Get 或Post 方法，在这种情况下，需要定义包含action 的路径，将Action 作为URI 的一部分。以下是配置代码：</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> Register(HttpConfiguration config)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span> <span class="rem" style="color:rgb(0,128,0);">// Web API configuration and services</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span> <span class="rem" style="color:rgb(0,128,0);">// Web API routes</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span> config.MapHttpAttributeRoutes();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span> </pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> config.Routes.MapHttpRoute(name: <span class="str" style="color:rgb(0,96,128);">"PhysicianApi"</span>,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> routeTemplate: <span class="str" style="color:rgb(0,96,128);">"{controller}/{action}/{id}"</span>,</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> defaults: <span class="kwrd" style="color:rgb(0,0,255);">new</span> { id = RouteParameter.Optional });</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span>}</pre> 
     </div> 
     <p>但是此方法不足以应对所有情况，如果想实现从中央仓库删除文件，并且想调用同一个方法来获取文件，这种情况下，Web API 框架需要伪装Get 及Delete对应的HTTP 方法属性。如图所示：</p> 
     <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Http2.png" alt="" style="border:0px;"></p> 
     <p><span style="font-size:15px;">RemoveFile 方法可被Delete(HttpDelete) 或 Get(HttpGet)方法同时调用，从某种程度来说，HTTP 方法使开发人员命名&nbsp;API“方法”变得简单而标准。</span></p> 
     <p><span style="font-size:15px;">Web API框架也提供了一些其他功能来处理路径方面的问题，与MVC 的路径处理方法相似。因此可定义不同类型的Action方法。</span>&nbsp;</p> 
     <h2 style="font-size:21px;">数据流</h2> 
     <p>网络App 最常见的执行操作就是获取数据流。ASP.NET Web API 能够处理客户端与服务器端传输的重量级的数据流，数据流可来源于目录文件，也可是数据库中的二进制文件。本文主要介绍两种方法“Download”和“Upload”实现数据流相关的功能，Download是从服务器下载数据操作，而Upload则是上传数据到服务器。</p> 
     <h4 style="font-size:14px;color:rgb(51,51,51);">相关项目</h4> 
     <ul style="list-style:none;">
      <li style="list-style:disc;">WebAPIDataStreaming</li> 
      <li style="list-style:disc;">WebAPIClient</li> 
      <li style="list-style:disc;">POCOLibrary</li> 
     </ul>
     <p>在对代码解释之前，首先来了解如何配置IIS（7.5）和Web API 服务Web.Config 文件。</p> 
     <p>1. 保证Downloads/Uploads 涉及的文件具有读写权限。</p> 
     <p>2. 保证有足够容量的内容或因公安空间处理大文件。</p> 
     <p>3. 如果文件较大</p> 
     <blockquote style="border:2px solid rgb(239,239,239);line-height:1.6em;color:rgb(51,51,51);background:none;"> 
      <p>a. 配置Web.Config 文件时，保证&nbsp;maxRequestLength 时响应时间&nbsp;executionTimeout 合理。具体的值主要依赖于数据大小，允许一次性上传的最大数据为2 GB</p> 
      <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/Max_Length_Config.png" alt="" style="border:0px;"></p> 
      <p>b. 保证&nbsp;maxAllowedContentLength 在requestFiltering部分配置下正确设置，默认值为30MB，最大值4GB</p> 
      <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/Request_Filter_Config.png" alt="" style="border:0px;"></p> 
     </blockquote> 
     <p>一旦完成预先配置，那么创建数据流服务就非常简单了，首先 需要定义文件流“ApiController”，如下：</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// File streaming API</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span>[RoutePrefix(<span class="str" style="color:rgb(0,96,128);">"filestreaming"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span>[RequestModelValidator]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> <span class="kwrd" style="color:rgb(0,0,255);">class</span> StreamFilesController : ApiController</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="rem" style="color:rgb(0,128,0);">/// Get File meta data</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;FileMeta data response.&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"getfilemetadata"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage GetFileMetaData(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="rem" style="color:rgb(0,128,0);">/// Search file and return its meta data in all download directories</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;List of file meta datas response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> [HttpGet]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"searchfileindownloaddirectory"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage SearchFileInDownloadDirectory(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> <span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Download file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked File stream response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"downloadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> [HttpGet]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; DownloadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> <span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;File stream response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"download"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span> [HttpGet]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage DownloadFile(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> <span class="rem" style="color:rgb(0,128,0);">/// Upload file(s)</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"upload"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span> [HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage UploadFile(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 75: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 76: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 77: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 78: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 79: </span> <span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Upload file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 80: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 81: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 82: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 83: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"uploadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 84: </span> [HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 85: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; UploadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 86: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 87: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 88: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 89: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 90: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 91: </span>}</pre> 
     </div> 
     <p>Download 服务方法首先需要确认请求的文件是否存在，如果未找到，则返回错误提示“file is not found”,如果找到此文件，内容则转换为字节附加到响应对象，为“application/octet-stream” MIMI 内容类型。</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;File stream response&lt;returns&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"download"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>[HttpGet]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage DownloadFile(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> HttpResponseMessage response = Request.CreateResponse();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> FileMetaData metaData = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileMetaData();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> filePath = Path.Combine(<span class="kwrd" style="color:rgb(0,0,255);">this</span>.GetDownloadPath(), <span class="str" style="color:rgb(0,96,128);">@"\", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> FileInfo fileInfo = new FileInfo(filePath);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> if (!fileInfo.Exists)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> metaData.FileResponseMessage.IsExists = false;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> metaData.FileResponseMessage.Content = string.Format("{0} file <span class="kwrd" style="color:rgb(0,0,255);">is</span> not found !<span class="str" style="color:rgb(0,96,128);">", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> response = Request.CreateResponse(HttpStatusCode.NotFound, metaData, new MediaTypeHeaderValue("text/json<span class="str" style="color:rgb(0,96,128);">"));</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> else</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> response.Headers.AcceptRanges.Add("bytes<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> response.StatusCode = HttpStatusCode.OK;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> response.Content = new StreamContent(fileInfo.ReadStream());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> response.Content.Headers.ContentDisposition = new ContentDispositionHeaderValue("attachment<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> response.Content.Headers.ContentDisposition.FileName = fileName;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> response.Content.Headers.ContentType = new MediaTypeHeaderValue("application/octet-stream<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> response.Content.Headers.ContentLength = fileInfo.Length;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> catch (Exception exception)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> // Log exception and return gracefully</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> metaData = new FileMetaData();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> metaData.FileResponseMessage.Content = ProcessException(exception);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> response = Request.CreateResponse(HttpStatusCode.InternalServerError, metaData, new MediaTypeHeaderValue("text/json"));</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> response;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span>}</pre> 
     </div> 
     <p>Upload服务方法则会在multipart/form-data MIMI 内容类型执行，首先会检测HTTP 请求的内容类型是否是多主体，如果是，则对比内容长度是否超过最大尺寸，如果没有超过，则开始上传内容，当操作完成之后，则提示相应的信息。</p> 
     <p>代码片段如下：</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Upload file(s)</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Message response&lt;/returns&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"upload"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>[HttpPost]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage UploadFile(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> HttpResponseMessage response = Request.CreateResponse();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> List&lt;FileResponseMessage&gt; fileResponseMessages = <span class="kwrd" style="color:rgb(0,0,255);">new</span> List&lt;FileResponseMessage&gt;();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> FileResponseMessage fileResponseMessage = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileResponseMessage { IsExists = <span class="kwrd" style="color:rgb(0,0,255);">false</span> };</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!Request.Content.IsMimeMultipartContent())</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> fileResponseMessage.Content = <span class="str" style="color:rgb(0,96,128);">"Upload data request is not valid !"</span>;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> fileResponseMessages.Add(fileResponseMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> response = Request.CreateResponse(HttpStatusCode.UnsupportedMediaType, fileResponseMessages, <span class="kwrd" style="color:rgb(0,0,255);">new</span> MediaTypeHeaderValue(<span class="str" style="color:rgb(0,96,128);">"text/json"</span>));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> response = ProcessUploadRequest(overWrite);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (Exception exception)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> <span class="rem" style="color:rgb(0,128,0);">// Log exception and return gracefully</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> fileResponseMessage = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileResponseMessage { IsExists = <span class="kwrd" style="color:rgb(0,0,255);">false</span> };</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> fileResponseMessage.Content = ProcessException(exception);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> fileResponseMessages.Add(fileResponseMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> response = Request.CreateResponse(HttpStatusCode.InternalServerError, fileResponseMessages, <span class="kwrd" style="color:rgb(0,0,255);">new</span> MediaTypeHeaderValue(<span class="str" style="color:rgb(0,96,128);">"text/json"</span>));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> response;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span><span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Upload file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"uploadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span>[HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; UploadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> await <span class="kwrd" style="color:rgb(0,0,255);">new</span> TaskFactory().StartNew(</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> () =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> UploadFile(overWrite);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> });</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span><span class="rem" style="color:rgb(0,128,0);">/// Process upload request in the server</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt; </span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/returns&gt;List of message object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> HttpResponseMessage ProcessUploadRequest(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span>}</pre> 
     </div> 
     <p>调用download 及 upload 文件方法是控制台应用，App 假定文件流服务通过HttpClient和相关类。基本下载文件代码，创建下载HTTP 请求对象。</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Awaitable Task object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> async Task DownloadFile()</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> Console.WriteLine(<span class="str" style="color:rgb(0,96,128);">"Please specify file name  with extension and Press Enter :- "</span>);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName = Console.ReadLine();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> localDownloadPath = <span class="kwrd" style="color:rgb(0,0,255);">string</span>.Concat(<span class="str" style="color:rgb(0,96,128);">@"c:\", fileName); // the path can be configurable</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> bool overWrite = true;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> string actionURL = string.Concat("downloadasync?fileName=<span class="str" style="color:rgb(0,96,128);">", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> try</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> Console.WriteLine(string.Format("Start downloading @ {0}, {1} time <span class="str" style="color:rgb(0,96,128);">",</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> DateTime.Now.ToLongTimeString()));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> using (HttpClient httpClient = new HttpClient())</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> httpClient.BaseAddress = baseStreamingURL;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> HttpRequestMessage request = new HttpRequestMessage(HttpMethod.Get, actionURL);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> await httpClient.SendAsync(request, HttpCompletionOption.ResponseHeadersRead).</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> ContinueWith((response)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> Console.WriteLine();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> try</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> ProcessDownloadResponse(localDownloadPath, overWrite, response);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> catch (AggregateException aggregateException)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> Console.WriteLine(string.Format("Exception : <span class="str" style="color:rgb(0,96,128);">", aggregateException));</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> catch (Exception ex)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> Console.WriteLine(ex.Message);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span>/// &lt;summary&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span>/// Process download response object</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span>/// &lt;/summary&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span>/// &lt;param name="localDownloadFilePath<span class="str" style="color:rgb(0,96,128);">"&gt;Local download file path&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span>/// &lt;param name="overWrite<span class="str" style="color:rgb(0,96,128);">"&gt;An indicator to overwrite a file if it exist in the client.&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span>/// &lt;param name="response"&gt;Awaitable HttpResponseMessage task <span class="kwrd" style="color:rgb(0,0,255);">value</span>&lt;/param&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> ProcessDownloadResponse(<span class="kwrd" style="color:rgb(0,0,255);">string</span> localDownloadFilePath, <span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> Task&lt;HttpResponseMessage&gt; response)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (response.Result.IsSuccessStatusCode)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> response.Result.Content.DownloadFile(localDownloadFilePath, overWrite).</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> ContinueWith((downloadmessage)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span> Console.WriteLine(downloadmessage.TryResult());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span> ProcessFailResponse(response);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span>}</pre> 
     </div> 
     <p>&nbsp;</p> 
     <p>注意上述代码中HttpClient 对象发送请求，并等待响应发送Header内容（HttpCompletionOption.ResponseHeadersRead ）。而不是发送全部的响应内容文件。一旦Response header 被读，则执行验证，一旦验证成功，则执行下载方法。</p> 
     <p>以下代码调用upload 文件流，与下载方法类似，创建多主体表单数据，并发送给服务器端。</p> 
     <div class="csharpcode" style="font-size:small;color:#000000;font-family:consolas, 'Courier New', courier, monospace;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Upload file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Awaitable task object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> async Task UploadFile()</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadRequestURI = <span class="str" style="color:rgb(0,96,128);">"uploadasync?overWrite=true"</span>;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> MultipartFormDataContent formDataContent = <span class="kwrd" style="color:rgb(0,0,255);">new</span> MultipartFormDataContent();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> <span class="rem" style="color:rgb(0,128,0);">// Validate the file and add to MultipartFormDataContent object</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> formDataContent.AddUploadFile(<span class="str" style="color:rgb(0,96,128);">@"c:\nophoto.png"</span>);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> formDataContent.AddUploadFile(<span class="str" style="color:rgb(0,96,128);">@"c:\ReadMe.txt"</span>);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!formDataContent.HasContent()) <span class="rem" style="color:rgb(0,128,0);">// No files found to be uploaded</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> Console.Write(formDataContent.GetUploadFileErrorMesage());</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span>;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadErrorMessage = formDataContent.GetUploadFileErrorMesage();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!<span class="kwrd" style="color:rgb(0,0,255);">string</span>.IsNullOrWhiteSpace(uploadErrorMessage)) <span class="rem" style="color:rgb(0,128,0);">// Some files couldn't be found</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> Console.Write(uploadErrorMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> HttpRequestMessage request = <span class="kwrd" style="color:rgb(0,0,255);">new</span> HttpRequestMessage(HttpMethod.Post, uploadRequestURI);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> request.Content = formDataContent;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> <span class="kwrd" style="color:rgb(0,0,255);">using</span> (HttpClient httpClient = <span class="kwrd" style="color:rgb(0,0,255);">new</span> HttpClient())</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"Start uploading @ {0}, {1} time "</span>,</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> DateTime.Now.ToLongTimeString()));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> httpClient.BaseAddress = baseStreamingURL;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> await httpClient.SendAsync(request).</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> ContinueWith((response)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> =&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span> ProcessUploadResponse(response);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (AggregateException aggregateException)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"Exception : "</span>, aggregateException));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (Exception ex)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> Console.WriteLine(ex.Message);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span>} </pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span><span class="rem" style="color:rgb(0,128,0);">/// Process download response object</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="response"&gt;Awaitable HttpResponseMessage task value&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> ProcessUploadResponse(Task&lt;HttpResponseMessage&gt; response)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (response.Result.IsSuccessStatusCode)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 75: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadMessage = <span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"\nUpload completed @ {0}, {1} time "</span>,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 76: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 77: </span> DateTime.Now.ToLongTimeString());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 78: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 79: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"{0}\nUpload Message : \n{1}"</span>, uploadMessage,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 80: </span> JsonConvert.SerializeObject(response.Result.Content.ReadAsAsync&lt;List&lt;FileResponseMessage&gt;&gt;().TryResult(), Formatting.Indented)));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 81: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 82: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 83: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 84: </span> ProcessFailResponse(response);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 85: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 86: </span>}</pre> 
     </div> 
     <p>&nbsp;</p> 
     <p>数据流项目由可扩展类和方法组成，本文就不再详述。下篇文章中将介绍“使用HTTPS 开发项目”</p> 
     <p><strong><span style="font-size:18px;"><a href="http://files.cnblogs.com/files/powertoolsteam/WebAPI_Thoughts.zip" rel="nofollow" style="text-decoration:none;color:rgb(85,85,85);">下载源代码</a></span></strong></p> 
     <p>原文链接：http://www.codeproject.com/Articles/838274/Web-API-Thoughts-of-Data-Streaming#Hist</p> 
    </div> 
    <div style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;line-height:24px;"> 
     <div> 
      <a class="jiathis_button_qzone" title="分享到QQ空间" style="color:rgb(86,86,86);"><span class="jiathis_txt jtico jtico_qzone" style="font-size:22px;background:url(&quot;&quot;);line-height:32px;"></span></a>
      <a class="jiathis_button_tsina" title="分享到新浪微博" style="color:rgb(86,86,86);"><span class="jiathis_txt jtico jtico_tsina" style="font-size:22px;background:url(&quot;&quot;);line-height:32px;"></span></a>
      <a class="jiathis_button_kaixin001" title="分享到开心网" style="color:rgb(86,86,86);"><span class="jiathis_txt jtico jtico_kaixin001" style="font-size:22px;background:url(&quot;&quot;);line-height:32px;"></span></a>
      <a class="jiathis_button_renren" title="分享到人人网" style="color:rgb(86,86,86);"><span class="jiathis_txt jtico jtico_renren" style="font-size:22px;background:url(&quot;&quot;);line-height:32px;"></span></a>
      <a class="jiathis_button_t163" title="分享到网易微博" style="color:rgb(86,86,86);"><span class="jiathis_txt jtico jtico_t163" style="font-size:22px;background:url(&quot;&quot;);line-height:32px;"></span></a>
      <a href="http://www.jiathis.com/share/" rel="nofollow" class="jiathis jiathis_txt jtico jtico_jiathis" style="text-decoration:none;color:rgb(85,85,85);font-size:22px;background:url(&quot;&quot;);line-height:32px;"></a> 
     </div> 
    </div> 
    <div style="line-height:24px;"> 
     <p style="text-align:center;color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><img src="http://www.codeproject.com/KB/aspnet/838274/REST.png" alt="" style="border:0px;"></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">相信已经有很多文章来介绍ASP.Net Web API 技术，本系列文章主要介绍如何使用数据流，HTTPS，以及可扩展的Web API 方面的技术，系列文章主要有三篇内容。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">主要内容如下：</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">I &nbsp;数据流</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">II 使用HTTPS</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">III 可扩展的Web API 文档</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;</p> 
     <h2 style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:21px;">项目环境要求</h2> 
     <ul style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;list-style:none;">
      <li style="list-style:disc;">VS 2012（SP4）及以上，</li> 
      <li style="list-style:disc;">.Net 框架4.5.1</li> 
      <li style="list-style:disc;">Nuget包,可在packages.config 文件中查寻</li> 
     </ul>
     <h2 style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:21px;"><strong>本文涉及的知识点</strong></h2> 
     <ol style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;list-style:none;">
      <li style="list-style:decimal;">ActionFilter</li> 
      <li style="list-style:decimal;">AuthorizationFilter</li> 
      <li style="list-style:decimal;">DelegateHandler</li> 
      <li style="list-style:decimal;">Different Web API routing 属性</li> 
      <li style="list-style:decimal;">MediaTypeFormatter</li> 
      <li style="list-style:decimal;">OWIN</li> 
      <li style="list-style:decimal;">Self Hosting</li> 
      <li style="list-style:decimal;">Web API 文档及可扩展功能</li> 
     </ol>
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><strong>.Net 框架</strong></p> 
     <ol style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;list-style:none;">
      <li style="list-style:decimal;">Async/Await</li> 
      <li style="list-style:decimal;">.NET reflection</li> 
      <li style="list-style:decimal;">Serialization</li> 
      <li style="list-style:decimal;">ASP.NET Web API/MVC Error handling</li> 
      <li style="list-style:decimal;">IIS ,HTTPS 及Certificate</li> 
      <li style="list-style:decimal;">设计准则及技术</li> 
     </ol>
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">前言</p> 
     <p style="text-align:center;color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Poster_Life_Cycle.png" alt="" style="border:0px;"></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">自从ASP.NET MVC 4之后.Net 框架开始支持ASP.NET Web API ，ASP.NET Web API 基于HTTP 协议建立的，是构建 RESTful 服务和处理数据的理想平台，旨在使用HTTP 技术实现对多平台的支持。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">ASP.NET Web API 以request-response 的消息转换模式为主，客户端向服务器发送请求，服务器端响应客户端请求。响应可同步或异步。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;个人认为使用Web API创建应用需要注意的三个关键点：</p> 
     <ul style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;list-style:none;">
      <li style="list-style:disc;">采用服务及方法满足的目标</li> 
      <li style="list-style:disc;">每个方法的输入，如请求</li> 
      <li style="list-style:disc;">每个方法的输出，如响应</li> 
     </ul>
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">通常情况下，Asp.Net Web API 定义method语法与HTTP方法一一对应的，如自定义方法名&nbsp;<span style="font-family:Calibri;">GetPysicians()，则与HTTP中Get 方法匹配。下图是常用匹配表。</span></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;</p> 
     <p style="text-align:center;color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Http1.png" alt="" style="border:0px;"></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><br> 但是此方法在很多情况下，并不实用，假如你想在单个API controller 类中定义多个Get 或Post 方法，在这种情况下，需要定义包含action 的路径，将Action 作为URI 的一部分。以下是配置代码：</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> Register(HttpConfiguration config)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span> <span class="rem" style="color:rgb(0,128,0);">// Web API configuration and services</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span> <span class="rem" style="color:rgb(0,128,0);">// Web API routes</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span> config.MapHttpAttributeRoutes();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span> </pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> config.Routes.MapHttpRoute(name: <span class="str" style="color:rgb(0,96,128);">"PhysicianApi"</span>,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> routeTemplate: <span class="str" style="color:rgb(0,96,128);">"{controller}/{action}/{id}"</span>,</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> defaults: <span class="kwrd" style="color:rgb(0,0,255);">new</span> { id = RouteParameter.Optional });</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span>}</pre> 
     </div> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">但是此方法不足以应对所有情况，如果想实现从中央仓库删除文件，并且想调用同一个方法来获取文件，这种情况下，Web API 框架需要伪装Get 及Delete对应的HTTP 方法属性。如图所示：</p> 
     <p style="text-align:center;color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><img src="http://www.codeproject.com/KB/aspnet/838274/WebAPI_Http2.png" alt="" style="border:0px;"></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><span style="font-size:15px;">RemoveFile 方法可被Delete(HttpDelete) 或 Get(HttpGet)方法同时调用，从某种程度来说，HTTP 方法使开发人员命名&nbsp;API“方法”变得简单而标准。</span></p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;"><span style="font-size:15px;">Web API框架也提供了一些其他功能来处理路径方面的问题，与MVC 的路径处理方法相似。因此可定义不同类型的Action方法。</span>&nbsp;</p> 
     <h2 style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:21px;">数据流</h2> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">网络App 最常见的执行操作就是获取数据流。ASP.NET Web API 能够处理客户端与服务器端传输的重量级的数据流，数据流可来源于目录文件，也可是数据库中的二进制文件。本文主要介绍两种方法“Download”和“Upload”实现数据流相关的功能，Download是从服务器下载数据操作，而Upload则是上传数据到服务器。</p> 
     <h4 style="color:rgb(51,51,51);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:14px;">相关项目</h4> 
     <ul style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;list-style:none;">
      <li style="list-style:disc;">WebAPIDataStreaming</li> 
      <li style="list-style:disc;">WebAPIClient</li> 
      <li style="list-style:disc;">POCOLibrary</li> 
     </ul>
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">在对代码解释之前，首先来了解如何配置IIS（7.5）和Web API 服务Web.Config 文件。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">1. 保证Downloads/Uploads 涉及的文件具有读写权限。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">2. 保证有足够容量的内容或因公安空间处理大文件。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">3. 如果文件较大</p> 
     <blockquote style="color:rgb(51,51,51);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;border:2px solid rgb(239,239,239);line-height:1.6em;background:none;"> 
      <p>a. 配置Web.Config 文件时，保证&nbsp;maxRequestLength 时响应时间&nbsp;executionTimeout 合理。具体的值主要依赖于数据大小，允许一次性上传的最大数据为2 GB</p> 
      <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/Max_Length_Config.png" alt="" style="border:0px;"></p> 
      <p>b. 保证&nbsp;maxAllowedContentLength 在requestFiltering部分配置下正确设置，默认值为30MB，最大值4GB</p> 
      <p style="text-align:center;"><img src="http://www.codeproject.com/KB/aspnet/838274/Request_Filter_Config.png" alt="" style="border:0px;"></p> 
     </blockquote> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">一旦完成预先配置，那么创建数据流服务就非常简单了，首先 需要定义文件流“ApiController”，如下：</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// File streaming API</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span>[RoutePrefix(<span class="str" style="color:rgb(0,96,128);">"filestreaming"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span>[RequestModelValidator]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> <span class="kwrd" style="color:rgb(0,0,255);">class</span> StreamFilesController : ApiController</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="rem" style="color:rgb(0,128,0);">/// Get File meta data</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;FileMeta data response.&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"getfilemetadata"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage GetFileMetaData(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="rem" style="color:rgb(0,128,0);">/// Search file and return its meta data in all download directories</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;List of file meta datas response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> [HttpGet]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"searchfileindownloaddirectory"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage SearchFileInDownloadDirectory(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> <span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Download file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked File stream response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"downloadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> [HttpGet]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; DownloadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> <span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;File stream response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"download"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span> [HttpGet]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage DownloadFile(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> <span class="rem" style="color:rgb(0,128,0);">/// Upload file(s)</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"upload"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span> [HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage UploadFile(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 75: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 76: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 77: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 78: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 79: </span> <span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Upload file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 80: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 81: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 82: </span> <span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 83: </span> [Route(<span class="str" style="color:rgb(0,96,128);">"uploadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 84: </span> [HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 85: </span> <span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; UploadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 86: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 87: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 88: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 89: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 90: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 91: </span>}</pre> 
     </div> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">Download 服务方法首先需要确认请求的文件是否存在，如果未找到，则返回错误提示“file is not found”,如果找到此文件，内容则转换为字节附加到响应对象，为“application/octet-stream” MIMI 内容类型。</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="fileName"&gt;FileName value&lt;param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;File stream response&lt;returns&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"download"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>[HttpGet]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage DownloadFile(<span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> HttpResponseMessage response = Request.CreateResponse();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> FileMetaData metaData = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileMetaData();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> filePath = Path.Combine(<span class="kwrd" style="color:rgb(0,0,255);">this</span>.GetDownloadPath(), <span class="str" style="color:rgb(0,96,128);">@"\", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> FileInfo fileInfo = new FileInfo(filePath);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> if (!fileInfo.Exists)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> metaData.FileResponseMessage.IsExists = false;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> metaData.FileResponseMessage.Content = string.Format("{0} file <span class="kwrd" style="color:rgb(0,0,255);">is</span> not found !<span class="str" style="color:rgb(0,96,128);">", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> response = Request.CreateResponse(HttpStatusCode.NotFound, metaData, new MediaTypeHeaderValue("text/json<span class="str" style="color:rgb(0,96,128);">"));</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> else</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> response.Headers.AcceptRanges.Add("bytes<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> response.StatusCode = HttpStatusCode.OK;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> response.Content = new StreamContent(fileInfo.ReadStream());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> response.Content.Headers.ContentDisposition = new ContentDispositionHeaderValue("attachment<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> response.Content.Headers.ContentDisposition.FileName = fileName;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> response.Content.Headers.ContentType = new MediaTypeHeaderValue("application/octet-stream<span class="str" style="color:rgb(0,96,128);">");</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> response.Content.Headers.ContentLength = fileInfo.Length;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> catch (Exception exception)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> // Log exception and return gracefully</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> metaData = new FileMetaData();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> metaData.FileResponseMessage.Content = ProcessException(exception);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> response = Request.CreateResponse(HttpStatusCode.InternalServerError, metaData, new MediaTypeHeaderValue("text/json"));</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> response;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span>}</pre> 
     </div> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">Upload服务方法则会在multipart/form-data MIMI 内容类型执行，首先会检测HTTP 请求的内容类型是否是多主体，如果是，则对比内容长度是否超过最大尺寸，如果没有超过，则开始上传内容，当操作完成之后，则提示相应的信息。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">代码片段如下：</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Upload file(s)</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Message response&lt;/returns&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"upload"</span>)]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span>[HttpPost]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> HttpResponseMessage UploadFile(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> HttpResponseMessage response = Request.CreateResponse();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> List&lt;FileResponseMessage&gt; fileResponseMessages = <span class="kwrd" style="color:rgb(0,0,255);">new</span> List&lt;FileResponseMessage&gt;();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> FileResponseMessage fileResponseMessage = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileResponseMessage { IsExists = <span class="kwrd" style="color:rgb(0,0,255);">false</span> };</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!Request.Content.IsMimeMultipartContent())</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> fileResponseMessage.Content = <span class="str" style="color:rgb(0,96,128);">"Upload data request is not valid !"</span>;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> fileResponseMessages.Add(fileResponseMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> response = Request.CreateResponse(HttpStatusCode.UnsupportedMediaType, fileResponseMessages, <span class="kwrd" style="color:rgb(0,0,255);">new</span> MediaTypeHeaderValue(<span class="str" style="color:rgb(0,96,128);">"text/json"</span>));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> response = ProcessUploadRequest(overWrite);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (Exception exception)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> <span class="rem" style="color:rgb(0,128,0);">// Log exception and return gracefully</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> fileResponseMessage = <span class="kwrd" style="color:rgb(0,0,255);">new</span> FileResponseMessage { IsExists = <span class="kwrd" style="color:rgb(0,0,255);">false</span> };</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> fileResponseMessage.Content = ProcessException(exception);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> fileResponseMessages.Add(fileResponseMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> response = Request.CreateResponse(HttpStatusCode.InternalServerError, fileResponseMessages, <span class="kwrd" style="color:rgb(0,0,255);">new</span> MediaTypeHeaderValue(<span class="str" style="color:rgb(0,96,128);">"text/json"</span>));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> response;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span><span class="rem" style="color:rgb(0,128,0);">/// Asynchronous Upload file</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Tasked Message response&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span>[Route(<span class="str" style="color:rgb(0,96,128);">"uploadasync"</span>)]</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span>[HttpPost]</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span><span class="kwrd" style="color:rgb(0,0,255);">public</span> async Task&lt;HttpResponseMessage&gt; UploadFileAsync(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> await <span class="kwrd" style="color:rgb(0,0,255);">new</span> TaskFactory().StartNew(</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> () =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span> UploadFile(overWrite);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> });</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span><span class="rem" style="color:rgb(0,128,0);">/// Process upload request in the server</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt; </span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="overWrite"&gt;An indicator to overwrite a file if it exist in the server.&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/returns&gt;List of message object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> HttpResponseMessage ProcessUploadRequest(<span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> <span class="rem" style="color:rgb(0,128,0);">// Full code available in the source control</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> <span class="rem" style="color:rgb(0,128,0);">// .........................................</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span>}</pre> 
     </div> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">调用download 及 upload 文件方法是控制台应用，App 假定文件流服务通过HttpClient和相关类。基本下载文件代码，创建下载HTTP 请求对象。</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Download file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Awaitable Task object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> async Task DownloadFile()</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> Console.WriteLine(<span class="str" style="color:rgb(0,96,128);">"Please specify file name  with extension and Press Enter :- "</span>);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> fileName = Console.ReadLine();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> localDownloadPath = <span class="kwrd" style="color:rgb(0,0,255);">string</span>.Concat(<span class="str" style="color:rgb(0,96,128);">@"c:\", fileName); // the path can be configurable</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> bool overWrite = true;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span> string actionURL = string.Concat("downloadasync?fileName=<span class="str" style="color:rgb(0,96,128);">", fileName);</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> try</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span> Console.WriteLine(string.Format("Start downloading @ {0}, {1} time <span class="str" style="color:rgb(0,96,128);">",</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> DateTime.Now.ToLongTimeString()));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> using (HttpClient httpClient = new HttpClient())</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> httpClient.BaseAddress = baseStreamingURL;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> HttpRequestMessage request = new HttpRequestMessage(HttpMethod.Get, actionURL);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> await httpClient.SendAsync(request, HttpCompletionOption.ResponseHeadersRead).</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> ContinueWith((response)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> Console.WriteLine();</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span> try</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> ProcessDownloadResponse(localDownloadPath, overWrite, response);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> catch (AggregateException aggregateException)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> Console.WriteLine(string.Format("Exception : <span class="str" style="color:rgb(0,96,128);">", aggregateException));</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> catch (Exception ex)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> Console.WriteLine(ex.Message);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span>}</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span>/// &lt;summary&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span>/// Process download response object</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span>/// &lt;/summary&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span>/// &lt;param name="localDownloadFilePath<span class="str" style="color:rgb(0,96,128);">"&gt;Local download file path&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span>/// &lt;param name="overWrite<span class="str" style="color:rgb(0,96,128);">"&gt;An indicator to overwrite a file if it exist in the client.&lt;/param&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span>/// &lt;param name="response"&gt;Awaitable HttpResponseMessage task <span class="kwrd" style="color:rgb(0,0,255);">value</span>&lt;/param&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> ProcessDownloadResponse(<span class="kwrd" style="color:rgb(0,0,255);">string</span> localDownloadFilePath, <span class="kwrd" style="color:rgb(0,0,255);">bool</span> overWrite,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> Task&lt;HttpResponseMessage&gt; response)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span>{</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (response.Result.IsSuccessStatusCode)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> response.Result.Content.DownloadFile(localDownloadFilePath, overWrite).</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> ContinueWith((downloadmessage)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> =&gt;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span> Console.WriteLine(downloadmessage.TryResult());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span> ProcessFailResponse(response);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span>}</pre> 
     </div> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">&nbsp;</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">注意上述代码中HttpClient 对象发送请求，并等待响应发送Header内容（HttpCompletionOption.ResponseHeadersRead ）。而不是发送全部的响应内容文件。一旦Response header 被读，则执行验证，一旦验证成功，则执行下载方法。</p> 
     <p style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:12px;">以下代码调用upload 文件流，与下载方法类似，创建多主体表单数据，并发送给服务器端。</p> 
     <div class="csharpcode" style="color:#000000;font-family:consolas, 'Courier New', courier, monospace;font-size:small;"> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 1: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 2: </span><span class="rem" style="color:rgb(0,128,0);">/// Upload file</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 3: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 4: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;returns&gt;Awaitable task object&lt;/returns&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 5: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> async Task UploadFile()</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 6: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 7: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 8: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 9: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadRequestURI = <span class="str" style="color:rgb(0,96,128);">"uploadasync?overWrite=true"</span>;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 10: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 11: </span> MultipartFormDataContent formDataContent = <span class="kwrd" style="color:rgb(0,0,255);">new</span> MultipartFormDataContent();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 12: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 13: </span> <span class="rem" style="color:rgb(0,128,0);">// Validate the file and add to MultipartFormDataContent object</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 14: </span> formDataContent.AddUploadFile(<span class="str" style="color:rgb(0,96,128);">@"c:\nophoto.png"</span>);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 15: </span> formDataContent.AddUploadFile(<span class="str" style="color:rgb(0,96,128);">@"c:\ReadMe.txt"</span>);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 16: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 17: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!formDataContent.HasContent()) <span class="rem" style="color:rgb(0,128,0);">// No files found to be uploaded</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 18: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 19: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 20: </span> Console.Write(formDataContent.GetUploadFileErrorMesage());</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 21: </span> <span class="kwrd" style="color:rgb(0,0,255);">return</span>;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 22: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 23: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 24: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 25: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadErrorMessage = formDataContent.GetUploadFileErrorMesage();</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 26: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (!<span class="kwrd" style="color:rgb(0,0,255);">string</span>.IsNullOrWhiteSpace(uploadErrorMessage)) <span class="rem" style="color:rgb(0,128,0);">// Some files couldn't be found</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 27: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 28: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 29: </span> Console.Write(uploadErrorMessage);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 30: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 31: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 32: </span> HttpRequestMessage request = <span class="kwrd" style="color:rgb(0,0,255);">new</span> HttpRequestMessage(HttpMethod.Post, uploadRequestURI);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 33: </span> request.Content = formDataContent;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 34: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 35: </span> <span class="kwrd" style="color:rgb(0,0,255);">using</span> (HttpClient httpClient = <span class="kwrd" style="color:rgb(0,0,255);">new</span> HttpClient())</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 36: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 37: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 38: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"Start uploading @ {0}, {1} time "</span>,</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 39: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 40: </span> DateTime.Now.ToLongTimeString()));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 41: </span>&nbsp;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 42: </span> httpClient.BaseAddress = baseStreamingURL;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 43: </span> await httpClient.SendAsync(request).</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 44: </span> ContinueWith((response)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 45: </span> =&gt;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 46: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 47: </span> <span class="kwrd" style="color:rgb(0,0,255);">try</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 48: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 49: </span> ProcessUploadResponse(response);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 50: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 51: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (AggregateException aggregateException)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 52: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 53: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 54: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"Exception : "</span>, aggregateException));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 55: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 56: </span> });</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 57: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 58: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 59: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 60: </span> <span class="kwrd" style="color:rgb(0,0,255);">catch</span> (Exception ex)</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 61: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 62: </span> Console.ForegroundColor = ConsoleColor.Red;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 63: </span> Console.WriteLine(ex.Message);</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 64: </span> }</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 65: </span>} </pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 66: </span>&nbsp;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 67: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 68: </span><span class="rem" style="color:rgb(0,128,0);">/// Process download response object</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 69: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 70: </span><span class="rem" style="color:rgb(0,128,0);">/// &lt;param name="response"&gt;Awaitable HttpResponseMessage task value&lt;/param&gt;</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 71: </span><span class="kwrd" style="color:rgb(0,0,255);">private</span> <span class="kwrd" style="color:rgb(0,0,255);">static</span> <span class="kwrd" style="color:rgb(0,0,255);">void</span> ProcessUploadResponse(Task&lt;HttpResponseMessage&gt; response)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 72: </span>{</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 73: </span> <span class="kwrd" style="color:rgb(0,0,255);">if</span> (response.Result.IsSuccessStatusCode)</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 74: </span> {</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 75: </span> <span class="kwrd" style="color:rgb(0,0,255);">string</span> uploadMessage = <span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"\nUpload completed @ {0}, {1} time "</span>,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 76: </span> DateTime.Now.ToLongDateString(),</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 77: </span> DateTime.Now.ToLongTimeString());</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 78: </span> Console.ForegroundColor = ConsoleColor.Green;</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 79: </span> Console.WriteLine(<span class="kwrd" style="color:rgb(0,0,255);">string</span>.Format(<span class="str" style="color:rgb(0,96,128);">"{0}\nUpload Message : \n{1}"</span>, uploadMessage,</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 80: </span> JsonConvert.SerializeObject(response.Result.Content.ReadAsAsync&lt;List&lt;FileResponseMessage&gt;&gt;().TryResult(), Formatting.Indented)));</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 81: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 82: </span> <span class="kwrd" style="color:rgb(0,0,255);">else</span></pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 83: </span> {</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 84: </span> ProcessFailResponse(response);</pre> 
      <pre class="alt"><span class="lnum" style="color:rgb(96,96,96);"> 85: </span> }</pre> 
      <pre><span class="lnum" style="color:rgb(96,96,96);"> 86: </span>}</pre> 
     </div> 
     <p><font color="#555555"><span style="font-size:12px;">本文转自ITPUB博客77rou的博客，原文链接：<a href="http://blog.itpub.net/28298702/viewspace-1869010/" rel="nofollow" title="ASP.NET Web API 应用教程（一） 数据流使用">ASP.NET Web API 应用教程（一） ——数据流使用</a>，如需转载请自行联系原博主。</span></font><br></p> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
