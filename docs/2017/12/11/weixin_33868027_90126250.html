<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Code First系列之视图，存储过程和异步API « NotBeCN</title>
  <meta name="description" content="             本篇目录              视图View     存储过程     使用存储过程CRUD     异步API     本章小结     自我测试          本系列的源码本人已托管于coding上：点击查看    先附上codeplex上EF的源码：entityframew...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/11/weixin_33868027_90126250.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Code First系列之视图，存储过程和异步API</h1>
    <p class="post-meta">Dec 11, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(255,255,255);font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">本篇目录</h2> 
   <ul>
    <li style="list-style:disc;"> </li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>视图View</b></span></font></li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>存储过程</b></span></font></li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>使用存储过程CRUD</b></span></font></li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>异步API</b></span></font></li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>本章小结</b></span></font></li> 
    <li style="list-style:disc;"><font color="#4183c4"><span style="font-size:15px;line-height:25px;"><b>自我测试</b></span></font></li> 
   </ul>
   <hr style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
   <p><font color="#494949"><span style="font-size:15px;line-height:25px;">本系列的源码本人已托管于coding上：点击查看</span></font></p> 
   <p><font color="#494949"><span style="font-size:15px;line-height:25px;">先附上codeplex上EF的源码：entityframework.codeplex.com，此外，本人的实验环境是VS 2013 Update 5，windows 10,MSSQL Server 2008。</span></font></p> 
   <p><font color="#494949"><span style="font-size:15px;line-height:25px;"><br></span></font></p> 
   <p><font color="#494949"><span style="font-size:15px;line-height:25px;">咱们接着上一篇《Code First开发系列之管理数据库创建，填充种子数据以及LINQ操作详解》继续深入学习，这一篇说说Entity Framework之Code First方式如何使用视图，存储过程以及EF提供的一些异步接口。我们会看到如何充分使用已存在的存储过程和函数来检索、修改数据。此外，我们还要理解异步处理的优势以及EF是如何通过内置的API来支持这些概念的。</span></font></p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(255,255,255);font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);"> <a name="view"></a>视图View</h2> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">视图在RDBMS中扮演了一个重要的角色，它是将多个表的数据联结成一种看起来像是一张表的结构，但是没有提供持久化。因此，可以将视图看成是一个原生表数据顶层的一个抽象。例如，我们可以使用视图提供不同安全的级别，也可以简化必须编写的查询，尤其是我们可以在代码中的多个地方频繁地访问使用视图定义的数据。EF Code First现在还不完全支持视图，因此我们必须使用一种变通方法。这种方法就是将视图真正看成是一张表，让EF定义这张表，然后再删除它，最后再创建一个代替它的视图。下面具体看看是如何实现的吧。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">创建一个控制台项目，取名“ViewsAndStoreProcedure”。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">1 创建实体类</h4> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">
<span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> <span class="hljs-title" style="color:rgb(163,21,21);">Province</span>
{
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-title" style="color:rgb(163,21,21);">Province</span>(<span class="hljs-params"></span>) </span>{
        Donators = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> HashSet&lt;Donator&gt;();
    }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">int</span> Id { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }

    [StringLength(<span class="hljs-number">225</span>)]
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> ProvinceName { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }

    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">virtual</span> ICollection&lt;Donator&gt; Donators { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
}

<span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> <span class="hljs-title" style="color:rgb(163,21,21);">Donator</span>
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">int</span> Id { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> Name { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">decimal</span> Amount { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> DateTime DonateDate { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">virtual</span> Province Province { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
}

</code></pre> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">创建模拟视图类</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">暂且这样称呼吧，就是从多个实体中取出想要的列组合成一个实体。</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorViewInfo</span>
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">int</span> DonatorId { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> DonatorName { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">decimal</span> Amount { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> DateTime DonateDate { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    [StringLength(<span class="hljs-number">225</span>)]
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> ProvinceName { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
}

</code></pre> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">为模拟视图类创建配置类</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">下面的代码指定了主键和表名(也是视图的名字，注意这里的表名一定要和创建视图的语句中的视图名一致)：</p> 
   <pre class="c#"><code class="hljs cpp" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> DonatorViewInfoMap:EntityTypeConfiguration&lt;DonatorViewInfo&gt;
{
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorViewInfoMap</span><span class="hljs-params">()</span> </span>{
        HasKey(d =&gt; d.DonatorId);
        ToTable(<span class="hljs-string" style="color:rgb(163,21,21);">"DonatorViews"</span>);
    }
}

</code></pre> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">上下文中添加模拟视图类和配置类</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">web.config文件中的连接字符串我已配置好，不在此处展示！</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorsContext</span> : <span class="hljs-title" style="color:rgb(163,21,21);">DbContext</span>
{
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorsContext</span>(<span class="hljs-params"></span>) : <span class="hljs-title" style="color:rgb(163,21,21);">base</span>(<span class="hljs-params"><span class="hljs-string" style="color:rgb(163,21,21);">"name=DonatorsConn"</span></span>) </span>{
        }

    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">virtual</span> DbSet&lt;DonatorViewInfo&gt; DonatorViews { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">protected</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">override</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">OnModelCreating</span>(<span class="hljs-params">DbModelBuilder modelBuilder</span>) </span>{
        modelBuilder.Configurations.Add(<span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorViewInfoMap());
        <span class="hljs-keyword" style="color:rgb(0,0,255);">base</span>.OnModelCreating(modelBuilder);
    }
}

</code></pre> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">创建初始化器</h4> 
   <pre class="c#"><code class="hljs fsharp" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> Initializer:DropCreateDatabaseIfModelChanges&lt;DonatorsContext&gt;
{
    protected <span class="hljs-keyword" style="color:rgb(0,0,255);">override</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> Seed(DonatorsContext context)
    {
        var drop = <span class="hljs-string" style="color:rgb(163,21,21);">"Drop Table DonatorView"</span>;
        context.Database.ExecuteSqlCommand(drop);
        var createView = <span class="hljs-string" style="color:rgb(163,21,21);">@"CREATE VIEW [dbo].[DonatorViews] AS SELECT dbo.Donators.Id AS DonatorId, dbo.Donators.Name AS DonatorName, dbo.Donators.Amount AS Amount, dbo.Donators.DonateDate AS DonateDate, dbo.Provinces.ProvinceName AS ProvinceName FROM dbo.Donators INNER JOIN dbo.Provinces ON dbo.Provinces.Id = dbo.Donators.ProvinceId"</span>;
        context.Database.ExecuteSqlCommand(createView);
        <span class="hljs-keyword" style="color:rgb(0,0,255);">base</span>.Seed(context);
    }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">上面的代码中，我们先使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Database</code>对象的<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法销毁生成的表，然后又调用该方法创建了我们的视图。该方法在允许开发者对后端执行任意的SQL代码时很有用。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">上面的代码写完之后，在Main方法中只要写这一句代码<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Database.SetInitializer(new Initializer());</code>，运行程序，就会看到数据库中已经生成了Donators和Provinces两张表和一个视图DonatorView，见下图：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/c0eedce8-75c0-4074-8529-3d33b138c13e.jpg" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">刚才新建的数据库是没有数据的，然后我们插入数据，在数据库中查询一下，可以看到视图中已经存在数据了：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/1d2b6472-ae44-4f24-a209-e5644330f5c9.jpg" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">下面，一切工作准备就绪，就可以开始查询数据了：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"> <span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">region</span> 1.0 视图</span>
 Database.SetInitializer(<span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> Initializer());
 <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
 {
     <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donators = db.DonatorViews;
     <span class="hljs-keyword" style="color:rgb(0,0,255);">foreach</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donator <span class="hljs-keyword" style="color:rgb(0,0,255);">in</span> donators)
     {
         Console.WriteLine(donator.ProvinceName + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonatorId + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonatorName + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.Amount + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonateDate);
     }
 }

 <span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">endregion</span></span>

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">执行结果如下图所示：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/d9cca410-0109-4761-9d2a-e5433719dfe1.jpg" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">正如上面的代码所示，访问视图和任何数据表在代码层面没有区别，需要注意的地方就是在Seed方法中定义的视图名称要和定义的表名称一致，否则就会因为找不到表对象而报错，这一点要格外注意。</p> 
   <blockquote style="border:2px solid rgb(239,239,239);line-height:1.6;color:rgb(51,51,51);font-size:15px;font-family:'Microsoft Yahei';clear:both;background:rgb(223,255,163) url(&quot;//files.cnblogs.com/files/farb/o_title.gif&quot;) no-repeat 9px 50%;"> 
    <p>虽然视图看起来很像一张表，但是如果我们尝试修改或更新视图中定义的实体，那么就会抛异常。</p> 
   </blockquote> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">另一种方法</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果我们不想这么折腾（先定义一张表，然后删除这张表，再定义视图），当然了，我们还是要在初始化器中定义视图，但是我们使用Database对象的另一个方法<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>查询数据。该方法和<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法有相同的形参，但是最终返回一个结果集，在我们这里例子中，返回的就是DonatorViewInfo集合对象，如下代码所示：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//1.2 另一种方法</span>
<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> sql = <span class="hljs-string" style="color:rgb(163,21,21);">@"SELECT DonatorId ,DonatorName ,Amount ,DonateDate ,ProvinceName from dbo.DonatorViews where ProvinceName={0}"</span>;
<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donatorsViaCommand = db.Database.SqlQuery&lt;DonatorViewInfo&gt;(sql,<span class="hljs-string" style="color:rgb(163,21,21);">"河北省"</span>);
<span class="hljs-keyword" style="color:rgb(0,0,255);">foreach</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donator <span class="hljs-keyword" style="color:rgb(0,0,255);">in</span> donatorsViaCommand)
{
    Console.WriteLine(donator.ProvinceName + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonatorId + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonatorName + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.Amount + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonateDate);
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>方法需要一个泛型类型参数，该参数定义了原生SQL命令执行之后，将查询结果集物质化成何种类型的数据。该文本命令本身就是参数化的SQL。我们需要使用参数来确保动态sql不是SQL注入的目标。<strong>SQL注入</strong>是恶意用户通过提供特定的输入值执行任意SQL代码的过程。EF本身不是这些攻击的目标。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们不仅看到了如何在EF中使用视图，而且看到了两个很有用的<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Database</code>对象，<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>和<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法。<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>方法的泛型参数不一定非得是一个类，也可以.Net的基本类型，如string或者int。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">执行结果如下：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/d44fb788-655f-4180-b245-6645a8501356.jpg" alt="图片" style="border:0px;"></p> 
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="sp" style="color:rgb(224,130,131);"></a>存储过程</h3> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在EF中使用存储过程和使用视图是很相似的，一般会使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Database</code>对象上的两个方法——<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>和<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>。为了从存储过程中读取很多数据行，我们只需要定义一个类，我们会将检索到的所有数据行物质化到该类实例的集合中。比如，从下面的存储过程读取数据：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-sql"><code class="sourceCode sql hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">CREATE</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">PROCEDURE</span></span> SelectDonators <span class="ot">@provinceName <span class="hljs-keyword" style="color:rgb(0,0,255);">AS</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">NVARCHAR</span>(<span class="hljs-number">10</span>)</span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">AS</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">BEGIN</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">SELECT</span></span> ProvinceName,<span class="hljs-keyword" style="color:rgb(0,0,255);">Name</span>,Amount,DonateDate <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">FROM</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">JOIN</span></span> dbo.Provinces <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">ON</span></span> dbo.Provinces.<span class="hljs-keyword" style="color:rgb(0,0,255);">Id</span> = dbo.Donators.ProvinceId <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">WHERE</span></span> ProvinceName=@provinceName <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">END</span></span> </code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们只需要定义一个匹配了存储过程结果的类（类的属性名必须和表的列名一致）即可，如下所示：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorFromStoreProcedure</span>
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> ProvinceName { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">string</span> Name { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">decimal</span> Amount { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
    <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> DateTime DonateDate { <span class="hljs-keyword" style="color:rgb(0,0,255);">get</span>; <span class="hljs-keyword" style="color:rgb(0,0,255);">set</span>; }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">还是插入以下数据进行测试：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-sql"><code class="sourceCode sql hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Provinces <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span>( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'山东省'</span></span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Provinces <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span>( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'河北省'</span></span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span> ( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'陈志康'</span></span>, <span class="dv">50</span>, <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'2016-04-07'</span></span>,<span class="dv">1</span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span> ( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'海风'</span></span>, <span class="dv">5</span>, <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'2016-04-08'</span></span>,<span class="dv">1</span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span> ( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'醉、千秋'</span></span>, <span class="dv">12</span>, <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'2016-04-13'</span></span>,<span class="dv">1</span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span> ( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'雪茄'</span></span>, <span class="fl">18.8</span>, <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'2016-04-15'</span></span>,<span class="dv">2</span>) <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">INSERT</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">VALUES</span></span> ( <span class="hljs-keyword" style="color:rgb(0,0,255);">N</span><span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'王小乙'</span></span>, <span class="dv">10</span>, <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'2016-04-09'</span></span>,<span class="dv">2</span>)</code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">现在我们就可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>方法读取数据了(注意：在使用存储过程前，先要在数据库中执行存储过程)，如下所示：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">region</span> 2.0 EF调用存储过程查询数据SqlQuery</span>

<span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db=<span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> sql = <span class="hljs-string" style="color:rgb(163,21,21);">"SelectDonators {0}"</span>;
    <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donators = db.Database.SqlQuery&lt;DonatorFromStoreProcedure&gt;(sql,<span class="hljs-string" style="color:rgb(163,21,21);">"山东省"</span>);
    <span class="hljs-keyword" style="color:rgb(0,0,255);">foreach</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donator <span class="hljs-keyword" style="color:rgb(0,0,255);">in</span> donators)
    {
        Console.WriteLine(donator.ProvinceName+<span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span>+donator.Name+<span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span>+donator.Amount+<span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span>+donator.DonateDate);
    }
}
<span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">endregion</span></span>

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">上面的代码中，我们指定了使用哪个类读取查询的结果，创建SQL语句时，也为存储过程的参数提供了一个格式化占位符，调用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>时为那个参数提供了一个值。假如要提供多个参数的话，多个格式化占位符必须用逗号分隔，还要给<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>提供值的数组（后面会举例）。我们也可以使用表值函数代替存储过程。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">存储过程成功执行，结果如下：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/88f3e003-eae8-4db0-a7f5-3ee0f873b483.png" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">另一个用例就是假如存储过程没有返回任何值，只是对数据库中的一张或多张表执行了一条命令的情况。一个存储过程干了多少事情不重要，重要的是它压根不需要返回任何东西。例如，下面的存储过程只是更新了一些东西：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-sql"><code class="sourceCode sql hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">CREATE</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">PROCEDURE</span></span> UpdateDonator <span class="ot">@namePrefix <span class="hljs-keyword" style="color:rgb(0,0,255);">AS</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">NVARCHAR</span>(<span class="hljs-number">10</span>),</span> <span class="ot">@addedAmount <span class="hljs-keyword" style="color:rgb(0,0,255);">AS</span> <span class="hljs-built_in" style="color:rgb(0,0,255);">DECIMAL</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">AS</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">BEGIN</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">UPDATE</span></span> dbo.Donators <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">SET</span></span> <span class="hljs-keyword" style="color:rgb(0,0,255);">Name</span>=@namePrefix+<span class="hljs-keyword" style="color:rgb(0,0,255);">Name</span>,Amount=Amount+@addedAmount <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">WHERE</span></span> ProvinceId=<span class="dv">2</span><span class="co"><span class="hljs-comment" style="color:#008000;">/*给河北省的打赏者名字前加个前缀,并将金额加上指定的数量*/</span></span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">END</span></span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">现在数据库中执行该存储过程，然后，要调用该存储过程，我们使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法。该方法会返回存储过程或者其他任何SQL语句影响的行数。如果你对这个返回值不感兴趣，那么你可以不理它。下面小试牛刀一把：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//2.1 EF调用存储过程之ExecuteSqlCommand方法</span>
<span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> sql = <span class="hljs-string" style="color:rgb(163,21,21);">"UpdateDonator {0},{1}"</span>;
    Console.WriteLine(<span class="hljs-string" style="color:rgb(163,21,21);">"执行存储过程前的数据为："</span>);
    PrintDonators();
    <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> rowsAffected = db.Database.ExecuteSqlCommand(sql, <span class="hljs-string" style="color:rgb(163,21,21);">"Update"</span>, <span class="hljs-number">10</span>m);
    Console.WriteLine(<span class="hljs-string" style="color:rgb(163,21,21);">"影响的行数为{0}条"</span>, rowsAffected);
    Console.WriteLine(<span class="hljs-string" style="color:rgb(163,21,21);">"执行存储过程之后的数据为："</span>);
    PrintDonators();
}


<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">PrintDonators</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
        <span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donators = db.Donators.Where(p =&gt; p.ProvinceId == <span class="hljs-number">2</span>);<span class="hljs-comment" style="color:#008000;">//找出河北省的打赏者</span>
        <span class="hljs-keyword" style="color:rgb(0,0,255);">foreach</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> donator <span class="hljs-keyword" style="color:rgb(0,0,255);">in</span> donators)
        {
            Console.WriteLine(donator.Name + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.Amount + <span class="hljs-string" style="color:rgb(163,21,21);">"\t"</span> + donator.DonateDate);
        }
    }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">这里我们为上面定义的存储过程提供了两个参数，一个是在每个打赏者的姓名前加个前缀“Update”,另一个是将打赏金额加10。这里需要注意的是，我们必须严格按照它们在存储过程中定义的顺序依次传入相应的值，它们会以参数数组传入<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>。执行结果如下：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/0fe79ac3-2763-4b26-9990-ef22a8ab7c50.png" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">很大程度上，EF降低了存储过程的需要，然而，仍旧有很多原因要使用它们。这些原因包括安全标准，遗留数据库或者效率等问题。比如，如果需要在单个操作中更新几千条数据，然后再通过EF检索出来；如果每次都更新一行，然后再保存那些实例，效率是很低的。最后，即使你使用了<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>方法调用了存储过程，也可以更新数据。</p> 
   <blockquote style="border:2px solid rgb(239,239,239);line-height:1.6;color:rgb(51,51,51);font-size:15px;font-family:'Microsoft Yahei';clear:both;background:rgb(223,255,163) url(&quot;//files.cnblogs.com/files/farb/o_title.gif&quot;) no-repeat 9px 50%;"> 
    <p>开发者可以执行任意的SQL语句，只需要将上面<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>或<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法中的存储过程名称改为要执行的SQL语句就可以了。</p> 
   </blockquote> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="crud"></a>使用存储过程CUD</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">至今，我们都是使用EF内置的功能生成插入，更新或者删除实体的SQL语句，总有某种原因使我们想使用存储过程来实现相同的结果。开发者可能会为了安全原因使用存储过程，也可能是要处理一个已存在的数据库，而这些存储过程已经内置到该数据库了。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">EF Code First全面支持这些查询。我们可以使用熟悉的<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">EntityTypeConfiguration</code>类来给存储过程配置该支持，只需要简单地调用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">MapToStoredProcedures</code>方法就可以了。如果我们让EF管理数据库结构，那么它会自动为我们生成存储过程。此外，我们还可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">MapToStoredProcedures</code>方法合适的重载来重写存储过程名称或者参数名。下面以donator类为例：</p> 
   <pre class="c#"><code class="hljs cpp" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"> <span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> DonatorMap:EntityTypeConfiguration&lt;Donator&gt;
 {
     <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorMap</span><span class="hljs-params">()</span> </span>{
         MapToStoredProcedures();
     }
 }

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果我们运行程序来创建或更新数据库，就会看到为我们创建了新的存储过程，默认为插入操作生成了<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Donator_Insert</code>,其他的操作名称类似，如下图：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://dn-coding-net-production-pp.qbox.me/0185af81-5178-4530-a0c8-b83102bc24f4.png" alt="图片" style="border:0px;"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果有必要的话，我们可以自定义存储过程名，例如：</p> 
   <pre class="c#"><code class="hljs cpp" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">class</span> DonatorMap:EntityTypeConfiguration&lt;Donator&gt;
{
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-title" style="color:rgb(163,21,21);">DonatorMap</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-comment" style="color:#008000;">//MapToStoredProcedures();</span>
            MapToStoredProcedures(config =&gt;
            {
                <span class="hljs-comment" style="color:#008000;">//将删除打赏者的默认存储过程名称更改为“DonatorDelete”，</span>
                <span class="hljs-comment" style="color:#008000;">//同时将该存储过程的参数名称更改为“donatorId”，并指定该值来自Id属性</span>
                config.Delete(
                    procConfig =&gt;
                    {
                        procConfig.HasName(<span class="hljs-string" style="color:rgb(163,21,21);">"DonatorDelete"</span>);
                        procConfig.Parameter(d =&gt; d.Id, <span class="hljs-string" style="color:rgb(163,21,21);">"donatorId"</span>);
                    });

                <span class="hljs-comment" style="color:#008000;">//将默认的插入存储过程名称更改为“DonatorInsert”</span>
                config.Insert(
                    procConfig =&gt;
                    {
                        procConfig.HasName(<span class="hljs-string" style="color:rgb(163,21,21);">"DonatorInsert"</span>);
                    });
                <span class="hljs-comment" style="color:#008000;">//将默认的更新存储过程名称更改为“DonatorUpdate”</span>
                config.Update(procConfig =&gt;
                {
                    procConfig.HasName(<span class="hljs-string" style="color:rgb(163,21,21);">"DonatorUpdate"</span>);
                });
            });
        }            
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">总之，要自定义的话，代码肯定更冗余，不管怎样了，取决于你！</p> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(255,255,255);font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);"> <a name="api"></a>异步API</h2> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">目前为止，我们所有使用EF的数据库操作都是同步的。换言之，我们的.NET程序会等待给定的数据库操作（例如一个查询或者一个更新）完成之后才会继续向前执行。在很多情况下，使用这种方式没有什么问题，然而，在某些情况下，异步地执行这些操作的能力是很重要的。在这些情况下，当该软件等待数据库操作完成时，我们让.Net使用它的的执行线程。例如，如果使用了异步的方式在创建一个Web应用，当我们等待数据库完成处理一个请求（无论它是一个保存还是检索操作）时，通过将web工作线程释放回线程池，就可以更有效地利用服务器资源。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">即使在桌面应用中，异步API也很有用，因为用户可能会潜在执行应用中的其他任务，而不是等待一个可能耗时的查询或保存操作。换言之，.Net线程不需要等待数据库线程完成跟数据库有关的工作。在许多应用程序中，异步API没有带来好处，从性能的角度来说，甚至可能是有害的，因为线程上下文的切换开销。因此，在使用异步API之前，开发者需要确定使用异步API会让你受益！</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">EF暴露了很多异步操作，按照约定，所有的这些方法都以<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Async</code>后缀结尾。对于保存操作，我们可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">DbContext</code>上的<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SaveChangesAsync</code>方法。也有很多查询的方法，比如，许多聚合函数都有异步副本，比如<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SumAsync</code>和<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">AverageAsync</code>。还可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ToListAsync</code>和<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ToArrayAsync</code>将一个结果集读入到一个list或者array中。此外，还可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ForEachAsync</code>方法对一个查询结果进行枚举。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">异步地从数据库中获取对象的列表</h4> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">region</span> 3.0 异步API</span>

<span class="hljs-comment" style="color:#008000;">//3.1 异步查询对象列表</span>
<span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">async</span> Task&lt;IEnumerable&lt;Donator&gt;&gt; GetDonatorsAsync()
{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
        <span class="hljs-keyword" style="color:rgb(0,0,255);">return</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">await</span> db.Donators.ToListAsync();
    }
}  

<span class="hljs-meta" style="color:rgb(43,145,175);">#<span class="hljs-meta-keyword">endregion</span></span>
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">值得注意的是，这里使用了典型的<strong>async/await</strong>用法模式。函数被标记为&nbsp;<strong>async</strong>并返回一个task对象，确切地说是一个Donator集合的task。然后，调用了DbContext的集合属性创建了一个返回所有Donator的查询。然后，使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ToListAsync</code>扩展方法对该查询结果进行枚举。最后，由于我们需要遵守async/await模式，所以必须等待返回值。</p> 
   <blockquote style="border:2px solid rgb(239,239,239);line-height:1.6;color:rgb(51,51,51);font-size:15px;font-family:'Microsoft Yahei';clear:both;background:rgb(223,255,163) url(&quot;//files.cnblogs.com/files/farb/o_title.gif&quot;) no-repeat 9px 50%;"> 
    <p>任何EF查询都可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ToListAsync</code>或者<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ToArrayAsync</code>转换成异步版本。</p> 
   </blockquote> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">异步创建一个新的对象</h4> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//3.2 异步创建一个新的对象</span>
<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">async</span> Task <span class="hljs-title" style="color:rgb(163,21,21);">InsertDonatorAsync</span>(<span class="hljs-params">Donator donator</span>) </span>{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
        db.Donators.Add(donator);
        <span class="hljs-keyword" style="color:rgb(0,0,255);">await</span> db.SaveChangesAsync();
    }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">代码很简单，和一般的同步模式比较，只是返回类型为Task，方法多了async修饰，调用了SaveChangesAsync方法，同时注意，自己定义的方法最好也以Async后缀结尾，不是必须的，只是为了遵守规范。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">异步定位一条记录</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们可以异步定位一条记录，可以使用很多方法，比如<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">Single</code>或<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">First</code>，这两个方法都有异步版本。</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//3.3 异步定位一条记录</span>
<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">async</span> Task&lt;Donator&gt; <span class="hljs-title" style="color:rgb(163,21,21);">FindDonatorAsync</span>(<span class="hljs-params"><span class="hljs-keyword" style="color:rgb(0,0,255);">int</span> donatorId</span>) </span>{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
      <span class="hljs-keyword" style="color:rgb(0,0,255);">return</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">await</span> db.Donators.FindAsync(donatorId);
    }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">一般来说，就参数而言，EF中的所有异步方法和它们的同步副本都有相同的方法签名。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">异步聚合函数</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">对应于同步版本，异步聚合函数包括这么几个方法，<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">MaxAsync</code>,<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">MinAsync</code>,<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">CountAsync</code>,<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SumAsync</code>,<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">AverageAsync</code>。</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//3.4 异步聚合函数</span>
<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">async</span> Task&lt;<span class="hljs-keyword" style="color:rgb(0,0,255);">int</span>&gt; <span class="hljs-title" style="color:rgb(163,21,21);">GetDonatorCountAsync</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
        <span class="hljs-keyword" style="color:rgb(0,0,255);">return</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">await</span> db.Donators.CountAsync();
    }
}

</code></pre> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;">异步遍历查询结果</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果要对查询结果进行异步遍历，可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ForEachAsync</code>，可以在任何查询之后使用该方法。比如，下面将每个打赏者的打赏日期设置为今天。</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-comment" style="color:#008000;">//3.5 异步遍历查询结果</span>
<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">static</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">async</span> Task <span class="hljs-title" style="color:rgb(163,21,21);">LoopDonatorsAsync</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword" style="color:rgb(0,0,255);">using</span> (<span class="hljs-keyword" style="color:rgb(0,0,255);">var</span> db = <span class="hljs-keyword" style="color:rgb(0,0,255);">new</span> DonatorsContext())
    {
        <span class="hljs-keyword" style="color:rgb(0,0,255);">await</span> db.Donators.ForEachAsync(d =&gt;
        {
            d.DonateDate=DateTime.Today;
        });
    }
}

</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果要在一个同步方法中使用一个异步方法，那么我们可以使用Task的API等待一个任务完成。比如，我们可以访问task的Result属性，这会造成当前的线程暂停并且让该task完成执行，但一般不建议这么做，最佳实践是<strong>总是使用async</strong>。<br> 同步方法中调用异步方法的代码如下：</p> 
   <pre class="c#"><code class="hljs css" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-selector-tag" style="color:rgb(0,0,255);">Console</span><span class="hljs-selector-class">.WriteLine</span>(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">FindDonatorAsync</span>(1)<span class="hljs-selector-class">.Result</span><span class="hljs-selector-class">.DonateDate</span>);
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">上面这句代码在Main方法中，调用了之前定义的异步方法，然后访问了该Task的Result属性，这会造成异步函数完成执行。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">当决定是否使用异步API的时候，首先要研究一下，并确定为什么要使用异步API。既然用了异步API，为了获得最大的编码好处，就要确保整个方法的调用连都是异步的。最后，当需要时在使用Task API。</p> 
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="summary" style="color:rgb(224,130,131);"></a>本章小结</h3> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">EF给开发者带来了很大价值，允许我们使用C#代码管理数据库数据。然而，有时我们需要通过动态的SQL语句或者存储过程，更直接地对视图访问数据，就可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">ExecuteSqlCommand</code>方法来执行任意的SQL代码，包括原生SQL或者存储过程。也可以使用<code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">SqlQuery</code>方法从视图、存储过程或任何SQL语句中检索数据，EF会基于我们提供的结果类型物质化查询结果。当给这两个方法提供参数时，避免SQL注入漏洞很重要。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">EF也可以自动为实体生成插入、更新和删除的存储过程，假如你对这些存储过程的命名规范和编码标准满意的话，我们只需要在配置伙伴类中写一行代码就可以了。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">EF也提供了异步操作支持，包括查询和更新。为了避免潜在的性能影响，开发者使用这些技术时务必谨慎。在某些技术中，异步API很适合，Web API就是一个好的例子。</p> 
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="selftest" style="color:rgb(224,130,131);"></a>自我测试</h3> 
   <ol style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <li style="list-style:decimal;">EF不能从视图获取数据，对吗？</li> 
    <li style="list-style:decimal;">哪个数据库方法可以使用SQL语句查询和检索数据？ 
     <ol>
      <li style="list-style:decimal;">ExecuteSqlCommand</li> 
      <li style="list-style:decimal;">Execute</li> 
      <li style="list-style:decimal;">SqlQuery</li> 
     </ol></li> 
    <li style="list-style:decimal;">如果你想为一个实体类型的CRUD操作映射到一组存储过程，就必须手动写所有的SQL Server存储过程，对吗？</li> 
    <li style="list-style:decimal;">使用异步API没有负面影响，对吗？</li> 
    <li style="list-style:decimal;"> <code style="line-height:1.8;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">DbContext</code>中用于异步保存更改的是什么方法？</li> 
   </ol>
   <div>
    <font color="#494949"><span style="font-size:15px;line-height:25px;"><br></span></font>
   </div> 
   <div>
    <font color="#494949"><span style="font-size:15px;line-height:25px;"><br></span></font>
   </div> 
   <div>
    <font color="#494949"><span style="font-size:15px;line-height:25px;"><br></span></font>
   </div> 
   <div>
    <font color="#494949"><span style="font-size:15px;line-height:25px;"><br></span></font>
   </div> 
   <div>
    <font color="#494949"><span style="font-size:15px;line-height:25px;">本文转自tkbSimplest博客园博客，原文链接：http://www.cnblogs.com/farb/p/ViewStoreProcAndAsyncAPI.html，如需转载请自行联系原作者</span><br></font>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
