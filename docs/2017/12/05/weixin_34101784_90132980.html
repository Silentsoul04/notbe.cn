<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>linux下C语言实现的内存池【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://blog.chinaunix.net/uid-28458801-id-4254501.html    操作系统：ubuntu10.04前言： &nbsp; &nbsp; 在通信过程中，无法知道将会接收到的数据的长度，因此开一个固定大小的缓冲区并不合适，开大了，很可能大...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/05/weixin_34101784_90132980.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">linux下C语言实现的内存池【转】</h1>
    <p class="post-meta">Dec 5, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">转自：<a href="http://blog.chinaunix.net/uid-28458801-id-4254501.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://blog.chinaunix.net/uid-28458801-id-4254501.html</a></p> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong><span style="color:rgb(229,51,51);font-size:24px;">操作系统：ubuntu10.04</span></strong><br><br><strong><span style="color:rgb(229,51,51);font-size:24px;">前言：</span></strong><br> &nbsp; &nbsp; 在通信过程中，无法知道将会接收到的数据的长度，因此开一个固定大小的缓冲区并不合适，开大了，很可能大多数通信都只是几十个自己而已；开小了，又无法处理大数据。因此最好的方法就是创建内存池，根据实际情况，分配合适大小的内存空间。<br><br><strong><span style="color:rgb(229,51,51);font-size:24px;">一，思路</span></strong><br><img src="http://blog.chinaunix.net/attachment/201405/15/28458801_1400136867cyPw.jpg" alt="" width="394" height="348" style="border:none;"><br><br> &nbsp; &nbsp; 通过双向链表，管理所有的内存池。<br><br><br><strong><span style="color:rgb(229,51,51);font-size:24px;">二，实现</span></strong><br> &nbsp; &nbsp; 1，内存池的相关信息结构体</p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">struct pool_head&nbsp;<span style="color:rgb(0,0,204);">{<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>*free_list<span>;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct list_head &nbsp;&nbsp;&nbsp;&nbsp;list<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* list of all known pools&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks are currently&nbsp;<span style="color:rgb(0,0,255);">in use&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocated<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks have been allocated&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;limit<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* hard limit&nbsp;<span style="color:rgb(0,0,255);">on the number of chunks&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minavail<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks are expected&nbsp;<span style="color:rgb(0,0,255);">to be used&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* chunk size&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flags<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* MEM_F_<span>*&nbsp;<span>*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* number of pools sharing this zone&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int8_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span style="color:rgb(0,0,204);">[12<span>]<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* name of the pool&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<span>;</span></span></li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br> &nbsp; &nbsp; 2，具体实现<br> &nbsp; &nbsp;&nbsp;&nbsp; &nbsp; a，头文件（pools.h）</p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#ifndef __POOLS_H__<br></span></li> 
      <li style="list-style:decimal;">#define __POOLS_H__<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;">extern&nbsp;<span style="color:rgb(255,0,255);">"C"&nbsp;<span style="color:rgb(0,0,204);">{<br></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Define&nbsp;<span style="color:rgb(0,0,255);">to prevent recursive inclusion&nbsp;<br></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"types.h"<br></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"list.h"<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#define MEM_F_SHARED&nbsp;&nbsp;&nbsp;&nbsp;0x1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* 标示对应的池允许共用&nbsp;<span>*<span>/<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 每个池的相关信息&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">struct pool_head&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>*free_list<span>;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct list_head &nbsp;&nbsp;&nbsp;&nbsp;list<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* list of all known pools&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks are currently&nbsp;<span style="color:rgb(0,0,255);">in use&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocated<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks have been allocated&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;limit<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* hard limit&nbsp;<span style="color:rgb(0,0,255);">on the number of chunks&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minavail<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* how many chunks are expected&nbsp;<span style="color:rgb(0,0,255);">to be used&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* chunk size&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flags<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* MEM_F_<span>*&nbsp;<span>*<span>/<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users<span style="color:rgb(0,0,204);">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* number of pools sharing this zone&nbsp;<span>*<span>/<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int8_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name<span style="color:rgb(0,0,204);">[12<span>]<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>* name of the pool&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<span>;<br></span></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 池创建&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Try&nbsp;<span style="color:rgb(0,0,255);">to find an existing shared pool with the same characteristics&nbsp;<span>and<br></span></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* returns it<span>, otherwise creates this one<span>.&nbsp;<span style="color:rgb(0,0,255);">NULL&nbsp;<span>is returned&nbsp;<span>if no memory<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is available&nbsp;<span>for a new creation<span style="color:rgb(0,0,204);">.<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">extern &nbsp;&nbsp;&nbsp;&nbsp;struct pool_head&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;pool_create<span>(char&nbsp;<span>*name<span>, uint32_t size<span>, uint32_t flags<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 池销毁&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function destroys a pool by freeing it completely<span style="color:rgb(0,0,204);">, unless it<span>'s still<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">in use<span style="color:rgb(0,0,204);">. This should be called only under extreme circumstances<span>. It always<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* returns&nbsp;<span style="color:rgb(0,0,255);">NULL&nbsp;<span>if the resulting pool&nbsp;<span>is&nbsp;<span>empty<span style="color:rgb(0,0,204);">, easing the clearing of the old<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* pointer<span>, otherwise it returns the pool<span>.<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span>.<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;void<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_destroy<span>(struct pool_head&nbsp;<span>*pool<span>)<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 把池中的空闲的元素都给释放掉&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function frees whatever can be freed&nbsp;<span>in pool&nbsp;<span style="color:rgb(0,0,204);">&lt;pool<span>&gt;<span>.<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">extern &nbsp;&nbsp;&nbsp;&nbsp;void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_clear<span style="color:rgb(0,0,204);">(struct pool_head&nbsp;<span>*pool<span>)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 把池中非必要的元素给释放掉&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function frees whatever can be freed&nbsp;<span>in all pools<span style="color:rgb(0,0,204);">, but respecting<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* the minimum thresholds imposed by owners<span>. It takes care of avoiding<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* recursion because it may be called from a signal handler<span>.<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_flush_nonessential<span style="color:rgb(0,0,204);">(void<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 动态分配一个 pool 元素大小的内存空间&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Allocate a new entry&nbsp;<span style="color:rgb(0,0,255);">for pool&nbsp;<span style="color:rgb(0,0,204);">&lt;pool<span>&gt;<span>,&nbsp;<span style="color:rgb(0,0,255);">and return it&nbsp;<span>for immediate use<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">NULL&nbsp;<span>is returned&nbsp;<span>if no memory&nbsp;<span>is available&nbsp;<span>for a new creation<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_refill_alloc<span>(struct pool_head&nbsp;<span>*pool<span>)<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* Returns a pointer&nbsp;<span style="color:rgb(0,0,255);">to type&nbsp;<span style="color:rgb(0,0,204);">&lt;type<span>&gt; taken from the<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* pool&nbsp;<span>&lt;pool_type<span>&gt;&nbsp;<span style="color:rgb(0,0,255);">or dynamically allocated<span style="color:rgb(0,0,204);">.&nbsp;<span style="color:rgb(0,0,255);">In the<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* first&nbsp;<span style="color:rgb(0,0,255);">case<span style="color:rgb(0,0,204);">,&nbsp;<span>&lt;pool_type<span>&gt;&nbsp;<span style="color:rgb(0,0,255);">is updated&nbsp;<span>to point&nbsp;<span>to the<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(255,0,0);">element&nbsp;<span style="color:rgb(0,0,255);">in the list<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">#define pool_alloc<span style="color:rgb(0,0,204);">(pool<span>)&nbsp;<span>\<br></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">(<span>{&nbsp;<span>\<br></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">*__p<span>;&nbsp;<span>\<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>(__p&nbsp;<span>=&nbsp;<span>(pool<span>)<span>-<span>&gt;free_list<span>)&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>\<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__p&nbsp;<span style="color:rgb(0,0,204);">= pool_refill_alloc<span>(pool<span>)<span>;&nbsp;<span>\<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else&nbsp;<span style="color:rgb(0,0,204);">{&nbsp;<span>\<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(pool<span>)<span>-<span>&gt;free_list&nbsp;<span>=&nbsp;<span>*<span>(void&nbsp;<span>*<span>*<span>)<span>(pool<span>)<span>-<span>&gt;free_list<span>;<span>\<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(pool<span>)<span>-<span>&gt;used<span>+<span>+<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>\<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}&nbsp;<span>\<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__p<span style="color:rgb(0,0,204);">;&nbsp;<span>\<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<span>)<br></span></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* Puts a memory area back&nbsp;<span style="color:rgb(0,0,255);">to the corresponding pool<span style="color:rgb(0,0,204);">.<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* Items are chained directly through a pointer that<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is written&nbsp;<span>in the beginning of the memory area<span style="color:rgb(0,0,204);">, so<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* there<span>'s no need&nbsp;<span style="color:rgb(0,0,255);">for any carrier cell<span style="color:rgb(0,0,204);">. This implies<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* that&nbsp;<span style="color:rgb(0,0,255);">each memory area&nbsp;<span>is at least as big as one<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* pointer<span>. Just like with the libc<span>'s free<span>(<span>)<span>,&nbsp;<span style="color:rgb(0,0,255);">nothing<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is done&nbsp;<span>if&nbsp;<span style="color:rgb(0,0,204);">&lt;ptr<span>&gt;&nbsp;<span style="color:rgb(0,0,255);">is&nbsp;<span>NULL<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">#define pool_free<span style="color:rgb(0,0,204);">(pool<span>, ptr<span>)&nbsp;<span>\<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">(<span>{&nbsp;<span>\<br></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>(ptr<span>)&nbsp;<span>!<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)&nbsp;<span>{&nbsp;<span>\<br></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>(void&nbsp;<span>*<span>*<span>)<span>(ptr<span>)&nbsp;<span>=&nbsp;<span>(void&nbsp;<span>*<span>)<span>(pool<span>)<span>-<span>&gt;free_list<span>;&nbsp;&nbsp;&nbsp;&nbsp;<span>\<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(pool<span>)<span>-<span>&gt;free_list&nbsp;<span>=&nbsp;<span>(void&nbsp;<span>*<span>)<span>(ptr<span>)<span>;&nbsp;&nbsp;&nbsp;&nbsp;<span>\<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(pool<span>)<span>-<span>&gt;used<span>-<span>-<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>\<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}&nbsp;<span>\<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<span>)<br></span></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#endif</li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; b，c文件<span><span>（pools.c<span>）<br></span></span></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#include&nbsp;<span style="color:rgb(255,0,255);">"pools.h"<br></span></span></li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"standard.h"<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 管理所有池的链表头&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">static struct list_head&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pools&nbsp;<span style="color:rgb(0,0,204);">= LIST_HEAD_INIT<span>(pools<span>)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 池创建&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Try&nbsp;<span style="color:rgb(0,0,255);">to find an existing shared pool with the same characteristics&nbsp;<span>and<br></span></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* returns it<span>, otherwise creates this one<span>.&nbsp;<span style="color:rgb(0,0,255);">NULL&nbsp;<span>is returned&nbsp;<span>if no memory<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">is available&nbsp;<span>for a new creation<span style="color:rgb(0,0,204);">.<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">struct pool_head&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;pool_create<span>(char&nbsp;<span>*name<span>, uint32_t size<span>, uint32_t flags<span>)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct pool_head&nbsp;<span style="color:rgb(0,0,204);">*pool<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct pool_head&nbsp;<span style="color:rgb(0,0,204);">*entry<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct list_head&nbsp;<span style="color:rgb(0,0,204);">*start<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; align<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* We need&nbsp;<span style="color:rgb(0,0,255);">to store at least a&nbsp;<span style="color:rgb(0,0,204);">(void&nbsp;<span>*<span>)&nbsp;<span style="color:rgb(0,0,255);">in the chunks<span style="color:rgb(0,0,204);">. Since we know<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* that the malloc<span>(<span>)&nbsp;<span style="color:rgb(0,0,255);">function will never return such a small size<span style="color:rgb(0,0,204);">,<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">let<span style="color:rgb(0,0,204);">'s&nbsp;<span style="color:rgb(255,0,0);">round the size up&nbsp;<span style="color:rgb(0,0,255);">to something slightly bigger<span style="color:rgb(0,0,204);">,&nbsp;<span style="color:rgb(0,0,255);">in order&nbsp;<span>to<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* ease merging of entries<span>. Note that the rounding&nbsp;<span style="color:rgb(0,0,255);">is a power of two<span style="color:rgb(0,0,204);">.<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;align&nbsp;<span style="color:rgb(0,0,204);">= 16<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>(size&nbsp;<span>+ align&nbsp;<span>- 1<span>)&nbsp;<span>&amp;&nbsp;<span>-align<span>;<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>&amp;pools<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pool&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;list_for_each_entry<span style="color:rgb(0,0,204);">(entry<span>,&nbsp;<span>&amp;pools<span>, list<span>)&nbsp;<span>{<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(entry<span>-<span>&gt;size&nbsp;<span>=<span>= size<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* either we can share this place&nbsp;<span style="color:rgb(0,0,255);">and we take it<span style="color:rgb(0,0,204);">,&nbsp;<span style="color:rgb(0,0,255);">or<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* we look&nbsp;<span style="color:rgb(0,0,255);">for a sharable one&nbsp;<span>or&nbsp;<span>for the&nbsp;<span>next position<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">* before which we will insert a new one<span>.<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(flags&nbsp;<span>&amp; entry<span>-<span>&gt;flags&nbsp;<span>&amp; MEM_F_SHARED<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* we can share this one&nbsp;<span>*<span>/<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool&nbsp;<span style="color:rgb(0,0,204);">= entry<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else&nbsp;<span>if&nbsp;<span style="color:rgb(0,0,204);">(entry<span>-<span>&gt;size&nbsp;<span>&gt; size<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* insert before this one&nbsp;<span>*<span>/<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>&amp;entry<span>-<span>&gt;list<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!pool<span>)&nbsp;<span>{<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool&nbsp;<span style="color:rgb(0,0,204);">= calloc<span>(1<span>, sizeof<span>(<span>*pool<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!pool<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(name<span>)<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strlcpy<span style="color:rgb(0,0,204);">(pool<span>-<span>&gt;name<span>,&nbsp;<span>(int8_t<span>*<span>)name<span>, sizeof<span>(pool<span>-<span>&gt;name<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;size&nbsp;<span>= size<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;flags&nbsp;<span>= flags<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_add_tail<span style="color:rgb(0,0,204);">(<span>&amp;pool<span>-<span>&gt;list<span>,start<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;users<span>+<span>+<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return pool<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 池销毁&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">void<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_destroy<span>(struct pool_head&nbsp;<span>*pool<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(pool<span>)&nbsp;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_clear<span style="color:rgb(0,0,204);">(pool<span>)<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 请看池中的空闲的元素<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(pool<span>-<span>&gt;used<span>)<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return pool<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;users<span>-<span>-<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!pool<span>-<span>&gt;users<span>)&nbsp;<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_del<span style="color:rgb(0,0,204);">(<span>&amp;pool<span>-<span>&gt;list<span>)<span>;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 从 pools 链表中删除<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free<span style="color:rgb(0,0,204);">(pool<span>)<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 把 pool 结构体占用的内存给释放了<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 把池中的空闲的元素都给释放掉&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function frees whatever can be freed&nbsp;<span>in pool&nbsp;<span style="color:rgb(0,0,204);">&lt;pool<span>&gt;<span>.<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_clear<span style="color:rgb(0,0,204);">(struct pool_head&nbsp;<span>*pool<span>)<br></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">*temp<span>,&nbsp;<span>*<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!pool<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(0,0,204);">= pool<span>-<span>&gt;free_list<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">while&nbsp;<span style="color:rgb(0,0,204);">(<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">)&nbsp;<span>{<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>*<span>(void&nbsp;<span>*<span>*<span>)temp<span>;<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;allocated<span>-<span>-<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free<span style="color:rgb(0,0,204);">(temp<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;free_list&nbsp;<span>=&nbsp;<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>* here<span>, we should have pool<span>-<span>&gt;allocate&nbsp;<span>=<span>= pool<span>-<span>&gt;used&nbsp;<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 把池中非必要的元素给释放掉&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This&nbsp;<span style="color:rgb(0,0,255);">function frees whatever can be freed&nbsp;<span>in all pools<span style="color:rgb(0,0,204);">, but respecting<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* the minimum thresholds imposed by owners<span>. It takes care of avoiding<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* recursion because it may be called from a signal handler<span>.<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">void &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_flush_nonessential<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;<span style="color:rgb(255,0,0);">int recurse<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct pool_head&nbsp;<span style="color:rgb(0,0,204);">*entry<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(recurse<span>+<span>+<span>)<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto out<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;list_for_each_entry<span style="color:rgb(0,0,204);">(entry<span>,&nbsp;<span>&amp;pools<span>, list<span>)&nbsp;<span>{<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">*temp<span>,&nbsp;<span>*<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">/<span>/qfprintf<span>(stderr<span>,&nbsp;<span style="color:rgb(255,0,255);">"Flushing pool %s\n"<span style="color:rgb(0,0,204);">, entry<span>-<span>&gt;name<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(0,0,204);">= entry<span>-<span>&gt;free_list<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">while&nbsp;<span style="color:rgb(0,0,204);">(<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(0,0,204);">&amp;<span>&amp;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entry<span style="color:rgb(0,0,204);">-<span>&gt;allocated&nbsp;<span>&gt; entry<span>-<span>&gt;minavail&nbsp;<span>&amp;<span>&amp;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; entry<span style="color:rgb(0,0,204);">-<span>&gt;allocated&nbsp;<span>&gt; entry<span>-<span>&gt;used<span>)&nbsp;<span>{<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">next&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>*<span>(void&nbsp;<span>*<span>*<span>)temp<span>;<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry<span style="color:rgb(0,0,204);">-<span>&gt;allocated<span>-<span>-<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free<span style="color:rgb(0,0,204);">(temp<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry<span style="color:rgb(0,0,204);">-<span>&gt;free_list&nbsp;<span>=&nbsp;<span style="color:rgb(0,0,255);">next<span style="color:rgb(0,0,204);">;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;out<span style="color:rgb(0,0,204);">:<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;recurse<span style="color:rgb(0,0,204);">-<span>-<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 动态分配一个 pool 元素大小的内存空间&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Allocate a new entry&nbsp;<span style="color:rgb(0,0,255);">for pool&nbsp;<span style="color:rgb(0,0,204);">&lt;pool<span>&gt;<span>,&nbsp;<span style="color:rgb(0,0,255);">and return it&nbsp;<span>for immediate use<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">NULL&nbsp;<span>is returned&nbsp;<span>if no memory&nbsp;<span>is available&nbsp;<span>for a new creation<span style="color:rgb(0,0,204);">. A&nbsp;<span style="color:rgb(0,0,255);">call<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">to the garbage collector&nbsp;<span>is performed before returning&nbsp;<span>NULL<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">void&nbsp;<span style="color:rgb(0,0,204);">*pool_refill_alloc<span>(struct pool_head&nbsp;<span>*pool<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<span style="color:rgb(0,0,204);">*ret<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(pool<span>-<span>&gt;limit&nbsp;<span>&amp;<span>&amp;&nbsp;<span>(pool<span>-<span>&gt;allocated&nbsp;<span>&gt;<span>= pool<span>-<span>&gt;limit<span>)<span>)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= calloc<span>(1<span>, pool<span>-<span>&gt;size<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!ret<span>)&nbsp;<span>{<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_flush_nonessential<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= calloc<span>(1<span>, pool<span>-<span>&gt;size<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(<span>!ret<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;allocated<span>+<span>+<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pool<span style="color:rgb(0,0,204);">-<span>&gt;used<span>+<span>+<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 销毁所有的池&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dump_pools<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= OPER_OK<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c，辅助文件<span>（standard.c<span>）<span><br></span></span></span></span></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(0,0,204);">/<span>*<br></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* copies at most&nbsp;<span>&lt;size<span>-1<span>&gt; chars from&nbsp;<span>&lt;src<span>&gt;&nbsp;<span style="color:rgb(0,0,255);">to&nbsp;<span style="color:rgb(0,0,204);">&lt;dst<span>&gt;<span>. Last char&nbsp;<span style="color:rgb(0,0,255);">is always<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span style="color:rgb(0,0,255);">set&nbsp;<span>to 0<span style="color:rgb(0,0,204);">, unless&nbsp;<span>&lt;size<span>&gt;&nbsp;<span style="color:rgb(0,0,255);">is 0<span style="color:rgb(0,0,204);">. The number of chars copied&nbsp;<span style="color:rgb(0,0,255);">is returned<br></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*&nbsp;<span>(excluding the terminating zero<span>)<span>.<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* This code has been optimized&nbsp;<span style="color:rgb(0,0,255);">for size&nbsp;<span>and speed&nbsp;<span style="color:rgb(0,0,204);">:&nbsp;<span style="color:rgb(0,0,255);">on x86<span style="color:rgb(0,0,204);">, it<span>'s 45 bytes<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* long<span>, uses only registers<span>,&nbsp;<span style="color:rgb(0,0,255);">and consumes only 4 cycles per char<span style="color:rgb(0,0,204);">.<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;strlcpy<span style="color:rgb(0,0,204);">(int8_t<span>*dst<span>,&nbsp;<span style="color:rgb(0,0,255);">const int8_t<span style="color:rgb(0,0,204);">*src<span>, int32_t size<span>)<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int8_t&nbsp;<span style="color:rgb(0,0,204);">*orig&nbsp;<span>= dst<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(size<span>)&nbsp;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">while&nbsp;<span style="color:rgb(0,0,204);">(<span>-<span>-size&nbsp;<span>&amp;<span>&amp;&nbsp;<span>(<span>*dst&nbsp;<span>=&nbsp;<span>*src<span>)<span>)&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src<span style="color:rgb(0,0,204);">+<span>+<span>; dst<span>+<span>+<span>;<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*dst&nbsp;<span>= 0<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return dst&nbsp;<span style="color:rgb(0,0,204);">- orig<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; d，辅助文件（types.h）<br></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#ifndef __TYPES_H__<br></span></li> 
      <li style="list-style:decimal;">#define __TYPES_H__<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;">extern&nbsp;<span style="color:rgb(255,0,255);">"C"&nbsp;<span style="color:rgb(0,0,204);">{<br></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Define&nbsp;<span style="color:rgb(0,0,255);">to prevent recursive inclusion&nbsp;<br></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdio<span>.h<span>&gt; &nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 标准输入输出定义<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;stdlib<span>.h<span>&gt; &nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 标准函数库定义<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;<span style="color:rgb(255,0,0);">string<span style="color:rgb(0,0,204);">.h<span>&gt;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ memset<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;unistd<span>.h<span>&gt; &nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ Unix标准函数定义，read<span>,write<span>.<span>.<span>.<br></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;sys<span>/types<span>.h<span>&gt;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;sys<span>/stat<span>.h<span>&gt;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;fcntl<span>.h<span>&gt;&nbsp;<span>/<span>/ 文件控制定义<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;termios<span>.h<span>&gt; &nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ POSIX中断控制定义<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;errno<span>.h<span>&gt; &nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ 错误号定义<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(0,0,204);">&lt;pthread<span>.h<span>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>/<span>/ pthread_t<span>,pthread_create<span>.<span>.<span>.<br></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"error.h"<br></span> </li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"debug.h"<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 类型定义&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">typedef signed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int8_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">typedef unsigned &nbsp;&nbsp;&nbsp;&nbsp;char &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">typedef signed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int16_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">typedef unsigned &nbsp;&nbsp;&nbsp;&nbsp;short &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint16_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">typedef signed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int32_t<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;">typedef unsigned &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(255,0,0);">int &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint32_t<span style="color:rgb(0,0,204);">;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">typedef signed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long long &nbsp;&nbsp;&nbsp;&nbsp;int64_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">typedef unsigned long long &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint64_t<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#define&nbsp;&nbsp;&nbsp;&nbsp;BUFFER_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;256<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 1，COM，串口相关<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">#define&nbsp;&nbsp;&nbsp;&nbsp;COM_TYPE_UPPER_DEVICE&nbsp;&nbsp;&nbsp;&nbsp;1<br></li> 
      <li style="list-style:decimal;">#define&nbsp;&nbsp;&nbsp;&nbsp;COM_TYPE_LOWER_DEVICE&nbsp;&nbsp;&nbsp;&nbsp;2<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#define&nbsp;&nbsp;&nbsp;&nbsp;COM_BUFFER_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(BUFFER_SIZE<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 2，pools，池相关&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 3，命令相关<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">#define&nbsp;&nbsp;&nbsp;&nbsp;CMD_DATA_LEN_MAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">(BUFFER_SIZE<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#endif</li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br><br><br><strong><span style="color:rgb(229,51,51);font-size:24px;">三，实例</span></strong><br> &nbsp; &nbsp; 1，头文件（command.h）<br></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#ifndef __COMMAND_H__<br></span></li> 
      <li style="list-style:decimal;">#define __COMMAND_H__<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;">extern&nbsp;<span style="color:rgb(255,0,255);">"C"&nbsp;<span style="color:rgb(0,0,204);">{<br></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* Define&nbsp;<span style="color:rgb(0,0,255);">to prevent recursive inclusion&nbsp;<br></span></span></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>-<span>*<span>/<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"types.h"<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>* 接收到的命令的来源等&nbsp;<span>*<span>/<br></span></span></span></span></li> 
      <li style="list-style:decimal;">typedef&nbsp;&nbsp;&nbsp;&nbsp;struct _cmd<br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;&nbsp;&nbsp;&nbsp;id<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;void<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}cmd_t<span>;<br></span></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 创建内存池<br></span></span></li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_create<span style="color:rgb(0,0,204);">(void<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 释放内存池<br></span></span></li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_destroy<span style="color:rgb(0,0,204);">(void<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 申请命令内存块，用以保存命令数据<br></span></span></li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_alloc<span style="color:rgb(0,0,204);">(cmd_t&nbsp;&nbsp;&nbsp;&nbsp;<span>*<span>*param<span>)<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 释放命令内存块<br></span></span></li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_free<span style="color:rgb(0,0,204);">(cmd_t&nbsp;&nbsp;&nbsp;&nbsp;<span>*param<span>)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef DEBUG_POOL<br></li> 
      <li style="list-style:decimal;">extern&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_info<span style="color:rgb(0,0,204);">(void<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef __cplusplus<br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#endif</li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br> &nbsp; &nbsp; 2，c文件（command.c）<br></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);">#include&nbsp;<span style="color:rgb(255,0,255);">"command.h"<br></span></span></li> 
      <li style="list-style:decimal;">#include&nbsp;<span style="color:rgb(255,0,255);">"pools.h"<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">static&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;&nbsp;&nbsp;&nbsp;pool_head&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*cmd_head_pool&nbsp;<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">static&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;&nbsp;&nbsp;&nbsp;pool_head&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*cmd_data_pool&nbsp;<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 创建内存池<br></span></span></li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_create<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= OPER_OK<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(cmd_head_pool&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(cmd_head_pool&nbsp;<span>= pool_create<span>(<span style="color:rgb(255,0,255);">"cmd_head"<span style="color:rgb(0,0,204);">, sizeof<span>(cmd_t<span>)<span>, MEM_F_SHARED<span>)<span>)&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-POOL_CREATE_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if&nbsp;<span style="color:rgb(0,0,204);">(cmd_data_pool&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(cmd_data_pool&nbsp;<span>= pool_create<span>(<span style="color:rgb(255,0,255);">"cmd_data"<span style="color:rgb(0,0,204);">, CMD_DATA_LEN_MAX<span>, MEM_F_SHARED<span>)<span>)&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_destroy<span style="color:rgb(0,0,204);">(<span>)<span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-POOL_CREATE_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef DEBUG_POOL<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_info<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef DEBUG_POOL<br></li> 
      <li style="list-style:decimal;">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_info<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;&nbsp;&nbsp;&nbsp;pool_head&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">*entry&nbsp;<span>= cmd_head_pool<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"pool %s (%d bytes) : %d allocated (%u bytes), %d used\n"<span style="color:rgb(0,0,204);">,entry<span>-<span>&gt;name<span>, entry<span>-<span>&gt;size<span>, entry<span>-<span>&gt;allocated<span>,entry<span>-<span>&gt;size&nbsp;<span>* entry<span>-<span>&gt;allocated<span>, entry<span>-<span>&gt;used<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;entry&nbsp;<span style="color:rgb(0,0,204);">= cmd_data_pool<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"pool %s (%d bytes) : %d allocated (%u bytes), %d used\n"<span style="color:rgb(0,0,204);">,entry<span>-<span>&gt;name<span>, entry<span>-<span>&gt;size<span>, entry<span>-<span>&gt;allocated<span>,entry<span>-<span>&gt;size&nbsp;<span>* entry<span>-<span>&gt;allocated<span>, entry<span>-<span>&gt;used<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 释放内存池<br></span></span></li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_destroy<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= OPER_OK<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef DEBUG_POOL<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_info<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(cmd_head_pool&nbsp;<span>!<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span style="color:rgb(0,0,255);">NULL&nbsp;<span style="color:rgb(0,0,204);">!<span>= pool_destroy<span>(cmd_head_pool<span>)<span>)<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-POOL_DESTROY_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(cmd_data_pool&nbsp;<span>!<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span style="color:rgb(0,0,255);">NULL&nbsp;<span style="color:rgb(0,0,204);">!<span>= pool_destroy<span>(cmd_data_pool<span>)<span>)<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-POOL_DESTROY_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 申请命令内存块，用以保存命令数据<br></span></span></li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_alloc<span style="color:rgb(0,0,204);">(cmd_t&nbsp;&nbsp;&nbsp;&nbsp;<span>*<span>*param<span>)<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= OPER_OK<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(<span>*param&nbsp;<span>=&nbsp;<span>(cmd_t<span>*<span>)pool_alloc<span>(cmd_head_pool<span>)<span>)&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-CMD_POOL_ALLOC_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset<span style="color:rgb(0,0,204);">(<span>*param<span>,0<span>,sizeof<span>(cmd_t<span>)<span>)<span>;<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(<span>(<span>*param<span>)<span>-<span>&gt;data&nbsp;<span>= pool_alloc<span>(cmd_data_pool<span>)<span>)&nbsp;<span>=<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_free<span style="color:rgb(0,0,204);">(<span>*param<span>)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span>-CMD_POOL_ALLOC_ERROR<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">#ifdef DEBUG_POOL<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_info<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;">#endif<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/ 释放命令内存块<br></span></span></li> 
      <li style="list-style:decimal;">int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_free<span style="color:rgb(0,0,204);">(cmd_t&nbsp;&nbsp;&nbsp;&nbsp;<span>*param<span>)<br></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(param<span>-<span>&gt;data&nbsp;<span>!<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_free<span style="color:rgb(0,0,204);">(cmd_data_pool<span>,param<span>-<span>&gt;data<span>)<span>;<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param<span style="color:rgb(0,0,204);">-<span>&gt;data&nbsp;<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(param&nbsp;<span>!<span>=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">)<br></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool_free<span style="color:rgb(0,0,204);">(cmd_head_pool<span>,param<span>)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param&nbsp;<span style="color:rgb(0,0,204);">=&nbsp;<span style="color:rgb(0,0,255);">NULL<span style="color:rgb(0,0,204);">;<br></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">&nbsp;&nbsp;&nbsp;&nbsp;<br></span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">#ifdef DEBUG_POOL</span></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,92,92);font-family:Consolas, monospace;font-size:12px;letter-spacing:.1px;line-height:15.6px;"><span style="letter-spacing:.1px;line-height:15.6px;">cmd_po<span style="letter-spacing:.1px;line-height:15.6px;">o<span style="letter-spacing:.1px;line-height:15.6px;">l_info();<br></span></span></span></span></span></li> 
      <li style="list-style:decimal;">#endif</li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;return OPER_OK<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}</span></li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; c，辅助文件（test.c）<br></span></p> 
   <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"> 
    <div class="codeheads"> 
     <p>点击(<span style="color:#FF0000;">此处)折叠或打开</span></p> 
    </div> 
    <div class="codeText"> 
     <ol>
      <li style="list-style:decimal;"><span style="color:rgb(0,0,0);"><span style="color:rgb(0,0,204);">/<span>*&nbsp;<br></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* cmd pool begin<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/<br></span></span> </li> 
      <li style="list-style:decimal;">static&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_oper<span style="color:rgb(0,0,204);">(void<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;<span style="color:rgb(0,0,204);">= OPER_OK<span>;<br></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"command pool test!\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(ret&nbsp;<span>= cmd_pool_create<span>(<span>)<span>)&nbsp;<span>!<span>= OPER_OK<span>)<br></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"Create command pool fail!\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_t<span style="color:rgb(0,0,204);">*&nbsp;&nbsp;&nbsp;&nbsp;cmd_buf<span>[5<span>]<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;<span style="color:rgb(0,0,204);">= 0<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int32_t&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;<span style="color:rgb(0,0,204);">= 0<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"Create command pool success!!!\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset<span style="color:rgb(0,0,204);">(cmd_buf<span>,0<span>,sizeof<span>(cmd_buf<span>)<span>)<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 0<span>; i&nbsp;<span>&lt; 5<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"&nbsp;&nbsp;&nbsp;&nbsp;alloc \n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(cmd_alloc<span>(<span>&amp;cmd_buf<span>[i<span>]<span>)&nbsp;<span>!<span>= OPER_OK<span>)<br></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"Alloc buffer fail : %d\n"<span style="color:rgb(0,0,204);">,i<span>)<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;<span style="color:rgb(0,0,204);">= i<span>;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:rgb(0,0,204);">;<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_buf<span style="color:rgb(0,0,204);">[i<span>]<span>-<span>&gt;fd&nbsp;&nbsp;&nbsp;&nbsp;<span>= i<span>+1<span>;<br></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy<span style="color:rgb(0,0,204);">(<span>(char<span>*<span>)cmd_buf<span>[i<span>]<span>-<span>&gt;data<span>,<span style="color:rgb(255,0,255);">"hello"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"Alloc complete success!\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(i&nbsp;<span>&gt;<span>= 5<span>)&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;<span>= i<span>;<br></span></span></span></span></span></span></span></span></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">for<span style="color:rgb(0,0,204);">(i&nbsp;<span>= 0&nbsp;<span>; i&nbsp;<span>&lt; 5<span>; i<span>+<span>+<span>)<br></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">{<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"command %d fd : %d,data : %s\n"<span style="color:rgb(0,0,204);">,<span>(i<span>+1<span>)<span>,cmd_buf<span>[i<span>]<span>-<span>&gt;fd<span>,<span>(char<span>*<span>)cmd_buf<span>[i<span>]<span>-<span>&gt;data<span>)<span>;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_free<span style="color:rgb(0,0,204);">(cmd_buf<span>[i<span>]<span>)<span>;<br></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">if<span style="color:rgb(0,0,204);">(<span>(ret&nbsp;<span>= cmd_pool_destroy<span>(<span>)<span>)&nbsp;<span>!<span>= OPER_OK<span>)<br></span></span></span></span></span></span></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"command pool destroy fail, still in use\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,255);">else<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:rgb(0,0,204);">(<span style="color:rgb(255,0,255);">"command pool destroy success!\n"<span style="color:rgb(0,0,204);">)<span>;<br></span></span></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(0,0,204);">}<br></span> </li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;">void&nbsp;&nbsp;&nbsp;&nbsp;test_cmd_pool<span style="color:rgb(0,0,204);">(<span>)<br></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">{<br></span></li> 
      <li style="list-style:decimal;">&nbsp;&nbsp;&nbsp;&nbsp;cmd_pool_oper<span style="color:rgb(0,0,204);">(<span>)<span>;<br></span></span></span> </li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">}<br></span></li> 
      <li style="list-style:decimal;"><br></li> 
      <li style="list-style:decimal;"><span style="color:rgb(0,0,204);">/<span>*&nbsp;<br></span></span></li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">* cmd pool&nbsp;<span style="color:rgb(0,0,255);">end&nbsp;<br></span></span> </li> 
      <li style="list-style:decimal;">&nbsp;<span style="color:rgb(0,0,204);">*<span>/</span></span> </li> 
     </ol>
    </div> 
   </div> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><span><br> &nbsp; &nbsp;&nbsp;&nbsp; &nbsp; d，测试结果<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://blog.chinaunix.net/attachment/201405/15/28458801_1400138820dWkQ.jpg" alt="" width="559" height="587" style="border:none;"><br><br><br><strong><span style="color:rgb(229,51,51);font-size:24px;">四，参考文件</span></strong><br> 1，《haproxy-1.5》源码<br> 2，<a href="http://blog.chinaunix.net/uid-28458801-id-4250240.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><span style="color:rgb(25,89,155);font-family:'黑体';"><span style="font-size:20px;">linux下双向链表的实现</span></span></a></span></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
