<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>linux内核数据结构之链表【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://www.cnblogs.com/Anker/archive/2013/12/15/3475643.html         1、前言     　　 最近写代码需用到链表结构，正好公共库有关于链表的。第一眼看时，觉得有点新鲜，和我之前见到的链表结构不一样，只有前驱和后继...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/13/weixin_33787529_90127303.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">linux内核数据结构之链表【转】</h1>
    <p class="post-meta">Dec 13, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">转自：<a href="http://www.cnblogs.com/Anker/archive/2013/12/15/3475643.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://www.cnblogs.com/Anker/archive/2013/12/15/3475643.html</a></p> 
   <div style="background:rgb(255,255,255);"> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>1、前言</strong></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　 最近写代码需用到链表结构，正好公共库有关于链表的。第一眼看时，觉得有点新鲜，和我之前见到的链表结构不一样，只有前驱和后继指针，而没有数据域。后来看代码注释发现该代码来自linux内核，在linux源代码下include/Lish.h下。这个链表具备通用性，使用非常方便。只需要在结构定义一个链表结构就可以使用。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>2、链表介绍</strong></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　链表是非常基本的数据结构，根据链个数分为单链表、双链表，根据是否循环分为单向链表和循环链表。通常定义定义链表结构如下：</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);">
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;">typedef <span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> node { ElemType data; <span style="color:rgb(0,193,0);line-height:1.5;">//数据域 <span style="color:rgb(0,0,255);line-height:1.5;">struct node *<span style="color:rgb(0,0,0);line-height:1.5;">next; <span style="color:rgb(0,193,0);line-height:1.5;">//指针域 }node, *list;</span></span></span></span></span></span></span></pre>
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">链表中包含数据域和指针域。链表通常包含一个头结点，不存放数据，方便链表操作。单向循环链表结构如下图所示：</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><img src="https://images0.cnblogs.com/blog/305504/201312/15182639-7ed83883e8474de9a9795ce92a378705.png" alt="" style="border:none;"></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">双向循环链表结构如下图所示：</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><img src="https://images0.cnblogs.com/blog/305504/201312/15182942-7c826c9b93784d159af2b30875fb6e12.png" alt="" style="border:none;"></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　这样带数据域的链表降低了链表的通用性，不容易扩展。linux内核定义的链表结构不带数据域，只需要两个指针完成链表的操作。将链表节点加入数据结构，具备非常高的扩展性，通用性。链表结构定义如下所示：</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);">
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head { <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *next, *<span style="color:rgb(0,0,0);line-height:1.5;">prev; };</span></span></span></span></span></pre>
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">链表结构如下所示：</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><img src="https://images0.cnblogs.com/blog/305504/201312/15183339-56d738b82fd645aeb5cef6af6e9356d7.png" alt="" style="border:none;"></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　需要用链表结构时，只需要在结构体中定义一个链表类型的数据即可。例如定义一个app_info链表，</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;">1 typedef <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> application_info <span style="color:rgb(0,128,128);line-height:1.5;">2 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">3 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t app_id; <span style="color:rgb(0,128,128);line-height:1.5;">4 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t up_flow; <span style="color:rgb(0,128,128);line-height:1.5;">5 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t down_flow; <span style="color:rgb(0,128,128);line-height:1.5;">6 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head app_info_head; <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">链表节点 <span style="color:rgb(0,128,128);line-height:1.5;">7 }app_info;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">定义一个app_info链表，app_info app_info_list;通过app_info_head进行链表操作。根据C语言指针操作，通过container_of和offsetof，可以根据app_info_head的地址找出app_info的起始地址，即一个完整ap_info结构的起始地址。可以参考：<a href="http://www.cnblogs.com/Anker/p/3472271.html" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">http://www.cnblogs.com/Anker/p/3472271.html</a>。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>3、linux内核链表实现</strong></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　内核实现的是双向循环链表，提供了链表操作的基本功能。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（1）初始化链表头结点</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,0,255);font-size:12px;line-height:1.5;">#define LIST_HEAD_INIT(name) { &amp;(name), &amp;(name) } <span style="line-height:1.5;">#define LIST_HEAD(name) \ <span style="line-height:1.5;">struct list_head name =<span style="color:rgb(0,0,0);line-height:1.5;"> LIST_HEAD_INIT(name) <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void INIT_LIST_HEAD(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">list) { list-&gt;next =<span style="line-height:1.5;"> list; list-&gt;prev =<span style="line-height:1.5;"> list; }</span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">LIST_HEAD宏创建一个链表头结点，并用LIST_HEAD_INIT宏对头结点进行赋值，使得头结点的前驱和后继指向自己。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">INIT_LIST_HEAD函数对链表进行初始化，使得前驱和后继指针指针指向头结点。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（2）插入节点</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void __list_add(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">prev, <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">next) <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 5 next-&gt;prev = <span style="color:rgb(0,0,255);line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">; <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">new-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> next; <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">new-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> prev; <span style="color:rgb(0,128,128);line-height:1.5;"> 8 prev-&gt;next = <span style="color:rgb(0,0,255);line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">; <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="line-height:1.5;">11 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_add(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">13 __list_add(<span style="color:rgb(0,0,255);line-height:1.5;">new, head, head-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_add_tail(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">18 __list_add(<span style="color:rgb(0,0,255);line-height:1.5;">new, head-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">prev, head); <span style="color:rgb(0,128,128);line-height:1.5;">19 }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　插入节点分为从链表头部插入list_add和链表尾部插入list_add_tail，通过调用__list_add函数进行实现，head-&gt;next指向之一个节点，head-&gt;prev指向尾部节点。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（3）删除节点</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void __list_del(<span style="line-height:1.5;">struct list_head * prev, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;"> next) <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 3 next-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> prev; <span style="color:rgb(0,128,128);line-height:1.5;"> 4 prev-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> next; <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_del(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">entry) <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 __list_del(entry-&gt;prev, entry-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">10 entry-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> LIST_POISON1; <span style="color:rgb(0,128,128);line-height:1.5;">11 entry-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> LIST_POISON2; <span style="color:rgb(0,128,128);line-height:1.5;">12 }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">　　从链表中删除一个节点，需要改变该节点前驱节点的后继结点和后继结点的前驱节点。最后设置该节点的前驱节点和后继结点指向LIST_POSITION1和LIST_POSITION2两个特殊值，这样设置是为了保证不在链表中的节点项不可访问，对LIST_POSITION1和LIST_POSITION2的访问都将引起页故障</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,0);font-size:12px;line-height:1.5;">/*<span style="line-height:1.5;"> * These are non-NULL pointers that will result in page faults * under normal circumstances, used to verify that nobody uses * non-initialized list entries. <span style="line-height:1.5;">*/ <span style="color:rgb(0,0,255);line-height:1.5;">#define LIST_POISON1 ((void *) 0x00100100 + POISON_POINTER_DELTA) <span style="line-height:1.5;">#define LIST_POISON2 ((void *) 0x00200200 + POISON_POINTER_DELTA)</span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（4）移动节点</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_move - delete from one list and add as another's head <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;"> * @list: the entry to move <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,128,0);line-height:1.5;"> * @head: the head that will precede our entry <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_move(<span style="line-height:1.5;">struct list_head *list, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 8 __list_del(list-&gt;prev, list-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,0);line-height:1.5;"> list_add(list, head); <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="line-height:1.5;">12 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_move_tail - delete from one list and add as another's tail <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,128,0);line-height:1.5;"> * @list: the entry to move <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,128,0);line-height:1.5;"> * @head: the head that will follow our entry <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_move_tail(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">list, <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">20 __list_del(list-&gt;prev, list-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">21 <span style="color:rgb(0,0,0);line-height:1.5;"> list_add_tail(list, head); <span style="color:rgb(0,128,128);line-height:1.5;">22 }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">move将一个节点移动到头部或者尾部。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（5）判断链表</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_is_last - tests whether @list is the last entry in list @head <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;"> * @list: the entry to test <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,128,0);line-height:1.5;"> * @head: the head of the list <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">int list_is_last(<span style="line-height:1.5;">const <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">list, <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">const <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">return list-&gt;next ==<span style="color:rgb(0,0,0);line-height:1.5;"> head; <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="line-height:1.5;">12 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_empty - tests whether a list is empty <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,128,0);line-height:1.5;"> * @head: the list to test. <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">int list_empty(<span style="line-height:1.5;">const <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">return head-&gt;next ==<span style="color:rgb(0,0,0);line-height:1.5;"> head; <span style="color:rgb(0,128,128);line-height:1.5;">19 }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">list_is_last函数判断节点是否为末尾节点，list_empty判断链表是否为空。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>（6）遍历链表</strong></p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_entry - get the struct for this entry <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;"> * @ptr: the &amp;struct list_head pointer. <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,128,0);line-height:1.5;"> * @type: the type of the struct this is embedded in. <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,128,0);line-height:1.5;"> * @member: the name of the list_struct within the struct. <span style="color:rgb(0,128,128);line-height:1.5;"> 6 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_entry(ptr, type, member) \ <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,0,0);line-height:1.5;"> container_of(ptr, type, member) <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="line-height:1.5;">10 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_first_entry - get the first element from a list <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="color:rgb(0,128,0);line-height:1.5;"> * @ptr: the list head to take the element from. <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;"> * @type: the type of the struct this is embedded in. <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,128,0);line-height:1.5;"> * @member: the name of the list_struct within the struct. <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,128,0);line-height:1.5;"> * <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,128,0);line-height:1.5;"> * Note, that list is expected to be not empty. <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_first_entry(ptr, type, member) \ <span style="color:rgb(0,128,128);line-height:1.5;">19 list_entry((ptr)-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next, type, member) <span style="color:rgb(0,128,128);line-height:1.5;">20 <span style="line-height:1.5;">21 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">* <span style="color:rgb(0,128,128);line-height:1.5;">22 <span style="color:rgb(0,128,0);line-height:1.5;"> * list_for_each - iterate over a list <span style="color:rgb(0,128,128);line-height:1.5;">23 <span style="color:rgb(0,128,0);line-height:1.5;"> * @pos: the &amp;struct list_head to use as a loop cursor. <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,128,0);line-height:1.5;"> * @head: the head for your list. <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="color:rgb(0,128,0);line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;">26 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_for_each(pos, head) \ <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,255);line-height:1.5;">for (pos = (head)-&gt;next; prefetch(pos-&gt;next), pos !=<span style="color:rgb(0,0,0);line-height:1.5;"> (head); \ <span style="color:rgb(0,128,128);line-height:1.5;">28 pos = pos-&gt;next)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">宏list_entity获取链表的结构，包括数据域。list_first_entry获取链表第一个节点，包括数据源。list_for_each宏对链表节点进行遍历。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">4、测试例子</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">编写一个简单使用链表的程序，从而掌握链表的使用。</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">自定义个类似的list结构如下所示：mylist.h</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 # define POISON_POINTER_DELTA <span style="color:rgb(128,0,128);line-height:1.5;">0 <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="line-height:1.5;"> 3 <span style="color:rgb(0,0,255);line-height:1.5;">#define LIST_POISON1 ((void *) 0x00100100 + POISON_POINTER_DELTA) <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,0,255);line-height:1.5;">#define LIST_POISON2 ((void *) 0x00200200 + POISON_POINTER_DELTA) <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="line-height:1.5;"> 6 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">计算member在type中的位置 <span style="color:rgb(0,128,128);line-height:1.5;"> 7 <span style="color:rgb(0,0,255);line-height:1.5;">#define offsetof(type, member) (size_t)(&amp;((type*)0)-&gt;member) <span style="color:rgb(0,128,128);line-height:1.5;"> 8 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">根据member的地址获取type的起始地址 <span style="color:rgb(0,128,128);line-height:1.5;"> 9 <span style="color:rgb(0,0,255);line-height:1.5;">#define container_of(ptr, type, member) ({ \ <span style="color:rgb(0,128,128);line-height:1.5;">10 <span style="color:rgb(0,0,255);line-height:1.5;">const <span style="line-height:1.5;">typeof(((type *)<span style="color:rgb(128,0,128);line-height:1.5;">0)-&gt;member)*__mptr =<span style="color:rgb(0,0,0);line-height:1.5;"> (ptr); \ <span style="color:rgb(0,128,128);line-height:1.5;">11 (type *)((<span style="color:rgb(0,0,255);line-height:1.5;">char *)__mptr -<span style="color:rgb(0,0,0);line-height:1.5;"> offsetof(type, member)); }) <span style="color:rgb(0,128,128);line-height:1.5;">12 <span style="line-height:1.5;">13 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">链表结构 <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> list_head <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">prev; <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">next; <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,0);line-height:1.5;">}; <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="line-height:1.5;">20 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void init_list_head(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">list) <span style="color:rgb(0,128,128);line-height:1.5;">21 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">22 list-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> list; <span style="color:rgb(0,128,128);line-height:1.5;">23 list-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> list; <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="line-height:1.5;">26 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void __list_add(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *prev, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">next) <span style="color:rgb(0,128,128);line-height:1.5;">28 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">29 prev-&gt;next = <span style="color:rgb(0,0,255);line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">; <span style="color:rgb(0,128,128);line-height:1.5;">30 <span style="color:rgb(0,0,255);line-height:1.5;">new-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> prev; <span style="color:rgb(0,128,128);line-height:1.5;">31 <span style="color:rgb(0,0,255);line-height:1.5;">new-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> next; <span style="color:rgb(0,128,128);line-height:1.5;">32 next-&gt;prev = <span style="color:rgb(0,0,255);line-height:1.5;">new<span style="color:rgb(0,0,0);line-height:1.5;">; <span style="color:rgb(0,128,128);line-height:1.5;">33 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">34 <span style="line-height:1.5;">35 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">从头部添加 <span style="color:rgb(0,128,128);line-height:1.5;">36 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_add(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new , <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">37 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">38 __list_add(<span style="color:rgb(0,0,255);line-height:1.5;">new, head, head-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">39 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">40 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">从尾部添加 <span style="color:rgb(0,128,128);line-height:1.5;">41 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_add_tail(<span style="line-height:1.5;">struct list_head *<span style="line-height:1.5;">new, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">42 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">43 __list_add(<span style="color:rgb(0,0,255);line-height:1.5;">new, head-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">prev, head); <span style="color:rgb(0,128,128);line-height:1.5;">44 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">45 <span style="line-height:1.5;">46 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void __list_del(<span style="line-height:1.5;">struct list_head *prev, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">next) <span style="color:rgb(0,128,128);line-height:1.5;">47 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">48 prev-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> next; <span style="color:rgb(0,128,128);line-height:1.5;">49 next-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> prev; <span style="color:rgb(0,128,128);line-height:1.5;">50 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">51 <span style="line-height:1.5;">52 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_del(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">entry) <span style="color:rgb(0,128,128);line-height:1.5;">53 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">54 __list_del(entry-&gt;prev, entry-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">55 entry-&gt;next =<span style="color:rgb(0,0,0);line-height:1.5;"> LIST_POISON1; <span style="color:rgb(0,128,128);line-height:1.5;">56 entry-&gt;prev =<span style="color:rgb(0,0,0);line-height:1.5;"> LIST_POISON2; <span style="color:rgb(0,128,128);line-height:1.5;">57 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">58 <span style="line-height:1.5;">59 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_move(<span style="line-height:1.5;">struct list_head *list, <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">60 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">61 __list_del(list-&gt;prev, list-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">62 <span style="color:rgb(0,0,0);line-height:1.5;"> list_add(list, head); <span style="color:rgb(0,128,128);line-height:1.5;">63 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">64 <span style="line-height:1.5;">65 <span style="color:rgb(0,0,255);line-height:1.5;">static inline <span style="line-height:1.5;">void list_move_tail(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">list, <span style="color:rgb(0,128,128);line-height:1.5;">66 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">67 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">68 __list_del(list-&gt;prev, list-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next); <span style="color:rgb(0,128,128);line-height:1.5;">69 <span style="color:rgb(0,0,0);line-height:1.5;"> list_add_tail(list, head); <span style="color:rgb(0,128,128);line-height:1.5;">70 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">71 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_entry(ptr, type, member) \ <span style="color:rgb(0,128,128);line-height:1.5;">72 <span style="color:rgb(0,0,0);line-height:1.5;"> container_of(ptr, type, member) <span style="color:rgb(0,128,128);line-height:1.5;">73 <span style="line-height:1.5;">74 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_first_entry(ptr, type, member) \ <span style="color:rgb(0,128,128);line-height:1.5;">75 list_entry((ptr)-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next, type, member) <span style="color:rgb(0,128,128);line-height:1.5;">76 <span style="line-height:1.5;">77 <span style="color:rgb(0,0,255);line-height:1.5;">#define list_for_each(pos, head) \ <span style="color:rgb(0,128,128);line-height:1.5;">78 <span style="color:rgb(0,0,255);line-height:1.5;">for (pos = (head)-&gt;next; pos != (head); pos = pos-&gt;next)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">mylist.c如下所示：</p> 
    <div class="cnblogs_code" style="color:rgb(0,0,0);font-family:'Courier New';font-size:12px;border:1px solid rgb(204,204,204);"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="font-family:'Courier New';font-size:15px;line-height:1.5;"><span style="color:rgb(0,128,128);font-size:12px;line-height:1.5;"> 1 <span style="color:rgb(0,128,0);line-height:1.5;">/*<span style="line-height:1.5;">*@brief 练习使用linux内核链表，功能包括： <span style="color:rgb(0,128,128);line-height:1.5;"> 2 <span style="color:rgb(0,128,0);line-height:1.5;"> * 定义链表结构，创建链表、插入节点、删除节点、移动节点、遍历节点 <span style="color:rgb(0,128,128);line-height:1.5;"> 3 <span style="color:rgb(0,128,0);line-height:1.5;"> * <span style="color:rgb(0,128,128);line-height:1.5;"> 4 <span style="color:rgb(0,128,0);line-height:1.5;"> *@auther Anker @date 2013-12-15 <span style="color:rgb(0,128,128);line-height:1.5;"> 5 <span style="color:rgb(0,128,0);line-height:1.5;"> *<span style="line-height:1.5;">*/ <span style="color:rgb(0,128,128);line-height:1.5;"> 6 #include &lt;stdio.h&gt; <span style="line-height:1.5;"> 7 #include &lt;inttypes.h&gt; <span style="line-height:1.5;"> 8 #include &lt;stdlib.h&gt; <span style="line-height:1.5;"> 9 #include &lt;errno.h&gt; <span style="line-height:1.5;">10 #include <span style="color:rgb(128,0,0);line-height:1.5;">"<span style="line-height:1.5;">mylist.h<span style="line-height:1.5;">" <span style="color:rgb(0,128,128);line-height:1.5;">11 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">定义app_info链表结构 <span style="color:rgb(0,128,128);line-height:1.5;">12 typedef <span style="color:rgb(0,0,255);line-height:1.5;">struct<span style="color:rgb(0,0,0);line-height:1.5;"> application_info <span style="color:rgb(0,128,128);line-height:1.5;">13 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">14 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t app_id; <span style="color:rgb(0,128,128);line-height:1.5;">15 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t up_flow; <span style="color:rgb(0,128,128);line-height:1.5;">16 <span style="color:rgb(0,0,0);line-height:1.5;"> uint32_t down_flow; <span style="color:rgb(0,128,128);line-height:1.5;">17 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head app_info_node;<span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">链表节点 <span style="color:rgb(0,128,128);line-height:1.5;">18 <span style="color:rgb(0,0,0);line-height:1.5;">}app_info; <span style="color:rgb(0,128,128);line-height:1.5;">19 <span style="line-height:1.5;">20 <span style="line-height:1.5;">21 app_info*<span style="color:rgb(0,0,0);line-height:1.5;"> get_app_info(uint32_t app_id, uint32_t up_flow, uint32_t down_flow) <span style="color:rgb(0,128,128);line-height:1.5;">22 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">23 app_info *app = (app_info*)malloc(<span style="color:rgb(0,0,255);line-height:1.5;">sizeof<span style="color:rgb(0,0,0);line-height:1.5;">(app_info)); <span style="color:rgb(0,128,128);line-height:1.5;">24 <span style="color:rgb(0,0,255);line-height:1.5;">if (app ==<span style="color:rgb(0,0,0);line-height:1.5;"> NULL) <span style="color:rgb(0,128,128);line-height:1.5;">25 <span style="color:rgb(0,0,0);line-height:1.5;"> { <span style="color:rgb(0,128,128);line-height:1.5;">26 fprintf(stderr, <span style="color:rgb(128,0,0);line-height:1.5;">"<span style="line-height:1.5;">Failed to malloc memory, errno:%u, reason:%s\n<span style="line-height:1.5;">"<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">27 <span style="color:rgb(0,0,0);line-height:1.5;"> errno, strerror(errno)); <span style="color:rgb(0,128,128);line-height:1.5;">28 <span style="color:rgb(0,0,255);line-height:1.5;">return<span style="color:rgb(0,0,0);line-height:1.5;"> NULL; <span style="color:rgb(0,128,128);line-height:1.5;">29 <span style="color:rgb(0,0,0);line-height:1.5;"> } <span style="color:rgb(0,128,128);line-height:1.5;">30 app-&gt;app_id =<span style="color:rgb(0,0,0);line-height:1.5;"> app_id; <span style="color:rgb(0,128,128);line-height:1.5;">31 app-&gt;up_flow =<span style="color:rgb(0,0,0);line-height:1.5;"> up_flow; <span style="color:rgb(0,128,128);line-height:1.5;">32 app-&gt;down_flow =<span style="color:rgb(0,0,0);line-height:1.5;"> down_flow; <span style="color:rgb(0,128,128);line-height:1.5;">33 <span style="color:rgb(0,0,255);line-height:1.5;">return<span style="color:rgb(0,0,0);line-height:1.5;"> app; <span style="color:rgb(0,128,128);line-height:1.5;">34 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">35 <span style="color:rgb(0,0,255);line-height:1.5;">static <span style="line-height:1.5;">void for_each_app(<span style="line-height:1.5;">const <span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">36 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">37 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">pos; <span style="color:rgb(0,128,128);line-height:1.5;">38 app_info *<span style="color:rgb(0,0,0);line-height:1.5;">app; <span style="color:rgb(0,128,128);line-height:1.5;">39 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">遍历链表 <span style="color:rgb(0,128,128);line-height:1.5;">40 <span style="color:rgb(0,0,0);line-height:1.5;"> list_for_each(pos, head) <span style="color:rgb(0,128,128);line-height:1.5;">41 <span style="color:rgb(0,0,0);line-height:1.5;"> { <span style="color:rgb(0,128,128);line-height:1.5;">42 app =<span style="color:rgb(0,0,0);line-height:1.5;"> list_entry(pos, app_info, app_info_node); <span style="color:rgb(0,128,128);line-height:1.5;">43 printf(<span style="color:rgb(128,0,0);line-height:1.5;">"<span style="line-height:1.5;">ap_id: %u\tup_flow: %u\tdown_flow: %u\n<span style="line-height:1.5;">"<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">44 app-&gt;app_id, app-&gt;up_flow, app-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">down_flow); <span style="color:rgb(0,128,128);line-height:1.5;">45 <span style="line-height:1.5;">46 <span style="color:rgb(0,0,0);line-height:1.5;"> } <span style="color:rgb(0,128,128);line-height:1.5;">47 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">48 <span style="line-height:1.5;">49 <span style="color:rgb(0,0,255);line-height:1.5;">void destroy_app_list(<span style="line-height:1.5;">struct list_head *<span style="color:rgb(0,0,0);line-height:1.5;">head) <span style="color:rgb(0,128,128);line-height:1.5;">50 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">51 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *pos = head-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next; <span style="color:rgb(0,128,128);line-height:1.5;">52 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *tmp =<span style="color:rgb(0,0,0);line-height:1.5;"> NULL; <span style="color:rgb(0,128,128);line-height:1.5;">53 <span style="color:rgb(0,0,255);line-height:1.5;">while (pos !=<span style="color:rgb(0,0,0);line-height:1.5;"> head) <span style="color:rgb(0,128,128);line-height:1.5;">54 <span style="color:rgb(0,0,0);line-height:1.5;"> { <span style="color:rgb(0,128,128);line-height:1.5;">55 tmp = pos-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">next; <span style="color:rgb(0,128,128);line-height:1.5;">56 <span style="color:rgb(0,0,0);line-height:1.5;"> list_del(pos); <span style="color:rgb(0,128,128);line-height:1.5;">57 pos =<span style="color:rgb(0,0,0);line-height:1.5;"> tmp; <span style="color:rgb(0,128,128);line-height:1.5;">58 <span style="color:rgb(0,0,0);line-height:1.5;"> } <span style="color:rgb(0,128,128);line-height:1.5;">59 <span style="color:rgb(0,0,0);line-height:1.5;">} <span style="color:rgb(0,128,128);line-height:1.5;">60 <span style="line-height:1.5;">61 <span style="line-height:1.5;">62 <span style="color:rgb(0,0,255);line-height:1.5;">int<span style="color:rgb(0,0,0);line-height:1.5;"> main() <span style="color:rgb(0,128,128);line-height:1.5;">63 <span style="color:rgb(0,0,0);line-height:1.5;">{ <span style="color:rgb(0,128,128);line-height:1.5;">64 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">创建一个app_info <span style="color:rgb(0,128,128);line-height:1.5;">65 app_info * app_info_list = (app_info*)malloc(<span style="color:rgb(0,0,255);line-height:1.5;">sizeof<span style="color:rgb(0,0,0);line-height:1.5;">(app_info)); <span style="color:rgb(0,128,128);line-height:1.5;">66 app_info *<span style="color:rgb(0,0,0);line-height:1.5;">app; <span style="color:rgb(0,128,128);line-height:1.5;">67 <span style="color:rgb(0,0,255);line-height:1.5;">if (app_info_list ==<span style="color:rgb(0,0,0);line-height:1.5;"> NULL) <span style="color:rgb(0,128,128);line-height:1.5;">68 <span style="color:rgb(0,0,0);line-height:1.5;"> { <span style="color:rgb(0,128,128);line-height:1.5;">69 fprintf(stderr, <span style="color:rgb(128,0,0);line-height:1.5;">"<span style="line-height:1.5;">Failed to malloc memory, errno:%u, reason:%s\n<span style="line-height:1.5;">"<span style="color:rgb(0,0,0);line-height:1.5;">, <span style="color:rgb(0,128,128);line-height:1.5;">70 <span style="color:rgb(0,0,0);line-height:1.5;"> errno, strerror(errno)); <span style="color:rgb(0,128,128);line-height:1.5;">71 <span style="color:rgb(0,0,255);line-height:1.5;">return -<span style="color:rgb(128,0,128);line-height:1.5;">1<span style="color:rgb(0,0,0);line-height:1.5;">; <span style="color:rgb(0,128,128);line-height:1.5;">72 <span style="color:rgb(0,0,0);line-height:1.5;"> } <span style="color:rgb(0,128,128);line-height:1.5;">73 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">初始化链表头部 <span style="color:rgb(0,128,128);line-height:1.5;">74 <span style="color:rgb(0,0,255);line-height:1.5;">struct list_head *head = &amp;app_info_list-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">app_info_node; <span style="color:rgb(0,128,128);line-height:1.5;">75 <span style="color:rgb(0,0,0);line-height:1.5;"> init_list_head(head); <span style="color:rgb(0,128,128);line-height:1.5;">76 <span style="color:rgb(0,128,0);line-height:1.5;">//<span style="line-height:1.5;">插入三个app_info <span style="color:rgb(0,128,128);line-height:1.5;">77 app = get_app_info(<span style="color:rgb(128,0,128);line-height:1.5;">1001, <span style="line-height:1.5;">100, <span style="line-height:1.5;">200<span style="color:rgb(0,0,0);line-height:1.5;">); <span style="color:rgb(0,128,128);line-height:1.5;">78 list_add_tail(&amp;app-&gt;<span style="color:rgb(0,0,0);line-height:1.5;">app_info_node, head); <span style="color:rgb(0,128,128);line-height:1.5;">79 app = get_app_info(<span style="color:rgb(128,0,128);line-height:1.5;">1002, <span style="line-height:1.5;">80, <span style="line-height:1.5;">100<span style="color:rgb(0,0,0);line-height:1.5;">); <span style="color:rgb(0,128,128);line-height:1.5;">80 list_add_tail(&amp;app-&gt;app_info_node, head); 81 app = get_app_info(1003, 90, 120); 82 list_add_tail(&amp;app-&gt;app_info_node, head); 83 printf("After insert three app_info: \n"); 84 for_each_app(head); 85 //将第一个节点移到末尾 86 printf("Move first node to tail:\n"); 87 list_move_tail(head-&gt;next, head); 88 for_each_app(head); 89 //删除最后一个节点 90 printf("Delete the last node:\n"); 91 list_del(head-&gt;prev); 92 for_each_app(head); 93 destroy_app_list(head); 94 free(app_info_list); 95 return 0; 96 }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;text-decoration:underline;border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">测试结果如下所示：</p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><img src="https://images0.cnblogs.com/blog/305504/201312/15201401-e3c32ceb8bc74dc58fff98a3017210ab.png" alt="" style="border:none;"></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><strong>参考网址：</strong></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><a href="https://www.ibm.com/developerworks/cn/linux/kernel/l-chain/" rel="nofollow" style="color:rgb(51,51,51);font-weight:inherit;line-height:inherit;">https://www.ibm.com/developerworks/cn/linux/kernel/l-chain/</a></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;"><br></p> 
    <p><font color="#666666"><span style="font-size:14px;">本文转自张昺华-sky博客园博客，原文链接：http://www.cnblogs.com/sky-heaven/p/7130890.html</span></font><span style="font-size:14px;color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';">，如需转载请自行联系原作者</span></p> 
    <div style="color:rgb(102,102,102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif, '宋体';font-size:14px;">
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
