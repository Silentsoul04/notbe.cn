<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>linux 内核升级步骤，kernel升级 « NotBeCN</title>
  <meta name="description" content="             下载内核 从以下网站https://www.kernel.org/                            上传kernel文件到/usr/src/kernels/ 目录下，此处也可以选择其他目录                解压kernel文件    [root@apa...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/12/weixin_34162401_90120725.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">linux 内核升级步骤，kernel升级</h1>
    <p class="post-meta">Dec 12, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>下载内核 从以下网站<a href="https://www.kernel.org/" rel="nofollow">https://www.kernel.org/</a></p> 
   <font color="#666666"> </font>
   <div style="text-align:center;"> 
    <img title="clip_image001" alt="clip_image001" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789559Lr1H.png" height="411" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';">
    <br>
   </div> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">上传kernel文件到/usr/src/kernels/ 目录下，此处也可以选择其他目录</p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:center;"><img title="clip_image002" alt="clip_image002" src="http://blog.itpub.net/attachment/201408/23/27771627_14087895637CZr.png" height="228" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';"><br></p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">解压kernel文件</p> 
   <p><strong>[root@apache kernels]# tar -xJvf linux-3.16.1.tar.xz</strong></p> 
   <font color="#666666"> </font>
   <p>安装包 gcc、ncurses-devel</p> 
   <p></p> 
   <pre><code class="language-none">[root@apache yum.repos.d]# yum -y install gcc ncurses-devel

Failed to set locale, defaulting to C

Loaded plugins: langpacks, product-id, subscription-manager

This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.

Repository 'y' is missing name in configuration, using id

y | 4.1 kB 00:00:00

Resolving Dependencies

--&gt; Running transaction check

---&gt; Package gcc.x86_64 0:4.8.2-16.el7 will be installed

--&gt; Processing Dependency: cpp = 4.8.2-16.el7 for package: gcc-4.8.2-16.el7.x86_64

--&gt; Processing Dependency: glibc-devel &gt;= 2.2.90-12 for package: gcc-4.8.2-16.el7.x86_64

--&gt; Processing Dependency: libmpc.so.3()(64bit) for package: gcc-4.8.2-16.el7.x86_64

--&gt; Processing Dependency: libmpfr.so.4()(64bit) for package: gcc-4.8.2-16.el7.x86_64

---&gt; Package ncurses-devel.x86_64 0:5.9-13.20130511.el7 will be installed

--&gt; Running transaction check

---&gt; Package cpp.x86_64 0:4.8.2-16.el7 will be installed

---&gt; Package glibc-devel.x86_64 0:2.17-55.el7 will be installed

--&gt; Processing Dependency: glibc-headers = 2.17-55.el7 for package: glibc-devel-2.17-55.el7.x86_64

--&gt; Processing Dependency: glibc-headers for package: glibc-devel-2.17-55.el7.x86_64

---&gt; Package libmpc.x86_64 0:1.0.1-3.el7 will be installed

---&gt; Package mpfr.x86_64 0:3.1.1-4.el7 will be installed

--&gt; Running transaction check

---&gt; Package glibc-headers.x86_64 0:2.17-55.el7 will be installed

--&gt; Processing Dependency: kernel-headers &gt;= 2.2.1 for package: glibc-headers-2.17-55.el7.x86_64

--&gt; Processing Dependency: kernel-headers for package: glibc-headers-2.17-55.el7.x86_64

--&gt; Running transaction check

---&gt; Package kernel-headers.x86_64 0:3.10.0-121.el7 will be installed

--&gt; Finished Dependency Resolution

Dependencies Resolved

==================================================================================================================

Package Arch Version Repository Size

==================================================================================================================

Installing:

gcc x86_64 4.8.2-16.el7 y 16 M

ncurses-devel x86_64 5.9-13.20130511.el7 y 713 k

Installing for dependencies:

cpp x86_64 4.8.2-16.el7 y 5.9 M

glibc-devel x86_64 2.17-55.el7 y 1.0 M

glibc-headers x86_64 2.17-55.el7 y 650 k

kernel-headers x86_64 3.10.0-121.el7 y 1.4 M

libmpc x86_64 1.0.1-3.el7 y 51 k

mpfr x86_64 3.1.1-4.el7 y 203 k

Transaction Summary

==================================================================================================================

Install 2 Packages (+6 Dependent packages)

Total download size: 26 M

Installed size: 61 M

Downloading packages:

------------------------------------------------------------------------------------------------------------------

Total 31 MB/s | 26 MB 00:00:00

Running transaction check

Running transaction test

Transaction test succeeded

Running transaction

Installing : mpfr-3.1.1-4.el7.x86_64 1/8

Installing : libmpc-1.0.1-3.el7.x86_64 2/8

Installing : cpp-4.8.2-16.el7.x86_64 3/8

Installing : kernel-headers-3.10.0-121.el7.x86_64 4/8

Installing : glibc-headers-2.17-55.el7.x86_64 5/8

Installing : glibc-devel-2.17-55.el7.x86_64 6/8

Installing : gcc-4.8.2-16.el7.x86_64 7/8

Installing : ncurses-devel-5.9-13.20130511.el7.x86_64 8/8

Verifying : ncurses-devel-5.9-13.20130511.el7.x86_64 1/8

Verifying : mpfr-3.1.1-4.el7.x86_64 2/8

Verifying : glibc-headers-2.17-55.el7.x86_64 3/8

Verifying : glibc-devel-2.17-55.el7.x86_64 4/8

Verifying : libmpc-1.0.1-3.el7.x86_64 5/8

Verifying : kernel-headers-3.10.0-121.el7.x86_64 6/8

Verifying : gcc-4.8.2-16.el7.x86_64 7/8

Verifying : cpp-4.8.2-16.el7.x86_64 8/8

Installed:

gcc.x86_64 0:4.8.2-16.el7 ncurses-devel.x86_64 0:5.9-13.20130511.el7

Dependency Installed:

cpp.x86_64 0:4.8.2-16.el7 glibc-devel.x86_64 0:2.17-55.el7 glibc-headers.x86_64 0:2.17-55.el7

kernel-headers.x86_64 0:3.10.0-121.el7 libmpc.x86_64 0:1.0.1-3.el7 mpfr.x86_64 0:3.1.1-4.el7

Complete!</code></pre> 
   <font color="#666666"> </font>
   <p>执行make</p> 
   <font color="#666666"></font>
   <pre><code class="language-none">先查看make帮助

[root@apache linux-3.16.1]# make help

Cleaning targets:

clean - Remove most generated files but keep the config and

enough build support to build external modules

mrproper - Remove all generated files + config + various backup files

distclean - mrproper + remove editor backup and patch files

Configuration targets:

config - Update current config utilising a line-oriented program

nconfig - Update current config utilising a ncurses menu based program

menuconfig - Update current config utilising a menu based program

xconfig - Update current config utilising a QT based front-end

gconfig - Update current config utilising a GTK based front-end

oldconfig - Update current config utilising a provided .config as base

localmodconfig - Update current config disabling modules not loaded

localyesconfig - Update current config converting local mods to core

silentoldconfig - Same as oldconfig, but quietly, additionally update deps

defconfig - New config with default from ARCH supplied defconfig

savedefconfig - Save current config as ./defconfig (minimal config)

allnoconfig - New config where all options are answered with no

allyesconfig - New config where all options are accepted with yes

allmodconfig - New config selecting modules when possible

alldefconfig - New config with all symbols set to default

randconfig - New config with random answer to all options

listnewconfig - List new options

olddefconfig - Same as silentoldconfig but sets new symbols to their default value

Other generic targets:

all - Build all targets marked with [*]

* vmlinux - Build the bare kernel

* modules - Build all modules

modules_install - Install all modules to INSTALL_MOD_PATH (default: /)

firmware_install- Install all firmware to INSTALL_FW_PATH

(default: $(INSTALL_MOD_PATH)/lib/firmware)

dir/ - Build all files in dir and below

dir/file.[oisS] - Build specified target only

dir/file.lst - Build specified mixed source/assembly target only

(requires a recent binutils and recent build (System.map))

dir/file.ko - Build module including final link

modules_prepare - Set up for building external modules

tags/TAGS - Generate tags file for editors

cscope - Generate cscope index

gtags - Generate GNU GLOBAL index

kernelrelease - Output the release version string

kernelversion - Output the version stored in Makefile

image_name - Output the image name

headers_install - Install sanitised kernel headers to INSTALL_HDR_PATH

(default: ./usr)

Static analysers

checkstack - Generate a list of stack hogs

namespacecheck - Name space analysis on compiled kernel

versioncheck - Sanity check on version.h usage

includecheck - Check for duplicate included header files

export_report - List the usages of all exported symbols

headers_check - Sanity check on exported headers

headerdep - Detect inclusion cycles in headers

coccicheck - Check with Coccinelle.

Kernel packaging:

rpm-pkg - Build both source and binary RPM kernel packages

binrpm-pkg - Build only the binary kernel package

deb-pkg - Build the kernel as a deb package

tar-pkg - Build the kernel as an uncompressed tarball

targz-pkg - Build the kernel as a gzip compressed tarball

tarbz2-pkg - Build the kernel as a bzip2 compressed tarball

tarxz-pkg - Build the kernel as a xz compressed tarball

perf-tar-src-pkg - Build perf-3.16.1.tar source tarball

perf-targz-src-pkg - Build perf-3.16.1.tar.gz source tarball

perf-tarbz2-src-pkg - Build perf-3.16.1.tar.bz2 source tarball

perf-tarxz-src-pkg - Build perf-3.16.1.tar.xz source tarball

Documentation targets:

Linux kernel internal documentation in different formats:

htmldocs - HTML

pdfdocs - PDF

psdocs - Postscript

xmldocs - XML DocBook

mandocs - man pages

installmandocs - install man pages generated by mandocs

cleandocs - clean all generated DocBook files

Architecture specific targets (x86):

* bzImage - Compressed kernel image (arch/x86/boot/bzImage)

install - Install kernel using

(your) ~/bin/installkernel or

(distribution) /sbin/installkernel or

install to $(INSTALL_PATH) and run lilo

fdimage - Create 1.4MB boot floppy image (arch/x86/boot/fdimage)

fdimage144 - Create 1.4MB boot floppy image (arch/x86/boot/fdimage)

fdimage288 - Create 2.8MB boot floppy image (arch/x86/boot/fdimage)

isoimage - Create a boot CD-ROM image (arch/x86/boot/image.iso)

bzdisk/fdimage*/isoimage also accept:

FDARGS="..." arguments for the booted kernel

FDINITRD=file initrd for the booted kernel

kvmconfig - Enable additional options for guest kernel support

x86_64_defconfig - Build for x86_64

i386_defconfig - Build for i386

make V=0|1 [targets] 0 =&gt; quiet build (default), 1 =&gt; verbose build

make V=2 [targets] 2 =&gt; give reason for rebuild of target

make O=dir [targets] Locate all output files in "dir", including .config

make C=1 [targets] Check all c source with $CHECK (sparse by default)

make C=2 [targets] Force check of all c source with $CHECK

make RECORDMCOUNT_WARN=1 [targets] Warn about ignored mcount sections

make W=n [targets] Enable extra gcc checks, n=1,2,3 where

1: warnings which may be relevant and do not occur too often

2: warnings which occur quite often but may still be relevant

3: more obscure warnings, can most likely be ignored

Multiple levels can be combined with W=12 or W=123

Execute "make" or "make all" to build all targets marked with [*]

For further info see the ./README file

[root@apache linux-3.16.1]#</code></pre> 
   <font color="#666666"> </font>
   <p>执行 make menuconfig命令 出现图形</p> 
   <font color="#666666"> </font>
   <div style="text-align:center;"> 
    <img title="clip_image003" alt="clip_image003" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789567l2nC.png" height="335" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';">
    <br>
   </div> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">save</p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:center;"><img title="clip_image004" alt="clip_image004" src="http://blog.itpub.net/attachment/201408/23/27771627_14087895722pDy.png" height="322" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';"><br></p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">生成.config文件</p> 
   <font color="#666666"> </font>
   <div style="text-align:center;"> 
    <img title="clip_image005" alt="clip_image005" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789575kEzD.png" height="324" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';">
    <br>
   </div> 
   <font color="#666666" style="text-align:center;"> </font>
   <p>退出</p> 
   <font color="#666666"> </font>
   <div style="text-align:center;"> 
    <img title="clip_image006" alt="clip_image006" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789579Hpb2.png" height="320" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';">
    <br>
   </div> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">提示执行make继续或查看帮助</p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:center;"><img title="clip_image007" alt="clip_image007" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789582HkAk.png" height="211" width="644" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';"><br></p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">执行 make命令，根据环境编译kernel，生成模块文件。等待一段时间</p> 
   <font color="#666666"> </font>
   <p>执行make all 生成内核文件 和 模块文件</p> 
   <font color="#666666"></font>
   <pre><code class="language-none">[root@dns linux-3.16.1]# make all

CHK include/config/kernel.release

CHK include/generated/uapi/linux/version.h

CHK include/generated/utsrelease.h

CALL scripts/checksyscalls.sh

CHK include/generated/compile.h

CERTS kernel/x509_certificate_list

- Including cert signing_key.x509

AS kernel/system_certificates.o

LD kernel/built-in.o

CHK include/generated/uapi/linux/version.h

LINK vmlinux

LD vmlinux.o

MODPOST vmlinux.o

GEN .version

CHK include/generated/compile.h

UPD include/generated/compile.h

CC init/version.o

LD init/built-in.o

KSYM .tmp_kallsyms1.o

KSYM .tmp_kallsyms2.o

LD vmlinux

SORTEX vmlinux

SYSMAP System.map

TEST posttest

Succeed: decoded and checked 1702020 instructions

TEST posttest

arch/x86/tools/insn_sanity: Success: decoded and checked 1000000 random instructions with 0 errors (seed:0x769ca218)

VOFFSET arch/x86/boot/voffset.h

OBJCOPY arch/x86/boot/compressed/vmlinux.bin

GZIP arch/x86/boot/compressed/vmlinux.bin.gz

MKPIGGY arch/x86/boot/compressed/piggy.S

AS arch/x86/boot/compressed/piggy.o

LD arch/x86/boot/compressed/vmlinux

ZOFFSET arch/x86/boot/zoffset.h

AS arch/x86/boot/header.o

CC arch/x86/boot/version.o

LD arch/x86/boot/setup.elf

OBJCOPY arch/x86/boot/setup.bin

OBJCOPY arch/x86/boot/vmlinux.bin

BUILD arch/x86/boot/bzImage

Setup is 17104 bytes (padded to 17408 bytes).

System is 5064 kB

CRC 67447bac

Kernel: arch/x86/boot/bzImage is ready (#2)

Building modules, stage 2.

MODPOST 2161 modules

[root@dns linux-3.16.1]#</code></pre> 
   <font color="#666666"> </font>
   <p>执行 make modules_install 安装模块</p> 
   <p>执行 make install</p> 
   <p style="text-align:center;"><img title="clip_image008" alt="clip_image008" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789585loYp.png" height="98" width="644"><br></p> 
   <font color="#666666" style="text-align:center;"> </font>
   <p>重启</p> 
   <p>shutdown -r 0</p> 
   <p>选择新的kernel启动</p> 
   <img title="image" alt="image" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789588bJKk.png" height="193" width="644">
   <font color="#666666" style="text-align:center;"> </font>
   <p style="text-align:left;">查看当前kernel，uname -r</p> 
   <img title="clip_image009" alt="clip_image009" src="http://blog.itpub.net/attachment/201408/23/27771627_1408789590zpoB.png" height="91" width="625">
   <p align="center" style="text-align:left;">升级内核完成</p> 
   <p align="center" style="text-align:left;"><br></p> 
   <p align="center" style="text-align:left;">本文转自ICT时空 dbasdk博客，原文链接：<a href="http://blog.itpub.net/29734436/viewspace-1257485/" rel="nofollow">&nbsp;linux 内核升级步骤，kernel升级</a>&nbsp;，如需转载请自行联系原博主。<br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
