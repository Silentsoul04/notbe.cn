<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>动态Web API层 « NotBeCN</title>
  <meta name="description" content="             本篇目录         构建动态Web API控制器            ForAll 方法       重写ForAll 方法       Http动词            动态Javascript代理            Ajax参数       单一服务脚本       A...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/12/18/weixin_34362790_90135737.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">动态Web API层</h1>
    <p class="post-meta">Dec 18, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h2 style="font-size:21px;line-height:1.5;color:rgb(255,255,255);font-family:'微软雅黑', '宋体', '黑体', Arial;background:rgb(111,168,51);">本篇目录</h2> 
   <ul style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <li style="list-style:disc;"> <strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#build" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">构建动态Web API控制器</a></strong> 
     <ul>
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#ForAll" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">ForAll 方法</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#OverrideForAll" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">重写ForAll 方法</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#httpVerbs" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Http动词</a></strong></li> 
     </ul></li> 
    <li style="list-style:disc;"> <strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#proxy" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">动态Javascript代理</a></strong> 
     <ul>
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#ajax" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Ajax参数</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#single" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">单一服务脚本</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#angular" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Angular支持</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#Durandal" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Durandal支持</a></strong></li> 
      <li style="list-style:disc;"> <strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#wrap" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">返回结果封装</a></strong><span class="label-update" style="text-align:center;color:rgb(255,255,255);font-family:'Open Sans';font-size:12px;">【2016/3/28 更新】</span> </li> 
     </ul></li> 
    <li style="list-style:disc;"> <strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#paramBinding" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">关于参数绑定</a></strong> 
     <ul>
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#FromUri" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">FromUri和FromBody特性</a></strong></li> 
      <li style="list-style:disc;"><strong><a href="http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html#DTOs" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">DTOs vs 原始类型</a></strong></li> 
     </ul></li> 
   </ul>
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="build" style="color:rgb(224,130,131);"></a>构建动态Web API控制器</h3> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP可以自动地为应用层生成<strong>Web API 层</strong>。比如说我们有一个应用层如下所示：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">interface</span> <span class="hljs-title" style="color:rgb(163,21,21);">ITaskAppService</span> : <span class="hljs-title" style="color:rgb(163,21,21);">IApplicationService</span>
{
    <span class="hljs-function">GetTasksOutput <span class="hljs-title" style="color:rgb(163,21,21);">GetTasks</span>(<span class="hljs-params">GetTasksInput input</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">UpdateTask</span>(<span class="hljs-params">UpdateTaskInput input</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">CreateTask</span>(<span class="hljs-params">CreateTaskInput input</span>)</span>;
}
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们想把这个服务作为Web API控制器暴露给客户端。ABP只需要一行配置就可以为该应用服务创建一个Web API控制器：</p> 
   <pre class="c#"><code class="hljs dts" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">DynamicApiControllerBuilder.For<span class="hljs-params">&lt;ITaskAppService&gt;</span>(<span class="hljs-string" style="color:rgb(163,21,21);">"tasksystem/task"</span>).Build();
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">OK了！在地址为<strong>'/api/services/tasksystem/task'</strong>的地方就创建了一个API控制器，现在客户端可以使用该应用服务的所有方法。这个配置应该在模块的Initlize方法中完成。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们使用一个API控制器封装的<strong>ITaskAppService</strong>是一个应用服务。使用API控制器对应用服务进行封装不是强制的，但是这是传统推荐的方式。&nbsp;<strong>"tasksystem/task"</strong>一个具有随机命名空间的API控制器的名字。你应该至少定义一级的命名空间，但是你也可以定义更深层次的命名空间，比如&nbsp;<em>"myCompany/myApplication/myNamespace1/myNamespace2/myServiceName"</em>。&nbsp;<strong>'/api/services'</strong>是所有动态生成的Web API控制器的前缀。因此，该API控制器的地址将会是这个样子的&nbsp;<em>'/api/services/tasksystem/task'</em>，而GetTasks方法的地址将会是&nbsp;<em>'/api/services/tasksystem/task/getTasks'</em>。因为在javascript中惯例遵循&nbsp;<strong>camelCase</strong>规则，所以方法名都转成了camelCase格式。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="ForAll"></a>ForAll 方法</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在应用服务层可能会有很多的应用服务，如果要为这些应用服务都构建API控制器的话，一个一个地构建简直是费时费力的事情。没关系，ABP中的DynamicApiControllerBuilder提供了一个为所有应用服务构建Web API控制器的方法，这样我们只需要调用一次就行了。例如：</p> 
   <pre class="c#"><code class="hljs css" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-selector-tag" style="color:rgb(0,0,255);">DynamicApiControllerBuilder</span>
    <span class="hljs-selector-class">.ForAll</span>&lt;<span class="hljs-selector-tag" style="color:rgb(0,0,255);">IApplicationService</span>&gt;(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">Assembly</span><span class="hljs-selector-class">.GetAssembly</span>(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">typeof</span>(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">SimpleTaskSystemApplicationModule</span>)), "<span class="hljs-selector-tag" style="color:rgb(0,0,255);">tasksystem</span>")
    <span class="hljs-selector-class">.Build</span>();
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ForAll方法是接收接口类型的泛型方法。第一个参数是一个程序集，该程序集中含有派生自给定接口的类。最后一个参数是服务前缀的命名空间。比如说我们在给定的程序集中有ITaskAppService和IPersonAppService，对于这个配置的话，服务地址将会是 '/api/services/tasksystem/task' 和 '/api/services/tasksystem/person'。计算服务名称的方法是：移除Service或者AppService后缀，以及I前缀（对于接口来说）。此外，服务名称会转成camel Case(驼峰命名)的格式。如果你不喜欢这种转换，那么使用'WithServiceName'来决定服务发名称。此外，还有一个过滤服务的Where方法。除了个别应用服务之外，这个方法在你为其他所有的应用服务构建API控制器时很有用。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="OverrideForAll"></a>重写ForAll 方法</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在ForAll方法之后我们可以重写配置。例如：</p> 
   <pre class="c#"><code class="hljs vbnet" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">DynamicApiControllerBuilder
    .ForAll&lt;IApplicationService&gt;(<span class="hljs-keyword" style="color:rgb(0,0,255);">Assembly</span>.GetAssembly(<span class="hljs-built_in" style="color:rgb(0,0,255);">typeof</span>(SimpleTaskSystemApplicationModule)), <span class="hljs-string" style="color:rgb(163,21,21);">"tasksystem"</span>)
    .Build();

DynamicApiControllerBuilder
    .<span class="hljs-keyword" style="color:rgb(0,0,255);">For</span>&lt;ITaskAppService&gt;(<span class="hljs-string" style="color:rgb(163,21,21);">"tasksystem/task"</span>)
    .ForMethod(<span class="hljs-string" style="color:rgb(163,21,21);">"CreateTask"</span>).DontCreateAction()
    .Build();
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在上面的代码中，我们为一个程序集中所有的应用服务构建了动态的Web API控制器。然后又为一个应用服务（ITaskAppService）重写了配置，目的是忽略该应用服务中的CreateTask方法。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="httpVerbs"></a>Http动词</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">默认情况下，创建的方法都只能<strong>POST</strong>请求。我们也可以使用不同的方法来改变这种行为。<br><strong>WithVerb方法</strong></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们可以为一个方法使用WithVerb，像下面那样：</p> 
   <pre class="c#"><code class="hljs vbnet" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);">DynamicApiControllerBuilder
    .<span class="hljs-keyword" style="color:rgb(0,0,255);">For</span>&lt;ITaskAppService&gt;(<span class="hljs-string" style="color:rgb(163,21,21);">"tasksystem/task"</span>)
    .ForMethod(<span class="hljs-string" style="color:rgb(163,21,21);">"GetTasks"</span>).WithVerb(HttpVerb.<span class="hljs-keyword" style="color:rgb(0,0,255);">Get</span>)
    .Build();
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><strong>HTTP特性</strong></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们可以在应用服务的接口的方法上添加HttpGet，HttpPost等特性。</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">interface</span> <span class="hljs-title" style="color:rgb(163,21,21);">ITaskAppService</span> : <span class="hljs-title" style="color:rgb(163,21,21);">IApplicationService</span>
{
    [HttpGet]
    <span class="hljs-function">GetTasksOutput <span class="hljs-title" style="color:rgb(163,21,21);">GetTasks</span>(<span class="hljs-params">GetTasksInput input</span>)</span>;

    [HttpPut]
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">UpdateTask</span>(<span class="hljs-params">UpdateTaskInput input</span>)</span>;

    [HttpPost]
    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">void</span> <span class="hljs-title" style="color:rgb(163,21,21);">CreateTask</span>(<span class="hljs-params">CreateTaskInput input</span>)</span>;
}
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">使用这些特性之前，应该在项目中添加<strong><a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Core" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Microsoft.AspNet.WebApi.Core</a></strong>Nuget包的引用。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><strong>命名规范</strong></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">不用为每个方法都声明HTTP动词，你可以使用如下所示的<strong>WithConventionalVerbs</strong>方法：</p> 
   <pre class="c#"><code class="hljs css" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-selector-tag" style="color:rgb(0,0,255);">DynamicApiControllerBuilder</span>
    <span class="hljs-selector-class">.ForAll</span>&lt;<span class="hljs-selector-tag" style="color:rgb(0,0,255);">IApplicationService</span>&gt;(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">Assembly</span><span class="hljs-selector-class">.GetAssembly</span>(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">typeof</span>(<span class="hljs-selector-tag" style="color:rgb(0,0,255);">SimpleTaskSystemApplicationModule</span>)), "<span class="hljs-selector-tag" style="color:rgb(0,0,255);">tasksystem</span>")
    <span class="hljs-selector-class">.WithConventionalVerbs</span>()
    <span class="hljs-selector-class">.Build</span>();
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在这种情况下，Http动词会由方法名的前缀决定：</p> 
   <ul style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <li style="list-style:disc;"> <strong>Get</strong>：方法名以Get开头。</li> 
    <li style="list-style:disc;"> <strong>Put</strong>：方法名以Put或Update开头。</li> 
    <li style="list-style:disc;"> <strong>Delete</strong>：方法名以Delete或Remove开头。</li> 
    <li style="list-style:disc;"> <strong>Post</strong>：方法名以Post或Create开头。</li> 
    <li style="list-style:disc;">其他情况，Post是HTTP动词的默认值</li> 
   </ul>
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们可以通过对特定的方法使用WithVerb方法或者HTTP特性来覆盖上述惯例。</p> 
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="proxy" style="color:rgb(224,130,131);"></a>动态Javascript代理</h3> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">在Javascript中，可以经由Ajax使用动态创建的web api控制器。ABP通过为动态的web api控制器创建动态的Javascript代理简化了这个。因此，可以在Javascript中像调用一个function一样来调用一个动态的web api 控制器action：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-javascript"><code class="sourceCode javascript hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="va">abp</span>.<span class="va">services</span>.<span class="va">tasksystem</span>.<span class="va">task</span>.<span class="at">getTasks</span>(<span class="op">{</span> <span class="dt">state</span><span class="op">:</span> <span class="dv">1</span> <span class="op">}</span>).<span class="at">done</span>(<span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function"> (<span class="hljs-params">result</span>) </span><span class="op">{</span> <span class="co"><span class="hljs-comment" style="color:#008000;">//use result.tasks here...</span></span> <span class="op">}</span>)<span class="op">;</span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">Javascript代理是动态创建的。使用之前应该将下面动态的脚本包括在页面上。</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-html"><code class="sourceCode html hljs xml" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;<span class="hljs-name">script</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">src</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"/api/AbpServiceProxies/GetAll"</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">type</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"text/javascript"</span></span></span><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&gt;</span><span class="undefined"></span><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">服务方法返回了promise（查看<strong><a href="http://api.jquery.com/category/deferred-object/" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">jQuery.Deferred</a></strong>）。可以在返回的promise后面继续注册done，fail，then等回调函数。服务方法内部使用了abp.ajax。如果需要的话，它们会处理错误并显示错误信息。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="ajax"></a>Ajax参数</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">你可以把一个自定义的ajax参数作为第二个参数传给代理方法。</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-javascript"><code class="sourceCode javascript hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="va">abp</span>.<span class="va">services</span>.<span class="va">tasksystem</span>.<span class="va">task</span>.<span class="at">createTask</span>(<span class="op">{</span> <span class="dt">assignedPersonId</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">description</span><span class="op">:</span> <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'a new task description...'</span></span> <span class="op">},{</span> <span class="co"><span class="hljs-comment" style="color:#008000;">//override jQuery's ajax parameters</span></span> <span class="dt"><span class="hljs-keyword" style="color:rgb(0,0,255);">async</span></span><span class="op">:</span> <span class="kw"><span class="hljs-literal" style="color:rgb(163,21,21);">false</span></span><span class="op">,</span> <span class="dt">timeout</span><span class="op">:</span> <span class="dv">30000</span> <span class="op">}</span>).<span class="at">done</span>(<span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function"> (<span class="hljs-params"></span>) </span><span class="op">{</span> <span class="va">abp</span>.<span class="va">notify</span>.<span class="at">success</span>(<span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'successfully created a task!'</span></span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><strong><a href="http://api.jquery.com/jQuery.ajax/" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">jQuery.ajax</a></strong>的所有参数在这里都是有效的。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="single"></a>单一服务脚本</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">'/api/AbpServiceProxies/GetAll'会在一个文件中生成所有的服务代理。使用'/api/AbpServiceProxies/Get?name=serviceName'也可以生成一个单独的服务代理，只需要在页面中包括下面的代码：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-html"><code class="sourceCode html hljs xml" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;<span class="hljs-name">script</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">src</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"/api/AbpServiceProxies/Get?name=tasksystem/task"</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">type</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"text/javascript"</span></span></span><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&gt;</span><span class="undefined"></span><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></code></pre>
   </div> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="angular"></a>Angular支持</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP可以将动态的API控制器暴露给AngularJs服务。思考下面的例子：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-javascript"><code class="sourceCode javascript hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);">(<span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function">(<span class="hljs-params"></span>) </span><span class="op">{</span> <span class="va">angular</span>.<span class="at">module</span>(<span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'app'</span></span>).<span class="at">controller</span>(<span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'TaskListController'</span></span><span class="op">,</span> [ <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'$scope'</span></span><span class="op">,</span> <span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'abp.services.tasksystem.task'</span></span><span class="op">,</span> <span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function">(<span class="hljs-params">$scope</span></span><span class="op">,</span><span class="hljs-function"><span class="hljs-params"> taskService</span>) </span><span class="op">{</span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">var</span></span> vm <span class="op">=</span> <span class="kw"><span class="hljs-keyword" style="color:rgb(0,0,255);">this</span></span><span class="op">;</span> <span class="va">vm</span>.<span class="at">tasks</span> <span class="op">=</span> []<span class="op">;</span> <span class="va">taskService</span>.<span class="at">getTasks</span>(<span class="op">{</span> <span class="dt">state</span><span class="op">:</span> <span class="dv">0</span> <span class="op">}</span>).<span class="at">success</span>(<span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function">(<span class="hljs-params">result</span>) </span><span class="op">{</span> <span class="va">vm</span>.<span class="at">tasks</span> <span class="op">=</span> <span class="va">result</span>.<span class="at">tasks</span><span class="op">;</span> <span class="op">}</span>)<span class="op">;</span> <span class="op">}</span> ])<span class="op">;</span> <span class="op">}</span>)()<span class="op">;</span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们可以使用服务的名字（包含命名空间）注射一个服务。然后，可以作为正常的Javascript函数调用它的function。注意，我们注册到了success句柄上（而不是done），因为它就像在angular的$http服务中。ABP使用AngularJs的$http服务。如果</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">你想要传递$http配置，可以作为服务方法的最后一个参数传递一个配置对象。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">要使用自动生成的服务，应该在页面中包含需要的脚本：</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-html"><code class="sourceCode html hljs xml" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;<span class="hljs-name">script</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">src</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"~/Abp/Framework/scripts/libs/angularjs/abp.ng.js"</span></span></span><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&gt;</span><span class="undefined"></span><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;/<span class="hljs-name">script</span>&gt;</span></span> <span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;<span class="hljs-name">script</span></span></span><span class="ot"><span class="hljs-tag" style="color:rgb(0,0,255);"> <span class="hljs-attr" style="color:#FF0000;">src</span>=</span></span><span class="st"><span class="hljs-tag" style="color:rgb(0,0,255);"><span class="hljs-string" style="color:rgb(163,21,21);">"~/api/AbpServiceProxies/GetAll?type=angular"</span></span></span><span class="kw"><span class="hljs-tag" style="color:rgb(0,0,255);">&gt;</span><span class="undefined"></span><span class="hljs-tag" style="color:rgb(0,0,255);">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></code></pre>
   </div> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="Durandal"></a>Durandal支持</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP可以在一个<strong><a href="http://durandaljs.com/" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Durandal</a></strong>应用的模块中注入服务代理。看下面的viewmodel:</p> 
   <div class="sourceCode" style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">
    <pre><code class="language-javascript"><code class="sourceCode javascript hljs" style="line-height:1.5;vertical-align:middle;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);color:rgb(0,0,0);background:rgb(255,255,255);"><span class="at">define</span>([<span class="st"><span class="hljs-string" style="color:rgb(163,21,21);">'service!tasksystem/task'</span></span>]<span class="op">,</span> <span class="kw"><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(0,0,255);">function</span></span></span><span class="hljs-function"> (<span class="hljs-params">taskService</span>) </span><span class="op">{</span> <span class="co"><span class="hljs-comment" style="color:#008000;">//taskService can be used here</span></span> <span class="op">}</span>)<span class="op">;</span></code></code></pre>
   </div> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP配置Durandal(实际上是Require.js)来理解这个'service!'前缀，然后注入合适的javascript服务代理。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="wrap"></a>返回结果封装</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP通过&nbsp;<strong>AjaxResponse</strong>封装了动态Web API的action的返回值。查看《<strong><a href="http://www.cnblogs.com/farb/p/ABPJavascriptAPI.html#Ajax" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">Ajax文档</a></strong>》获取更多关于封装的信息。你可以为每个应用服务或者每个方法开启或者禁用封装。看下面这个应用服务的例子：</p> 
   <pre class="c#"><code class="hljs cs" style="vertical-align:middle;color:rgb(0,0,0);line-height:1.5;font-family:'Courier New', sans-serif;font-size:12px;border:1px solid rgb(204,204,204);"><span class="hljs-keyword" style="color:rgb(0,0,255);">public</span> <span class="hljs-keyword" style="color:rgb(0,0,255);">interface</span> <span class="hljs-title" style="color:rgb(163,21,21);">ITestAppService</span> : <span class="hljs-title" style="color:rgb(163,21,21);">IApplicationService</span>
{
    [DontWrapResult]
    <span class="hljs-function">DoItOutput <span class="hljs-title" style="color:rgb(163,21,21);">DoIt</span>(<span class="hljs-params">DoItInput input</span>)</span>;
}
</code></pre> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">这里我们为DoIt方法禁用了封装。这个特性应该为接口声明而不是实现类。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">如果你想更好地控制客户端的返回值，那么不封装返回的结果可能是很有用的。特别地，当使用不能和ABP标准的AjaxResponse协作的<strong>第三方客户端库</strong>时，可能需要禁用封装。这种情况下，你要自己处理异常。</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">注意：动态javascript代理可以理解返回的结果是否封装和运行正常。</p> 
   <h3 style="font-size:16px;line-height:1.5;color:rgb(111,168,51);border-left-width:13px;border-left-style:solid;border-left-color:rgb(111,168,51);font-family:'Microsoft Yahei', Simsun, Arial;"> <a name="paramBinding" style="color:rgb(224,130,131);"></a>关于参数绑定</h3> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">ABP在运行时创建了API控制器。因此，ASP.NET Web API的<strong><a href="http://www.asp.net/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" rel="nofollow" style="color:rgb(65,131,196);text-decoration:none;">模型和参数绑定</a></strong>可以用于绑定模型和参数。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="FromUri"></a>FromUri和FromBody特性</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">为了在绑定时进行高级控制，可以在服务接口上使用FromUri和FromBody特性。</p> 
   <h4 style="font-size:14px;color:rgb(205,73,0);border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(205,73,0);font-family:'Microsoft Yahei', Simsun, Arial;line-height:25px;"> <a name="DTOs"></a>DTOs vs原始类型</h4> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;">我们强烈建议为应用服务和Web API控制器的方法使用DTO作为参数类型，但是你也可以使用原始类型（如string，int，bool或者可空的类型如int?，bool?）作为参数类型。虽然可以在应用服务中使用不止一个参数，但是最好用一个复杂的类型将多个参数整合起来，否则客户端就不会生成动态代理服务。在日志记录中就会看到如下图所示的错误：</p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><img src="https://images2015.cnblogs.com/blog/577014/201601/577014-20160107164212918-348748482.png" style="border:0px;" alt="577014-20160107164212918-348748482.png"></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><br></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><br></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><br></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><br></p> 
   <p><font color="#494949"><span style="font-size:15px;line-height:25px;">本文转自tkbSimplest博客园博客，原文链接：http://www.cnblogs.com/farb/p/ABPDynamicWebAPI.html，如需转载请自行联系原作者</span></font><br></p> 
   <p style="color:rgb(73,73,73);font-family:'Microsoft Yahei', Simsun, Arial;font-size:15px;line-height:25px;"><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
