<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>摄像头基础介绍【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://www.mamicode.com/info-detail-506798.html    一、摄像头结构和工作原理.        &nbsp;&nbsp; 拍摄景物通过镜头，将生成的光学图像投射到传感器上，然后光学图像被转换成电信号，电信号再经过模数转换变为数字信号，...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/06/01/weixin_34163741_90119027.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">摄像头基础介绍【转】</h1>
    <p class="post-meta">Jun 1, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>转自：<a href="http://www.mamicode.com/info-detail-506798.html" rel="nofollow">http://www.mamicode.com/info-detail-506798.html</a></p> 
   <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">一、摄像头结构和工作原理.</span></p> 
   <p><img src="https://yqfile.alicdn.com/img_d8636026186174eaaf1a902d76c8d91e.jpeg" alt="技术分享"></p> 
   <p><span>&nbsp;&nbsp; 拍摄景物通过镜头，将生成的光学图像投射到传感器上，然后光学图像被转换成电信号，电信号再经过模数转换变为数字信号，<span>数字信号经过DSP加工处理，再被送到<span>电脑<span>中进行处理，最终转换成手机屏幕上能够看到的图像。</span></span></span></span></p> 
   <p><span>数字信号处理芯片DSP(DIGITAL SIGNAL PROCESSING)功能：主要是通过一系列复杂的数学算法运算，对数字图像信号参数进行优化处理，并把处理后的信号通过USB等接口传到PC等设备。DSP结构框架:</span></p> 
   <p>　　1. ISP(image signal processor)(镜像信号处理器)</p> 
   <p>　　2. JPEG encoder(JPEG图像解码器)</p> 
   <p>　　3. USB device controller(USB设备控制器)</p> 
   <p>&nbsp; &nbsp; 常见的摄像头传感器类型主要有两种，</p> 
   <p style="color:#252525;"><strong>一种是CCD传感器</strong><span style="line-height:1.5;">（Chagre Couled Device），即电荷耦合器<span style="line-height:1.5;">。</span></span></p> 
   <p style="color:#252525;"><strong>一种是CMOS传感器</strong><span style="line-height:1.5;">（Complementary Metal-Oxide Semiconductor）即互补性金属氧化物半导体<span style="line-height:1.5;">。</span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span>C<span>CD的优势在于成像质量好，但是制造工艺复杂，成本高昂，且耗电高。在相同分辨率下，CMOS价格比CCD便宜，但图像质量相比CCD来说要低一些。<span>CMOS影像传感器相对CCD具有耗电低的优势，加上随着工艺技术的进步，CMOS的画质水平也不断地在提高，所以目前市面上的手机摄像头都采用CMOS传感器。</span></span></span></p> 
   <p><img src="https://yqfile.alicdn.com/img_928f85bc831043c1c345ceb8da0b355e.jpeg" alt="技术分享"></p> 
   <p><span style="color:#252525;">手机摄像头的简单结构</span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;">滤光片有两大功用:</p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span>　　1.滤除红外线。<span>滤除对可见光有干扰的红外光，使成像效果更清晰。</span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span>&nbsp; &nbsp; &nbsp; &nbsp;2.修整进来的光线<span>。感光芯片由<span>感光体(CELL)构成,最好的光线是直射进来,但为了怕干扰到邻近感光体,就需要对光线加以修整,因此那片滤光片不是玻璃,而是石英片,利用石英的物理偏光特性,把进来的光线,保留直射部份,反射掉斜射部份,避免去影响旁边的感光点.</span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;">&nbsp;</p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;">二、相关参数和名词</p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;">1、常见图像格式</p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><strong>&nbsp; &nbsp; 1.1&nbsp;RGB格式：</strong></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="color:#333333;font-family:Arial;">&nbsp; &nbsp; 传统的红绿蓝格式，比如R<span style="color:#333333;font-family:Arial;">GB565，RGB888，其16-bit数据格式为5-bit R + 6-bit G + 5-bit B。G多一位，原因是人眼对绿色比较敏感。</span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><strong>&nbsp; &nbsp; 1.2&nbsp;YUV格式：</strong></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="line-height:1.5;">&nbsp; &nbsp; luma&nbsp;(Y)&nbsp;+&nbsp;chroma&nbsp;(UV)&nbsp;格式<span style="font-family:Simsun;font-size:12px;line-height:1.5;">。<span style="line-height:1.5;color:#333333;font-family:Arial;">YUV是指亮度参量和色度参量分开表示的像素格式，而这样分开的好处就是不但可以避免相互干扰，还可以降低色度的采样率而不会对图像质量影响太大。YUV是一个比较笼统地说法，针对它的具体排列方式，可以分为很多种具体的格式。</span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="color:#333333;font-family:Arial;line-height:1.5;">色度(<span style="color:#333333;font-family:arial, '宋体', sans-serif;font-size:14.3999996185303px;">UV)<span style="color:#333333;font-family:arial, '宋体', sans-serif;font-size:14.3999996185303px;">定义了颜色的两个方面─色调与饱和度，<span style="color:#333333;font-family:arial, '宋体', sans-serif;font-size:14.3999996185303px;">分别用CB和CR表示。其中，Cr反映了RGB输入信号红色部分与RGB信号亮度值之间的差异。而Cb反映的是RGB输入信号蓝色部分与RGB信号亮度值之间的差异。</span></span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="color:#333333;font-family:arial, '宋体', sans-serif;font-size:14.3999996185303px;">主要的采样格式有YCbCr 4:2:0、YCbCr 4:2:2、YCbCr 4:1:1和 YCbCr 4:4:4。</span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><strong>&nbsp; &nbsp; 1.3&nbsp;RAW data格式：</strong></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="color:#333333;font-family:arial, '宋体', sans-serif;line-height:1.5;">&nbsp; &nbsp; RAW图像就是CMOS或者CCD图像感应器将捕捉到的光源信号转化为数字信号的原始数据。RAW文件是一种记录了数码相机传感器的原始信息，同时记录了由相机拍摄所产生的一些元数据（Metadata，如ISO的设置、快门速度、光圈值、白平衡等）的文件。RAW是未经处理、也未经压缩的格式，可以把RAW概念化为“原始图像编码数据”或更形象的称为“数字底片”。<span style="color:#333333;font-family:arial, '宋体', sans-serif;line-height:1.5;">sensor的每一像素对应一个彩色滤光片，滤光片按Bayer pattern分布。将每一个像素的数据直接输出，即RAW RGB data</span></span></p> 
   <p><span style="color:#333333;font-family:arial, '宋体', sans-serif;">Raw data（Raw RGB）经过彩色插值就变成RGB.</span></p> 
   <p><img src="https://yqfile.alicdn.com/img_509c28c580747ab8b7eff9433bc3f7fa.jpg" alt="技术分享"></p> 
   <p><span style="color:#333333;font-family:Arial;">RAW格式图像示例</span></p> 
   <p>2. 相关技术指标</p> 
   <p><strong>2.1 图像解析度/分辨率(Resolution)</strong>：</p> 
   <p>　　SXGA(1280 x1024)又称130万像素</p> 
   <p>　　XGA(1024 x768)又称80万像素</p> 
   <p>　　SVGA(800 x600)又称50万像素</p> 
   <p>　　VGA(640x480)又称30万像素(35万是指648X488)</p> 
   <p>　　CIF(352x288) 又称10万像素</p> 
   <p>　　SIF/QVGA(320x240)</p> 
   <p>　　QCIF(176x144)</p> 
   <p>　　QSIF/QQVGA(160x120)</p> 
   <p><span><strong>2.2 彩色深度(色彩位数)</strong>：</span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>256色<span>灰阶<span>，有256种灰色（包括黑白）。</span></span></span></span></p> 
   <p><span>&nbsp; &nbsp; 15或16位彩色（<span>高彩色）：<span>65,536种颜色。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>24位彩色（真彩色）：每种原色都有256个层次，它们的组合便有256*256*256种颜色。</span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>32位彩色：除了24位彩色的颜色外，额外的8位是储存重叠图层的图形资料(alpha频道)。</span></span></p> 
   <p><span><strong>2.3 光学变焦和数码变焦：</strong></span></p> 
   <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">&nbsp; &nbsp; 光学变焦：&nbsp;通过镜头的调整，拉近拉远所要拍摄的对象，保持像素不变和画质基本不变，却可以拍到自己 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 理想的物像。<br><span>&nbsp; &nbsp; 数码变焦：其实没有什么变焦，只是从原图片中截取出来放大，你从<span>液晶屏幕上看到变大了，实际上画质并没有本质提高，而像素比你相机能拍摄的最大像素降低了。 画质上说基本是鸡肋把，但是可以提供一些方便。</span></span></span></p> 
   <p><span><strong>2.4 图像压缩方式：</strong></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span><span><span>&nbsp; &nbsp; JPEG/M-JPEG</span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span><span><span>&nbsp; &nbsp; H.261/H.263</span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span><span><span>&nbsp; &nbsp; MPEG</span></span></span></p> 
   <p style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span><span>&nbsp; &nbsp; H.264&nbsp;</span></span></p> 
   <p><span><strong>2.5 图像噪音：</strong></span></p> 
   <p>　　指的是图像中的杂点干挠。表现为图像中有固定的彩色杂点。</p> 
   <p><span><strong>2.6 自动白平衡处理技术</strong><span style="line-height:1.5;">(auto&nbsp;<span style="line-height:1.5;">White Balance<span style="line-height:1.5;">)<span style="line-height:1.5;">：</span></span></span></span></span></p> 
   <p><span>&nbsp; &nbsp; &nbsp; 简单来说就是：<span>摄像机对白色物体的还原。<span>相关概念：<span>色温。</span></span></span></span></p> 
   <p><strong>2.7 视角</strong>：</p> 
   <p>　　与人的眼睛成像是相成原理，简单说就是成像范围。</p> 
   <p><span><strong>2.8 自动对焦：</strong></span></p> 
   <p><span>&nbsp; &nbsp; &nbsp; &nbsp;自动对焦可以分成两大类：一类是基于镜头与被拍摄目标之间距离测量的测距自动对焦，另一类是基于对焦屏上成像清晰的聚焦检测自动对焦(清晰度算法<span>)。</span></span></p> 
   <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span>注：<span>变焦<span>就是把远处的物体拉近。<span>对焦<span>是让图像清晰。</span></span></span></span></span></span></p> 
   <p><span><strong>2.9 自动曝光和Gamma</strong>：</span></p> 
   <p><span>&nbsp; &nbsp;<span>&nbsp; &nbsp;就是<span>光圈<span>和<span>快门<span>的组合。<span>光圈，<span>快门速度<span>，<span>ISO<span>。<span>Gamma即人眼对亮度的响应曲线。</span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p>&nbsp;</p> 
   <p style="color:#333333;"><span style="line-height:1.5;">&nbsp;</span></p> 
   <p style="color:#333333;">&nbsp;</p> 
   <p>三、高通的CAMERA部分硬件架构</p> 
   <p><img src="https://yqfile.alicdn.com/img_6e14b5c0d099e3b55777b746f3d0dbb3.jpg" alt="技术分享"></p> 
   <p>&nbsp;</p> 
   <p>CAMERA部分硬件架构</p> 
   <p>VFE：VIDEO front-end 视频前端</p> 
   <p>VPE：Video preprocessing&nbsp;<span>视频预处理</span></p> 
   <p>摄像头模组中自带了ISP（图像信号处理器），所以，VFE和VPE有关图像效果处理的功能都是关闭的。</p> 
   <p>1.VFE的功能：</p> 
   <p>&nbsp; &nbsp; 1.1 通过算法提高图像的质量。</p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>2 提供高分辨率的图像的AWB(自动白平衡)/AE(自动曝光)/AF(自动对焦)算法处理。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>3 图像衰减校正。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>4 低光下的噪声滤波。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>5 图像色彩效果优化。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>6 皮肤颜色效果优化。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>7 图像抖动计算。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>1.<span>8&nbsp;<span>亮度适应算法。</span></span></span></span></p> 
   <p>2.VPE的功能：</p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>2.<span>1 图像稳定性。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>2.<span>2 数字对焦。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>2.<span>3 图像旋转。</span></span></span></p> 
   <p><span>&nbsp; &nbsp;&nbsp;<span>2.<span>4 Overlay。</span></span></span></p> 
   <p><img src="https://yqfile.alicdn.com/img_1d806e2c9825a43c67b9e06a8ef0e757.jpg" alt="技术分享"></p> 
   <p>三、android系统camera基本架构</p> 
   <p style="color:#333333;font-family:Arial;"><strong>1.应用层</strong></p> 
   <p style="color:#333333;font-family:Arial;">Camera&nbsp;的应用层在Android&nbsp;上表现为直接调用SDK API&nbsp;开发的一个Camera&nbsp;应用APK&nbsp;包。代码在/android/packages/apps/Camera&nbsp;下。主要对 android.hardware.Camera（在Framework中） 类的调用，并且实现Camera&nbsp;应用的业务逻辑和UI&nbsp;显示。一个Android&nbsp;应用中若要使用这个android.hardware.Camera类，需要在Manifest&nbsp;文件声明Camera&nbsp;的权限，另外还 需要添加一些&lt;uses-feature&gt;&nbsp;元素来声明应用中的Camera&nbsp;特性，如自动对焦等。&nbsp;具体做法可如下：</p> 
   <p style="color:#333333;font-family:Arial;">&lt;uses-permission&nbsp;android:name&nbsp;=&nbsp;"android.permission.CAMERA"&nbsp;/&gt;</p> 
   <p style="color:#333333;font-family:Arial;">&lt;uses-feature&nbsp;android:name&nbsp;=&nbsp;"android.hardware.camera"&nbsp;/&gt;</p> 
   <p style="color:#333333;font-family:Arial;">&lt;uses-feature&nbsp;android:name&nbsp;=&nbsp;"android.hardware.camera.autofocus"&nbsp;/&gt;</p> 
   <p style="color:#333333;font-family:Arial;"><strong>2.Framework层</strong></p> 
   <p style="color:#333333;font-family:Arial;">2.1 android.hardware.Camera：代码位置/android/frameworks/base/core/java/android/hardware/Camera.java</p> 
   <p style="color:#333333;font-family:Arial;">这部分目标是framework.jar。这是是Android&nbsp;提供给app层调用的java接口。这个类用来连接或断开一个Camera&nbsp;服务，设置拍摄参数，开始、停止预览，拍照等。</p> 
   <p style="color:#333333;font-family:Arial;">2.2 android.hardware.Camera这个类是和JNI中定义的类是一个，有些方法通过JNI的方式调用本地代码得到，有些方法自己实现。&nbsp;<br>Camera的JAVA native调用部分（JNI）：/android/frameworks/base/core/jni/android_hardware_Camera.cpp。Camera.java 承接JAVA&nbsp;代码到C++&nbsp;代码的桥梁。编译生成libandroid_runtime.so&nbsp;。libandroid_runtime.so库是公用的,&nbsp;其中除了Camera&nbsp;还有其他方面的功能。</p> 
   <p style="color:#333333;font-family:Arial;">2.3 Camera框架的client部分：</p> 
   <p style="color:#333333;font-family:Arial;">代码位置：/android/frameworks/base/libs/camera/下5个文件。</p> 
   <p style="color:#333333;font-family:Arial;">Camera.cpp</p> 
   <p style="color:#333333;font-family:Arial;">CameraParameters.cpp</p> 
   <p style="color:#333333;font-family:Arial;">ICamera.cpp</p> 
   <p style="color:#333333;font-family:Arial;">ICameraClient.cpp</p> 
   <p style="color:#333333;font-family:Arial;">ICameraService.cpp</p> 
   <p style="color:#333333;font-family:Arial;">它们的头文件在/android/frameworks/base/include/camera目录下。</p> 
   <p style="color:#333333;font-family:Arial;">这部分的内容编译生成libcamera_client.so&nbsp;。在Camera&nbsp;模块的各个库中，libcamera_client.so 位于核心的位置，作为Camera&nbsp;框架的 Client&nbsp;客户端部分，与另外一部分内容服务端&nbsp;libcameraservice.so&nbsp;通过进程间通讯（即Binder&nbsp;机制）的方式进行通讯。</p> 
   <p style="color:#333333;font-family:Arial;">2.4 Camera框架的service部分：</p> 
   <p style="color:#333333;font-family:Arial;">代码位置：/android/frameworks/base/services/camera/libcameraservice。</p> 
   <p style="color:#333333;font-family:Arial;">这部分内容被编译成库libcameraservice.so&nbsp;。CameraService&nbsp;是Camera&nbsp;服务，Camera&nbsp;框架的中间层，用于链接CameraHardwareInterface&nbsp;和Client部分 ，它通过调用实际的Camera&nbsp;硬件接口来实现功能，即下层HAL层。</p> 
   <p><img src="https://yqfile.alicdn.com/img_ae946f2b854c3d692175394a04cc7fec.gif" alt="技术分享"></p> 
   <p><img src="https://yqfile.alicdn.com/img_9d53d39890bb864171139980f1d3505f.gif" alt="技术分享"></p> 
   <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">四. 摄像头预览、拍照、录像基本数据流向和处理流程以及驱动调试</span></p> 
   <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><img src="https://yqfile.alicdn.com/img_9566c30ecfac20169a13e59004dca833.jpg" alt="技术分享"></span></p> 
   <p>HAl层相关代码：（frameworks/base/services/camera/libcameraservice/CameraService.cpp）vendor/qcom/android-open/libcamera2/QualcommCameraHardware.cppvendor/qcom/proprietary/mm-camera/apps/appslib/mm_camera_interface.cvendor/qcom/proprietary/mm-camera/apps/appslib/camframe.cvendor/qcom/proprietary/mm-camera/apps/appslib/snapshot.cvendor/qcom/proprietary/mm-camera/apps/appslib/jpeg_encoder.cvendor/qcom/proprietary/mm-camera/apps/appslib/cam_frame_q.cvendor/qcom/proprietary/mm-camera/apps/appslib/cam_display.cvendor/qcom/proprietary/mm-camera/targets/vfe31/8x60/vendor/qcom/proprietary/mm-camera/targets/vfe31/common/vpe1/<span>QualcommCameraHardware.cpp主要分为三个部分，preview，snapshot，video。它们分别用一个pthread进行处理。另外还有auto focus功能也是用pthread的方式处理。预览或拍照、视频线程处理得到的数据帧都以datacallback的方式回调到上层<span>CameraService.cpp中，进行存储或预览等操作。以下是HAL层部分的代码大概的调用结构流程。<span><br></span></span></span></p> 
   <p><span>&nbsp;</span></p> 
   <p><span><img src="https://yqfile.alicdn.com/img_35045fc9941e4d1111c67dea16817789.jpg" alt="技术分享"></span></p> 
   <ol>
    <li> <p>整个模块主要巡行三个主线程：control、config及frame。</p> <p>control用来执行总的控制，是上层控制接口。</p> </li> 
   </ol>
   <p>&nbsp; &nbsp; &nbsp; &nbsp; config主要进行一些配置，这个线程里面主要进行3A的工作，另外还有一些跟效果有关的设置；</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; frame线程主要用来做帧queue的循环获取处理。<span>所有事件或状态的反馈，用回调函数的方式传回<span>QualcommCameraHardware.cpp。</span></span></p> 
   <p>2. 驱动部分从设备驱动s5k8aa.c开始。新建平台设备后，执行入口函数probe时，调用创建摄像头设备功能函数</p> 
   <p>int msm_camera_drv_start(struct platform_device *dev, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int (*sensor_probe)(const struct msm_camera_sensor_info *,&nbsp;</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct msm_sensor_ctrl *))</p> 
   <p>并将设备信息结构体和摄像头设备调用入口<span>/dev/msm_camera/frame%d</span></p> 
   <p>/dev/msm_camera/config%d</p> 
   <p>/dev/msm_camera/pic%d</p> 
   <p>实现了上层库对VFE模块，VPE模块，jpeg_encoder模块和摄像头sensor模块驱动的控制调用接口。在file_operations中的相应函数中分别实现的是这些设备的新建初始化和IOCTL功能调用接口。</p> 
   <p>然后这个函数还创建了四个工作队列：&nbsp;</p> 
   <p>struct msm_device_queue event_q;&nbsp;</p> 
   <p>struct msm_device_queue frame_q;&nbsp;</p> 
   <p>struct msm_device_queue pict_q;&nbsp;</p> 
   <p>struct msm_device_queue vpe_q;</p> 
   <p>event_q包括<span style="line-height:1.5;">/dev/msm_camera/control%d传入的<span style="line-height:1.5;">控制信号队列，用于将上层传下来的控制命令(command)传到config thread中去。</span></span></p> 
   <p>frame_q用于对图像帧的操作管理，预览或录像时帧将传递给DSP进行处理。</p> 
   <p>pict_q包含拍照帧，用于给jpeg_encoder进行图像编码处理。</p> 
   <p>vpe_q是VPE控制命令队列。</p> 
   <p>s5k8aa.c是相应摄像头设备的驱动部分。它的功能很简单，主要实现sensor模块的创建、初始化和控制。主要实现以下三个函数：&nbsp;</p> 
   <p>s-&gt;s_init = ov2685_sensor_init;&nbsp;</p> 
   <p>s-&gt;s_release = ov2685_sensor_release;&nbsp;</p> 
   <p>s-&gt;s_config = ov2685_sensor_config;</p> 
   <p>ov2685_sensor_init函数：&nbsp; &nbsp;&nbsp;</p> 
   <p>主要实现摄像头的上电、时钟控制（MCLK）、设备初始化功能。&nbsp; &nbsp; 上电分为DOVDD、DVDD、AVDD、reset、PWDN几个部分。需要按照设备要求顺序操作，一般时钟控制顺序也包含在内。&nbsp; &nbsp; 设备初始化过程是将sensor设备的所有寄存器全部初始化一遍，采用IIC方式将初始化寄存器地址和值全部发送到sensor端。完成后此时摄像头模组才能正常工作，并将图像通过MIPI线路传送到CPU端。</p> 
   <p><span style="line-height:1.5;">ov2685_sensor_config函数：&nbsp; &nbsp;&nbsp;</span></p> 
   <p>主要实现对sensor的各种配置接口，相应的有帧率配置，白平衡效果设置，曝光度设置，特效设置等等。相应接口将配置好的寄存器列表通过IIC发送到sensor中。</p> 
   <p>3. 摄像头调试中的几个问题点：</p> 
   <p>1.1 是否正确上电，是否有时钟波形输出。&nbsp; &nbsp; 检测输出电压的电压值是否和上电时序以及MCLK是否符合sensor的要求。这部分可以用示波器和万用表测量。测量电压值和上电时序以及MCLK的时钟频率是否正确。</p> 
   <p>1.2 IIC读写是否正常。<span>调试CPU与ISP间的I2C通信。<span>&nbsp; &nbsp; 检测包括IIC地址是否正确，协议是否匹配。这部分也可以用示波器测量IIC的SDA、CLK的峰值、波形逻辑是否正确。</span></span></p> 
   <p>1.3 正确上电并初始化以后sensor模块是否正常工作。&nbsp; &nbsp; 这部分主要通过用示波器测量MIPI线路的数据和时钟PIN是否正确，它的波形是否含有数据，是否标准波形，峰值有没有达到要求等。</p> 
   <p>1.4 如果以上都正确了以后，MIPI控制器将接收到中断，并开始处理图像信号。此时如果出错，可以通过中断信号的出错值查看错误状态。除CPU端是否正常初始化工作的问题外，需要关注模组端设置的图像格式和CPU接收的默认图像格式和图像大小（SIZE）是否一致。模组中图片格式和图像大小通过寄存器值查看。CPU端接收图片格式和图像大小在HAL部分的s5k8aa中设置, 拍照源图像大小和预览源图像大小需要分别设置。</p> 
   <p>以上部分完成后，摄像头可以正确预览。</p> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
