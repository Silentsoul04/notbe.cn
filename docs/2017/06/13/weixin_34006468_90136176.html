<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CentOS升级Python2.7导致使用pip等命令安装模块失败 « NotBeCN</title>
  <meta name="description" content="             报错如下：         # pipTraceback (most recent call last):  File "/usr/bin/pip", line 5, in &lt;module&gt;    from pkg_resources import load_entry_po...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/06/13/weixin_34006468_90136176.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">CentOS升级Python2.7导致使用pip等命令安装模块失败</h1>
    <p class="post-meta">Jun 13, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="margin-left:30px;">报错如下：</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre><span style="color:#000000;"># pip
Traceback (most recent call </span><span style="color:#0000ff;">last</span><span style="color:#000000;">):
  File </span><span style="color:#800000;">"</span><span style="color:#800000;">/usr/bin/pip</span><span style="color:#800000;">"</span>, line <span style="color:#800080;">5</span>, <span style="color:#0000ff;">in</span> &lt;module&gt;<span style="color:#000000;">
    from pkg_resources import load_entry_point
ImportError: No module named pkg_resources</span></pre> 
   </div> 
   <p style="margin-left:30px;">出现这个问题是因为：虽然已经把Python升级到了2.7版本，但是pip仍然是原来的版本，仍在原来python的site-package里面</p> 
   <p style="margin-left:30px;">CentOS6.8环境下，默认是python2.6.6，site-package在</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre># /usr/lib/python2.<span style="color:#800080;">6</span>/site-packages/</pre> 
   </div> 
   <p style="margin-left:30px;">很多模块都被安装在这里。直接输入pip，还是使用的原来的pip。所以我们的思路是：应该在新的Python中安装pip，这样才不会报错。</p> 
   <p style="margin-left:30px;">遇到此问题的人很多，网上博客都是互相抄，没有真正解决问题的。有一国外网站给出了解决方案：</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre><span style="color:#0000ff;"># wget</span> https:<span style="color:#008000;">//</span><span style="color:#008000;">pypi.python.org/packages/source/s/setuptools/setuptools-3.5.1.zip</span>
<span style="color:#0000ff;"># unzip</span> setuptools-<span style="color:#800080;">3.5</span>.<span style="color:#800080;">1</span>.<span style="color:#0000ff;">zip</span>
# /usr/local/bin/pyton2.<span style="color:#800080;">7</span> distribute_setup.py</pre> 
   </div> 
   <p style="margin-left:30px;">使用新版本的python来运行这个脚本，这个会自动安装出来一个easy_install，然后使用这个新的easy_install来安装pip就可以了！</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre># /usr/local/bin/<span style="color:#000000;">easy_install pip
# </span>/usr/local/bin/pip -<span style="color:#000000;">V
pip </span><span style="color:#800080;">9.0</span>.<span style="color:#800080;">1</span> from /usr/local/lib/python2.<span style="color:#800080;">7</span>/site-packages/pip-<span style="color:#800080;">9.0</span>.<span style="color:#800080;">1</span>-py2.<span style="color:#800080;">7</span>.egg (python <span style="color:#800080;">2.7</span>)</pre> 
   </div> 
   <p style="margin-left:30px;">安装生成的所有二进制文件，都是在你的PYTHON_HOME/bin/，因为我的是安装在/usr/local/python/，所以命令都在这里，以后再调用pip要使用绝对路径，或者做链接！</p> 
   <p style="margin-left:30px;">2.7的模块是在以下目录</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre># /usr/local/lib/python2.<span style="color:#800080;">7</span>/site-packages</pre> 
   </div> 
   <p style="margin-left:30px;">附：脚本的原文</p> 
   <div class="cnblogs_code" style="margin-left:30px;"> 
    <pre><span style="color:#008000;">#</span><span style="color:#008000;">!python</span>
<span style="color:#800000;">"""</span><span style="color:#800000;">Bootstrap distribute installation
 
If you want to use setuptools in your package's setup.py, just include this
file in the same directory with it, and add this to the top of your setup.py::
 
    from distribute_setup import use_setuptools
    use_setuptools()
 
If you want to require a specific version of setuptools, set a download
mirror, or use an alternate download directory, you can do so by supplying
the appropriate options to ``use_setuptools()``.
 
This file can also be run as a script to install or upgrade setuptools.
</span><span style="color:#800000;">"""</span>
<span style="color:#0000ff;">import</span><span style="color:#000000;"> os
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> shutil
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> sys
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> time
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> fnmatch
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> tempfile
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> tarfile
</span><span style="color:#0000ff;">import</span><span style="color:#000000;"> optparse
 
</span><span style="color:#0000ff;">from</span> distutils <span style="color:#0000ff;">import</span><span style="color:#000000;"> log
 
</span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
    </span><span style="color:#0000ff;">from</span> site <span style="color:#0000ff;">import</span><span style="color:#000000;"> USER_SITE
</span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
    USER_SITE </span>=<span style="color:#000000;"> None
 
</span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
    </span><span style="color:#0000ff;">import</span><span style="color:#000000;"> subprocess
 
    </span><span style="color:#0000ff;">def</span> _python_cmd(*<span style="color:#000000;">args):
        args </span>= (sys.executable,) +<span style="color:#000000;"> args
        </span><span style="color:#0000ff;">return</span> subprocess.call(args) ==<span style="color:#000000;"> 0
 
</span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> will be used for python 2.3</span>
    <span style="color:#0000ff;">def</span> _python_cmd(*<span style="color:#000000;">args):
        args </span>= (sys.executable,) +<span style="color:#000000;"> args
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> quoting arguments if windows</span>
        <span style="color:#0000ff;">if</span> sys.platform == <span style="color:#800000;">'</span><span style="color:#800000;">win32</span><span style="color:#800000;">'</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">def</span><span style="color:#000000;"> quote(arg):
                </span><span style="color:#0000ff;">if</span> <span style="color:#800000;">'</span> <span style="color:#800000;">'</span> <span style="color:#0000ff;">in</span><span style="color:#000000;"> arg:
                    </span><span style="color:#0000ff;">return</span> <span style="color:#800000;">'</span><span style="color:#800000;">"%s"</span><span style="color:#800000;">'</span> %<span style="color:#000000;"> arg
                </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> arg
            args </span>= [quote(arg) <span style="color:#0000ff;">for</span> arg <span style="color:#0000ff;">in</span><span style="color:#000000;"> args]
        </span><span style="color:#0000ff;">return</span> os.spawnl(os.P_WAIT, sys.executable, *args) ==<span style="color:#000000;"> 0
 
DEFAULT_VERSION </span>= <span style="color:#800000;">"</span><span style="color:#800000;">0.6.49</span><span style="color:#800000;">"</span><span style="color:#000000;">
DEFAULT_URL </span>= <span style="color:#800000;">"</span><span style="color:#800000;">http://pypi.python.org/packages/source/d/distribute/</span><span style="color:#800000;">"</span><span style="color:#000000;">
SETUPTOOLS_FAKED_VERSION </span>= <span style="color:#800000;">"</span><span style="color:#800000;">0.6c11</span><span style="color:#800000;">"</span><span style="color:#000000;">
 
SETUPTOOLS_PKG_INFO </span>= <span style="color:#800000;">"""</span><span style="color:#800000;">\
Metadata-Version: 1.0
Name: setuptools
Version: %s
Summary: xxxx
Home-page: xxx
Author: xxx
Author-email: xxx
License: xxx
Description: xxx
</span><span style="color:#800000;">"""</span> %<span style="color:#000000;"> SETUPTOOLS_FAKED_VERSION
 
</span><span style="color:#0000ff;">def</span> _install(tarball, install_args=<span style="color:#000000;">()):
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> extracting the tarball</span>
    tmpdir =<span style="color:#000000;"> tempfile.mkdtemp()
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Extracting in %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, tmpdir)
    old_wd </span>=<span style="color:#000000;"> os.getcwd()
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        os.chdir(tmpdir)
        tar </span>=<span style="color:#000000;"> tarfile.open(tarball)
        _extractall(tar)
        tar.close()
 
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> going in the directory</span>
        subdir =<span style="color:#000000;"> os.path.join(tmpdir, os.listdir(tmpdir)[0])
        os.chdir(subdir)
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Now working in %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, subdir)
 
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> installing</span>
        log.warn(<span style="color:#800000;">'</span><span style="color:#800000;">Installing Distribute</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> _python_cmd(<span style="color:#800000;">'</span><span style="color:#800000;">setup.py</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span>, *<span style="color:#000000;">install_args):
            log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Something went wrong during the installation.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
            log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">See the error message above.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
            </span><span style="color:#008000;">#</span><span style="color:#008000;"> exitcode will be 2</span>
            <span style="color:#0000ff;">return</span> 2
    <span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        os.chdir(old_wd)
        shutil.rmtree(tmpdir)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _build_egg(egg, tarball, to_dir):
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> extracting the tarball</span>
    tmpdir =<span style="color:#000000;"> tempfile.mkdtemp()
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Extracting in %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, tmpdir)
    old_wd </span>=<span style="color:#000000;"> os.getcwd()
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        os.chdir(tmpdir)
        tar </span>=<span style="color:#000000;"> tarfile.open(tarball)
        _extractall(tar)
        tar.close()
 
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> going in the directory</span>
        subdir =<span style="color:#000000;"> os.path.join(tmpdir, os.listdir(tmpdir)[0])
        os.chdir(subdir)
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Now working in %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, subdir)
 
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> building an egg</span>
        log.warn(<span style="color:#800000;">'</span><span style="color:#800000;">Building a Distribute egg in %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, to_dir)
        _python_cmd(</span><span style="color:#800000;">'</span><span style="color:#800000;">setup.py</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">-q</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">bdist_egg</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">--dist-dir</span><span style="color:#800000;">'</span><span style="color:#000000;">, to_dir)
 
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        os.chdir(old_wd)
        shutil.rmtree(tmpdir)
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> returning the result</span>
<span style="color:#000000;">    log.warn(egg)
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> os.path.exists(egg):
        </span><span style="color:#0000ff;">raise</span> IOError(<span style="color:#800000;">'</span><span style="color:#800000;">Could not build the egg.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _do_download(version, download_base, to_dir, download_delay):
    egg </span>= os.path.join(to_dir, <span style="color:#800000;">'</span><span style="color:#800000;">distribute-%s-py%d.%d.egg</span><span style="color:#800000;">'</span>
                       % (version, sys.version_info[0], sys.version_info[1<span style="color:#000000;">]))
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> os.path.exists(egg):
        tarball </span>=<span style="color:#000000;"> download_setuptools(version, download_base,
                                      to_dir, download_delay)
        _build_egg(egg, tarball, to_dir)
    sys.path.insert(0, egg)
    </span><span style="color:#0000ff;">import</span><span style="color:#000000;"> setuptools
    setuptools.bootstrap_install_from </span>=<span style="color:#000000;"> egg
 
</span><span style="color:#0000ff;">def</span> use_setuptools(version=DEFAULT_VERSION, download_base=<span style="color:#000000;">DEFAULT_URL,
                   to_dir</span>=os.curdir, download_delay=15, no_fake=<span style="color:#000000;">True):
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> making sure we use the absolute path</span>
    to_dir =<span style="color:#000000;"> os.path.abspath(to_dir)
    was_imported </span>= <span style="color:#800000;">'</span><span style="color:#800000;">pkg_resources</span><span style="color:#800000;">'</span> <span style="color:#0000ff;">in</span> sys.modules <span style="color:#0000ff;">or</span><span style="color:#000000;"> \
        </span><span style="color:#800000;">'</span><span style="color:#800000;">setuptools</span><span style="color:#800000;">'</span> <span style="color:#0000ff;">in</span><span style="color:#000000;"> sys.modules
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">import</span><span style="color:#000000;"> pkg_resources
 
            </span><span style="color:#008000;">#</span><span style="color:#008000;"> Setuptools 0.7b and later is a suitable (and preferable)</span>
            <span style="color:#008000;">#</span><span style="color:#008000;"> substitute for any Distribute version.</span>
            <span style="color:#0000ff;">try</span><span style="color:#000000;">:
                pkg_resources.require(</span><span style="color:#800000;">"</span><span style="color:#800000;">setuptools&gt;=0.7b</span><span style="color:#800000;">"</span><span style="color:#000000;">)
                </span><span style="color:#0000ff;">return</span>
            <span style="color:#0000ff;">except</span><span style="color:#000000;"> (pkg_resources.DistributionNotFound,
                    pkg_resources.VersionConflict):
                </span><span style="color:#0000ff;">pass</span>
 
            <span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> hasattr(pkg_resources, <span style="color:#800000;">'</span><span style="color:#800000;">_distribute</span><span style="color:#800000;">'</span><span style="color:#000000;">):
                </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> no_fake:
                    _fake_setuptools()
                </span><span style="color:#0000ff;">raise</span><span style="color:#000000;"> ImportError
        </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> _do_download(version, download_base, to_dir, download_delay)
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
            pkg_resources.require(</span><span style="color:#800000;">"</span><span style="color:#800000;">distribute&gt;=</span><span style="color:#800000;">"</span> +<span style="color:#000000;"> version)
            </span><span style="color:#0000ff;">return</span>
        <span style="color:#0000ff;">except</span><span style="color:#000000;"> pkg_resources.VersionConflict:
            e </span>= sys.exc_info()[1<span style="color:#000000;">]
            </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> was_imported:
                sys.stderr.write(
                </span><span style="color:#800000;">"</span><span style="color:#800000;">The required version of distribute (&gt;=%s) is not available,\n</span><span style="color:#800000;">"</span>
                <span style="color:#800000;">"</span><span style="color:#800000;">and can't be installed while this script is running. Please\n</span><span style="color:#800000;">"</span>
                <span style="color:#800000;">"</span><span style="color:#800000;">install a more recent version first, using\n</span><span style="color:#800000;">"</span>
                <span style="color:#800000;">"</span><span style="color:#800000;">'easy_install -U distribute'.</span><span style="color:#800000;">"</span>
                <span style="color:#800000;">"</span><span style="color:#800000;">\n\n(Currently using %r)\n</span><span style="color:#800000;">"</span> %<span style="color:#000000;"> (version, e.args[0]))
                sys.exit(</span>2<span style="color:#000000;">)
            </span><span style="color:#0000ff;">else</span><span style="color:#000000;">:
                </span><span style="color:#0000ff;">del</span> pkg_resources, sys.modules[<span style="color:#800000;">'</span><span style="color:#800000;">pkg_resources</span><span style="color:#800000;">'</span>]    <span style="color:#008000;">#</span><span style="color:#008000;"> reload ok</span>
                <span style="color:#0000ff;">return</span><span style="color:#000000;"> _do_download(version, download_base, to_dir,
                                    download_delay)
        </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> pkg_resources.DistributionNotFound:
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> _do_download(version, download_base, to_dir,
                                download_delay)
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> no_fake:
            _create_fake_setuptools_pkg_info(to_dir)
 
</span><span style="color:#0000ff;">def</span> download_setuptools(version=DEFAULT_VERSION, download_base=<span style="color:#000000;">DEFAULT_URL,
                        to_dir</span>=os.curdir, delay=15<span style="color:#000000;">):
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">Download distribute from a specified location and return its filename
 
    `version` should be a valid distribute version number that is available
    as an egg for download under the `download_base` URL (which should end
    with a '/'). `to_dir` is the directory where the egg will be downloaded.
    `delay` is the number of seconds to pause before an actual download
    attempt.
    </span><span style="color:#800000;">"""</span>
    <span style="color:#008000;">#</span><span style="color:#008000;"> making sure we use the absolute path</span>
    to_dir =<span style="color:#000000;"> os.path.abspath(to_dir)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        </span><span style="color:#0000ff;">from</span> urllib.request <span style="color:#0000ff;">import</span><span style="color:#000000;"> urlopen
    </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
        </span><span style="color:#0000ff;">from</span> urllib2 <span style="color:#0000ff;">import</span><span style="color:#000000;"> urlopen
    tgz_name </span>= <span style="color:#800000;">"</span><span style="color:#800000;">distribute-%s.tar.gz</span><span style="color:#800000;">"</span> %<span style="color:#000000;"> version
    url </span>= download_base +<span style="color:#000000;"> tgz_name
    saveto </span>=<span style="color:#000000;"> os.path.join(to_dir, tgz_name)
    src </span>= dst =<span style="color:#000000;"> None
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> os.path.exists(saveto):  <span style="color:#008000;">#</span><span style="color:#008000;"> Avoid repeated downloads</span>
        <span style="color:#0000ff;">try</span><span style="color:#000000;">:
            log.warn(</span><span style="color:#800000;">"</span><span style="color:#800000;">Downloading %s</span><span style="color:#800000;">"</span><span style="color:#000000;">, url)
            src </span>=<span style="color:#000000;"> urlopen(url)
            </span><span style="color:#008000;">#</span><span style="color:#008000;"> Read/write all in one block, so we don't create a corrupt file</span>
            <span style="color:#008000;">#</span><span style="color:#008000;"> if the download is interrupted.</span>
            data =<span style="color:#000000;"> src.read()
            dst </span>= open(saveto, <span style="color:#800000;">"</span><span style="color:#800000;">wb</span><span style="color:#800000;">"</span><span style="color:#000000;">)
            dst.write(data)
        </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> src:
                src.close()
            </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> dst:
                dst.close()
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> os.path.realpath(saveto)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _no_sandbox(function):
    </span><span style="color:#0000ff;">def</span> <span style="color:#800080;">__no_sandbox</span>(*args, **<span style="color:#000000;">kw):
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">from</span> setuptools.sandbox <span style="color:#0000ff;">import</span><span style="color:#000000;"> DirectorySandbox
            </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> hasattr(DirectorySandbox, <span style="color:#800000;">'</span><span style="color:#800000;">_old</span><span style="color:#800000;">'</span><span style="color:#000000;">):
                </span><span style="color:#0000ff;">def</span> violation(*<span style="color:#000000;">args):
                    </span><span style="color:#0000ff;">pass</span><span style="color:#000000;">
                DirectorySandbox._old </span>=<span style="color:#000000;"> DirectorySandbox._violation
                DirectorySandbox._violation </span>=<span style="color:#000000;"> violation
                patched </span>=<span style="color:#000000;"> True
            </span><span style="color:#0000ff;">else</span><span style="color:#000000;">:
                patched </span>=<span style="color:#000000;"> False
        </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
            patched </span>=<span style="color:#000000;"> False
 
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">return</span> function(*args, **<span style="color:#000000;">kw)
        </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
            </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> patched:
                DirectorySandbox._violation </span>=<span style="color:#000000;"> DirectorySandbox._old
                </span><span style="color:#0000ff;">del</span><span style="color:#000000;"> DirectorySandbox._old
 
    </span><span style="color:#0000ff;">return</span> <span style="color:#800080;">__no_sandbox</span>
 
<span style="color:#0000ff;">def</span><span style="color:#000000;"> _patch_file(path, content):
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">Will backup the file then patch it</span><span style="color:#800000;">"""</span><span style="color:#000000;">
    f </span>=<span style="color:#000000;"> open(path)
    existing_content </span>=<span style="color:#000000;"> f.read()
    f.close()
    </span><span style="color:#0000ff;">if</span> existing_content ==<span style="color:#000000;"> content:
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> already patched</span>
        log.warn(<span style="color:#800000;">'</span><span style="color:#800000;">Already patched.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> False
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Patching...</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    _rename_path(path)
    f </span>= open(path, <span style="color:#800000;">'</span><span style="color:#800000;">w</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        f.write(content)
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        f.close()
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> True
 
_patch_file </span>=<span style="color:#000000;"> _no_sandbox(_patch_file)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _same_content(path, content):
    f </span>=<span style="color:#000000;"> open(path)
    existing_content </span>=<span style="color:#000000;"> f.read()
    f.close()
    </span><span style="color:#0000ff;">return</span> existing_content ==<span style="color:#000000;"> content
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _rename_path(path):
    new_name </span>= path + <span style="color:#800000;">'</span><span style="color:#800000;">.OLD.%s</span><span style="color:#800000;">'</span> %<span style="color:#000000;"> time.time()
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Renaming %s to %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, path, new_name)
    os.rename(path, new_name)
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> new_name
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _remove_flat_installation(placeholder):
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> os.path.isdir(placeholder):
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Unkown installation at %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, placeholder)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> False
    found </span>=<span style="color:#000000;"> False
    </span><span style="color:#0000ff;">for</span> file <span style="color:#0000ff;">in</span><span style="color:#000000;"> os.listdir(placeholder):
        </span><span style="color:#0000ff;">if</span> fnmatch.fnmatch(file, <span style="color:#800000;">'</span><span style="color:#800000;">setuptools*.egg-info</span><span style="color:#800000;">'</span><span style="color:#000000;">):
            found </span>=<span style="color:#000000;"> True
            </span><span style="color:#0000ff;">break</span>
    <span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> found:
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Could not locate setuptools*.egg-info</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
 
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Moving elements out of the way...</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    pkg_info </span>=<span style="color:#000000;"> os.path.join(placeholder, file)
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> os.path.isdir(pkg_info):
        patched </span>=<span style="color:#000000;"> _patch_egg_dir(pkg_info)
    </span><span style="color:#0000ff;">else</span><span style="color:#000000;">:
        patched </span>=<span style="color:#000000;"> _patch_file(pkg_info, SETUPTOOLS_PKG_INFO)
 
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> patched:
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">%s already patched.</span><span style="color:#800000;">'</span><span style="color:#000000;">, pkg_info)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> False
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> now let's move the files out of the way</span>
    <span style="color:#0000ff;">for</span> element <span style="color:#0000ff;">in</span> (<span style="color:#800000;">'</span><span style="color:#800000;">setuptools</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">pkg_resources.py</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">site.py</span><span style="color:#800000;">'</span><span style="color:#000000;">):
        element </span>=<span style="color:#000000;"> os.path.join(placeholder, element)
        </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> os.path.exists(element):
            _rename_path(element)
        </span><span style="color:#0000ff;">else</span><span style="color:#000000;">:
            log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Could not find the %s element of the </span><span style="color:#800000;">'</span>
                     <span style="color:#800000;">'</span><span style="color:#800000;">Setuptools distribution</span><span style="color:#800000;">'</span><span style="color:#000000;">, element)
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> True
 
_remove_flat_installation </span>=<span style="color:#000000;"> _no_sandbox(_remove_flat_installation)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _after_install(dist):
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">After install bootstrap.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    placeholder </span>= dist.get_command_obj(<span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span><span style="color:#000000;">).install_purelib
    _create_fake_setuptools_pkg_info(placeholder)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _create_fake_setuptools_pkg_info(placeholder):
    </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> placeholder <span style="color:#0000ff;">or</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> os.path.exists(placeholder):
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Could not find the install location</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
    pyver </span>= <span style="color:#800000;">'</span><span style="color:#800000;">%s.%s</span><span style="color:#800000;">'</span> % (sys.version_info[0], sys.version_info[1<span style="color:#000000;">])
    setuptools_file </span>= <span style="color:#800000;">'</span><span style="color:#800000;">setuptools-%s-py%s.egg-info</span><span style="color:#800000;">'</span> %<span style="color:#000000;"> \
            (SETUPTOOLS_FAKED_VERSION, pyver)
    pkg_info </span>=<span style="color:#000000;"> os.path.join(placeholder, setuptools_file)
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> os.path.exists(pkg_info):
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">%s already exists</span><span style="color:#800000;">'</span><span style="color:#000000;">, pkg_info)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
 
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Creating %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, pkg_info)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        f </span>= open(pkg_info, <span style="color:#800000;">'</span><span style="color:#800000;">w</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> EnvironmentError:
        log.warn(</span><span style="color:#800000;">"</span><span style="color:#800000;">Don't have permissions to write %s, skipping</span><span style="color:#800000;">"</span><span style="color:#000000;">, pkg_info)
        </span><span style="color:#0000ff;">return</span>
    <span style="color:#0000ff;">try</span><span style="color:#000000;">:
        f.write(SETUPTOOLS_PKG_INFO)
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        f.close()
 
    pth_file </span>= os.path.join(placeholder, <span style="color:#800000;">'</span><span style="color:#800000;">setuptools.pth</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Creating %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, pth_file)
    f </span>= open(pth_file, <span style="color:#800000;">'</span><span style="color:#800000;">w</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        f.write(os.path.join(os.curdir, setuptools_file))
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        f.close()
 
_create_fake_setuptools_pkg_info </span>=<span style="color:#000000;"> _no_sandbox(
    _create_fake_setuptools_pkg_info
)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _patch_egg_dir(path):
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> let's check if it's already patched</span>
    pkg_info = os.path.join(path, <span style="color:#800000;">'</span><span style="color:#800000;">EGG-INFO</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">PKG-INFO</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> os.path.exists(pkg_info):
        </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> _same_content(pkg_info, SETUPTOOLS_PKG_INFO):
            log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">%s already patched.</span><span style="color:#800000;">'</span><span style="color:#000000;">, pkg_info)
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> False
    _rename_path(path)
    os.mkdir(path)
    os.mkdir(os.path.join(path, </span><span style="color:#800000;">'</span><span style="color:#800000;">EGG-INFO</span><span style="color:#800000;">'</span><span style="color:#000000;">))
    pkg_info </span>= os.path.join(path, <span style="color:#800000;">'</span><span style="color:#800000;">EGG-INFO</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">PKG-INFO</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    f </span>= open(pkg_info, <span style="color:#800000;">'</span><span style="color:#800000;">w</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        f.write(SETUPTOOLS_PKG_INFO)
    </span><span style="color:#0000ff;">finally</span><span style="color:#000000;">:
        f.close()
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> True
 
_patch_egg_dir </span>=<span style="color:#000000;"> _no_sandbox(_patch_egg_dir)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _before_install():
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Before install bootstrap.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    _fake_setuptools()
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _under_prefix(location):
    </span><span style="color:#0000ff;">if</span> <span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span> <span style="color:#0000ff;">not</span> <span style="color:#0000ff;">in</span><span style="color:#000000;"> sys.argv:
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> True
    args </span>= sys.argv[sys.argv.index(<span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span>) + 1<span style="color:#000000;">:]
    </span><span style="color:#0000ff;">for</span> index, arg <span style="color:#0000ff;">in</span><span style="color:#000000;"> enumerate(args):
        </span><span style="color:#0000ff;">for</span> option <span style="color:#0000ff;">in</span> (<span style="color:#800000;">'</span><span style="color:#800000;">--root</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">--prefix</span><span style="color:#800000;">'</span><span style="color:#000000;">):
            </span><span style="color:#0000ff;">if</span> arg.startswith(<span style="color:#800000;">'</span><span style="color:#800000;">%s=</span><span style="color:#800000;">'</span> %<span style="color:#000000;"> option):
                top_dir </span>= arg.split(<span style="color:#800000;">'</span><span style="color:#800000;">root=</span><span style="color:#800000;">'</span>)[-1<span style="color:#000000;">]
                </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> location.startswith(top_dir)
            </span><span style="color:#0000ff;">elif</span> arg ==<span style="color:#000000;"> option:
                </span><span style="color:#0000ff;">if</span> len(args) &gt;<span style="color:#000000;"> index:
                    top_dir </span>= args[index + 1<span style="color:#000000;">]
                    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> location.startswith(top_dir)
        </span><span style="color:#0000ff;">if</span> arg == <span style="color:#800000;">'</span><span style="color:#800000;">--user</span><span style="color:#800000;">'</span> <span style="color:#0000ff;">and</span> USER_SITE <span style="color:#0000ff;">is</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> None:
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> location.startswith(USER_SITE)
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> True
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _fake_setuptools():
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Scanning installed packages</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        </span><span style="color:#0000ff;">import</span><span style="color:#000000;"> pkg_resources
    </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ImportError:
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> we're cool</span>
        log.warn(<span style="color:#800000;">'</span><span style="color:#800000;">Setuptools or Distribute does not seem to be installed.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
    ws </span>=<span style="color:#000000;"> pkg_resources.working_set
    </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
        setuptools_dist </span>=<span style="color:#000000;"> ws.find(
            pkg_resources.Requirement.parse(</span><span style="color:#800000;">'</span><span style="color:#800000;">setuptools</span><span style="color:#800000;">'</span>, replacement=<span style="color:#000000;">False)
            )
    </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> TypeError:
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> old distribute API</span>
        setuptools_dist =<span style="color:#000000;"> ws.find(
            pkg_resources.Requirement.parse(</span><span style="color:#800000;">'</span><span style="color:#800000;">setuptools</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        )
 
    </span><span style="color:#0000ff;">if</span> setuptools_dist <span style="color:#0000ff;">is</span><span style="color:#000000;"> None:
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">No setuptools distribution found</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span>
    <span style="color:#008000;">#</span><span style="color:#008000;"> detecting if it was already faked</span>
    setuptools_location =<span style="color:#000000;"> setuptools_dist.location
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Setuptools installation detected at %s</span><span style="color:#800000;">'</span><span style="color:#000000;">, setuptools_location)
 
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> if --root or --preix was provided, and if</span>
    <span style="color:#008000;">#</span><span style="color:#008000;"> setuptools is not located in them, we don't patch it</span>
    <span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> _under_prefix(setuptools_location):
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Not patching, --root or --prefix is installing Distribute</span><span style="color:#800000;">'</span>
                 <span style="color:#800000;">'</span><span style="color:#800000;"> in another location</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">return</span>
 
    <span style="color:#008000;">#</span><span style="color:#008000;"> let's see if its an egg</span>
    <span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span> setuptools_location.endswith(<span style="color:#800000;">'</span><span style="color:#800000;">.egg</span><span style="color:#800000;">'</span><span style="color:#000000;">):
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Non-egg installation</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        res </span>=<span style="color:#000000;"> _remove_flat_installation(setuptools_location)
        </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> res:
            </span><span style="color:#0000ff;">return</span>
    <span style="color:#0000ff;">else</span><span style="color:#000000;">:
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Egg installation</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        pkg_info </span>= os.path.join(setuptools_location, <span style="color:#800000;">'</span><span style="color:#800000;">EGG-INFO</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">PKG-INFO</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#0000ff;">if</span> (os.path.exists(pkg_info) <span style="color:#0000ff;">and</span><span style="color:#000000;">
            _same_content(pkg_info, SETUPTOOLS_PKG_INFO)):
            log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Already patched.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
        log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Patching...</span><span style="color:#800000;">'</span><span style="color:#000000;">)
        </span><span style="color:#008000;">#</span><span style="color:#008000;"> let's create a fake egg replacing setuptools one</span>
        res =<span style="color:#000000;"> _patch_egg_dir(setuptools_location)
        </span><span style="color:#0000ff;">if</span> <span style="color:#0000ff;">not</span><span style="color:#000000;"> res:
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;">
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Patching complete.</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    _relaunch()
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _relaunch():
    log.warn(</span><span style="color:#800000;">'</span><span style="color:#800000;">Relaunching...</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> we have to relaunch the process</span>
    <span style="color:#008000;">#</span><span style="color:#008000;"> pip marker to avoid a relaunch bug</span>
    _cmd1 = [<span style="color:#800000;">'</span><span style="color:#800000;">-c</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">--single-version-externally-managed</span><span style="color:#800000;">'</span><span style="color:#000000;">]
    _cmd2 </span>= [<span style="color:#800000;">'</span><span style="color:#800000;">-c</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">install</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">--record</span><span style="color:#800000;">'</span><span style="color:#000000;">]
    </span><span style="color:#0000ff;">if</span> sys.argv[:3] == _cmd1 <span style="color:#0000ff;">or</span> sys.argv[:3] ==<span style="color:#000000;"> _cmd2:
        sys.argv[0] </span>= <span style="color:#800000;">'</span><span style="color:#800000;">setup.py</span><span style="color:#800000;">'</span><span style="color:#000000;">
    args </span>= [sys.executable] +<span style="color:#000000;"> sys.argv
    sys.exit(subprocess.call(args))
 
</span><span style="color:#0000ff;">def</span> _extractall(self, path=<span style="color:#800000;">"</span><span style="color:#800000;">.</span><span style="color:#800000;">"</span>, members=<span style="color:#000000;">None):
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">Extract all members from the archive to the current working
       directory and set owner, modification time and permissions on
       directories afterwards. `path' specifies a different directory
       to extract to. `members' is optional and must be a subset of the
       list returned by getmembers().
    </span><span style="color:#800000;">"""</span>
    <span style="color:#0000ff;">import</span><span style="color:#000000;"> copy
    </span><span style="color:#0000ff;">import</span><span style="color:#000000;"> operator
    </span><span style="color:#0000ff;">from</span> tarfile <span style="color:#0000ff;">import</span><span style="color:#000000;"> ExtractError
    directories </span>=<span style="color:#000000;"> []
 
    </span><span style="color:#0000ff;">if</span> members <span style="color:#0000ff;">is</span><span style="color:#000000;"> None:
        members </span>=<span style="color:#000000;"> self
 
    </span><span style="color:#0000ff;">for</span> tarinfo <span style="color:#0000ff;">in</span><span style="color:#000000;"> members:
        </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> tarinfo.isdir():
            </span><span style="color:#008000;">#</span><span style="color:#008000;"> Extract directories with a safe mode.</span>
<span style="color:#000000;">            directories.append(tarinfo)
            tarinfo </span>=<span style="color:#000000;"> copy.copy(tarinfo)
            tarinfo.mode </span>= 448  <span style="color:#008000;">#</span><span style="color:#008000;"> decimal for oct 0700</span>
<span style="color:#000000;">        self.extract(tarinfo, path)
 
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> Reverse sort directories.</span>
    <span style="color:#0000ff;">if</span> sys.version_info &lt; (2, 4<span style="color:#000000;">):
        </span><span style="color:#0000ff;">def</span><span style="color:#000000;"> sorter(dir1, dir2):
            </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> cmp(dir1.name, dir2.name)
        directories.sort(sorter)
        directories.reverse()
    </span><span style="color:#0000ff;">else</span><span style="color:#000000;">:
        directories.sort(key</span>=operator.attrgetter(<span style="color:#800000;">'</span><span style="color:#800000;">name</span><span style="color:#800000;">'</span>), reverse=<span style="color:#000000;">True)
 
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> Set correct owner, mtime and filemode on directories.</span>
    <span style="color:#0000ff;">for</span> tarinfo <span style="color:#0000ff;">in</span><span style="color:#000000;"> directories:
        dirpath </span>=<span style="color:#000000;"> os.path.join(path, tarinfo.name)
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
            self.chown(tarinfo, dirpath)
            self.utime(tarinfo, dirpath)
            self.chmod(tarinfo, dirpath)
        </span><span style="color:#0000ff;">except</span><span style="color:#000000;"> ExtractError:
            e </span>= sys.exc_info()[1<span style="color:#000000;">]
            </span><span style="color:#0000ff;">if</span> self.errorlevel &gt; 1<span style="color:#000000;">:
                </span><span style="color:#0000ff;">raise</span>
            <span style="color:#0000ff;">else</span><span style="color:#000000;">:
                self._dbg(</span>1, <span style="color:#800000;">"</span><span style="color:#800000;">tarfile: %s</span><span style="color:#800000;">"</span> %<span style="color:#000000;"> e)
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _build_install_args(options):
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">
    Build the arguments to 'python setup.py install' on the distribute package
    </span><span style="color:#800000;">"""</span><span style="color:#000000;">
    install_args </span>=<span style="color:#000000;"> []
    </span><span style="color:#0000ff;">if</span><span style="color:#000000;"> options.user_install:
        </span><span style="color:#0000ff;">if</span> sys.version_info &lt; (2, 6<span style="color:#000000;">):
            log.warn(</span><span style="color:#800000;">"</span><span style="color:#800000;">--user requires Python 2.6 or later</span><span style="color:#800000;">"</span><span style="color:#000000;">)
            </span><span style="color:#0000ff;">raise</span> SystemExit(1<span style="color:#000000;">)
        install_args.append(</span><span style="color:#800000;">'</span><span style="color:#800000;">--user</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> install_args
 
</span><span style="color:#0000ff;">def</span><span style="color:#000000;"> _parse_args():
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">
    Parse the command line for options
    </span><span style="color:#800000;">"""</span><span style="color:#000000;">
    parser </span>=<span style="color:#000000;"> optparse.OptionParser()
    parser.add_option(
        </span><span style="color:#800000;">'</span><span style="color:#800000;">--user</span><span style="color:#800000;">'</span>, dest=<span style="color:#800000;">'</span><span style="color:#800000;">user_install</span><span style="color:#800000;">'</span>, action=<span style="color:#800000;">'</span><span style="color:#800000;">store_true</span><span style="color:#800000;">'</span>, default=<span style="color:#000000;">False,
        help</span>=<span style="color:#800000;">'</span><span style="color:#800000;">install in user site package (requires Python 2.6 or later)</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    parser.add_option(
        </span><span style="color:#800000;">'</span><span style="color:#800000;">--download-base</span><span style="color:#800000;">'</span>, dest=<span style="color:#800000;">'</span><span style="color:#800000;">download_base</span><span style="color:#800000;">'</span>, metavar=<span style="color:#800000;">"</span><span style="color:#800000;">URL</span><span style="color:#800000;">"</span><span style="color:#000000;">,
        default</span>=<span style="color:#000000;">DEFAULT_URL,
        help</span>=<span style="color:#800000;">'</span><span style="color:#800000;">alternative URL from where to download the distribute package</span><span style="color:#800000;">'</span><span style="color:#000000;">)
    options, args </span>=<span style="color:#000000;"> parser.parse_args()
    </span><span style="color:#008000;">#</span><span style="color:#008000;"> positional arguments are ignored</span>
    <span style="color:#0000ff;">return</span><span style="color:#000000;"> options
 
</span><span style="color:#0000ff;">def</span> main(version=<span style="color:#000000;">DEFAULT_VERSION):
    </span><span style="color:#800000;">"""</span><span style="color:#800000;">Install or upgrade setuptools and EasyInstall</span><span style="color:#800000;">"""</span><span style="color:#000000;">
    options </span>=<span style="color:#000000;"> _parse_args()
    tarball </span>= download_setuptools(download_base=<span style="color:#000000;">options.download_base)
    </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> _install(tarball, _build_install_args(options))
 
</span><span style="color:#0000ff;">if</span> <span style="color:#800080;">__name__</span> == <span style="color:#800000;">'</span><span style="color:#800000;">__main__</span><span style="color:#800000;">'</span><span style="color:#000000;">:
    sys.exit(main())</span></pre> 
   </div> 
   <p>&nbsp;</p> 
   <p style="margin-left:30px;">此文在作者原文基础上修改整理而成。</p> 
   <p>&nbsp;</p> 
   <br>
   <p align="center"><a href="https://images.cnblogs.com/cnblogs_com/liu-ke/763267/o_zsm.png" rel="nofollow"><img src="https://yqfile.alicdn.com/img_42a4adae4716d0e15c3eeaabfd040044.png" alt="img_42a4adae4716d0e15c3eeaabfd040044.png"></a> </p> 
   <p align="right"><font color="#FF0000">注：转载需注明出处及作者。</font></p> 
   <p align="right"><a href="http://liu-ke.cnblogs.com/" rel="nofollow"><font color="#FFA500">流柯</font></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
