<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>你可能不知道的陷阱：C#委托和事件的困惑 « NotBeCN</title>
  <meta name="description" content="                  一. 问题引入     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 通常，一个C语言学习者登堂入室的标志就是学会使用了指针，而成为高手的标志又是“玩转指针”。指针是如此奇妙，通过一个地址，可以指向一个数，结构体，对象，甚至函...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/01/09/weixin_33726943_90118063.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">你可能不知道的陷阱：C#委托和事件的困惑</h1>
    <p class="post-meta">Jan 9, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body"> 
    <h1>一. 问题引入</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 通常，一个C语言学习者登堂入室的标志就是学会使用了指针，而成为高手的标志又是“玩转指针”。指针是如此奇妙，通过一个地址，可以指向一个数，结构体，对象，甚至函数。最后的一种函数，我们称之为“函数指针”（和“指针函数”可不一样！）就像如下的代码：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter cpp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="cpp color1 bold">int</code> 
            <code class="cpp plain">func(</code>
            <code class="cpp color1 bold">int</code> 
            <code class="cpp plain">x); </code>
            <code class="cpp comments">/* 声明一个函数 */</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="cpp color1 bold">int</code> 
            <code class="cpp plain">(*f) (</code>
            <code class="cpp color1 bold">int</code> 
            <code class="cpp plain">x); </code>
            <code class="cpp comments">/* 声明一个函数指针 */</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="cpp plain">f=func; </code>
            <code class="cpp comments">/* 将func函数的首地址赋给指针f */</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C语言因为函数指针获得了极强的动态性，因为你可以通过给函数指针赋值并动态改变其行为，我曾在单片机上写的一个小系统中，任务调度机制玩的就是函数指针。</p> 
    <p>　　在.NET时代，函数指针有了更安全更优雅的包装，就是委托。而事件，则是为了<span style="color:#ff0000;">限制委托灵活性</span>引入的新“委托”（之所以为什么限制，后面会谈到）。同样，熟练掌握委托和事件，也是C#登堂入室的标志。有了事件，大大简化了编程，类库变得前所未有的开放，消息传递变得更加简单，任何熟悉事件的人一定都深有体会。</p> 
    <p>　　但你也知道，指针强大，高性能，带来的就是危险，你不知道这个指针是否安全，出了问题，非常难于调试。事件和委托这么好，可是当你写了很多代码，完成大型系统时，心里是不是总觉得怪怪的？有当年使用指针时类似的感觉？</p> 
    <p>　　如果是的话，请看如下的问题：</p> 
    <ol>
     <li><span style="color:#ff0000;">&nbsp;若多次添加同一个事件处理函数时，触发时处理函数是否也会多次触发？</span></li> 
     <li><span style="color:#ff0000;">&nbsp;若添加了一个事件处理函数，却执行了两次或多次”取消事件“，是否会报错？</span></li> 
     <li><span style="color:#ff0000;">&nbsp; 如何认定两个事件处理函数是一样的？ 如果是匿名函数呢？</span></li> 
     <li><span style="color:#ff0000;">&nbsp;如果不手动删除事件函数，系统会帮我们回收吗？</span></li> 
     <li><span style="color:#ff0000;">&nbsp;在多线程环境下，挂接事件时和对象创建所在的线程不同，那事件处理函数中的代码将在哪个线程中执行？</span></li> 
     <li><span style="color:#ff0000;">&nbsp; 当代码的层次复杂时，开放委托和事件是不是会带来更大的麻烦？</span></li> 
    </ol>
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 列下这些问题，下面就让我们讨论这些”尖酸刻薄“的问题。</p> 
    <h1>二. 事件订阅和取消问题</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 我们考虑一个典型的例子：加热器，加热器内部加热，在达到温度后通知外界”加热已经完成“。 尝试写下如下测试类：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter collapsed nogutter csharp"> 
      <div class="toolbar"> 
       <a class="toolbar_item command_expandSource expandSource" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">+ View Code</a>
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a> 
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="csharp color1">/// </code>
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp color1">/// 热水器</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp color1">/// </code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">public</code> 
            <code class="csharp keyword">class</code> 
            <code class="csharp plain">Heater</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">public</code> 
            <code class="csharp keyword">event</code> 
            <code class="csharp plain">EventHandler OnBoiled;</code> 
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">private</code>&nbsp; 
            <code class="csharp keyword">void</code> 
            <code class="csharp plain">RasieBoiledEvent()</code> 
           </div> 
           <div class="line number8 index7 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number9 index8 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">if</code>
            <code class="csharp plain">(OnBoiled==</code>
            <code class="csharp keyword">null</code>
            <code class="csharp plain">)</code> 
           </div> 
           <div class="line number10 index9 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number11 index10 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.WriteLine(</code>
            <code class="csharp string">"加热完成处理订阅事件为空"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number12 index11 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number13 index12 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">else</code> 
           </div> 
           <div class="line number14 index13 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number15 index14 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">OnBoiled(</code>
            <code class="csharp keyword">this</code>
            <code class="csharp plain">, </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">EventArgs());</code> 
           </div> 
           <div class="line number16 index15 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number17 index16 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number18 index17 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">private</code> 
            <code class="csharp plain">Thread heatThread;</code> 
           </div> 
           <div class="line number19 index18 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">public</code> 
            <code class="csharp keyword">void</code> 
            <code class="csharp plain">Begin()</code> 
           </div> 
           <div class="line number20 index19 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number21 index20 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">heatTime = 5;</code> 
           </div> 
           <div class="line number22 index21 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">heatThread = </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">Thread(</code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">ThreadStart(Heat));</code> 
           </div> 
           <div class="line number23 index22 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">heatThread.Start();</code> 
           </div> 
           <div class="line number24 index23 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.WriteLine(</code>
            <code class="csharp string">"加热器已经开启"</code>
            <code class="csharp plain">, heatTime);</code> 
           </div> 
           <div class="line number25 index24 alt2">
            &nbsp;
           </div> 
           <div class="line number26 index25 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number27 index26 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">private</code> 
            <code class="csharp keyword">int</code> 
            <code class="csharp plain">heatTime;</code> 
           </div> 
           <div class="line number28 index27 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">private</code> 
            <code class="csharp keyword">void</code> 
            <code class="csharp plain">Heat()</code> 
           </div> 
           <div class="line number29 index28 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number30 index29 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">while</code> 
            <code class="csharp plain">(</code>
            <code class="csharp keyword">true</code>
            <code class="csharp plain">)</code> 
           </div> 
           <div class="line number31 index30 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number32 index31 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.WriteLine(</code>
            <code class="csharp string">"加热还需{0}秒"</code>
            <code class="csharp plain">, heatTime);</code> 
           </div> 
           <div class="line number33 index32 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;
           </div> 
           <div class="line number34 index33 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">if</code> 
            <code class="csharp plain">(heatTime == 0)</code> 
           </div> 
           <div class="line number35 index34 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number36 index35 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">RasieBoiledEvent();</code> 
           </div> 
           <div class="line number37 index36 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">return</code>
            <code class="csharp plain">;</code> 
           </div> 
           <div class="line number38 index37 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number39 index38 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">heatTime--;</code> 
           </div> 
           <div class="line number40 index39 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Thread.Sleep(1000);</code> 
           </div> 
           <div class="line number41 index40 alt2">
            &nbsp;
           </div> 
           <div class="line number42 index41 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number43 index42 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number44 index43 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;&nbsp; OK,简单了，下面是main函数：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp keyword">class</code> 
            <code class="csharp plain">Program</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">static</code> 
            <code class="csharp keyword">void</code> 
            <code class="csharp plain">Main(</code>
            <code class="csharp keyword">string</code>
            <code class="csharp plain">[] args)</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">var</code> 
            <code class="csharp plain">test = </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">Heater();</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.OnBoiled += TestOnBoiled;</code> 
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.OnBoiled += TestOnBoiled;</code> 
           </div> 
           <div class="line number8 index7 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.Begin();</code> 
           </div> 
           <div class="line number9 index8 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.ReadKey();</code> 
           </div> 
           <div class="line number10 index9 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number11 index10 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">static</code> 
            <code class="csharp keyword">void</code> 
            <code class="csharp plain">TestOnBoiled(</code>
            <code class="csharp keyword">object</code> 
            <code class="csharp plain">sender, EventArgs e)</code> 
           </div> 
           <div class="line number12 index11 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number13 index12 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.WriteLine(</code>
            <code class="csharp string">"Hello事件被调用"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number14 index13 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
           <div class="line number15 index14 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>&nbsp;&nbsp;&nbsp; 我们有意将事件挂载了两次，看看执行效果:</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233654-dee1b9d7585e4f28adca1f8cea91ea04.jpg"></p> 
    <p>&nbsp;&nbsp; &nbsp; 很明显，<span style="color:#ff0000;"><strong>如果多次挂载同一事件处理函数，函数将会执行多次。</strong></span></p> 
    <p>&nbsp;&nbsp;&nbsp; 这就是<strong>第一个问题的答案</strong>。</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="csharp plain">接下来，我们将上文中main函数中红色代码替换成如下蛋疼的代码：</code>
           </div> 
           <div class="line number2 index1 alt1">
            <code class="csharp plain">test.OnBoiled += TestOnBoiled;</code>
           </div> 
           <div class="line number3 index2 alt2">
            <code class="csharp plain">test.OnBoiled -= TestOnBoiled;</code>
           </div> 
           <div class="line number4 index3 alt1">
            <code class="csharp plain">test.OnBoiled -= TestOnBoiled;</code>
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>&nbsp;&nbsp; 在实际开发中，这种情况是很普遍的，谁都有可能取消订阅多次，结果如何呢？</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233729-a3c696ddf6ca4a12a372081527a604e0.jpg"></p> 
    <p>&nbsp;&nbsp; 在执行过程中，删除两次事件没有报错，但当触发事件时，由于事件订阅列表为空，所以，第二个问题的答案：<br><span style="color:#ff0000;"><strong>&nbsp;&nbsp; 多次删除同一事件是不会报错的，即使事件只被订阅了一次。若出现订阅三次，取消订阅两次时，依旧执行一次。</strong></span></p> 
    <p>&nbsp;&nbsp; 这个事情是好理解的，事件列表，实际上就是List，最简单的增删问题。<br></p> 
    <h1>三. 有了匿名函数后？</h1> 
    <p><span style="color:#ff0000;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong></span>自从学习匿名函数后，笔者就特别喜欢用它，除非代码量特别长，否则十行之内的事件订阅，我都会用匿名函数。可是事情变得有意思了，写了匿名函数后，几乎没人记得取消订阅，那么，发生了什么事情呢？</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 和上次一样，我们将前面红色代码改成下面的样子:</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp plain">test.OnBoiled += (s, e) =&gt; Console.WriteLine(</code>
            <code class="csharp string">"加热完成事件被调用"</code>
            <code class="csharp plain">);&lt;br&gt;test.OnBoiled -= (s, e) =&gt; Console.WriteLine(</code>
            <code class="csharp string">"加热完成事件被调用"</code>
            <code class="csharp plain">);&lt;br&gt;test.Bein();</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>Resharper直接给我画了灰线，如下图：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233809-f355d7c0528444e6885ef2a3d9251a89.jpg"></p> 
    <p>我估计情况不太乐观，执行之后：</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;<img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233844-a1c3312d62674857bb6643329a27c36e.jpg"></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;果然！加热完成事件还是被调用了，也就是说，<span style="color:#ff0000;"><strong>看着形式完全一致的两个匿名函数，编译器生成的方法签名是不一致的，根本就是两个不同的函数。因此，匿名函数完全没法取消订阅！ 这是第三个问题的答案。</strong></span></p> 
    <p><span style="color:#ff0000;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></span>事件不能被取消订阅！这下可惨了，我真的要取消怎么办？没办法，只能乖乖的写完整的事件函数。匿名方法虽好，千万别用过头。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;但是，真正麻烦的问题来了，一个复杂的动态系统中，一定随时会有大量的对象生成和销毁，你也一定会给它订阅一些事件，当你用匿名函数后，这些函数是不是就像死神一样，一直掐着你的脖子？ 如果事件处理函数涉及重要操作，比如给对方付款，执行多次你是不是就要哭死了？</p> 
    <h1>&nbsp; 四. 垃圾回收和事件</h1> 
    <p>　　垃圾回收机制搀和进来后，故事变的更有意思了。</p> 
    <p>　　&nbsp;我“殷切”的希望，垃圾回收器会帮我解决第三节最后一段谈到的问题，帮我收拾掉那些函数，那真实的情况呢？我们做个试验：</p> 
    <p>　　同样的，替换掉红色部分：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp plain">test.OnBoiled += (s, e) =&gt; Console.WriteLine(</code>
            <code class="csharp string">"加热完成事件被调用"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp plain">test=</code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">Heater();</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp plain">GC.Collect();&nbsp; </code>
            <code class="csharp comments">//强制垃圾回收实际上可有可无</code> 
           </div> 
           <div class="line number4 index3 alt1">
            <code class="csharp plain">test.Bein();</code>
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>　　下面是执行结果：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233920-af7d93c81d0a416f9ee91d0573338518.jpg"></p> 
    <p>　　哈，起码在我更新了对象引用<span style="color:#ff0000;"><strong>，new了新对象之后，原来的匿名事件确实没有了</strong></span>。看来编译器还是够意思的。</p> 
    <p>　　可是，多数实际开发情况中，我们很少直接new一个对象覆盖掉原来的引用。而是重新new了一个对象出来。这种情况的代码如下</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp plain">test.OnBoiled += (s, e) =&gt; Console.WriteLine(</code>
            <code class="csharp string">"加热完成事件被调用"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">var</code> 
            <code class="csharp plain">heaters = </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">List() { test, test };</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">heaters.Clear();</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.Begin();</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test = </code>
            <code class="csharp keyword">null</code>
            <code class="csharp plain">;</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">GC.Collect(); </code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp spaces">&nbsp;</code>&nbsp;
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>　　执行结果如下图：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15233951-93de84cb6d714927891056750fcb790f.jpg"></p> 
    <p>　　这种情况下，<strong><span style="color:#ff0000;">test即使被赋值为null，事件还是会乖乖执行，因为是匿名函数，你也没法取消订阅，而GC强制收集也没用！</span></strong> 这就是我们真实场景中最可怕的事情，你认为它已经消失了，可是它还挂在事件上！</p> 
    <p>　　其实这里有个破绽：Heater类里开了线程，我即使赋值为null，线程肯定还没有被销毁，事件确实可能会执行，时间所限，我没有尝试在写一个类测试不开线程的情况，有兴趣的读者可以帮忙试一试。</p> 
    <p>　　而且，经过我查阅资料，<span style="color:#ff0000;"><strong>当你的对象订阅了外部的事件，而又没有取消订阅，那么该对象是不会被GC回收的！这会造成很恐怖的问题，产生了几千万个对象没法被回收。可是，匿名函数让我怎么么取消订阅？！ </strong></span></p> 
    <p>　　所以我们得到了结论，<span style="color:#ff0000;"><strong>除非确实是一般场景，比如界面开发的window，生成了一直存在，或者在应用程序关闭时回收，否则少用匿名函数吧！记得取消事件订阅！否则会是非常麻烦的事情！</strong></span></p> 
    <p>&nbsp;</p> 
    <h1>五.高潮： 多线程和事件</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;多线程本来就是程序员头疼的问题，笔者在多线程知识上只是入门，没开发过高并发系统，倒是经常用并行库加速算法执行。 让我们看看多线程和事件两个最难搞的东西纠缠在一起时是个什么样子。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一种常见的场景，是事件处理很耗时，比如执行长时间的IO操作，或者进行了复杂的数学计算，我们不想影响主线程，那么你想当然的会通过多线程的方法解决。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 创建对象的线程，一般是主线程（或者UI线程），<span style="color:#ff0000;"><strong>那么，怎么让事件处理函数在另外一个线程执行呢？ 你真的保证处理函数在另外一个线程中执行了？</strong></span>异步调用？好办法，不过我们此处不说这个。</p> 
    <p>&nbsp;</p> 
    <p>//////////////////**************///////////////////////////</p> 
    <p><span style="color:#ff0000;">修正：经过了重新的测试，发现我的测试用例写的有问题，为了让Heater类自己触发事件，我在内部写了一个新线程，导致测试不准确。</span></p> 
    <p><span style="color:#ff0000;">结论应该是： 不论是不是在多线程环境下，<strong>事件处理函数一定在触发事件位置所在的线程中，和事件订阅者的创建线程，订阅事件时所在的线程无关</strong>。。。。。<strong>。我第五节的内容，有多半都是错的。</strong>。。。</span></p> 
    <p><span style="color:#ff0000;">因此，若是触发事件所在线程是主线程的话，基本上只能用我提出的第二种做法，通过事件内部使用线程池来执行了。感谢&nbsp;<a id="a_comment_author_2636597" href="http://www.cnblogs.com/WestContinent/" rel="nofollow"><span style="color:#ff0000;">West Continent</span></a>&nbsp;的讨论。</span></p> 
    <p>/////////////////*************/////////////////////</p> 
    <p><strong>&nbsp;1. 新建线程方法：</strong></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;初学者会这么做：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="csharp plain">test.OnBoiled += (s, e) =&gt;</code>
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">var</code> 
            <code class="csharp plain">newThread = </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">Thread(</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">ThreadStart(</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">() =&gt;</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Thread.Sleep(2000); </code>
            <code class="csharp comments">//模拟长时间操作</code> 
           </div> 
           <div class="line number8 index7 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">Console.WriteLine(</code>
            <code class="csharp string">"总算把热好的水加到了暖瓶里"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number9 index8 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">}));</code> 
           </div> 
           <div class="line number10 index9 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">newThread.Start();</code> 
           </div> 
           <div class="line number11 index10 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> 
           </div> 
           <div class="line number12 index11 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.Begin();</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-size:12px;">　　我的手指还是选择了匿名函数，用起来真爽，<strong>这种情况下，显然事件处理函数所在线程和主线程不一样</strong>。</span></p> 
    <p><span style="font-size:12px;">　　可是，稍微有点基础的人就知道，当事件被频繁触发时，线程就会被频繁生成，线程同样是非常昂贵的系统资源，更何况，线程的启动时间是不确定的，可能会耽误大事。这不是个好方案。</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:12px;">&nbsp;&nbsp;</span></p> 
    <p><strong>2. 线程池</strong></p> 
    <p>&nbsp;</p> 
    <p>　　采用.NET 4.0的线程池试试看，代码如下：</p> 
    <p>&nbsp;</p> 
    <div class="cnblogs_Highlighter"> 
     <div> 
      <div class="syntaxhighlighter nogutter csharp"> 
       <div class="toolbar">
        <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
       </div> 
       <table border="0">
        <tbody>
         <tr>
          <td class="code"> 
           <div> 
            <div class="line number1 index0 alt2"> 
             <code class="csharp keyword">var</code> 
             <code class="csharp plain">mainThread = Thread.CurrentThread;</code> 
            </div> 
            <div class="line number2 index1 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">test.OnBoiled += (s, e) =&gt;</code> 
            </div> 
            <div class="line number3 index2 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number4 index3 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">ThreadPool.QueueUserWorkItem((d) =&gt;</code> 
            </div> 
            <div class="line number5 index4 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number6 index5 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Thread.Sleep(2000); </code>
             <code class="csharp comments">//模拟长时间操作</code> 
            </div> 
            <div class="line number7 index6 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"总算把热好的水加到了暖瓶里"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number8 index7 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">if</code> 
             <code class="csharp plain">(Thread.CurrentThread != mainThread)</code> 
            </div> 
            <div class="line number9 index8 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number10 index9 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"两者执行的是不同的线程"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number11 index10 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">}</code> 
            </div> 
            <div class="line number12 index11 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">else</code> 
            </div> 
            <div class="line number13 index12 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number14 index13 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"两者执行的是相同的线程"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number15 index14 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">}</code> 
            </div> 
            <div class="line number16 index15 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">});</code> 
            </div> 
            <div class="line number17 index16 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">};</code> 
            </div> 
            <div class="line number18 index17 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">test.Begin();</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <div> 
      <div class="syntaxhighlighter nogutter csharp"> 
       <div class="toolbar">
        <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
       </div> 
       <table border="0">
        <tbody>
         <tr>
          <td class="code"> 
           <div> 
            <div class="line number1 index0 alt2"> 
             <code class="csharp spaces">&nbsp;</code>&nbsp;
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>　　我们通过缓存主线程，并比较处理函数中的线程，得到结果如下：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15234027-3c084bb34e464352b1737681c550c913.jpg"></p> 
    <p>&nbsp;</p> 
    <p>　　确实，<span style="color:#ff0000;"><strong>采用线程池时，会是两个是不一样的线程，线程池由于内部做了管理，因此可以有效的利用线程，避免疯狂新开线程造成的严重的性能问题。</strong></span></p> 
    <p>　　可是，我觉得还是麻烦，尤其是有多种事件时，挨个写线程池还是太麻烦了。那么，我们是不是有两种方案？</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一种是将构造函数写在一个新线程中，另外一种是将事件订阅函数写在新线程中，两者会发生怎样的情况呢？</p> 
    <p>&nbsp;</p> 
    <p><strong>3. 对象的构造函数处在新线程时：</strong></p> 
    <p>　　如下测试代码：</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="syntaxhighlighter nogutter csharp"> 
      <div class="toolbar">
       <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
      </div> 
      <table border="0">
       <tbody>
        <tr>
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="csharp keyword">var</code> 
            <code class="csharp plain">mainThread = Thread.CurrentThread;</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp keyword">var</code> 
            <code class="csharp plain">autoResetEvent = </code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">AutoResetEvent(</code>
            <code class="csharp keyword">false</code>
            <code class="csharp plain">);&nbsp; </code>
            <code class="csharp comments">//通过信号机制保证对象首先被创建</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">ThreadPool.QueueUserWorkItem((d) =&gt;</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">{</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test=</code>
            <code class="csharp keyword">new</code> 
            <code class="csharp plain">Heater();</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">autoResetEvent.Set();</code> 
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">});</code> 
           </div> 
           <div class="line number8 index7 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">autoResetEvent.WaitOne();</code> 
           </div> 
           <div class="line number9 index8 alt2"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.OnBoiled += (s, e) =&gt; Console.WriteLine(Thread.CurrentThread != mainThread ? </code>
            <code class="csharp string">"两者执行的是不同的线程"</code> 
            <code class="csharp plain">: </code>
            <code class="csharp string">"两者执行的是相同的线程"</code>
            <code class="csharp plain">);</code> 
           </div> 
           <div class="line number10 index9 alt1"> 
            <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="csharp plain">test.Begin();</code> 
           </div> 
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>　　代码值得一提的是，为了保证对象被首先创建，采用了信号机制实现线程同步，当创建后，主线程才会往下执行，否则会抛出空引用的异常.</p> 
    <p>　　结果如下：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15234140-05a00ff85a594a9f8326f50d502f9e1a.jpg"></p> 
    <p>　　可见： <span style="color:#ff0000;"><strong>主线程称为Main, 若对象构造函数在B线程执行，事件不在主线程中执行。那是不是在B线程中执行呢？暂时还不知道。</strong></span></p> 
    <p><strong>4. 对象的事件订阅函数处在新线程时：</strong></p> 
    <p>　　在另外一个线程里创建对象是更麻烦的，你要解决线程同步问题，恶心不，哈哈。</p> 
    <p>　　那么，若订阅事件的代码在线程B时，情况是怎样的呢？</p> 
    <div class="cnblogs_Highlighter"> 
     <div class="cnblogs_Highlighter"> 
      <div class="syntaxhighlighter nogutter csharp"> 
       <div class="toolbar">
        <a class="toolbar_item command_help help" href="http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html#" rel="nofollow">?</a>
       </div> 
       <table border="0">
        <tbody>
         <tr>
          <td class="code"> 
           <div> 
            <div class="line number1 index0 alt2"> 
             <code class="csharp keyword">var</code> 
             <code class="csharp plain">mainThread = Thread.CurrentThread; </code> 
            </div> 
            <div class="line number2 index1 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">ThreadPool.QueueUserWorkItem((d) =&gt;</code> 
            </div> 
            <div class="line number3 index2 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number4 index3 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">var</code> 
             <code class="csharp plain">bThread = Thread.CurrentThread;</code> 
            </div> 
            <div class="line number5 index4 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">test.OnBoiled += (s, e) =&gt;</code> 
            </div> 
            <div class="line number6 index5 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number7 index6 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">if</code>
             <code class="csharp plain">(Thread.CurrentThread == mainThread )</code> 
            </div> 
            <div class="line number8 index7 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"事件在主线程中执行"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number9 index8 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">else</code> 
             <code class="csharp keyword">if</code> 
             <code class="csharp plain">(bThread==Thread.CurrentThread)</code> 
            </div> 
            <div class="line number10 index9 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number11 index10 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"事件在订阅事件的线程B中执行"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number12 index11 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">}</code> 
            </div> 
            <div class="line number13 index12 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp keyword">else</code> 
            </div> 
            <div class="line number14 index13 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">{</code> 
            </div> 
            <div class="line number15 index14 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">Console.WriteLine(</code>
             <code class="csharp string">"事件在第三个线程中执行"</code>
             <code class="csharp plain">);</code> 
            </div> 
            <div class="line number16 index15 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">}</code> 
            </div> 
            <div class="line number17 index16 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">};</code> 
            </div> 
            <div class="line number18 index17 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">});</code> 
            </div> 
            <div class="line number19 index18 alt2"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;
            </div> 
            <div class="line number20 index19 alt1"> 
             <code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
             <code class="csharp plain">test.Begin();</code> 
            </div> 
           </div> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p>　　结论：</p> 
    <p><img alt="" src="https://images0.cnblogs.com/blog/287060/201303/15234208-893ad6428a664205be2711900b0e2bd1.jpg"></p> 
    <p>　　说实话，我看到这个场景的时候大吃一惊，居然<strong><span style="color:#ff0000;">执行事件的代码不在主线程，不在订阅事件的线程，而在另外一个第三者线程！这可能就是线程池的无敌之处吧，它连事件订阅函数都给托管了！真是碉堡了！！</span></strong></p> 
    <p>　　不过，管它是什么线程里执行，反正我主线程是不会被堵塞了，哈哈.</p> 
    <h1>六.结语</h1> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 本来想今天把最后一个问题都解决的，可是时间实在太晚，而且文章已经够长了。<strong><span style="color:#ff0000;">不妨最后一个问题，“在复杂软件环境下，如何理性正确的使用委托和事件”放在第二部分吧</span></strong>。有些问题我也没搞清，在做实验的情况下，才逐渐接近结论。 写完这篇文章，我深有收获。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 其实，按照惯例，应该把IL代码好好搞出来给大家看才算是“专业”的选择，不过我确实不懂IL，就不拿出来丢人了，高手们请自行脑补。</p> 
    <p>&nbsp;&nbsp;&nbsp; &nbsp; 本文介绍了C#的委托和事件的订阅和取消订阅，并在匿名函数和多线程两个环境下讨论了一些问题。<span style="color:#ff0000;"><strong>如果你觉得这篇文章对你有帮助，请点一下推荐</strong></span>，若有任何问题，欢迎留言讨论，共同学习。</p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp; 测试代码见<a href="http://files.cnblogs.com/buptzym/EventTest.rar" rel="nofollow">附件</a>，请将不同Region的代码解开注释进行测试。</p> 
    <p><br><br></p> 
   </div> 
   <div> 
    <div> 
     <p style="border-top:#e0e0e0 1px dashed;border-right:#e0e0e0 1px dashed;border-bottom:#e0e0e0 1px dashed;border-left:#e0e0e0 1px dashed;background:#e5f1f4 url(&quot;https://images.cnblogs.com/cnblogs_com/lloydsheng/239039/o_copyright.gif&quot;) no-repeat 1% 50%;font-family:'微软雅黑';font-size:11px;"><br> 作者：<a href="http://www.cnblogs.com/buptzym/" rel="nofollow">热情的沙漠</a> <br> 出处：<a href="http://www.cnblogs.com/buptzym/" rel="nofollow">http://www.cnblogs.com/buptzym/</a> <br> 本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。 <br></p> 
    </div> 
   </div> 
   <div class="clear"></div> 
   <div> 
    <div>
     分类: 
     <a href="http://www.cnblogs.com/buptzym/category/809618.html" rel="nofollow">算法</a> 
    </div> 
    <div>
     标签: 
     <a href="http://www.cnblogs.com/buptzym/tag/.NET/" rel="nofollow">.NET</a>, 
     <a href="http://www.cnblogs.com/buptzym/tag/%E7%BB%8F%E9%AA%8C/" rel="nofollow">经验</a> 
    </div> 
    <div>
     <br>
    </div> 
    <div>
     本文转自FerventDesert博客园博客，原文链接：http://www.cnblogs.com/buptzym/archive/2013/03/15/2962300.html，如需转载请自行联系原作者
     <br>
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
