<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>userName is not in the sudoers file. This incident will be reported. « NotBeCN</title>
  <meta name="description" content="             Linux ：sudo&nbsp; su - 切换到root权限下    问题现象：    Last login: Tue Mar 23 15:55:57 2010 from 10.130.38.5 /home/channel/&gt;sudo&nbsp; su -    We trus...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/05/17/weixin_34315189_90118230.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">userName is not in the sudoers file. This incident will be reported.</h1>
    <p class="post-meta">May 17, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Linux ：sudo&nbsp; su - 切换到root权限下</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">问题现象：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Last login: Tue Mar 23 15:55:57 2010 from 10.130.38.5<br> /home/channel/&gt;sudo&nbsp; su -</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">We trust you have received the usual lecture from the local System<br> Administrator. It usually boils down to these two things:</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;#1) Respect the privacy of others.<br> &nbsp;#2) Think before you type.</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Password:<br> Sorry, try again.<br> Password:<br> channel is not in the sudoers file.&nbsp; This incident will be reported.</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">解决方法：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">到root下</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">/home/channel/&gt;su -<br> Password:&nbsp;<br> [root@usboss ~]# cd /etc/<br> [root@usboss etc]# ls -l sud*<br> -r--r-----&nbsp; 1 root root 580 2005-07-21&nbsp; sudoers<br> [root@usboss etc]# chmod u+w sudoers&nbsp;<br> [root@usboss etc]# ls -l sud*<br> -rw-r-----&nbsp; 1 root root 580 2005-07-21&nbsp; sudoers<br> [root@usboss etc]# vi sudoers</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">编辑sudoers</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">在root ALL=(ALL) ALLZ下<br> 添加xxx ALL=(ALL) ALL<br> 保保存 退出</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">[root@usboss etc]# chmod u-w sudoers&nbsp;<br> [root@usboss etc]# ls -l sud*<br> -r--r-----&nbsp; 1 root root 602&nbsp; 3?.30 16:23 sudoers</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">最后结果：</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">channel is not in the sudoers file.&nbsp; This incident will be reported.<br> /home/channel/&gt;sudo&nbsp; su -<br> Password:<br> [root@usboss ~]#</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">visudo 不需要密码</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果觉得在sudo的时候输入密码麻烦，把刚才的输入换成如下内容即可：<br> your_user_name<span class="Apple-converted-space">&nbsp;ALL=(ALL)<span class="Apple-converted-space">&nbsp;NOPASSWD:<span class="Apple-converted-space">&nbsp;ALL</span></span></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">至于安全问题，对于一般个人用户，我觉得这样也可以的。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">如果你想设置只有某些命令可以sudo的话，your_user_name&nbsp;&nbsp;&nbsp;ALL= (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /sbin/mount, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/umount, (root)NOPASSWD: /mnt/mount, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/rm, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /usr/bin/make, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/ln, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/sh, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/mv, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/chown, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/chgrp, (root)<span class="Apple-converted-space">&nbsp;NOPASSWD: /bin/cp, (root)NOPASSWD: /bin/chmod</span></span></span></span></span></span></span></span></span></span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">注意： 有的时候你的将用户设了nopasswd，但是不起作用，原因是被后面的group的设置覆盖了，需要把group的设置也改为nopasswd。</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">joe&nbsp;ALL=(ALL)<span class="Apple-converted-space">&nbsp;NOPASSWD:<span class="Apple-converted-space">&nbsp;ALL</span></span></p> 
   <div style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    %admin ALL=(ALL) NOPASSWD: ALL
   </div> 
   <div style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <div style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    &nbsp;
   </div> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;参考&nbsp;<a href="http://www.cnblogs.com/itech/archive/2009/08/07/1541017.html" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://www.cnblogs.com/itech/archive/2009/08/07/1541017.html</a></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">---------------------</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">原地址：<a href="http://www.gz-benet.com.cn/bbs/Show.Asp?ID=4268" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;">http://www.gz-benet.com.cn/bbs/Show.Asp?ID=4268</a>&nbsp;<br> &nbsp;<br> &nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br> &nbsp;<br> “Sudo” 是Unix/Linux平台上的一个非常有用的工具，它允许系统管理员分配给普通用户一些合理的“权利”，让他们执行一些只有超级用户或其他特许用户才能完成的任务，比如：运行一些像mount，halt，su之类的命令，或者编辑一些系统配置文件，像/etc/mtab， /etc/samba/smb.conf等。这样以来，就不仅减少了root用户的登陆次数和管理时间，也提高了系统安全性。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> &nbsp;<br> &nbsp;<br> 一. sudo的特点&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo扮演的角色注定了它要在安全方面格外谨慎，否则就会导致非法用户攫取root权限。同时，它还要兼顾易用性，让系统管理员能够更有效，更方便地使用它。sudo设计者的宗旨是：给用户尽可能少的权限但仍允许完成他们的工作。所以，sudo有以下特点：&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> # 1. sudo能够限制指定用户在指定主机上运行某些命令。&nbsp;&nbsp;<br> # 2. sudo可以提供日志，忠实地记录每个用户使用sudo做了些什么，并且能将日志传到中心主机或者日志服务器。&nbsp;&nbsp;<br> # 3. sudo为系统管理员提供配置文件，允许系统管理员集中地管理用户的使用权限和使用的主机。它默认的存放位置是/etc/sudoers。&nbsp;&nbsp;<br> # 4.sudo使用时间戳文件来完成类似“检票”的系统。当用户执行sudo并且输入密码后，用户获得了一张默认存活期为5分钟的“入场券”（默认值可以在编译的时候改变）。超时以后，用户必须重新输入密码。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 二. sudo命令&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo程序本身就是一个设置了SUID位的二进制文件。我们可以检查一下它的权限：&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> $ls -l /usr/bin/sudo&nbsp;&nbsp;<br> ---s--x--x 2 root root 106832 02-12 17:41 /usr/bin/sudo&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 它的所有者是root，所以每个用户都可以像root那样执行该程序。设置了SUID的程序在运行时可以给使用者以所有者的EUID。这也是为什么设置了SUID的程序必须小心编写。但是设置一个命令文件的SUID 和用sudo来运行它是不同的概念，它们起着不同的作用。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo的配置都记录在/etc/sudoers文件中，我们下面将会详细说明。配置文件指明哪些用户可以执行哪些命令。要使用sudo，用户必须提供一个指定用户名和密码。注意：sudo需要的不是目标用户的密码，而是执行sudo的用户的密码。如果不在sudoers中的用户通过sudo执行命令，sudo会向管理员报告这一事件。用户可以通过sudo -v来查看自己是否是在sudoers 之中。如果是，它还可以更新你的“入场券”上的时间；如果不是，它会提示你，但不会通知管理员。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo命令格式如下：&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo -K | -L | -V | -h | -k | -l | -vsudo [-HPSb] [-a auth_type] [-c&nbsp;&nbsp;<br> class|-] [-p prompt] [-u username|#uid] {-e file [...] | -i | -s | command}&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 下面我们再来看一下sudo其它常用的一些参数：&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 选项 含义 作用&nbsp;&nbsp;<br> sudo -h Help 列出使用方法，退出。&nbsp;&nbsp;<br> sudo -V Version 显示版本信息，并退出。&nbsp;&nbsp;<br> sudo -l List 列出当前用户可以执行的命令。只有在sudoers里的用户才能使用该选项。&nbsp;&nbsp;<br> sudo -u username|#uid User 以指定用户的身份执行命令。后面的用户是除root以外的，可以是用户名，也可以是#uid。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo -k Kill 清除“入场卷”上的时间，下次再使用sudo时要再输入密码。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo -K Sure kill 与-k类似，但是它还要撕毁“入场卷”，也就是删除时间戳文件。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> sudo -b command Background 在后台执行指定的命令。&nbsp;&nbsp;<br> sudo -p prompt command Prompt 可以更改询问密码的提示语，其中%u会代换为使用者帐号名称，%h会显示主机名称。非常人性化的设计。&nbsp;&nbsp;<br> sudo -e file Edit 不是执行命令，而是修改文件，相当于命令sudoedit。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 还有一些不常用的参数，在手册页sudo(8)中可以找到。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 三. 配置sudo&nbsp;<br> &nbsp;<br> &nbsp;<br> 配置sudo必须通过编辑/etc/sudoers文件，而且只有超级用户才可以修改它，还必须使用visudo编辑。之所以使用visudo有两个原因，一是它能够防止&nbsp;&nbsp;<br> 两个用户同时修改它；二是它也能进行有限的语法检查。所以，即使只有你一个超级用户，你也最好用visudo来检查一下语法。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> visudo默认的是在vi里打开配置文件，用vi来修改文件。我们可以在编译时修改这个默认项。visudo不会擅自保存带有语法错误的配置文件，它会提示你出现的问题，并询问该如何处理，就像：&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> &gt;&gt;&gt; sudoers file: syntax error, line 22 &lt;&lt;&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 此时我们有三种选择：键入“e”是重新编辑，键入“x”是不保存退出，键入“Q”是退出并保存。如果真选择Q，那么sudo将不会再运行，直到错误被纠正。&nbsp;&nbsp;<br> &nbsp;<br> &nbsp;<br> 现在，我们一起来看一下神秘的配置文件，学一下如何编写它。让我们从一个简单的例子开始：让用户foobar可以通过sudo执行所有root可执行的命令。以root身份用visudo打开配置文件，可以看到类似下面几行：&nbsp;&nbsp;<br> &nbsp;<br> 。。。。。。&nbsp;</p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font><span style="font-size:14px;">本文转自茄子_2008博客园博客，原文链接：http://www.cnblogs.com/xd502djj/archive/2010/03/30/1700772.html</span></font><span style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者。</span></p> 
   <div>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
