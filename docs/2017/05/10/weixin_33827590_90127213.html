<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Export DWG with ObjectData to ESRI shape file using AutoCAD Map 3D API « NotBeCN</title>
  <meta name="description" content="                      Many customers want to export their DWG file to ESRI shape file, Map 3D, as a bridge between engineering and GIS, allowing you do the e...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/05/10/weixin_33827590_90127213.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Export DWG with ObjectData to ESRI shape file using AutoCAD Map 3D API</h1>
    <p class="post-meta">May 10, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h1 style="font-size:14.7px;color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;"><br></h1> 
   <div class="blogpost-body" style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;"> 
    <p style="line-height:1.5;">Many customers want to export their DWG file to ESRI shape file, Map 3D, as a bridge between engineering and GIS, allowing you do the export or import manually by UI, or programmatically by API.</p> 
    <p style="line-height:1.5;">To make it easier, let’s start from UI. For example, we have a county map in DWG file format, there are some attribute data stored in DWG file as Object Data. What we want to do it export the drawing, as well as the attribute data, such as Area, Name, State, etc.</p> 
    <p style="line-height:1.5;"><a href="http://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_6.png" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><img title="image" alt="image" src="https://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_thumb_2.png" width="835" height="601" style="border:0px;"></a></p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">Select “Output” tab in ribbon, and click “Map 3D Export” button (or type MAPEXPORT in command line), select a directory and file format, *.shp in this case, an export dialogue will show up. As only single geometry type is allowed in one shp file, we must specify the geometry type before you begin the exporting. it’s important, we will talk it later when we doing this by API.</p> 
    <p style="line-height:1.5;"><a href="http://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_2.png" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><img title="image" alt="image" src="https://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_thumb.png" width="391" height="459" style="border:0px;"></a></p> 
    <p style="line-height:1.5;">When finished all necessary configuration, we are ready to go. But before you click the OK button, you can also save your configuration into a profile file, with extension name *.epf.&nbsp; It will give us a change to load and use it again it next time.</p> 
    <p style="line-height:1.5;">Here you go, click OK button and just cross your figure, you will get the shp version of the data.</p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">If we have many maps to handle, you must want to do in programmatically. Let’s do in with Map 3D API. The AutoCAD Map 3D application maintains lists of available import and export formats. The application&nbsp;<em>Importer</em>&nbsp;and&nbsp;<em>Exporter</em>&nbsp;classes can import and export data using these formats.</p> 
    <p style="line-height:1.5;"><a name="WS73099cc142f487551dff73910ed0da31f0-75f8"></a>Any import or export procedure requires the following:</p> 
    <p style="line-height:1.5;"><a name="WS1a9193826455f5ff1a6fb3e10eef0010c9-773c"></a></p> 
    <ul style="list-style:none;font-size:12px;">
     <li style="list-style-type:disc;">Selecting the external file format and location</li> 
     <li style="list-style-type:disc;">Mapping attribute data from the external file to object data</li> 
     <li style="list-style-type:disc;">Setting any necessary driver options</li> 
     <li style="list-style-type:disc;">Importing or exporting</li> 
    </ul>
    <p style="line-height:1.5;"><a name="WS1a9193826455f5ff1a6fb3e10eef0010c9-773b"></a>The particular options will vary depending on the type of data being imported or exported, but the overall procedure is the same. In this topic, we will focus on shp file.</p> 
    <p style="line-height:1.5;">Actually, code samples(in C#,VB and C++) are available in&nbsp;<a href="http://download.autodesk.com/media/adn/Map3D2011SDK.zip" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">ObjectARX Map SDK</a>, it can be found C:\Map ObjectARX SDK 2011\Map Samples\DotNet\ImportExportCS , these code sample demonstrate how to export to MapInfo Tab file or MapInfo mif file. We will do some modification to support shp file as well.</p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">Firstly we need initialize the exporter with suitable format name. But unfortunately, I didn't find any document which explains the format string for ImportExpert. How do we know the exact format name string?&nbsp; Still remember the *.epf profile file? yes, many information can be found there :)</p> 
    <p style="line-height:1.5;">here is my *.epf file, please pay attention to the section marked in&nbsp;<strong>bold</strong>:</p> 
    <pre><code class="language-csharp">- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">AdMapExportProfile</span> <span class="attr" style="line-height:1.5;color:rgb(255,0,0);">version</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">="2.1.3"</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LoadedProfileName</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">StorageOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
 <strong> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">StorageType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>FileOneEntityType<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">StorageType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">GeometryType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>Line<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">GeometryType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span></strong> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FilePrefix</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">StorageOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">SelectionOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseSelectionSet</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>1<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseSelectionSet</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseAutoSelection</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>1<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseAutoSelection</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">SelectionOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TranslationOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TreatClosedPolylinesAsPolygons</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TreatClosedPolylinesAsPolygons</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">ExplodeBlocks</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>1<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">ExplodeBlocks</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayersToLevels</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">MapLayersToLevels</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">MapLayersToLevels</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayerToLevelMapping</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayersToLevels</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TranslationOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TopologyOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">GroupComplexPolygons</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">GroupComplexPolygons</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TopologyName</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TopologyOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayerOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoFilterByLayer</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoFilterByLayer</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayerList</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">LayerOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FeatureClassOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoFilterByFeatureClass</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoFilterByFeatureClass</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FeatureClassList</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FeatureClassOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TableDataOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TableDataType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>None<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TableDataType</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">Name</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">SQLKeyOnly</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">SQLKeyOnly</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TableDataOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">CoordSysOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoCoordinateConversion</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DoCoordinateConversion</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">CoordSysName</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">CoordSysOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
- <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TargetNameOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
<strong> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FormatName</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>SHP<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">FormatName</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span></strong> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">TargetNameOptions</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">DriverOptions</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseUniqueKeyField</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>0<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseUniqueKeyField</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseUniqueKeyFieldName</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span>AdMapKey<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">UseUniqueKeyFieldName</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">ExpressionFieldMappings</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">/&gt;</span> 
  <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&lt;/</span><span class="html" style="line-height:1.5;color:rgb(128,0,0);">AdMapExportProfile</span><span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">&gt;</span></code></pre> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">we can set the proper value for “FormatName” and “exporter.SetStorageOptions”. As we said before, only single geometry type is allowed in one shp file, we must specify the geometry type before you begin the exporting. We need to add a RadioGroup to enable use select a geometry type to export.</p> 
    <p style="line-height:1.5;">&lt;code&gt;</p> 
    <pre><code class="language-csharp">MapApplication mapApp = HostMapApplicationServices.Application;
exporter = mapApp.Exporter; 

<span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Initiate the exporter with suitable formate name</span>
exporter.Init(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">"SHP"</span>, expFile);
<span class="rem" style="line-height:1.5;color:rgb(0,128,0);">//To select which drawing objects should be exported, call Exporter.SetSelectionSet(). To export all drawing <br></span><span class="rem" style="line-height:1.5;color:rgb(0,128,0);">//objects, set Exporter.ExportAll to true. To filter the list of objects, set the Exporter.FeatureClassFilter or <br> //Exporter.LayerFilter properties.</span>
<span class="rem" style="line-height:1.5;color:rgb(0,128,0);">//we export all features here</span>
exporter.ExportAll = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>;</code></pre> 
    <pre><code class="language-csharp">GeometryType geomtryType1 = (GeometryType)Enum.Parse(<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">typeof</span>(GeometryType), geomtryType, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>);
exporter.SetStorageOptions(StorageType.FileOneEntityType, geomtryType1, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span>.Empty); </code></pre> 
    <p style="line-height:1.5;">&lt;/code&gt;</p> 
    <p style="line-height:1.5;"><a href="http://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_8.png" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;"><img title="image" alt="image" src="https://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_thumb_3.png" width="456" height="471" style="border:0px;"></a></p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">The main code snippet goes as below:</p> 
    <pre><code class="language-csharp">        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// &lt;summary&gt;</span>
        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// Exports all of the entities or exports entities layer by layer.</span>
        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// &lt;/summary&gt;</span>
        <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">public</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">void</span> DoExport(<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> format, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> expFile, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> layerFilter, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> isLogFile, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">bool</span> isODTable, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">bool</span> isLinkTemplate, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> geomtryType)
        {
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> msg = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;

            FileStream fs = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> FileStream(isLogFile, FileMode.Append);
            StreamWriter log = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> StreamWriter(fs);

            Exporter exporter = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;

            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">try</span>
            {
                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Get current time and log the time of executing exporting.</span>
                DateTime time = DateTime.UtcNow;
                log.WriteLine(time.ToLocalTime().ToString());
                log.Write(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">"Exporting file "</span>);
                log.WriteLine(expFile);

                MapApplication mapApp = HostMapApplicationServices.Application;
                exporter = mapApp.Exporter; 

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Initiate the exporter</span>
                exporter.Init(format, expFile);

                exporter.ExportAll = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>;

                GeometryType geomtryType1 = (GeometryType)Enum.Parse(<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">typeof</span>(GeometryType), geomtryType, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>);
                exporter.SetStorageOptions(StorageType.FileOneEntityType, geomtryType1, <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span>.Empty);

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Attach event handlers to the exporter</span>
                <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">if</span> (<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span> == m_ExpEventHandler)
                {
                    m_ExpEventHandler = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> MyExpEventHandler(log);
                    exporter.RecordReadyForExport += <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> RecordReadyForExportEventHandler(m_ExpEventHandler.RecordReadyForExport);
                    exporter.RecordExported += <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> RecordExportedEventHandler(m_ExpEventHandler.RecordExported);
                    exporter.ExportRecordError += <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">new</span> ExportRecordErrorEventHandler(m_ExpEventHandler.RecordError);
                }

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Get Data mapping object</span>
                ExpressionTargetCollection dataMapping = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;
                dataMapping = exporter.GetExportDataMappings();

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Set ObjectData data mapping if isODTable is true</span>
                <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">if</span> (isODTable &amp;&amp; !MapODData(dataMapping))
                {
                    log.WriteLine(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">"Error in mapping OD table data!"</span>);
                }

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Reset Data mapping with Object data and Link template keys </span>
                exporter.SetExportDataMappings(dataMapping);

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// If layerFilter isn't null, set the layer filter to export layer by layer</span>
                <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">if</span> (<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span> != layerFilter)
                {
                    exporter.LayerFilter = layerFilter;
                }

                <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Do the exporting and log the result</span>
                ExportResults results;
                results = exporter.Export(<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>);
                msg = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span>.Format(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">" {0} objects are exported."</span>, results.EntitiesExported.ToString());
                log.WriteLine(msg);
                msg = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span>.Format(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">" {0} objects are skipped."</span>, results.EntitiesSkippedCouldNotTransform.ToString());
                log.WriteLine(msg);

                Utility.ShowMsg(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">"\nExporting succeeded."</span>);
            }
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">catch</span> (MapException e) 
            {
                log.WriteLine(e.Message);
                log.WriteLine(e.ErrorCode.ToString());
                Utility.ShowMsg(<span class="str" style="line-height:1.5;color:rgb(0,96,128);">"\nExporting failed."</span>);
            }
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">finally</span> 
            {
                log.WriteLine(); 
                log.Close();
            }
        }
</code></pre> 
    <p style="line-height:1.5;">The mappings for attribute data are set using Exporter.SetExportDataMappings(). This requires an ExpressionTargetCollection parameter as input. T<span class="rem" style="line-height:1.5;">he OD table field name in the data mapping should be&nbsp;</span><span class="rem" style="line-height:1.5;">in the format “:fieldName@tableName”, and we make the&nbsp;</span><span class="rem" style="line-height:1.5;">new field name of exported-to file</span>&nbsp;ourselves.&nbsp;<span class="rem" style="line-height:1.5;">It is set to ODFieldName_ODTableName in this sample</span>&nbsp;.</p> 
    <pre><code class="language-csharp">        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// &lt;summary&gt;</span>
        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// Map ObjectData to attribute fields in the exported-to file.</span>
        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">/// &lt;/summary&gt;</span>
        <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">public</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">bool</span> MapODData(ExpressionTargetCollection mapping)
        {
            MapApplication mapApi = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>; 
            ProjectModel proj = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>; 
            Tables tables = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>; 
            Autodesk.Gis.Map.ObjectData.Table table = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>; 
            StringCollection tableNames = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;
            FieldDefinitions definitions = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;

            <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Get map session and all the OD tables</span>
            MapApplication mapApp = HostMapApplicationServices.Application;
            mapApi = mapApp; 
            proj = mapApi.ActiveProject;
            tables = proj.ODTables;
            tableNames = tables.GetTableNames();

            <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// Iterate through the OD table definition and get all the field names</span>
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">int</span> tableCount = tables.TablesCount;
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">try</span>
            {
                <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">for</span> (<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">int</span> i = 0; i &lt; tableCount; i++)
                {
                    table = tables[tableNames[i]];
                    definitions = table.FieldDefinitions;
                    <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">for</span> (<span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">int</span> j = 0; j &lt; definitions.Count; j++)
                    {
                        FieldDefinition column = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;
                        column = definitions[j];
                        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// fieldName is the OD table field name in the data mapping. It should be </span>
                        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// in the format:fieldName@tableName. </span>
                        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// newFieldName is the attribute field name of exported-to file</span>
                        <span class="rem" style="line-height:1.5;color:rgb(0,128,0);">// It is set to ODFieldName_ODTableName in this sample</span>
                        <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> newFieldName = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;
                        <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">string</span> fieldName = <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">null</span>;
                        fieldName = <span class="str" style="line-height:1.5;color:rgb(0,96,128);">":"</span> + column.Name + <span class="str" style="line-height:1.5;color:rgb(0,96,128);">"@"</span> + tableNames[i];
                        newFieldName = column.Name + <span class="str" style="line-height:1.5;color:rgb(0,96,128);">"_"</span> + tableNames[i];
                        mapping.Add(fieldName, newFieldName);
                    }
                }
            }
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">catch</span> (MapImportExportException) 
            {
                <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">return</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">false</span>;
            }
            <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">return</span> <span class="kwrd" style="line-height:1.5;color:rgb(0,0,255);">true</span>;
        }
</code></pre> 
    <p style="line-height:1.5;">Let’s check the exported file in Map 3D, connected with OSGeo Fdo Provider for SHP, you will notice that the attribute information is exported successfully.</p> 
    <p style="line-height:1.5;"><a href="http://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_10.png" rel="nofollow" style="color:rgb(86,182,233);text-decoration:none;"><img title="image" alt="image" src="https://images.cnblogs.com/cnblogs_com/junqilian/WindowsLiveWriter/d120602320b2_F0D8/image_thumb_4.png" width="664" height="389" style="border:0px;"></a></p> 
    <p style="line-height:1.5;"></p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">you can download the whole sample project from&nbsp;<a href="http://files.cnblogs.com/junqilian/_ImportExportCS.zip" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">here</a>.</p> 
    <p style="line-height:1.5;"><a href="http://files.cnblogs.com/junqilian/_ImportExportCS.zip" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">_ImportExportCS.zip</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 84KB</p> 
    <p style="line-height:1.5;">&nbsp;</p> 
    <p style="line-height:1.5;">Cheers,</p> 
    <p style="line-height:1.5;">Daniel 峻祁连</p> 
   </div> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;">
    作者：
    <a href="http://junqilian.cnblogs.com/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">峻祁连</a>
    <br> 邮箱：junqilian@163.com&nbsp;
    <br> 出处：
    <a href="http://junqilian.cnblogs.com/" rel="nofollow" style="color:rgb(26,139,200);text-decoration:none;">http://junqilian.cnblogs.com</a>&nbsp;
    <br> 转载请保留此信息。
   </div> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;">
    <br>
   </div> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;">
    <br>
   </div> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;">
    <br>
   </div> 
   <div style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13.3333px;">
    <br>
   </div> 
   <div> 
    <font color="#4b4b4b">本文转自峻祁连. Moving to Cloud/Mobile博客园博客，原文链接：http://www.cnblogs.com/junqilian/archive/2010/06/25/1765447.html</font>
    <span style="color:rgb(75,75,75);font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
