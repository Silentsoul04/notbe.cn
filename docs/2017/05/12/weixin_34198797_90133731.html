<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux signal那些事儿【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://blog.chinaunix.net/uid-24774106-id-4061386.html    Linux编程，信号是一个让人爱恨交加又不得不提的一个领域。最近我集中学习了Linux的signal相关的内容，分享出来，也为防止自己忘记。 &nbsp; &nbsp...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/05/12/weixin_34198797_90133731.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux signal那些事儿【转】</h1>
    <p class="post-meta">May 12, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>转自：<a href="http://blog.chinaunix.net/uid-24774106-id-4061386.html" rel="nofollow">http://blog.chinaunix.net/uid-24774106-id-4061386.html</a></p> 
   <p><span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;">Linux编程，信号是一个让人爱恨交加又不得不提的一个领域。最近我集中学习了Linux的signal相关的内容，分享出来，也为防止自己忘记。<br><span style="line-height:2;"> &nbsp; &nbsp; 信号的本质是异步。异步一这个词，听着高端大气上档次，又让人云山雾绕，其则不然。其实我们想想，我们这个世界是异步的，每个人干事儿，并不总是A-&gt;B-&gt;C-&gt;D这种。比如我在网上买了东西，我其实并不知道快递几时能到。我可能在公司里面，在喝水，在回邮件，在查bug，在写代码，突然收到了快递小哥的电话，注意这就是信号的delivery。由于快递的到来，我不得不停下我手头的活儿，去签收快递。这就是传说中的典型的异步。我不知道快递小哥几时给我电话，但是我收到电话就去签收，这是我的信号处理函数。更高级一点，如果我在参加重要的会议，我可能需要屏蔽快递小哥的电话（假如我知道其电话），这已经是linux下信号的高级应用(sigprocmask)了。<br><span style="line-height:2;"> &nbsp; &nbsp; 信号是一种机制，是在软件层次对中断机制的一种模拟，内核让某进程意识到某特殊事情发生了。强迫进程去执行相应的信号处理函数。至于信号的来源可能来自硬件如按下键盘或者硬件故障（如ctrl+c发送SIGINT），可能来自其他进程（kill，sigqueue），可能来自自己进程（raise）。&nbsp;<br><span style="line-height:2;"> &nbsp; &nbsp; 信号的本质是一种进程间的通信，一个进程可以向另一个进程发送信号，至少传递了signo这个int值。实际上，通信的内容，可以远不止是signo，可以通过SA_SIGINFO标志位通知进程去取额外的信息。<br><span style="line-height:2;"> &nbsp; &nbsp; 我痛恨片汤话儿，可是上面一大坨片汤话儿，却真真的道出了信号的本质。<br><span style="line-height:2;"> &nbsp; &nbsp; 前面也提到了，signal是个让人爱恨交加的feature，原因在于沉重的历史包袱。下面我将一一道来。<br><span style="line-height:2;"> &nbsp; &nbsp; 在上古时期，UNIX就已经有了signal这个feature，但是当时的signal存在几个问题：<br><span style="line-height:2;"> &nbsp; <strong style="line-height:2;">&nbsp;1 传统的信号处理函数是一次性的，而非永久性的。</strong><br><span style="line-height:2;"> &nbsp; &nbsp; linux为了向下兼容，依然实现了这个有缺陷的signal系统调用。你可看到signal系统调用的内核代码中有SA_ONESHOT这个标志位。<br></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">#ifdef __ARCH_WANT_SYS_SIGNAL<br></span> </li> 
     <li> /<span style="color:#0000cc;">*<br></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* <span style="color:#0000ff;">For backwards compatibility<span style="color:#0000cc;">. Functionality superseded by sigaction<span style="color:#0000cc;">.<br></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> SYSCALL_DEFINE2<span style="color:#0000cc;">(signal<span style="color:#0000cc;">, <span style="color:#0000ff;">int<span style="color:#0000cc;">, sig<span style="color:#0000cc;">, __sighandler_t<span style="color:#0000cc;">, handler<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span> </li> 
     <li> {<br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">struct k_sigaction new_sa<span style="color:#0000cc;">, old_sa<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">int <span style="color:#0000ff;">ret<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_handler <span style="color:#0000cc;">= handler<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_flags <span style="color:#0000cc;">= SA_ONESHOT <span style="color:#0000cc;">| SA_NOMASK<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigemptyset<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_mask<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">ret <span style="color:#0000cc;">= do_sigaction<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, &amp;new_sa<span style="color:#0000cc;">, &amp;old_sa<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000ff;">ret <span style="color:#0000cc;">? <span style="color:#0000ff;">ret <span style="color:#0000cc;">: <span style="color:#0000cc;">(unsigned long<span style="color:#0000cc;">)old_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_handler<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> }<br></li> 
     <li> #<span style="color:#0000ff;">endif /<span style="color:#0000cc;">* __ARCH_WANT_SYS_SIGNAL <span style="color:#0000cc;">*<span style="color:#0000cc;">/ </span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 这个SA_ONESHOT标志位，等同于SA_RESETHAND标志：在arch/x86/include/uapi/asm/signal.h中有：<br></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">#define SA_ONESHOT&nbsp;&nbsp;&nbsp;&nbsp;SA_RESETHAND </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 信号产生，到信号处理函数开始执行，中间肯定是有时间差的。内核开始开始强迫进程对信号作出响应，这叫作信号的传递。也就是说信号产生，内核只是在进程描述符记录了一笔，该进程收到信号X一枚，并没有马上强迫进程对信号作出响应。已经产生但尚未传递的信号叫挂起信号。对于非实时而言，信号不排队，位图占个位即可。对于实时信号，则排队，同一信号可能有多个挂起信号。这个不多说，后面自然提到。<br><span style="line-height:2;"> &nbsp;&nbsp;&nbsp;&nbsp;<img src="https://yqfile.alicdn.com/img_6d8faa5fae3589cc445368bfc28ea7df.png" alt="" width="600" height="331"><br><span style="line-height:2;"> &nbsp; &nbsp; 上图反映了内核如何传递信号。基本就是选择一个挂起信号，然后处理一个信号。get_signal_to_deliver 是在进程中选择一个信号来handle。代码在kernel/signal.c，其中有如下code：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if <span style="color:#0000cc;">(ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_handler <span style="color:#0000cc;">=<span style="color:#0000cc;">= SIG_IGN<span style="color:#0000cc;">) <span style="color:#0000cc;">/<span style="color:#0000cc;">* <span style="color:#0000ff;">Do <span style="color:#0000ff;">nothing<span style="color:#0000cc;">. <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_handler <span style="color:#0000cc;">!<span style="color:#0000cc;">= SIG_DFL<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* Run the handler<span style="color:#0000cc;">. <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">*return_ka <span style="color:#0000cc;">= <span style="color:#0000cc;">*ka<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span>ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>sa<span style="color:#0000cc;">.<span>sa_flags <span style="color:#0000cc;">&amp;<span> SA_ONESHOT<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>sa<span style="color:#0000cc;">.<span>sa_handler <span style="color:#0000cc;">=<span> SIG_DFL<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">; <span style="color:#0000cc;">/<span style="color:#0000cc;">* will return non<span style="color:#0000cc;">-zero <span style="color:#ff00ff;">"signr" value <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们看到了linux也实现了signal这个有缺陷的系统调用。传统的signal系统调用，他的信号处理函数是一次性的，执行过后，该信号的信号处理函数就变成了SIG_DFL。<br><span style="line-height:2;"> &nbsp; &nbsp; 值得一提的是，glibc的signal函数，调用的已经不是传统的signal系统调用，而是rt_sigaction系统调用，这种一次性的缺陷早已经解决了。怎么证明：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code<span style="color:#0000cc;">/c<span style="color:#0000cc;">/self<span style="color:#0000cc;">/signal$ cat signal_fault_1<span style="color:#0000cc;">.c <br></span></span></span></span></span></span></span></span></span> </li> 
     <li> #include <span style="color:#0000cc;">&lt;stdio<span style="color:#0000cc;">.h<span style="color:#0000cc;">&gt;<br></span></span></span> </li> 
     <li> #include <span style="color:#0000cc;">&lt;stdlib<span style="color:#0000cc;">.h<span style="color:#0000cc;">&gt;<br></span></span></span> </li> 
     <li> #include <span style="color:#0000cc;">&lt;signal<span style="color:#0000cc;">.h<span style="color:#0000cc;">&gt;<br></span></span></span> </li> 
     <li> #include <span style="color:#0000cc;">&lt;<span style="color:#ff0000;">string<span style="color:#0000cc;">.h<span style="color:#0000cc;">&gt;<br></span></span></span></span> </li> 
     <li> #include <span style="color:#0000cc;">&lt;errno<span style="color:#0000cc;">.h<span style="color:#0000cc;">&gt;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> #define MSG <span style="color:#ff00ff;">"OMG , I catch the signal SIGINT\n"<br></span> </li> 
     <li> #define MSG_END <span style="color:#ff00ff;">"OK,finished process signal SIGINT\n"<br></span> </li> 
     <li> <span style="color:#ff0000;">int do_heavy_work<span style="color:#0000cc;">(<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int i <span style="color:#0000cc;">; <br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int k<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;srand<span style="color:#0000cc;">(<span style="color:#ff0000;">time<span style="color:#0000cc;">(<span style="color:#0000ff;">NULL<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">for<span style="color:#0000cc;">(i <span style="color:#0000cc;">= 0 <span style="color:#0000cc;">; i <span style="color:#0000cc;">&lt; 100000000<span style="color:#0000cc;">;i<span style="color:#0000cc;">+<span style="color:#0000cc;">+<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k <span style="color:#0000cc;">= rand<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">%1234589<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> <span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> void signal_handler<span style="color:#0000cc;">(<span style="color:#ff0000;">int signo<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;write<span style="color:#0000cc;">(2<span style="color:#0000cc;">,MSG<span style="color:#0000cc;">,strlen<span style="color:#0000cc;">(MSG<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;do_heavy_work<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;write<span style="color:#0000cc;">(2<span style="color:#0000cc;">,MSG_END<span style="color:#0000cc;">,strlen<span style="color:#0000cc;">(MSG_END<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> <span style="color:#ff0000;">int main<span style="color:#0000cc;">(<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;char input<span style="color:#0000cc;">[1024<span style="color:#0000cc;">] <span style="color:#0000cc;">= <span style="color:#0000cc;">{0<span style="color:#0000cc;">}<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;"><br></span> </li> 
     <li> <span>#if defined TRADITIONAL_SIGNAL_API<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(syscall(SYS_signal ,SIGINT,signal_handler) == -1)<br><span>#elif defined SYSTEMV_SIGNAL_API<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(sysv_signal(SIGINT,signal_handler) == -1)<br><span>#else<br><span>&nbsp;&nbsp;&nbsp;&nbsp;<span>if(signal(SIGINT,signal_handler) == SIG_ERR)<br><span>#endif<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:#0000cc;">(stderr<span style="color:#0000cc;">,<span style="color:#ff00ff;">"signal failed\n"<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000cc;">-1<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:#0000cc;">(<span style="color:#ff00ff;">"input a string:\n"<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if<span style="color:#0000cc;">(fgets<span style="color:#0000cc;">(input<span style="color:#0000cc;">,sizeof<span style="color:#0000cc;">(input<span style="color:#0000cc;">)<span style="color:#0000cc;">,stdin<span style="color:#0000cc;">)<span style="color:#0000cc;">=<span style="color:#0000cc;">= <span style="color:#0000ff;">NULL<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf<span style="color:#0000cc;">(stderr<span style="color:#0000cc;">,<span style="color:#ff00ff;">"fgets failed(%s)\n"<span style="color:#0000cc;">,strerror<span style="color:#0000cc;">(errno<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000cc;">-2<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">else<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf<span style="color:#0000cc;">(<span style="color:#ff00ff;">"you entered:%s"<span style="color:#0000cc;">,input<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return 0<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<br></li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 编译的时候，我没有定义SYSTEMV_SIGNAL_API,就是标准的glibc的signal函数，我用strace跟踪glibc的signal函数调用的系统调用是：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">rt_sigaction<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, {0x8048736<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000ff;">INT<span style="color:#0000cc;">]<span style="color:#0000cc;">, SA_RESTART}<span style="color:#0000cc;">, {SIG_DFL<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, 0}<span style="color:#0000cc;">, 8<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 测试结果如下：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ gcc <span style="color:#0000cc;">-o signal_glibc signal_fault_1<span style="color:#0000cc;">.c <br></span></span></span></span></span></span></span> </li> 
     <li> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_glibc <br></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> input^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^COK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> OMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> ^Z<br></li> 
     <li> <span style="color:#0000cc;">[1<span style="color:#0000cc;">]<span style="color:#0000cc;">+ Stopped <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_glibc </span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们安装的信号处理函数并不是一次性的，原因就是glibc的signal函数调用的函数并非是signal系统调用，并没有SA_ONESHOT标志位。<br><span style="line-height:2;"> &nbsp; &nbsp; 我们如何体验下老古董的signal，glibc提供了一个sysv_signal接口，manual中这样描述：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">&nbsp;&nbsp;&nbsp;However sysv_signal<span style="color:#0000cc;">(<span style="color:#0000cc;">) provides the System V unreliable signal semantics<span style="color:#0000cc;">, that is<span style="color:#0000cc;">: a<span style="color:#0000cc;">) the disposition <span style="color:#ff0000;">of the sig‐<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp; &nbsp;nal is reset to the default when the handler is invoked<span style="color:#0000cc;">; b<span style="color:#0000cc;">) delivery <span style="color:#ff0000;">of further instances <span style="color:#ff0000;">of the signal is <span style="color:#0000ff;">not<br></span></span></span></span></span> </li> 
     <li> &nbsp; &nbsp;blocked <span style="color:#0000ff;">while the signal handler is executing<span style="color:#0000cc;">; <span style="color:#0000ff;">and c<span style="color:#0000cc;">) <span style="color:#0000ff;">if the handler interrupts <span style="color:#0000cc;">(certain<span style="color:#0000cc;">) blocking system calls<span style="color:#0000cc;">,<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp; &nbsp;then the system <span style="color:#0000ff;">call is <span style="color:#0000ff;">not automatically restarted<span style="color:#0000cc;">. </span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 对于我们的例子只需要：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">gcc <span style="color:#0000cc;">-DSYSTEMV_SIGNAL_API <span style="color:#0000cc;">-o signal_sysv signal_fault_1<span style="color:#0000cc;">.c </span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们看下：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_sysv <br></span></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^C<br></li> 
     <li> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ man sysv_signal </span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 第二个ctrl+C导致了进程的推出，原因是sysv_signal这种传统的signal的安装函数是一次性的。strace也证明了这一点：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">rt_sigaction<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, {0x8048756<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, SA_INTERRUPT<span style="color:#0000cc;">|SA_NODEFER<span style="color:#0000cc;">|<span>SA_RESETHAND}<span style="color:#0000cc;">, {SIG_DFL<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, 0}<span style="color:#0000cc;">, 8<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 还记得么：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">#define SA_ONESHOT <span>SA_RESETHAND </span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们发现sysv调用的不是signal系统调用，而是rt_sigaction系统调用。如果你非要品尝传统的signal系统调用，这也不难。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> gcc -DTRADITIONAL_SIGNAL_API &nbsp;-o signal_traditional signal_fault_1.c&nbsp;<br></li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们发现第二个SIGINT信号的信号处理函数已经SIG_DFL,使进程退出了。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_traditional <br></span></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^C </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们通过strace可以证明，的确调用了signal系统调用：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">signal<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, 0x8048736<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 <span style="color:#0000cc;">(SIG_DFL<span style="color:#0000cc;">)<span style="line-height:2;font-size:14px;font-family:'sans serif', tahoma, verdana, helvetica;">&nbsp; </span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp;&nbsp;&nbsp;&nbsp;<strong style="line-height:2;">2早期的信号，没有屏蔽正在处理的信号。<br> &nbsp; &nbsp; </strong><span style="line-height:2;">如何证明这一点呢？我上面的例子中故意在信号处理函数中做了很heavy很耗时的操作，从而容易造出处理信号A的时候，另一信号A又被deliver的场景。<br><span style="line-height:2;"> &nbsp; &nbsp; 因为do_heavy_work是个很耗费时间的操作，信号处理完成我们会在标准错误上输出处理完成的语句，这就表征了信号处理结束了没有。<br><span style="line-height:2;"> &nbsp; &nbsp; 我们看下传统signal的，收到一个SIGINT的信号的情况：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_traditional <br></span></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> ^C<span>OMG <span style="color:#0000cc;">,<span> I catch the signal SIGINT<br></span></span></span> </li> 
     <li> <span>OK<span style="color:#0000cc;">,<span>finished process signal SIGINT<br></span></span></span> </li> 
     <li> fgets failed<span style="color:#0000cc;">(Interrupted system <span style="color:#0000ff;">call<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ </span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 如果我在进程处理信号处理函数的时候，再次发送一个SIGINT，这个SIGINT也可能被内核deliver。那么信号处理函数就被中断掉，<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_traditional <br></span></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, <span>I catch the signal SIGINT<br></span></span> </li> 
     <li> ^C<br></li> 
     <li> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ </span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们看到我们收到了I catch the signal SIGINT的打印，但是，并没有收到OK,I finished process signal SIGINT，这表明传统的signal并没有屏蔽正在处理的信号。<br><span style="line-height:2;"> &nbsp; &nbsp; 那么我们现在的glibc的signal函数如何？<br><span style="line-height:2;"> &nbsp; &nbsp; strace又来帮忙了?<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">rt_sigaction<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, <span>{0x8048736<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000ff;">INT<span style="color:#0000cc;">]<span style="color:#0000cc;">,<span> SA_RESTART}<span style="color:#0000cc;">, {SIG_DFL<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, 0}<span style="color:#0000cc;">, 8<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; glibc的signal函数，调用的是rt_sigaction 系统调用：<br><span style="line-height:2;"> &nbsp;&nbsp;&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">SYSCALL_DEFINE4<span style="color:#0000cc;">(rt_sigaction<span style="color:#0000cc;">, <span style="color:#0000ff;">int<span style="color:#0000cc;">, sig<span style="color:#0000cc;">,<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <span style="color:#0000ff;">struct sigaction __user <span style="color:#0000cc;">*<span style="color:#0000cc;">, act<span style="color:#0000cc;">,<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">struct sigaction __user <span style="color:#0000cc;">*<span style="color:#0000cc;">, oact<span style="color:#0000cc;">,<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t<span style="color:#0000cc;">, sigsetsize<span style="color:#0000cc;">)<br></span></span> </li> 
     <li> <br></li> 
     <li> <span style="color:#0000ff;">struct sigaction {<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">union {<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; __sighandler_t _sa_handler<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; void <span style="color:#0000cc;">(<span style="color:#0000cc;">*_sa_sigaction<span style="color:#0000cc;">)<span style="color:#0000cc;">(<span style="color:#0000ff;">int<span style="color:#0000cc;">, <span style="color:#0000ff;">struct siginfo <span style="color:#0000cc;">*<span style="color:#0000cc;">, void <span style="color:#0000cc;">*<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;} _u<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigset_t sa_mask<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;unsigned long sa_flags<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;void <span style="color:#0000cc;">(<span style="color:#0000cc;">*sa_restorer<span style="color:#0000cc;">)<span style="color:#0000cc;">(void<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> } </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 我们把strace中的信息，和sigaction数据对比，发现，[INT],就是传说中的sa_mask,当处理SIGINT的时候，看起来是在处理SIGINT信号处理函数的时候，SIGINT会被被屏蔽，防止重入。实际如何呢？&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_glibc <br></span></span></span></span></span></span></span> </li> 
     <li> input a string<span style="color:#0000cc;">:<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^C^C^C^COK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> OMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^C^COK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> OMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span> </li> 
     <li> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span> </li> 
     <li> ^Z<br></li> 
     <li> <span style="color:#0000cc;">[2<span style="color:#0000cc;">]<span style="color:#0000cc;">+ Stopped <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_glibc </span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 从未出现OMG，I catch the SIGINT连续出现。这是偶然还是必然呢？答案是必然，内核是如何做到的呢？<br><span style="line-height:2;">&nbsp; &nbsp; 在上图的handle_signal函数的末尾，调用了signal_delivered函数：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#0000cc;">/<span style="color:#0000cc;">*<span style="color:#0000cc;">*<br></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* signal_delivered <span style="color:#0000cc;">- <br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* @sig<span style="color:#0000cc;">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number of signal being delivered<br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* @info<span style="color:#0000cc;">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;siginfo_t of signal being delivered<br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* @ka<span style="color:#0000cc;">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigaction setting that chose the handler<br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* @regs<span style="color:#0000cc;">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user register state<br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* @stepping<span style="color:#0000cc;">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nonzero <span style="color:#0000ff;">if debugger single<span style="color:#0000cc;">-<span style="color:#0000ff;">step <span style="color:#0000ff;">or block<span style="color:#0000cc;">-<span style="color:#0000ff;">step <span style="color:#0000ff;">in use<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">*<br></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* This <span style="color:#0000ff;">function should be called when a signal has succesfully been<br></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* delivered<span style="color:#0000cc;">. It updates the blocked signals accordingly <span style="color:#0000cc;">(<span style="color:#0000cc;">@ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_mask<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* <span style="color:#0000ff;">is always blocked<span style="color:#0000cc;">, <span style="color:#0000ff;">and the signal itself <span style="color:#0000ff;">is blocked unless <span style="color:#0000cc;">%SA_NODEFER<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* <span style="color:#0000ff;">is <span style="color:#0000ff;">set <span style="color:#0000ff;">in @ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_flags<span style="color:#0000cc;">. Tracing <span style="color:#0000ff;">is notified<span style="color:#0000cc;">.<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> void signal_delivered<span style="color:#0000cc;">(<span style="color:#ff0000;">int sig<span style="color:#0000cc;">, siginfo_t <span style="color:#0000cc;">*info<span style="color:#0000cc;">, struct k_sigaction <span style="color:#0000cc;">*ka<span style="color:#0000cc;">,<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct pt_regs <span style="color:#0000cc;">*regs<span style="color:#0000cc;">, <span style="color:#ff0000;">int stepping<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigset_t blocked<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* A signal was successfully delivered<span style="color:#0000cc;">, <span style="color:#0000ff;">and the<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; saved sigmask was stored <span style="color:#0000ff;">on the signal frame<span style="color:#0000cc;">,<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000ff;">and will be restored by sigreturn<span style="color:#0000cc;">. So we can<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; simply clear the restore sigmask flag<span style="color:#0000cc;">. <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;clear_restore_sigmask<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigorsets<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;blocked<span style="color:#0000cc;">, <span style="color:#0000cc;">&amp;current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;blocked<span style="color:#0000cc;">, <span style="color:#0000cc;">&amp;ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_mask<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!<span style="color:#0000cc;">(<span>ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>sa<span style="color:#0000cc;">.<span>sa_flags <span style="color:#0000cc;">&amp;<span> SA_NODEFER<span style="color:#0000cc;">)<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>sigaddset<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;<span>blocked<span style="color:#0000cc;">,<span> sig<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;set_current_blocked<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;blocked<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;tracehook_signal_handler<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, info<span style="color:#0000cc;">, ka<span style="color:#0000cc;">, regs<span style="color:#0000cc;">, stepping<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 这个函数很有意思，只要用户没有指定SA_NODEFER标志位，当前处理的信号总是加入到屏蔽信号之中。深入理解Linux内核在也提到了这一点。经典教材是这么说的：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><em>当进程执行一个信号处理程序的函数时，通常屏蔽相应的信号，即自动阻塞这个信号，直到处理程序结束。因此，所处理的信号的另一次出现，并不能中断信号处理程序，所以信号处理函数不必是可以重入的。</em> </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 这个结论很震惊吧。是的你用glibc的signal函数，不必担心信号处理函数的嵌套问题。至于重入问题我们后文讨论。<br><span style="line-height:2;">&nbsp; &nbsp; 那么传统的signal系统调用和sysv_signal又如何？为何他们存在信号的可重入问题？&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText"> 
    <ol style="line-height:2;">
     <li> <span style="color:#000000;">SYSCALL_DEFINE2<span style="color:#0000cc;">(signal<span style="color:#0000cc;">, <span style="color:#0000ff;">int<span style="color:#0000cc;">, sig<span style="color:#0000cc;">, __sighandler_t<span style="color:#0000cc;">, handler<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span> </li> 
     <li> {<br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">struct k_sigaction new_sa<span style="color:#0000cc;">, old_sa<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">int <span style="color:#0000ff;">ret<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_handler <span style="color:#0000cc;">= handler<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_flags <span style="color:#0000cc;">= SA_ONESHOT <span style="color:#0000cc;">| <span>SA_NOMASK<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigemptyset<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;new_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_mask<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">ret <span style="color:#0000cc;">= do_sigaction<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, &amp;new_sa<span style="color:#0000cc;">, &amp;old_sa<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000ff;">ret <span style="color:#0000cc;">? <span style="color:#0000ff;">ret <span style="color:#0000cc;">: <span style="color:#0000cc;">(unsigned long<span style="color:#0000cc;">)old_sa<span style="color:#0000cc;">.sa<span style="color:#0000cc;">.sa_handler<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> } </li> 
    </ol>
    <div> 
     <span style="color:#5c5c5c;"><span style="line-height:12px;"><br> #define <span>SA_NOMASK <span>SA_NODEFER<br><br></span></span></span></span> 
    </div> 
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> &nbsp; &nbsp; 至于sysv_signal<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText">
    <ol>
     <li> <span style="color:#000000;">rt_sigaction<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, {0x8048756<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, SA_INTERRUPT<span style="color:#0000cc;">|<span>SA_NODEFER<span style="color:#0000cc;">|SA_RESETHAND}<span style="color:#0000cc;">, {SIG_DFL<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, 0}<span style="color:#0000cc;">, 8<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> &nbsp; &nbsp; 不多说了，不作死就不会死，signal系统调用和sysv_signal都作死：sa_mask是空，更要命的是都有<span style="font-family:Consolas, monospace;letter-spacing:.10000000149011612px;line-height:12px;">SA_NODEFER<span style="font-size:14px;"> 。自作孽，不可活。之所以如此自作孽，就是为了向下兼容，向传统的signal致敬。<br> &nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;<span style="font-size:15px;"><strong> &nbsp; 3 早期的signal，会中断系统调用。&nbsp;&nbsp;</strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.10000000149011612px;line-height:12px;"><span style="font-size:14px;"><br><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;何意？<strong>&nbsp;&nbsp;</strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.10000000149011612px;line-height:12px;"><span style="font-size:14px;"><br><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;某些系统调用可能会被信号中断，此时系统调用返回错误EINTR，表示被信号中断了。非常多的系统调用都会被中断，我前面有篇博文<a href="http://blog.chinaunix.net/uid-24774106-id-3065234.html" rel="nofollow">重启系统调用探究</a>，就详细介绍了系统被信号中断的问题，传统的signal会出现这个问题。那么glibc的signal函数有没有这个问题？答案是没有这个问题，glibc的signal函数很不错。</span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText">
    <ol>
     <li><span style="color:#000000;font-size:15px;"> rt_sigaction<span style="color:#0000cc;">(SIGINT<span style="color:#0000cc;">, {0x8048736<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000ff;">INT<span style="color:#0000cc;">]<span style="color:#0000cc;">, SA_RESTART}<span style="color:#0000cc;">, {SIG_DFL<span style="color:#0000cc;">, <span style="color:#0000cc;">[<span style="color:#0000cc;">]<span style="color:#0000cc;">, 0}<span style="color:#0000cc;">, 8<span style="color:#0000cc;">) <span style="color:#0000cc;">= 0 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li> 
    </ol>
   </div> 
   <p><span style="font-size:15px;"> <span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"> &nbsp; &nbsp; signal系统调用和sysv_signal都有这个弊端：请看：&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText">
    <ol>
     <li><span style="color:#000000;font-size:15px;"> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_traditional <br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> input a string<span style="color:#0000cc;">:<br></span></span></li> 
     <li><span style="font-size:15px;"> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span></span></li> 
     <li><span style="font-size:15px;"> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span></span></li> 
     <li><span style="font-size:15px;"> fgets failed<span style="color:#0000cc;">(Interrupted system <span style="color:#0000ff;">call<span style="color:#0000cc;">)<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ <span style="color:#0000cc;">.<span style="color:#0000cc;">/signal_sysv <br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> input a string<span style="color:#0000cc;">:<br></span></span></li> 
     <li><span style="font-size:15px;"> ^COMG <span style="color:#0000cc;">, I catch the signal SIGINT<br></span></span></li> 
     <li><span style="font-size:15px;"> OK<span style="color:#0000cc;">,finished process signal SIGINT<br></span></span></li> 
     <li><span style="font-size:15px;"> fgets failed<span style="color:#0000cc;">(Interrupted system <span style="color:#0000ff;">call<span style="color:#0000cc;">)<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> manu@manu<span style="color:#0000cc;">-hacks<span style="color:#0000cc;">:<span style="color:#0000cc;">~<span style="color:#0000cc;">/code/c/self/signal$ </span></span></span></span></span></li> 
    </ol>
   </div> 
   <p><span style="font-size:15px;"> <span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"> &nbsp; &nbsp; 原因就是没有SA_RESTART标志位。内核代码如何体现：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText">
    <ol>
     <li><span style="color:#000000;font-size:15px;"> static void<br></span></li> 
     <li><span style="font-size:15px;"> handle_signal<span style="color:#0000cc;">(unsigned long sig<span style="color:#0000cc;">, siginfo_t <span style="color:#0000cc;">*info<span style="color:#0000cc;">, struct k_sigaction <span style="color:#0000cc;">*ka<span style="color:#0000cc;">,<br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct pt_regs <span style="color:#0000cc;">*regs<span style="color:#0000cc;">)<br></span></span></span></li> 
     <li><span style="color:#0000cc;font-size:15px;"> {<br></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* Are we from a system <span style="color:#0000ff;">call<span style="color:#0000cc;">? <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(syscall_get_nr<span style="color:#0000cc;">(current<span style="color:#0000cc;">, regs<span style="color:#0000cc;">) <span style="color:#0000cc;">&gt;<span style="color:#0000cc;">= 0<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* <span style="color:#0000ff;">If so<span style="color:#0000cc;">, check system <span style="color:#0000ff;">call restarting<span style="color:#0000cc;">.<span style="color:#0000cc;">. <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch <span style="color:#0000cc;">(syscall_get_error<span style="color:#0000cc;">(current<span style="color:#0000cc;">, regs<span style="color:#0000cc;">)<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">-ERESTART_RESTARTBLOCK<span style="color:#0000cc;">:<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">-ERESTARTNOHAND<span style="color:#0000cc;">:<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;ax <span style="color:#0000cc;">= <span style="color:#0000cc;">-EINTR<span style="color:#0000cc;">;<br></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span></span></li> 
     <li> <br></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">-ERESTARTSYS<span style="color:#0000cc;">:<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!<span style="color:#0000cc;">(ka<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sa<span style="color:#0000cc;">.sa_flags <span style="color:#0000cc;">&amp; SA_RESTART<span style="color:#0000cc;">)<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;ax <span style="color:#0000cc;">= <span style="color:#0000cc;">-EINTR<span style="color:#0000cc;">;<br></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* fallthrough <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">-ERESTARTNOINTR<span style="color:#0000cc;">:<br></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;ax <span style="color:#0000cc;">= regs<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;orig_ax<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regs<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;ip <span style="color:#0000cc;">-<span style="color:#0000cc;">= 2<span style="color:#0000cc;">;<br></span></span></span></span></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span></span></li> 
     <li><span style="font-size:15px;"> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">} </span></span></li> 
     <li><span style="color:#0000cc;font-size:15px;"> &nbsp; &nbsp; 。。。 </span></li> 
     <li><span style="color:#0000cc;font-size:15px;"> } </span></li> 
    </ol>
   </div> 
   <p><span style="font-size:15px;"> <span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"> &nbsp; &nbsp; 很多文章都都将signal函数描述的多么不堪，其实glibc的signal函数非常靠谱，传统的signal的几个弊端都不存在，在日常的工作中，signal完全可以满足需要。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 但是存在一个问题，就会可移植性。由于不同的平台可能不同。单就linux平台而言，glibc的signal函数还不错。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> &nbsp; &nbsp; 那么signal还有什么问题呢？为啥有引入了实时信号？那是下一篇内容。<br><br> 参考文献</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 1 深入理解linunx内核</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <p><span style="font-size:15px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="font-family:Consolas, monospace;letter-spacing:.1px;line-height:12px;"><br> 2&nbsp;<span style="line-height:1.5;">&nbsp;linux内核源代码情景分析<br> 3 signal ppt&nbsp;&nbsp;蘇維農<br> 4 linux系统编程 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
