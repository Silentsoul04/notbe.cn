<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux signal 那些事儿 （3）【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://blog.chinaunix.net/uid-24774106-id-4065797.html    这篇博客，想集中在signal 与线程的关系上，顺带介绍内核signal相关的结构。如何组织我其实并没想好，想到哪就写到哪里吧。主题一定会落在signal之内而不跑题...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/05/12/weixin_34008933_90133877.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux signal 那些事儿 （3）【转】</h1>
    <p class="post-meta">May 12, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>转自：<a href="http://blog.chinaunix.net/uid-24774106-id-4065797.html" rel="nofollow">http://blog.chinaunix.net/uid-24774106-id-4065797.html</a></p> 
   <p><span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;">这篇博客，想集中在signal 与线程的关系上，顺带介绍内核signal相关的结构。如何组织我其实并没想好，想到哪就写到哪里吧。主题一定会落在signal之内而不跑题。<br><span style="line-height:2;"> &nbsp; &nbsp; 提到signal与thread的关系，就得先提POSIX标准。POSIX标准决定了Linux为何将signal如此实现：<br><span style="line-height:2;"> &nbsp; &nbsp;1 信号处理函数必须在多线程应用的所有线程之间共享，但是，每个线程要有自己的挂起信号掩码和阻塞信号掩码。<br><span style="line-height:2;"> &nbsp; &nbsp;2 POSIX 函数kill/sigqueue必须面向所有的多线程应用而不是某个特殊的线程。<br><span style="line-height:2;"> &nbsp; &nbsp;3 每个发给多线程应用的信号仅传送给1个线程，这个线程是由内核从不会阻塞该信号的线程中随意选出。<br><span style="line-height:2;"> &nbsp; &nbsp;4 如果发送一个致命信号到多线程，那么内核将杀死该应用的所有线程，而不仅仅是接收信号的那个线程。<br><br><span style="line-height:2;"> &nbsp; &nbsp; 上面是POSIX标准，也就是提出来的要求，Linux要遵循POSIX标准，那Linux是怎么做到的呢？<br><span style="line-height:2;"> &nbsp; &nbsp; 到了此处，我们需要理清一些基本的概念：<br></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">struct task_struct <span style="color:#0000cc;">{<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp; &nbsp; pid_t pid<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp; &nbsp; pid_t tgid<br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct task_struct <span style="color:#0000cc;">*group_leader<span style="color:#0000cc;">;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* threadgroup leader <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct list_head thread_group<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<span style="color:#0000cc;">.<br></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 从字面意思上看 pid，是process id，其则不然，pid是thread id。从字面意思上看，tgid是thread group id，其则是真正的pid。<br><span style="line-height:2;"> &nbsp; &nbsp; 有点绕是不是？对于一个多线程的程序，无论是哪个线程执行getpid，结果都是一样的，最终返回的同一个值 tgid。如果我们实现了gettid（很不幸的是glibc没有这个函数，所以我们要用syscall），我们就会发现，各个线程返回的值不同，此时，返回的值是内核task_struct中的pid。对于多线程应用/proc/pid/task可以看到的，就是线程的thread id，也就是task_struct中的pid。<br><span style="line-height:2;"> &nbsp; &nbsp;<img src="https://yqfile.alicdn.com/img_da20d5ffc0a33e88ab4472900d943f39.png" alt="" width="700" height="219"><br><span style="line-height:2;"> &nbsp; &nbsp; 我在我的博文<a style="line-height:2;" href="http://blog.chinaunix.net/uid-24774106-id-3650136.html" rel="nofollow">Linux线程之线程 线程组 进程 轻量级进程（LWP）</a><span style="line-height:2;">提到了这个问题。我不想多浪费笔墨赘述。<br><span style="line-height:2;"> &nbsp; &nbsp; group leader字段，指向线程组的第一个线程。对于我们自己的程序而言，main函数所在的线程，也就是线程组的第一个线程，所以group leader就会他自己。一旦用pthread_create创建了线程，那么main所在的线程，还有创建出来的线程，隶属于同一个线程组，线程的group leader还是main函数所在的线程id。<br><span style="line-height:2;"> &nbsp; &nbsp; thread_group，同一线程组的所有线程的队列。对于group_leader,这是一个队列头，对于同一线程组的其他线程，通过这个字段挂入队列。可以根据这个队列，遍历线程组的所有线程。<br><span style="line-height:2;"> &nbsp; &nbsp; &nbsp;是时候看看内核代码了,下面的代码属于do_fork函数及copy_process函数的一些代码。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;pid <span style="color:#0000cc;">= pid_nr<span style="color:#0000cc;">(pid<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;tgid <span style="color:#0000cc;">= p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;pid<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(clone_flags &amp; CLONE_THREAD<span style="color:#0000cc;">)//创建线程，tgid等于当前线程的<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;tgid <span style="color:#0000cc;">= current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;tgid<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_leader <span style="color:#0000cc;">= p<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;INIT_LIST_HEAD<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;thread_group<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> <span style="color:#0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;if <span style="color:#0000cc;">(clone_flags &amp; CLONE_THREAD<span style="color:#0000cc;">) {&nbsp;//线程处理部分，group_leader都是第一个线程。同时挂入队列<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;nr_threads<span style="color:#0000cc;">+<span style="color:#0000cc;">+<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atomic_inc<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;live<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atomic_inc<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sigcnt<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>group_leader <span style="color:#0000cc;">=<span> current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>group_leader<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_add_tail_rcu<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;thread_group<span style="color:#0000cc;">, &amp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_leader<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;thread_group<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;} </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 代码表明，第一个线程呢，pid和tgid相同，都是分配的那个pid，group_leader也是自己。后面第二个线程，pid是自己的，但是tgid 等于创建者的tgid，group_leader指向第一个线程的task_struct. 后面创建的所有的线程，都会挂入队列，方便遍线程组的所有线程。<br><span style="line-height:2;"> &nbsp; &nbsp; 有了线程组的概念，我们就可以进一步解释signal相关的内容了。&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#0000cc;">&nbsp; &nbsp; /<span style="color:#0000cc;">* signal handlers <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct signal_struct <span style="color:#0000cc;">*signal<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct sighand_struct <span style="color:#0000cc;">*sighand<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigset_t blocked<span style="color:#0000cc;">, real_blocked<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sigset_t saved_sigmask<span style="color:#0000cc;">;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* restored <span style="color:#0000ff;">if set_restore_sigmask<span style="color:#0000cc;">(<span style="color:#0000cc;">) was used <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct sigpending pending<span style="color:#0000cc;">; </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp;&nbsp;&nbsp;&nbsp;<img style="font-size:14.399999618530273px;line-height:22.399999618530273px;" src="https://yqfile.alicdn.com/img_ab6039dfdc56e85449ed5bd1f2f562ee.png" alt="" width="700" height="452"><br><span style="line-height:2;"> &nbsp; &nbsp; 线程组里面的所有成员共享一个signal_struct类型结构，同一线程组的多线程的task_struct 中的signal指针都是指向同一个signal_struct。sighand成员变量也是如此，统一个线程组的多个线程指向同一个signalhand_struct结构。&nbsp;&nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">static <span style="color:#ff0000;">int copy_signal<span style="color:#0000cc;">(unsigned long clone_flags<span style="color:#0000cc;">, struct task_struct <span style="color:#0000cc;">*tsk<span style="color:#0000cc;">)<br></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct signal_struct <span style="color:#0000cc;">*sig<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(clone_flags <span style="color:#0000cc;">&amp; <span>CLONE_THREAD<span style="color:#0000cc;">) //线程，直接返回，表明同一线程组共享<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sig <span style="color:#0000cc;">= kmem_cache_zalloc<span style="color:#0000cc;">(signal_cachep<span style="color:#0000cc;">, GFP_KERNEL<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;tsk<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal <span style="color:#0000cc;">= sig<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!sig<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000cc;">-ENOMEM<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;nr_threads <span style="color:#0000cc;">= 1<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;atomic_set<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;live<span style="color:#0000cc;">, 1<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;atomic_set<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sigcnt<span style="color:#0000cc;">, 1<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;init_waitqueue_head<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;wait_chldexit<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;curr_target <span style="color:#0000cc;">= tsk<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;。。。。<br></li> 
     <li> <span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> <br></li> 
     <li> static <span style="color:#ff0000;">int copy_sighand<span style="color:#0000cc;">(unsigned long clone_flags<span style="color:#0000cc;">, struct task_struct <span style="color:#0000cc;">*tsk<span style="color:#0000cc;">)<br></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct sighand_struct <span style="color:#0000cc;">*sig<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(clone_flags <span style="color:#0000cc;">&amp; <span>CLONE_SIGHAND<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atomic_inc<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sighand<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;count<span style="color:#0000cc;">)<span style="color:#0000cc;">; //如果发现是线程，直接讲引用计数++，无需分配sighand_struct结构 </span></span></span></span></span></span></span></span> </li> 
     <li> <span style="color:#5c5c5c;line-height:1.3;letter-spacing:.1px;">&nbsp; &nbsp; &nbsp; &nbsp; return 0<span style="line-height:1.3;letter-spacing:.1px;color:#0000cc;">; </span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;sig <span style="color:#0000cc;">= kmem_cache_alloc<span style="color:#0000cc;">(sighand_cachep<span style="color:#0000cc;">, GFP_KERNEL<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;rcu_assign_pointer<span style="color:#0000cc;">(tsk<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sighand<span style="color:#0000cc;">, sig<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!sig<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span style="color:#0000cc;">-ENOMEM<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;atomic_set<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;count<span style="color:#0000cc;">, 1<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;memcpy<span style="color:#0000cc;">(sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;action<span style="color:#0000cc;">, current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sighand<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;action<span style="color:#0000cc;">, sizeof<span style="color:#0000cc;">(sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;action<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return 0<span style="color:#0000cc;">;<br></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 这就基本实现了多线程应用中，信号处理程序是共享的，因为他们共用一个signalhand_struct。<br><span style="line-height:2;"> &nbsp; &nbsp; 上一篇博文提到，signal-&gt;shared_pending 和pending两个挂起信号相关的数据结构，此处我们可以具体讲解了。signal是线程组共享的结构，自然下属的shared_pending也是线程组共享的。就像POSIX提到的，kill/sigqueue发送信号，发送的对象并不是线程组某个特定的线程，而是整个线程组。自然，如果kernel会将信号记录在全线程组共享的signal-&gt;shared_pending,表示，线程组收到信号X一枚。<br><span style="line-height:2;"> &nbsp; &nbsp; 有筒子说了，我就要给某个特定的线程发信号，有没有办法，内核怎么办？这是个好问题。&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#0000ff;">&nbsp; int tkill<span style="color:#0000cc;">(<span style="color:#0000ff;">int tid<span style="color:#0000cc;">, <span style="color:#0000ff;">int sig<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;<span style="color:#0000ff;">int tgkill<span style="color:#0000cc;">(<span style="color:#0000ff;">int tgid<span style="color:#0000cc;">, <span style="color:#0000ff;">int tid<span style="color:#0000cc;">, <span style="color:#0000ff;">int sig<span style="color:#0000cc;">) </span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 这两个API是给线程组特定线程发信号的，毫不意外，内核会将信号记录在线程自己的结构pending中。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">pending <span style="color:#0000cc;">= group <span style="color:#0000cc;">? <span style="color:#0000cc;">&amp;t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;shared_pending <span style="color:#0000cc;">: <span style="color:#0000cc;">&amp;t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;pending<span style="color:#0000cc;">; </span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 对于kill/sigqueue，__send_signal传进来的是group是true，对于tkill/tgkill传进来的是false。会将信号写入相应的挂起信号位图。<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">static <span style="color:#ff0000;">int __send_signal<span style="color:#0000cc;">(<span style="color:#ff0000;">int sig<span style="color:#0000cc;">, struct siginfo <span style="color:#0000cc;">*info<span style="color:#0000cc;">, struct task_struct <span style="color:#0000cc;">*t<span style="color:#0000cc;">,<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int group<span style="color:#0000cc;">, <span style="color:#ff0000;">int from_ancestor_ns<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct sigpending <span style="color:#0000cc;">*pending<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct sigqueue <span style="color:#0000cc;">*q<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int override_rlimit<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int ret <span style="color:#0000cc;">= 0<span style="color:#0000cc;">, result<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;assert_spin_locked<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sighand<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;siglock<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;result <span style="color:#0000cc;">= TRACE_SIGNAL_IGNORED<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!prepare_signal<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, t<span style="color:#0000cc;">,<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_ancestor_ns <span style="color:#0000cc;">|<span style="color:#0000cc;">| <span style="color:#0000cc;">(info <span style="color:#0000cc;">=<span style="color:#0000cc;">= SEND_SIG_FORCED<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto ret<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> <span>&nbsp;&nbsp;&nbsp;&nbsp;pending <span style="color:#0000cc;">=<span> group <span style="color:#0000cc;">? <span style="color:#0000cc;">&amp;<span>t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>shared_pending <span style="color:#0000cc;">: <span style="color:#0000cc;">&amp;<span>t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>pending<span style="color:#0000cc;">; &nbsp; //&nbsp;tkill用的自己的pending， </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;kill/sigqueue用的线程组共享的signal-&gt;shared_pending </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* Short<span style="color:#0000cc;">-circuit ignored signals <span style="color:#0000ff;">and support queuing<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* exactly one non<span style="color:#0000cc;">-rt signal<span style="color:#0000cc;">, so that we can <span style="color:#0000ff;">get more<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* detailed information about the cause of the signal<span style="color:#0000cc;">.<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;result <span style="color:#0000cc;">= TRACE_SIGNAL_ALREADY_PENDING<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(legacy_queue<span style="color:#0000cc;">(pending<span style="color:#0000cc;">, sig<span style="color:#0000cc;">)<span style="color:#0000cc;">)<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto ret<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;result <span style="color:#0000cc;">= TRACE_SIGNAL_DELIVERED<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* fast<span style="color:#0000cc;">-pathed signals <span style="color:#0000ff;">for kernel<span style="color:#0000cc;">-internal things like SIGSTOP<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* <span style="color:#0000ff;">or SIGKILL<span style="color:#0000cc;">.<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(info <span style="color:#0000cc;">=<span style="color:#0000cc;">= SEND_SIG_FORCED<span style="color:#0000cc;">)<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto out_set<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* Real<span style="color:#0000cc;">-<span style="color:#ff0000;">time signals must be queued <span style="color:#0000ff;">if sent by sigqueue<span style="color:#0000cc;">, <span style="color:#0000ff;">or<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* some other real<span style="color:#0000cc;">-<span style="color:#ff0000;">time mechanism<span style="color:#0000cc;">. It <span style="color:#0000ff;">is implementation<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* defined whether kill<span style="color:#0000cc;">(<span style="color:#0000cc;">) does so<span style="color:#0000cc;">. We attempt <span style="color:#0000ff;">to <span style="color:#0000ff;">do so<span style="color:#0000cc;">, <span style="color:#0000ff;">on<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* the principle of least surprise<span style="color:#0000cc;">, but since kill <span style="color:#0000ff;">is <span style="color:#0000ff;">not<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* allowed <span style="color:#0000ff;">to fail with EAGAIN when low <span style="color:#0000ff;">on memory we just<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* make sure at least one signal gets delivered <span style="color:#0000ff;">and don<span style="color:#0000cc;">'t<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* pass <span style="color:#0000ff;">on the info struct<span style="color:#0000cc;">.<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(sig <span style="color:#0000cc;">&lt; SIGRTMIN<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;override_rlimit <span style="color:#0000cc;">= <span style="color:#0000cc;">(is_si_special<span style="color:#0000cc;">(info<span style="color:#0000cc;">) <span style="color:#0000cc;">|<span style="color:#0000cc;">| info<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;si_code <span style="color:#0000cc;">&gt;<span style="color:#0000cc;">= 0<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">else<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;override_rlimit <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;q <span style="color:#0000cc;">= __sigqueue_alloc<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, t<span style="color:#0000cc;">, GFP_ATOMIC <span style="color:#0000cc;">| __GFP_NOTRACK_FALSE_POSITIVE<span style="color:#0000cc;">,<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;override_rlimit<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(q<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_add_tail<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;list<span style="color:#0000cc;">, <span style="color:#0000cc;">&amp;pending<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;list<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch <span style="color:#0000cc;">(<span style="color:#0000cc;">(unsigned long<span style="color:#0000cc;">) info<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">(unsigned long<span style="color:#0000cc;">) SEND_SIG_NOINFO<span style="color:#0000cc;">:<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_signo <span style="color:#0000cc;">= sig<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_errno <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_code <span style="color:#0000cc;">= SI_USER<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_pid <span style="color:#0000cc;">= task_tgid_nr_ns<span style="color:#0000cc;">(current<span style="color:#0000cc;">,<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;task_active_pid_ns<span style="color:#0000cc;">(t<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_uid <span style="color:#0000cc;">= from_kuid_munged<span style="color:#0000cc;">(current_user_ns<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">, current_uid<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case <span style="color:#0000cc;">(unsigned long<span style="color:#0000cc;">) SEND_SIG_PRIV<span style="color:#0000cc;">:<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_signo <span style="color:#0000cc;">= sig<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_errno <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_code <span style="color:#0000cc;">= SI_KERNEL<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_pid <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_uid <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default<span style="color:#0000cc;">:<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy_siginfo<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">, info<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(from_ancestor_ns<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">.si_pid <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userns_fixup_signal_uid<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;q<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;info<span style="color:#0000cc;">, t<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">} <span style="color:#0000ff;">else <span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!is_si_special<span style="color:#0000cc;">(info<span style="color:#0000cc;">)<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(sig <span style="color:#0000cc;">&gt;<span style="color:#0000cc;">= SIGRTMIN <span style="color:#0000cc;">&amp;<span style="color:#0000cc;">&amp; info<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;si_code <span style="color:#0000cc;">!<span style="color:#0000cc;">= SI_USER<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* Queue overflow<span style="color:#0000cc;">, abort<span style="color:#0000cc;">. We may abort <span style="color:#0000ff;">if the<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* signal was rt <span style="color:#0000ff;">and sent by user using something<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* other than kill<span style="color:#0000cc;">(<span style="color:#0000cc;">)<span style="color:#0000cc;">.<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result <span style="color:#0000cc;">= TRACE_SIGNAL_OVERFLOW_FAIL<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret <span style="color:#0000cc;">= <span style="color:#0000cc;">-EAGAIN<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto ret<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">} <span style="color:#0000ff;">else <span style="color:#0000cc;">{<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* This <span style="color:#0000ff;">is a silent loss of information<span style="color:#0000cc;">. We still<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* send the signal<span style="color:#0000cc;">, but the <span style="color:#0000cc;">*info bits are lost<span style="color:#0000cc;">.<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result <span style="color:#0000cc;">= TRACE_SIGNAL_LOSE_INFO<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> out_set<span style="color:#0000cc;">:<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;signalfd_notify<span style="color:#0000cc;">(t<span style="color:#0000cc;">, sig<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span>sigaddset<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;<span>pending<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>signal<span style="color:#0000cc;">,<span> sig<span style="color:#0000cc;">)<span style="color:#0000cc;"><span>;//修改位图，表明该信号存在挂起信号。<br></span></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;complete_signal<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, t<span style="color:#0000cc;">, group<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> ret<span style="color:#0000cc;">:<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;trace_signal_generate<span style="color:#0000cc;">(sig<span style="color:#0000cc;">, info<span style="color:#0000cc;">, t<span style="color:#0000cc;">, group<span style="color:#0000cc;">, result<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return ret<span style="color:#0000cc;">;<br></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 线程存在一个很让人迷惑的问题，如何让线程组的所有线程一起退出。我们都知道，多线程的程序有一个线程访问了非法地址，引发段错误，会造成所有线程一起退出。这也是多线程程序脆弱的地方。但是如何做到的呢？<br><span style="line-height:2;"> &nbsp; &nbsp; do_signal---&gt;get_signal_to_deliver中，会选择信号，如果发现需要退出，会执行do_group_exit。这个名字顾名思义了，线程组退出。&nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">void<br></span> </li> 
     <li> do_group_exit<span style="color:#0000cc;">(<span style="color:#ff0000;">int exit_code<span style="color:#0000cc;">)<br></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct signal_struct <span style="color:#0000cc;">*sig <span style="color:#0000cc;">= current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;BUG_ON<span style="color:#0000cc;">(exit_code <span style="color:#0000cc;">&amp; 0x80<span style="color:#0000cc;">)<span style="color:#0000cc;">; <span style="color:#0000cc;">/<span style="color:#0000cc;">* core dumps don<span style="color:#0000cc;">'t <span style="color:#0000ff;">get here <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(signal_group_exit<span style="color:#0000cc;">(sig<span style="color:#0000cc;">)<span style="color:#0000cc;">)<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit_code <span style="color:#0000cc;">= sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_exit_code<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">else <span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!thread_group_empty<span style="color:#0000cc;">(current<span style="color:#0000cc;">)<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct sighand_struct <span style="color:#0000cc;">*<span style="color:#0000ff;">const sighand <span style="color:#0000cc;">= current<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sighand<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spin_lock_irq<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sighand<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;siglock<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(signal_group_exit<span style="color:#0000cc;">(sig<span style="color:#0000cc;">)<span style="color:#0000cc;">)<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* Another thread got here before we took the lock<span style="color:#0000cc;">. <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit_code <span style="color:#0000cc;">= sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_exit_code<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">else <span style="color:#0000cc;">{<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_exit_code <span style="color:#0000cc;">= exit_code<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;flags <span style="color:#0000cc;">= SIGNAL_GROUP_EXIT<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>zap_other_threads</strong><span style="color:#0000cc;">(current<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spin_unlock_irq<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;sighand<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;siglock<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;do_exit<span style="color:#0000cc;">(exit_code<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* NOTREACHED <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 如果是多线程，会走入到else中，主要的操作都在zap_other_threads函数中：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">* Nuke all other threads <span style="color:#0000ff;">in the group<span style="color:#0000cc;">.<br></span></span></span> </li> 
     <li> &nbsp;<span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> <span style="color:#ff0000;">int zap_other_threads<span style="color:#0000cc;">(struct task_struct <span style="color:#0000cc;">*p<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;struct task_struct <span style="color:#0000cc;">*t <span style="color:#0000cc;">= p<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int count <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;p<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;group_stop_count <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;while_each_thread<span style="color:#0000cc;">(p<span style="color:#0000cc;">, t<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;task_clear_jobctl_pending<span style="color:#0000cc;">(t<span style="color:#0000cc;">, JOBCTL_PENDING_MASK<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count<span style="color:#0000cc;">+<span style="color:#0000cc;">+<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* Don<span style="color:#0000cc;">'t bother with already dead threads <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;exit_state<span style="color:#0000cc;">)<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigaddset<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;t<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;pending<span style="color:#0000cc;">.signal<span style="color:#0000cc;">, SIGKILL<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signal_wake_up<span style="color:#0000cc;">(t<span style="color:#0000cc;">, 1<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return count<span style="color:#0000cc;">;<br></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 不多说了，就是给每一个线程都挂上一个SIGKILL的信号，当CPU选择线程执行时候的时候，自然会处理这个信号，而对SIGKILL的处理，会再次调用do_group_exit。这一次会调用do_exit退出。当线程组所有进程都执行过之后，整个线程组就消亡了。<br><span style="line-height:2;"> &nbsp;&nbsp;&nbsp;&nbsp;<br><span style="line-height:2;"> &nbsp; &nbsp; 讲完这些，需要讲block了。我第一篇就讲到，我们有时候需要阻塞某些信号。POSIX说了多线程中每个线程要有自己的阻塞信号。不必说，task_struct中的blocked就是阻塞信号位图。我们的glibc的sigprocmask函数，就是设置进程的blocked。<br><span style="line-height:2;"> &nbsp; &nbsp; 那些block的信号为何不能传递，内核是怎么做到的？<br><span style="line-height:2;"> &nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;<img src="https://yqfile.alicdn.com/img_407acc4e4fbafd57b86eb310e9161594.png" alt="" width="700" height="143"><br><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;"><span style="color:#ff0000;">int next_signal<span style="color:#0000cc;">(struct sigpending <span style="color:#0000cc;">*pending<span style="color:#0000cc;">, sigset_t <span style="color:#0000cc;">*mask<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;unsigned long i<span style="color:#0000cc;">, <span style="color:#0000cc;">*s<span style="color:#0000cc;">, <span style="color:#0000cc;">*m<span style="color:#0000cc;">, x<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int sig <span style="color:#0000cc;">= 0<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;s <span style="color:#0000cc;">= pending<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">.sig<span style="color:#0000cc;">;<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;m <span style="color:#0000cc;">= mask<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;sig<span style="color:#0000cc;">;<br></span></span></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">*<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* Handle the first word specially<span style="color:#0000cc;">: it contains the<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* synchronous signals that need <span style="color:#0000ff;">to be dequeued first<span style="color:#0000cc;">.<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;x <span style="color:#0000cc;">= <span style="color:#0000cc;">*s <span style="color:#0000cc;">&amp;<span style="color:#0000cc;">~ <span style="color:#0000cc;">*m<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(x<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(x <span style="color:#0000cc;">&amp; SYNCHRONOUS_MASK<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x <span style="color:#0000cc;">&amp;<span style="color:#0000cc;">= SYNCHRONOUS_MASK<span style="color:#0000cc;">;<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig <span style="color:#0000cc;">= ffz<span style="color:#0000cc;">(<span style="color:#0000cc;">~x<span style="color:#0000cc;">) <span style="color:#0000cc;">+ 1<span style="color:#0000cc;">;<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return sig<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;switch <span style="color:#0000cc;">(_NSIG_WORDS<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;default<span style="color:#0000cc;">:<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">for <span style="color:#0000cc;">(i <span style="color:#0000cc;">= 1<span style="color:#0000cc;">; i <span style="color:#0000cc;">&lt; _NSIG_WORDS<span style="color:#0000cc;">; <span style="color:#0000cc;">+<span style="color:#0000cc;">+i<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x <span style="color:#0000cc;">= <span style="color:#0000cc;">*<span style="color:#0000cc;">+<span style="color:#0000cc;">+s <span style="color:#0000cc;">&amp;<span style="color:#0000cc;">~ <span style="color:#0000cc;">*<span style="color:#0000cc;">+<span style="color:#0000cc;">+m<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!x<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig <span style="color:#0000cc;">= ffz<span style="color:#0000cc;">(<span style="color:#0000cc;">~x<span style="color:#0000cc;">) <span style="color:#0000cc;">+ i<span style="color:#0000cc;">*_NSIG_BPW <span style="color:#0000cc;">+ 1<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case 2<span style="color:#0000cc;">:<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x <span style="color:#0000cc;">= s<span style="color:#0000cc;">[1<span style="color:#0000cc;">] <span style="color:#0000cc;">&amp;<span style="color:#0000cc;">~ m<span style="color:#0000cc;">[1<span style="color:#0000cc;">]<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!x<span style="color:#0000cc;">)<br></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig <span style="color:#0000cc;">= ffz<span style="color:#0000cc;">(<span style="color:#0000cc;">~x<span style="color:#0000cc;">) <span style="color:#0000cc;">+ _NSIG_BPW <span style="color:#0000cc;">+ 1<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">case 1<span style="color:#0000cc;">:<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* <span style="color:#0000ff;">Nothing <span style="color:#0000ff;">to <span style="color:#0000ff;">do <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<span style="color:#0000cc;">;<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">}<br></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;return sig<span style="color:#0000cc;">;<br></span> </li> 
     <li> <span style="color:#0000cc;">} </span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; m就是task_struct中的blocked，阻塞的信号就不会不会被取出传递了。很有意思的一点是信号传递的顺序。在Linux programming interface一书中提到小signo优先的策略，比如SIGINT（2）和SIGQUIT（3）同时存在，SIGINT（2）&nbsp;先deliver，然后才是SIGQUIT（3）.我们看代码，很有意思的是有同步信号：<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText" style="line-height:2;">
    <ol>
     <li> <span style="color:#000000;">#define SYNCHRONOUS_MASK <span style="color:#0000cc;">\<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">(sigmask<span style="color:#0000cc;">(SIGSEGV<span style="color:#0000cc;">) <span style="color:#0000cc;">| sigmask<span style="color:#0000cc;">(SIGBUS<span style="color:#0000cc;">) <span style="color:#0000cc;">| sigmask<span style="color:#0000cc;">(SIGILL<span style="color:#0000cc;">) <span style="color:#0000cc;">| <span style="color:#0000cc;">\<br></span></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; sigmask<span style="color:#0000cc;">(SIGTRAP<span style="color:#0000cc;">) <span style="color:#0000cc;">| sigmask<span style="color:#0000cc;">(SIGFPE<span style="color:#0000cc;">) <span style="color:#0000cc;">| sigmask<span style="color:#0000cc;">(SIGSYS<span style="color:#0000cc;">)<span style="color:#0000cc;">) </span></span></span></span></span></span></span></span></span> </li> 
    </ol>
   </div> 
   <p> <span style="font-size:14px;"><span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <span style="line-height:2;">&nbsp; &nbsp; 有SIGSEGV SIGBUS SIGILL SIGTRAP SIGFPE SIGSYS，那么这几个信号优先。没有这几个信号，按照小信号优先。当然了，这些是Linux kernel的实现，毕竟不是POSIX标准，不可依赖这种顺序。<br><span style="line-height:2;"> &nbsp; &nbsp;另外，dequeue很有意思，先去task_struct中的pending中取，取不到再去整个线程组共享的shered_pending位图去取。<span style="line-height:2;"> &nbsp; &nbsp;<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div class="codeText"> 
    <ol style="line-height:2;">
     <li> <span style="color:#000000;"><span style="color:#ff0000;">int dequeue_signal<span style="color:#0000cc;">(struct task_struct <span style="color:#0000cc;">*tsk<span style="color:#0000cc;">, sigset_t <span style="color:#0000cc;">*mask<span style="color:#0000cc;">, siginfo_t <span style="color:#0000cc;">*info<span style="color:#0000cc;">)<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> <span style="color:#0000cc;">{<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">int signr<span style="color:#0000cc;">;<br></span></span> </li> 
     <li> <br></li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000cc;">/<span style="color:#0000cc;">* We only dequeue <span style="color:#0000ff;">private signals from ourselves<span style="color:#0000cc;">, we don<span style="color:#0000cc;">'t <span style="color:#0000ff;">let<br></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">* signalfd steal them<br></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#0000cc;">*<span style="color:#0000cc;">/<br></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;signr <span style="color:#0000cc;">= __dequeue_signal<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;tsk<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>pending<span style="color:#0000cc;">, mask<span style="color:#0000cc;">, info<span style="color:#0000cc;">)<span style="color:#0000cc;">;<br></span></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if <span style="color:#0000cc;">(<span style="color:#0000cc;">!signr<span style="color:#0000cc;">) <span style="color:#0000cc;">{<br></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signr <span style="color:#0000cc;">= __dequeue_signal<span style="color:#0000cc;">(<span style="color:#0000cc;">&amp;tsk<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;signal<span style="color:#0000cc;">-<span style="color:#0000cc;">&gt;<span>shared_pending<span style="color:#0000cc;">,<br></span></span></span></span></span></span></span></span></span> </li> 
     <li> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mask<span style="color:#0000cc;">, info<span style="color:#0000cc;">)<span style="color:#0000cc;">; </span></span></span> </li> 
    </ol>
    <div> 
     <span style="color:#0000cc;"><span style="line-height:12px;">&nbsp; &nbsp; &nbsp; &nbsp;。。。。<br> } </span></span> 
    </div> 
   </div> 
   <p> <span style="font-size:14px;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"><span style="line-height:2;"> <br> 参考文献:<br> 1<span style="font-size:14px;">&nbsp;<span style="font-family:'Trebuchet MS', Arial, Helvetica, sans-serif;line-height:normal;color:#105289;text-decoration:none;"><a style="font-family:'Trebuchet MS', Arial, Helvetica, sans-serif;font-size:2em;line-height:normal;color:#105289;text-decoration:none;" href="http://www.longene.org/forum/viewtopic.php?f=5&amp;t=94&amp;sid=22968b336b6436dccb540a6a0077dc84" rel="nofollow"><span style="font-size:14px;">L<span style="font-size:14px;">inux2.6内核中的线程组初探<br></span></span></a><span style="font-size:14px;">2 Linux kernel 3.8.0<span style="font-size:14px;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
