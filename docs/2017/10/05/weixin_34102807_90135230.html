<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>.NET互操作--基于C#的接口基础教程 « NotBeCN</title>
  <meta name="description" content="             地址：http://blog.163.com/mad010@126/blog/static/12237155200841645952814/                           [文章导读]                                      C#中...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/05/weixin_34102807_90135230.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">.NET互操作--基于C#的接口基础教程</h1>
    <p class="post-meta">Oct 5, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h3 style="font-size:16px;line-height:1.5;font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;"><span class="bgc0 fc07 fw0 fs0">地址：<a href="http://blog.163.com/mad010@126/blog/static/12237155200841645952814/" rel="nofollow" style="color:rgb(29,88,209);text-decoration:none;">http://blog.163.com/mad010@126/blog/static/12237155200841645952814/</a></span></h3> 
   <div class="bct fc05 fc11 nbw-blog ztag js-fs2"> 
    <table border="0" style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;width:220px;">
     <tbody>
      <tr>
       <td colspan="2" style="border:1px solid #C0C0C0;border-collapse:collapse;">[文章导读]</td>
      </tr>
      <tr>
       <td colspan="2" style="border:1px solid #C0C0C0;border-collapse:collapse;"></td>
      </tr>
      <tr>
       <td valign="top" colspan="2" style="border:1px solid #C0C0C0;border-collapse:collapse;">C#中不仅支持.Net 平台，而且支持COM平台。为了支持 COM和.Net，C# 包含一种称为属性的独特语言特性</td>
      </tr>
     </tbody>
    </table>
    <font><span style="font-size:12px;">第六节、接口转换</span></font> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　C#中不仅支持.Net 平台，而且支持COM平台。为了支持 COM和.Net，C# 包含一种称为属性的独特语言特性。一个属性实际上就是一个 C# 类，它通过修饰源代码来提供元信息。属性使 C# 能够支持特定的技术，如 COM 和 .Net，而不会干扰语言规范本身。C# 提供将COM接口转换为 C#接口的属性类。另一些属性类将 COM类转换为C# 类。执行这些转换不需要任何 IDL 或类工厂。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　现在部署的任何COM 组件都可以在接口转换中使用。通常情况下，所需的调整是完全自动进行的。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　特别是，可以使用运行时可调用包装 (RCW) 从 .NET 框架访问 COM 组件。此包装将 COM 组件提供的 COM 接口转换为与 .NET 框架兼容的接口。对于 OLE 自动化接口，RCW 可以从类型库中自动生成；对于非 OLE 自动化接口，开发人员可以编写自定义 RCW，手动将 COM 接口提供的类型映射为与 .NET 框架兼容的类型。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　使用ComImport引用COM组件</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">COM Interop 提供对现有 COM 组件的访问，而不需要修改原始组件。使用ComImport引用COM组件常包括下面 几个方面的问题：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、创建 COM 对象。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、确定 COM 接口是否由对象实现。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　3、调用 COM 接口上的方法。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　4、实现可由 COM 客户端调用的对象和接口。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　创建 COM 类包装</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　要使 C# 代码引用COM 对象和接口，需要在 C# 中包含 COM 接口的定义。完成此操作的最简单方法是使用 TlbImp.exe（类型库导入程序），它是一个包括在 .NET 框架 SDK 中的命令行工具。TlbImp 将 COM 类型库转换为 .NET 框架元数据，从而有效地创建一个可以从任何托管语言调用的托管包装。用 TlbImp 创建的 .NET 框架元数据可以通过 /R 编译器选项包括在 C# 内部版本中。如果使用 Visual Studio 开发环境，则只需添加对 COM 类型库的引用，将为您自动完成此转换。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　TlbImp 执行下列转换：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、COM coclass 转换为具有无参数构造函数的 C# 类。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、COM 结构转换为具有公共字段的 C# 结构。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　检查 TlbImp 输出的一种很好的方法是运行 .NET 框架 SDK 命令行工具 Ildasm.exe（Microsoft 中间语言反汇编程序）来查看转换结果。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　虽然 TlbImp 是将 COM 定义转换为 C# 的首选方法，但也不是任何时候都可以使用它（例如，在没有 COM 定义的类型库时或者 TlbImp 无法处理类型库中的定义时，就不能使用该方法）。在这些情况下，另一种方法是使用 C# 属性在 C# 源代码中手动定义 COM 定义。创建 C# 源映射后，只需编译 C# 源代码就可产生托管包装。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　执行 COM 映射需要理解的主要属性包括：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、ComImport：它将类标记为在外部实现的 COM 类。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、Guid：它用于为类或接口指定通用唯一标识符 (UUID)。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　3、InterfaceType，它指定接口是从 IUnknown 还是从 IDispatch 派生。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　4、PreserveSig，它指定是否应将本机返回值从 HRESULT 转换为 .NET 框架异常。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">声明 COM coclass</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　COM coclass 在 C# 中表示为类。这些类必须具有与其关联的 ComImport 属性。下列限制适用于这些类：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、类不能从任何其他类继承。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、类不能实现任何接口。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　4、类还必须具有为其设置全局唯一标识符 (GUID) 的 Guid 属性。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　以下示例在 C# 中声明一个 coclass：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">// 声明一个COM类 FilgraphManager <p></p> <p style="text-indent:2em;">[ComImport, Guid("E436EBB3-524F-11CE-9F53-0020AF0BA770")]</p> <p style="text-indent:2em;">class FilgraphManager</p> <p style="text-indent:2em;">{ }</p> </td>
      </tr>
     </tbody>
    </table>
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　C# 编译器将添加一个无参数构造函数，可以调用此构造函数来创建 COM coclass 的实例。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　创建 COM 对象</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　COM coclass 在 C# 中表示为具有无参数构造函数的类。使用 new 运算符创建该类的实例等效于在 C# 中调用 CoCreateInstance。使用以上定义的类，就可以很容易地实例化此类：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">class MainClass <p></p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">public static void Main()</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">FilgraphManager filg = new FilgraphManager();</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">}</p> </td>
      </tr>
     </tbody>
    </table>
    <font><span style="font-size:12px;">声明 COM coclass</span></font> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　COM coclass 在 C# 中表示为类。这些类必须具有与其关联的 ComImport 属性。下列限制适用于这些类：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、类不能从任何其他类继承。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、类不能实现任何接口。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　4、类还必须具有为其设置全局唯一标识符 (GUID) 的 Guid 属性。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　以下示例在 C# 中声明一个 coclass：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">// 声明一个COM类 FilgraphManager <p></p> <p style="text-indent:2em;">[ComImport, Guid("E436EBB3-524F-11CE-9F53-0020AF0BA770")]</p> <p style="text-indent:2em;">class FilgraphManager</p> <p style="text-indent:2em;">{ }</p> </td>
      </tr>
     </tbody>
    </table>
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　C# 编译器将添加一个无参数构造函数，可以调用此构造函数来创建 COM coclass 的实例。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　创建 COM 对象</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　COM coclass 在 C# 中表示为具有无参数构造函数的类。使用 new 运算符创建该类的实例等效于在 C# 中调用 CoCreateInstance。使用以上定义的类，就可以很容易地实例化此类：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">class MainClass <p></p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">public static void Main()</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">FilgraphManager filg = new FilgraphManager();</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">}</p> </td>
      </tr>
     </tbody>
    </table>
    <font><span style="font-size:12px;">下面是一个使用C# 映射媒体播放机COM 对象的程序。</span></font> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　程序清单2 DemonCOM.cs</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">using System; <p></p> <p style="text-indent:2em;">using System.Runtime.InteropServices;</p> <p style="text-indent:2em;">namespace QuartzTypeLib</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">//声明一个COM接口 IMediaControl，此接口来源于媒体播放机COM类</p> <p style="text-indent:2em;">[Guid("56A868B1-0AD4-11CE-B03A-0020AF0BA770"),</p> <p style="text-indent:2em;">InterfaceType(ComInterfaceType.InterfaceIsDual)]</p> <p style="text-indent:2em;">interface IMediaControl</p> <p style="text-indent:2em;">{ //列出接口成员</p> <p style="text-indent:2em;">void Run();</p> <p style="text-indent:2em;">void Pause();</p> <p style="text-indent:2em;">void Stop();</p> <p style="text-indent:2em;">void GetState( [In] int msTimeout, [Out] out int pfs);</p> <p style="text-indent:2em;">void RenderFile(</p> <p style="text-indent:2em;">[In, MarshalAs(UnmanagedType.BStr)] string strFilename);</p> <p style="text-indent:2em;">void AddSourceFilter(</p> <p style="text-indent:2em;">[In, MarshalAs(UnmanagedType.BStr)] string strFilename,</p> <p style="text-indent:2em;">[Out, MarshalAs(UnmanagedType.Interface)]</p> <p style="text-indent:2em;">out object ppUnk);</p> <p style="text-indent:2em;">[return: MarshalAs(UnmanagedType.Interface)]</p> <p style="text-indent:2em;">object FilterCollection();</p> <p style="text-indent:2em;">[return: MarshalAs(UnmanagedType.Interface)]</p> <p style="text-indent:2em;">object RegFilterCollection();</p> <p style="text-indent:2em;">void StopWhenReady();</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">//声明一个COM类:</p> <p style="text-indent:2em;">[ComImport, Guid("E436EBB3-524F-11CE-9F53-0020AF0BA770")]</p> <p style="text-indent:2em;">class FilgraphManager //此类不能再继承其它基类或接口</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">//这里不能有任何代码 ，系统自动增加一个缺省的构造函数</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">class MainClass</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">public static void Main(string[] args)</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">//命令行参数:</p> <p style="text-indent:2em;">if (args.Length != 1)</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">DisplayUsage();</p> <p style="text-indent:2em;">return;</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">String filename = args[0];</p> <p style="text-indent:2em;">if (filename.Equals("/?"))</p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">DisplayUsage();</p> <p style="text-indent:2em;">return;</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">// 声明FilgraphManager的实类对象：</p> <p style="text-indent:2em;">QuartzTypeLib.FilgraphManager graphManager =new QuartzTypeLib.FilgraphManager();</p> <p style="text-indent:2em;">//声明IMediaControl的实类对象：:</p> <p style="text-indent:2em;">QuartzTypeLib.IMediaControl mc =(QuartzTypeLib.IMediaControl)graphManager;</p> <p style="text-indent:2em;">// 调用COM的方法：</p> <p style="text-indent:2em;">mc.RenderFile(filename);</p> <p style="text-indent:2em;">//运行文件.</p> <p style="text-indent:2em;">mc.Run();</p> <p style="text-indent:2em;">//暂借停.</p> <p style="text-indent:2em;">Console.WriteLine("Press Enter to continue.");</p> <p style="text-indent:2em;">Console.ReadLine();</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">private static void DisplayUsage()</p> <p style="text-indent:2em;">{ // 显示</p> <p style="text-indent:2em;">Console.WriteLine("媒体播放机: 播放 AVI 文件.");</p> <p style="text-indent:2em;">Console.WriteLine("使用方法: VIDEOPLAYER.EXE 文件名");</p> <p style="text-indent:2em;">}</p> <p style="text-indent:2em;">}</p> </td>
      </tr>
     </tbody>
    </table>
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　运行示例：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　若要显示影片示例 Clock.avi，请使用以下命令：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">interop2 %windir%\clock.avi</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　这将在屏幕上显示影片，直到按 ENTER 键停止。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">在 .NET 框架程序中通过DllImport使用 Win32 API</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　.NET 框架程序可以通过静态 DLL 入口点的方式来访问本机代码库。DllImport 属性用于指定包含外部方法的实现的dll 位置。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　DllImport 属性定义如下：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">namespace System.Runtime.InteropServices <p></p> <p style="text-indent:2em;">{</p> <p style="text-indent:2em;">　[AttributeUsage(AttributeTargets.Method)]</p> <p style="text-indent:2em;">　public class DllImportAttribute: System.Attribute</p> <p style="text-indent:2em;">　{</p> <p style="text-indent:2em;">　　public DllImportAttribute(string dllName) {...}</p> <p style="text-indent:2em;">　　public CallingConvention CallingConvention;</p> <p style="text-indent:2em;">　　public CharSet CharSet;</p> <p style="text-indent:2em;">　　public string EntryPoint;</p> <p style="text-indent:2em;">　　public bool ExactSpelling;</p> <p style="text-indent:2em;">　　public bool PreserveSig;</p> <p style="text-indent:2em;">　　public bool SetLastError;</p> <p style="text-indent:2em;">　　public string Value { get {...} }</p> <p style="text-indent:2em;">　}</p> <p style="text-indent:2em;">}</p> </td>
      </tr>
     </tbody>
    </table>
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　说明：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　1、DllImport只能放置在方法声明上。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　2、DllImport具有单个定位参数：指定包含被导入方法的 dll 名称的 dllName 参数。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　3、DllImport具有五个命名参数：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　a、CallingConvention 参数指示入口点的调用约定。如果未指定 CallingConvention，则使用默认值 CallingConvention.Winapi。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　b、CharSet 参数指示用在入口点中的字符集。如果未指定 CharSet，则使用默认值 CharSet.Auto。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　c、EntryPoint 参数给出 dll 中入口点的名称。如果未指定 EntryPoint，则使用方法本身的名称。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　d、ExactSpelling 参数指示 EntryPoint 是否必须与指示的入口点的拼写完全匹配。如果未指定 ExactSpelling，则使用默认值 false。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　e、PreserveSig 参数指示方法的签名应当被保留还是被转换。当签名被转换时，它被转换为一个具有 HRESULT 返回值和该返回值的一个名为 retval 的附加输出参数的签名。如果未指定 PreserveSig，则使用默认值 true。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　　f、SetLastError 参数指示方法是否保留 Win32"上一错误"。如果未指定 SetLastError，则使用默认值 false。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　4、它是一次性属性类。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　5、此外，用 DllImport 属性修饰的方法必须具有 extern 修饰符。</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　下面是 C# 调用 Win32 MessageBox 函数的示例：</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"></p> 
    <table style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;border:1px solid #C0C0C0;border-collapse:collapse;">
     <tbody>
      <tr>
       <td style="border:1px solid #C0C0C0;border-collapse:collapse;">using System; <p></p> <p style="text-indent:2em;">using System.Runtime.InteropServices;</p> <p style="text-indent:2em;">class MainApp</p> <p style="text-indent:2em;">{ //通过DllImport引用user32.dll类。MessageBox来自于user32.dll类</p> <p style="text-indent:2em;">　[DllImport("user32.dll", EntryPoint="MessageBox")]</p> <p style="text-indent:2em;">　public static extern int MessageBox(int hWnd, String strMessage, String strCaption, uint uiType);</p> <p style="text-indent:2em;">　public static void Main()</p> <p style="text-indent:2em;">　{</p> <p style="text-indent:2em;">　　MessageBox( 0, "您好，这是 PInvoke！", ".NET", 0 );</p> <p style="text-indent:2em;">　}</p> <p style="text-indent:2em;">}</p> </td>
      </tr>
     </tbody>
    </table>
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;"></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;">　　面向对象的编程语言几乎都用到了抽象类这一概念，抽象类为实现抽象事物提供了更大的灵活性。C#也不例外, C#通过覆盖虚接口的技术深化了抽象类的应用。欲了解这方面的知识，请看下一节-覆盖虚接口</p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"><br></p> 
    <p style="font-family:Verdana, 'Lucida Grande', Arial, Helvetica, sans-serif;font-size:12px;text-indent:2em;"><br></p> 
    <p style="text-indent:2em;"><font><span style="font-size:12px;">本文转自Work Hard Work Smart博客园博客，原文链接：http://www.cnblogs.com/linlf03/archive/2011/10/11/2207538.html，如需转载请自行联系原作者</span></font><br></p> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
