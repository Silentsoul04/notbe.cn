<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>依赖注入那些事儿 « NotBeCN</title>
  <meta name="description" content="             在前面的话    昨天在博客园上看到一篇博文，名为“什么是依赖注入？（来听一个笑话）”[点击这里访问]。可以看出，作者是想以一种轻松幽默的方式对依赖注入的思想进行一个阐述。不过在读完文章后，个人觉得文章过于浅薄，没有真正将依赖注入的思想解释清楚，也没有深入的分析和具体的示例，所用比喻也有...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/19/weixin_34261739_90125348.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">依赖注入那些事儿</h1>
    <p class="post-meta">Oct 19, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <strong><em><font color="#0080c0">在前面的话</font></em></strong> 
   <p><span style="color:rgb(0,128,192);"><em>昨天在博客园上看到一篇博文，名为“什么是依赖注入？（来听一个笑话）”[</em></span><a href="http://www.cnblogs.com/imbob/archive/2009/06/12/1502119.html" rel="nofollow"><font color="#76923c"><em>点击这里访问</em></font></a><span style="color:rgb(0,128,192);"><em>]。可以看出，作者是想以一种轻松幽默的方式对依赖注入的思想进行一个阐述。不过在读完文章后，个人觉得文章过于浅薄，没有真正将依赖注入的思想解释清楚，也没有深入的分析和具体的示例，所用比喻也有点低俗（至少笔者读完文章后觉得胃里不是很舒服）。</em></span></p> 
   <p><em><span style="color:rgb(0,128,192);">但是，这篇博文启发了我。回想自己平常的学习和工作，依赖注入确实是软件架构和开发中一个十分重要的概念和技术，笔者参与的几乎每一个项目都用到了它，并且得到了很好的效果。于是，笔者萌发了写这篇文章的想法，意在将依赖注入这项概念本身结合笔者的实践经验及所感所想，做一个相对完整的综述，并总结于此文。一来可以和朋友们分享这项技术及个人心得，二来也是自己对这项技术做的一个总结。</span></em></p> 
   <p><strong><span style="font-size:medium;"><font>目录</font></span></strong></p> 
   <p>写在前面的话</p> 
   <p>目录</p> 
   <p>1 IGame游戏公司的故事</p> 
   <p>&nbsp;&nbsp;&nbsp; 1.1 讨论会</p> 
   <p>&nbsp;&nbsp;&nbsp; 1.2 实习生小李的实现方法</p> 
   <p>&nbsp;&nbsp;&nbsp; 1.3 架构师的建议</p> 
   <p>&nbsp;&nbsp;&nbsp; 1.4 小李的小结</p> 
   <p>2 探究依赖注入</p> 
   <p>&nbsp;&nbsp;&nbsp; 2.1 故事的启迪</p> 
   <p>&nbsp;&nbsp;&nbsp; 2.2 正式定义依赖注入</p> 
   <p>3 依赖注入那些事儿</p> 
   <p>&nbsp;&nbsp;&nbsp; 3.1 依赖注入的类别</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.1.1 Setter注入</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.1.2 Construtor注入</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.1.3 依赖获取</p> 
   <p>&nbsp;&nbsp;&nbsp; 3.2 反射与依赖注入</p> 
   <p>&nbsp;&nbsp;&nbsp; 3.3 多态的活性与依赖注入</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.3.1 多态性的活性</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.3.2 不同活性多态性依赖注入的选择</p> 
   <p>4 IoC Container</p> 
   <p>&nbsp;&nbsp;&nbsp; 4.1 IoC Container出现的必然性</p> 
   <p>&nbsp;&nbsp;&nbsp; 4.2 IoC Container的分类</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.2.1 高侵入度IoC Container</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.2.2 低侵入度IoC Container</p> 
   <p>&nbsp;&nbsp;&nbsp; 4.3 .NET平台上典型IoC Container推介</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.3.1 Spring.NET</p> 
   <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.3.2 Unity</p> 
   <p>参考文献</p> 
   <p><strong><span style="font-size:medium;"><font>1 IGame游戏公司的故事</font></span></strong></p> 
   <p><strong>1.1 讨论会</strong></p> 
   <p>话说有一个叫IGame的游戏公司，正在开发一款ARPG游戏（动作&amp;角色扮演类游戏，如魔兽世界、梦幻西游这一类的游戏）。一般这类游戏都有一个基本的功能，就是打怪（玩家攻击怪物，借此获得经验、虚拟货币和虚拟装备），并且根据玩家角色所装备的武器不同，攻击效果也不同。这天，IGame公司的开发小组正在开会对打怪功能中的某一个功能点如何实现进行讨论，他们面前的大屏幕上是这样一份需求描述的ppt：</p> 
   <p><img width="504" height="379" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/01_3.gif"></p> 
   <p align="center">图1.1 需求描述ppt</p> 
   <p>各个开发人员，面对这份需求，展开了热烈的讨论，下面我们看看讨论会上都发生了什么。</p> 
   <p><strong>1.2 实习生小李的实现方式</strong></p> 
   <p>在经过一番讨论后，项目组长Peter觉得有必要整理一下各方的意见，他首先询问小李的看法。小李是某学校计算机系大三学生，对游戏开发特别感兴趣，目前是IGame公司的一名实习生。</p> 
   <p>经过短暂的思考，小李阐述了自己的意见：</p> 
   <p>“我认为，这个需求可以这么实现。HP当然是怪物的一个属性成员，而武器是角色的一个属性成员，类型可以使字符串，用于描述目前角色所装备的武器。角色类有一个攻击方法，以被攻击怪物为参数，当实施一次攻击时，攻击方法被调用，而这个方法首先判断当前角色装备了什么武器，然后据此对被攻击怪物的HP进行操作，以产生不同效果。”</p> 
   <p>而在阐述完后，小李也飞快的在自己的电脑上写了一个Demo，来演示他的想法，Demo代码如下。</p> 
   <p><span style="color:rgb(0,128,128);">Code：怪物</span></p> 
   <div> 
    <div> 
     <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLi</pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// 怪物</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> Monster</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>         <span style="color:rgb(0,128,0);">/// 怪物的名字</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">public</span> String Name { get; set; }</pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>         <span style="color:rgb(0,128,0);">/// 怪物的生命值</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,0,255);">public</span> Int32 HP { get; set; }</pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,0,255);">public</span> Monster(String name,Int32 hp)</pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>             <span style="color:rgb(0,0,255);">this</span>.Name = name;</pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>             <span style="color:rgb(0,0,255);">this</span>.HP = hp;</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span> }</pre> 
     </div> 
    </div> 
    <p><span style="color:rgb(0,128,128);">Code：角色</span></p> 
    <div> 
     <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
      <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
      <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
      <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
      <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
      <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLi</pre> 
      <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
      <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// 角色</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> Role</pre> 
      <pre><span style="color:rgb(96,96,96);">  12:</span>     {</pre> 
      <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,0,255);">private</span> Random _random = <span style="color:rgb(0,0,255);">new</span> Random();</pre> 
      <pre><span style="color:rgb(96,96,96);">  14:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,128,0);">/// 表示角色目前所持武器的字符串</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  18:</span>         <span style="color:rgb(0,0,255);">public</span> String WeaponTag { get; set; }</pre> 
      <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,128,0);">/// 攻击怪物</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  22:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="monster"&gt;被攻击的怪物&lt;/param&gt;</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  24:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> Attack(Monster monster)</pre> 
      <pre><span style="color:rgb(96,96,96);">  25:</span>         {</pre> 
      <pre><span style="color:rgb(96,96,96);">  26:</span>             <span style="color:rgb(0,0,255);">if</span> (monster.HP &lt;= 0)</pre> 
      <pre><span style="color:rgb(96,96,96);">  27:</span>             {</pre> 
      <pre><span style="color:rgb(96,96,96);">  28:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"此怪物已死"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  29:</span>                 <span style="color:rgb(0,0,255);">return</span>;</pre> 
      <pre><span style="color:rgb(96,96,96);">  30:</span>             }</pre> 
      <pre><span style="color:rgb(96,96,96);">  31:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  32:</span>             <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,96,128);">"WoodSword"</span> == <span style="color:rgb(0,0,255);">this</span>.WeaponTag)</pre> 
      <pre><span style="color:rgb(96,96,96);">  33:</span>             {</pre> 
      <pre><span style="color:rgb(96,96,96);">  34:</span>                 monster.HP -= 20;</pre> 
      <pre><span style="color:rgb(96,96,96);">  35:</span>                 <span style="color:rgb(0,0,255);">if</span> (monster.HP &lt;= 0)</pre> 
      <pre><span style="color:rgb(96,96,96);">  36:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  37:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"已死亡"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  38:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  39:</span>                 <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  40:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  41:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"损失20HP"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  42:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  43:</span>             }</pre> 
      <pre><span style="color:rgb(96,96,96);">  44:</span>             <span style="color:rgb(0,0,255);">else</span> <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,96,128);">"IronSword"</span> == <span style="color:rgb(0,0,255);">this</span>.WeaponTag)</pre> 
      <pre><span style="color:rgb(96,96,96);">  45:</span>             {</pre> 
      <pre><span style="color:rgb(96,96,96);">  46:</span>                 monster.HP -= 50;</pre> 
      <pre><span style="color:rgb(96,96,96);">  47:</span>                 <span style="color:rgb(0,0,255);">if</span> (monster.HP &lt;= 0)</pre> 
      <pre><span style="color:rgb(96,96,96);">  48:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  49:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"已死亡"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  50:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  51:</span>                 <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  52:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  53:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"损失50HP"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  54:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  55:</span>             }</pre> 
      <pre><span style="color:rgb(96,96,96);">  56:</span>             <span style="color:rgb(0,0,255);">else</span> <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,96,128);">"MagicSword"</span> == <span style="color:rgb(0,0,255);">this</span>.WeaponTag)</pre> 
      <pre><span style="color:rgb(96,96,96);">  57:</span>             {</pre> 
      <pre><span style="color:rgb(96,96,96);">  58:</span>                 Int32 loss = (_random.NextDouble() &lt; 0.5) ? 100 : 200;</pre> 
      <pre><span style="color:rgb(96,96,96);">  59:</span>                 monster.HP -= loss;</pre> 
      <pre><span style="color:rgb(96,96,96);">  60:</span>                 <span style="color:rgb(0,0,255);">if</span> (200 == loss)</pre> 
      <pre><span style="color:rgb(96,96,96);">  61:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  62:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"出现暴击！！！"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  63:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  64:</span>&nbsp; </pre> 
      <pre><span style="color:rgb(96,96,96);">  65:</span>                 <span style="color:rgb(0,0,255);">if</span> (monster.HP &lt;= 0)</pre> 
      <pre><span style="color:rgb(96,96,96);">  66:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  67:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"已死亡"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  68:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  69:</span>                 <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  70:</span>                 {</pre> 
      <pre><span style="color:rgb(96,96,96);">  71:</span>                     Console.WriteLine(<span style="color:rgb(0,96,128);">"攻击成功！怪物"</span> + monster.Name + <span style="color:rgb(0,96,128);">"损失"</span> + loss + <span style="color:rgb(0,96,128);">"HP"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  72:</span>                 }</pre> 
      <pre><span style="color:rgb(96,96,96);">  73:</span>             }</pre> 
      <pre><span style="color:rgb(96,96,96);">  74:</span>             <span style="color:rgb(0,0,255);">else</span></pre> 
      <pre><span style="color:rgb(96,96,96);">  75:</span>             {</pre> 
      <pre><span style="color:rgb(96,96,96);">  76:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"角色手里没有武器，无法攻击！"</span>);</pre> 
      <pre><span style="color:rgb(96,96,96);">  77:</span>             }</pre> 
      <pre><span style="color:rgb(96,96,96);">  78:</span>         }</pre> 
      <pre><span style="color:rgb(96,96,96);">  79:</span>     }</pre> 
      <pre><span style="color:rgb(96,96,96);">  80:</span> }</pre> 
     </div> 
    </div> 
   </div> 
   <p><span style="color:rgb(0,128,128);">Code：测试代码</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLi</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">class</span> Program</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">void</span> Main(<span style="color:rgb(0,0,255);">string</span>[] args)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             <span style="color:rgb(0,128,0);">//生成怪物</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>             Monster monster1 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"小怪A"</span>, 50);</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             Monster monster2 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"小怪B"</span>, 50);</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>             Monster monster3 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"关主"</span>, 200);</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             Monster monster4 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"最终Boss"</span>, 1000);</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             <span style="color:rgb(0,128,0);">//生成角色</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             Role role = <span style="color:rgb(0,0,255);">new</span> Role();</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>             <span style="color:rgb(0,128,0);">//木剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             role.WeaponTag = <span style="color:rgb(0,96,128);">"WoodSword"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>             role.Attack(monster1);</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>             <span style="color:rgb(0,128,0);">//铁剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>             role.WeaponTag = <span style="color:rgb(0,96,128);">"IronSword"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span>             role.Attack(monster2);</pre> 
     <pre><span style="color:rgb(96,96,96);">  28:</span>             role.Attack(monster3);</pre> 
     <pre><span style="color:rgb(96,96,96);">  29:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  30:</span>             <span style="color:rgb(0,128,0);">//魔剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  31:</span>             role.WeaponTag = <span style="color:rgb(0,96,128);">"MagicSword"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  32:</span>             role.Attack(monster3);</pre> 
     <pre><span style="color:rgb(96,96,96);">  33:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  34:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  35:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  36:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  37:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  38:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  39:</span>             Console.ReadLine();</pre> 
     <pre><span style="color:rgb(96,96,96);">  40:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  41:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  42:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>程序运行结果如下：</p> 
   <p><img width="289" height="226" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/02_3.gif"></p> 
   <p align="center">图1.2 小李程序的运行结果</p> 
   <p><strong>1.3 架构师的建议</strong></p> 
   <p>小李阐述完自己的想法并演示了Demo后，项目组长Peter首先肯定了小李的思考能力、编程能力以及初步的面向对象分析与设计的思想，并承认小李的程序正确完成了需求中的功能。但同时，Peter也指出小李的设计存在一些问题，他请小于讲一下自己的看法。</p> 
   <p>小于是一名有五年软件架构经验的架构师，对软件架构、设计模式和面向对象思想有较深入的认识。他向Peter点了点头，发表了自己的看法：</p> 
   <p>“小李的思考能力是不错的，有着基本的面向对象分析设计能力，并且程序正确完成了所需要的功能。不过，这里我想从架构角度，简要说一下我认为这个设计中存在的问题。</p> 
   <p>首先，小李设计的Role类的Attack<span style="color:rgb(255,0,0);"><strong>方法很长</strong></span>，并且方法中有一个<span style="color:rgb(255,0,0);"><strong>冗长的if…else结构</strong></span>，且<span style="color:rgb(255,0,0);"><strong>每个分支的代码的业务逻辑很相似，只是很少的地方不同</strong></span>。</p> 
   <p>再者，我认为这个设计比较大的一个问题是，<span style="color:rgb(255,0,0);"><strong>违反了OCP原则</strong></span>。在这个设计中，如果以后我们增加一个新的武器，如倚天剑，每次攻击损失500HP，那么，我们就要打开Role，修改Attack方法。而<span style="color:rgb(255,0,0);"><strong>我们的代码应该是对修改关闭的，当有新武器加入的时候，应该使用扩展完成，避免修改已有代码</strong></span>。</p> 
   <p>一般来说，<span style="color:rgb(255,0,0);"><strong>当一个方法里面出现冗长的if…else或switch…case结构，且每个分支代码业务相似时，往往预示这里应该引入多态性来解决问题</strong></span>。而这里，如果把不同武器攻击看成一个策略，那么引入策略模式（Strategy Pattern）是明智的选择。</p> 
   <p>最后说一个小的问题，被攻击后，减<span style="color:rgb(255,0,0);"><strong>HP、死亡判断等都是怪物的职责</strong></span>，这里放在Role中有些不当。”</p> 
   <p><span style="color:rgb(255,128,64);"><em>Tip：OCP原则，即开放关闭原则，指设计应该对扩展开放，对修改关闭。</em></span></p> 
   <p><span style="color:rgb(255,128,64);"><em>Tip：策略模式，英文名Strategy Pattern，指定义算法族，分别封装起来，让他们之间可以相互替换，此模式使得算法的变化独立于客户。</em></span></p> 
   <p>小于边说，边画了一幅UML类图，用于直观表示他的思想。</p> 
   <p><img width="586" height="407" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/03_3.jpg"></p> 
   <p align="center">图1.3 小于的设计</p> 
   <p>Peter让小李按照小于的设计重构Demo，小李看了看小于的设计图，很快完成。相关代码如下：</p> 
   <p><span style="color:rgb(0,128,128);">Code：IAttackStrategy接口</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">interface</span> IAttackStrategy</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">void</span> AttackTarget(Monster monster);</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：木剑</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> WoodSword : IAttackStrategy</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> AttackTarget(Monster monster)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             monster.Notify(20);</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：铁剑</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> IronSword : IAttackStrategy</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> AttackTarget(Monster monster)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             monster.Notify(50);</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：魔剑</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> MagicSword : IAttackStrategy</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">private</span> Random _random = <span style="color:rgb(0,0,255);">new</span> Random();</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> AttackTarget(Monster monster)</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             Int32 loss = (_random.NextDouble() &lt; 0.5) ? 100 : 200;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>             <span style="color:rgb(0,0,255);">if</span> (200 == loss)</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"出现暴击！！！"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             monster.Notify(loss);</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：怪物</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// 怪物</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> Monster</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>         <span style="color:rgb(0,128,0);">/// 怪物的名字</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">public</span> String Name { get; set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>         <span style="color:rgb(0,128,0);">/// 怪物的生命值</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,0,255);">private</span> Int32 HP { get; set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>         <span style="color:rgb(0,0,255);">public</span> Monster(String name,Int32 hp)</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>             <span style="color:rgb(0,0,255);">this</span>.Name = name;</pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>             <span style="color:rgb(0,0,255);">this</span>.HP = hp;</pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  28:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  29:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  30:</span>         <span style="color:rgb(0,128,0);">/// 怪物被攻击时，被调用的方法，用来处理被攻击后的状态更改</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  31:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  32:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="loss"&gt;此次攻击损失的HP&lt;/param&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  33:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> Notify(Int32 loss)</pre> 
     <pre><span style="color:rgb(96,96,96);">  34:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  35:</span>             <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,0,255);">this</span>.HP &lt;= 0)</pre> 
     <pre><span style="color:rgb(96,96,96);">  36:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  37:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"此怪物已死"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  38:</span>                 <span style="color:rgb(0,0,255);">return</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  39:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  40:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  41:</span>             <span style="color:rgb(0,0,255);">this</span>.HP -= loss;</pre> 
     <pre><span style="color:rgb(96,96,96);">  42:</span>             <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,0,255);">this</span>.HP &lt;= 0)</pre> 
     <pre><span style="color:rgb(96,96,96);">  43:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  44:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"怪物"</span> + <span style="color:rgb(0,0,255);">this</span>.Name + <span style="color:rgb(0,96,128);">"被打死"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  45:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  46:</span>             <span style="color:rgb(0,0,255);">else</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  47:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  48:</span>                 Console.WriteLine(<span style="color:rgb(0,96,128);">"怪物"</span> + <span style="color:rgb(0,0,255);">this</span>.Name + <span style="color:rgb(0,96,128);">"损失"</span> + loss + <span style="color:rgb(0,96,128);">"HP"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  49:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  50:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  51:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  52:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：角色</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,128,0);">/// 角色</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> Role</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>         <span style="color:rgb(0,128,0);">/// 表示角色目前所持武器</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">public</span> IAttackStrategy Weapon { get; set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         <span style="color:rgb(0,128,0);">/// &lt;summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>         <span style="color:rgb(0,128,0);">/// 攻击怪物</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,128,0);">/// &lt;/summary&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>         <span style="color:rgb(0,128,0);">/// &lt;param name="monster"&gt;被攻击的怪物&lt;/param&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> Attack(Monster monster)</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>             <span style="color:rgb(0,0,255);">this</span>.Weapon.AttackTarget(monster);</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p><span style="color:rgb(0,128,128);">Code：测试代码</span></p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> IGameLiAdv</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">class</span> Program</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">void</span> Main(<span style="color:rgb(0,0,255);">string</span>[] args)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             <span style="color:rgb(0,128,0);">//生成怪物</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>             Monster monster1 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"小怪A"</span>, 50);</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             Monster monster2 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"小怪B"</span>, 50);</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>             Monster monster3 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"关主"</span>, 200);</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             Monster monster4 = <span style="color:rgb(0,0,255);">new</span> Monster(<span style="color:rgb(0,96,128);">"最终Boss"</span>, 1000);</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             <span style="color:rgb(0,128,0);">//生成角色</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             Role role = <span style="color:rgb(0,0,255);">new</span> Role();</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>             <span style="color:rgb(0,128,0);">//木剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             role.Weapon = <span style="color:rgb(0,0,255);">new</span> WoodSword();</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>             role.Attack(monster1);</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>             <span style="color:rgb(0,128,0);">//铁剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>             role.Weapon = <span style="color:rgb(0,0,255);">new</span> IronSword();</pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span>             role.Attack(monster2);</pre> 
     <pre><span style="color:rgb(96,96,96);">  28:</span>             role.Attack(monster3);</pre> 
     <pre><span style="color:rgb(96,96,96);">  29:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  30:</span>             <span style="color:rgb(0,128,0);">//魔剑攻击</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  31:</span>             role.Weapon = <span style="color:rgb(0,0,255);">new</span> MagicSword();</pre> 
     <pre><span style="color:rgb(96,96,96);">  32:</span>             role.Attack(monster3);</pre> 
     <pre><span style="color:rgb(96,96,96);">  33:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  34:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  35:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  36:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  37:</span>             role.Attack(monster4);</pre> 
     <pre><span style="color:rgb(96,96,96);">  38:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  39:</span>             Console.ReadLine();</pre> 
     <pre><span style="color:rgb(96,96,96);">  40:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  41:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  42:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>编译运行以上代码，得到的运行结果与上一版本代码基本一致。</p> 
   <p><strong>1.4 小李的小结</strong></p> 
   <p>Peter显然对改进后的代码比较满意，他让小李对照两份设计和代码，进行一个小结。小李简略思考了一下，并结合小于对一次设计指出的不足，说道：</p> 
   <p>“我认为，改进后的代码有如下优点：</p> 
   <p>第一，虽然类的数量增加了，但是每个类中方法的代码都非常短，没有了以前Attack方法那种很长的方法，也没有了冗长的if…else，<strong><span style="color:rgb(255,0,0);">代码结构变得很清晰</span></strong>。</p> 
   <p>第二，<span style="color:rgb(255,0,0);"><strong>类的职责更明确了</strong></span>。在第一个设计中，Role不但负责攻击，还负责给怪物减少HP和判断怪物是否已死。这明显不应该是Role的职责，改进后的代码将这两个职责移入Monster内，使得职责明确，提高了类的内聚性。</p> 
   <p>第三，引入Strategy模式后，不但<span style="color:rgb(255,0,0);"><strong>消除了重复性代码</strong></span>，更重要的是，<span style="color:rgb(255,0,0);"><strong>使得设计符合了OCP</strong></span>。如果以后要加一个新武器，只要新建一个类，实现IAttackStrategy接口，当角色需要装备这个新武器时，客户代码只要实例化一个新武器类，并赋给Role的Weapon成员就可以了，已有的Role和Monster代码都不用改动。这样就实现了对扩展开发，对修改关闭。”</p> 
   <p>Peter和小于听后都很满意，认为小李总结的非常出色。</p> 
   <p>IGame公司的讨论会还在进行着，内容是非常精彩，不过我们先听到这里，因为，接下来，我们要对其中某些问题进行一点探讨。别忘了，本文的主题可是依赖注入，这个主角还没登场呢！让主角等太久可不好。</p> 
   <p><strong><span style="font-size:medium;"><font>2 探究依赖注入</font></span></strong></p> 
   <p><strong>2.1 故事的启迪</strong></p> 
   <p>我们现在静下心来，再回味一下刚才的故事。因为，这个故事里面隐藏着依赖注入的出现原因。我说过不只一次，<span style="color:rgb(255,0,0);"><strong>想真正认清一个事物，不能只看“它是什么？什么样子？”，而应该先弄清楚“它是怎么来的？是什么样的需求和背景促使了它的诞生？它被创造出来是做什么用的？”。</strong></span></p> 
   <p>回想上面的故事。刚开始，主要需求是一个打怪的功能。小李做了一个初步面向对象的设计：抽取领域场景中的实体（怪物、角色等），封装成类，并为各个类赋予属性与方法，最后通过类的交互完成打怪功能，这应该算是面向对象设计的初级阶段。</p> 
   <p>在小李的设计基础上，架构师小于指出了几点不足，如不符合OCP，职责划分不明确等等，并根据情况引入策略模式。这是更高层次的面向对象设计。其实就核心来说，小于只做了一件事：<span style="color:rgb(255,0,0);"><strong>利用多态性，隔离变化</strong></span>。它清楚认识到，这个打怪功能中，有些业务逻辑是不变的，如角色攻击怪物，怪物减少HP，减到0怪物就会死；而变化的仅仅是不同的角色持有不同武器时，每次攻击的效用不一样。于是他的架构，本质就是把变化的部分和不变的部分隔离开，使得变化部分发生变化时，不变部分不受影响。</p> 
   <p>我们再仔细看看小于的设计图，这样设计后，有个基本的问题需要解决：现在Role不依赖具体武器，而仅仅依赖一个IAttackStrategy接口，接口是不能实例化的，虽然Role的Weapon成员类型定义为IAttackStrategy，但最终还是会被赋予一个实现了IAttackStrategy接口的具体武器，并且随着程序进展，一个角色会装备不同的武器，从而产生不同的效用。赋予武器的职责，在Demo中是放在了测试代码里。</p> 
   <p>这里，测试代码实例化一个具体的武器，并赋给Role的Weapon成员的过程，就是依赖注入！这里要清楚，依赖注入其实是一个过程的称谓！</p> 
   <p><strong>2.2 正式定义依赖注入</strong></p> 
   <p>下面，用稍微正式一点的语言，定义依赖注入产生的背景缘由和依赖注入的含义。在读的过程中，读者可以结合上面的例子进行理解。</p> 
   <p><em>依赖注入产生的背景：</em></p> 
   <p>随着面向对象分析与设计的发展，一个良好的设计，核心原则之一就是将变化隔离，使得变化部分发生变化时，不变部分不受影响（这也是OCP的目的）。为了做到这一点，要利用面向对象中的多态性，使用多态性后，客户类不再直接依赖服务类，而是依赖于一个抽象的接口，这样，客户类就不能在内部直接实例化具体的服务类。但是，客户类在运作中又客观需要具体的服务类提供服务，因为接口是不能实例化去提供服务的。就产生了“客户类不准实例化具体服务类”和“客户类需要具体服务类”这样一对矛盾。为了解决这个矛盾，开发人员提出了一种模式：<span style="text-decoration:underline;"><span style="color:rgb(255,0,0);"><strong>客户类（如上例中的Role）</strong></span></span>定义一个<span style="text-decoration:underline;"><span style="color:rgb(255,0,0);"><strong>注入点（Public成员Weapon），</strong></span></span>用于<span style="text-decoration:underline;"><span style="color:rgb(255,0,0);"><strong>服务类（实现IAttackStrategy的具体类，如WoodSword、IronSword和MagicSword，也包括以后加进来的所有实现IAttackStrategy的新类）</strong></span></span>的注入，而<span style="text-decoration:underline;"><span style="color:rgb(255,0,0);"><strong>客户类的客户类（Program，即测试代码）</strong></span></span>负责根据情况，实例化服务类，注入到客户类中，从而解决了这个矛盾。</p> 
   <p><em>依赖注入的正式定义：</em></p> 
   <p><span style="color:rgb(0,128,192);"><strong>依赖注入（Dependency Injection），是这样一个过程：由于某客户类只依赖于服务类的一个接口，而不依赖于具体服务类，所以客户类只定义一个注入点。在程序运行过程中，客户类不直接实例化具体服务类实例，而是客户类的运行上下文环境或专门组件负责实例化服务类，然后将其注入到客户类中，保证客户类的正常运行。</strong></span></p> 
   <p><span style="font-size:medium;"><strong><font>3 依赖注入那些事儿</font></strong></span></p> 
   <p>上面我们从需求背景的角度，讲述了依赖注入的来源和定义。但是，如果依赖注入仅仅就只有这么点东西，那也没有什么值得讨论的了。但是，上面讨论的仅仅是依赖注入的内涵，其外延还是非常广泛的，从依赖注入衍生出了很多相关的概念与技术，下面我们讨论一下依赖注入的“那些事儿”。</p> 
   <p>&nbsp;</p> 
   <p><strong>3.1 依赖注入的类别</strong></p> 
   <p>依赖注入有很多种方法，上面看到的例子中，只是其中的一种，下面分别讨论不同的依赖注入类型。</p> 
   <p><strong>3.1.1 Setter注入</strong></p> 
   <p>第一种依赖注入的方式，就是Setter注入，上面的例子中，将武器注入Role就是Setter注入。正式点说：</p> 
   <p><span style="color:rgb(0,128,192);"><strong>Setter注入（Setter Injection）是指在客户类中，设置一个服务类接口类型的数据成员，并设置一个Set方法作为注入点，这个Set方法接受一个具体的服务类实例为参数，并将它赋给服务类接口类型的数据成员。</strong></span></p> 
   <p><img width="566" height="352" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/04_6.jpg"></p> 
   <p align="center">图3.1 Setter注入示意</p> 
   <p>上图展示了Setter注入的结构示意图，客户类ClientClass设置IServiceClass类型成员_serviceImpl，并设置Set_ServiceImpl方法作为注入点。Context会负责实例化一个具体的ServiceClass，然后注入到ClientClass里。</p> 
   <p>下面给出Setter注入的示例代码。</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：IServiceClass</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> SetterInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">interface</span> IServiceClass</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         String ServiceInfo();</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：ServiceClassA</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> SetterInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">interface</span> IServiceClass</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         String ServiceInfo();</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：ServiceClassB</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> SetterInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">class</span> ServiceClassB : IServiceClass</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> String ServiceInfo()</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,96,128);">"我是ServceClassB"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：ClientClass</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> SetterInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">class</span> ClientClass</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">private</span> IServiceClass _serviceImpl;</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> Set_ServiceImpl(IServiceClass serviceImpl)</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             <span style="color:rgb(0,0,255);">this</span>._serviceImpl = serviceImpl;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> ShowInfo()</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             Console.WriteLine(_serviceImpl.ServiceInfo());</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：Context</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> SetterInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">class</span> Program</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">void</span> Main(<span style="color:rgb(0,0,255);">string</span>[] args)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             IServiceClass serviceA = <span style="color:rgb(0,0,255);">new</span> ServiceClassA();</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>             IServiceClass serviceB = <span style="color:rgb(0,0,255);">new</span> ServiceClassB();</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             ClientClass client = <span style="color:rgb(0,0,255);">new</span> ClientClass();</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             client.Set_ServiceImpl(serviceA);</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>             client.ShowInfo();</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             client.Set_ServiceImpl(serviceB);</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             client.ShowInfo();</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>运行结果如下：</p> 
   <p><img width="184" height="104" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/05_3.jpg"></p> 
   <p align="center">图3.2 Setter注入运行结果</p> 
   <p><strong>3.1.2 构造注入</strong></p> 
   <p>另外一种依赖注入方式，是通过客户类的构造函数，向客户类注入服务类实例。</p> 
   <p><span style="color:rgb(0,128,192);"><strong>构造注入（Constructor Injection）是指在客户类中，设置一个服务类接口类型的数据成员，并以构造函数为注入点，这个构造函数接受一个具体的服务类实例为参数，并将它赋给服务类接口类型的数据成员。</strong></span></p> 
   <p><img width="566" height="311" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/06_3.jpg"></p> 
   <p align="center">图3.3 构造注入示意</p> 
   <p>图3.3是构造注入的示意图，可以看出，与Setter注入很类似，只是注入点由Setter方法变成了构造方法。这里要注意，由于构造注入只能在实例化客户类时注入一次，所以一点注入，程序运行期间是没法改变一个客户类对象内的服务类实例的。</p> 
   <p>由于构造注入和Setter注入的IServiceClass，ServiceClassA和ServiceClassB是一样的，所以这里给出另外ClientClass类的示例代码。</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：ClientClass</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> ConstructorInjection</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">class</span> ClientClass</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">private</span> IServiceClass _serviceImpl;</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">public</span> ClientClass(IServiceClass serviceImpl)</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             <span style="color:rgb(0,0,255);">this</span>._serviceImpl = serviceImpl;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">void</span> ShowInfo()</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             Console.WriteLine(_serviceImpl.ServiceInfo());</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>可以看到，唯一的变化就是构造函数取代了Set_ServiceImpl方法，成为了注入点。</p> 
   <p><strong>3.1.3 依赖获取</strong></p> 
   <p>上面提到的注入方式，都是客户类被动接受所依赖的服务类，这也符合“注入”这个词。不过还有一种方法，可以和依赖注入达到相同的目的，就是以来获取。</p> 
   <p><strong><span style="color:rgb(0,128,192);">依赖获取（Dependency Locate）是指在系统中提供一个获取点，客户类仍然依赖服务类的接口。当客户类需要服务类时，从获取点主动取得制定的服务类，具体的服务类类型由获取点的配置决定。</span></strong></p> 
   <p>可以看到，这种方法这种方法变被动为主动，使得客户类在需要时主动获取服务类，而将多态性的实现封装到获取点里面。获取点可以有很多种实现，也许最容易想到的就是建立一个Simple Factory作为获取点，客户类传入一个指定字符串，以获取相应服务类实例。如果所依赖的服务类是一系列类，那么依赖获取一般利用Abstract Factory模式构建获取点，然后，将服务类多态性转移到工厂的多态性上，而工厂的类型依赖一个外部配置，如XML文件。</p> 
   <p>不过，不论使用Simple Factory还是Abstract Factory，都避免不了判断服务类类型或工厂类型，这样系统中总要有一个地方存在不符合OCP的if…else或swich…case结构，这种缺陷是Simple Factory和Abstract Factory以及依赖获取本身无法消除的，而在某些支持反射的语言中（如C#），通过将反射机制的引入彻底解决了这个问题（后面讨论）。</p> 
   <p>下面给一个具体的例子，现在我们假设有个程序，既可以使用Windows风格外观，又可以使用Mac风格外观，而内部业务是一样的。</p> 
   <p><img width="683" height="709" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/07_3.jpg"></p> 
   <p align="center">图3.4 依赖获取示意</p> 
   <p>上图乍看有点复杂，不过如果读者熟悉Abstract Factory模式，应该能很容易看懂，这就是Abstract Factory在实际中的一个应用。这里的Factory Container作为获取点，是一个静态类，它的“Type构造函数”依据外部的XML配置文件，决定实例化哪个工厂。下面还是来看示例代码。由于不同组件的代码是相似的，这里只给出Button组件的示例代码，完整代码请参考文末附上的完整源程序。</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：按钮接口</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">interface</span> IButton</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         String ShowInfo();</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：Windows风格按钮</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> WindowsButton : IButton</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> String Description { get; <span style="color:rgb(0,0,255);">private</span> set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">public</span> WindowsButton()</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             <span style="color:rgb(0,0,255);">this</span>.Description = <span style="color:rgb(0,96,128);">"Windows风格按钮"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,0,255);">public</span> String ShowInfo()</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">this</span>.Description;</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：Mac风格按钮</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> MacButton : IButton</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> String Description { get; <span style="color:rgb(0,0,255);">private</span> set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">public</span> MacButton()</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             <span style="color:rgb(0,0,255);">this</span>.Description = <span style="color:rgb(0,96,128);">" Mac风格按钮"</span>;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>         <span style="color:rgb(0,0,255);">public</span> String ShowInfo()</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">this</span>.Description;</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：工厂接口</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">interface</span> IFactory</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         IWindow MakeWindow();</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         IButton MakeButton();</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>         ITextBox MakeTextBox();</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：Windows组件工厂</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> WindowsFactory : IFactory</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> IWindow MakeWindow()</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> WindowsWindow();</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,0,255);">public</span> IButton MakeButton()</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> WindowsButton();</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,0,255);">public</span> ITextBox MakeTextBox()</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> WindowsTextBox();</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：Mac组件工厂</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">sealed</span> <span style="color:rgb(0,0,255);">class</span> MacFactory : IFactory</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">public</span> IWindow MakeWindow()</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> MacWindow();</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>         <span style="color:rgb(0,0,255);">public</span> IButton MakeButton()</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> MacButton();</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>         <span style="color:rgb(0,0,255);">public</span> ITextBox MakeTextBox()</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             <span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> MacTextBox();</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：获取点</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,0,255);">using</span> System.Xml;</pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">class</span> FactoryContainer</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> IFactory factory { get; <span style="color:rgb(0,0,255);">private</span> set; }</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,0,255);">static</span> FactoryContainer()</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>             XmlDocument xmlDoc = <span style="color:rgb(0,0,255);">new</span> XmlDocument();</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             xmlDoc.Load(<span style="color:rgb(0,96,128);">"http://www.cnblogs.com/Config.xml"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>             XmlNode xmlNode = xmlDoc.ChildNodes[1].ChildNodes[0].ChildNodes[0];</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,96,128);">"Windows"</span> == xmlNode.Value)</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>                 factory = <span style="color:rgb(0,0,255);">new</span> WindowsFactory();</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>             <span style="color:rgb(0,0,255);">else</span> <span style="color:rgb(0,0,255);">if</span> (<span style="color:rgb(0,96,128);">"Mac"</span> == xmlNode.Value)</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>                 factory = <span style="color:rgb(0,0,255);">new</span> MacFactory();</pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span>             <span style="color:rgb(0,0,255);">else</span></pre> 
     <pre><span style="color:rgb(96,96,96);">  28:</span>             {</pre> 
     <pre><span style="color:rgb(96,96,96);">  29:</span>                 <span style="color:rgb(0,0,255);">throw</span> <span style="color:rgb(0,0,255);">new</span> Exception(<span style="color:rgb(0,96,128);">"Factory Init Error"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  30:</span>             }</pre> 
     <pre><span style="color:rgb(96,96,96);">  31:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  32:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  33:</span> }</pre> 
    </div> 
   </div> 
   <div>
    <span style="color:rgb(0,128,128);">Code：测试代码</span>
   </div> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span>     <span style="color:rgb(0,0,255);">class</span> Program</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>         <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">void</span> Main(<span style="color:rgb(0,0,255);">string</span>[] args)</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>             IFactory factory = FactoryContainer.factory;</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>             IWindow window = factory.MakeWindow();</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>             Console.WriteLine(<span style="color:rgb(0,96,128);">"创建 "</span> + window.ShowInfo());</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>             IButton button = factory.MakeButton();</pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>             Console.WriteLine(<span style="color:rgb(0,96,128);">"创建 "</span> + button.ShowInfo());</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>             ITextBox textBox = factory.MakeTextBox();</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             Console.WriteLine(<span style="color:rgb(0,96,128);">"创建 "</span> + textBox.ShowInfo());</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>             Console.ReadLine();</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>这里我们用XML作为配置文件。配置文件Config.xml如下：</p> 
   <div> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">&lt;?</span><span style="color:rgb(128,0,0);">xml</span> <span style="color:rgb(255,0,0);">version</span><span style="color:rgb(0,0,255);">="1.0"</span> <span style="color:rgb(255,0,0);">encoding</span><span style="color:rgb(0,0,255);">="utf-8"</span> ?<span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">config</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span>     <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">factory</span><span style="color:rgb(0,0,255);">&gt;</span>Mac<span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">factory</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">config</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>可以看到，这里我们将配置设置为Mac风格，编译运行上述代码，运行结果如下：</p> 
   <p><img width="208" height="119" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/08_3.jpg"></p> 
   <p align="center">图3.5 配置Mac风格后的运行结果</p> 
   <p>现在，我们不动程序，仅仅将配置文件中的“Mac”改为Windows，运行后结果如下：</p> 
   <p><img width="207" height="107" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/09_3.jpg"></p> 
   <p align="center">图3.6 配置为Windows风格后的运行结果</p> 
   <p>从运行结果看出，我们仅仅通过修改配置文件，就改变了整个程序的行为（我们甚至没有重新编译程序），这就是多态性的威力，也是依赖注入效果。</p> 
   <p>本节共讨论了三种基本的依赖注入类别，有关更多依赖注入类别和不同类别对比的知识，可以参考Martin Fowler的《<a href="http://www.martinfowler.com/articles/injection.html" rel="nofollow"><font color="#76923c">Inversion of Control Containers and the Dependency Injection pattern</font></a>》。</p> 
   <p><strong>3.2 反射与依赖注入</strong></p> 
   <p>回想上面Dependency Locate的例子，我们虽然使用了多态性和Abstract Factory，但对OCP贯彻的不够彻底。在理解这点前，朋友们一定要注意潜在扩展在哪里，潜在会出现扩展的地方是“新的组件系列”而不是“组件种类”，也就是说，这里我们假设组件就三种，不会增加新的组件，但可能出现新的外观系列，如需要加一套Ubuntu风格的组件，我们可以新增UbuntuWindow、UbuntuButton、UbuntuTextBox和UbuntuFactory，并分别实现相应接口，这是符合OCP的，因为这是扩展。但我们除了修改配置文件，还要无可避免的修改FactoryContainer，需要加一个分支条件，这个地方破坏了OCP。依赖注入本身是没有能力解决这个问题的，但如果语言支持反射机制（Reflection），则这个问题就迎刃而解。</p> 
   <p>我们想想，现在的难点是出在这里：对象最终还是要通过“new”来实例化，而“new”只能实例化当前已有的类，如果未来有新类添加进来，必须修改代码。如果，我们能有一种方法，不是通过“new”，而是通过类的名字来实例化对象，那么我们只要将类的名字作为配置项，就可以实现在不修改代码的情况下，加载未来才出现的类。所以，反射给了语言“预见未来”的能力，使得多态性和依赖注入的威力大增。</p> 
   <p>下面是引入反射机制后，对上面例子的改进：</p> 
   <p><img width="487" height="670" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/10_3.jpg"></p> 
   <p align="center">图3.7 引入反射机制的Dependency Locate</p> 
   <p>可以看出，引入反射机制后，结构简单了很多，一个反射工厂代替了以前的一堆工厂，Factory Container也不需要了。而且以后有新组件系列加入时，反射工厂是不用改变的，只需改变配置文件就可以完成。下面给出反射工厂和配置文件的代码。</p> 
   <div> 
    <span style="color:rgb(0,128,128);">Code：反射工厂</span> 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">using</span> System;</pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;</pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span> <span style="color:rgb(0,0,255);">using</span> System.Linq;</pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span> <span style="color:rgb(0,0,255);">using</span> System.Text;</pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span> <span style="color:rgb(0,0,255);">using</span> System.Reflection;</pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">using</span> System.Xml;</pre> 
     <pre><span style="color:rgb(96,96,96);">   7:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">   8:</span> <span style="color:rgb(0,0,255);">namespace</span> DependencyLocate</pre> 
     <pre><span style="color:rgb(96,96,96);">   9:</span> {</pre> 
     <pre><span style="color:rgb(96,96,96);">  10:</span>     <span style="color:rgb(0,0,255);">internal</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(0,0,255);">class</span> ReflectionFactory</pre> 
     <pre><span style="color:rgb(96,96,96);">  11:</span>     {</pre> 
     <pre><span style="color:rgb(96,96,96);">  12:</span>         <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">static</span> String _windowType;</pre> 
     <pre><span style="color:rgb(96,96,96);">  13:</span>         <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">static</span> String _buttonType;</pre> 
     <pre><span style="color:rgb(96,96,96);">  14:</span>         <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">static</span> String _textBoxType;</pre> 
     <pre><span style="color:rgb(96,96,96);">  15:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  16:</span>         <span style="color:rgb(0,0,255);">static</span> ReflectionFactory()</pre> 
     <pre><span style="color:rgb(96,96,96);">  17:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  18:</span>             XmlDocument xmlDoc = <span style="color:rgb(0,0,255);">new</span> XmlDocument();</pre> 
     <pre><span style="color:rgb(96,96,96);">  19:</span>             xmlDoc.Load(<span style="color:rgb(0,96,128);">"http://www.cnblogs.com/Config.xml"</span>);</pre> 
     <pre><span style="color:rgb(96,96,96);">  20:</span>             XmlNode xmlNode = xmlDoc.ChildNodes[1].ChildNodes[0];</pre> 
     <pre><span style="color:rgb(96,96,96);">  21:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  22:</span>             _windowType = xmlNode.ChildNodes[0].Value;</pre> 
     <pre><span style="color:rgb(96,96,96);">  23:</span>             _buttonType = xmlNode.ChildNodes[1].Value;</pre> 
     <pre><span style="color:rgb(96,96,96);">  24:</span>             _textBoxType = xmlNode.ChildNodes[2].Value;</pre> 
     <pre><span style="color:rgb(96,96,96);">  25:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  26:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  27:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> IWindow MakeWindow()</pre> 
     <pre><span style="color:rgb(96,96,96);">  28:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  29:</span>             <span style="color:rgb(0,0,255);">return</span> Assembly.Load(<span style="color:rgb(0,96,128);">"DependencyLocate"</span>).CreateInstance(<span style="color:rgb(0,96,128);">"DependencyLocate."</span> + _windowType) <span style="color:rgb(0,0,255);">as</span> IWindow;</pre> 
     <pre><span style="color:rgb(96,96,96);">  30:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  31:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  32:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> IButton MakeButton()</pre> 
     <pre><span style="color:rgb(96,96,96);">  33:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  34:</span>             <span style="color:rgb(0,0,255);">return</span> Assembly.Load(<span style="color:rgb(0,96,128);">"DependencyLocate"</span>).CreateInstance(<span style="color:rgb(0,96,128);">"DependencyLocate."</span> + _buttonType) <span style="color:rgb(0,0,255);">as</span> IButton;</pre> 
     <pre><span style="color:rgb(96,96,96);">  35:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  36:</span>&nbsp; </pre> 
     <pre><span style="color:rgb(96,96,96);">  37:</span>         <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> ITextBox MakeTextBox()</pre> 
     <pre><span style="color:rgb(96,96,96);">  38:</span>         {</pre> 
     <pre><span style="color:rgb(96,96,96);">  39:</span>             <span style="color:rgb(0,0,255);">return</span> Assembly.Load(<span style="color:rgb(0,96,128);">"DependencyLocate"</span>).CreateInstance(<span style="color:rgb(0,96,128);">"DependencyLocate."</span> + _textBoxType) <span style="color:rgb(0,0,255);">as</span> ITextBox;</pre> 
     <pre><span style="color:rgb(96,96,96);">  40:</span>         }</pre> 
     <pre><span style="color:rgb(96,96,96);">  41:</span>     }</pre> 
     <pre><span style="color:rgb(96,96,96);">  42:</span> }</pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <div>
    配置文件如下： 
    <div style="color:#000000;line-height:12pt;font-family:consolas, 'Courier New', courier, monospace;font-size:8pt;"> 
     <pre><span style="color:rgb(96,96,96);">   1:</span> <span style="color:rgb(0,0,255);">&lt;?</span><span style="color:rgb(128,0,0);">xml</span> <span style="color:rgb(255,0,0);">version</span><span style="color:rgb(0,0,255);">="1.0"</span> <span style="color:rgb(255,0,0);">encoding</span><span style="color:rgb(0,0,255);">="utf-8"</span> ?<span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   2:</span> <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">config</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   3:</span>     <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">window</span><span style="color:rgb(0,0,255);">&gt;</span>MacWindow<span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">window</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   4:</span>     <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">button</span><span style="color:rgb(0,0,255);">&gt;</span>MacButton<span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">button</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   5:</span>     <span style="color:rgb(0,0,255);">&lt;</span><span style="color:rgb(128,0,0);">textBox</span><span style="color:rgb(0,0,255);">&gt;</span>MacTextBox<span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">textBox</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
     <pre><span style="color:rgb(96,96,96);">   6:</span> <span style="color:rgb(0,0,255);">&lt;/</span><span style="color:rgb(128,0,0);">config</span><span style="color:rgb(0,0,255);">&gt;</span></pre> 
    </div> 
   </div> 
   <p>&nbsp;</p> 
   <p>反射不仅可以与Dependency Locate结合，也可以与Setter Injection与Construtor Injection结合。<span style="color:rgb(255,0,0);"><strong>反射机制的引入，降低了依赖注入结构的复杂度，使得依赖注入彻底符合OCP，并为通用依赖注入框架（如Spring.NET中的IoC部分、Unity等）的设计提供了可能性。</strong></span></p> 
   <p><strong>3.3 多态的活性与依赖注入</strong></p> 
   <p><span style="text-decoration:underline;"><span style="color:rgb(128,0,255);"><strong>重要声明：3.3节内容中诸多术语（包括但不限于“多态活性”、“高活多态性”、“中活多态性”、“低活多态性”、“多态时间空间稳定”）与诸多理论思想（包括但不限于“多态活性定义”、“根据活性分类多态”、“根据活性选择依赖注入类型”）均为笔者原创，所以，特声明以下两点：一、由于笔者水平所限，不保证其完全正确性和严格性，与前面诸多成熟理论相比，请批判性阅读；二、由于此节中诸多概念与思想理论已纳入笔者论文素材范畴，作为笔者原创成果，受法律保护。任何单位和个人不得擅自将此节内容部分或全部抄袭、改造、重新叙述成文进行公开发表。否则，笔者保留追究法律责任的权利。</strong></span></span></p> 
   <p><strong>3.3.1 多态性的活性</strong></p> 
   <p>这一节我们讨论多态的活性及其与依赖注入类型选择间密切的关系。</p> 
   <p>首先说明，“多态的活性”这个术语是我个人定义的，因为我没有找到既有的概念名词可以表达我的意思，所以就自己造了一个词。这里，<strong><span style="color:rgb(0,128,192);">某多态的活性是指被此多态隔离的变化所发生变化的频繁程度，频繁程度越高，则活性越强，反之亦然。</span></strong></p> 
   <p>上文说过，多态性可以隔离变化，但是，不同的变化，发生的频率是不一样的，这就使得多态的活性有所差别，这种差别影响了依赖注入的类型选择。</p> 
   <p>举例来说，本文最开始提到的武器多态性，其活性非常高，因为在那个程序中，Role在一次运行中可能更换多次武器。而现在我们假设Role也实现了多态性，这是很可能的，因为在游戏中，不同类型的角色（如暗夜精灵、牛头人、矮人等）很多属性和业务是想通的，所以很可能通过一个IRole或AbstractRole抽象类实现多态性，不过，Role在实例化后（一般在用户登录成功后），是不会变化的，很少有游戏允许同一个玩家在运行中变换Role类型，所以Role应该是一但实例化，就不会变化，但如果再实例化一个（如另一个玩家登录），则可能就变化了。最后，还有一种多态性是活性非常低的，如我们熟悉的数据访问层多态性，即使我们实现了SQL Server、Oracle和Access等多种数据库的访问层，并实现了依赖注入，但几乎遇不到程序运行着就改数据库或短期内数据库频繁变动的情况。</p> 
   <p>以上不同的多态性，不但特征不同，其目的一般也不同，总结如下：</p> 
   <p><span style="color:rgb(0,128,192);"><strong>高活多态性——指在客户类实例运行期间，服务类可能会改变的多态性。</strong></span></p> 
   <p><span style="color:rgb(0,128,192);"><strong>中活多态性——指在客户类实例化后，服务类不会改变，但同一时间内存在的不同实例可能拥有不同类型的服务类。</strong></span></p> 
   <p><span style="color:rgb(0,128,192);"><strong>低活多态性——指在客户类实例化后，服务类不会改变，且同一时间内所有客户类都拥有相同类型的服务类。</strong></span></p> 
   <p>以上三种多态性，比较好的例子就是上文提到的武器多态性（高活）、角色多态性（中活）和数据访问层多态性（低活）。另外，<strong><span style="color:rgb(0,128,192);">我们说一种多态性是空间稳定的，如果同一客户类在同一时间内的所有实例都依赖相同类型的服务类，反之则叫做空间不稳定多态性。<strong><span style="color:rgb(0,128,192);">我们说一种多态性是时间稳定的，如果一个客户类在实例化后，所以来的服务类不能再次更改，反之则叫做时间不稳定多态性。</span></strong></span></strong>显然，高活多态性时间和空间均不稳定；中活多态性是时间稳定的，但空间不稳定；低活多态性时间空间均稳定。</p> 
   <p><strong>3.3.2 不同活性多态的依赖注入选择</strong></p> 
   <p>一般来说，<span style="color:rgb(255,0,0);"><strong>高活多态性适合使用Setter注入。</strong></span>因为Setter注入最灵活，也是唯一允许在同一客户类实例运行期间更改服务类的注入方式。并且这种注入一般由上下文环境通过Setter的参数指定服务类类型，方便灵活，适合频繁变化的高活多态性。</p> 
   <p><span style="color:rgb(255,0,0);"><strong>对于中活多态性，则适合使用Constructor注入。</strong></span>因为Constructor注入也是由上下文环境通过Construtor的参数指定服务类类型，但一点客户类实例化后，就不能进行再次注入，保证了其时间稳定性。</p> 
   <p><span style="color:rgb(255,0,0);"><strong>而对于低活多态性，则适合使用Dependency Locate并配合文件配置进行依赖注入，或Setter、Constructor配合配置文件注入，</strong></span>因为依赖源来自文件，如果要更改服务类，则需要更改配置文件，一则确保了低活多态性的时间和空间稳定性，二是更改配置文件的方式方便于大规模服务类替换。（因为低活多态性一旦改变行为，往往规模很大，如替换整个数据访问层，如果使用Setter和Construtor传参，程序中需要改变的地方不计其数）</p> 
   <p>本质上，这种选择是因为不同的依赖注入类型有着不同的稳定性，大家可以细细体会“活性”、“稳定性”和“依赖注入类型”之间密切的关系。</p> 
   <p><span style="font-size:medium;"><strong><font>4 IoC Container</font></strong></span></p> 
   <p><strong>4.1 IoC Container出现的必然性</strong></p> 
   <p>上面讨论了诸多依赖注入的话题。说道依赖注入，就不能不说IoC Container（IoC容器），那么到底上面是IoC容器？我们还是先来看看它的出现背景。</p> 
   <p>我们知道，软件开发领域有句著名的论断：不要重复发明轮子！因为软件开发讲求复用，所以，对于应用频繁的需求，总是有人设计各种通用框架和类库以减轻人们的开发负担。例如，数据持久化是非常频繁的需求，于是各种ORM框架应运而生；再如，对MVC的需求催生了Struts等一批用来实现MVC的框架。</p> 
   <p>随着面向对象分析与设计的发展和成熟，OOA&amp;D被越来越广泛应用于各种项目中，然而，我们知道，用OO就不可能不用多态性，用多态性就不可能不用依赖注入，所以，依赖注入变成了非常频繁的需求，而如果全部手工完成，不但负担太重，而且还容易出错。再加上反射机制的发明，于是，自然有人开始设计开发各种用于依赖注入的专用框架。<span style="color:rgb(0,128,192);"><strong>这些专门用于实现依赖注入功能的组件或框架，就是IoC Container。</strong></span></p> 
   <p>从这点看，IoC Container的出现有其历史必然性。目前，最著名的IoC也许就是Java平台上的Spring框架的IoC组件，而.NET平台上也有Spring.NET和Unity等。</p> 
   <p><strong>4.2 IoC Container的分类</strong></p> 
   <p>前面曾经讨论了三种依赖注入方式，但是，想通过方式对IoC Container进行分类很困难，因为现在IoC Container都设计很完善，几乎支持所有依赖注入方式。不过，根据不同框架的特性和惯用法，还是可以讲IoC Container分为两个大类。</p> 
   <p><strong>4.2.1 高侵入度IoC Container</strong></p> 
   <p>所谓高侵入度IoC Container，是指一般用外部配置文件（一般是XML）作为依赖源，并托管整个系统各个类的实例化的IoC Container。这种IoC Container，一般是承接了整个系统几乎所有多态性的依赖注入工作，并承接了所有服务类的实例化工作，而且这些实例化依赖于一个外部配置文件，这种IoC Container，很像通过一个文件，定义整个系统多态结构，其侵入度高，视野宏大，想要很好驾驭这种IoC Container，需要一定的架构设计能力和丰富的实践经验。</p> 
   <p>Spirng和Spring.NET是高侵入度IoC Container的例子。一般来说，这种IoC Container稳定性有余而活性不足，适合进行低活多态性的依赖注入。</p> 
   <p><strong>4.2.2 低侵入度IoC Container</strong></p> 
   <p>还有一种IoC Container，一般不依赖外部配置文件，而主要使用传参的Setter或Construtor注入，这种IoC Container叫做低侵入度IoC Container。这种框架很灵活，但往往不稳定，而且依赖点都是程序中的字符串参数，所以，不适合需要大规模替换和相对稳定的低活多态性，而对于高活多态性，有很好的效果。</p> 
   <p>Unity是一个典型的低侵入度IoC Container。</p> 
   <p><strong>4.3 .NET平台上典型IoC Container推介</strong></p> 
   <p><strong>4.3.1 Spring.NET</strong></p> 
   <p><img width="275" height="88" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/11_3.png"></p> 
   <p>Spring.NET是Java平台上Spring对.NET平台的移植，使用方法和Spring很像，并且功能强大，是.NET平台上大中型开发IoC Container的首选之一。除了DI外，Spring.NET也包括AOP等诸多功能。</p> 
   <p>Spring.NET的官方网站是：<a title="http://www.springframework.net/" href="http://www.springframework.net/" rel="nofollow"><font color="#76923c">http://www.springframework.net/</font></a></p> 
   <p><strong>4.3.2 Unity</strong></p> 
   <p><img width="326" height="91" style="border-width:0px;margin-left:auto;" alt="" src="https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/a5703ca6e7d5_D180/12_3.gif"></p> 
   <p>对于小型项目和讲求敏捷的团队，Spring.NET可能有点太重量级，那么可以选择轻量级的Unity。Unity是微软patterns &amp; practices团队推出的轻量级框架，非常好用，目前最新版本是1.2。</p> 
   <p>Unity的官方网站是：<a title="http://unity.codeplex.com/" href="http://unity.codeplex.com/" rel="nofollow"><font color="#76923c">http://unity.codeplex.com/</font></a></p> 
   <p>&nbsp;</p> 
   <p><strong>参考文献</strong></p> 
   <p>[1]&nbsp; Shivprasad koirala, Design pattern – Inversion of control and Dependency injection, <a title="http://www.codeproject.com/KB/aspnet/IOCDI.aspx" href="http://www.codeproject.com/KB/aspnet/IOCDI.aspx" rel="nofollow"><font color="#76923c">http://www.codeproject.com/KB/aspnet/IOCDI.aspx</font></a></p> 
   <p>[2]&nbsp; Martin Fowler, Inversion of Control Containers and the Dependency Injection pattern, <a title="http://www.martinfowler.com/articles/injection.html" href="http://www.martinfowler.com/articles/injection.html" rel="nofollow"><font color="#76923c">http://www.martinfowler.com/articles/injection.html</font></a></p> 
   <p>[3]&nbsp; Paul, IoC Types, <a title="http://docs.codehaus.org/display/PICO/IoC+Types" href="http://docs.codehaus.org/display/PICO/IoC+Types" rel="nofollow"><font color="#76923c">http://docs.codehaus.org/display/PICO/IoC+Types</font></a></p> 
   <p>[4]&nbsp; Eric Freeman, Elisabeth Freeman. Head First Design Patterns. O’Reilly Media, 2004. ISBN 0596007142</p> 
   <p>[5]&nbsp; Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides. Design Patterns: Elements of Reusable Object-Oriented Software. Addison-Wesley, 1995. ISBN 0201633612</p> 
   <p>[6]&nbsp; Patrick Smacchia 著，施凡等 译，C#和.NET2.0 平台、语言与框架。2008.1，人民邮电出版</p> 
   <p>[7]&nbsp; Jeffrey Rechter 著，CLR via C#（影印版）。2008.8，人民邮电出版</p> 
   <p>&nbsp;原文地址:<a href="http://www.cnblogs.com/leoo2sk/archive/2009/06/17/1504693.html" rel="nofollow">http://www.cnblogs.com/leoo2sk/archive/2009/06/17/1504693.html</a></p> 
   <p>&nbsp;</p> 
   <p>&nbsp;</p> 
   <p>本文转自温景良(Jason)博客园博客，原文链接：<a href="http://www.cnblogs.com/wenjl520/archive/2009/06/17/1504696.html" rel="nofollow">http://www.cnblogs.com/wenjl520/archive/2009/06/17/1504696.html</a>，如需转载请自行联系原作者</p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
