<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>iOS：WebKit内核框架的应用与解析 « NotBeCN</title>
  <meta name="description" content="                  原文：http://www.cnblogs.com/fengmin/p/5737355.html     一、摘要：     WebKit是iOS8之后引入的专门负责处理网页视图的框架，其比UIWebView更加强大，性能也更优。     二、引言：           在iO...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/11/weixin_33961829_90129316.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">iOS：WebKit内核框架的应用与解析</h1>
    <p class="post-meta">Oct 11, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"> 
    <p><span style="line-height:1.8;font-size:18px;font-family:'楷体';">原文：<a href="http://www.cnblogs.com/fengmin/p/5737355.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom-width:1px;border-bottom-style:dotted;border-bottom-color:rgb(51,51,51);">http://www.cnblogs.com/fengmin/p/5737355.html</a><br></span></p> 
    <h1 style="color:rgb(0,0,0);line-height:1.5;font-size:28px;"><span style="line-height:1.8;font-size:18px;font-family:'楷体';">一、摘要：</span></h1> 
    <p><span style="line-height:1.8;font-size:18px;font-family:'楷体';">WebKit是iOS8之后引入的专门负责处理网页视图的框架，其比UIWebView更加强大，性能也更优。</span></p> 
    <h1 style="color:rgb(0,0,0);line-height:1.5;font-size:28px;"><span style="line-height:1.8;font-size:18px;font-family:'楷体';">二、引言：</span></h1> 
    <div class="tc-card-imagetext-text"> 
     <p><span style="line-height:1.8;font-size:18px;font-family:'楷体';">在iOS8之前，在应用中嵌入网页通常需要使用UIWebView这样一个类，这个类通过URL或者HTML文件来加载网页视图，功能十分有限，只能作为辅助嵌入原生应用程序中。虽然UIWebView也可以做原生与JavaScript交互的相关处理，然而也有很大的局限性，JavaScript要调用原生方法通常需要约定好协议之后通过Request来传递。WebKit框架中添加了一些原生与JavaScript交互的方法，增强了网页视图与原生的交互能力。并且WebKit框架中采用导航堆栈的模型来管理网页的跳转，开发者也可以更加容易的控制和管理网页的渲染。</span></p> 
     <h1 style="color:rgb(0,0,0);line-height:1.5;font-size:28px;"><span style="line-height:1.8;font-size:18px;font-family:'楷体';">三、WebKit框架概览：</span></h1> 
     <div class="tc-card-imagetext-text"> 
      <p><span style="line-height:1.8;font-size:18px;font-family:'楷体';">WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化，开发者在使用时可以轻松的写出结构清晰的代码。在进行使用前，我们首先应该清楚整个框架的结构和开发思路，下面一张脑图中基本列出了WebKit框架中所涉及到的所有重要的类以及他们之间的相互关系：</span></p> 
      <p><span style="line-height:1.8;font-size:18px;"><img src="https://images2015.cnblogs.com/blog/791499/201609/791499-20160916140254602-1153140056.png" alt="" style="border:0px;"></span></p> 
      <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">如上图所示，WebKit框架中最核心的类应该属于WKWebView了，这个类专门用来渲染网页视图，其他类和协议都将基于它和服务于它。</span></p> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKWebView：网页的渲染与展示，通过WKWebViewConfiguration可以进行配置。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKWebViewConfiguration：这个类专门用来配置WKWebView。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKPreference:这个类用来进行M相关设置。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKProcessPool：这个类用来配置进程池，与网页视图的资源共享有关。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKUserContentController：这个类主要用来做native与JavaScript的交互管理。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKUserScript：用于进行JavaScript注入。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKScriptMessageHandler：这个类专门用来处理JavaScript调用native的方法。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKNavigationDelegate：网页跳转间的导航管理协议，这个协议可以监听网页的活动。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKNavigationAction：网页某个活动的示例化对象。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKUIDelegate：用于交互处理JavaScript中的一些弹出框。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKBackForwardList：堆栈管理的网页列表。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKBackForwardListItem：每个网页节点对象。</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">使用WKWebViewConfiguration对WebView进行配置：</span></p> 
      </div> 
      <div class="tc-card-imagetext-text"> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">使用下面的代码可以创建一个WKWebView视图，创建WebView视图时，需要使用WKWebViewConfiguration来进行配置。</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;"> webkit内核中的网页视图，类似于UIWebView</span>
WKWebView *<span style="line-height:1.8;font-size:12px;"> WK; WKWebViewConfiguration </span>* config =<span style="line-height:1.8;font-size:12px;"> [[WKWebViewConfiguration alloc]init]; WK </span>= [[WKWebView alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);font-size:12px;">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);font-size:12px;">0</span>, self.view.frame.size.width, self.view.frame.size.height-<span style="line-height:1.8;color:rgb(128,0,128);font-size:12px;">40</span><span style="line-height:1.8;font-size:12px;">) configuration:config]; [WK loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">http://www.baidu.com</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span>]]];</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKWebViewConfiguration中可以进行配置的方法和属性如下：</span></p> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">1、WKProcessPool类中没有暴露任何属性和方法，配置为同一个进程池的WebView会共享数据，例如Cookie、用户凭证等，开发者可以通过编写管理类来分配不同维度的WebView在不同进程池中。</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置进程池</span>
WKProcessPool * pool =<span style="line-height:1.8;font-size:12px;"> [[WKProcessPool alloc]init]; config.processPool </span>= pool;</span></pre>
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">2、WKPerference实例为WebView提供一个偏好设置。</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">进行偏好设置</span>
WKPreferences * preference =<span style="line-height:1.8;font-size:12px;"> [[WKPreferences alloc]init]; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">最小字体大小 当将javaScriptEnabled属性设置为NO时，可以看到明显的效果</span>
preference.minimumFontSize = <span style="line-height:1.8;color:rgb(128,0,128);font-size:12px;">0</span><span style="line-height:1.8;font-size:12px;">; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置是否支持javaScript 默认是支持的</span>
preference.javaScriptEnabled =<span style="line-height:1.8;font-size:12px;"> YES; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置是否允许不经过用户交互由javaScript自动打开窗口</span>
preference.javaScriptCanOpenWindowsAutomatically =<span style="line-height:1.8;font-size:12px;"> YES; config.preferences </span>= preference;</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">3、WKUserContentController专门用来管理native与JavaScript的交互行为，addScriptMessageHandler:name:方法来注册要被js调用的方法名称，之后再JavaScript中使用window.webkit.messageHandlers.name.postMessage()方法来像native发送消息，支持OC中字典，数组，NSNumber等原生数据类型，JavaScript代码中的name要和上面注册的相同：</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置内容交互控制器 用于处理JavaScript与native交互</span>
WKUserContentController * userController =<span style="line-height:1.8;font-size:12px;"> [[WKUserContentController alloc]init]; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置处理代理并且注册要被js调用的方法名称</span>
[userController addScriptMessageHandler:self name:<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">name</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">]; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">js注入，注入一个测试方法。</span>
NSString *javaScriptSource = <span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">function userFunc(){window.webkit.messageHandlers.name.postMessage( {\</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span>name\<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">:\"HS\"})}</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">; WKUserScript </span>*userScript =<span style="line-height:1.8;font-size:12px;"> [[WKUserScript alloc] initWithSource:javaScriptSource injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:YES]; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;"> forMainFrameOnly:NO(全局窗口)，yes（只限主窗口）[userController addUserScript:userScript];</span>
config.userContentController = userController;</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">4、在native代理的回调方法中，会获取到JavaScript传递进来的消息，如下：</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
        <pre><span style="font-size:18px;line-height:1.8;">-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *<span style="line-height:1.8;font-size:12px;">)message{ </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">这里可以获取到JavaScript传递进来的消息</span>
}</span></pre>
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKScriptMessage类是JavaScript传递的对象实例，其中属性如下：</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">传递的消息主体</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">id</span><span style="line-height:1.8;font-size:12px;"> body; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">传递消息的WebView</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, weak) WKWebView *<span style="line-height:1.8;font-size:12px;">webView; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">传递消息的WebView当前页面对象</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) WKFrameInfo *<span style="line-height:1.8;font-size:12px;">frameInfo; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">消息名称</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSString *name;</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKUserContentController实例的addUserScript:用于注入JavaScript代码，后面会专门介绍。</span></p> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WebKit框架采用其本身的缓存框架，WKWebsiteDataStore类用来处理数据的存储，其中属性和方法如下：</span></p> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置数据存储store</span>
config.websiteDataStore = [WKWebsiteDataStore defaultDataStore];</span></pre>
       </div> 
       <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
        <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@interface</span><span style="line-height:1.8;font-size:12px;"> WKWebsiteDataStore : NSObject </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">获取默认的存储器 此存储器为持久性的会被写入磁盘</span>
+ (WKWebsiteDataStore *<span style="line-height:1.8;font-size:12px;">)defaultDataStore; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">获取一个临时的存储器</span>
+ (WKWebsiteDataStore *<span style="line-height:1.8;font-size:12px;">)nonPersistentDataStore; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">存储器是否是临时的</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, getter=<span style="line-height:1.8;font-size:12px;">isPersistent) BOOL persistent; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">所有可以存储的类型</span>
+ (NSSet&lt;NSString *&gt; *<span style="line-height:1.8;font-size:12px;">)allWebsiteDataTypes; </span><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@end</span>
<span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置是否将网页内容全部加载到内存后再渲染</span>
    config.suppressesIncrementalRendering = NO;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置HTML5视频是否允许网页播放 设置为NO则会使用本地播放器</span>
    config.allowsInlineMediaPlayback =  YES;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置是否允许ariPlay播放</span>
    config.allowsAirPlayForMediaPlayback = YES;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置视频是否需要用户手动播放 设置为NO则会允许自动播放</span>
    config.requiresUserActionForMediaPlayback = NO;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置是否允许画中画技术 在特定设备上有效</span>
    config.allowsPictureInPictureMediaPlayback = YES;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置选择模式 是按字符选择 还是按模块选择/*</span>
<span style="line-height:1.8;font-size:12px;"> typedef NS_ENUM(NSInteger, WKSelectionGranularity) { </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">按模块选择</span>
<span style="line-height:1.8;font-size:12px;"> WKSelectionGranularityDynamic, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">按字符选择</span>
<span style="line-height:1.8;font-size:12px;"> WKSelectionGranularityCharacter, } NS_ENUM_AVAILABLE_IOS(8_0); </span>*/<span style="line-height:1.8;font-size:12px;"> config.selectionGranularity </span>= WKSelectionGranularityCharacter;    <span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置请求的User-Agent信息中应用程序名称 iOS9后可用</span>
    config.applicationNameForUserAgent = <span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">HS</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span>;</span></pre> 
        <div class="cnblogs_code_toolbar">
         <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
        </div> 
       </div> 
       <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKWebView中的属性和方法解析</span></p> 
       <div class="tc-card-imagetext-text"> 
        <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">下面列举了WKWebView中常用的属性和方法：</span></p> 
        <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
         <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置导航代理</span>
@property (nullable, nonatomic, weak) <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">id</span> &lt;WKNavigationDelegate&gt;<span style="line-height:1.8;font-size:12px;"> navigationDelegate; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">设置UI代理</span>
@property (nullable, nonatomic, weak) <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">id</span> &lt;WKUIDelegate&gt;<span style="line-height:1.8;font-size:12px;"> UIDelegate; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">导航列表</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, strong) WKBackForwardList *<span style="line-height:1.8;font-size:12px;">backForwardList; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">通过url加载网页视图</span>
- (nullable WKNavigation *)loadRequest:(NSURLRequest *<span style="line-height:1.8;font-size:12px;">)request; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">通过文件加载网页视图</span>
- (nullable WKNavigation *)loadFileURL:(NSURL *)URL allowingReadAccessToURL:(NSURL *<span style="line-height:1.8;font-size:12px;">)readAccessURL NS_AVAILABLE(10_11, 9_0); </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">通过HTML字符串加载网页视图</span>
- (nullable WKNavigation *)loadHTMLString:(NSString *)<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">string</span> baseURL:(nullable NSURL *<span style="line-height:1.8;font-size:12px;">)baseURL; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">通过data数据加载网页视图</span>
- (nullable WKNavigation *)loadData:(NSData *)data MIMEType:(NSString *)MIMEType characterEncodingName:(NSString *)characterEncodingName baseURL:(NSURL *<span style="line-height:1.8;font-size:12px;">)baseURL NS_AVAILABLE(10_11, 9_0); </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">渲染导航列表中的某个网页节点</span>
- (nullable WKNavigation *)goToBackForwardListItem:(WKBackForwardListItem *<span style="line-height:1.8;font-size:12px;">)item; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">网页标题</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSString *<span style="line-height:1.8;font-size:12px;">title; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">网页的url</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSURL *<span style="line-height:1.8;font-size:12px;">URL; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">网页是否正在加载中</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, getter=<span style="line-height:1.8;font-size:12px;">isLoading) BOOL loading; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">加载进度 可以监听这个属性的值配合UIProgressView来设计进度条</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>) <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">double</span><span style="line-height:1.8;font-size:12px;"> estimatedProgress; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">是否全部是安全连接</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span><span style="line-height:1.8;font-size:12px;">) BOOL hasOnlySecureContent; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">证书列表</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSArray *<span style="line-height:1.8;font-size:12px;">certificateChain; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">是否可以回退</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span><span style="line-height:1.8;font-size:12px;">) BOOL canGoBack; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">是否可以前进</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span><span style="line-height:1.8;font-size:12px;">) BOOL canGoForward; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">回退网页</span>
- (nullable WKNavigation *<span style="line-height:1.8;font-size:12px;">)goBack; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">前进网页</span>
- (nullable WKNavigation *<span style="line-height:1.8;font-size:12px;">)goForward; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">刷新网页</span>
- (nullable WKNavigation *<span style="line-height:1.8;font-size:12px;">)reload; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">忽略缓存的刷新</span>
- (nullable WKNavigation *<span style="line-height:1.8;font-size:12px;">)reloadFromOrigin; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">停止加载</span>
- (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span><span style="line-height:1.8;font-size:12px;">)stopLoading; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">执行JavaScript代码</span>
- (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^ __nullable)(__nullable <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">id</span>, NSError *<span style="line-height:1.8;font-size:12px;"> __nullable error))completionHandler; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">是否允许右滑返回手势</span>
@property (nonatomic) BOOL allowsBackForwardNavigationGestures;</span></pre> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
        </div> 
        <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKBackForwardList类为导航管理的网页列表类，其中属性方法意义如下：</span></p> 
        <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
         <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@interface</span><span style="line-height:1.8;font-size:12px;"> WKBackForwardList : NSObject </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">当前所在的网页节点</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, strong) WKBackForwardListItem *<span style="line-height:1.8;font-size:12px;">currentItem; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">前进的一个网页节</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, strong) WKBackForwardListItem *<span style="line-height:1.8;font-size:12px;">forwardItem; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">回退的一个网页节点</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, strong) WKBackForwardListItem *<span style="line-height:1.8;font-size:12px;">backItem; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">获取某个index的网页节点</span>
- (nullable WKBackForwardListItem *<span style="line-height:1.8;font-size:12px;">)itemAtIndex:(NSInteger)index; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">获取回退的节点数组</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSArray&lt;WKBackForwardListItem *&gt; *<span style="line-height:1.8;font-size:12px;">backList; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">获取前进的节点数组</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSArray&lt;WKBackForwardListItem *&gt; *<span style="line-height:1.8;font-size:12px;">forwardList; </span><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@end</span></span></pre> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
        </div> 
        <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在WebKit中，网页节点被抽象成为了WKBackForwardListItem类，这个类中封装的属性如下：</span></p> 
        <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
         <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@interface</span><span style="line-height:1.8;font-size:12px;"> WKBackForwardListItem : NSObject </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">当前节点的URL</span>
@property (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSURL *<span style="line-height:1.8;font-size:12px;">URL; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">当前节点的标题</span>
@property (nullable, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSString *<span style="line-height:1.8;font-size:12px;">title; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">创建此WebView的初始URL</span>
@property (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSURL *initialURL;</span></pre> 
         <div class="cnblogs_code_toolbar">
          <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
         </div> 
        </div> 
        <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">关于native与JavaScript交互</span></p> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WebKit中的native与JavaScript的交互主要有4类。</span></p> 
        </div> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">1.JavaScript调用native方法</span></p> 
        </div> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">这种方式是由WKUserContentController注册，并在代理方法中实现的。</span></p> 
        </div> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">2.native调用JavaScript方法</span></p> 
        </div> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">这种方式通过WKWebView直接调用evaluteJavaScript:completionHandler:方法来实现。</span></p> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">3.将JavaScript代码注入</span></p> 
        </div> 
        <div class="tc-card-imagetext-text"> 
         <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">这种方式可以在网页中注入一些自定义的JavaScript代码，也可以注入自定义的方法，再使用evaluteJavaScript:completionHandler:来调用方法。JavaScript代码的注入也是通过WKUserContentController来完成的，使用addUserScript:方法来注入JavaScript，其中需要通过WKUserScript类来生成要注入的对象，这个类使用如下方法来进行实例化：</span></p> 
         <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
          <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">/*</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">source为要注入的js代码 WKUserScriptInjectionTime设置注入的时机forMainFrameOnly参数设置是否只在主页面注入 typedef NS_ENUM(NSInteger, WKUserScriptInjectionTime) { //原js代码运行前注入 WKUserScriptInjectionTimeAtDocumentStart, //原js代码运行后注入 WKUserScriptInjectionTimeAtDocumentEnd } NS_ENUM_AVAILABLE(10_10, 8_0); </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">*/</span>

- (instancetype)initWithSource:(NSString *)source injectionTime:(WKUserScriptInjectionTime)injectionTime forMainFrameOnly:(BOOL)forMainFrameOnly;</span></pre> 
          <div class="cnblogs_code_toolbar">
           <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
          </div> 
         </div> 
         <div class="tc-card-imagetext-text"> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">4.通过WKUIDelegate来交互</span></p> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">这种方式主要用于相应JavaScript中的弹出框，后面会详细介绍这个协议。</span></p> 
         </div> 
         <div class="tc-card-imagetext-text"> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKNavagationDelegate中方法解析</span></p> 
         </div> 
         <div class="tc-card-imagetext-text"> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKNavagationDelegate协议重要有两个作用，监听页面渲染流程与控制页面跳转，其中方法如下：</span></p> 
          <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
           <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">/*</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;"> 决定是否响应网页的某个动作，例如加载，回退，前进，刷新等，在这个方法中，必须执行decisionHandler()代码块，并将是否允许这个活动执行在block中进行传入 </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">*//*</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;"> WKNavigationAction是网页动作的抽象化，其中封装了许多行为信息，后面会介绍 WKNavigationActionPolicy为开发者回执，枚举如下： typedef NS_ENUM(NSInteger, WKNavigationActionPolicy) { //取消此次行为 WKNavigationActionPolicyCancel, //允许此次行为 WKNavigationActionPolicyAllow, } NS_ENUM_AVAILABLE(10_10, 8_0); </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">*/</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^<span style="line-height:1.8;font-size:12px;">)(WKNavigationActionPolicy))decisionHandler{ decisionHandler(WKNavigationActionPolicyAllow); } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">需要响应身份验证时调用 同样在block中需要传入用户身份凭证</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential *<span style="line-height:1.8;font-size:12px;"> _Nullable))completionHandler{ </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">用户身份信息</span>
    NSURLCredential *newCred = [NSURLCredential credentialWithUser:<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@""</span><span style="line-height:1.8;font-size:12px;"> password:</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@""</span><span style="line-height:1.8;font-size:12px;"> persistence:NSURLCredentialPersistenceNone]; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;"> 为 challenge 的发送方提供 credential [[challenge sender] useCredential:newCred</span>
<span style="line-height:1.8;font-size:12px;"> forAuthenticationChallenge:challenge]; completionHandler(NSURLSessionAuthChallengeUseCredential,newCred); } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">接收到数据后是否允许执行渲染/*其中，WKNavigationResponse为请求回执信息</span>
<span style="line-height:1.8;font-size:12px;">WKNavigationResponsePokicy为开发者回执，枚举如下： typedef NS_ENUM(NSInteger, WKNavigationResponsePolicy) { </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">取消渲染 WKNavigationResponsePolicyCancel, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">允许渲染 WKNavigationResponsePolicyAllow,</span>
<span style="line-height:1.8;font-size:12px;">} NS_ENUM_AVAILABLE(10_10, 8_0); </span>*/
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^<span style="line-height:1.8;font-size:12px;">)(WKNavigationResponsePolicy))decisionHandler{ decisionHandler(WKNavigationResponsePolicyAllow); } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">=====================下面这个协议方法用于监听流程=========================================</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">页面加载启动时调用-(void)webView:(WKWebView *)webView didStartProvisionalNavigation:(WKNavigation *)navigation{</span>
<span style="line-height:1.8;font-size:12px;">} </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">当主机接收到的服务重定向时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(WKNavigation *<span style="line-height:1.8;font-size:12px;">)navigation{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">内容到达主机时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didCommitNavigation:(WKNavigation *<span style="line-height:1.8;font-size:12px;">)navigation{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">主页加载完成时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *<span style="line-height:1.8;font-size:12px;">)navigation{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">提交发生错误时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didFailNavigation:(WKNavigation *)navigation withError:(NSError *<span style="line-height:1.8;font-size:12px;">)error{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">主页数据加载发生错误时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView didFailProvisionalNavigation:(null_unspecified WKNavigation *)navigation withError:(nonnull NSError *<span style="line-height:1.8;font-size:12px;">)error{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">进程被终止时调用</span>

-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webViewWebContentProcessDidTerminate:(WKWebView *<span style="line-height:1.8;font-size:12px;">)webView{ }</span></span></pre> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
          </div> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">WKUIDelegate协议中方法解析：</span></p> 
          <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
           <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">创建新的webView时调用的方法</span>
-(WKWebView *)webView:(WKWebView *)webView createWebViewWithConfiguration:(WKWebViewConfiguration *)configuration forNavigationAction:(WKNavigationAction *)navigationAction windowFeatures:(WKWindowFeatures *)windowFeatures{    <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">return</span><span style="line-height:1.8;font-size:12px;"> webView; } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">关闭webView时调用的方法</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webViewDidClose:(WKWebView *<span style="line-height:1.8;font-size:12px;">)webView{ } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">下面这些方法是交互JavaScript的方法 </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">JavaScript调用alert方法后回调的方法 message中为alert提示的信息 必须要在其中调用completionHandler()</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^)(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>))completionHandler{    NSLog(<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">%@</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">,message); completionHandler(); } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">JavaScript调用confirm方法后回调的方法 confirm是js中的确定框，需要在block中把用户选择的情况传递进去</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^)(BOOL))completionHandler{    NSLog(<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">%@</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">,message); completionHandler(YES); } </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">JavaScript调用prompt方法后回调的方法 prompt是js中的输入框 需要在block中把用户输入的信息传入</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span> (^)(NSString * _Nullable))completionHandler{    NSLog(<span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">%@</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">,prompt); completionHandler(</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">@"</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">123</span><span style="line-height:1.8;color:rgb(128,0,0);font-size:12px;">"</span><span style="line-height:1.8;font-size:12px;">); }</span></span></pre> 
           <div class="cnblogs_code_toolbar">
            <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
           </div> 
          </div> 
          <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">扩展</span></p> 
          <div class="tc-card-imagetext-text"> 
           <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">首先，在注册要被JavaScript调用的方法时需要设置代理，在不需要时需要将代理移除，WKUserContentController中也提供了移除这个代理的方法，如果不移除，将会造成WebView不能释放。方法如下：</span></p> 
           <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
            <div class="cnblogs_code_toolbar">
             <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
            </div> 
            <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">注册一个监听方法</span>
- (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)addScriptMessageHandler:(<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">id</span> &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;<span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">移除一个方法的监听- (void)removeScriptMessageHandlerForName:(NSString *)name;同样与注入JavaScript对应，也可以将注入的代码移除，方法如下： </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">注入一个JavaScript抽象对象</span>
- (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)addUserScript:(WKUserScript *<span style="line-height:1.8;font-size:12px;">)userScript; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">移除所有注入</span>
- (<span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">void</span>)removeAllUserScripts;</span></pre> 
            <div class="cnblogs_code_toolbar">
             <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
            </div> 
           </div> 
           <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在上面，经常会见到WKNavagationAction这个类，这个类中封装的是一些页面活动信息，如下：</span></p> 
           <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
            <div class="cnblogs_code_toolbar">
             <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
            </div> 
            <pre><span style="font-size:18px;line-height:1.8;"><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@interface</span><span style="line-height:1.8;font-size:12px;"> WKNavigationAction : NSObject </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">原页面</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) WKFrameInfo *<span style="line-height:1.8;font-size:12px;">sourceFrame; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">目标页面</span>
@property (nullable, nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) WKFrameInfo *<span style="line-height:1.8;font-size:12px;">targetFrame; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">请求URL</span>
@property (nonatomic, <span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span>, copy) NSURLRequest *<span style="line-height:1.8;font-size:12px;">request; </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">活动类型/*typedef NS_ENUM(NSInteger, WKNavigationType) { </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">链接激活 WKNavigationTypeLinkActivated, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">提交操作 WKNavigationTypeFormSubmitted, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">前进操作 WKNavigationTypeBackForward, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">刷新操作 WKNavigationTypeReload, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">重提交操作 例如前进 后退 刷新 WKNavigationTypeFormResubmitted, </span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">//</span><span style="line-height:1.8;color:rgb(0,128,0);font-size:12px;">其他类型</span>
    WKNavigationTypeOther = -<span style="line-height:1.8;color:rgb(128,0,128);font-size:12px;">1</span><span style="line-height:1.8;font-size:12px;">, } NS_ENUM_AVAILABLE(10_10, 8_0); </span>*/<span style="line-height:1.8;font-size:12px;"> @property (nonatomic, </span><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">readonly</span><span style="line-height:1.8;font-size:12px;">) WKNavigationType navigationType; </span><span style="line-height:1.8;color:rgb(0,0,255);font-size:12px;">@end</span></span></pre> 
            <div class="cnblogs_code_toolbar">
             <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
            </div> 
           </div> 
           <p><span style="line-height:1.8;font-size:18px;font-family:'楷体';">&nbsp;一个强大的JS与OC交互的框架：<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom-width:1px;border-bottom-style:dotted;border-bottom-color:rgb(51,51,51);">https://github.com/marcuswestin/WebViewJavascriptBridge</a></span></p> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;">
    程序猿神奇的手，每时每刻，这双手都在改变着世界的交互方式！
   </div> 
   <div class="clear" style="clear:both;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"></div> 
   <div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;line-height:25.2px;">本文转自当天真遇到现实博客园博客，原文链接：http://www.cnblogs.com/XYQ-208910/p/5876419.html</span></font>
     <span style="font-size:14px;line-height:25.2px;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
