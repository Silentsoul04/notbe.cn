<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>System.Net.Http for Silverlight « NotBeCN</title>
  <meta name="description" content="                  System.Net.Http 简介     System.Net.Http 是微软推出的最新的 HTTP 应用程序的编程接口， 微软称之为“现代化的 HTTP 编程接口”， 旨在提供如下内容：          用户通过 HTTP 使用现代化的 Web Service 的客户...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/25/weixin_33881041_90121822.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">System.Net.Http for Silverlight</h1>
    <p class="post-meta">Oct 25, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(17,17,17);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13px;line-height:23.4px;"> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;">System.Net.Http 简介</h3> 
    <p>System.Net.Http 是微软推出的最新的 HTTP 应用程序的编程接口， 微软称之为“现代化的 HTTP 编程接口”， 旨在提供如下内容：</p> 
    <ol>
     <li style="list-style:decimal inside;">用户通过 HTTP 使用现代化的 Web Service 的客户端组件；</li> 
     <li style="list-style:decimal inside;">能够同时在客户端与服务端同时使用的 HTTP 组件（比如处理 HTTP 标头和消息）， 为客户端和服务端提供一致的编程模型。</li> 
    </ol>
    <p>命名空间&nbsp;<a href="http://msdn.microsoft.com/en-us/library/system.net.http.aspx" rel="nofollow" style="color:rgb(0,102,204);">System.Net.Http</a>&nbsp;以及&nbsp;<a href="http://msdn.microsoft.com/en-us/library/system.net.http.headers.aspx" rel="nofollow" style="color:rgb(0,102,204);">System.Net.Http.Headers</a>&nbsp;提供了如下内容：</p> 
    <ol>
     <li style="list-style:decimal inside;"> <a href="http://msdn.microsoft.com/en-us/library/system.net.http.httpclient.aspx" rel="nofollow" style="color:rgb(0,102,204);">HttpClient</a>&nbsp;发送和接收 HTTP 请求与响应;</li> 
     <li style="list-style:decimal inside;"> <a href="http://msdn.microsoft.com/en-us/library/system.net.http.httprequestmessage.aspx" rel="nofollow" style="color:rgb(0,102,204);">HttpRequestMessage</a>&nbsp;and&nbsp;<a href="http://msdn.microsoft.com/en-us/library/system.net.http.httpresponsemessage.aspx" rel="nofollow" style="color:rgb(0,102,204);">HttpResponseMessage</a>&nbsp;封装了 RFC 2616 定义的 HTTP 消息；</li> 
     <li style="list-style:decimal inside;"> <a href="http://msdn.microsoft.com/en-us/library/system.net.http.headers.httpheaders.aspx" rel="nofollow" style="color:rgb(0,102,204);">HttpHeaders</a>&nbsp;封装了 RFC 2616 定义的 HTTP 标头；</li> 
     <li style="list-style:decimal inside;"> <a href="http://msdn.microsoft.com/en-us/library/system.net.http.httpclienthandler.aspx" rel="nofollow" style="color:rgb(0,102,204);">HttpClientHandler</a>&nbsp;负责生成HTTP响应消息的HTTP处理程序。</li> 
    </ol>
    <p>System.Net.Http 能够处理多种类型的 RFC 2616 定义的 HTTP 实体正文， 如下图所示：</p> 
    <p><img src="http://beginor.github.io/assets/post-images/system-net-http-httpcontent.png" alt="HttpContent Class Diagrams" style="border:0px;"></p> 
    <p>此外， System.Net.Http 对 HTTP 消息的处理采用了职责链模式，&nbsp;<a href="http://www.asp.net/web-api/overview/working-with-http/http-message-handlers" rel="nofollow" style="color:rgb(0,102,204);">这里有一遍不错的介绍</a>， 这里就不再多说了。</p> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;">Silverlight 版本的 System.Net.Http</h3> 
    <p>System.Net.Http 最早和 Asp.Net Mvc4 同时出现， 可以在 .Net 4.0 中使用。 随着 .Net 4.5 的发布， System.Net.Http 正式成为 .Net 基础类库， 目前已经可以在 .Net 4.0/4.5 、 Windows Phone 、 以及 Windows Store App 中使用， 唯独没有发布 Silverlight 版本的 System.Net.Http。 更加悲催的是， 随着 Xamarin 2.0 的发布， Xamarin.Android 和 Xamarin.iOS 居然也开始支持 System.Net.Http ， 真是让做 Silverlight 开发的码农心寒。</p> 
    <p>幸好， .Net 有开源的实现， 那就是 Mono ， 其中有大量开源的 .Net 基础类实现， 在 Mono 3.x 版本中， 就有开源的 System.Net.Http , Xamarin 发布的 Android 和 iOS 版本的 System.Net.Http 就是源自 Mono 的， 既然 Android 和 iOS 可以， 相信 Silverlight 也肯定可以， 抱着试试看的态度， 下载了 Mono 下的 System.Net.Http 源代码， 并整理成了一个 Silverlight 项目。 经过一番努力， Silverlight 版本的 System.Net.Http 终于可以使用了， GitHub 项目地址：&nbsp;<a href="https://github.com/beginor/System_Net_Http" rel="nofollow" style="color:rgb(0,102,204);">https://github.com/beginor/System_Net_Http</a>&nbsp;， 欢迎围观。</p> 
    <p><a href="http://msdn.microsoft.com/library/cc838250.aspx" rel="nofollow" style="color:rgb(0,102,204);">由于 Silverlight 平台对 HTTP 的限制</a>， 移除了部分功能， 例如 Proxy 、 AllowAutoRedirect 、 PreAuthenticate 以及 KeepAlive 设置等， 这些都是 Silverlight 不支持的。</p> 
    <p>对于 Silverlight 的 BrowserHttp ， 仅仅支持 GET 和 POST 方法， 示例代码如下：</p> 
    <pre><code>HttpClient client = new HttpClient {
   BaseAddress = new Uri("http://localhost:8080/HttpTestWeb/api/")
};

// Get string from server
client.GetStringAsync("browserhttp/").ContinueWith(t =&gt; {
   if (t.IsFaulted) {
      // report error here
      //Application.Current.ReportError(t.Exception.GetBaseException());
   } else {
      string txt = t.Result;
      //Assert.IsFalse(string.IsNullOrEmpty(txt));
   }
});

// Post form data to server
var param = new Dictionary&lt;string, string&gt; {
   {"Name", "Client Post"},
   {"Age", "1"},
   {"Birthday", DateTime.Today.ToString("s")}
};
client.PostAsync("browserhttp/", new FormUrlEncodedContent(param)).ContinueWith(t =&gt; {
   if (t.IsFaulted) {
      // report error here
      // Application.Current.ReportError(t.Exception.GetBaseException());
   } else {
      HttpResponseMessage response = t.Result;
      //Assert.IsTrue(response.EnsureSuccessStatusCode);
   }
});</code></pre> 
    <p>对于 ClientHttp ， 除了 GET 和 POST 之外， 还支持 PUT 和 DELETE （其它的 HTTP 方法也可能支持， 未测试）， 示例代码如下：</p> 
    <pre><code>// PUT to update
var param = new Dictionary&lt;string, string&gt; {
   {"Id", "1" },
   {"Name", "Client Post"},
   {"Age", "1"},
   {"Birthday", DateTime.Today.ToString("s")}
};
client.PutAsync("clienthttp/1", new FormUrlEncodedContent(param)).ContinueWith(t =&gt; {
   if (t.IsFaulted) {
      // report error here
      // Application.Current.ReportError(t.Exception.GetBaseException());
   } else {
      HttpResponseMessage response = t.Result;
      //Assert.IsTrue(response.EnsureSuccessStatusCode);
   }
});

// DELETE
client.DeleteAsync("clienthttp/1").ContinueWith(t =&gt; {
   if (t.IsFaulted) {
      // report error here
      // Application.Current.ReportError(t.Exception.GetBaseException());
   } else {
      HttpResponseMessage response = t.Result;
      //Assert.IsTrue(response.EnsureSuccessStatusCode);
   }
});</code></pre> 
    <p>支持职责链模式的 MessageProcessingHandler ， 如下面的代码所示：</p> 
    <pre><code>public class CustomProcessingHandler : MessageProcessingHandler {

   protected override HttpRequestMessage ProcessRequest(HttpRequestMessage request, CancellationToken cancellationToken) {
      if (request.Method != HttpMethod.Get &amp;&amp; request.Method != HttpMethod.Post) {
         request.Headers.TryAddWithoutValidation("RequestMethod", request.Method.Method);
         request.Method = HttpMethod.Post;
      }
      return request;
   }

   protected override HttpResponseMessage ProcessResponse(HttpResponseMessage response, CancellationToken cancellationToken) {
      var request = response.RequestMessage;
      if (request.Headers.Contains("RequestMethod")) {
         IEnumerable&lt;string&gt; values;
         if (request.Headers.TryGetValues("RequestMethod", out values)) {
            request.Method = new HttpMethod(values.First());
         }
      }
      return response;
   }
}</code></pre> 
    <p>使用起来也是非常简单的：</p> 
    <pre><code>var customHandler = new CustomProcessingHandler {
    InnerHandler = new HttpClientHandler()
};
var client = new HttpClient(customHandler, true) {
    BaseAddress = new Uri("http://localhost:8080/HttpTestWeb/api/")
};</code></pre> 
    <h3 style="color:rgb(0,0,0);font-size:16px;line-height:1.5;">参考资料：</h3> 
    <ul>
     <li style="list-style:disc inside;">MSDN 官方文档：<a href="http://msdn.microsoft.com/library/system.net.http.aspx" rel="nofollow" style="color:rgb(0,102,204);">http://msdn.microsoft.com/library/system.net.http.aspx</a> </li> 
     <li style="list-style:disc inside;">ASP.NET Web API 介绍中的 Working with HTTP：&nbsp;<a href="http://www.asp.net/web-api/overview/working-with-http" rel="nofollow" style="color:rgb(0,102,204);">http://www.asp.net/web-api/overview/working-with-http</a> </li> 
     <li style="list-style:disc inside;">Mono 源代码：&nbsp;<a href="https://github.com/mono/mono/tree/master/mcs/class/System.Net.Http" rel="nofollow" style="color:rgb(0,102,204);">https://github.com/mono/mono/tree/master/mcs/class/System.Net.Http</a> </li> 
    </ul>
   </div> 
   <div style="color:rgb(17,17,17);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13px;line-height:23.4px;"> 
    <p><a href="http://beginor.github.com/" rel="nofollow" style="color:rgb(0,102,204);">张志敏</a>所有文章遵循<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh" rel="nofollow" style="color:rgb(0,102,204);">创作共用版权协议</a>，要求<b>署名、非商业 、保持一致</b>。在满足<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh" rel="nofollow" style="color:rgb(0,102,204);">创作共用版权协议</a>的基础上可以转载，但请以超链接形式注明出处。</p> 
    <p><b>本博客已经迁移到 GitHub ， 围观地址：&nbsp;<a href="http://beginor.github.io/" rel="nofollow" style="color:rgb(0,102,204);">http://beginor.github.io/</a></b></p> 
   </div> 
   <div class="clear" style="clear:both;color:rgb(17,17,17);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:13px;line-height:23.4px;"></div> 
   <div> 
    <div> 
     <font color="#111111"><span style="font-size:13px;line-height:23.4px;">本文转自张志敏博客园博客，原文链接：http://www.cnblogs.com/beginor/archive/2013/04/14/3019807.html</span></font>
     <span style="font-size:13px;line-height:23.4px;color:rgb(17,17,17);font-family:Verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
