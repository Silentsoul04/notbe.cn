<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>iBATIS In Action：使用高级查询技术（一） « NotBeCN</title>
  <meta name="description" content="             可以考虑根据对象的关系（关联）来定义数据模型，然后使用   iBATIS   将它们一起加载。例如，如果在数据库中，   Account   记录对应着相关的   Order   记录，而   Order   又对应着相关的   OrderItem   记录，可以为这些记录建立关系，当我...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/18/weixin_34087301_90134797.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">iBATIS In Action：使用高级查询技术（一）</h1>
    <p class="post-meta">Oct 18, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">可以考虑根据对象的关系（关联）来定义数据模型，然后使用</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">iBATIS</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">将它们一起加载。例如，如果在数据库中，</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">Account</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">记录对应着相关的</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">Order</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">记录，而</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">Order</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">又对应着相关的</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">OrderItem</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">记录，可以为这些记录建立关系，当我们请求一条</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">Account</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">记录时，可以一并获取所有的</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">Order</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">和</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">OrderItem</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">记录。下面的代码清单显示了如何定义我们的</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">SQL</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">映射：<br><br></span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></span> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultAccountInfoMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="AccountInfo"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="accountId"</span>
    <span style="color:rgb(255,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="accountId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select</span>
    <span style="color:rgb(0,0,255);">="Ch6.getOrderInfoList"</span>
    <span style="color:rgb(255,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="accountId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultOrderInfoMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="OrderInfo"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderItemList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select</span>
    <span style="color:rgb(0,0,255);">="Ch6.getOrderItemList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultOrderItemMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="OrderItem"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderItemId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderItemId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">select&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="getAccountInfoList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMap</span>
    <span style="color:rgb(0,0,255);">="ResultAccountInfoMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;accountId&nbsp;from&nbsp;Account<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">select</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">select&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="getOrderInfoList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMap</span>
    <span style="color:rgb(0,0,255);">="ResultOrderInfoMap"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;orderId&nbsp;from&nbsp;orders<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;accountId&nbsp;=&nbsp;#value#<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">select</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">select&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="getOrderItemList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMap</span>
    <span style="color:rgb(0,0,255);">="ResultOrderItemMap"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;orderId,&nbsp;orderItemId&nbsp;from&nbsp;orderItem<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;orderid&nbsp;=&nbsp;#value#<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">select</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br></span> 
   </div> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">先来看看结果映射（</span>result map<span style="line-height:1.8;font-family:'宋体';">，即上面的</span>ResultAccountInfoMap<span style="line-height:1.8;font-family:'宋体';">，</span>ResultOrderInfoMap<span style="line-height:1.8;font-family:'宋体';">和</span>ResultOrderItemMap<span style="line-height:1.8;font-family:'宋体';">），前两个</span>Map<span style="line-height:1.8;font-family:'宋体';">都用到了</span>select<span style="line-height:1.8;font-family:'宋体';">特性。这个特性告诉</span>iBATIS<span style="line-height:1.8;font-family:'宋体';">，属性的值将由另一个映射语句来设置，语句的名称就是</span>select<span style="line-height:1.8;font-family:'宋体';">特性的值。例如，我们执行</span>getAccountInfoList<span style="line-height:1.8;font-family:'宋体';">语句时，</span>ResultAccountInfoMap<span style="line-height:1.8;font-family:'宋体';">结果映射有一个子元素：</span></p> 
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultproperty</span>
    <span style="color:rgb(0,0,255);">="orderList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;select</span>
    <span style="color:rgb(0,0,255);">="Ch6.getOrderInfoList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="accountId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span> 
   </div> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">它的作用是告诉iBATIS，account对象的orderList属性的值由Ch6.getOrderInfoList语句来设置，同时把accountId列的值传给Ch6.getOrderInfoList作为参数。类似地，在设置order对象的orderItemList对象时，也会执行getOrderItemList语句。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">这个功能给我们带来便利的同时，也带来了两个问题。首先，创建包含大量对象的列表可能会消耗大量的内存。其次，这种方法会导致数据库的</span>I/O<span style="line-height:1.8;font-family:'宋体';">问题，其原因是所谓的“</span><span style="line-height:1.8;">N+1 Select</span><span style="line-height:1.8;font-family:'宋体';">”现象，这个现象将在后面讨论。对于每个问题，</span>iBATIS<span style="line-height:1.8;font-family:'宋体';">框架都提供了解决方案，但是注意，<strong>没有哪一种能同时解决这两个问题</strong>。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">数据库</span>I/O</strong></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">数据库</span>I/O<span style="line-height:1.8;font-family:'宋体';">是数据库使用状况的一项指标，也是数据库性能的主要瓶颈之一。在读取或写入数据库时，数据必须要经历从磁盘到内存或者从内存到磁盘的转换，这个过程是比较耗时的。在程序中使用缓存可以减少对数据库的访问，但这种方法使用时要谨慎，否则也会引发问题。要了解</span>iBATIS<span style="line-height:1.8;font-family:'宋体';">中的缓存机制，可以参看第</span>10<span style="line-height:1.8;font-family:'宋体';">章的内容。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">在使用关联数据时，可能会遭遇数据库</span>I/O<span style="line-height:1.8;font-family:'宋体';">问题。考虑一下这个场景：有</span>1000<span style="line-height:1.8;font-family:'宋体';">个</span>Account<span style="line-height:1.8;font-family:'宋体';">，每一个关联了</span>1000<span style="line-height:1.8;font-family:'宋体';">个</span>Order<span style="line-height:1.8;font-family:'宋体';">，而每个</span>Order<span style="line-height:1.8;font-family:'宋体';">则包含</span>25<span style="line-height:1.8;font-family:'宋体';">个</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">。如果尝试将所有这些数据加载到内存，执行的</span>SQL<span style="line-height:1.8;font-family:'宋体';">语句要超过</span>1000000<span style="line-height:1.8;font-family:'宋体';">行（</span>1<span style="line-height:1.8;font-family:'宋体';">条用来查询</span>Account<span style="line-height:1.8;font-family:'宋体';">，</span>1000<span style="line-height:1.8;font-family:'宋体';">条用于</span>Order<span style="line-height:1.8;font-family:'宋体';">，</span>1000000<span style="line-height:1.8;font-family:'宋体';">条用于</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">），而创建的对象大约为</span>2500<span style="line-height:1.8;font-family:'宋体';">万——如果你真敢这么做，<strong>等你的系统管理员收拾你</strong>吧。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">分析</span>N</strong><strong><span style="line-height:1.8;font-family:'宋体';">＋</span>1</strong><strong><span style="line-height:1.8;font-family:'宋体';">查询问题</span></strong></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询问题是由于试图加载多个父记录（比如</span>Account<span style="line-height:1.8;font-family:'宋体';">）的子记录（</span>Order<span style="line-height:1.8;font-family:'宋体';">）而引起的。因此，在查询父记录时，只需要</span>1<span style="line-height:1.8;font-family:'宋体';">条语句，假设返回</span>N<span style="line-height:1.8;font-family:'宋体';">条记录，那么就需要再执行</span>N<span style="line-height:1.8;font-family:'宋体';">条语句来查询子记录，引发所谓的“</span>N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询”。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">这些问题的解决方案</span></strong></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">延迟加载（</span>Lazy load<span style="line-height:1.8;font-family:'宋体';">，在</span>6.2.2<span style="line-height:1.8;font-family:'宋体';">中详细讲述）可以解决<strong>一部分内存问题</strong>，它将加载过程打散为一些更小的过程。但是，它并没有解决数据库</span>I/O<span style="line-height:1.8;font-family:'宋体';">问题，在最坏的情况下，它对数据库的访问次数与非延迟加载的版本是一样的，因为加载数据时它的方法还是</span>N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询（这个我们将在</span>6.2.3<span style="line-height:1.8;font-family:'宋体';">中解决）。另一方面，当我们解决了</span>N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询问题，减少了对数据库的访问，但我们的查询结果却包含着</span>2500<span style="line-height:1.8;font-family:'宋体';">万行记录！</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">要决定是否使用复杂属性，我们需要理解数据库以及应用程序对数据库的使用方式。如果您使用了本节中的技术，那可以省不少事儿，但如果误用了它，也会有大麻烦。在接下来的两节中，我们会分析如何根据目标选择合适的策略。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">让我们从这个问题开始：像上面例子那样将</span>Account<span style="line-height:1.8;font-family:'宋体';">关联到</span>Order<span style="line-height:1.8;font-family:'宋体';">并将</span>Order<span style="line-height:1.8;font-family:'宋体';">关联到</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">是否合适？实际上，不是——</span>order-to-orderitem<span style="line-height:1.8;font-family:'宋体';">关系是固定的，但是</span>account-to-order<span style="line-height:1.8;font-family:'宋体';">关系则是不必要的。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">我们是如是推理的：没有所属的</span>Order<span style="line-height:1.8;font-family:'宋体';">，</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">是没有意义的，而</span>Account<span style="line-height:1.8;font-family:'宋体';">则是有意义的。一般情况下，没有</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">，</span>Order<span style="line-height:1.8;font-family:'宋体';">没什么大用，相对的，不属于任何</span>Order<span style="line-height:1.8;font-family:'宋体';">的</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">是没有意义的。另一方面，一个</span>Account<span style="line-height:1.8;font-family:'宋体';">则可以认为是一个完整的对象。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">但在我们的例子中，这种关系可以良好地描述相关的技术，因此我们会在一段时间内一直使用它。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>6.2.2&nbsp;</strong><strong><span style="line-height:1.8;font-family:'宋体';">延迟加载（</span>Lazy loading</strong><strong><span style="line-height:1.8;font-family:'宋体';">）</span></strong></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">首先来看看延迟加载。如果不是对所有数据都马上用到，那么延迟加载是有用的。例如，我们的程序首先在一个网页显示所有</span>Account<span style="line-height:1.8;font-family:'宋体';">，然后销售代理（我们的客户）可以点击一个</span>Account<span style="line-height:1.8;font-family:'宋体';">来查看该</span>Account<span style="line-height:1.8;font-family:'宋体';">的</span>Order<span style="line-height:1.8;font-family:'宋体';">列表，然后可以再点击一个</span>Order<span style="line-height:1.8;font-family:'宋体';">来查看其所有的</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">信息。在这种情况下，每次都仅查询一个列表。这是对延迟加载的合理使用。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">译注</span></strong><span style="line-height:1.8;font-family:'宋体';">：在</span>iBATIS<span style="line-height:1.8;font-family:'宋体';">的</span>Java<span style="line-height:1.8;font-family:'宋体';">版本中，使用延迟加载前还需要进行配置</span>SqlMapConfig.xml<span style="line-height:1.8;font-family:'宋体';">以打开该功能。<strong>在</strong></span><strong>.NET</strong><strong><span style="line-height:1.8;font-family:'宋体';">版本中不需要配置等价的</span>sqlMap.config</strong><span style="line-height:1.8;font-family:'宋体';">。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">使用了延迟加载后，我们就可以更合理地进行对象创建和对数据库的访问。（还是使用上面的例子）如果一个用户关注到</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">层次的数据，我们需要进行三次查询（一次是为</span>Account<span style="line-height:1.8;font-family:'宋体';">，一次是</span>Order<span style="line-height:1.8;font-family:'宋体';">，还有一次是</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">），应用程序则要创建</span>2025<span style="line-height:1.8;font-family:'宋体';">个对象（</span>1000<span style="line-height:1.8;font-family:'宋体';">个</span>Account<span style="line-height:1.8;font-family:'宋体';">，</span>&nbsp;1000<span style="line-height:1.8;font-family:'宋体';">个</span>Order<span style="line-height:1.8;font-family:'宋体';">，</span>25<span style="line-height:1.8;font-family:'宋体';">个</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">）。效果明显！而我们要做的仅仅是修改</span>XML<span style="line-height:1.8;font-family:'宋体';">配置文件的一个特性（</span>attribute<span style="line-height:1.8;font-family:'宋体';">）而已，无需改动代码。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">在一项不太严谨的测试中，我们发现，对于同样的对象关联关系（如上面的</span><span style="line-height:1.8;">Account- Order- ORderItem</span><span style="line-height:1.8;font-family:'宋体';">），在加载第一个列表数据时（</span>Account<span style="line-height:1.8;font-family:'宋体';">列表），没有使用延迟加载的版本花费的时间是使用了延迟加载的版本的三倍。但是，在加载所有数据时，延迟加载的版本的时间却多了</span>20<span style="line-height:1.8;font-family:'宋体';">％。很明显，我们<strong>要根据数据加载的数量和时机来确定是否采用延迟加载</strong>。此时，经验是最重要的。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">而有时您并不希望推迟数据的加载，而是希望在第一次请求的时候加载所有的数据。在这种情况下，您可以使用下节中的技术，它仅需要一次查询即可。下节的方法避免了“</span>N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询”。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong>6.2.3&nbsp;</strong><strong><span style="line-height:1.8;font-family:'宋体';">避免“</span>N</strong><strong><span style="line-height:1.8;font-family:'宋体';">＋</span>1</strong><strong><span style="line-height:1.8;font-family:'宋体';">查询”问题</span></strong></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">我们来考虑如何避免“</span>N<span style="line-height:1.8;font-family:'宋体';">＋</span>1<span style="line-height:1.8;font-family:'宋体';">查询”问题，这里可以使用连接语句（</span>Join<span style="line-height:1.8;font-family:'宋体';">）。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">这里用到的技术同前面类似。简单的说，使用</span>Result Map<span style="line-height:1.8;font-family:'宋体';">来定义对象间的关系，将顶层的</span>Result Map<span style="line-height:1.8;font-family:'宋体';">关联到映射语句。下面的例子的</span>Data Map<span style="line-height:1.8;font-family:'宋体';">文件结构与前面大体一致，但是只需要执行一条</span>SQL<span style="line-height:1.8;font-family:'宋体';">语句。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">这里面有三个</span>Result Map<span style="line-height:1.8;font-family:'宋体';">，一是关于</span>Account<span style="line-height:1.8;font-family:'宋体';">的，二是关于</span>Order<span style="line-height:1.8;font-family:'宋体';">的，三是</span>OrderItem<span style="line-height:1.8;font-family:'宋体';">的。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">关于</span>Account<span style="line-height:1.8;font-family:'宋体';">的</span>Result Map<span style="line-height:1.8;font-family:'宋体';">有两个作用：</span></p> 
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;"> <span style="font-family:Wingdings;"><span style="font-family:'Times New Roman';font-size:7pt;line-height:normal;">&nbsp;</span></span><span style="font-family:'宋体';">映射</span>Account<span style="font-family:'宋体';">对象本身的属性。</span> </li> 
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;"> <span style="font-family:'宋体';">告诉</span>iBATIS<span style="font-family:'宋体';">如何映射下一层的关联对象，这里是</span>orderList<span style="font-family:'宋体';">。</span> </li> 
   </ul>
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">Order<span style="line-height:1.8;font-family:'宋体';">的</span>Result Map<span style="line-height:1.8;font-family:'宋体';">作用与之类似。</span></p> 
   <ul style="list-style:none;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;"> <span style="font-family:'宋体';">映射</span>Order<span style="font-family:'宋体';">对象本身的属性。</span> </li> 
    <li style="background-image:url(&quot;images/icon_miniarrow.gif&quot;);background-position:0px 9px;background-repeat:no-repeat;list-style-type:disc;"> <span style="font-size:10.5pt;font-family:'宋体';">告诉</span><span style="font-size:10.5pt;font-family:'Times New Roman';">iBATIS</span><span style="font-size:10.5pt;font-family:'宋体';">如何映射下一层的关联对象，这里是</span><span style="font-size:10.5pt;font-family:'Times New Roman';">orderItemList</span><span style="font-size:10.5pt;font-family:'宋体';">。</span> </li> 
   </ul>
   <div style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;border:1px solid rgb(204,204,204);font-size:13px;"> 
    <img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultAccountInfoNMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="AccountInfo"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="account.accountId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="accountId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMapping</span>
    <span style="color:rgb(0,0,255);">="Ch6.ResultOrderInfoNMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultOrderInfoNMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="OrderInfo"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="order.orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderItemList"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMapping</span>
    <span style="color:rgb(0,0,255);">="Ch6.ResultOrderItemNMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">resultMap&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="ResultOrderItemNMap"</span>
    <span style="color:rgb(255,0,0);">&nbsp;class</span>
    <span style="color:rgb(0,0,255);">="OrderItem"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">result&nbsp;</span>
    <span style="color:rgb(255,0,0);">property</span>
    <span style="color:rgb(0,0,255);">="orderItemId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;column</span>
    <span style="color:rgb(0,0,255);">="orderItemId"</span>
    <span style="color:rgb(255,0,0);">&nbsp;</span>
    <span style="color:rgb(0,0,255);">/&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">resultMap</span>
    <span style="color:rgb(0,0,255);">&gt;<br><br></span>
    <span style="color:rgb(0,0,0);"><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;</span>
    <span style="color:rgb(128,0,0);">select&nbsp;</span>
    <span style="color:rgb(255,0,0);">id</span>
    <span style="color:rgb(0,0,255);">="getAccountInfoListN"</span>
    <span style="color:rgb(255,0,0);">&nbsp;resultMap</span>
    <span style="color:rgb(0,0,255);">="ResultAccountInfoNMap"</span>
    <span style="color:rgb(0,0,255);">&gt;</span>
    <span style="color:rgb(0,0,0);"><br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;account.accountId&nbsp;as&nbsp;accountid,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;orders.orderid&nbsp;as&nbsp;orderid,<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;orderitem.orderitemid&nbsp;as&nbsp;orderitemid<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;account<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;inner&nbsp;join&nbsp;orders&nbsp;on&nbsp;account.accountId&nbsp;=&nbsp;orders.accountId<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;inner&nbsp;join&nbsp;orderitem&nbsp;on&nbsp;orders.orderId&nbsp;=&nbsp;orderitem.orderId<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;">&nbsp;&nbsp;&nbsp;&nbsp;order&nbsp;by&nbsp;accountId,&nbsp;orderid,&nbsp;orderitemid<br><img src="http://www.cnblogs.com/Images/OutliningIndicators/None.gif" alt="" align="top" style="border:0px;"></span>
    <span style="color:rgb(0,0,255);">&lt;/</span>
    <span style="color:rgb(128,0,0);">select</span>
    <span style="color:rgb(0,0,255);">&gt;</span> 
   </div> 
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <span style="color:rgb(51,51,51);font-size:14px;font-family:'宋体';">我们的不太科学的测试表明，在加载少量数据时，该方法将原先方法的性能提高为</span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">7</span>
   <span style="color:rgb(51,51,51);font-size:14px;font-family:'宋体';">：</span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">1</span>
   <span style="color:rgb(51,51,51);font-size:14px;font-family:'宋体';">。我们猜想，对于例子中使用的</span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">2500</span>
   <span style="color:rgb(51,51,51);font-size:14px;font-family:'宋体';">万条数据，两种方法仍然不错。</span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"></span> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">译注</span></strong><span style="line-height:1.8;font-family:'宋体';">：在</span>iBATIS.NET DataMapper 1.6.1<span style="line-height:1.8;font-family:'宋体';">中，添加了</span><strong>groupBy</strong><span style="line-height:1.8;font-family:'宋体';">特性，它将进一步改善性能。详细内容请参看相关文档，本文使用的是</span>DataMapper 1.5.1<span style="line-height:1.8;font-family:'宋体';">。</span></p> 
   <p align="left" style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><span style="line-height:1.8;font-family:'宋体';">需要注意的是，尽管性能得到改善，内存的消耗仍然与没有使用延迟加载的版本相同。所有的记录一起放入内存，因此尽管它稍微快了一点，但内存的消耗仍是问题。</span></p> 
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">译注</span></strong><span style="line-height:1.8;font-family:'宋体';">：在加载复杂属性时可能出现两方面的问题，一是对数据库的访问，二是创建对象时对内存的消耗。我们可以采用延迟加载或</span>Join<span style="line-height:1.8;font-family:'宋体';">的方法来解决这些问题，但是两者都不是万灵药。延迟加载的原理时推迟对复杂属性的加载，以减少对数据库的访问和对象的创建，但它的前提是<strong>复杂属性不会马上用到</strong>，否则的话，延迟就失去意义。</span>Join<span style="line-height:1.8;font-family:'宋体';">的原理是通过一条</span>SQL<span style="line-height:1.8;font-family:'宋体';">语句加载所有数据，这样可以大幅度减少对数据库的访问量，它的前提是<strong>对象的数量不会太多</strong>。该如何选择呢？下面的表格给出了简单的原则：</span></p> 
   <table border="1" style="border:medium none;border-collapse:collapse;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;margin-left:5.4pt;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;background:rgb(204,204,204) none repeat scroll 0% 50%;width:207.65pt;"> <p align="center" style="line-height:1.8;text-align:center;"><strong><span style="line-height:1.8;font-family:'宋体';">延迟加载</span></strong></p> </td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;background:rgb(204,204,204) none repeat scroll 0% 50%;width:206.35pt;"> <p align="center" style="line-height:1.8;text-align:center;"><strong>Join</strong></p> </td> 
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;width:207.65pt;"> <p style="line-height:1.8;"><span style="line-height:1.8;font-family:'宋体';">如果要加载大量的数据，它们不会马上用到，延迟加载会比较合适。</span></p> </td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;width:206.35pt;"> <p style="line-height:1.8;"><span style="line-height:1.8;font-family:'宋体';">数据量较小或者数据马上就会用到，</span>Join<span style="line-height:1.8;font-family:'宋体';">方法比较合适。</span></p> </td> 
     </tr>
    </tbody>
   </table>
   <p style="line-height:1.8;color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;font-family:'宋体';">译注</span></strong><span style="line-height:1.8;font-family:'宋体';">：另外，我觉得还有一条很重要的原则，那就是<strong>永远只加载必需的数据</strong>。以上面的例子来说，我们不太可能会同时显示</span>1000<span style="line-height:1.8;font-family:'宋体';">个</span>Account<span style="line-height:1.8;font-family:'宋体';">给用户看，这时就不要同时加载</span>1000<span style="line-height:1.8;font-family:'宋体';">个</span>Account<span style="line-height:1.8;font-family:'宋体';">的数据了，可以通过分页只显示</span>50<span style="line-height:1.8;font-family:'宋体';">条数据，在此基础上再应用延迟加载或</span>Join<span style="line-height:1.8;font-family:'宋体';">效果会很不错。关于在</span>Web<span style="line-height:1.8;font-family:'宋体';">项目中如何使用</span>iBATIS<span style="line-height:1.8;font-family:'宋体';">进行分页，请参看</span><a href="http://www.cnblogs.com/anderslly/archive/2007/06/21/792223.html" rel="nofollow" style="text-decoration:none;color:rgb(61,129,238);border-bottom-width:1px;border-bottom-style:dashed;"><span style="line-height:1.8;font-family:'宋体';">这篇文章</span></a><span style="line-height:1.8;font-family:'宋体';">。</span></p> 
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">好了，这些就是复杂属性映射相关的内容。下一篇中，我们将会了解</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'Times New Roman';">iBATIS</span>
   <span style="color:rgb(51,51,51);font-size:10.5pt;font-family:'宋体';">的其它用法。<br><br></span>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">上一篇：</span>
   <a href="http://www.cnblogs.com/anderslly/archive/2007/12/11/executingnonquerystatement02.html" rel="nofollow" style="text-decoration:none;color:rgb(61,129,238);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">iBATIS In Action：执行非查询语句（二）</a>
   <span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">；</span>
   <br style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">
   <p><span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">下一篇：</span><span style="font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;color:rgb(255,0,240);">iBATIS In Action：使用高级查询技术（二）</span><span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;">；</span></p> 
   <p><span style="color:rgb(51,51,51);font-family:Georgia, 'Times New Roman', Times, sans-serif;font-size:14px;"><br></span></p> 
   <p><font color="#333333"><span><span style="font-size:14px;">本文转自一个程序员的自省博客园博客，原文链接:http://www.cnblogs.com/anderslly/archive/2007/12/27/ibatisinactionch062.html，如需转载请自行联系原作者。</span></span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
