<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>白话学习MVC(六)模型绑定 « NotBeCN</title>
  <meta name="description" content="             一、什么是模型绑定？    　　模型绑定存在的意义就是为Action的参数提供值，例如：如下表单中提交了数据，那么Action(即:Index)的参数Id,Name的值就是表单中对应的name属性相同的值，而表单提交的值是如何赋值给Action的参数的呢？模型绑定就是来完成从用户提交的请...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/06/weixin_34033624_90135332.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">白话学习MVC(六)模型绑定</h1>
    <p class="post-meta">Oct 6, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <h3 style="color:rgb(255,255,255);font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.8;font-size:14pt;"><strong>一、什么是模型绑定？</strong></span></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">　　模型绑定存在的意义就是为Action的参数提供值，例如：如下表单中提交了数据，那么Action(即:Index)的参数Id,Name的值就是表单中对应的name属性相同的值，而表单提交的值是如何赋值给Action的参数的呢？模型绑定就是来完成从用户提交的请求中提取数据，并赋值给Action的参数。此例是从表单中的提取数据，并赋值给Action的参数，模型绑定还可以完成完成从地址Url、路由Route、上传文件等中获取数据，并赋值给Action相应的参数。</span></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre>&lt;form id=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">form0</span><span style="line-height:1.8;">"</span> action=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">../Home/Index</span><span style="line-height:1.8;">"</span> method=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">post</span><span style="line-height:1.8;">"</span>&gt;<span style="line-height:1.8;">
    UserName:</span>&lt;input type=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">text</span><span style="line-height:1.8;">"</span> name=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">Id</span><span style="line-height:1.8;">"</span> /&gt;<span style="line-height:1.8;">
    PassWord:</span>&lt;input type=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">text</span><span style="line-height:1.8;">"</span> name=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">Name</span><span style="line-height:1.8;">"</span> /&gt;
    &lt;input type=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">submit</span><span style="line-height:1.8;">"</span> value=<span style="line-height:1.8;">"</span><span style="line-height:1.8;">Submit</span><span style="line-height:1.8;">"</span>/&gt;
&lt;/form&gt;</pre></td> 
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"><pre><span style="line-height:1.8;">        [HttpPost]<span style="line-height:1.8;"><span style="line-height:1.8;">//注意：参数名必须要和html标签中的name属性相同</span> </span></span><span style="line-height:1.8;">public</span> ActionResult Index(<span style="line-height:1.8;">string</span> Id,<span style="line-height:1.8;">string</span><span style="line-height:1.8;"> Name)
        {
            </span><span style="line-height:1.8;">return</span> Content(Id+<span style="line-height:1.8;">Name);
        }</span></pre></td> 
     </tr>
    </tbody>
   </table>
   <h3 style="color:rgb(255,255,255);font-size:16px;line-height:1.5;font-family:verdana, Arial, Helvetica, sans-serif;"><span style="line-height:1.8;font-size:14pt;"><strong>二、模型绑定机制介绍</strong></span></h3> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">　　MVC中的模型绑定都是有默认的模型绑定DefaultModelBinder来完成，为清楚模型绑定的机制，我们来通过自定义模型绑定来由浅到深的学习</span><br><span style="line-height:1.8;font-size:13px;">　　模型绑定整个过程可以分为：从请求中获取数据、将请求中的数据转换成Action参数的类型并返回。</span><br><span style="line-height:1.8;font-size:13px;">　　</span><span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">模型绑定必须要实现IModelBinder接口，改接口中有唯一的返回值类型为object类型的方法BindModel，改方法的返回值就是相应的Action参数的值，那么可以这么理解，当接收到请求并在执行Action之前，要调用BindModel方法，在改方法的内部直接或简介的实现从请求中获取值，并返回给Action的参数。</span><br><span style="line-height:1.8;font-size:13px;">　　BindModel方法的参数：ControllerContext是当前Controller的上下文，即：封装了当前Controller和Route的相关信息；而ModelBindingContext则是当前绑定的参数类型的相关信息，例如有这么一个Action：public ActionResult Index(User use),此时ModelBindingContext就是参数use的相关信息。</span><br></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">interface</span><span style="line-height:1.8;"> IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext);
    }</span></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>简单类型和复杂类型的模型绑定</strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;"><span style="line-height:1.8;color:rgb(255,0,0);">　　示例1</span><span style="line-height:1.8;"><span style="line-height:1.8;color:rgb(255,0,0);">：模型绑定机制</span><br></span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre>　　<span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyModelBinder:IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">获取的值并返回</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;">        [HttpPost]
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ActionResult Index([ModelBinder(<span style="line-height:1.8;color:rgb(0,0,255);">typeof</span>(MyModelBinder))]<span style="line-height:1.8;color:rgb(0,0,255);">string</span> Temp1，[ModelBinder(<span style="line-height:1.8;color:rgb(0,0,255);">typeof</span>(MyModelBinder))]<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> Temp2)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> Content(Temp1+<span style="line-height:1.8;">temp2);
        }　　　　　　
　　　　 </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">[ModelBinder(typeof(MyModelBinder))]表示此处string类型的参数Temp的值由自定义的MyModelBinder提供</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">&nbsp;　　此示例实现了对指定参数类型的模型绑定，在调用Action之前，对于每个参数都需要调用与之绑定的ModelBinder的BindModel方法来获取值，当然在我们的示例中，参数Temp1和Temp2各自都要执行一遍MyModelBinder的BindModel方法来获取相应的参数。</span><br><span style="line-height:1.8;font-size:13px;">　　</span><span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">但是，我们的参数是在BinderModel方法中直接写的，而在实际中我们是要从用户发来的请求中获取到的，由此我们由引出一个叫做ValueProvider的组件，直译就是值提供器，通过它来实现在请求中获取值。值提供器需要实现IValueProvider接口，默认的值提供器有：FormValueProvider、RouteDataValueProvider、 QueryStringValueProvider、 HttpFileCollectionValueProvider，分别是从表单、路由、地址字符串、上传文件中获取数据，既然同时存在这么多的ValueProvider，那么他们的调用肯定是有顺序的（就是按照上面写的顺序啦啦啦啦...），值得说的是，只要在找到一个值，那么就不再继续在其它的ValueProvider中找了。</span><br> IVaueProvider接口</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;">
    <pre>    <span style="line-height:1.8;">public</span> <span style="line-height:1.8;">interface</span><span style="line-height:1.8;"> IValueProvider
    {
        </span><span style="line-height:1.8;">bool</span> ContainsPrefix(<span style="line-height:1.8;">string</span><span style="line-height:1.8;"> prefix);
        ValueProviderResult GetValue(</span><span style="line-height:1.8;">string</span><span style="line-height:1.8;"> key);
    }</span></pre>
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">&nbsp;　　<span style="line-height:1.8;font-size:13px;">ContainsPrefix方法用来判断是否包含前缀，GetValue方法则是用来获取值，并返回一个封装了获取的值和相关转换方法的ValueProviderResult类型。</span></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;color:rgb(255,0,0);">　　示例2：利用默认的ValueProvider实现自定义模型绑定<br></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">Html</span>
    &lt;h2&gt;Index&lt;/h2&gt;
        &lt;form id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">form0</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> action=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">../Home/Index</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> method=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">post</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;
        &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Temp</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; 
        &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> value=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;  
    &lt;/form&gt;

<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">Action</span>
<span style="line-height:1.8;">        [HttpPost]
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ActionResult Index([ModelBinder(<span style="line-height:1.8;color:rgb(0,0,255);">typeof</span>(MyModelBinder))]<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> Temp)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> Content(Temp);
        }    

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ModelBinder</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyModelBinder:IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
        {
            IValueProvider valueProvider </span>=<span style="line-height:1.8;"> bindingContext.ValueProvider;
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span> key =<span style="line-height:1.8;"> bindingContext.ModelName;
            Type modelType </span>=<span style="line-height:1.8;"> bindingContext.ModelType;

            </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (valueProvider.ContainsPrefix(key))
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> valueProvider.GetValue(key).ConvertTo(modelType);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">;
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">　　此示例利用默认的ValueProvider从表单中获取标签的name属性为Temp的Text的数值，在自定义的BindModel方法中可以看出ModelBindingContext的的重要性，bindingContext.ValueProvider得到值提供器，bindingContext.ModelName得到的是绑定的Action方法中的参数名(此例中为：Temp)，bindingContext.ModelType得到的是绑定的参数的类型(此例中为：string)，valueProvider.ContainsPrefix(“Temp”)就是在全部的表单中检查是否存在这样name属性为Temp的标签，valueProvider.GetValue(key).ConvertTo(modelType)就是获取值并转换为Action参数的类型！----注意：默认的ContainsPrefix方法中，只有表单中存在Temp或Temp.才返回true</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;"><span style="line-height:1.8;">　　<span style="line-height:1.8;color:rgb(255,0,0);">示例3：利用自定义ValueProvider和自定义ModelBinder实现模型绑定</span></span></span></p> 
   <ul style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:13px;">利用自定义的ModelBinder，只需要在Action的参数前利用模型绑定的ModelBinder特性添加，否则使用默认的模型绑定DefaultModelBinder</span></li> 
    <li style="list-style:disc;"><span style="line-height:1.8;font-size:13px;">利用自定义的ValueProvider，需要新建一个自定义的ValueProviderFactory，在ValueProviderFactory的GetValueProvider方法中，实例化自定的ValueProvider并返回。</span></li> 
   </ul>
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ModelBinder</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyModelBinder:IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> bindingContext.ValueProvider.GetValue(bindingContext.ModelName).ConvertTo(bindingContext.ModelType);
        }
    }
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ValueProvider</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProvider:IValueProvider
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">bool</span> ContainsPrefix(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> prefix)
        {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">暂时不写判断是否含有前缀的定义，因为貌似默认情况下，不是是否含有此前缀，而是是否含有此关键字</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">false</span><span style="line-height:1.8;">;
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ValueProviderResult GetValue(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> key)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span>[] objResult = HttpContext.Current.Request.Form.GetValues(key);<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">获取表单中name属性是key的所有值，放入到一个字符串数组中</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">string</span> strResult =<span style="line-height:1.8;"> HttpContext.Current.Request.Form[key];
　　　　　　　</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">将原始值(数组)，和值的字符串形式封装到一个ValueProviderResult中</span>
            ValueProviderResult vpr = <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> ValueProviderResult(objResult, strResult, System.Globalization.CultureInfo.CurrentCulture);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> vpr;
        }
    }    
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ValueProviderFactory</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProviderFactory:ValueProviderFactory
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">override</span><span style="line-height:1.8;"> IValueProvider GetValueProvider(ControllerContext controllerContext)
        {
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">此处构造了无参数的构造函数</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MyValueProvider();
        }
    }
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">在程序启动时将自定义的ValueProvider添加到程序中</span>
        <span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;"> Application_Start()
        {
            AreaRegistration.RegisterAllAreas();  
            RegisterGlobalFilters(GlobalFilters.Filters);
            RegisterRoutes(RouteTable.Routes);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">因为在ValueProvider中，只要没有找到响应的值就会向下进行，所以我们将其他的ValueProvider移除</span>
            ValueProviderFactories.Factories.RemoveAt(<span style="line-height:1.8;color:rgb(128,0,128);">4</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">3</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">2</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.Insert(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>,<span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MyValueProviderFactory());
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">ValueProviderFactories.Factories.Add(new MyValueProviderFactory());</span>
        }</pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">&nbsp;　　此例利用自定义的ValueProvider来从请求中的表单中获取数据，并封装到一个ValueProviderResult中，而在自定义的ModelBinder中调用valueProvider，并得到其返回的ValueProviderResult类型的值，然后再利用ValueProviderResult的ConvertTo方法，将获取到的string[]类型转换为相应的类型(即：GetValue方法返回的是一个string[]类型)，最终完成模型的绑定。但是在这个例子中我们没有在自定义的ValueProvider中写ContainsPrefix方法，当然程序中也没有用到他去判断，而是直接去利用GetValue方法去获取表单中的值。那么下面就来实现这个方法，并在程序中利用！</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<span style="line-height:1.8;color:rgb(255,0,0);">示例4：自定义ModelBinder和自定义valueProvider(自己写ContainsPrefix方法)</span><br><span style="line-height:1.8;font-size:13px;">上述的示例中都是对简单类型的模型绑定，下面我们就来写一个对复杂类型的绑定---&gt;User类</span><br><span style="line-height:1.8;font-size:13px;">User类</span><br><span style="line-height:1.8;font-size:13px;">public class User</span><br><span style="line-height:1.8;font-size:13px;">{</span><br><span style="line-height:1.8;font-size:13px;">　　public int ID{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">　　public string Name{set;get;}　</span><br><span style="line-height:1.8;font-size:13px;">}</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">前台</span>
&lt;form id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">form0</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> action=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">../Home/Index</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> method=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">post</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;

    &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">use.Name</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; 
    &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Name</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; 

    &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> value=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;  
&lt;/form&gt;

<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">Action</span>
<span style="line-height:1.8;">        [HttpPost]
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ActionResult Index([ModelBinder(<span style="line-height:1.8;color:rgb(0,0,255);">typeof</span>(MyModelBinder))]User use, [ModelBinder(<span style="line-height:1.8;color:rgb(0,0,255);">typeof</span><span style="line-height:1.8;">(MyModelBinder))]User uu)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> Content(use.Id.ToString()+<span style="line-height:1.8;">use.Name);
        }

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义的ModelBinder</span>
 <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyModelBinder:IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
        {
           </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> GetModel(bindingContext.ValueProvider, bindingContext.ModelType, bindingContext.ModelName);   
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span> GetModel(IValueProvider valueProvider, Type modelType, <span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> modelName)
        {
            ModelMetadata modelMetadata </span>= ModelMetadataProviders.Current.GetMetadataForType(() =&gt; <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">, modelType);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果绑定的类型是简单类型</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">modelMetadata.IsComplexType)
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> valueProvider.GetValue(modelName).ConvertTo(modelType);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">object</span> model =<span style="line-height:1.8;"> Activator.CreateInstance(modelType);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果是复杂类型
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">前台表单标签的name属性的值有modelName的前缀</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (valueProvider.ContainsPrefix(modelName))
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (PropertyDescriptor porperty <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> TypeDescriptor.GetProperties(modelType))
                {

                    </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span> strkey = modelName + <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> +<span style="line-height:1.8;"> porperty.Name;
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (HttpContext.Current.Request.Form.AllKeys.Contains&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;<span style="line-height:1.8;">(strkey))
                        porperty.SetValue(model, valueProvider.GetValue(strkey).ConvertTo(porperty.PropertyType));
                }
            }
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">不包含前缀,但是标签的name属性的值等于绑定类的属性的名字</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;">
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (PropertyDescriptor porperty <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> TypeDescriptor.GetProperties(modelType))
                {
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span> strkey =<span style="line-height:1.8;"> porperty.Name;
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (HttpContext.Current.Request.Form.AllKeys.Contains&lt;<span style="line-height:1.8;color:rgb(0,0,255);">string</span>&gt;<span style="line-height:1.8;">(strkey))
                        porperty.SetValue(model, valueProvider.GetValue(strkey).ConvertTo(porperty.PropertyType));
                }
                
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> model;
        }
    }

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义的ValueProvider</span>
 <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProvider:IValueProvider
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">private</span> <span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;">[] allKeys;

        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span><span style="line-height:1.8;"> MyValueProvider(ControllerContext controllerContext)
        {
            allKeys </span>=<span style="line-height:1.8;"> controllerContext.RequestContext.HttpContext.Request.Form.AllKeys;
        }

        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">bool</span> ContainsPrefix(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> prefix)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (<span style="line-height:1.8;color:rgb(0,0,255);">string</span> key <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> allKeys)
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!key.Contains(<span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;">))
                {
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">continue</span><span style="line-height:1.8;">;
                }
                </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span>[] temp = key.Split(<span style="line-height:1.8;color:rgb(0,0,255);">new</span> <span style="line-height:1.8;color:rgb(0,0,255);">char</span>[] { <span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">'</span><span style="line-height:1.8;"> });
                </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (temp[<span style="line-height:1.8;color:rgb(128,0,128);">0</span>] ==<span style="line-height:1.8;"> prefix)
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">true</span><span style="line-height:1.8;">;
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">false</span><span style="line-height:1.8;">;
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ValueProviderResult GetValue(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> key)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span>[] arrayResult =<span style="line-height:1.8;"> HttpContext.Current.Request.Form.GetValues(key);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span> strResult =<span style="line-height:1.8;"> HttpContext.Current.Request.Form[key];
            ValueProviderResult vpr </span>= <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> ValueProviderResult(arrayResult, strResult, System.Globalization.CultureInfo.CurrentCulture);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> vpr;
        }
    }
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义的ValueProviderFactory</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProviderFactory:ValueProviderFactory
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">override</span><span style="line-height:1.8;"> IValueProvider GetValueProvider(ControllerContext controllerContext)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MyValueProvider(controllerContext);
            
        }
    }
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">Global.asax文件</span>
        <span style="line-height:1.8;color:rgb(0,0,255);">protected</span> <span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;"> Application_Start()
        {
            AreaRegistration.RegisterAllAreas();
            
            RegisterGlobalFilters(GlobalFilters.Filters);
            RegisterRoutes(RouteTable.Routes);

            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">4</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">3</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">2</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.RemoveAt(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">);
            ValueProviderFactories.Factories.Insert(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MyValueProviderFactory());
        }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;<span style="line-height:1.8;font-size:13px;">　　此例中实现了对简单类型和复杂类型的绑定，在自定义的ModelBinder中，利用ModelMetadata来判定是否是复杂类型，并且利用反射来对指定类型进行实例化，再利用PorpertyDecript的循环来对类下的属性进行赋值。在自定义的ValueProvider中，在ContainsPrefix方法中实现了对请求中的是否包含指定前缀的判定。</span><br><span style="line-height:1.8;font-size:13px;">　　在这个自定义的ModelBinder中对复杂类型的绑定时，只能绑定上述User类那样的类型，但是在实际中还有存在嵌套类型的类,例如：</span><br><span style="line-height:1.8;font-size:13px;">public class User</span><br><span style="line-height:1.8;font-size:13px;">{</span><br><span style="line-height:1.8;font-size:13px;">　　public int Id{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">　　public string Name{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">　　public AAddress Address{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">}</span><br><span style="line-height:1.8;font-size:13px;">public class AAddress</span><br><span style="line-height:1.8;font-size:13px;">{</span><br><span style="line-height:1.8;font-size:13px;">　　public string province{set;get}</span><br><span style="line-height:1.8;font-size:13px;">　　public string City{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">　　public string County{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">　　public string Village{set;get;}</span><br><span style="line-height:1.8;font-size:13px;">}</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><span style="line-height:1.8;color:rgb(255,0,0);">　　示例5：利用递归完成对复杂类型的模型绑定。（注：相比于示例4，此处对多处多了修改，已完成对复杂类型绑定的支持）<br></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
    <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">前台</span>
&lt;h2&gt;Index&lt;/h2&gt;
&lt;form id=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">form0</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> action=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">../Home/Index</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> method=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">post</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Id</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; &lt;/td&gt;
            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Name</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Address.province</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; &lt;/td&gt;
            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Address.City</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;

            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">use.Address.City</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; &lt;/td&gt;
            &lt;td&gt;&lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">text</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> name=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">use.Address.County</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> /&gt; &lt;/td&gt;
        &lt;/tr&gt;
        
    &lt;/table&gt;
    &lt;input type=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> value=<span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">Submit</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>/&gt;  
&lt;/form&gt;

<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ModelBinder</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyModelBinder:IModelBinder
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span><span style="line-height:1.8;"> BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
        {
           </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> GetModel(bindingContext.ValueProvider, bindingContext.ModelType, bindingContext.ModelName);   
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">object</span> GetModel(IValueProvider valueProvider, Type modelType, <span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> modelName)
        {
            ModelMetadata modelMetadata </span>= ModelMetadataProviders.Current.GetMetadataForType(() =&gt; <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">, modelType);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果绑定的类型是简单类型</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">modelMetadata.IsComplexType)
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> valueProvider.GetValue(modelName).ConvertTo(modelType);
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">object</span> model =<span style="line-height:1.8;"> Activator.CreateInstance(modelType);
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果是复杂类型
            </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">如果表单中标签的name属性的值包含Action的参数名</span>
            <span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (valueProvider.ContainsPrefix(modelName))
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (PropertyDescriptor properdty <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> TypeDescriptor.GetProperties(modelType))
                {
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!valueProvider.ContainsPrefix(modelName + <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> +<span style="line-height:1.8;"> properdty.Name))
                        </span><span style="line-height:1.8;color:rgb(0,0,255);">continue</span><span style="line-height:1.8;">;
                    ModelMetadata modelMetadataSon </span>= ModelMetadataProviders.Current.GetMetadataForType(() =&gt; <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">, properdty.PropertyType);
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">modelMetadataSon.IsComplexType)
                    {
                            properdty.SetValue(model, valueProvider.GetValue(modelName </span>+ <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> +<span style="line-height:1.8;"> properdty.Name).ConvertTo(properdty.PropertyType));
                    }
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;">
                    {
                        properdty.SetValue(model, GetModel(valueProvider, properdty.PropertyType, modelName </span>+ <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> +<span style="line-height:1.8;"> properdty.Name));
                    }
                }
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;">
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (PropertyDescriptor properdty <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> TypeDescriptor.GetProperties(modelType))
                {
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">valueProvider.ContainsPrefix(properdty.Name))
                        </span><span style="line-height:1.8;color:rgb(0,0,255);">continue</span><span style="line-height:1.8;">;
                    ModelMetadata modelMetadataSon </span>= ModelMetadataProviders.Current.GetMetadataForType(() =&gt; <span style="line-height:1.8;color:rgb(0,0,255);">null</span><span style="line-height:1.8;">, properdty.PropertyType);
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span> (!<span style="line-height:1.8;">modelMetadataSon.IsComplexType)
                    {
                            properdty.SetValue(model, valueProvider.GetValue(properdty.Name).ConvertTo(properdty.PropertyType));
                    }
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">else</span><span style="line-height:1.8;">
                    {
                        properdty.SetValue(model, GetModel(valueProvider, properdty.PropertyType,  properdty.Name));
                    }
                }
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> model;
        }
    }

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ValueProvider</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProvider:IValueProvider
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">private</span> <span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;">[] allKeys;

        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span><span style="line-height:1.8;"> MyValueProvider(ControllerContext controllerContext)
        {
            allKeys </span>=<span style="line-height:1.8;"> controllerContext.RequestContext.HttpContext.Request.Form.AllKeys;
        }

        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">bool</span> ContainsPrefix(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> prefix)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">foreach</span> (<span style="line-height:1.8;color:rgb(0,0,255);">string</span> key <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> allKeys)
            {
                </span><span style="line-height:1.8;color:rgb(0,0,255);">if</span><span style="line-height:1.8;"> (key.Contains(prefix))
                    </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">true</span><span style="line-height:1.8;">;
            }
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">false</span><span style="line-height:1.8;">;
        }
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> ValueProviderResult GetValue(<span style="line-height:1.8;color:rgb(0,0,255);">string</span><span style="line-height:1.8;"> key)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span>[] arrayResult =<span style="line-height:1.8;"> HttpContext.Current.Request.Form.GetValues(key);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">string</span> strResult =<span style="line-height:1.8;"> HttpContext.Current.Request.Form[key];
            ValueProviderResult vpr </span>= <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> ValueProviderResult(arrayResult, strResult, System.Globalization.CultureInfo.CurrentCulture);
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> vpr;
        }
    }

</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">自定义ValueProviderFactory</span>
    <span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">class</span><span style="line-height:1.8;"> MyValueProviderFactory:ValueProviderFactory
    {
        </span><span style="line-height:1.8;color:rgb(0,0,255);">public</span> <span style="line-height:1.8;color:rgb(0,0,255);">override</span><span style="line-height:1.8;"> IValueProvider GetValueProvider(ControllerContext controllerContext)
        {
            </span><span style="line-height:1.8;color:rgb(0,0,255);">return</span> <span style="line-height:1.8;color:rgb(0,0,255);">new</span><span style="line-height:1.8;"> MyValueProvider(controllerContext);
            
        }
    }</span></pre> 
    <div class="cnblogs_code_toolbar">
     <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
    </div> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">　　此示例中，完成了对复杂类型的模型绑定。流程为：如果表单中标签的name属性的值包含了Action参数的参数名，则对其类型的属性进行遍历，并将Action的参数名和遍历的类的当前属性拼接起来，作为key，通过ValueProvider向表单中获取值；如果表单中标签的name属性的值没有包含Action参数的参数名，则对类的属性进行遍历时，将遍历的类的当前属性名作为key，通过ValueProvider来向表单中获取值。<br> 以上我们大体上完成了对简单类型和复杂类型的模型绑定，本着高内聚低耦合的思想，将上述中对简单类型和复杂类型的绑定重写规划下。</span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">MyModelBinder</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><span style="line-height:1.8;">数组模型绑定</span></strong></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">　　<span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">在写自定义的数组类型模型绑定之前，先来看看默认情况下对数组的模型绑定是如何用的！</span><br></span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">View Code</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">　　</span><span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">在了解如何用默认的ModelBinder来完成数组类型的模型绑定，下面就来完成自定义ModelBinder来完成数组类型的模型绑定</span><br></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">View Code</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">　　<span style="line-height:1.8;font-size:13px;">上例中：值得一说的是上例中的GetZeroBasedIndexes方法，它用来生成数字索引，方法利用了yield关键字，实现了延迟和按照上次进度继续执行的思想。</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><strong>字典类型模型绑定<br></strong>　　利用默认ModelBinder的字典类型绑定</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">默认ModelBinder</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>　　</strong>字典类型是指实现了IDictionary&lt;key,value&gt;借口的类型。<br><span style="line-height:1.8;font-size:13px;">　在对字典类型进行模型绑定时，首先要判断绑定的类型是否是字典类型，如何来判断呢？</span><br><br><img src="https://images0.cnblogs.com/blog/425762/201308/15215830-ba1cff872b0448c0a4c672410cecd484" alt="" style="border:0px;"></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">　　<span style="line-height:1.8;font-size:13px;">如上图所示，对于字典类的模型绑定，需要判断两个条件：第一，是否为泛型；第二，判断构造当前泛型的泛型类型是否为IDictionary&lt;,&gt;，如果不是的话，再查找该类型是否继承IDictionary&lt;,&gt;接口（即：获取该泛型所继承的所有接口和类，再在这些类和接口中查找是否含有IDictionary&lt;,&gt;）。</span></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">自定义ModelBinder</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong>集合类型模型绑定<br></strong><span style="line-height:1.8;font-size:13px;">　　这里的集合指的是除了字典类型和数组类型意外，所有实现了IEnumerable借口的类型<strong><br></strong>　　利用默认的ModelBinder来对集合类型进行模型绑定<strong>！</strong></span></p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">View Code</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;font-size:13px;">　　可以发现，利用默认的ModelBinder对集合类型的模型绑定和数组类型的模型绑定方式是一样的<strong>！<br></strong>　　在对集合类型进行绑定时，首先要判断是否是泛型，再判断构造当前泛型的泛型类是否为IList&lt;&gt;或ICollection&lt;&gt;或IEnumerable&lt;&gt;&nbsp;&nbsp;</span><br><span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">注意：对集合类型的绑定的判断要放在数组和字典类之后，因为数组也是属于集合类，字典类型也继承自ICollection&lt;T&gt;（如下图）。所以，要在判断集合类之前，先判断是否为数组或字典类型。</span><strong><br><img src="https://images0.cnblogs.com/blog/425762/201308/15215830-ba1cff872b0448c0a4c672410cecd484" alt="" style="border:0px;"></strong></span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;　　自定义集合类型的模型绑定</p> 
   <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);font-family:'Courier New';font-size:12px;"> 
    <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
    <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.8;">View Code</span> 
   </div> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;以上就是个人整理的所有有关自定义的模型绑定的所有知识点，在最后对上述绑定中用到的几个重要的方法，来详细介绍下：</p> 
   <blockquote style="background:rgb(255,255,255) none;border:2px solid rgb(239,239,239);color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <p><span style="line-height:1.8;"><span style="line-height:1.8;">&nbsp;一、&nbsp;<br></span></span></p> 
    <p><span style="line-height:1.8;"><span style="line-height:1.8;">　　&nbsp;&nbsp; private static IEnumerable&lt;string&gt; GetZeroBasedIndexes()<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int iteratorVariable0 = 0;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (true)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yield return iteratorVariable0.ToString();<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iteratorVariable0++;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<br><span style="line-height:1.8;font-size:13px;">GetZeroBasedIndexes()方法，目的就是提供源源不断的自增1数字，并转换成字符串类型（因为模型绑定时，要对此产生的数据进行字符串拼接，所有直接转换成了string类型）。调用时的格式为：IEnumberable&lt;string&gt; indexes=GetZeroBaseIndexes();此时的indexes中什么都么有，在对indexes进行迭代时，才实时的执行GetZeroBasedIndexes方法，并且从上次执行的位置开始，继续执行。有关yield详细：<a href="http://www.cnblogs.com/wupeiqi/p/3145780.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">yield介绍</a>阿&nbsp;</span><br><span style="line-height:1.8;font-size:13px;">对于此方法的执行过程，可以自己断电测试下，就可以明白：<br></span></span></span></p> 
    <div class="cnblogs_Highlighter sh-gutter"> 
     <div> 
      <div class="syntaxhighlighter collapsed csharp" style="font-size:1em;"> 
       <div class="toolbar" style="background:rgb(245,245,245);border:1px solid rgb(204,204,204);line-height:1.1em;vertical-align:baseline;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;font-size:1em;color:#0000FF;"> 
        <span style="margin-left:0px;line-height:1.8;"><a href="http://www.cnblogs.com/wupeiqi/p/3377854.html#" rel="nofollow" class="toolbar_item command_expandSource expandSource" style="border-bottom:1px dotted rgb(51,51,51);text-decoration:none;color:#0000FF;background:none;border-top:0px;border-right:0px;border-left:0px;line-height:1.1em;text-align:center;vertical-align:baseline;font-size:12px;">+ View Code</a></span>
        <span style="margin-left:0px;line-height:1.8;"></span> 
       </div> 
      </div> 
     </div> 
    </div> 
    <p><span style="line-height:1.5;">&nbsp;二、</span></p> 
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Type ExtractGenericInterface(Type queryType, Type interfaceType)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Func&lt;Type, bool&gt; predicate = t =&gt; t.IsGenericType &amp;&amp; (t.GetGenericTypeDefinition() == interfaceType);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (predicate(queryType))<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return queryType;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return queryType.GetInterfaces().FirstOrDefault&lt;Type&gt;(predicate);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
    <p><span style="line-height:1.8;font-size:13px;">ExtractGenericInterface方法用来判定类型是否为泛型，并且实现了指定的借口。对于方法内部包含的知识点有：1、FunC&lt;T,TResult&gt;，用来封装一个具有一个参数类型为T的参数并返回TResult类型的一个方法，该方法的参数参数为t，==&gt;符号后面的就是内部逻辑。predicate(queryType),实质上就是执行FunC&lt;,&gt;封装的方法，参数为queryTyep；2、t.IsGenericType用来判断t类型是否为泛型；3、t.GetGenericTypeDefinition()方法用来获取构造泛型t的泛型类型(例：如果t为IList&lt;string&gt;，那么t的该方法就是IList&lt;&gt;)；3、queryType.GetInterfaces()用来得到queryType类型继承的所有的类和实现的所有方法，返回值的类型为Type[]类型。4、.FirstOrDefault&lt;Type&gt;(predicate)则是用来在Type[]数组中获取第一个满足封装的方法perdicate条件的一个类型！</span></p> 
    <p>三、</p> 
    <p>&nbsp;&nbsp;&nbsp; internal static class ReplaceHelper<br> &nbsp;&nbsp;&nbsp; {<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static MethodInfo replaceCollectionMethod = typeof(ReplaceHelper).GetMethod("ReplaceCollectionImpl", BindingFlags.Static | BindingFlags.NonPublic);<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void ReplaceCollection(Type collectionType, object collection, object newContents)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ////将当前泛型方法定义的类型参数替换为类型数组的元素，并返回表示结果构造方法的MethodInfo对象<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ////即将当前泛型方法ReplaceCollectionImpl&lt;T&gt;中的T替换为collectionType，之后再去执行方法。状态变化：ReplaceCollectionImpl&lt;T&gt; --&gt; ReplaceCollectionImpl&lt;User&gt;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //MethodInfo m = replaceCollectionMethod.MakeGenericMethod(new Type[] { collectionType });<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //m.Invoke(null, new object[] { collection, newContents });//执行方法<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; replaceCollectionMethod.MakeGenericMethod(new Type[] { collectionType }).Invoke(null, new object[] { collection, newContents });<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static void ReplaceCollectionImpl&lt;T&gt;(ICollection&lt;T&gt; collection, IEnumerable newContents)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; collection.Clear();<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newContents != null)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (object obj2 in newContents)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T item = (obj2 is T) ? ((T)obj2) : default(T);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; collection.Add(item);<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp; }</p> 
    <p><span style="line-height:1.8;"><span style="line-height:1.8;"><span style="line-height:1.8;font-size:13px;">此内部静态类的目的是将list中的数据，转换到指定集合中。由于replaceCollectionMethod是静态的变量，即当该类被加载时就通过反射得到一个MethodInfo类型的实例，之后的MakeGenericMethod方法做的是：将当前泛型方法定义的类型参数替换为类型数组的元素，并返回表示结果构造方法的MethodInfo对象，通俗的讲就是replaceCollectionMethod只是得到了方法，而通过MakeGenericMethod将泛型的参数再加入到通过反射得到的方法中，即状态变化为：ReplaceCollectionImpl&lt;T&gt; --&gt;ReplaceCollectionImpl&lt;collectionType&gt;；之后再通过Invoke来激发通过反射要执行的方法(ReplaceCollectionImpl);在ReplaceCollectionImpl&lt;T&gt;方法内foreach循环便是将list类型向指定的集合类型转化的操作，其中default(T)是根据类型得到默认的值(例：int类型default(T)就是0，string类型default(T)就是null。即：根据类型得到默认值)</span><br><br></span></span></p> 
   </blockquote> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">&nbsp;　　</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span style="line-height:1.8;">&nbsp;以上就是本篇博客总结的模型绑定的全部，其中只对表单提交的值进行了操作！！</span></p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">尼玛一不小心给搞成日记了，又重新贴了出来！！！</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
   <p><font color="#333333"><span style="font-size:14px;">本文转自武沛齐博客园博客，原文链接：http://www.cnblogs.com/wupeiqi/p/3377854.html，如需转载请自行联系原作者</span></font><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
