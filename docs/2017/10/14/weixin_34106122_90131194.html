<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>5种方法提升Xamarin.Forms应用启动时间 « NotBeCN</title>
  <meta name="description" content="                         适用于iOS和Android的Xamarin SDK为构建Xamarin.Forms跨平台应用程序提供了非常强大的基础。 当您努力调整Xamarin.Forms应用程序的速度和响应速度时，请记住，改善使用Xamarin SDK for iOS和Android构建的...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/14/weixin_34106122_90131194.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">5种方法提升Xamarin.Forms应用启动时间</h1>
    <p class="post-meta">Oct 14, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="content main-content"> 
    <div class="wrapper width-9 width-12-on-tablet"> 
     <p> <span><span>适用于iOS和Android的Xamarin SDK为构建Xamarin.Forms跨平台应用程序提供了非常强大的基础。</span> <span>当您努力调整Xamarin.Forms应用程序的速度和响应速度时，请记住，改善使用Xamarin SDK for iOS和Android构建的应用程序体验的相同原则也将改善与Xamarin.Forms跨平台的应用程序。</span> <span>形式 - 这种经验从启动开始。</span></span> </p> 
     <h2> <span class="short_text"><span>当你说启动...</span></span> </h2> 
     <p> <span><span>我将首先将启动定义为从用户点击您的应用程序图标到第一个可用屏幕显示准备就绪的所有事情。</span> <span>当您将一个空白的Xamarin.Android应用程序与一个空白的Xamarin.Forms应用程序进行比较时，您会注意到Xamarin.Android应用程序加载更快。</span> <span>这是怎么回事？</span></span> </p> 
     <p> <span><span>Xamarin.Forms不仅提供了在目标之间共享UI的功能，而且通用的应用功能（如<a href="https://developer.xamarin.com/guides/xamarin-forms/platform-features/deep-linking/" rel="nofollow">深层链接的AppLinks</a>，<a href="https://developer.xamarin.com/guides/xamarin-forms/application-fundamentals/navigation/" rel="nofollow">Navigation</a>，<a href="https://developer.xamarin.com/guides/xamarin-forms/application-fundamentals/messaging-center/" rel="nofollow">MessagingCenter</a>和<a href="https://developer.xamarin.com/guides/xamarin-forms/application-fundamentals/dependency-service/" rel="nofollow">DependencyService</a>）以及跨平台UI警报，操作工具栏，工具栏，</span> <span>状态栏等。当您开始向Xamarin.Android应用程序添加可比较的实现时，您将开始看到性能差异消失。</span> <span>这开始解释发生了什么，那么您可以控制什么来影响启动？</span> <span>以下是我的五大技巧，以调整iOS，Android和UWP目标的启动体验。</span></span> </p> 
     <h3> 1. <span class="short_text"><span>首先加载本地内容</span></span> </h3> 
     <p> <span><span>一旦我们的应用程序启动，我们经常要加载新的数据，但这只会减慢第一个屏幕的出现和填充。</span> <span>如果你从前一个运行状态，那么使用它，或者有准备好的内容，这是第一次运行。</span></span> </p> 
     <p> <span><span>如果您的应用程序已经离线准备就绪，我们建议您这样做，那么您将立即为第一个屏幕填充内容。</span> <span>Azure移动应用程序和Azure的领域是很好的选择。</span></span> </p> 
     <p> <span><span>当您必须访问网站，您的第一次运行的内容，提供一些UI告诉用户您正在做什么使用加载指示器。</span> <span>这也是一个完美的机会，用有用的占位符内容来替换屏幕的空白部分，以增强屏幕的存在原因，用户可以从应用程序中获得什么，或者只是一些有趣的东西！</span> <span>无论你在这里选择什么，</span></span><strong><span><span>只是不要把屏幕留空。</span></span></strong> </p> 
     <blockquote style="text-align:left;font-size:16px;border-left:3px solid #4FCAE6;"> 
      <p style="font-size:16px;"> <strong><span class="short_text"><span>有效载荷提示</span></span></strong> <span><span>最小化您的网页有效载荷，只需要你所需要的。</span> <span>不要花费时间来处理诸如解析字符串等昂贵的流程，而是在需要显示数据的同时提供数据。</span></span> </p> 
     </blockquote> 
     <h3> 2. <span class="short_text"><span>优化您的资产</span></span> </h3> 
     <p> <span><span>图像和视频很重，可以显着减慢屏幕的初始渲染速度。</span> <span>减少对重物资的依赖，并优化您所需尺寸的任何媒体。</span> <span>不要依靠操作系统为您调整资产的大小。</span></span> </p> 
     <p> <span class="short_text"><span>对于<a href="https://developer.android.com/guide/practices/screens_support.html" rel="nofollow">Android目标屏幕</a>，资产将放置在表示密度的文件夹中。</span></span> </p> 
     <ul>
      <li> ldpi (low) ~120dpi </li> 
      <li> mdpi (medium) ~160dpi </li> 
      <li> hdpi (high) ~240dpi </li> 
      <li> xhdpi (extra-high) ~320dpi </li> 
      <li> xxhdpi (extra-extra-high) ~480dpi </li> 
      <li> xxxhdpi (extra-extra-extra-high) ~640dpi </li> 
     </ul>
     <blockquote style="text-align:left;font-size:16px;border-left:3px solid #4FCAE6;"> 
      <p style="font-size:16px;"> <span class="short_text"><span>还有一个特殊的密度的nodpi，告诉Android不管屏幕密度如何扩展资源。</span></span> </p> 
     </blockquote> 
     <p> <span><span>当您将大图像放在ldpi文件夹中，并在xxhdpi的屏幕上使用该资产时，Android会将其缩放。</span> <span>这很慢，会使您的运行时内存消耗膨胀，有时甚至会导致您的应用程序崩溃;</span> <span>我做到了</span></span>。 </p> 
     <p> <span><span>为了管理许多密度和许多资产，使用<a href="https://sketchapp.com/" rel="nofollow">Sketch</a>和/或<a href="https://zeplin.io/" rel="nofollow">Zeplin</a>等应用程序从单个设计源生成多个尺寸是非常有益的。</span></span> </p> 
     <p> <a href="https://developer.xamarin.com/releases/android/xamarin.android_7/xamarin.android_7.0/" rel="nofollow">Xamarin.Android 7.0</a><span><span>最近添加了一个实验性选项来预先压缩名为<a href="https://developer.xamarin.com/guides/android/under_the_hood/build_process/#Resource_Properties" rel="nofollow">AndroidExplicitCrunch</a>的PNG文件。</span> <span>这进一步减少了您的资产（和应用程序）的大小，加快了构建时间，并确保对运行时进行了优化。</span> <span>要启用此功能，请编辑您的Android csproj的文本，并修改您的构建配置的PropertyGroup：<br><br></span></span> </p> 
     <div> 
      <div class="codeheads"> 
       <p> 点击(<span style="color:#FF0000;">此处</span>)折叠或打开 </p> 
      </div> 
      <div class="codeText"> 
       <ol>
        <li> <span style="color:#000000;"><span style="color:#0000CC;">PropertyGroup<span style="color:#0000CC;">&gt;</span><br></span> </span> </li> 
        <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><br></li> 
        <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000CC;">AndroidExplicitCrunch<span style="color:#0000CC;">&gt;</span>true<span style="color:#0000CC;"><span style="color:#0000CC;">/</span>AndroidExplicitCrunch<span style="color:#0000CC;">&gt;</span><br></span></span> </li> 
        <li> <span style="color:#0000CC;"><span style="color:#0000CC;">/</span>PropertyGroup<span style="color:#0000CC;">&gt;</span> </span> </li> 
       </ol>
      </div> 
     </div> 
     <br>
     <p> <br></p> 
     <div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate"> 
      <div class="crayon-main"> 
       <table class="crayon-table" style="margin-left:-19px;">
        <tbody>
         <tr>
          <td class="crayon-nums"> 
           <div class="crayon-nums-content"> 
            <div class="crayon-num"> 
            </div> 
            <div class="crayon-num"> 
            </div> 
            <div class="crayon-num"> 
            </div> 
            <div class="crayon-num"> 
            </div> 
           </div> <br></td> 
          <td class="crayon-code"> 
           <div class="crayon-pre"> 
            <br>
           </div> </td> 
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <h3> 3. <span class="short_text"><span>延迟加载任何你不需要立即需要的资源</span></span> </h3> 
     <p> <span><span>App.xaml资源是放置您将在整个应用程序中使用的样式，字体和其他资源的便利位置，但它也在启动时加载。</span> <span>如果您尝试从启动时间清除每个不必要的毫秒数，请删除您不需要的任何东西，并通过页面或其他方法轻松加载。</span></span> </p> 
     <h3> 4. 启用XAML<span class="short_text"><span>汇编</span></span> </h3> 
     <p> <span><span>XAML是一种流行且功能强大的方式来声明用户界面。</span> <span>如果您选择停留在C＃并在其中构建UI，那么自然会编译其余的代码，从而为您编译时间检查和速度。</span> <span>当您希望在使用XAML时获得同样的优势，您可以启用<a href="https://developer.xamarin.com/guides/xamarin-forms/xaml/xamlc/" rel="nofollow">XAML编译</a>（XAMLC）。</span> <span>这将将您的XAML编译成中级语言（IL），并将其添加到编译的程序集中，从而实现更快的启动和运行时性能。</span> <span>我们来看看如何启用：</span></span> </p> 
     <p> <span><span>在应用程序级别，您可以声明您的XAMLC选项，并会影响整个应用程序。<br><br></span></span> </p> 
     <div> 
      <div class="codeheads"> 
       <p> 点击(<span style="color:#FF0000;">此处</span>)折叠或打开 </p> 
      </div> 
      <div class="codeText"> 
       <ol>
        <li> <span style="color:#000000;"><span style="color:#0000FF;">using</span> Xamarin<span style="color:#0000CC;">.</span><span style="color:#FF0000;">Forms</span><span style="color:#0000CC;">.</span>Xaml<span style="color:#0000CC;">;</span><br></span> </li> 
        <li> <span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><br></li> 
        <li> <span style="color:#0000CC;">[</span><span style="color:#FF0000;">assembly</span><span style="color:#0000CC;">:</span> XamlCompilation <span style="color:#0000CC;">(</span>XamlCompilationOptions<span style="color:#0000CC;">.</span>Compile<span style="color:#0000CC;">)</span><span style="color:#0000CC;">]</span><br></li> 
        <li> <span style="color:#0000FF;">namespace</span> PhotoApp<br></li> 
        <li> <span style="color:#0000CC;">{</span><br></li> 
        <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><br></li> 
        <li> <span style="color:#0000CC;">}</span> </li> 
       </ol>
      </div> 
     </div> 
     <br>
     <p> <br></p> 
     <div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate"> 
      <div class="crayon-main"> 
      </div> 
     </div> 
     <p> <span class="short_text"><span>当你想在类级别设置XAMLC选项时，可以！<br></span></span> </p> 
     <div> 
      <div class="codeheads"> 
       <p> 点击(<span style="color:#FF0000;">此处</span>)折叠或打开 </p> 
      </div> 
      <div class="codeText"> 
       <ol>
        <li> <span style="color:#000000;">using Xamarin<span style="color:#0000CC;">.</span>Forms<span style="color:#0000CC;">.</span>Xaml<span style="color:#0000CC;">;</span><br></span> </li> 
        <li> <span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><br></li> 
        <li> <span style="color:#0000CC;">[</span>XamlCompilation <span style="color:#0000CC;">(</span>XamlCompilationOptions<span style="color:#0000CC;">.</span>Compile<span style="color:#0000CC;">)</span><span style="color:#0000CC;">]</span><br></li> 
        <li> public class HomePage : ContentPage<br></li> 
        <li> <span style="color:#0000CC;">{</span><br></li> 
        <li> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><span style="color:#0000CC;">.</span><br></li> 
        <li> <span style="color:#0000CC;">}</span> </li> 
       </ol>
      </div> 
     </div> 
     <p> <br></p> 
     <div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate"> 
      <div class="crayon-main"> 
       <table class="crayon-table" style="margin-left:-19px;">
        <tbody>
         <tr>
          <td class="crayon-nums"> <br></td> 
          <td class="crayon-code"> <br></td> 
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
     <p> <span><span>当XAMLC启用时，您将获得大多数所有属性的编译时XAML检查，并且UI将呈现更快的速度。</span> <span>文件大小可能保持不变或稍微增加，因为您在汇编中为IL交易.xaml文件大小。</span></span> </p> 
     <h3> 5. <span class="short_text"><span>减少装配数量</span></span> </h3> 
     <p> <span><span>像往常一样，便利性成本高昂。</span> <span>这可能是一个非常小的成本，但是当调整性能时，你不想放弃任何石头。</span> <span>虽然NuGet软件包非常适合利用其他库，但实际情况是，移动应用程序所依赖的（或更大）的程序集随着呼叫通过边界自然会减慢执行速度。<span><span>Xamarin.Forms例如检查所有程序集的[ExportRenderer]`属性，并且目前没有选择或选择退出的方法。</span> <span>这是我们正在努力改进的。</span></span></span></span> </p> 
     <p> <span><span>衡量每个依赖关系的优缺点，并在可能的情况下将该代码带入您的主要应用程序。</span> <span>你的里程可能有所不同，所以看看吧。</span> <span>这是经常被忽视的表现考虑，可能会为您带来红利。</span></span> </p> 
     <h3> <span class="short_text"><span>奖金1：时间编译（AOT）</span></span> </h3> 
     <p> <span><span>我打电话给这个奖金，因为我们仍然将AOT分类为Android的实验，并不适用于所有人。</span> <span>当然，iOS默认使用AOT和LLVM编译器，所以没有什么可做的。</span></span> </p> 
     <p> <span><span>启用实验<a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_1_-_preparing_an_application_for_release/#AOT_Compilation" rel="nofollow">Android AOT</a>，通过减少一些即时编译开销，即可立即改进启动和整体速度。</span> <span>支付的价格是APK的大小增加，所以您应该尝试这一点，并权衡您的应用程序的利弊。</span> <span>要启用AOT，请打开项目配置并选中该框。</span></span> </p> 
     <p> <img class="aligncenter size-full wp-image-32060" src="https://yqfile.alicdn.com/img_8a6b34f6062173e8ed64300f001988d5.png" alt="" width="800"><br><em><span class="short_text"><span>注意：AOT可用于Xamarin Android 5.1和7.0+</span></span></em> </p> 
     <h3> <span class="short_text"><span>奖金2：构建时间改进</span></span> </h3> 
     <p> <span><span>虽然不是直接适用于启动改进，我们的一个令人敬畏的移动解决方案架构师<a href="https://twitter.com/BrandonXamarin" rel="nofollow">Brandon Minnick</a>分享了他的构建优化配置的集合。</span> <span>在<a href="https://github.com/brminnick/ImproveXamarinBuildTimes" rel="nofollow">GitHub</a>上查看。</span></span> </p> 
     <h2> <span class="short_text"><span>下一步做什么</span></span> </h2> 
     <p> <span><span>这些只是我最喜欢的几个提示，它们可以应用于应用程序的所有屏幕，而不仅仅是启动屏幕。</span> <span>我可以继续关于平坦化的布局，优化布局周期的测量等等。</span> <span>我们的<a href="https://developer.xamarin.com/guides/xamarin-forms/deployment-testing/performance/" rel="nofollow">Xamarin.Forms性能指南</a>涵盖了大部分内容和更多内容。</span></span> </p> 
     <p> <span><span>社区和Xamarin.Forms工程团队一直在Xamarin论坛上<a href="https://forums.xamarin.com/discussion/93178/lets-talk-performance/p1" rel="nofollow">交易技巧并讨论痛点</a>和可能的解决方案。</span> <span>请加入该对话以分享您的发现，并继续探索，以改进Xamarin.Forms中所有平台的启动和运行时性能。</span></span> </p> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
