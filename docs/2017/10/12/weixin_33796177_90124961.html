<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>iOS：iOS开发系列–打造自己的“美图秀秀”(下) « NotBeCN</title>
  <meta name="description" content="                  来源：&nbsp;KenshinCui &nbsp;&nbsp;     链接：http://www.cnblogs.com/kenshincui/p/3959951.html     运行效果：          &nbsp;     其他图形上下文     前面我们也说过，...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/10/12/weixin_33796177_90124961.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">iOS：iOS开发系列–打造自己的“美图秀秀”(下)</h1>
    <p class="post-meta">Oct 12, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">来源：&nbsp;KenshinCui &nbsp;&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">链接：<a href="http://www.cnblogs.com/kenshincui/p/3959951.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom-width:1px;border-bottom-style:dotted;border-bottom-color:rgb(51,51,51);">http://www.cnblogs.com/kenshincui/p/3959951.html</a></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;">运行效果：</span></p> 
    <p><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318110759646-2003199627.gif" alt="" style="border:0px;"></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>其他图形上下文</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">前面我们也说过，Quartz 2D的图形上下方除了可以绘制到层上还可以绘制到位图、PDF等，这里我们就介绍一下如何利用Quartz 2D绘制图像到位图及PDF中。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">上面的示例中一直都是在drawRect:方法中利用UIGraphicsGetCurrentContext()方法取得上下文，要得到位图或者PDF的上下文可以利用UIGraphicsBeginImageContext(CGSize size)和UIGraphicsBeginPDFPageWithInfo(CGRect bounds, NSDictionary *pageInfo)方法。位图图形上下文和PDF图形上下文UIKit是不会负责创建的，所以需要用户手动创建，并且在使用完后关闭它。在使用UIKit中系统创建的图形上下文的时候，我们只能在drawRect：方法中使用，由于这两类图形上下文是由我们手动创建的因此可以放到任何方法中调用。此外，这两个方法开启的图形上下文并没有返回值，如果我们要得到我们创建的图形上下文只要在创建上下文之后、关闭之前调用UIGraphicsGetCurrentContext()方法，此时取得的上下文即是我们自己创建的图形上下文。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>绘制到位图</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">下面利用位图图形上下文给一个图片添加水印，在下面的程序中我们首先创建上下文，然后在上下文中绘制图片、直线和文本，最后从当前位图上下文中取得最终形成的新图片显示到界面。</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  KCMainViewController.m
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Quartz2D
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span>
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Created by Kenshin Cui on 14-3-17.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Copyright (c) 2014年 Kenshin Cui. All rights reserved.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//
</span><span style="line-height:1.8;color:rgb(0,0,255);">#import</span> &lt;CoreText/CoreText.h&gt;
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCMainViewController.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView2.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView3.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@interface</span><span style="line-height:1.8;"> KCMainViewController ()
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCMainViewController
 
</span>- (<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)viewDidLoad {
    [super viewDidLoad];
 
    UIImage </span>*image=<span style="line-height:1.8;">[self drawImageAtImageContext];
    UIImageView </span>*imageView=<span style="line-height:1.8;">[[UIImageView alloc]initWithImage:image];
    imageView.center</span>=CGPointMake(<span style="line-height:1.8;color:rgb(128,0,128);">160</span>, <span style="line-height:1.8;color:rgb(128,0,128);">284</span><span style="line-height:1.8;">);
 
    [self.view addSubview:imageView];
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">#pragma</span> mark 利用位图上下文添加水印效果
-(UIImage *<span style="line-height:1.8;">)drawImageAtImageContext{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">获得一个位图图形上下文</span>
    CGSize size=CGSizeMake(<span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">188</span>);<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">画布大小</span>
<span style="line-height:1.8;">    UIGraphicsBeginImageContext(size);
 
    UIImage </span>*image=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">photo2.png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [image drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">188</span>)];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">注意绘图的位置是相对于画布顶点而言，不是屏幕
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">添加水印</span>
    CGContextRef context=<span style="line-height:1.8;">UIGraphicsGetCurrentContext();
    CGContextMoveToPoint(context, </span><span style="line-height:1.8;color:rgb(128,0,128);">200</span>, <span style="line-height:1.8;color:rgb(128,0,128);">178</span><span style="line-height:1.8;">);
    CGContextAddLineToPoint(context, </span><span style="line-height:1.8;color:rgb(128,0,128);">270</span>, <span style="line-height:1.8;color:rgb(128,0,128);">178</span><span style="line-height:1.8;">);
 
    [[UIColor redColor]setStroke];
    CGContextSetLineWidth(context, </span><span style="line-height:1.8;color:rgb(128,0,128);">2</span><span style="line-height:1.8;">);
 
    CGContextDrawPath(context, kCGPathStroke);
 
    NSString </span>*str=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Kenshin Cui</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    [str drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">200</span>, <span style="line-height:1.8;color:rgb(128,0,128);">158</span>, <span style="line-height:1.8;color:rgb(128,0,128);">100</span>, <span style="line-height:1.8;color:rgb(128,0,128);">30</span>) withAttributes:@{NSFontAttributeName:[UIFont fontWithName:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Marker Felt</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> size:<span style="line-height:1.8;color:rgb(128,0,128);">15</span><span style="line-height:1.8;">],NSForegroundColorAttributeName:[UIColor redColor]}];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">返回绘制的新图形</span>
    UIImage *newImage=<span style="line-height:1.8;">UIGraphicsGetImageFromCurrentImageContext();
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">最后一定不要忘记关闭对应的上下文</span>
<span style="line-height:1.8;">    UIGraphicsEndImageContext();
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">保存图片
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    NSData *data= UIImagePNGRepresentation(newImage);
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    [data writeToFile:@"/Users/kenshincui/Desktop/myPic.png" atomically:YES];</span>
 
    <span style="line-height:1.8;color:rgb(0,0,255);">return</span><span style="line-height:1.8;"> newImage;
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;">运行效果：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:16px;"><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318110251896-63015112.png" alt="" style="border:0px;"></span></p> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">注意：上面这种方式绘制的图像除了可以显示在界面上还可以调用对应方法进行保存（代码注释中已经包含保存方法）；除此之外这种方法相比在drawRect：方法中绘制图形效率更高，它不用每次展示时都调用所有图形绘制方法。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>绘制到PDF</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">绘制到PDF则要启用pdf图形上下文，PDF图形上下文的创建使用方式跟位图图形上下文是类似的，需要注意的一点就是绘制内容到PDF时需要创建分页，每页内容的开始都要调用一次IGraphicsBeginPDFPage();方法。下面的示例演示了文本绘制和图片绘制（其他图形绘制也是类似的）：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  KCMainViewController.m
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Quartz2D
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span>
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Created by Kenshin Cui on 14-3-17.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Copyright (c) 2014年 Kenshin Cui. All rights reserved.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//
</span><span style="line-height:1.8;color:rgb(0,0,255);">#import</span> &lt;CoreText/CoreText.h&gt;
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCMainViewController.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCView2.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@interface</span><span style="line-height:1.8;"> KCMainViewController ()
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCMainViewController
 
</span>- (<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)viewDidLoad {
    [super viewDidLoad];
 
    [self drawContentToPdfContext];
}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">#pragma</span> mark 利用pdf图形上下文绘制内容到pdf文档
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)drawContentToPdfContext{
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">沙盒路径（也就是我们应用程序文件运行的路径）</span>
    NSArray *paths=<span style="line-height:1.8;">NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    NSString </span>*path=[[paths firstObject] stringByAppendingPathComponent:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">myPDF.pdf</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    NSLog(</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">%@</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">,path);
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">启用pdf图形上下文</span>
    <span style="line-height:1.8;color:rgb(0,128,0);">/*</span><span style="line-height:1.8;color:rgb(0,128,0);">*
     path:保存路径
     bounds:pdf文档大小，如果设置为CGRectZero则使用默认值：612*792
     pageInfo:页面设置,为nil则不设置任何信息
     </span><span style="line-height:1.8;color:rgb(0,128,0);">*/</span><span style="line-height:1.8;">
    UIGraphicsBeginPDFContextToFile(path,CGRectZero,[NSDictionary dictionaryWithObjectsAndKeys:</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Kenshin Cui</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">,kCGPDFContextAuthor, nil]);
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">由于pdf文档是分页的，所以首先要创建一页画布供我们绘制</span>
<span style="line-height:1.8;">    UIGraphicsBeginPDFPage();
 
    NSString </span>*title=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Welcome to Apple Support</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    NSMutableParagraphStyle </span>*style=<span style="line-height:1.8;">[[NSMutableParagraphStyle alloc]init];
    NSTextAlignment align</span>=<span style="line-height:1.8;">NSTextAlignmentCenter;
    style.alignment</span>=<span style="line-height:1.8;">align;
    [title drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">26</span>, <span style="line-height:1.8;color:rgb(128,0,128);">20</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">50</span>) withAttributes:@{NSFontAttributeName:[UIFont systemFontOfSize:<span style="line-height:1.8;color:rgb(128,0,128);">18</span><span style="line-height:1.8;">],NSParagraphStyleAttributeName:style}];
    NSString </span>*content=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Learn about Apple products, view online manuals, get the latest downloads, and more. Connect with other Apple users, or get service, support, and professional advice from Apple.</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    NSMutableParagraphStyle </span>*style2=<span style="line-height:1.8;">[[NSMutableParagraphStyle alloc]init];
    style2.alignment</span>=<span style="line-height:1.8;">NSTextAlignmentLeft;
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    style2.firstLineHeadIndent=20;</span>
    [content drawInRect:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">26</span>, <span style="line-height:1.8;color:rgb(128,0,128);">56</span>, <span style="line-height:1.8;color:rgb(128,0,128);">300</span>, <span style="line-height:1.8;color:rgb(128,0,128);">255</span>) withAttributes:@{NSFontAttributeName:[UIFont systemFontOfSize:<span style="line-height:1.8;color:rgb(128,0,128);">15</span><span style="line-height:1.8;">],NSForegroundColorAttributeName:[UIColor grayColor],NSParagraphStyleAttributeName:style2}];
 
    UIImage </span>*image=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">applecare_folks_tall.png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [image drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">316</span>, <span style="line-height:1.8;color:rgb(128,0,128);">20</span>, <span style="line-height:1.8;color:rgb(128,0,128);">290</span>, <span style="line-height:1.8;color:rgb(128,0,128);">305</span><span style="line-height:1.8;">)];
 
    UIImage </span>*image2=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">applecare_page1.png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [image2 drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">6</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">600</span>, <span style="line-height:1.8;color:rgb(128,0,128);">281</span><span style="line-height:1.8;">)];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">创建新的一页继续绘制其他内容</span>
<span style="line-height:1.8;">    UIGraphicsBeginPDFPage();
    UIImage </span>*image3=[UIImage imageNamed:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">applecare_page2.png</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [image3 drawInRect:CGRectMake(</span><span style="line-height:1.8;color:rgb(128,0,128);">6</span>, <span style="line-height:1.8;color:rgb(128,0,128);">20</span>, <span style="line-height:1.8;color:rgb(128,0,128);">600</span>, <span style="line-height:1.8;color:rgb(128,0,128);">629</span><span style="line-height:1.8;">)];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">结束pdf上下文</span>
<span style="line-height:1.8;">    UIGraphicsEndPDFContext();
}
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><img src="https://images2015.cnblogs.com/blog/791499/201603/791499-20160318110343365-1662203991.png" alt="" style="border:0px;"></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>知识补充</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">1.Core Graphics是基于C语言的一套框架，开发时无法像使用Obj-C一样调用；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">2.在Quartz 2D中凡是使用带有“Create”或者“Copy”关键字方法创建的对象，在使用后一定要使用对应的方法释放（由于这个框架基于C语言编写无法自动释放内存）；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">3.Quartz 2D是跨平台的，因此其中的方法中不能使用UIKit中的对象（UIKit只有iOS可用），例如用到的颜色只能用CGColorRef而不能用UIColor，但是UIKit中提供了对应的转换方法；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">4.在C语言中枚举一般以“k”开头，由于Quartz 2D基于C语言开发，所以它也不例外（参数中很多枚举都是k开头的）；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">5.由于Quartz 2D是Core Graphics的一部分，所以API多数以CG开头；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">6.在使用Quartz 2D绘图API中所有以“Ref”结尾对象，在声明时都不必声明为指针类型；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">7.在使用Quartz 2D绘图API时，凡是“UI”开头的相关绘图函数，都是UIKit对Core Graphics的封装（主要为了简化绘图操作）；</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;"><strong>Core Image</strong></span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">利用Quartz 2D我们可以绘制各类图形、图像，功能确实强大。用过photoshop的朋友都知道，使用photoshop可以制作各种滤镜特效，那么在iOS中能否实现滤镜呢？在iOS5.0之前这些算法基本全部要靠程序员编程实现，实现过程相当复杂。从iOS5.0开始苹果官方已经提供了Core Image框架来帮助开发者进行特效制作。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">先来看一下滤镜使用过程中常用的基类对象：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">CIContext：图像上下文，用于管理整个图片处理过程，不同的图形上下文将利用不同的图像处理硬件进行图像处理（在iOS中可以通过不同的方式创建图像上下文，例如可以创建基于CPU的图像上下方、创建基于GPU的图像上下方以及创建OpenGL优化过的图像上下文）。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">CIFilter：图像处理滤镜，每种滤镜有不同的参数设置。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">CIImage：Core Image框架中的图像类型，主要用于输入和输出图像。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在使用滤镜之前我们先要弄清平台主要支持哪些滤镜，以及这些滤镜的方法和参数如何设置，此时不妨使用下面的方法进行打印查看：</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,0,255);">#pragma</span> mark 查看所有内置滤镜
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)showAllFilters{
    NSArray </span>*filterNames=<span style="line-height:1.8;">[CIFilter filterNamesInCategory:kCICategoryBuiltIn];
    </span><span style="line-height:1.8;color:rgb(0,0,255);">for</span> (NSString *filterName <span style="line-height:1.8;color:rgb(0,0,255);">in</span><span style="line-height:1.8;"> filterNames) {
        CIFilter </span>*filter=<span style="line-height:1.8;">[CIFilter filterWithName:filterName];
        NSLog(</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">rfilter:%@rattributes:%@</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">,filterName,[filter attributes]);
    }
}</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在iOS7中打印会发现有127种滤镜，如果我们把每种滤镜都介绍一遍恐怕用几章内容也很难介绍详细，事实上也没有这个必要。这些滤镜使用方法是类似的，只是参数设置有所区别。在iOS文档中可以搜索“core image filter reference”一节的内容，里面有每种滤镜的详细介绍和图片使用效果。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">使用Core Image框架创建滤镜效果一般分为以下几步：</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">1.创建图像上下文CIContext</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">2.创建滤镜CIFilter</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">3.创建过滤原图片CIImage</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">4.调用CIFilter的setValue： forKey：方法为滤镜指定源图片</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">5.设置滤镜参数【可选】</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">6.取得输出图片显示或保存</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">大家都知道在美图秀秀中有一个“增强”功能，利用它可以调整照片的饱和度、亮度、对比度，其实在Core Image中也有这样一款滤镜，下面就以颜色滤镜来演示一下Core Image中滤镜的使用。</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  KCMainViewController.m
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  CoreImage
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span>
<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Created by Kenshin Cui on 14-3-17.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">  Copyright (c) 2014年 Kenshin Cui. All rights reserved.
</span><span style="line-height:1.8;color:rgb(0,128,0);">//
</span> 
<span style="line-height:1.8;color:rgb(0,0,255);">#import</span> <span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;color:rgb(128,0,0);">KCMainViewController.h</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>
<span style="line-height:1.8;color:rgb(0,0,255);">#define</span> CONSTROLPANEL_FONTSIZE 12
 
<span style="line-height:1.8;color:rgb(0,0,255);">@interface</span><span style="line-height:1.8;"> KCMainViewController (){
    UIImagePickerController </span>*_imagePickerController;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">系统照片选择控制器</span>
    UIImageView *_imageView;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">图片显示控件</span>
    CIContext *_context;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">Core Image上下文</span>
    CIImage *_image;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">我们要编辑的图像</span>
    CIImage *_outputImage;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">处理后的图像</span>
    CIFilter *_colorControlsFilter;<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">色彩滤镜</span>
<span style="line-height:1.8;">}
 
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span>
 
<span style="line-height:1.8;color:rgb(0,0,255);">@implementation</span><span style="line-height:1.8;"> KCMainViewController
 
</span>- (<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)viewDidLoad {
    [super viewDidLoad];
 
    [self initLayout];
}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 初始化布局</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)initLayout{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">初始化图片选择器</span>
    _imagePickerController=<span style="line-height:1.8;">[[UIImagePickerController alloc]init];
    _imagePickerController.</span><span style="line-height:1.8;color:rgb(0,0,255);">delegate</span> =<span style="line-height:1.8;">self;
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">创建图片显示控件</span>
    _imageView=[[UIImageView alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">64</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">502</span><span style="line-height:1.8;">)];
    _imageView.contentMode</span>=<span style="line-height:1.8;">UIViewContentModeScaleAspectFit;
    [self.view addSubview:_imageView];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">上方导航按钮</span>
    self.navigationItem.title=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Enhance</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    self.navigationItem.leftBarButtonItem</span>=[[UIBarButtonItem alloc]initWithTitle:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Open</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> style:UIBarButtonItemStyleDone target:self action:@selector(openPhoto:)];
    self.navigationItem.rightBarButtonItem</span>=[[UIBarButtonItem alloc]initWithTitle:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Save</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;"> style:UIBarButtonItemStyleDone target:self action:@selector(savePhoto:)];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">下方控制面板</span>
    UIView *controlView=[[UIView alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">0</span>, <span style="line-height:1.8;color:rgb(128,0,128);">450</span>, <span style="line-height:1.8;color:rgb(128,0,128);">320</span>, <span style="line-height:1.8;color:rgb(128,0,128);">118</span><span style="line-height:1.8;">)];
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    controlView.alpha=0.2;
</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    controlView.backgroundColor=[UIColor colorWithRed:46.0/255.0 green:178.0/255.0 blue:235.0/255.0 alpha:1];</span>
<span style="line-height:1.8;">    [self.view addSubview:controlView];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">饱和度(默认为1，大于饱和度增加小于1则降低)</span>
    UILabel *lbSaturation=[[UILabel alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">60</span>, <span style="line-height:1.8;color:rgb(128,0,128);">25</span><span style="line-height:1.8;">)];
    lbSaturation.text</span>=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Saturation</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    lbSaturation.font</span>=<span style="line-height:1.8;">[UIFont systemFontOfSize:CONSTROLPANEL_FONTSIZE];
    [controlView addSubview:lbSaturation];
    UISlider </span>*sldStaturation=[[UISlider alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">80</span>, <span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">230</span>, <span style="line-height:1.8;color:rgb(128,0,128);">30</span>)];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">注意UISlider高度虽然无法调整，很多朋友会说高度设置位0即可，事实上在iOS7中设置为0后是无法拖动的</span>
<span style="line-height:1.8;">    [controlView addSubview:sldStaturation];
    sldStaturation.minimumValue</span>=<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">;
    sldStaturation.maximumValue</span>=<span style="line-height:1.8;color:rgb(128,0,128);">2</span><span style="line-height:1.8;">;
    sldStaturation.value</span>=<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
    [sldStaturation addTarget:self action:@selector(changeStaturation:) forControlEvents:UIControlEventValueChanged];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">亮度(默认为0)</span>
    UILabel *lbBrightness=[[UILabel alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">40</span>, <span style="line-height:1.8;color:rgb(128,0,128);">60</span>, <span style="line-height:1.8;color:rgb(128,0,128);">25</span><span style="line-height:1.8;">)];
    lbBrightness.text</span>=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Brightness</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    lbBrightness.font</span>=<span style="line-height:1.8;">[UIFont systemFontOfSize:CONSTROLPANEL_FONTSIZE];
    [controlView addSubview:lbBrightness];
    UISlider </span>*sldBrightness=[[UISlider alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">80</span>, <span style="line-height:1.8;color:rgb(128,0,128);">40</span>, <span style="line-height:1.8;color:rgb(128,0,128);">230</span>, <span style="line-height:1.8;color:rgb(128,0,128);">30</span><span style="line-height:1.8;">)];
    [controlView addSubview:sldBrightness];
    sldBrightness.minimumValue</span>=-<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
    sldBrightness.maximumValue</span>=<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
    sldBrightness.value</span>=<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">;
    [sldBrightness addTarget:self action:@selector(changeBrightness:) forControlEvents:UIControlEventValueChanged];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">对比度(默认为1)</span>
    UILabel *lbContrast=[[UILabel alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">10</span>, <span style="line-height:1.8;color:rgb(128,0,128);">70</span>, <span style="line-height:1.8;color:rgb(128,0,128);">60</span>, <span style="line-height:1.8;color:rgb(128,0,128);">25</span><span style="line-height:1.8;">)];
    lbContrast.text</span>=<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Contrast</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">;
    lbContrast.font</span>=<span style="line-height:1.8;">[UIFont systemFontOfSize:CONSTROLPANEL_FONTSIZE];
    [controlView addSubview:lbContrast];
    UISlider </span>*sldContrast=[[UISlider alloc]initWithFrame:CGRectMake(<span style="line-height:1.8;color:rgb(128,0,128);">80</span>, <span style="line-height:1.8;color:rgb(128,0,128);">70</span>, <span style="line-height:1.8;color:rgb(128,0,128);">230</span>, <span style="line-height:1.8;color:rgb(128,0,128);">30</span><span style="line-height:1.8;">)];
    [controlView addSubview:sldContrast];
    sldContrast.minimumValue</span>=<span style="line-height:1.8;color:rgb(128,0,128);">0</span><span style="line-height:1.8;">;
    sldContrast.maximumValue</span>=<span style="line-height:1.8;color:rgb(128,0,128);">2</span><span style="line-height:1.8;">;
    sldContrast.value</span>=<span style="line-height:1.8;color:rgb(128,0,128);">1</span><span style="line-height:1.8;">;
    [sldContrast addTarget:self action:@selector(changeContrast:) forControlEvents:UIControlEventValueChanged];
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">初始化CIContext
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">创建基于CPU的图像上下文
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    NSNumber *number=[NSNumber numberWithBool:YES];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    NSDictionary *option=[NSDictionary dictionaryWithObject:number forKey:kCIContextUseSoftwareRenderer];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    _context=[CIContext contextWithOptions:option];</span>
    _context=[CIContext contextWithOptions:nil];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">使用GPU渲染，推荐,但注意GPU的CIContext无法跨应用访问，例如直接在UIImagePickerController的完成方法中调用上下文处理就会自动降级为CPU渲染，所以推荐现在完成方法中保存图像，然后在主程序中调用
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    EAGLContext *eaglContext=[[EAGLContext alloc]initWithAPI:kEAGLRenderingAPIOpenGLES1];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">    _context=[CIContext contextWithEAGLContext:eaglContext];</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">OpenGL优化过的图像上下文
 
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">取得滤镜</span>
    _colorControlsFilter=[CIFilter filterWithName:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">CIColorControls</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
 
}
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 打开图片选择器</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)openPhoto:(UIBarButtonItem *<span style="line-height:1.8;">)btn{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">打开图片选择器</span>
<span style="line-height:1.8;">    [self presentViewController:_imagePickerController animated:YES completion:nil];
}
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 保存图片</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)savePhoto:(UIBarButtonItem *<span style="line-height:1.8;">)btn{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">保存照片到相册</span>
<span style="line-height:1.8;">    UIImageWriteToSavedPhotosAlbum(_imageView.image, nil, nil, nil);
    UIAlertView </span>*alert=[[UIAlertView alloc]initWithTitle:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Sytem Info</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> message:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">Save Success!</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span> <span style="line-height:1.8;color:rgb(0,0,255);">delegate</span>:nil cancelButtonTitle:nil otherButtonTitles:<span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">OK</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">, nil];
    [alert show];
}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 图片选择器选择图片代理方法</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *<span style="line-height:1.8;">)info{
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">关闭图片选择器</span>
<span style="line-height:1.8;">    [self dismissViewControllerAnimated:YES completion:nil];
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">取得选择图片</span>
    UIImage *selectedImage=<span style="line-height:1.8;">[info objectForKey:UIImagePickerControllerOriginalImage];
    _imageView.image</span>=<span style="line-height:1.8;">selectedImage;
    </span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">初始化CIImage源图像</span>
    _image=<span style="line-height:1.8;">[CIImage imageWithCGImage:selectedImage.CGImage];
    [_colorControlsFilter setValue:_image forKey:</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">inputImage</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">设置滤镜的输入图片</span>
<span style="line-height:1.8;">}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 将输出图片设置到UIImageView</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span><span style="line-height:1.8;">)setImage{
    CIImage </span>*outputImage= [_colorControlsFilter outputImage];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">取得输出图像</span>
    CGImageRef temp=<span style="line-height:1.8;">[_context createCGImage:outputImage fromRect:[outputImage extent]];
    _imageView.image</span>=[UIImage imageWithCGImage:temp];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">转化为CGImage显示在界面中</span>
<span style="line-height:1.8;"> 
    CGImageRelease(temp);</span><span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">释放CGImage对象</span>
<span style="line-height:1.8;">}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 调整饱和度</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)changeStaturation:(UISlider *<span style="line-height:1.8;">)slider{
    [_colorControlsFilter setValue:[NSNumber numberWithFloat:slider.value] forKey:</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">inputSaturation</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span>];<span style="line-height:1.8;color:rgb(0,128,0);">//</span><span style="line-height:1.8;color:rgb(0,128,0);">设置滤镜参数</span>
<span style="line-height:1.8;">    [self setImage];
}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 调整亮度</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)changeBrightness:(UISlider *<span style="line-height:1.8;">)slider{
    [_colorControlsFilter setValue:[NSNumber numberWithFloat:slider.value] forKey:</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">inputBrightness</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [self setImage];
}
 
</span><span style="line-height:1.8;color:rgb(128,0,0);">#pragma mark 调整对比度</span>
-(<span style="line-height:1.8;color:rgb(0,0,255);">void</span>)changeContrast:(UISlider *<span style="line-height:1.8;">)slider{
    [_colorControlsFilter setValue:[NSNumber numberWithFloat:slider.value] forKey:</span><span style="line-height:1.8;color:rgb(128,0,0);">@"</span><span style="line-height:1.8;color:rgb(128,0,0);">inputContrast</span><span style="line-height:1.8;color:rgb(128,0,0);">"</span><span style="line-height:1.8;">];
    [self setImage];
}
</span><span style="line-height:1.8;color:rgb(0,0,255);">@end</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.8;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">次给大家强调一下：</span><span style="line-height:1.8;font-family:'楷体';font-size:18px;">&nbsp;</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">在上面的代码中除了使用了基于GPU的图像上下文(推荐方式)，也创建了其他图像上下文，尽管已经被注释大家还是需要熟悉。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">Core Image允许你一次给图像或视频帧叠加多种效果，同时Core Image还能保证强大的处理效率。</span></p> 
    <p><span style="line-height:1.8;font-family:'楷体';font-size:18px;">和在使用Core Graphics绘图一样，UIKit中也封装了一些方法直接转换为Core Image中的对象，例如UIImage对象可以直接调用CIImage属性转换为CIImage类型。</span></p> 
   </div> 
   <div style="color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;">
    程序猿神奇的手，每时每刻，这双手都在改变着世界的交互方式！
   </div> 
   <div class="clear" style="clear:both;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:25.2px;"></div> 
   <div> 
    <div> 
     <font color="#333333"><span style="font-size:14px;line-height:25.2px;">本文转自当天真遇到现实博客园博客，原文链接：http://www.cnblogs.com/XYQ-208910/p/5291266.html</span></font>
     <span style="font-size:14px;line-height:25.2px;color:rgb(51,51,51);font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
