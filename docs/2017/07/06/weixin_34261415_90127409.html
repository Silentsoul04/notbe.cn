<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Linux 邮件服务器 之跟我一步一步来实现一个邮件系统【转】 « NotBeCN</title>
  <meta name="description" content="             转自：http://tchuairen.blog.51cto.com/3848118/1686875/        原创作品，允许转载，转载时请务必以超链接形式标明文章     原始出处 、作者信息和本声明。否则将追究法律责任。    http://tchuairen.blog.51c...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/07/06/weixin_34261415_90127409.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Linux 邮件服务器 之跟我一步一步来实现一个邮件系统【转】</h1>
    <p class="post-meta">Jul 6, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p>转自：<a href="http://tchuairen.blog.51cto.com/3848118/1686875/" rel="nofollow">http://tchuairen.blog.51cto.com/3848118/1686875/</a></p> 
   <div class="CopyrightStatement lh22">
    原创作品，允许转载，转载时请务必以超链接形式标明文章 
    <a style="text-decoration:underline;" href="http://tchuairen.blog.51cto.com/3848118/1686875" rel="nofollow">原始出处</a> 、作者信息和本声明。否则将追究法律责任。
    <a href="http://tchuairen.blog.51cto.com/3848118/1686875" rel="nofollow">http://tchuairen.blog.51cto.com/3848118/1686875</a> 
   </div> 
   <div class="showContent"> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';">上一篇介绍了邮件服务器的各组件功能和原理，这次来由浅的入深来一步步实现一个邮件系统。<br></span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';">实验环境：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">操作系统</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">CentOS release 5.11 64位</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">postfix-2.11.6</span></td> 
      </tr>
      <tr>
       <td colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">courier-authlib-0.64.0</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cyrus-sasl-2.1.22-7.el5_8.1</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cyrus-sasl-plain-2.1.22-7.el5_8.1</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">dovecot.x86_64 0:1.0.7-8.el5_9.1</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">extman-1.1</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">extmail-1.2</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;line-height:21px;">Unix-Syslog-1.1</span></td> 
      </tr>
     </tbody>
    </table>
    <p style="text-align:left;"><strong><span style="font-size:18px;font-family:'微软雅黑', 'Microsoft YaHei';color:#ff0000;">一、安装postfix，建立基本配置</span></strong></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">postfix安装过程（略）详细可见上一篇博文</span></p> 
    <p>&nbsp;</p> 
    <p><a href="http://tchuairen.blog.51cto.com/3848118/1684872" rel="nofollow">http://tchuairen.blog.51cto.com/3848118/1684872</a></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">1、编辑配置文件"&nbsp;/etc/postfix/main.cf " 定义如下内容：</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="bash plain">myhostname&nbsp;=&nbsp;mail.qupeiyin.net</code>
           </div> 
           <div class="line number2 index1 alt1">
            <code class="bash plain">myorigin&nbsp;=&nbsp;$mydomain</code>
           </div> 
           <div class="line number3 index2 alt2">
            <code class="bash plain">mydomain&nbsp;=&nbsp;qupeiyin.net</code>
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">mydestination&nbsp;=&nbsp;$myhostname,&nbsp;localhost.$mydomain,&nbsp;localhost,$mydomain</code>
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="bash plain">mynetworks&nbsp;=&nbsp;127.0.0.0</code>
            <code class="bash plain">/8</code>
            <code class="bash plain">,mynetworks</code> 
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">参数说明：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">myhostname</span></td> 
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">主机名，与host那么相同。</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">myorigin</span></td> 
       <td valign="top"><span style="line-height:24px;font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">发件人地址域</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-size:14px;line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';">mydomain &nbsp;</span></td> 
       <td valign="top"><span style="line-height:24px;font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">所在域</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mydestination</span></td> 
       <td valign="top"><span style="line-height:24px;font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">目标收件地址</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">mynetworks&nbsp;</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">可以被中继的客户端网段</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">alias_map = hash:/etc/aliases</span></td> 
       <td valign="top"><span style="line-height:24px;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">别名查找表</span></td> 
      </tr>
     </tbody>
    </table>
    <p><span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">2、<span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;line-height:21px;">安装dovecot实现邮件接收<br></span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">yum install dovecot -y</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件 /etc/dovecot/dovecot.conf&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">启用协议</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">protocols = imap pop3</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">启动dovecot服务</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">/etc/init.d/dovecot start</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">启动成功后会监听端口：<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">imap4：143/tcp，<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">pop3：110/tcp 以<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">明文方式工作；</span></span></span></span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">3、postfix + SASL 用户认证</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">saslauthd -v &nbsp;显示当前主机saslauthd服务所支持的验证方式</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">修改验证方式</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">vim /etc/sysconfig/saslauthd</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_5156044654578fd379db267867a4cd2c.jpg" rel="nofollow"><img title="1.png" src="https://yqfile.alicdn.com/img_5156044654578fd379db267867a4cd2c.jpg" alt="wKioL1XW0dyhUPUwAAC5iR3uOhs552.jpg"></a></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">启动saslauthd服务</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">/etc/init.d/saslauthd start</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">设置开机启动</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chkconfig saslauthd on</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">测试验证机制是否可用，出现OK表示正常；</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">testsaslauthd -u username-p pass</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">0: OK "Success."</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">邮箱格式：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mbox：一个文件存储所有邮件</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">maildir：一个文件存储一封邮件，所有邮件存储在一个目录中；</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">#home_mailbox = Mailbox &nbsp;定义邮箱格式</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">#home_mailbox = Maildir/</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">#mail_spool_directory = /var/mail &nbsp; 定义maildir格式邮箱文件的保存路径</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;font-size:14px;">4、让postfix支持sasl认证功能</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件 /etc/postfix/main.cf 添加如下内容：</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="bash plain">broken_sasl_auth_clients&nbsp;=&nbsp;</code>
            <code class="bash functions">yes</code> 
           </div> 
           <div class="line number2 index1 alt1">
            <code class="bash plain">smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject_invalid_hostname,reject_non_fqdn_hostname,reject_unknown_sender_domain,reject_non_fqdn_sender,reject_non_fqdn_recipient,reject_unknown_recipient_domain,reject_unauth_pipelining,reject_unauth_destination</code>
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="bash plain">smtpd_sasl_auth_enable&nbsp;=&nbsp;</code>
            <code class="bash functions">yes</code> 
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">smtpd_sasl_local_domain&nbsp;=&nbsp;$myhostname</code>
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">smtpd_sasl_security_options&nbsp;=&nbsp;noanonymous</code>
           </div> 
           <div class="line number6 index5 alt1">
            <code class="bash plain">smtpd_sasl_path&nbsp;=&nbsp;smtpd</code>
           </div> 
           <div class="line number7 index6 alt2">
            <code class="bash plain">smtpd_banner&nbsp;=&nbsp;Welcome&nbsp;to&nbsp;our&nbsp;Server&nbsp;!</code>
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">参数说明：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">broken_sasl_auth_clients&nbsp;</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">是否要通过SASL验证客户端身份</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_recipient_restrictions&nbsp;</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">定义收件人限制</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_sasl_auth_enable&nbsp;<span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">= yes</span></span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">启用SASL认证功能</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_sasl_local_domain = $myhostname&nbsp;</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">基于SASL认证的时候指定本地的域</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_sasl_security_options</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">SASL认证的安全选项，noanonymous表示不支持匿名用户</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_sasl_path = smtpd</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">指定使用SASL的服务器程序</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_banner&nbsp;</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">定义登陆时候的欢迎信息</span></td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2" valign="top">&nbsp;</td> 
      </tr>
      <tr>
       <td rowspan="1" colspan="2">&nbsp;</td> 
      </tr>
     </tbody>
    </table>
    <p><span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';">参数说明（二）：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">permit_mynetworks</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">允许本地网络</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">permit_sasl_authenticated</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">允许SASL验证通过的用户</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_invalid_hostname</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝不合法的主机名的主机来收发邮件</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_non_fqdn_hostname</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝不是fqdn格式主机名的主机</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_unknown_sender_domain</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝无法识别的发件人域</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_non_fqdn_sender</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝没有fqdn的发件人</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_non_fqdn_recipient</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝没有fqdn的收件人</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_unknown_recipient_domain</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝无法识别的收件人域</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_unauth_pipelining</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">无法验证的管道</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">reject_unauth_destination</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">拒绝无法验证的目标地址</span></td> 
      </tr>
     </tbody>
    </table>
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件/usr/lib64/sasl2/smtpd.conf 添加如下内容：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">pwcheck_method:saslauthd</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mech_list:PLAIN LOGIN</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">log_level:3</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">当需要调试的时候，打开log_level可以输出更为详细的信息。</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;color:#0070c0;">5、实现postfix基于客户端的访问控制</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">在配置文件"/etc/postfix/main.cf"使用如下参数控制：</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="bash plain">smtpd_client_restrictions=&nbsp;</code>
           </div> 
           <div class="line number2 index1 alt1">
            <code class="bash plain">smtpd_data_restrictions=&nbsp;</code>
           </div> 
           <div class="line number3 index2 alt2">
            <code class="bash plain">smtpd_helo_restrictions=&nbsp;&nbsp;</code>
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">smtpd_recipient_restrictions&nbsp;=&nbsp;permit_mynetworks,reject_unauth_destination</code>
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">smtpd_sender_restrictions=</code>
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;color:#0070c0;">参数说明：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_client_restrictions</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">用于限定符合条件的才允许连接服务器</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_data_restrictions</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">用于限定符合条件的用户才允许发送data指令</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_helo_restrictions</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">用于限定符合条件的用户才允许发送helo指令</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_recipient_restrictions</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">用于限定符合条件的用户才允许发送rcpt to指令</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">smtpd_sender_restrictions</span></td> 
       <td valign="top"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">用于限定符合条件的用户才允许发送mail from指令</span></td> 
      </tr>
     </tbody>
    </table>
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">内置限制条件：（更多参考postfix手册）</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">reject_unauth_destination-拒绝未经认证的目标<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">permit_mynetworks-该网段的主机可以被中继</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件 /usr/lib64/sasl2/smtpd.conf 添加以下内容：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">pwcheck_method:saslauthd</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mech_list:PLAIN LOGIN</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">访问控制文件</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp; &nbsp; /etc/postfix/access</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp; &nbsp; python@admin.com&nbsp;reject</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp; &nbsp; microsoft.com ok</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">规则编写格式：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">pattern &nbsp;action</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">邮件地址的pattern格式如下：</span></p> 
    <table>
     <tbody>
      <tr>
       <td valign="top"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;line-height:21px;">user@domain</span></td> 
       <td valign="top"><span style="font-family:'Microsoft Yahei';font-size:14px;line-height:21px;">用于匹配指定邮件地址</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'Microsoft Yahei';font-size:14px;line-height:21px;">domain.tld</span></td> 
       <td valign="top"><span style="font-family:'Microsoft Yahei';font-size:14px;line-height:21px;">用于匹配以此域名作为邮件地址中的域名部分的所有邮件地址</span></td> 
      </tr>
      <tr>
       <td valign="top"><span style="font-family:'Microsoft Yahei';font-size:14px;line-height:21px;">user@</span></td> 
       <td valign="top"><span style="font-family:'Microsoft Yahei';font-size:14px;line-height:21px;">用于匹配以此作为邮件地址中用户名部分的所有邮件地址</span></td> 
      </tr>
     </tbody>
    </table>
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">主机名称/地址 pattern格式如下：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">ip &nbsp; &nbsp;用于匹配特定的IP地址或网络内的所有主机</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">network /mask &nbsp;CIDR格式，匹配指定网络内的所有主机</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">关于action</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">ok 接受其pattern匹配的邮件地址或主机名称/地址</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">拒绝部分：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">4NN text</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">5NN text</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp; &nbsp; 其中4NN类表示过一会重试，5NN类表示严重错误。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">REJECT optional text &nbsp;拒绝；text为可选信息</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">DEFER &nbsp;optional text &nbsp;拒绝；text为可选信息</span></p> 
    <p>&nbsp;</p> 
    <p><span style="color:#00b050;font-family:'微软雅黑';font-size:14px;line-height:21px;">自定义访问表的条件通常使用check_client_access，check_helo_access，check_sender_access，check_<span>recipient_access 进行，他们后面通常跟上type:mapname格式的访问类型和名称。其中，<span>check_sender_access，check_<span>recipient_access<span>&nbsp;用来检查客户端提供的邮件地址，其访问表中可以使用完整的邮件地址，如admin@tuchao.com；也可以只使用域名，如果tuchao.com，还可以只有用户名的部分，如hadoop@。</span></span></span></span></span></p> 
    <p>&nbsp;</p> 
    <p><span style="color:#31859b;"><strong><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">实例演示（一）：</span></strong></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';line-height:21px;">拒绝ip：115.204.89.87 &nbsp;windows 客户端发送邮件</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">1、编辑 /etc/postfix/access 作为客户端检查控制文件，添加如下一行：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">115.204.89.87 REJECT</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">2、将此文件转换为hash格式</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">postmap &nbsp;/etc/postfix/access</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_905bbb9afc171a134b06d1ab77d2bdbc.jpg" rel="nofollow"><img title="3145AB1CD1B04AF291C3624D8B4E7E59.png" src="https://yqfile.alicdn.com/img_905bbb9afc171a134b06d1ab77d2bdbc.jpg" alt="wKiom1XW146AjWNGAACrfxHNbIQ692.jpg"></a></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">3、配置postfix使用此文件对客户端进行检查</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">编辑配置文件 vim /etc/postfix/main.cf 加入一行：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">smtpd_client_restrictions = check_client_access hash:/etc/postfix/access</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">注：这里的hash类型就代表了.db的文件，所以这里不要写后缀。</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">4、让postfix重新载入配置文件</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">/etc/init.d/postfix reload</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">现在使用windows上的客户端发邮件，就会看到被拒绝了；</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_4209ee557ce5fe66c2a40e999a439c38.jpg" rel="nofollow"><img title="2.png" src="https://yqfile.alicdn.com/img_4209ee557ce5fe66c2a40e999a439c38.jpg" alt="wKioL1XW2gvBlVDlAAD_peWG3l8581.jpg" width="650"></a></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#31859b;">实例演示（二）：</span></strong></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">拒绝所在域为 huairen.com 的发件人发送邮件。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">1、编辑 /etc/postfix/access 作为客户端检查控制文件，添加如下一行：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">huairen.com REJECT</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">2、将此文件转换为hash格式</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">postmap &nbsp;/etc/postfix/access</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">3、配置postfix使用此文件对客户端进行检查</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件 vim /etc/postfix/main.cf 加入一行：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">smtpd_sender_restrictions = check_sender_access hash:/etc/postfix/access</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="line-height:1.5;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">4、让postfix重新载入配置文件</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">/etc/init.d/postfix reload</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">修改客户端的发件人地址，我这里使用的Outlook。 文件—账户设置—找到自己的邮箱地址—更改；</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_7c7bc5cd108ec532a256bf898b2d92ed.jpg" rel="nofollow"><img title="3.png" src="https://yqfile.alicdn.com/img_7c7bc5cd108ec532a256bf898b2d92ed.jpg" alt="wKiom1XW2caxnmybAACGobaeYLk257.jpg"></a></p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;color:#31859b;">然后尝试发一封邮件出去</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_7036729bb357d15d766e810c3e3b1483.jpg" rel="nofollow"><img title="4.png" src="https://yqfile.alicdn.com/img_7036729bb357d15d766e810c3e3b1483.jpg" alt="wKioL1XW2-TCArFGAAEPircNzhQ948.jpg" width="650"></a></p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">可以明显看到拒绝信息，Sender address rejected：Access denied</span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#31859b;">实例演示（三）：</span></strong></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">拒绝所有邮件头部用户名为tuchao的地址发邮件</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">1、添加一个访问控制文件 /etc/postfix/mailhostdeny 作为客户端检查控制文件，添加如下一行：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">tuchao@ REJECT</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">2、将此文件转换为hash格式</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">postmap &nbsp;/etc/postfix/mailhostdeny<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">3、配置postfix使用此文件对客户端进行检查</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑配置文件 vim /etc/postfix/main.cf 加入一行：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">smtpd_recipient_restrictions = check_recipient_access hash:/etc/postfix/mailhostdeny,permit_mynetworks,reject_unauth_destination</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">注：在smtpd_recipient_restrictions配置中，必须要有两个内置参数permit_mynetworks,reject_unauth_destination，如果需要加入其他参数，这两个内置参数放到最后。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">4、让postfix重新载入配置文件</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">/etc/init.d/postfix reload</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">尝试给tuchao@qupeiyin.net发送邮件</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_53dfd4a3ea3c870893d7ebbdcc648398.jpg" rel="nofollow"><img title="5.png" src="https://yqfile.alicdn.com/img_53dfd4a3ea3c870893d7ebbdcc648398.jpg" alt="wKiom1XW2k6QnJWzAADmcX2X-94712.jpg" width="650"></a></p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">可以看到收件人不符合要求被拒绝了</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">邮件别名的使用</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编辑别名配置文件 /etc/aliases 加入如下两行：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">a: &nbsp; &nbsp;python&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">tuchao:&nbsp;&nbsp;1183710107@qq.com</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">newaliases &nbsp;执行此命令用于生成别名文件的hash格式，便于查找，每次修改过aliases文件都要执行。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">说明：a：表示把所有发给本地a用户的邮件，全部转发给本地的python用户，这里a用户不存在也没关系服务器能识别到别名就可以了。 &nbsp;把所有发给本地tuchao用户的邮件。全部转发至1183710107@qq.com。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">给a用户发送邮件测试</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_9fe7dffb59184bf1b8cb753b7253710b.jpg" rel="nofollow"><img title="6.png" src="https://yqfile.alicdn.com/img_9fe7dffb59184bf1b8cb753b7253710b.jpg" alt="wKiom1XW2tDg7Q2_AACNZkgBllg945.jpg"></a></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">给tuchao用户发邮件</span></p> 
    <p><a href="https://yqfile.alicdn.com/img_257f987e874a724c5ad541edf14fafc4.jpg" rel="nofollow"><img title="7.png" src="https://yqfile.alicdn.com/img_257f987e874a724c5ad541edf14fafc4.jpg" alt="wKiom1XW2uSRvLwfAAF7xWxS5S4458.jpg"></a></p> 
    <p>&nbsp;</p> 
    <p><span style="color:#0070c0;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;">过程中遇到的错误记录</span></strong></span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;color:#0070c0;">错误一、<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;line-height:21px;">-ERR Plaintext authentication<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;">&nbsp;disallowed<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;">&nbsp;on non-secure (SSL/TLS) connections.</span></span></span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#000000;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">RHEL5的dovecot都是不需要做任何修改，默认就可以使用的。<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">RHEL6对dovecot做了比较严格的默认配置，如果使用默认配置，客户端出现错：<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">-ERR Plaintext authentication<span style="font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;disallowed<span style="font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;on non-secure (SSL/TLS) connections.<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">需要修改dovecot<span style="font-family:'微软雅黑', 'Microsoft YaHei';">主配置文件/etc/dovecot/dovecot.conf：<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">protocols = imap pop3 lmtp<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">login_trusted_networks = 0.0.0.0/0<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">设置/etc/dovecot/conf.d/10-mail.conf配置文件如下：<br style="font-family:'微软雅黑';font-size:14px;line-height:21px;"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">mail_location = mbox:~/mail:INBOX=/var/mail/%u</span></span></span></span></span></span></span></span></span></span></span></span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">设置完mail_location值后，需要重启dovecot服务，同时需要创建相关的目录，否则还会出现如下错误：</span></strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;"><br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#00b050;">freebsd# telnet 192.168.50.24 110<br>Trying 192.168.50.24...<br>Connected to 192.168.50.24.<br>Escape character is '^]'.<br>+OK Dovecot ready. &lt;2781.1.4d106bc3.JFuUEG+bO68ixpY2W1zihg==@rhel6.766.com&gt;<br>user oracle<br>+OK<br>pass oracle<br>-ERR [IN-USE] Couldn't open INBOX: Internal error occurred. Refer to server log for more information. [2010-12-21 16:56:40]<br>Connection closed by foreign host.</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#00b050;">[root@rhel6 ~]# tail -f /var/log/maillog<br>Dec 21 16:56:40 rhel6 dovecot: pop3-login: Login: user=&lt;oracle&gt;, method=PLAIN, rip=192.168.50.211, lip=192.168.50.24, mpid=10115, secured<br>Dec 21 16:56:41 rhel6 dovecot: pop3(oracle): Error: chown(/u01/oracle/mail/.imap/INBOX, -1, 12(mail)) failed: Operation not permitted (egid=501(dba), group based on</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#00b050;">/var/mail/oracle)<br>Dec 21 16:56:41 rhel6 dovecot: pop3(oracle): Error: mkdir(/u01/oracle/mail/.imap/INBOX) failed: Operation not permitted<br>Dec 21 16:56:41 rhel6 dovecot: pop3(oracle): Error: Couldn't open INBOX: Internal error occurred. Refer to server log for more information. [2010-12-21 16:56:40]<br>Dec 21 16:56:41 rhel6 dovecot: pop3(oracle): Couldn't open INBOX top=0/0, retr=0/0, del=0/0, size=0</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">在该用户家目录下创建相应的目录：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">su - tuchao</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mkdir -p mail/.imap/INBOX</span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="color:#0070c0;font-family:'微软雅黑';font-size:14px;line-height:21px;">错误二、Temporary&nbsp;lookup&nbsp;failure</span></strong></p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">通过查看日志发现是没有aliase文件导致的，所以果断的添加的这么个文件，然后postmap一下就可以了。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">postmap /etc/aliases</span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:18px;color:#ff0000;">二、构建基于虚拟用户的虚拟域邮件系统架构<br></span></strong></p> 
    <p><a href="https://yqfile.alicdn.com/img_13aa4d66a2a97a6071aaac38270ef261.jpg" rel="nofollow"><img title="无标题.png" src="https://yqfile.alicdn.com/img_13aa4d66a2a97a6071aaac38270ef261.jpg" alt="wKioL1XbIXGhkBo0AAM0oVnsDBk639.jpg" width="650"></a></p> 
    <p><span style="color:#ff0000;"><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';">1、编译安装courier-authlib</span></strong></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">官网：<a style="line-height:1.5;font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:underline;font-size:14px;" href="http://www.courier-mta.org/download.html#authlib" rel="nofollow"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">http://www.courier-mta.org/download.html#authlib</span></a></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">安装依赖的程序包，如果使用MySQL认证的话，需要安装MySQL。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">yum install libtool openssl-devel tcl tcl-devel libart-lgpl libart-lgpl-devel expect libtool-ltdl libtool-ltdl-devel -y</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">编译参数</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;./configure&nbsp;\<br>--prefix=/usr/local/courier-authlib&nbsp;\<br>--sysconfdir=/etc&nbsp;\<br>--without-authpam&nbsp;\<br>--without-authvchkpw&nbsp;\<br>--without-authpgsql&nbsp;\<br>--with-authmysql&nbsp;\<br>--with-mysql-libs=/alidata/server/mysql/lib/&nbsp;\<br>--with-mysql-includes=/alidata/server/mysql/include/&nbsp;\<br>--with-redhat&nbsp;\<br>--with-authmysqlrc=/etc/authmysqlrc&nbsp;\<br>--with-authdaemonrc=/etc/authdaemonrc&nbsp;\<br>--with-mailuser=postfix&nbsp;\<br>--with-mailgroup=postfix&nbsp;\<br>--with-ltdl-lib=/usr/lib&nbsp;\<br>--with-ltdl-include=/usr/include/&nbsp;\</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">LDFLAGS="-L/usr/lib64 -L/lib64"</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">--sysconfdir 配置文件的安装目录<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">--without-authpam 不支持pam认证<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">--with-redhat 实现基于redhat系统的优化，如果不是redhat系统不用加此参数；<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">--with-authmysqlrc 存放courier-authlib给mysql的配置文件路径<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">--with-authdaemonrc 存放该服务的配置文件路径<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">make &amp;&amp; make install&nbsp;</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">可以使用 --with-authdaemonvar=/var/spool/authdaemon 选项来指定进程套接字目录路径</span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">编译过程中遇到的错误：</span></strong></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">1、在./configure的时候出现错误 configure: error: invalid ltdl library directory: `/usr/lib64/'</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">笔者在centos6.5 64位的系统上试了多次，也确保安装了libtool-ltdl libtool-ltdl-devel，依旧不行。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">思路：当什么依赖的库和程序都安装了后，还是提示找不到，这时候就要考虑依赖的库与程序的版本不对应。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;line-height:1.5;">怀疑是<span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;line-height:1.5;">courier-authlib 版本太新和系统库不匹配，于是将courier-authlib0.66.3 降低版本到 0.66.1 ， 0.65.0，0.64.0</span></span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">这时候应该不是软件版本问题，怀疑系统版本的库与该程序不兼容。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">尝试将centos6替换为centos5.11 X86_64 ，编译courier-authlib0.64.0&nbsp;没有再出现此错误。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">2、编译出现错误 configure：error The Courier Unicode Library 1.2 appears not to be installed&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">提示Courier Unicode Library 没有安装，需要下载courier-unicode-1.2.tar.bz2 安装即可。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">./configure</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">make &amp;&amp; make install</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">3、./configure 出现错误&nbsp;<span style="font-family:song, Verdana;font-size:14px;">configure: error: –with-authmysql specified but no mysqlclient.so</span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">是因为本机上有两个MySQL，卸载原来的MySQL就可以了。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">4、编译出现错误 libltdl.so: could not read symbols: File in wrong format</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">是由于64位机器的原因，解决办法在configure的选项中加上 &nbsp;LDFLAGS="-L/usr/lib64 -L/lib64"</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">参考文档：<a style="line-height:1.5;font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:underline;font-size:14px;" href="http://wuliangxx.iteye.com/blog/656856" rel="nofollow"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">http://wuliangxx.iteye.com/blog/656856</span></a></span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">配置courier-authlib</span></strong></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">建立配置文件，和configure &nbsp;参数定义的名称一致</span></p> 
    <p><span style="color:#00b050;font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">--with-authmysqlrc=/etc/authmysqlrc&nbsp;</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';"><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#00b050;">--with-authdaemonrc=/etc/authdaemonrc&nbsp;<br>cp /etc/authdaemonrc.dist &nbsp;/etc/authdaemonrc</span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">cp /etc/authmysqlrc.dist /etc/authmysqlrc</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">编辑配置文件"/etc/authdaemonrc" &nbsp;修改以下参数：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authmodulelist="authmysql"</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authmodulelistorig="auauthmysql"</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">daemons=10</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authdaemonvar=/usr/local/courier-authlib/var/spool/authdaemon</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">DEBUG_LOGIN=0</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">参数说明：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authmodulelist &nbsp;指定支持认证的模块列表<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authmodulelistorig &nbsp;指定源模块列表<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">daemons 开启的进程数，根据负载合理设置。<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">authdaemonvar&nbsp;指定进程套接字目录路径</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">DEBUG_LOGIN 是否启动DEBUG模式记录日志，0表示不启用，2表示启用。<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">编辑配置文件 /etc/authmysqlrc&nbsp;</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> 
          <div class="line number8 index7 alt1">
           8
          </div> 
          <div class="line number9 index8 alt2">
           9
          </div> 
          <div class="line number10 index9 alt1">
           10
          </div> 
          <div class="line number11 index10 alt2">
           11
          </div> 
          <div class="line number12 index11 alt1">
           12
          </div> 
          <div class="line number13 index12 alt2">
           13
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="bash plain">MYSQL_SERVER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localhost</code>
           </div> 
           <div class="line number2 index1 alt1">
            <code class="bash plain">MYSQL_USERNAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root</code>
           </div> 
           <div class="line number3 index2 alt2">
            <code class="bash plain">MYSQL_PASSWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;redhat</code>
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="bash plain">MYSQL_SOCKET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">/tmp/mysql</code>
            <code class="bash plain">.sock&nbsp;&nbsp;连接MySQL的套接字文件</code> 
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">MYSQL_DATABASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extmail&nbsp;&nbsp;指定数据库名</code>
           </div> 
           <div class="line number6 index5 alt1">
            <code class="bash plain">MYSQL_USER_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mailbox&nbsp;&nbsp;指定用户表</code>
           </div> 
           <div class="line number7 index6 alt2">
            <code class="bash plain">MYSQL_CRYPT_PWFIELD&nbsp;&nbsp;&nbsp;&nbsp;password&nbsp;&nbsp;指定保存密码的表字段名</code>
           </div> 
           <div class="line number8 index7 alt1">
            <code class="bash plain">MYSQL_UID_FIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2525&nbsp;&nbsp;指定postfix的Uid</code>
           </div> 
           <div class="line number9 index8 alt2">
            <code class="bash plain">MYSQL_GID_FIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2525&nbsp;&nbsp;指定postfix的Gid</code>
           </div> 
           <div class="line number10 index9 alt1">
            <code class="bash plain">MYSQL_LOGIN_FIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username&nbsp;&nbsp;指定保存用户名的表字段名</code>
           </div> 
           <div class="line number11 index10 alt2"> 
            <code class="bash plain">MYSQL_HOME_FIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concat(</code>
            <code class="bash string">'/var/mailbox'</code>
            <code class="bash plain">,homedir)&nbsp;&nbsp;指定用户的邮筒位置</code> 
           </div> 
           <div class="line number12 index11 alt1">
            <code class="bash plain">MYSQL_NAME_FIELD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;指定用户的全名保存在哪个字段上</code>
           </div> 
           <div class="line number13 index12 alt2"> 
            <code class="bash plain">MYSQL_MAILDIR_FIELD&nbsp;&nbsp;&nbsp;&nbsp;concat(</code>
            <code class="bash string">'/var/mailbox/'</code>
            <code class="bash plain">,maildir)&nbsp;&nbsp;创建和用户同名的邮件目录</code> 
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">提供服务启动脚本</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cp courier-authlib-0.64.0/courier-authlib.sysvinit /etc/init.d/courier-authlib</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chmod +x /etc/init.d/courier-authlib</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chkconfig --add courier-authlib</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chkconfig courier-authlib on</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#000000;">启动服务</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">service courier-authlib start</span></p> 
    <p>&nbsp;</p> 
    <p><strong><span style="color:#ff0000;font-family:'微软雅黑', 'Microsoft YaHei';font-size:16px;">2、配置postfix支持虚拟域和虚拟用户</span></strong></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">1、编辑配置文件 /etc/postfix/main.cf 添加以下内容：</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> 
          <div class="line number8 index7 alt1">
           8
          </div> 
          <div class="line number9 index8 alt2">
           9
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="bash plain">virtual_mailbox_base&nbsp;=&nbsp;</code>
            <code class="bash plain">/var/mailbox</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="bash plain">virtual_mailbox_maps&nbsp;=&nbsp;mysql:</code>
            <code class="bash plain">/etc/postfix/mysql_virtual_mailbox_maps</code>
            <code class="bash plain">.cf</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="bash plain">virtual_mailbox_domains&nbsp;=&nbsp;mysql:</code>
            <code class="bash plain">/etc/postfix/mysql_virtual_domains_maps</code>
            <code class="bash plain">.cf</code> 
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">virtual_alias_domains&nbsp;=&nbsp;</code>
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">virtual_uid_maps&nbsp;=&nbsp;static:2525</code>
           </div> 
           <div class="line number6 index5 alt1">
            <code class="bash plain">virtual_gid_maps&nbsp;=&nbsp;static:2525</code>
           </div> 
           <div class="line number7 index6 alt2">
            <code class="bash plain">virtual_transport&nbsp;=&nbsp;virtual</code>
           </div> 
           <div class="line number8 index7 alt1">
            <code class="bash plain">mydestination&nbsp;=</code>
           </div> 
           <div class="line number9 index8 alt2">
            <code class="bash plain">local_recipient_maps&nbsp;=</code>
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">virtual_transport &nbsp;指定用户的投递代理<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">maiildrop_destination_recipient_limit &nbsp;= 1 &nbsp;定义限制，一次只投递一封邮件到一个用户邮箱。<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">maildrop_destination_concurrency_limit &nbsp;=1 一次并发只投递一封邮件</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">配额限制</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">message_size_limit = 14336000</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">virtual_mailbox_limit = 20971520</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">message_size_limit &nbsp;定义单个邮件的最大大小<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">virtual_mailbox_limit &nbsp;每个用户的邮箱最大可用空间</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">配置postfix和courier-authlib</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">新建虚拟用户邮箱所在的目录，并将权限赋予postfix用户。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mkdir &nbsp;/var/mailbox</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chown -R postfix&nbsp;/var/mailbox</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">修改配置文件 /usr/lib/sasl2/smtpd.conf &nbsp;没有则建立，加入以下内容：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">pwcheck_method:authdaemond</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">log_level:3</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mech_list:PLAIN LOGIN</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">authdaemond_path:/usr/local/courier-authlib/var/spool/authdaemon/socket</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">authdaemond_path 此参数指定的路径，是和/etc/authdaemonrc文件中authdaemonvar参数定义的路径相对应。<br></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">下载extman源码，使用其doc目录下的extmail.sql和init.sql建立数据库：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">tar xf extman-1.1.tar.gz</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cd extman-1.1/docs</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mysql &lt;extmail.sql</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">mysql &lt;init.sql</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">复制需要的配置文件</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cp mysql* /etc/postfix/</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">并且将复制过去的5个配置文件，根据实际mysql的帐号配置做相应的修改。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">对于MySQL5.1以后的版本，需要将脚本extmail.sql使用如下命令进行语法修改：</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">sed -i 's/TYPE=MyISAM/ENGINE=InnoDB/g' extmail.sql&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">如果还出现错误 BLOB/TEXT column 'question' can't have a default value 则进入脚本修改SQL语句，将text字段的default参数删除即可。</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">授权用户extmail访问extmail数据库的权限</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">GRANT ALL PRIVILEGES ON extmail.* TO 'extmail'@'localhost' IDENTIFIED BY 'extmail123';</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">GRANT ALL PRIVILEGES ON extmail.* TO 'extmail'@'127.0.0.1' IDENTIFIED BY 'extmail123';</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#c00000;">启用虚拟域以后，需要取消中心域，即注释掉配置文件“/etc/postfix/main.cf”的几个参数：myhostname，myorigin，mydomain，mydestination； 也可以把mydestination 改成自己需要的；</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:none;font-size:14px;">重启postfix</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:none;font-size:14px;">service postfix restart</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:none;font-size:14px;">这是会发现无法给之前配置的域收发邮件了，因为之前的参数我们已经注释了。 这时域的配置保存在exmail库中的domain表中。</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:none;font-size:14px;color:#0070c0;">配置dovecot</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">vim /etc/dovecot.conf</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> 
          <div class="line number8 index7 alt1">
           8
          </div> 
          <div class="line number9 index8 alt2">
           9
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="bash plain">auth&nbsp;default&nbsp;{</code>
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">mechanisms&nbsp;=&nbsp;plain</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">passdb&nbsp;sql&nbsp;{</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">args&nbsp;=&nbsp;</code>
            <code class="bash plain">/etc/dovecot-mysql</code>
            <code class="bash plain">.conf</code> 
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">｝</code>
           </div> 
           <div class="line number6 index5 alt1">
            <code class="bash plain">userdb&nbsp;sql&nbsp;{</code>
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">args&nbsp;=&nbsp;</code>
            <code class="bash plain">/etc/dovecot-mysql</code>
            <code class="bash plain">.conf</code> 
           </div> 
           <div class="line number8 index7 alt1">
            <code class="bash plain">｝</code>
           </div> 
           <div class="line number9 index8 alt2">
            <code class="bash plain">｝</code>
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><a href="https://yqfile.alicdn.com/img_065693e7235626a61c2c2ba441709511.jpg" rel="nofollow"><img title="clipboard.png" src="https://yqfile.alicdn.com/img_065693e7235626a61c2c2ba441709511.jpg" alt="wKiom1XbOmGTjxU_AAClMWIrQY0163.jpg"></a></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">参数说明：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mail_location = maildir:/var/mailbox/%d/%n/Maildir<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">这两个为dovecot支持的两个弘：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">%d &nbsp;表示域名</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">%n &nbsp;表示用户名</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';"><span style="font-size:14px;color:#0070c0;">建立配置文件：<span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">vim /etc/dovecot-mysql.conf&nbsp;</span></span></span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="bash plain">mail_location&nbsp;=&nbsp;maildir:</code>
            <code class="bash plain">/var/mailbox/</code>
            <code class="bash plain">%d/%n</code>
            <code class="bash plain">/Maildir</code> 
           </div> 
           <div class="line number2 index1 alt1">
            <code class="bash plain">driver&nbsp;=&nbsp;mysql</code>
           </div> 
           <div class="line number3 index2 alt2">
            <code class="bash plain">connect&nbsp;=&nbsp;host=localhost&nbsp;dbname=extmail&nbsp;user=extmail&nbsp;password=extmail123</code>
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">default_pass_scheme&nbsp;=&nbsp;CRYPT</code>
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="bash plain">password_query&nbsp;=&nbsp;SELECT&nbsp;username&nbsp;AS&nbsp;user,password&nbsp;AS&nbsp;password&nbsp;FROM&nbsp;mailbox&nbsp;WHERE&nbsp;username&nbsp;=&nbsp;</code>
            <code class="bash string">'%u'</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="bash plain">user_query&nbsp;=&nbsp;SELECT&nbsp;maildir,uidnumber&nbsp;AS&nbsp;uid,gidnumber&nbsp;AS&nbsp;gid&nbsp;FROM&nbsp;mailbox&nbsp;WHERE&nbsp;username&nbsp;=&nbsp;</code>
            <code class="bash string">'%u'</code> 
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#c00000;">注：如果mysql服务器是本地主机，如果mysql.sock文件路径不是默认的/var/lib/mysql/mysql.sock，可以使用host="socket<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';line-height:1.5;">" 来指定新位置：</span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#c00000;">connect = host=/tmp/mysql.sock dbname=extmail user=extmail password=extmail123&nbsp;<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';"><br></span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">重启dovecot服务</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">service dovecot restart</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">安装Extmail-1.2</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">tar zxvf extmail-1.2.tar.gz&nbsp;</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">cd extmail-1.2</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mkdir&nbsp;-pv&nbsp;/var/www/extsuite</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mv&nbsp;extmail-1.2&nbsp;/var/www/extsuite/extmail</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">cp&nbsp;/var/<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';line-height:1.5;">www/extsuite/extmail/webmail.cf.default&nbsp; /var/www/extsuite/extmail/webmail.cf</span></span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">修改主配置文件&nbsp;<span style="font-family:'微软雅黑';font-size:14px;line-height:1.5;">/var/www/extsuit/extmail/webmail.cf</span></span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> 
          <div class="line number8 index7 alt1">
           8
          </div> 
          <div class="line number9 index8 alt2">
           9
          </div> 
          <div class="line number10 index9 alt1">
           10
          </div> 
          <div class="line number11 index10 alt2">
           11
          </div> 
          <div class="line number12 index11 alt1">
           12
          </div> 
          <div class="line number13 index12 alt2">
           13
          </div> 
          <div class="line number14 index13 alt1">
           14
          </div> 
          <div class="line number15 index14 alt2">
           15
          </div> 
          <div class="line number16 index15 alt1">
           16
          </div> 
          <div class="line number17 index16 alt2">
           17
          </div> 
          <div class="line number18 index17 alt1">
           18
          </div> 
          <div class="line number19 index18 alt2">
           19
          </div> 
          <div class="line number20 index19 alt1">
           20
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2"> 
            <code class="bash plain">SYS_CONFIG&nbsp;=&nbsp;</code>
            <code class="bash plain">/var/www/extsuite/extmail/</code> 
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="bash plain">SYS_LANGDIR&nbsp;=&nbsp;</code>
            <code class="bash plain">/var/www/extsuite/extmail/lang</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="bash plain">SYS_TEMPLDIR&nbsp;=&nbsp;</code>
            <code class="bash plain">/var/www/extsuite/extmail/html</code> 
           </div> 
           <div class="line number4 index3 alt1">
            <code class="bash plain">SYS_HTTP_CACHE&nbsp;=&nbsp;0</code>
           </div> 
           <div class="line number5 index4 alt2">
            <code class="bash plain">SYS_SMTP_HOST&nbsp;=&nbsp;127.0.0.1</code>
           </div> 
           <div class="line number6 index5 alt1">
            <code class="bash plain">SYS_SMTP_PORT&nbsp;=&nbsp;25</code>
           </div> 
           <div class="line number7 index6 alt2">
            <code class="bash plain">SYS_SMTP_TIMEOUT&nbsp;=&nbsp;5</code>
           </div> 
           <div class="line number8 index7 alt1">
            <code class="bash plain">SYS_SPAM_REPORT_ON&nbsp;=&nbsp;0</code>
           </div> 
           <div class="line number9 index8 alt2">
            <code class="bash plain">SYS_USER_LANG&nbsp;=&nbsp;zh_CN</code>
           </div> 
           <div class="line number10 index9 alt1"> 
            <code class="bash plain">SYS_MAILDIR_BASE&nbsp;=&nbsp;</code>
            <code class="bash plain">/var/mailbox</code> 
           </div> 
           <div class="line number11 index10 alt2">
            <code class="bash plain">SYS_MYSQL_USER&nbsp;=&nbsp;extmail</code>
           </div> 
           <div class="line number12 index11 alt1">
            <code class="bash plain">SYS_MYSQL_PASS&nbsp;=&nbsp;extmail123</code>
           </div> 
           <div class="line number13 index12 alt2">
            <code class="bash plain">SYS_MYSQL_DB&nbsp;=&nbsp;extmail</code>
           </div> 
           <div class="line number14 index13 alt1">
            <code class="bash plain">SYS_MYSQL_HOST&nbsp;=&nbsp;localhost</code>
           </div> 
           <div class="line number15 index14 alt2"> 
            <code class="bash plain">SYS_MYSQL_SOCKET&nbsp;=&nbsp;</code>
            <code class="bash plain">/tmp/mysql</code>
            <code class="bash plain">.sock</code> 
           </div> 
           <div class="line number16 index15 alt1">
            <code class="bash plain">SYS_MYSQL_TABLE&nbsp;=&nbsp;mailbox</code>
           </div> 
           <div class="line number17 index16 alt2">
            <code class="bash plain">SYS_MYSQL_ATTR_USERNAME&nbsp;=&nbsp;username</code>
           </div> 
           <div class="line number18 index17 alt1">
            <code class="bash plain">SYS_MYSQL_ATTR_DOMAIN&nbsp;=&nbsp;domain</code>
           </div> 
           <div class="line number19 index18 alt2">
            <code class="bash plain">SYS_MYSQL_ATTR_PASSWD&nbsp;=&nbsp;password</code>
           </div> 
           <div class="line number20 index19 alt1"> 
            <code class="bash plain">SYS_AUTHLIB_SOCKET&nbsp;=&nbsp;</code>
            <code class="bash plain">/usr/local/courier-authlib/var/spool/authdaemon/socket</code> 
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_CONFIG 指定程序目录<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_LANGDIR 指定语言字符集的目录<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_TEMPLDIR 指定临时文件的目录<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_HTTP_CACHE<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;http是否要缓存<br></span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_SMTP_HOST&nbsp;指定smtp服务器<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_SMTP_PORT smtp服务端口号<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_SMTP_TIMEOUT 指定超时时间</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_SPAM_REPORT_ON 发现垃圾邮件是否报告</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_USER_LANG<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;指定语言支持<br></span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MAILDIR_BASE 指定用户的邮筒文件夹<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_TABLE 指定在mysql中对应的表<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_ATTR_USERNAME 用户名对应的字段属性</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_ATTR_DOMAIN 域对应的字段属性</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_ATTR_PASSWD 用户密码对应的字段属性</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_AUTHLIB_SOCKET&nbsp;指定courier-authlib socket文件位置</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">配置httpd</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">由于extmail要进行本地邮件的投递操作，故必须将运行httpd服务器用户的身份修改为你的邮件投递代理的用户，如果打开apache的suexec功能，可以实现虚拟主机运行身份的指定。 此例中的MDA为postfix自带，所以指定为postfix用户。</span></p> 
    <div> 
     <div class="syntaxhighlighter bash"> 
      <table border="0">
       <tbody>
        <tr>
         <td class="gutter"> 
          <div class="line number1 index0 alt2">
           1
          </div> 
          <div class="line number2 index1 alt1">
           2
          </div> 
          <div class="line number3 index2 alt2">
           3
          </div> 
          <div class="line number4 index3 alt1">
           4
          </div> 
          <div class="line number5 index4 alt2">
           5
          </div> 
          <div class="line number6 index5 alt1">
           6
          </div> 
          <div class="line number7 index6 alt2">
           7
          </div> </td> 
         <td class="code"> 
          <div> 
           <div class="line number1 index0 alt2">
            <code class="bash plain">&lt;VirtualHost&nbsp;*:8081&gt;</code>
           </div> 
           <div class="line number2 index1 alt1"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">ServerName&nbsp;mail.qupeiyin.net</code> 
           </div> 
           <div class="line number3 index2 alt2"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">DocumentRoot&nbsp;</code>
            <code class="bash plain">/var/www/extsuite/extmail/html/</code> 
           </div> 
           <div class="line number4 index3 alt1"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">ScriptAlias&nbsp;</code>
            <code class="bash plain">/extmail/cgi</code>&nbsp;
            <code class="bash plain">/var/www/extsuite/extmail/cgi</code> 
           </div> 
           <div class="line number5 index4 alt2"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">Alias&nbsp;</code>
            <code class="bash plain">/extmail</code>&nbsp;
            <code class="bash plain">/var/www/extsuite/extmail/html/</code> 
           </div> 
           <div class="line number6 index5 alt1"> 
            <code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
            <code class="bash plain">CustomLog&nbsp;logs</code>
            <code class="bash plain">/mail</code>
            <code class="bash plain">.qupeiyin.net.log&nbsp;common</code> 
           </div> 
           <div class="line number7 index6 alt2"> 
            <code class="bash plain">&lt;</code>
            <code class="bash plain">/VirtualHost</code>
            <code class="bash plain">&gt;</code> 
           </div> 
          </div> </td> 
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">如果不打开apache的suexec功能，也可以让整个apache用postfix用户跑</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">User postfix</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">Group postfix</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">修改cgi执行文件属主为apache服务运行的身份用户</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">chown&nbsp;-R&nbsp;postfix.postfix&nbsp;/var/www/extsuite/extmail/cgi/</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;color:#0070c0;">安装Unix-Syslog解决依赖关系</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">可以去<a style="line-height:1.5;font-family:'微软雅黑', 'Microsoft YaHei';text-decoration:underline;font-size:14px;" href="http://search.cpan.org/" rel="nofollow"><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">http://search.cpan.org/</span></a><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">搜索下载源码包</span></span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">tar xf Unix-Syslog-1.1.tar.gz</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">cd Unix-Syslog-1.1</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">perl Makefile.PL</span></p> 
    <p><span style="font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">make &amp;&amp; make install</span></p> 
    <p><span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">&nbsp;</span></p> 
    <p><span style="color:#0070c0;font-family:'微软雅黑', 'Microsoft YaHei';font-size:14px;">配置extman<br></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">tar xf extman-1.1.tar.gz</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mv&nbsp;extman-1.1&nbsp;/var/www/extsuite/extman</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">cp&nbsp;/var/www/extsuite/extman/webman.cf.default&nbsp;/var/www/extsuite/extman/webman.cf</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp;</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">编辑配置文件&nbsp;<span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';line-height:1.5;">/var/www/extsuite/extman/webman.cf</span></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MAILDIR_BASE = /var/mailbox</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_SESS_DIR = /tmp/extman/</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_CAPTCHA_ON&nbsp;= 0</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_DEFAULT_UID = 2525</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_DEFAULT_GID = 2525</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_USER = root</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_PASS = redhat</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_DB = extmail</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_HOST = localhost</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">SYS_MYSQL_SOCKET = /var/lib/mysql/mysql.sock</span></p> 
    <p>&nbsp;</p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">创建用于保存session的目录</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">mkdir /tmp/extman</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">chown postfix /tmp/extman/</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">修改cgi目录属主</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">chown&nbsp;-R&nbsp;postfix.postfix&nbsp;/var/www/extsuite/extman/cgi/<a><br></a></span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">在httpd主配置文件中Extmail的虚拟主机部分，添加如下两行：</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">&nbsp; &nbsp; ScriptAlias&nbsp;/extman/cgi&nbsp;/var/www/extsuite/extman/cgi<br>&nbsp;&nbsp;&nbsp;&nbsp;Alias&nbsp;/extman&nbsp;/var/www/extsuite/extman/html</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';color:#0070c0;">重启httpd服务器</span></p> 
    <p><span style="font-size:14px;font-family:'微软雅黑', 'Microsoft YaHei';">service httpd restart</span></p> 
    <p>&nbsp;</p> 
    <p>功能测试：</p> 
    <p>现在来访问我们的extmail</p> 
    <p><a href="https://yqfile.alicdn.com/img_dfe6526a7e1d22fb6b48c01f16ec0c95.jpg" rel="nofollow"><img title="2.png" src="https://yqfile.alicdn.com/img_dfe6526a7e1d22fb6b48c01f16ec0c95.jpg" alt="wKiom1XbRxeD3VejAAKegFrRfbM739.jpg" width="650"></a></p> 
    <p>选择登陆邮箱管理，空密码帐号，直接点登陆跳到下一个界面：</p> 
    <p><a href="https://yqfile.alicdn.com/img_24e7a7b0093173de855ac578f60cc817.jpg" rel="nofollow"><img title="3.png" src="https://yqfile.alicdn.com/img_24e7a7b0093173de855ac578f60cc817.jpg" alt="wKioL1XbSYeyJ_weAAFTbQSkGns486.jpg" width="650"></a></p> 
    <p>初始密码为：extmail*123*</p> 
    <p>登陆之后可进入邮箱控制台</p> 
    <p><a href="https://yqfile.alicdn.com/img_9780d1c433426ea017773e358ba00768.jpg" rel="nofollow"><img title="6.png" src="https://yqfile.alicdn.com/img_9780d1c433426ea017773e358ba00768.jpg" alt="wKioL1XbShvyB-PFAAEPcP-h5Jc895.jpg" width="650"></a></p> 
    <p>现在登陆一个用户来发送邮件</p> 
    <p><a href="https://yqfile.alicdn.com/img_99f0fb79015b234664e523999f828787.jpg" rel="nofollow"><img title="4.png" src="https://yqfile.alicdn.com/img_99f0fb79015b234664e523999f828787.jpg" alt="wKiom1XbSFfz-eNcAAGopL30lEo404.jpg" width="650"></a></p> 
    <p>&nbsp;</p> 
    <p>点击发送后，QQ邮箱立马就收到了。</p> 
    <p><a href="https://yqfile.alicdn.com/img_d368af109fa4211f3310f3c88a6b3e8b.jpg" rel="nofollow"><img title="111.png" src="https://yqfile.alicdn.com/img_d368af109fa4211f3310f3c88a6b3e8b.jpg" alt="wKiom1XbSNziCIxFAACUB0xk0AI661.jpg"></a></p> 
    <p>&nbsp;</p> 
    <p>一套邮件系统就基本实现了，这里还没加上反垃圾邮件功能和SSL加密功能。</p> 
    <p>这些功能可参考：</p> 
    <p>extmail官网：<a href="http://www.extmail.org/" rel="nofollow">http://www.extmail.org/</a></p> 
    <p>本文出自 “<a href="http://tchuairen.blog.51cto.com" rel="nofollow">突破舒适区</a>” 博客，请务必保留此出处<a href="http://tchuairen.blog.51cto.com/3848118/1686875" rel="nofollow">http://tchuairen.blog.51cto.com/3848118/1686875</a></p> 
   </div> 
   <div> 
    <div>
     【作者】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">张昺华</a> 
    </div> 
    <div>
     【出处】
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【博客园】 
     <a href="http://www.cnblogs.com/sky-heaven/" rel="nofollow">http://www.cnblogs.com/sky-heaven/</a> 
    </div> 
    <div>
     【新浪博客】 
     <a href="http://blog.sina.com.cn/u/2049150530" rel="nofollow">http://blog.sina.com.cn/u/2049150530</a> 
    </div> 
    <div>
     【知乎】 
     <a href="http://www.zhihu.com/people/zhang-bing-hua" rel="nofollow">http://www.zhihu.com/people/zhang-bing-hua</a> 
    </div> 
    <div>
     【我的作品---旋转倒立摆】 
     <a href="http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5NDAzNjQw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【我的作品---自平衡自动循迹车】 
     <a href="http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2" rel="nofollow">http://v.youku.com/v_show/id_XODM5MzYyNTIw.html?spm=a2hzp.8253869.0.0&amp;from=y1.7-2</a> 
    </div> 
    <div>
     【新浪微博】 张昺华--sky
    </div> 
    <div>
     【twitter】 @sky2030_
    </div> 
    <div>
     【facebook】 张昺华 zhangbinghua
    </div> 
    <div>
     本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.
    </div> 
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
