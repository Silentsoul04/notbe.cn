<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Oracle分析函数的使用 « NotBeCN</title>
  <meta name="description" content="             Oracle&nbsp;分析函数使用介绍 &nbsp; &nbsp;分析函数是oracle816引入的一个全新的概念,为我们分析数据提供了一种简单高效的处理方式.在分析函数出现以前,我们必须使用自联查询,子查询或者内联视图,甚至复杂的存储过程实现的语句,现在只要一条简单的sql语句就可以...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/07/10/weixin_34071713_90133495.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Oracle分析函数的使用</h1>
    <p class="post-meta">Jul 10, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">Oracle&nbsp;<span style="text-decoration:underline;"><strong><span style="color:rgb(255,0,0);">分析函数</span></strong></span>使用介绍<br> &nbsp; &nbsp;<span style="text-decoration:underline;"><strong><span style="color:rgb(255,0,0);">分析函数</span></strong></span>是oracle816引入的一个全新的概念,为我们分析数据提供了一种简单高效的处理方式.在<span style="text-decoration:underline;"><strong><span style="color:rgb(255,0,0);">分析函数</span></strong></span>出现以前,我们必须使用自联查询,子查询或者内联视图,甚至复杂的存储过程实现的语句,现在只要一条简单的sql语句就可以实现了,而且在执行效率方面也有相当大的提高.下面我将针对<span style="text-decoration:underline;"><strong><span style="color:rgb(255,0,0);">分析函数</span></strong></span>做一些具体的说明.<br><br> 今天我主要给大家介绍一下以下几个函数的使用方法<br> 1.&nbsp;&nbsp;自动汇总函数rollup,cube,<br> 2.&nbsp;&nbsp;rank 函数, rank,dense_rank,row_number<br> 3.&nbsp; &nbsp; &nbsp; &nbsp; lag,lead函数<br> 4.&nbsp; &nbsp; &nbsp; &nbsp; sum,avg,的移动增加,移动平均数<br> 5.&nbsp; &nbsp; &nbsp; &nbsp; ratio_to_report报表处理函数<br> 6.&nbsp; &nbsp; &nbsp; &nbsp; first,last取基数的<span style="text-decoration:underline;"><strong><span style="color:rgb(255,0,0);">分析函数</span></strong></span><br><br><br><strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">基础数据<br><br></span></span><br><br></span></strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td class="smalltxt" style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Code:</td> 
      <td align="right" style="border:1px solid #C0C0C0;border-collapse:collapse;"> <a class="smalltxt" href="http://www.oracle.com.cn/viewthread.php?tid=31313&amp;highlight=%B7%D6%CE%F6%BA%AF%CA%FD" rel="nofollow" style="color:rgb(255,51,102);text-decoration:none;"><span style="color:rgb(0,51,102);font-family:Arial;">[Copy to clipboard]</span></a>&nbsp;&nbsp;</td> 
     </tr>
     <tr>
      <td colspan="2" style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;">06:34:23 SQL&gt; select * from t;<br><br> BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;AREA_CODE&nbsp;&nbsp;NET_TYPE&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE<br> --------------- ---------- ---------- --------------<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7393344.04<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5667089.85<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6315075.96<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6328716.15<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8861742.59<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7788036.32<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6028670.45<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6459121.49<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13156065.77<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 11901671.70<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7614587.96<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5704343.05<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6556992.60<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6238068.05<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;9130055.46<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7990460.25<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6387706.01<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6907481.66<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13562968.81<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12495492.50<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7987050.65<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5723215.28<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6833096.68<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6391201.44<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;9410815.91<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8076677.41<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6456433.23<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6987660.53<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14000101.20<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12301780.20<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8085170.84<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6050611.37<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6854584.22<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6521884.50<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;9468707.65<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8460049.43<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6587559.23<br><br> BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;AREA_CODE&nbsp;&nbsp;NET_TYPE&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE<br> --------------- ---------- ---------- --------------<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7342135.86<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; G&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14450586.63<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp; J&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12680052.38<br><br> 40 rows selected.<br><br> Elapsed: 00:00:00.00</td>
         </tr>
        </tbody>
       </table></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">1. 使用rollup函数的介绍<br><br></span></span><br><br></span></strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> <span style="color:rgb(0,0,255);">下面是直接使用普通sql语句求出各地区的汇总数据的例子</span><br> 06:41:36 SQL&gt; set autot on<br> 06:43:36 SQL&gt; select area_code,sum(local_fare) local_fare<br> 06:43:50&nbsp; &nbsp;2&nbsp;&nbsp;from t<br> 06:43:51&nbsp; &nbsp;3&nbsp;&nbsp;group by area_code<br> 06:43:57&nbsp; &nbsp;4&nbsp;&nbsp;union all<br> 06:44:00&nbsp; &nbsp;5&nbsp;&nbsp;select '合计' area_code,sum(local_fare) local_fare<br> 06:44:06&nbsp; &nbsp;6&nbsp;&nbsp;from t<br> 06:44:08&nbsp; &nbsp;7&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;LOCAL_FARE<br> ---------- --------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225413.04<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039619.60<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 69186545.02<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156768.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548719.19<br> 合计&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;333157065.31<br><br> 6 rows selected.<br><br> Elapsed: 00:00:00.03<br><br> Execution Plan<br> ----------------------------------------------------------<br> &nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;SELECT STATEMENT Optimizer=ALL_ROWS (Cost=7 Card=1310 Bytes=<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 24884)<br><br> &nbsp; &nbsp;1&nbsp; &nbsp; 0&nbsp; &nbsp;UNION-ALL<br> &nbsp; &nbsp;2&nbsp; &nbsp; 1&nbsp; &nbsp;&nbsp;&nbsp;SORT (GROUP BY) (Cost=5 Card=1309 Bytes=24871)<br> &nbsp; &nbsp;3&nbsp; &nbsp; 2&nbsp; &nbsp;&nbsp; &nbsp; TABLE ACCESS (FULL) OF 'T' (Cost=2 Card=1309 Bytes=248<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 71)<br><br> &nbsp; &nbsp;4&nbsp; &nbsp; 1&nbsp; &nbsp;&nbsp;&nbsp;SORT (AGGREGATE)<br> &nbsp; &nbsp;5&nbsp; &nbsp; 4&nbsp; &nbsp;&nbsp; &nbsp; TABLE ACCESS (FULL) OF 'T' (Cost=2 Card=1309 Bytes=170<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17)<br><br><br><br><br><br> Statistics<br> ----------------------------------------------------------<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;recursive calls<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;db block gets<br><span style="color:rgb(255,0,0);">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 6&nbsp;&nbsp;consistent gets</span><br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;physical reads<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;redo size<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;561&nbsp;&nbsp;bytes sent via SQL*Net to client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;503&nbsp;&nbsp;bytes received via SQL*Net from client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2&nbsp;&nbsp;SQL*Net roundtrips to/from client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;sorts (memory)<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;sorts (disk)<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 6&nbsp;&nbsp;rows processed<br><br><br><span style="color:rgb(0,0,255);">下面是使用分析函数rollup得出的汇总数据的例子</span><br> 06:44:09 SQL&gt; select nvl(area_code,'合计') area_code,sum(local_fare) local_fare<br> 06:45:26&nbsp; &nbsp;2&nbsp;&nbsp;from t<br> 06:45:30&nbsp; &nbsp;3&nbsp;&nbsp;group by rollup(nvl(area_code,'合计'))<br> 06:45:50&nbsp; &nbsp;4&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;LOCAL_FARE<br> ---------- --------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225413.04<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039619.60<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 69186545.02<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156768.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548719.19<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 333157065.31<br><br> 6 rows selected.<br><br> Elapsed: 00:00:00.00<br><br> Execution Plan<br> ----------------------------------------------------------<br> &nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;SELECT STATEMENT Optimizer=ALL_ROWS (Cost=5 Card=1309 Bytes=<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 24871)<br><br> &nbsp; &nbsp;1&nbsp; &nbsp; 0&nbsp; &nbsp;SORT (GROUP BY ROLLUP) (Cost=5 Card=1309 Bytes=24871)<br> &nbsp; &nbsp;2&nbsp; &nbsp; 1&nbsp; &nbsp;&nbsp;&nbsp;TABLE ACCESS (FULL) OF 'T' (Cost=2 Card=1309 Bytes=24871<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; )<br><br><br><br><br><br> Statistics<br> ----------------------------------------------------------<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;recursive calls<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;db block gets<br><span style="color:rgb(255,0,0);">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4&nbsp;&nbsp;consistent gets</span><br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;physical reads<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;redo size<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;557&nbsp;&nbsp;bytes sent via SQL*Net to client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;503&nbsp;&nbsp;bytes received via SQL*Net from client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2&nbsp;&nbsp;SQL*Net roundtrips to/from client<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;sorts (memory)<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;sorts (disk)<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 6&nbsp;&nbsp;rows processed<br><br><br><strong>从上面的例子我们不难看出使用rollup函数,系统的sql语句更加简单,耗用的资源更少,从6个consistent gets降到4个consistent gets,如果基表很大的话,结果就可想而知了.</strong> </td>
         </tr>
        </tbody>
       </table></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">1. 使用cube函数的介绍<br><br></span></span><br><br></span></strong> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
         </tr>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
           <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
            <tbody>
             <tr>
              <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong>为了介绍cube函数我们再来看看另外一个使用rollup的例子</strong><br> 06:53:00 SQL&gt; select area_code,bill_month,sum(local_fare) local_fare<br> 06:53:37&nbsp; &nbsp;2&nbsp;&nbsp;from t<br> 06:53:38&nbsp; &nbsp;3&nbsp;&nbsp;group by rollup(area_code,bill_month)<br> 06:53:49&nbsp; &nbsp;4&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp;&nbsp;BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE<br> ---------- --------------- --------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060433.89<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318931.01<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710265.93<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135782.21<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;54225413.04<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643792.11<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12795060.65<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224298.12<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376468.72<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;52039619.60<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 16649778.91<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17120515.71<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17487493.32<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17928757.08<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;69186545.02<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487791.94<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295187.67<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444093.76<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929695.09<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;53156768.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057737.47<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26058461.31<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301881.40<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130639.01<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 104548719.19<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;333157065.31<br><br> 26 rows selected.<br><br> Elapsed: 00:00:00.00<br><br><strong>系统只是根据rollup的第一个参数area_code对结果集的数据做了汇总处理,而没有对bill_month做汇总分析处理,cube函数就是为了这个而设计的.<br> 下面,让我们看看使用cube函数的结果</strong><br><br> 06:58:02 SQL&gt; select area_code,bill_month,sum(local_fare) local_fare<br> 06:58:30&nbsp; &nbsp;2&nbsp;&nbsp;from t<br> 06:58:32&nbsp; &nbsp;3&nbsp;&nbsp;group by cube(area_code,bill_month)<br> 06:58:42&nbsp; &nbsp;4&nbsp;&nbsp;order by area_code,bill_month nulls last<br> 06:58:57&nbsp; &nbsp;5&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp;&nbsp;BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE<br> ---------- --------------- --------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.43<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.93<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.27<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.78<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;54225.41<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643.79<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12795.06<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224.30<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376.47<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;52039.62<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 16649.78<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17120.52<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17487.49<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17928.76<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;69186.54<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487.79<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295.19<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444.09<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929.69<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;53156.77<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057.74<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26058.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301.88<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130.64<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 104548.72<br><span style="color:rgb(255,0,0);"><strong>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 79899.53<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 82588.15<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 84168.03<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 86501.34</strong></span><br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;333157.05<br><br> 30 rows selected.<br><br> Elapsed: 00:00:00.01<br><br><strong>可以看到,在cube函数的输出结果比使用rollup多出了几行统计数据.这就是cube函数根据bill_month做的汇总统计结果</strong> </td>
             </tr>
            </tbody>
           </table></td>
         </tr>
        </tbody>
       </table><br></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">1 rollup 和 cube函数的再深入<br><br></span></span><br><br></span></strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong>从上面的结果中我们很容易发现,每个统计数据所对应的行都会出现null,<br> 我们如何来区分到底是根据那个字段做的汇总呢,<br> 这时候,oracle的grouping函数就粉墨登场了.<br> 如果当前的汇总记录是利用该字段得出的,grouping函数就会返回1,否则返回0<br></strong><br><br> &nbsp;&nbsp;1&nbsp;&nbsp;select decode(grouping(area_code),1,'all area',to_char(area_code)) area_code,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;decode(grouping(bill_month),1,'all month',bill_month) bill_month,<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;sum(local_fare) local_fare<br> &nbsp;&nbsp;4&nbsp;&nbsp;from t<br> &nbsp;&nbsp;5&nbsp;&nbsp;group by cube(area_code,bill_month)<br> &nbsp;&nbsp;6* order by area_code,bill_month nulls last<br> 07:07:29 SQL&gt; /<br><br> AREA_CODE&nbsp;&nbsp;BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE<br> ---------- --------------- --------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.43<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.93<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.27<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.78<br> 5761&nbsp; &nbsp;&nbsp; &nbsp; all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643.79<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12795.06<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224.30<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376.47<br> 5762&nbsp; &nbsp;&nbsp; &nbsp; all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039.62<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 16649.78<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17120.52<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17487.49<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 17928.76<br> 5763&nbsp; &nbsp;&nbsp; &nbsp; all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 69186.54<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487.79<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295.19<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444.09<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929.69<br> 5764&nbsp; &nbsp;&nbsp; &nbsp; all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156.77<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057.74<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26058.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301.88<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130.64<br> 5765&nbsp; &nbsp;&nbsp; &nbsp; all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548.72<br><span style="color:rgb(255,0,0);"><strong>all area&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 79899.53<br> all area&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 82588.15<br> all area&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 84168.03<br> all area&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 86501.34<br> all area&nbsp; &nbsp;all month&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;333157.05<br></strong></span><br> 30 rows selected.<br><br> Elapsed: 00:00:00.01<br> 07:07:31 SQL&gt;<br><br><strong><br> 可以看到,所有的空值现在都根据grouping函数做出了很好的区分,这样利用rollup,cube和grouping函数,我们做数据统计的时候就可以轻松很多了.</strong> </td>
         </tr>
        </tbody>
       </table></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><br><br></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;table-layout:fixed;">
    <tbody>
     <tr>
      <td valign="top" style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong><span class="bold"><span class="smalltxt"><span style="font-family:Arial;">2. rank函数的介绍<br><br></span></span></span>介绍完rollup和cube函数的使用,下面我们来看看rank系列函数的使用方法.</strong><br><br><strong>问题2.</strong>我想查出这几个月份中各个地区的总话费的排名.<br><br>
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
         </tr>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
           <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
            <tbody>
             <tr>
              <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong>为了将rank,dense_rank,row_number函数的差别显示出来,我们对已有的基础数据做一些修改,将5763的数据改成与5761的数据相同.</strong><br> &nbsp;&nbsp;1&nbsp;&nbsp;update t t1 set local_fare = (<br> &nbsp;&nbsp;2&nbsp; &nbsp; select local_fare from t t2<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;where t1.bill_month = t2.bill_month<br> &nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;and t1.net_type = t2.net_type<br> &nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;and t2.area_code = '5761'<br> &nbsp;&nbsp;6* ) where area_code = '5763'<br> 07:19:18 SQL&gt; /<br><br> 8 rows updated.<br><br> Elapsed: 00:00:00.01<br><br> 我们先使用rank函数来计算各个地区的话费排名.<br> 07:34:19 SQL&gt; select area_code,sum(local_fare) local_fare,<br> 07:35:25&nbsp; &nbsp;2&nbsp; &nbsp; rank() over (order by sum(local_fare) desc) fare_rank<br> 07:35:44&nbsp; &nbsp;3&nbsp;&nbsp;from t<br> 07:35:45&nbsp; &nbsp;4&nbsp;&nbsp;group by area_codee<br> 07:35:50&nbsp; &nbsp;5<br> 07:35:52 SQL&gt; select area_code,sum(local_fare) local_fare,<br> 07:36:02&nbsp; &nbsp;2&nbsp; &nbsp; rank() over (order by sum(local_fare) desc) fare_rank<br> 07:36:20&nbsp; &nbsp;3&nbsp;&nbsp;from t<br> 07:36:21&nbsp; &nbsp;4&nbsp;&nbsp;group by area_code<br> 07:36:25&nbsp; &nbsp;5&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;LOCAL_FARE&nbsp;&nbsp;FARE_RANK<br> ---------- -------------- ----------<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548.72&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;<span style="color:rgb(255,0,0);">2&nbsp;</span><br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156.77&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;<span style="color:rgb(255,0,0);">4&nbsp;</span><br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039.62&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br><br> Elapsed: 00:00:00.01<br><br><strong>我们可以看到红色标注的地方出现了,跳位,排名3没有出现<br> 下面我们再看看dense_rank查询的结果.<br></strong><br><br> 07:36:26 SQL&gt; select area_code,sum(local_fare) local_fare,<br> 07:39:16&nbsp; &nbsp;2&nbsp; &nbsp; dense_rank() over (order by sum(local_fare) desc ) fare_rank<br> 07:39:39&nbsp; &nbsp;3&nbsp;&nbsp;from t<br> 07:39:42&nbsp; &nbsp;4&nbsp;&nbsp;group by area_code<br> 07:39:46&nbsp; &nbsp;5&nbsp;&nbsp;/<br><br> AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;LOCAL_FARE&nbsp;&nbsp;FARE_RANK<br> ---------- -------------- ----------<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548.72&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156.77&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 3&nbsp;&nbsp;<span style="color:rgb(255,0,0);">这是这里出现了第三名</span><br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039.62&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br><br> Elapsed: 00:00:00.00<br><br><strong><br> 在这个例子中,出现了一个第三名,这就是rank和dense_rank的差别,<br> rank如果出现两个相同的数据,那么后面的数据就会<span style="color:rgb(0,0,255);">直接跳过</span>这个排名,而dense_rank则不会,<br> 差别更大的是,row_number哪怕是两个数据完全相同,排名也会不一样,这个特性在我们想找出对应没个条件的唯一记录的时候又很大用处<br></strong><br><br> &nbsp;&nbsp;1&nbsp;&nbsp;select area_code,sum(local_fare) local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;row_number() over (order by sum(local_fare) desc ) fare_rank<br> &nbsp;&nbsp;3&nbsp;&nbsp;from t<br> &nbsp;&nbsp;4* group by area_code<br> 07:44:50 SQL&gt; /<br><br> AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;LOCAL_FARE&nbsp;&nbsp;FARE_RANK<br> ---------- -------------- ----------<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;104548.72&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br><span style="color:rgb(255,0,0);">5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2</span><br><span style="color:rgb(255,0,0);">5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 54225.41&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 3</span><br> 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 53156.77&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 52039.62&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br><br><strong>在row_nubmer函数中,我们发现,哪怕sum(local_fare)完全相同,我们还是得到了不一样排名,我们可以利用这个特性剔除数据库中的重复记录.<br><br> 这个帖子中的几个例子是为了说明这三个函数的基本用法的. 下个帖子我们将详细介绍他们的一些用法.<br></strong> </td>
             </tr>
            </tbody>
           </table></td>
         </tr>
        </tbody>
       </table><br></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><span class="bold"><span class="smalltxt"><strong><span style="font-family:Arial;">2. rank函数的介绍<br><br></span></strong></span></span>a. 取出数据库中最后入网的n个用户<br> select user_id,tele_num,user_name,user_status,create_date&nbsp;<br> from (<br> &nbsp; &nbsp;select user_id,tele_num,user_name,user_status,create_date,<br> &nbsp; &nbsp;&nbsp; &nbsp;rank() over (order by create_date desc) add_rank<br> &nbsp; &nbsp;from user_info<br> )<br> where add_rank &lt;= :n;<br><br> b.根据object_name删除数据库中的重复记录<br> create table t as select obj#,name from sys.obj$;<br> 再insert into t1 select * from t1 数次.<br> delete from t1 where rowid in (<br> &nbsp; &nbsp;select row_id from (<br> &nbsp; &nbsp;&nbsp; &nbsp;select rowid row_id,row_number() over (partition by obj# order by rowid ) rn<br> &nbsp; &nbsp;) where rn &lt;&gt; 1<br> );<br><br> c. 取出各地区的话费收入在各个月份排名.<br> SQL&gt; select bill_month,area_code,sum(local_fare) local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;rank() over (partition by bill_month order by sum(local_fare) desc) area_rank<br> &nbsp;&nbsp;3&nbsp;&nbsp;from t<br> &nbsp;&nbsp;4&nbsp;&nbsp;group by bill_month,area_code<br> &nbsp;&nbsp;5&nbsp;&nbsp;/<br><br> BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp;AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LOCAL_FARE&nbsp;&nbsp;AREA_RANK<br> --------------- --------------- -------------- ----------<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;25057.74&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13060.43&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13060.43&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12643.79&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br> 200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12487.79&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;26058.46&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13295.19&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br> 200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12795.06&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;26301.88&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13710.27&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13710.27&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13444.09&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br> 200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13224.30&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;27130.64&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;14135.78&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;14135.78&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13929.69&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4<br> 200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13376.47&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5<br><br> 20 rows selected.<br> SQL&gt;<br><br><br><strong><span class="bold"><span class="smalltxt"><span style="font-family:Arial;">3. lag和lead函数介绍<br><br></span></span></span>取出每个月的上个月和下个月的话费总额</strong><br> &nbsp;&nbsp;1&nbsp;&nbsp;select area_code,bill_month, local_fare cur_local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;lag(local_fare,2,0) over (partition by area_code order by bill_month ) pre_local_fare,<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;lag(local_fare,1,0) over (partition by area_code order by bill_month ) last_local_fare,<br> &nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;lead(local_fare,1,0) over (partition by area_code order by bill_month ) next_local_fare,<br> &nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;lead(local_fare,2,0) over (partition by area_code order by bill_month ) post_local_fare<br> &nbsp;&nbsp;6&nbsp;&nbsp;from (<br> &nbsp;&nbsp;7&nbsp; &nbsp;&nbsp;&nbsp;select area_code,bill_month,sum(local_fare) local_fare<br> &nbsp;&nbsp;8&nbsp; &nbsp;&nbsp;&nbsp;from t<br> &nbsp;&nbsp;9&nbsp; &nbsp;&nbsp;&nbsp;group by area_code,bill_month<br> 10* )<br> SQL&gt; /<br> AREA_CODE BILL_MONTH CUR_LOCAL_FARE PRE_LOCAL_FARE LAST_LOCAL_FARE NEXT_LOCAL_FARE POST_LOCAL_FARE<br> --------- ---------- -------------- -------------- --------------- --------------- ---------------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp; 13710.265<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 13060.433&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp; 14135.781<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp;13060.433&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp; 14135.781&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781&nbsp; &nbsp;&nbsp; &nbsp; 13318.93&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643.791&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12795.06&nbsp; &nbsp;&nbsp; &nbsp; 13224.297<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12795.06&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 12643.791&nbsp; &nbsp;&nbsp; &nbsp; 13224.297&nbsp; &nbsp;&nbsp; &nbsp; 13376.468<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224.297&nbsp; &nbsp;&nbsp; &nbsp;12643.791&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12795.06&nbsp; &nbsp;&nbsp; &nbsp; 13376.468&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376.468&nbsp; &nbsp;&nbsp; &nbsp; 12795.06&nbsp; &nbsp;&nbsp; &nbsp; 13224.297&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp; 13710.265<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 13060.433&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp; 14135.781<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp;13060.433&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13318.93&nbsp; &nbsp;&nbsp; &nbsp; 14135.781&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781&nbsp; &nbsp;&nbsp; &nbsp; 13318.93&nbsp; &nbsp;&nbsp; &nbsp; 13710.265&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487.791&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 13295.187&nbsp; &nbsp;&nbsp; &nbsp; 13444.093<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295.187&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 12487.791&nbsp; &nbsp;&nbsp; &nbsp; 13444.093&nbsp; &nbsp;&nbsp; &nbsp; 13929.694<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444.093&nbsp; &nbsp;&nbsp; &nbsp;12487.791&nbsp; &nbsp;&nbsp; &nbsp; 13295.187&nbsp; &nbsp;&nbsp; &nbsp; 13929.694&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929.694&nbsp; &nbsp;&nbsp; &nbsp;13295.187&nbsp; &nbsp;&nbsp; &nbsp; 13444.093&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057.736&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;26058.46&nbsp; &nbsp;&nbsp; &nbsp; 26301.881<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;26058.46&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp; 25057.736&nbsp; &nbsp;&nbsp; &nbsp; 26301.881&nbsp; &nbsp;&nbsp; &nbsp; 27130.638<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301.881&nbsp; &nbsp;&nbsp; &nbsp;25057.736&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;26058.46&nbsp; &nbsp;&nbsp; &nbsp; 27130.638&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130.638&nbsp; &nbsp;&nbsp; &nbsp; 26058.46&nbsp; &nbsp;&nbsp; &nbsp; 26301.881&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0<br> 20 rows selected.<br><br><strong>利用lag和lead函数,我们可以在同一行中显示前n行的数据,也可以显示后n行的数据.</strong><br><br><br><span class="bold"><span class="smalltxt"><strong><span style="font-family:Arial;">4. sum,avg,max,min移动计算数据介绍<br><br></span></strong></span></span>计算出各个连续3个月的通话费用的平均数<br> &nbsp;&nbsp;1&nbsp;&nbsp;select area_code,bill_month, local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;sum(local_fare)<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (&nbsp;&nbsp;partition by area_code<br> &nbsp;&nbsp;4&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;order by to_number(bill_month)<br> &nbsp;&nbsp;5&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;range between 1 preceding and 1 following ) "3month_sum",<br> &nbsp;&nbsp;6&nbsp; &nbsp;&nbsp;&nbsp;avg(local_fare)<br> &nbsp;&nbsp;7&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (&nbsp;&nbsp;partition by area_code<br> &nbsp;&nbsp;8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;order by to_number(bill_month)<br> &nbsp;&nbsp;9&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;range between 1 preceding and 1 following ) "3month_avg",<br> 10&nbsp; &nbsp;&nbsp;&nbsp;max(local_fare)<br> 11&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (&nbsp;&nbsp;partition by area_code<br> 12&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;order by to_number(bill_month)<br> 13&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;range between 1 preceding and 1 following ) "3month_max",<br> 14&nbsp; &nbsp;&nbsp;&nbsp;min(local_fare)<br> 15&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (&nbsp;&nbsp;partition by area_code<br> 16&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;order by to_number(bill_month)<br> 17&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;range between 1 preceding and 1 following ) "3month_min"<br> 18&nbsp;&nbsp;from (<br> 19&nbsp; &nbsp;&nbsp;&nbsp;select area_code,bill_month,sum(local_fare) local_fare<br> 20&nbsp; &nbsp;&nbsp;&nbsp;from t<br> 21&nbsp; &nbsp;&nbsp;&nbsp;group by area_code,bill_month<br> 22* )<br> SQL&gt; /<br><br> AREA_CODE BILL_MONTH&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE 3month_sum 3month_avg 3month_max 3month_min<br> --------- ---------- ---------------- ---------- ---------- ---------- ----------<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color:rgb(0,0,255);">13060.433</span>&nbsp;&nbsp;26379.363 13189.6815&nbsp; &nbsp;13318.93&nbsp;&nbsp;13060.433<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color:rgb(0,0,255);">13318.930</span>&nbsp;&nbsp;40089.628 13363.2093&nbsp;&nbsp;13710.265&nbsp;&nbsp;13060.433<br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color:rgb(0,0,255);">13710.265</span>&nbsp;&nbsp;41164.976 13721.6587&nbsp;&nbsp;14135.781&nbsp; &nbsp;13318.93<br><strong>40089.628 = 13060.433 + 13318.930 + 13710.265<br> 13363.2093 = (13060.433 + 13318.930 + 13710.265) / 3<br> 13710.265 = max(13060.433 + 13318.930 + 13710.265)<br> 13060.433 = min(13060.433 + 13318.930 + 13710.265)</strong><br> 5761&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;14135.781&nbsp;&nbsp;27846.046&nbsp;&nbsp;13923.023&nbsp;&nbsp;14135.781&nbsp;&nbsp;13710.265<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12643.791&nbsp;&nbsp;25438.851 12719.4255&nbsp; &nbsp;12795.06&nbsp;&nbsp;12643.791<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12795.060&nbsp;&nbsp;38663.148&nbsp;&nbsp;12887.716&nbsp;&nbsp;13224.297&nbsp;&nbsp;12643.791<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13224.297&nbsp;&nbsp;39395.825 13131.9417&nbsp;&nbsp;13376.468&nbsp; &nbsp;12795.06<br> 5762&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13376.468&nbsp;&nbsp;26600.765 13300.3825&nbsp;&nbsp;13376.468&nbsp;&nbsp;13224.297<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13060.433&nbsp;&nbsp;26379.363 13189.6815&nbsp; &nbsp;13318.93&nbsp;&nbsp;13060.433<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13318.930&nbsp;&nbsp;40089.628 13363.2093&nbsp;&nbsp;13710.265&nbsp;&nbsp;13060.433<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13710.265&nbsp;&nbsp;41164.976 13721.6587&nbsp;&nbsp;14135.781&nbsp; &nbsp;13318.93<br> 5763&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;14135.781&nbsp;&nbsp;27846.046&nbsp;&nbsp;13923.023&nbsp;&nbsp;14135.781&nbsp;&nbsp;13710.265<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;12487.791&nbsp;&nbsp;25782.978&nbsp;&nbsp;12891.489&nbsp;&nbsp;13295.187&nbsp;&nbsp;12487.791<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13295.187&nbsp;&nbsp;39227.071 13075.6903&nbsp;&nbsp;13444.093&nbsp;&nbsp;12487.791<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13444.093&nbsp;&nbsp;40668.974 13556.3247&nbsp;&nbsp;13929.694&nbsp;&nbsp;13295.187<br> 5764&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;13929.694&nbsp;&nbsp;27373.787 13686.8935&nbsp;&nbsp;13929.694&nbsp;&nbsp;13444.093<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200405&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;25057.736&nbsp;&nbsp;51116.196&nbsp;&nbsp;25558.098&nbsp; &nbsp;26058.46&nbsp;&nbsp;25057.736<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200406&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;26058.460&nbsp;&nbsp;77418.077 25806.0257&nbsp;&nbsp;26301.881&nbsp;&nbsp;25057.736<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200407&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;26301.881&nbsp;&nbsp;79490.979&nbsp;&nbsp;26496.993&nbsp;&nbsp;27130.638&nbsp; &nbsp;26058.46<br> 5765&nbsp; &nbsp;&nbsp; &nbsp;200408&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;27130.638&nbsp;&nbsp;53432.519 26716.2595&nbsp;&nbsp;27130.638&nbsp;&nbsp;26301.881<br><br> 20 rows selected.<br><br><strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">5. ratio_to_report函数的介绍<br><br></span></span><br><br></span></strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;1&nbsp;&nbsp;select bill_month,area_code,sum(local_fare) local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;ratio_to_report(sum(local_fare)) over<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp; &nbsp; ( partition by bill_month ) area_pct<br> &nbsp;&nbsp;4&nbsp;&nbsp;from t<br> &nbsp;&nbsp;5* group by bill_month,area_code<br> SQL&gt; break on bill_month skip 1<br> SQL&gt; compute sum of local_fare on bill_month<br> SQL&gt; compute sum of area_pct on bill_month<br> SQL&gt; /<br><br> BILL_MONTH AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE&nbsp; &nbsp;AREA_PCT<br> ---------- --------- ---------------- ----------<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433 .171149279<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643.791 .165689431<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433 .171149279<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487.791 .163645143<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057.736 .328366866<br> **********&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;---------------- ----------<br> sum&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 76310.184&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br><br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.930 .169050772<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12795.060 .162401542<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.930 .169050772<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295.187 .168749414<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26058.460 .330747499<br> **********&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;---------------- ----------<br> sum&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 78786.567&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br><br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265 .170545197<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224.297 .164500127<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265 .170545197<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444.093 .167234221<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301.881 .327175257<br> **********&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;---------------- ----------<br> sum&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 80390.801&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br><br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781 .170911147<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376.468 .161730539<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781 .170911147<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929.694 .168419416<br> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130.638 .328027751<br> **********&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;---------------- ----------<br> sum&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 82708.362&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1<br><br><br> 20 rows selected.</td>
         </tr>
        </tbody>
       </table></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br><strong><span style="font-family:Arial;"><span class="bold"><span class="smalltxt">6 first,last函数使用介绍<br><br></span></span><br><br></span></strong></p> 
   <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">
    <tbody>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;">&nbsp;&nbsp;Quote:</td>
     </tr>
     <tr>
      <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> 
       <table border="0" style="border:1px solid #C0C0C0;border-collapse:collapse;">
        <tbody>
         <tr>
          <td style="border:1px solid #C0C0C0;border-collapse:collapse;"> <strong>取出每月通话费最高和最低的两个用户.</strong><br> 1&nbsp;&nbsp;select bill_month,area_code,sum(local_fare) local_fare,<br> &nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;first_value(area_code)<br> &nbsp;&nbsp;3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (order by sum(local_fare) desc<br> &nbsp;&nbsp;4&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;rows unbounded preceding) firstval,<br> &nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;first_value(area_code)<br> &nbsp;&nbsp;6&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; over (order by sum(local_fare) asc<br> &nbsp;&nbsp;7&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;rows unbounded preceding) lastval<br> &nbsp;&nbsp;8&nbsp;&nbsp;from t<br> &nbsp;&nbsp;9&nbsp;&nbsp;group by bill_month,area_code<br> 10* order by bill_month<br> SQL&gt; /<br><br> BILL_MONTH AREA_CODE&nbsp; &nbsp;&nbsp; &nbsp; LOCAL_FARE FIRSTVAL&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LASTVAL<br> ---------- --------- ---------------- --------------- ---------------<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12487.791 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12643.791 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 25057.736 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200405&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13060.433 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 12795.060 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.930 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13295.187 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26058.460 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200406&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13318.930 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13224.297 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 26301.881 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13710.265 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200407&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13444.093 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5762&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13376.468 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5764&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 13929.694 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5761&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27130.638 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br> 200408&nbsp; &nbsp;&nbsp;&nbsp;5763&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 14135.781 5765&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;5764<br><br> 20 rows selected.</td>
         </tr>
        </tbody>
       </table></td>
     </tr>
    </tbody>
   </table>
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;">&nbsp;</p> 
   <p><font><span style="font-size:14px;">本文转自茄子_2008，原文链接：http://www.cnblogs.com/xd502djj/archive/2010/09/21/1832201.html</span></font><span style="font-size:14px;font-family:verdana, Arial, Helvetica, sans-serif;">，如需转载请自行联系原作者</span></p> 
   <p style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;"><br></p> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
