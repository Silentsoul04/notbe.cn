<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>已经重写，源码和文章请跳转http://www.cnblogs.com/ymnets/p/5621706.html « NotBeCN</title>
  <meta name="description" content="                  文章由于写得比较仓促     已经重写，源码和文章请跳转     http://www.cnblogs.com/ymnets/p/5621706.html&nbsp;     &nbsp;     系列目录     前言：     导入导出实在多例子，很多成熟的组建都分装了导入...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://notbe.cn/2017/07/07/weixin_34153893_90130346.html">
  <link rel="alternate" type="application/rss+xml" title="NotBeCN" href="https://notbe.cn/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">NotBeCN</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/" target="_blank">关于</a>
      
        
        <a class="page-link" href="https://uzshare.com" target="_blank">社区</a>
      
        
        <a class="page-link" href="/donate/" target="_blank">Donate</a>
      
        
        <a class="page-link" href="/games/shejiyazi/" target="_blank">射个鸭子</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">已经重写，源码和文章请跳转http://www.cnblogs.com/ymnets/p/5621706.html</h1>
    <p class="post-meta">Jul 7, 2017</p>
  </header>

  <article class="post-content">
    <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="content-detail markdown-body"> 
   <div class="blogpost-body" style="color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;"> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">文章由于写得比较仓促</h2> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">已经重写，源码和文章请跳转</h2> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;"><a href="http://www.cnblogs.com/ymnets/p/5621706.html%20" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">http://www.cnblogs.com/ymnets/p/5621706.html&nbsp;</a></h2> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">&nbsp;</h2> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;"><strong><a href="http://www.cnblogs.com/ymnets/p/3424309.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">系列目录</a></strong></h2> 
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">前言：</h2> 
    <p style="text-indent:2em;">导入导出实在多例子，很多成熟的组建都分装了导入和导出，这一节演示利用LinqToExcel组件对Excel的导入，这个是一个极其简单的例子。</p> 
    <p style="text-indent:2em;">我并不是说导入的简单。而是LinqToExcel让我们对Excel操作更加简单！</p> 
    <p style="text-indent:2em;">最后我们将利用ClosedXML输出Excel。这个比现流行NPOI与EPPlus更加优秀的组件，<span style="line-height:1.8;color:rgb(255,0,0);">以Open XML SDK为基础，所以只支持xlsx，不支持xls格式（现阶段谁没有个office2007以上版本）</span></p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(0,0,0);">他导出的Excel根据官方描述，兼容性远超同行对手</span></p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);">如果你不是使用本架构只看2，3，4点，使用BLL层的代码，这同样适用你的MVC程序</span></p> 
    <p style="text-indent:2em;">知识点：</p> 
    <ul>
     <li>LinqToExcel组件读取Excel文件</li> 
     <li>ClosedXML组件输出Excel</li> 
    </ul>
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">准备：</h2> 
    <ol style="line-height:30px;">
     <li style="list-style:decimal;">一张演示的数据库表</li> 
     <li style="list-style:decimal;">安装LinqToExcel NuGet包</li> 
     <li style="list-style:decimal;">文件上传样例</li> 
     <li style="list-style:decimal;">（时间关系只能在下一节）</li> 
    </ol>
    <h2 style="color:#008080;border-bottom:2px solid #008080;line-height:1.5;font-size:25px;">开始：</h2> 
    <h3 style="color:#008080;font-size:16px;line-height:45px;">1.数据表</h3> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="color:rgb(0,0,255);line-height:1.5;">CREATE</span> <span style="color:rgb(0,0,255);line-height:1.5;">TABLE</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">dbo</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>.<span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Spl_Person</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span><span style="line-height:1.5;">(
    </span><span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Id</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(128,128,128);line-height:1.5;">NOT</span> <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,          <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">ID</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Name</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,            <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">姓名</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Sex</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">10</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,                <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">性别    </span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Age</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">int</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,                      <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">年龄</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">IDCard</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,          <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">IDCard</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Phone</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,           <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">电话</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Email</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">200</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,          <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">邮件</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Address</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">300</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,        <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">地址</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">CreateTime</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">datetime</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(128,128,128);line-height:1.5;">NOT</span> <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,      <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">创建时间</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Region</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,          <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">区域</span>
    <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Category</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">nvarchar</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>(<span style="color:rgb(128,0,0);font-weight:bold;line-height:1.5;">50</span>) <span style="color:rgb(0,0,255);line-height:1.5;">NULL</span>,        <span style="color:rgb(0,128,128);line-height:1.5;">--</span><span style="color:rgb(0,128,128);line-height:1.5;">类别</span>
 <span style="color:rgb(0,0,255);line-height:1.5;">CONSTRAINT</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">PK_Spl_Person</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(0,0,255);line-height:1.5;">PRIMARY</span> <span style="color:rgb(0,0,255);line-height:1.5;">KEY</span> <span style="color:rgb(0,0,255);line-height:1.5;">CLUSTERED</span><span style="line-height:1.5;"> 
(
    </span><span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">Id</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span> <span style="color:rgb(0,0,255);line-height:1.5;">ASC</span><span style="line-height:1.5;">
)</span><span style="color:rgb(0,0,255);line-height:1.5;">WITH</span> (PAD_INDEX <span style="color:rgb(128,128,128);line-height:1.5;">=</span> <span style="color:rgb(0,0,255);line-height:1.5;">OFF</span>, STATISTICS_NORECOMPUTE <span style="color:rgb(128,128,128);line-height:1.5;">=</span> <span style="color:rgb(0,0,255);line-height:1.5;">OFF</span>, IGNORE_DUP_KEY <span style="color:rgb(128,128,128);line-height:1.5;">=</span> <span style="color:rgb(0,0,255);line-height:1.5;">OFF</span>, ALLOW_ROW_LOCKS <span style="color:rgb(128,128,128);line-height:1.5;">=</span> <span style="color:rgb(0,0,255);line-height:1.5;">ON</span>, ALLOW_PAGE_LOCKS <span style="color:rgb(128,128,128);line-height:1.5;">=</span> <span style="color:rgb(0,0,255);line-height:1.5;">ON</span>) <span style="color:rgb(0,0,255);line-height:1.5;">ON</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">PRIMARY</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span><span style="line-height:1.5;">
) </span><span style="color:rgb(0,0,255);line-height:1.5;">ON</span> <span style="color:rgb(255,0,0);line-height:1.5;">[</span><span style="color:rgb(255,0,0);line-height:1.5;">PRIMARY</span><span style="color:rgb(255,0,0);line-height:1.5;">]</span>

<span style="color:rgb(0,0,255);line-height:1.5;">GO</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="text-indent:2em;"><strong><span style="line-height:1.8;color:rgb(255,0,0);"><a href="http://www.cnblogs.com/ymnets/p/5459937.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);"><span style="line-height:1.8;color:rgb(255,0,0);">如何使用这个框架？</span></a></span></strong></p> 
    <p style="text-indent:2em;">按照之前的做法，更新到EF。并利用T4生成DAL,BLL,MODEL。再用代码生成器生成界面复制进解决方案，一步到位</p> 
    <p style="text-indent:2em;">配置好访问地址和权限，直接运行</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160625164246500-633757030.png" alt="" style="border:0px;"></p> 
    <p style="text-indent:2em;">&nbsp;再手动在工具栏添加导入和导出的按钮（别忘记添加权限）</p> 
    <p style="text-indent:2em;">&nbsp;<img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626155558500-1930904634.png" alt="" style="border:0px;"></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre>    <span style="color:rgb(0,128,0);line-height:1.5;">@Html</span>.ToolButton("btnImport", "fa fa<span style="color:rgb(128,128,128);line-height:1.5;">-</span><span style="color:rgb(0,0,255);line-height:1.5;">level</span><span style="color:rgb(128,128,128);line-height:1.5;">-</span>down", Resource.Import, <span style="color:rgb(0,0,255);line-height:1.5;">perm</span><span style="line-height:1.5;">, "Import", true)
    </span><span style="color:rgb(0,128,0);line-height:1.5;">@Html</span>.ToolButton("btnExport", "fa fa<span style="color:rgb(128,128,128);line-height:1.5;">-</span><span style="color:rgb(0,0,255);line-height:1.5;">level</span><span style="color:rgb(128,128,128);line-height:1.5;">-</span>up", Resource.Export, <span style="color:rgb(0,0,255);line-height:1.5;">perm</span>, "Export", true)</pre>
    </div> 
    <h3 style="color:#008080;font-size:16px;line-height:45px;">2.安装LinqToExcel包</h3> 
    <p style="text-indent:2em;">因为我们读取Excel放在BLL层，所有在BLL层安装LinqToExcel包</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160625162818016-268065414.png" alt="" width="890" height="596" style="border:0px;"></p> 
    <h3 style="color:#008080;font-size:16px;line-height:45px;">3.文件上传</h3> 
    <p style="text-indent:2em;">（这一点简单带过，可以到网上下载上传代码植入到自己系统中）</p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);"><span style="line-height:1.8;">或者</span></span><span style="line-height:1.8;color:rgb(255,0,0);"><span style="line-height:1.8;"><a href="http://www.cnblogs.com/ymnets/p/3604471.html" rel="nofollow" style="text-decoration:none;color:rgb(0,0,0);border-bottom:1px dotted rgb(51,51,51);">下载第32节的源码</a>&nbsp;</span></span><span style="line-height:1.8;color:rgb(255,0,0);"><span style="line-height:1.8;">或者使用你有自己的上传文件功能</span></span></p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);"><span style="line-height:1.8;"><span style="line-height:1.5;color:rgb(0,0,0);">我这里使用普通的form上传功能</span></span></span></p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);"><span style="line-height:1.8;"><span style="line-height:1.5;color:rgb(0,0,0);">添加导入前端代码</span></span></span></p> 
    <p style="text-indent:2em;">&nbsp;</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>&lt;div id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">uploadExcel</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">easyui-window</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> data-options=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">modal:true,closed:true,minimizable:false,shadow:false</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
    &lt;form name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">form1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> method=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">post</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">form1</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;th style=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;"> padding:20px;</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;Excel：&lt;/th&gt;
                &lt;td style=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;"> padding:20px;</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
                    &lt;input name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">ExcelPath</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">text</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> maxlength=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">255</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">txtExcelPath</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">readonly</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">readonly</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> style=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">width:200px</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">txtInput normal left</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
                    &lt;a href=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">javascript:$('#FileUpload').trigger('click').void(0);;</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">files</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;@Resource.Browse&lt;/a&gt;
                    &lt;input <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">displaynone</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> type=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">file</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">FileUpload</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> name=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">FileUpload</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> onchange=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Upload('ExcelFile', 'txtExcelPath', 'FileUpload');</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
                    &lt;span <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">uploading</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;@Resource.Uploading&lt;/span&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
        &lt;div <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">endbtndiv</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;
            &lt;a id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">btnSave</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> href=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">javascript:ImportData()</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">easyui-linkbutton btns</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;Save&lt;/a&gt;
            &lt;a id=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">btnReturn</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> href=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">javascript:$('#uploadExcel').window('close')</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> <span style="color:rgb(0,0,255);line-height:1.5;">class</span>=<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">easyui-linkbutton btnc</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>&gt;Close&lt;/a&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;</pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="text-indent:2em;">&nbsp;导入按钮事件只要弹出上传框就好</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre><span style="line-height:1.5;">  $("#btnImport").click(function () {
            $("#uploadExcel").window({ title: '@Resource.Import', width: 450, height: 160, iconCls: 'icon-details' }).window('open');
        });</span></pre>
    </div> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626155714563-1268055067.png" alt="" style="border:0px;"></p> 
    <p style="text-indent:2em;">&nbsp;保证上传是成功的。</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626163819422-523852367.png" alt="" style="border:0px;"></p> 
    <p style="text-indent:2em;">-------------------------------------------------------------------------------------------------------上面只是前期的准备工作--------------------------------------------------------------</p> 
    <p style="text-indent:2em;">在业务层添加以下代码</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
     <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.5;">BLL</span> 
    </div> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <img class="code_img_closed" src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="border:0px;vertical-align:middle;">&nbsp;
     <span class="cnblogs_code_collapse" style="border-width:1px;border-style:solid;border-color:#808080;line-height:1.5;">ValidationError</span> 
    </div> 
    <p style="text-indent:2em;"><span style="line-height:1.5;">代码包含两个方法</span></p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);">public bool CheckImportData( string fileName, List&lt;Spl_PersonModel&gt; personList,ValidationErrors errors )</span></p> 
    <p style="text-indent:2em;">fileName为我们上传的文件。</p> 
    <p style="text-indent:2em;">personList为承接数据List</p> 
    <p style="text-indent:2em;">ValidationErrors 错误集合</p> 
    <p style="text-indent:2em;"><span style="line-height:1.8;color:rgb(255,0,0);">&nbsp;public void SaveImportData(IEnumerable&lt;Spl_PersonModel&gt; personList)</span></p> 
    <p style="text-indent:2em;">保存数据</p> 
    <p style="text-indent:2em;">别忘记添加接口</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;">
     <pre>   <span style="color:rgb(0,0,255);line-height:1.5;">public</span> <span style="color:rgb(0,0,255);line-height:1.5;">partial</span> <span style="color:rgb(0,0,255);line-height:1.5;">interface</span><span style="line-height:1.5;"> ISpl_PersonBLL
    {
        </span><span style="color:rgb(0,0,255);line-height:1.5;">bool</span> CheckImportData(<span style="color:rgb(0,0,255);line-height:1.5;">string</span> fileName, List&lt;Spl_PersonModel&gt; personList, <span style="color:rgb(0,0,255);line-height:1.5;">ref</span><span style="line-height:1.5;"> ValidationErrors errors);
        </span><span style="color:rgb(0,0,255);line-height:1.5;">void</span> SaveImportData(IEnumerable&lt;Spl_PersonModel&gt;<span style="line-height:1.5;"> personList);
    }</span></pre>
    </div> 
    <p style="text-indent:2em;"><span style="line-height:1.5;">简单明白，直接看代码，不再解析。OK这样控制器就可以直接调用了</span></p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre>  <span style="color:rgb(0,0,255);line-height:1.5;">public</span> ActionResult Import(<span style="color:rgb(0,0,255);line-height:1.5;">string</span><span style="line-height:1.5;"> filePath)
        {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">var</span> personList = <span style="color:rgb(0,0,255);line-height:1.5;">new</span> List&lt;Spl_PersonModel&gt;<span style="line-height:1.5;">();
             </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">校验数据is</span>
            <span style="color:rgb(0,0,255);line-height:1.5;">bool</span> checkResult = m_BLL.CheckImportData(filePath, personList, <span style="color:rgb(0,0,255);line-height:1.5;">ref</span><span style="line-height:1.5;"> errors);
             </span><span style="color:rgb(0,128,0);line-height:1.5;">//</span><span style="color:rgb(0,128,0);line-height:1.5;">校验通过直接保存</span>
             <span style="color:rgb(0,0,255);line-height:1.5;">if</span><span style="line-height:1.5;"> (checkResult)
             {
                 m_BLL.SaveImportData(personList);
                 LogHandler.WriteServiceLog(GetUserId(),</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">导入成功</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">成功</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"导入</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Spl_Person</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
                 </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> Json(JsonHandler.CreateMessage(<span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">, Resource.InsertSucceed));
             }
             </span><span style="color:rgb(0,0,255);line-height:1.5;">else</span><span style="line-height:1.5;">
             {
                 </span><span style="color:rgb(0,0,255);line-height:1.5;">string</span> ErrorCol =<span style="line-height:1.5;"> errors.Error;
                 LogHandler.WriteServiceLog(GetUserId(), ErrorCol, </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">失败</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"导入</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>, <span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">Spl_Person</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
                 </span><span style="color:rgb(0,0,255);line-height:1.5;">return</span> Json(JsonHandler.CreateMessage(<span style="color:rgb(128,0,128);line-height:1.5;">0</span>, Resource.InsertFail +<span style="line-height:1.5;"> ErrorCol));
              }
        
        }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="text-indent:2em;">最后前端还需要把路径给回来。</p> 
    <div class="cnblogs_code" style="border:1px solid rgb(204,204,204);color:rgb(0,0,0);font-family:'Courier New';font-size:12px;"> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
     <pre><span style="line-height:1.5;"> function ImportData()
    {
        $.post(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">@Url.Action(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>Import<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">)?filePath=</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span> + $(<span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">#txtExcelPath</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">).val(), function (data) {
            </span><span style="color:rgb(0,0,255);line-height:1.5;">if</span> (data.type == <span style="color:rgb(128,0,128);line-height:1.5;">1</span><span style="line-height:1.5;">) {
                $(</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">#List</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span>).datagrid(<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">load</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">);
                $(</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">#uploadExcel</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span>).window(<span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">close</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">);
            }
            $.messageBox5s(</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="color:rgb(128,0,0);line-height:1.5;">@Resource.Tip</span><span style="color:rgb(128,0,0);line-height:1.5;">'</span><span style="line-height:1.5;">, data.message);
                            
        }, </span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="color:rgb(128,0,0);line-height:1.5;">json</span><span style="color:rgb(128,0,0);line-height:1.5;">"</span><span style="line-height:1.5;">);
    }</span></pre> 
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="border:none;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span>
     </div> 
    </div> 
    <p style="text-indent:2em;">OK测试一下！建立一个新的excel格式</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626181007235-1624519328.png" alt="" style="border:0px;"></p> 
    <p style="text-indent:2em;">一般情况下我们是提供模版给用户下载供用户输入数据，来确保格式的正确性</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626181704110-330797628.png" alt="" style="border:0px;"></p> 
    <h3 style="color:#008080;font-size:16px;line-height:45px;">总结：</h3> 
    <p style="text-indent:2em;"><strong>虽然做好了导出功能，但是来不及发代码。只能到下次有时间再分析导出功能</strong></p> 
    <p style="text-indent:2em;">本节知识点，全部聚集在CheckImportData方法上。</p> 
    <p style="text-indent:2em;">对应列头是模版xlsx的列头</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160626222945766-578262782.png" alt="" style="border:0px;"></p> 
    <p style="text-indent:2em;">1.如果模版需要是是中文的，如Name=名字，那么方法应该这么写</p> 
    <p style="text-indent:2em;">&nbsp;excelFile.AddMapping&lt;Spl_PersonModel&gt;(x =&gt; x.Name, "名字");</p> 
    <p style="text-indent:2em;">2.导入第几个sheet工作薄可以这么写</p> 
    <p style="text-indent:2em;">我这里写0是指第一个sheet工作薄。可以直接指定工作薄</p> 
    <p style="text-indent:2em;">var excelContent = excelFile.Worksheet&lt;Spl_PersonModel&gt;("Sheet1");</p> 
    <p style="text-indent:2em;">3.检查正确性可以确保数据的来源。可以给出用户正确的修改提示。</p> 
    <p style="text-indent:2em;"><img src="https://images2015.cnblogs.com/blog/439652/201606/439652-20160627000338203-482693780.gif" alt="" style="border:0px;"></p> 
   </div> 
   <div> 
    <font color="#333333"><span style="font-size:14px;">本文转自ymnets博客园博客，原文链接：http://www.cnblogs.com/ymnets/p/5616486.html，如需转载请自行联系原作者</span></font>
    <br>
   </div> 
  </div> 
 </div> 
</div>
  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://uzstatic-360cdn.belost.xyz/theme/default/images/logo.png" alt="柚子社区">
  <div class="col-box-title name">NotBeCN</div>
  <!-- <p>最新资讯</p> -->
  <p class="contact">
    
    <a href="mailto:fandyvon@163.com" target="_blank">邮箱</a>
    
    <a href="https://uzshare.com" target="_blank">柚子社区</a>
    
    <a href="https://uzzz.org" target="_blank">找组织</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">最新</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/2019/05/14/zxh1220_90138586.html">[原创软件] [软件发布] 定时备份文件发送邮箱，不再怕数据丢失了</a></li>
    
      <li><a class="post-link" href="/2019/05/14/weixin_45037290_90140056.html">Get智能写作满月记 ——产品篇</a></li>
    
      <li><a class="post-link" href="/2019/05/14/nulio__90138386.html">《深度探索C++对象模型》..............</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_41248707_90140031.html">mysql 多表联查之连接查询</a></li>
    
      <li><a class="post-link" href="/2019/05/13/qq_21122683_90125902.html">golang基础(二)</a></li>
    
      <li><a class="post-link" href="/2019/05/13/1557726108256.html">今日份的PTA刷题</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90137366.html">Android之折线图</a></li>
    
      <li><a class="post-link" href="/2019/05/12/zzzfffei_90136638.html">Android之实现选中时改变样式</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">目录</div>
</div>

<div class="col-box">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- right_sidebar -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8889449066804352"
       data-ad-slot="2081363239"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2019 
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123344652-5');
</script>


<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.async = true;
  hm.src = "https://hm.baidu.com/hm.js?9b378145d7399199b371d067f4c8be96";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  </body>

</html>
